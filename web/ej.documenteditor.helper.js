var __extends = (this && this.__extends) || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
};
var DocumentEditorFeatures;
(function (DocumentEditorFeatures) {
    var DocumentEditorEvents = (function () {
        function DocumentEditorEvents() {
        }
        DocumentEditorEvents.DocumentChange = "documentChange";
        DocumentEditorEvents.SelectionChange = "selectionChange";
        DocumentEditorEvents.ZoomFactorChange = "zoomFactorChange";
        DocumentEditorEvents.RequestNavigate = "requestNavigate";
        DocumentEditorEvents.ContentChange = "contentChange";
        return DocumentEditorEvents;
    }());
    DocumentEditorFeatures.DocumentEditorEvents = DocumentEditorEvents;
    var DocumentEditorThemeHelper = (function () {
        function DocumentEditorThemeHelper() {
        }
        DocumentEditorThemeHelper.DocumentEditor = "e-documenteditor";
        DocumentEditorThemeHelper.ContextMenuItem = "e-documenteditor-contextmenuitem";
        DocumentEditorThemeHelper.DisabledContextMenuItem = "e-documenteditor-disabledcontextmenuitem";
        DocumentEditorThemeHelper.OptionsPane = "e-documenteditor-optionspane";
        DocumentEditorThemeHelper.HiddenContextMenuItem = "e-documenteditor-hiddencontextmenuitem";
        DocumentEditorThemeHelper.ContextMenuCut = "e-documenteditor-contextmenu-cut";
        DocumentEditorThemeHelper.ContextMenuCopy = "e-documenteditor-contextmenu-copy";
        DocumentEditorThemeHelper.ContextMenuPaste = "e-documenteditor-contextmenu-paste";
        DocumentEditorThemeHelper.ContextMenuCopyHyperlink = "e-documenteditor-contextmenu-copyheperlink";
        DocumentEditorThemeHelper.ContextMenuOpenHyperlink = "e-documenteditor-contextmenu-openhyperlink";
        DocumentEditorThemeHelper.ContextMenuEditHyperlink = "e-documenteditor-contextmenu-edithyperlink";
        DocumentEditorThemeHelper.ContextMenuHyperlink = "e-documenteditor-contextmenu-hyperlink";
        DocumentEditorThemeHelper.ContextMenuRemoveHyperlink = "e-documenteditor-contextmenu-removehyperlink";
        DocumentEditorThemeHelper.ContextMenuFont = "e-documenteditor-contextmenu-font";
        DocumentEditorThemeHelper.ContextMenuParagraph = "e-documenteditor-contextmenu-paragraph";
        DocumentEditorThemeHelper.ContextMenuTableProperties = "e-documenteditor-contextmenu-tableproperties";
        return DocumentEditorThemeHelper;
    }());
    DocumentEditorFeatures.DocumentEditorThemeHelper = DocumentEditorThemeHelper;
    var DocumentEditorHelper = (function () {
        function DocumentEditorHelper(owner, ej) {
            this.isDocumentLoaded = true;
            this.currentPageNumber = 1;
            this.pageCount = 1;
            this.ej = null;
            this.isShiftingEnabled = false;
            this.isLayoutEnabled = true;
            this.isPastingContent = false;
            this.disableHistory = false;
            this.ShowComments = true;
            this.isReviewPanelShown = false;
            this.layoutType = LayoutType.Pages;
            this.isReadOnly = false;
            this.isReadOnlyInternal = false;
            this.SelectedResizeElement = null;
            this.ResizerPosition = -1;
            this.CurrentResizingTable = null;
            this.IsRowOrCellResizing = false;
            this.findResultsList = null;
            this._pasteTimeOut = 12000;
            this.DocumentEditor = owner;
            this.ej = ej;
            this.LayoutType = this.DocumentEditor.model.layoutType;
            if (this.LayoutType == LayoutType.Pages)
                this.viewer = new PageLayoutViewer(this);
            else
                this.viewer = new FlowLayoutViewer(this);
            this.selection = new SelectionAdv(this);
            this.textSearchResults = new TextSearchResults(this);
            this.history = new History(this);
            this.stackSize = 500;
            this.ImageResizerPoints = new ImageResizingPoints();
            this.TableDialog = new TableDialog(this);
            this.TableBoderShadingDialog = new BordersAndShadingsDialog(this);
            this.InitialPoint = new Point(0, 0);
            this.findResultsList = new List();
        }
        Object.defineProperty(DocumentEditorHelper.prototype, "DocumentEditorElement", {
            get: function () {
                return this.DocumentEditor.element[0];
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(DocumentEditorHelper.prototype, "ContainerId", {
            get: function () {
                return this.DocumentEditor._id;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(DocumentEditorHelper.prototype, "CurrentPageNumber", {
            get: function () {
                if (this.Viewer == null || this.Viewer.SelectionEndPage == null)
                    return 1;
                return this.Viewer.Pages.indexOf(this.Viewer.SelectionEndPage) + 1;
            },
            set: function (value) {
                this.currentPageNumber = value;
                this._RaiseClientEvent(DocumentEditorEvents.SelectionChange, null);
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(DocumentEditorHelper.prototype, "PageCount", {
            get: function () {
                if (this.Viewer == null)
                    return;
                return this.Viewer.Pages.Count;
            },
            set: function (value) {
                this.pageCount = value;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(DocumentEditorHelper.prototype, "ZoomFactor", {
            get: function () {
                return this.Viewer.ZoomFactor;
            },
            set: function (value) {
                this.Viewer.ZoomFactor = value;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(DocumentEditorHelper.prototype, "Document", {
            get: function () {
                return this.document;
            },
            set: function (document) {
                this._onDocumentChanged(document);
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(DocumentEditorHelper.prototype, "IsDocumentLoaded", {
            get: function () {
                return this.isDocumentLoaded;
            },
            set: function (value) {
                if (value) {
                    if (this.Document != null)
                        this.Document._ClearUnlinkedFields();
                }
                this.isDocumentLoaded = value;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(DocumentEditorHelper.prototype, "Selection", {
            get: function () {
                return this.selection;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(DocumentEditorHelper.prototype, "Viewer", {
            get: function () {
                return this.viewer;
            },
            set: function (viewer) {
                this.viewer = viewer;
                this._OnViewerChanged(this.viewer);
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(DocumentEditorHelper.prototype, "IsShiftingEnabled", {
            get: function () {
                return this.isShiftingEnabled;
            },
            set: function (value) {
                this.isShiftingEnabled = value;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(DocumentEditorHelper.prototype, "IsLayoutEnabled", {
            get: function () {
                return this.isLayoutEnabled;
            },
            set: function (value) {
                this.isLayoutEnabled = value;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(DocumentEditorHelper.prototype, "IsPastingContent", {
            get: function () {
                return this.isPastingContent;
            },
            set: function (value) {
                this.isPastingContent = value;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(DocumentEditorHelper.prototype, "History", {
            get: function () {
                return this.history;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(DocumentEditorHelper.prototype, "StackSize", {
            get: function () {
                return this.stackSize;
            },
            set: function (value) {
                this.stackSize = value;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(DocumentEditorHelper.prototype, "DisableHistory", {
            get: function () {
                return this.disableHistory;
            },
            enumerable: true,
            configurable: true
        });
        ;
        Object.defineProperty(DocumentEditorHelper.prototype, "LayoutType", {
            get: function () {
                return this.layoutType;
            },
            set: function (value) {
                this.layoutType = value;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(DocumentEditorHelper.prototype, "IsReadOnly", {
            get: function () {
                return this.isReadOnly;
            },
            set: function (value) {
                this.isReadOnly = value;
                this.Viewer._ShowCaret(false);
                this.Selection._UpdateFocus();
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(DocumentEditorHelper.prototype, "IsReadOnlyMode", {
            get: function () {
                return this.isReadOnly || this.isReadOnlyInternal;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(DocumentEditorHelper.prototype, "IsReadOnlyInternal", {
            get: function () {
                return this.isReadOnlyInternal;
            },
            set: function (value) {
                this.isReadOnlyInternal = value;
            },
            enumerable: true,
            configurable: true
        });
        DocumentEditorHelper.prototype._AddSearchResultItems = function (result) {
            if (result == null || result == "")
                return;
            if (this.findResultsList == null)
                this.findResultsList = new List();
            this.findResultsList._Add(result);
        };
        DocumentEditorHelper.prototype._ClearSearchResultItems = function () {
            if (this.findResultsList != null)
                this.findResultsList._Clear();
        };
        DocumentEditorHelper.prototype._OnViewerChanged = function (viewer) {
            if ((this.Selection.Start != null)) {
                this.Selection._UpdatePhysicalPosition();
                this.Selection._FireSelectionChanged(true);
            }
        };
        DocumentEditorHelper.prototype._RaiseClientEvent = function (event, args) {
            this.DocumentEditor._raiseClientEvent(event, args);
        };
        DocumentEditorHelper.prototype._InsertComment = function () {
            this.Selection._InsertComment();
        };
        DocumentEditorHelper.prototype._DeleteAllComments = function () {
            this.Selection._DeleteAllComments();
        };
        DocumentEditorHelper.prototype._DeleteComment = function () {
            var selection = this.Selection;
            selection._DeleteComment(selection.Start.Paragraph._GetOwnerComment());
        };
        DocumentEditorHelper.prototype._NavigateNextComment = function () {
            this.Selection._NavigateNextComment();
        };
        DocumentEditorHelper.prototype._NavigatePreviousComment = function () {
            this.Selection._NavigatePreviousComment();
        };
        DocumentEditorHelper.prototype._CanAddNewComment = function () {
            if (!this.IsReadOnlyMode && this.LayoutType == LayoutType.Pages && this.Selection != null && !this.Selection.IsCleared && !this.Selection._IsInComment())
                return true;
            return false;
        };
        DocumentEditorHelper.prototype._CanDeleteComment = function () {
            if ((!this.IsReadOnlyMode && this.Selection != null && !this.Selection.IsCleared && this.Selection._IsInComment()) || (this.Document != null && this.Document.Comments.Count > 0))
                return true;
            return false;
        };
        DocumentEditorHelper.prototype._CanNavigateToPrevComment = function () {
            if (this.Selection != null && this.Document != null && !this.Selection.IsCleared && this.Selection._IsInComment()) {
                var comment = this.Selection.Start.Paragraph._GetOwnerComment();
                var para = null;
                var index = this.Document.Comments._IndexOf(comment);
                if (index > 0) {
                    comment = this.Document.Comments[index - 1];
                    para = comment._GetFirstParagraph();
                    if (para != null)
                        return true;
                }
            }
            return false;
        };
        DocumentEditorHelper.prototype._CanNavigateToNextComment = function () {
            if (this.Selection != null && !this.Selection.IsCleared && this.Document != null && this.Selection._IsInComment()) {
                var comment = this.Selection.Start.Paragraph._GetOwnerComment();
                var para = null;
                var index = this.Document.Comments._IndexOf(comment);
                if (index < this.Document.Comments.Count - 1) {
                    comment = this.Document.Comments[index + 1];
                    para = comment._GetFirstParagraph();
                    if (para != null)
                        return true;
                }
            }
            return false;
        };
        DocumentEditorHelper.prototype._CanInsertHyperlink = function () {
            if (this.Document != null && this.IsDocumentLoaded && !this.Selection._CanMergeSelectedCells() && this.Selection != null)
                return true;
            return false;
        };
        DocumentEditorHelper.prototype._GetDocumentStart = function () {
            var documentStart = this.Document.DocumentStart;
            if (documentStart == null)
                return "0;0;0";
            return documentStart._GetHierarchicalIndexInternal();
        };
        DocumentEditorHelper.prototype._GetDocumentEnd = function () {
            var documentEnd = this.Document.DocumentEnd;
            if (documentEnd == null)
                return "0;0;1";
            return documentEnd._GetHierarchicalIndexInternal();
        };
        DocumentEditorHelper.prototype._Paste = function () {
            this.viewer._OnPasteMenuClick();
        };
        DocumentEditorHelper.prototype._Print = function () {
            this.viewer._Print();
        };
        DocumentEditorHelper.prototype._FitPage = function (pageFitType) {
            this.viewer.PageFitType = pageFitType;
        };
        DocumentEditorHelper.prototype._FireRequestNavigate = function (hyperlinkField) {
            var hyperlink = new HyperLink(hyperlinkField);
            var args = new RequestNavigateEventArgs(hyperlink);
            this._RaiseClientEvent(DocumentEditorEvents.RequestNavigate, args);
        };
        DocumentEditorHelper.prototype._onDocumentChanged = function (document) {
            if (this.document != null)
                this.document._Dispose();
            if (this.history != null)
                this.history._Dispose();
            this.document = document;
            this.IsDocumentLoaded = true;
            if (this.document != null) {
                this.document.OwnerControl = this;
                this.document._LayoutItems(this.viewer);
            }
            this.PageCount = this.Viewer.Pages.Count > 0 ? this.viewer.Pages.Count : 1;
            if (this.Selection != null)
                this.Selection.EditingContext.Type = EditingContextType.Text;
            this._RaiseClientEvent(DocumentEditorEvents.DocumentChange, null);
            this.viewer._ShowHideOptionsPane(false);
        };
        DocumentEditorHelper.prototype._InitDocumentLoad = function () {
            this.IsDocumentLoaded = false;
            this.viewer._ClearContainer();
        };
        DocumentEditorHelper.prototype._parseDocumentInternal = function (data) {
            var documentAdv = new DocumentAdv(null);
            if (data.BackgroundColor != null && data.BackgroundColor != undefined)
                documentAdv.BackgroundColor = data.BackgroundColor;
            if (data.hasOwnProperty("CharacterFormat") && data.CharacterFormat != undefined && data.CharacterFormat != null)
                this._parseCharacterFormat(data.CharacterFormat, documentAdv.CharacterFormat);
            var commentStarts = new Dictionary();
            var comments = new Dictionary();
            this._parseSections(data.Sections, documentAdv, commentStarts, comments);
            this._parseAbstractList(data, documentAdv);
            this._parseList(data, documentAdv);
            return documentAdv;
        };
        DocumentEditorHelper.prototype._ParseDocument = function (data) {
            this.Document = this._parseDocumentInternal(data);
            this.Selection._SelectRange(this.Document.DocumentStart, this.Document.DocumentStart, true);
        };
        DocumentEditorHelper.prototype._parseSections = function (data, documentAdv, commentStarts, comments) {
            for (var i = 0; i < data.length; i++) {
                var sectionAdv = new SectionAdv(null);
                this._parseSectionFormat(data[i].SectionFormat, sectionAdv.SectionFormat);
                this._parseHeaderFooter(data[i].HeaderFooters, sectionAdv.HeaderFooters, commentStarts, comments);
                this._parseTextBody(data[i].Blocks, sectionAdv.Blocks, commentStarts, comments);
                documentAdv.Sections._Push(sectionAdv);
            }
        };
        DocumentEditorHelper.prototype._parseSectionFormat = function (data, sectionformat) {
            sectionformat.PageWidth = data.PageWidth;
            sectionformat.PageHeight = data.PageHeight;
            sectionformat.LeftMargin = data.LeftMargin;
            sectionformat.TopMargin = data.TopMargin;
            sectionformat.RightMargin = data.RightMargin;
            sectionformat.BottomMargin = data.BottomMargin;
            sectionformat.HeaderDistance = data.HeaderDistance;
            sectionformat.FooterDistance = data.FooterDistance;
            sectionformat.DifferentFirstPage = data.DifferentFirstPage;
            sectionformat.DifferentOddAndEvenPages = data.DifferentOddAndEvenPages;
        };
        DocumentEditorHelper.prototype._parseHeaderFooter = function (data, headerfooters, commentStarts, comments) {
            this._parseTextBody(data.Header.Blocks, headerfooters.Header.Blocks, commentStarts, comments);
            this._parseTextBody(data.Footer.Blocks, headerfooters.Footer.Blocks, commentStarts, comments);
            this._parseTextBody(data.EvenHeader.Blocks, headerfooters.EvenHeader.Blocks, commentStarts, comments);
            this._parseTextBody(data.EvenFooter.Blocks, headerfooters.EvenFooter.Blocks, commentStarts, comments);
            this._parseTextBody(data.FirstPageHeader.Blocks, headerfooters.FirstPageHeader.Blocks, commentStarts, comments);
            this._parseTextBody(data.FirstPageFooter.Blocks, headerfooters.FirstPageFooter.Blocks, commentStarts, comments);
        };
        DocumentEditorHelper.prototype._parseTextBody = function (data, Blocks, commentStarts, comments) {
            for (var i = 0; i < data.length; i++) {
                var blockAdv = data[i];
                if (blockAdv.hasOwnProperty("Inlines")) {
                    var paragraphAdv = new ParagraphAdv(null);
                    if (blockAdv.hasOwnProperty("ParagraphFormat"))
                        this._parseParagraphFormat(blockAdv.ParagraphFormat, paragraphAdv.ParagraphFormat);
                    if (blockAdv.hasOwnProperty("CharacterFormat"))
                        this._parseCharacterFormat(blockAdv.CharacterFormat, paragraphAdv.CharacterFormat);
                    if (blockAdv.Inlines.length > 0) {
                        this._parseParagraph(blockAdv.Inlines, paragraphAdv, commentStarts, comments);
                    }
                    Blocks._Push(paragraphAdv);
                }
                else if (blockAdv.hasOwnProperty("Rows"))
                    this._parseTable(blockAdv, Blocks, commentStarts, comments);
            }
        };
        DocumentEditorHelper.prototype._parseTable = function (blockAdv, Blocks, commentStarts, comments) {
            var tableAdv = new TableAdv(null);
            this._parseTableFormat(blockAdv.TableFormat, tableAdv.TableFormat);
            tableAdv.Title = blockAdv.Title;
            tableAdv.Description = blockAdv.Description;
            for (var i = 0; i < blockAdv.Rows.length; i++) {
                var rowAdv = new TableRowAdv(null);
                if (blockAdv.Rows[i].hasOwnProperty("RowFormat")) {
                    this._parseRowFormat(blockAdv.Rows[i].RowFormat, rowAdv.RowFormat);
                    rowAdv.GridBefore = blockAdv.Rows[i].GridBefore;
                    rowAdv.GridBeforeWidth = blockAdv.Rows[i].GridBeforeWidth;
                    rowAdv.GridAfter = blockAdv.Rows[i].GridAfter;
                    rowAdv.GridAfterWidth = blockAdv.Rows[i].GridAfterWidth;
                    for (var j = 0; j < blockAdv.Rows[i].Cells.length; j++) {
                        var cellAdv = new TableCellAdv(null);
                        rowAdv.Cells._Push(cellAdv);
                        if (blockAdv.Rows[i].Cells[j].hasOwnProperty("CellFormat"))
                            this._parseCellFormat(blockAdv.Rows[i].Cells[j].CellFormat, cellAdv.CellFormat);
                        this._parseTextBody(blockAdv.Rows[i].Cells[j].Blocks, cellAdv.Blocks, commentStarts, comments);
                    }
                }
                tableAdv.Rows._Push(rowAdv);
            }
            if (tableAdv != null)
                Blocks._Push(tableAdv);
        };
        DocumentEditorHelper.prototype._parseParagraph = function (data, paragraphAdv, commentStarts, comments) {
            for (var i = 0; i < data.length; i++) {
                var inline = data[i];
                if (inline.hasOwnProperty("Text")) {
                    var spanAdv = new SpanAdv(null);
                    if (inline.hasOwnProperty("CharacterFormat"))
                        this._parseCharacterFormat(inline.CharacterFormat, spanAdv.CharacterFormat);
                    spanAdv.Text = inline.Text;
                    paragraphAdv.Inlines._Push(spanAdv);
                }
                else if (inline.hasOwnProperty("ImageString")) {
                    var imageAdv = new ImageAdv(null, inline.IsInlineImage, inline.IsMetaFile);
                    paragraphAdv.Inlines._Push(imageAdv);
                    imageAdv.ImageString = inline.ImageString;
                    imageAdv.Width = inline.Width;
                    imageAdv.Height = inline.Height;
                    if (inline.hasOwnProperty("CharacterFormat"))
                        this._parseCharacterFormat(inline.CharacterFormat, imageAdv.CharacterFormat);
                }
                else if (inline.hasOwnProperty("CommentId")) {
                    var commentID = inline.CommentId;
                    var commentStart = null;
                    if (commentStarts._ContainsKey(commentID))
                        commentStart = commentStarts._Get(commentID);
                    var commentCharacter = null;
                    if (comments._ContainsKey(commentID))
                        commentCharacter = comments._Get(commentID);
                    if (inline.hasOwnProperty("CommentCharacterType")) {
                        if (inline.CommentCharacterType == 0) {
                            var commentStartAdv = new CommentStartAdv(paragraphAdv);
                            if (commentCharacter instanceof CommentAdv) {
                                commentStartAdv.Comment = commentCharacter;
                                commentCharacter.CommentStart = commentStartAdv;
                                if (commentStartAdv.Comment.CommentEnd instanceof CommentEndAdv) {
                                    comments._Remove(commentID);
                                }
                            }
                            else {
                                commentStarts._Add(commentID, commentStartAdv);
                            }
                            paragraphAdv.Inlines._Push(commentStartAdv);
                        }
                        else {
                            var commentEndAdv = new CommentEndAdv(paragraphAdv);
                            if (commentCharacter instanceof CommentAdv) {
                                commentEndAdv.Comment = commentCharacter;
                                commentCharacter.CommentEnd = commentEndAdv;
                                if (commentEndAdv.Comment.CommentStart instanceof CommentStartAdv) {
                                    comments._Remove(commentID);
                                }
                            }
                            else {
                                comments._Add(commentID, commentEndAdv);
                            }
                            paragraphAdv.Inlines._Push(commentEndAdv);
                        }
                    }
                    else {
                        var commentAdv = new CommentAdv(null, inline.CreatedDate);
                        commentAdv.Author = inline.Author;
                        commentAdv.Initial = inline.Initial;
                        if (inline.hasOwnProperty("Blocks")) {
                            this._parseTextBody(inline.Blocks, commentAdv.Blocks, commentStarts, comments);
                        }
                        if (commentStart instanceof CommentStartAdv) {
                            commentAdv.CommentStart = commentStart;
                            commentStart.Comment = commentAdv;
                        }
                        if (commentCharacter instanceof CommentEndAdv) {
                            commentAdv.CommentEnd = commentCharacter;
                            commentCharacter.Comment = commentAdv;
                            if (commentAdv.CommentStart instanceof CommentStartAdv) {
                                commentStarts._Remove(commentID);
                            }
                            else {
                                comments._Remove(commentID);
                                comments._Add(commentID, commentAdv);
                            }
                        }
                        else {
                            comments._Add(commentID, commentAdv);
                        }
                        paragraphAdv.Inlines._Push(commentAdv);
                    }
                }
                else if (inline.hasOwnProperty("HasFieldEnd")) {
                    var fieldBegin = new FieldBeginAdv(null);
                    fieldBegin.HasFieldEnd = inline.HasFieldEnd;
                    paragraphAdv.Inlines._Push(fieldBegin);
                }
                else if (inline.hasOwnProperty("FieldCharacterType")) {
                    var field = null;
                    if (inline.FieldCharacterType == 1) {
                        field = new FieldSeparatorAdv(null);
                    }
                    else if (inline.FieldCharacterType == 2) {
                        field = new FieldEndAdv(null);
                    }
                    paragraphAdv.Inlines._Push(field);
                }
            }
        };
        DocumentEditorHelper.prototype._parseCharacterFormat = function (sourceFormat, characterFormat) {
            if (sourceFormat.BaselineAlignment != undefined && sourceFormat.BaselineAlignment != null)
                characterFormat.BaselineAlignment = sourceFormat.BaselineAlignment;
            if (sourceFormat.Underline != undefined && sourceFormat.Underline != null)
                characterFormat.Underline = sourceFormat.Underline;
            if (sourceFormat.StrikeThrough != undefined && sourceFormat.StrikeThrough != null)
                characterFormat.StrikeThrough = sourceFormat.StrikeThrough;
            if (sourceFormat.FontSize != undefined && sourceFormat.FontSize != null)
                characterFormat.FontSize = sourceFormat.FontSize;
            if (sourceFormat.FontFamily != undefined && sourceFormat.FontFamily != null)
                characterFormat.FontFamily = sourceFormat.FontFamily;
            if (sourceFormat.Bold != undefined && sourceFormat.Bold != null)
                characterFormat.Bold = sourceFormat.Bold;
            if (sourceFormat.Italic != undefined && sourceFormat.Italic != null)
                characterFormat.Italic = sourceFormat.Italic;
            if (sourceFormat.HighlightColor != undefined && sourceFormat.HighlightColor != null)
                characterFormat.HighlightColor = sourceFormat.HighlightColor;
            if (sourceFormat.FontColor != undefined && sourceFormat.FontColor != null)
                characterFormat.FontColor = sourceFormat.FontColor;
        };
        DocumentEditorHelper.prototype._parseListCharacterFormat = function (sourceFormat, characterFormat) {
            if (sourceFormat != null) {
                if (sourceFormat.BaselineAlignment != undefined && sourceFormat.BaselineAlignment != null)
                    characterFormat.BaselineAlignment = sourceFormat.BaselineAlignment;
                if (sourceFormat.Underline != undefined && sourceFormat.Underline != null)
                    characterFormat.Underline = sourceFormat.Underline;
                if (sourceFormat.StrikeThrough != undefined && sourceFormat.StrikeThrough != null)
                    characterFormat.StrikeThrough = sourceFormat.StrikeThrough;
                if (sourceFormat.FontSize != undefined && sourceFormat.FontSize != null)
                    characterFormat.FontSize = sourceFormat.FontSize;
                if (sourceFormat.FontFamily != undefined && sourceFormat.FontFamily != null)
                    characterFormat.FontFamily = sourceFormat.FontFamily;
                if (sourceFormat.Bold != undefined && sourceFormat.Bold != null)
                    characterFormat.Bold = sourceFormat.Bold;
                if (sourceFormat.Italic != undefined && sourceFormat.Italic != null)
                    characterFormat.Italic = sourceFormat.Italic;
                if (sourceFormat.HighlightColor != undefined && sourceFormat.HighlightColor != null)
                    characterFormat.HighlightColor = sourceFormat.HighlightColor;
                if (sourceFormat.FontColor != undefined && sourceFormat.FontColor != null)
                    characterFormat.FontColor = sourceFormat.FontColor;
            }
        };
        DocumentEditorHelper.prototype._parseParagraphFormat = function (sourceFormat, paragraphFormat) {
            if (sourceFormat.hasOwnProperty("ListFormat"))
                this._parseListFormat(sourceFormat, paragraphFormat.ListFormat);
            if (sourceFormat.LeftIndent != undefined && sourceFormat.LeftIndent != null)
                paragraphFormat.LeftIndent = sourceFormat.LeftIndent;
            if (sourceFormat.RightIndent != undefined && sourceFormat.RightIndent != null)
                paragraphFormat.RightIndent = sourceFormat.RightIndent;
            if (sourceFormat.FirstLineIndent != undefined && sourceFormat.FirstLineIndent != null)
                paragraphFormat.FirstLineIndent = sourceFormat.FirstLineIndent;
            if (sourceFormat.LineSpacingType != undefined && sourceFormat.LineSpacingType != null)
                paragraphFormat.LineSpacingType = sourceFormat.LineSpacingType;
            if (sourceFormat.LineSpacing != undefined && sourceFormat.LineSpacing != null)
                paragraphFormat.LineSpacing = sourceFormat.LineSpacing;
            if (sourceFormat.BeforeSpacing != undefined && sourceFormat.BeforeSpacing != null)
                paragraphFormat.BeforeSpacing = sourceFormat.BeforeSpacing;
            if (sourceFormat.AfterSpacing != undefined && sourceFormat.AfterSpacing != null)
                paragraphFormat.AfterSpacing = sourceFormat.AfterSpacing;
            if (sourceFormat.TextAlignment != undefined && sourceFormat.TextAlignment != null)
                paragraphFormat.TextAlignment = sourceFormat.TextAlignment;
        };
        DocumentEditorHelper.prototype._parseListFormat = function (blockAdv, ListFormat) {
            if (blockAdv.ListFormat != null && blockAdv.ListFormat != undefined && blockAdv.ListFormat.ListId != null && blockAdv.ListFormat.ListId != undefined && blockAdv.ListFormat.ListLevelNumber != null && blockAdv.ListFormat.ListLevelNumber != undefined) {
                ListFormat.ListId = blockAdv.ListFormat.ListId;
                ListFormat.ListLevelNumber = blockAdv.ListFormat.ListLevelNumber;
            }
        };
        DocumentEditorHelper.prototype._parseTableFormat = function (sourceFormat, tableFormat) {
            if (sourceFormat.Borders != undefined && sourceFormat.Borders != null)
                this._parseBorders(sourceFormat.Borders, tableFormat.Borders);
            if (sourceFormat.CellSpacing != undefined && sourceFormat.CellSpacing != null)
                tableFormat.CellSpacing = sourceFormat.CellSpacing;
            if (sourceFormat.LeftMargin != undefined && sourceFormat.LeftMargin != null)
                tableFormat.LeftMargin = sourceFormat.LeftMargin;
            if (sourceFormat.TopMargin != undefined && sourceFormat.TopMargin != null)
                tableFormat.TopMargin = sourceFormat.TopMargin;
            if (sourceFormat.RightMargin != undefined && sourceFormat.RightMargin != null)
                tableFormat.RightMargin = sourceFormat.RightMargin;
            if (sourceFormat.BottomMargin != undefined && sourceFormat.BottomMargin != null)
                tableFormat.BottomMargin = sourceFormat.BottomMargin;
            if (sourceFormat.LeftIndent != undefined && sourceFormat.LeftIndent != null)
                tableFormat.LeftIndent = sourceFormat.LeftIndent;
            if (sourceFormat.Shading != undefined && sourceFormat.Shading != null)
                this._parseShading(sourceFormat.Shading, tableFormat.Shading);
            if (sourceFormat.TableAlignment != undefined && sourceFormat.TableAlignment != null)
                tableFormat.TableAlignment = sourceFormat.TableAlignment;
            if (sourceFormat.PreferredWidth != undefined && sourceFormat.PreferredWidth != null)
                tableFormat.PreferredWidth = sourceFormat.PreferredWidth;
            if (sourceFormat.PreferredWidthType != undefined && sourceFormat.PreferredWidthType != null)
                tableFormat.PreferredWidthType = sourceFormat.PreferredWidthType;
        };
        DocumentEditorHelper.prototype._parseShading = function (sourceShading, destShading) {
            if (sourceShading.BackgroundColor != null && sourceShading.BackgroundColor != undefined)
                destShading.BackgroundColor = sourceShading.BackgroundColor;
            if (sourceShading.ForegroundColor != null && sourceShading.ForegroundColor != undefined)
                destShading.ForegroundColor = sourceShading.ForegroundColor;
            if (sourceShading.TextureStyle != null && sourceShading.TextureStyle != undefined)
                destShading.TextureStyle = sourceShading.TextureStyle;
        };
        DocumentEditorHelper.prototype._parseBorder = function (sourceBorder, destBorder) {
            if (sourceBorder.Color != null && sourceBorder.Color != undefined)
                destBorder.Color = sourceBorder.Color;
            if (sourceBorder.LineStyle != null && sourceBorder.LineStyle != undefined)
                destBorder.LineStyle = sourceBorder.LineStyle;
            if (sourceBorder.LineWidth != null && sourceBorder.LineWidth != undefined)
                destBorder.LineWidth = sourceBorder.LineWidth;
            if (sourceBorder.HasNoneStyle != null && sourceBorder.HasNoneStyle != undefined)
                destBorder.HasNoneStyle = sourceBorder.HasNoneStyle;
        };
        DocumentEditorHelper.prototype._parseBorders = function (sourceBorders, destBorders) {
            this._parseBorder(sourceBorders.Left, destBorders.Left);
            this._parseBorder(sourceBorders.Right, destBorders.Right);
            this._parseBorder(sourceBorders.Top, destBorders.Top);
            this._parseBorder(sourceBorders.Bottom, destBorders.Bottom);
            this._parseBorder(sourceBorders.Vertical, destBorders.Vertical);
            this._parseBorder(sourceBorders.Horizontal, destBorders.Horizontal);
            this._parseBorder(sourceBorders.DiagonalDown, destBorders.DiagonalDown);
            this._parseBorder(sourceBorders.DiagonalUp, destBorders.DiagonalUp);
        };
        DocumentEditorHelper.prototype._parseCellFormat = function (sourceFormat, cellFormat) {
            if (sourceFormat.Borders != undefined && sourceFormat.Borders != null)
                this._parseBorders(sourceFormat.Borders, cellFormat.Borders);
            if (!sourceFormat.IsSamePaddingAsTable)
                this._parseCellMargin(sourceFormat, cellFormat);
            if (sourceFormat.CellWidth != undefined && sourceFormat.CellWidth != null)
                cellFormat.CellWidth = sourceFormat.CellWidth;
            if (sourceFormat.ColumnSpan != undefined && sourceFormat.ColumnSpan != null)
                cellFormat.ColumnSpan = sourceFormat.ColumnSpan;
            if (sourceFormat.RowSpan != undefined && sourceFormat.RowSpan != null)
                cellFormat.RowSpan = sourceFormat.RowSpan;
            if (sourceFormat.Shading != undefined && sourceFormat.Shading != null)
                this._parseShading(sourceFormat.Shading, cellFormat.Shading);
            if (sourceFormat.VerticalAlignment != undefined && sourceFormat.VerticalAlignment != null)
                cellFormat.VerticalAlignment = sourceFormat.VerticalAlignment;
            if (sourceFormat.PreferredWidthType != undefined && sourceFormat.PreferredWidthType != null)
                cellFormat.PrefferedWidthType = sourceFormat.PreferredWidthType;
            if (sourceFormat.PreferredWidth != undefined && sourceFormat.PreferredWidth != null)
                cellFormat.PrefferedWidth = sourceFormat.PreferredWidth;
        };
        DocumentEditorHelper.prototype._parseCellMargin = function (sourceFormat, cellFormat) {
            if (sourceFormat.LeftMargin != undefined && sourceFormat.LeftMargin != null)
                cellFormat.LeftMargin = sourceFormat.LeftMargin;
            if (sourceFormat.RightMargin != undefined && sourceFormat.RightMargin != null)
                cellFormat.RightMargin = sourceFormat.RightMargin;
            if (sourceFormat.TopMargin != undefined && sourceFormat.TopMargin != null)
                cellFormat.TopMargin = sourceFormat.TopMargin;
            if (sourceFormat.BottomMargin != undefined && sourceFormat.BottomMargin != null)
                cellFormat.BottomMargin = sourceFormat.BottomMargin;
        };
        DocumentEditorHelper.prototype._parseRowFormat = function (sourceFormat, rowFormat) {
            if (sourceFormat.AllowBreakAcrossPages != undefined && sourceFormat.AllowBreakAcrossPages != null)
                rowFormat.AllowBreakAcrossPages = sourceFormat.AllowBreakAcrossPages;
            if (sourceFormat.IsHeader != undefined && sourceFormat.IsHeader != null)
                rowFormat.IsHeader = sourceFormat.IsHeader;
            if (sourceFormat.Height != undefined && sourceFormat.Height != null)
                rowFormat.Height = sourceFormat.Height;
            if (sourceFormat.HeightType != undefined && sourceFormat.HeightType != null)
                rowFormat.HeightType = sourceFormat.HeightType;
            if (sourceFormat.Borders != undefined && sourceFormat.Borders != null)
                this._parseBorders(sourceFormat.Borders, rowFormat.Borders);
        };
        DocumentEditorHelper.prototype._parseAbstractList = function (data, documentAdv) {
            for (var i = 0; i < data.AbstractLists.length; i++) {
                var abstractListAdv = new AbstractListAdv(null);
                documentAdv.AbstractLists._Push(abstractListAdv);
                abstractListAdv.AbstractListId = data.AbstractLists[i].AbstractListId;
                abstractListAdv.Name = data.AbstractLists[i].Name;
                abstractListAdv.ListType = data.AbstractLists[i].ListType;
                for (var j = 0; j < data.AbstractLists[i].Levels.length; j++) {
                    var listLevelAdv = this._parseListLevel(data.AbstractLists[i].Levels[j]);
                    abstractListAdv.Levels._Push(listLevelAdv);
                }
            }
        };
        DocumentEditorHelper.prototype._parseList = function (data, documentAdv) {
            for (var i = 0; i < data.Lists.length; i++) {
                var listAdv = new ListAdv(null);
                listAdv.AbstractListId = data.Lists[i].AbstractListId;
                documentAdv.Lists._Push(listAdv);
                listAdv.ListId = documentAdv.Lists.length - 1;
                if (data.Lists[i].hasOwnProperty("LevelOverrides"))
                    this._parseLevelOverride(data.Lists[i].LevelOverrides, listAdv);
            }
        };
        DocumentEditorHelper.prototype._parseLevelOverride = function (data, listAdv) {
            if (data == null || data == undefined)
                return;
            for (var i = 0; i < data.length; i++) {
                var levelOverrideAdv = new LevelOverrideAdv(null);
                var levelOverride = data[i];
                levelOverrideAdv.StartAt = levelOverride.StartAt;
                levelOverrideAdv.LevelNumber = levelOverride.LevelNumber;
                if (data[i].OverrideListLevel != null)
                    levelOverrideAdv.OverrideListLevel = this._parseListLevel(levelOverride.OverrideListLevel);
                listAdv.LevelOverrides._Push(levelOverrideAdv);
            }
        };
        DocumentEditorHelper.prototype._parseListLevel = function (data) {
            var listLevelAdv = new ListLevelAdv(null);
            if (data.ListLevelPattern == ListLevelPattern.Bullet) {
                listLevelAdv.ListLevelPattern = ListLevelPattern.Bullet;
                listLevelAdv.NumberFormat = data.NumberFormat;
            }
            else {
                listLevelAdv.ListLevelPattern = data.ListLevelPattern;
                listLevelAdv.StartAt = data.StartAt;
                listLevelAdv.NumberFormat = data.NumberFormat;
                if (data.RestartLevel >= 0)
                    listLevelAdv.RestartLevel = data.RestartLevel;
                else
                    listLevelAdv.RestartLevel = data.LevelNumber;
            }
            listLevelAdv.FollowCharacter = data.FollowCharacter;
            this._parseListCharacterFormat(data.CharacterFormat, listLevelAdv.CharacterFormat);
            this._parseParagraphFormat(data.ParagraphFormat, listLevelAdv.ParagraphFormat);
            return listLevelAdv;
        };
        DocumentEditorHelper.prototype._OnShowCommentsChanged = function () {
            if (this.Document != null && this.IsDocumentLoaded) {
                this.viewer._ShowHideComments();
            }
        };
        DocumentEditorHelper.prototype._InsertText = function (text) {
            this.Selection._InsertText(text, false);
        };
        DocumentEditorHelper.prototype._InsertPicture = function (base64String, width, height) {
            var image = new ImageAdv(null, true, false);
            image.ImageString = base64String;
            image.Width = width;
            image.Height = height;
            this.Selection._InsertImage(image);
        };
        DocumentEditorHelper.prototype._Find = function (text, findoption) {
            this.textSearchResults._ClearResults();
            var pattern = HelperMethods._StringToRegex(text, findoption);
            if (this.Document == null || !this.isDocumentLoaded)
                return false;
            this.Document._Find(pattern, findoption, true, this.textSearchResults);
            if (this.textSearchResults.CurrentSearchResult != null) {
                this.textSearchResults.CurrentSearchResult._Navigate();
                return true;
            }
            return false;
        };
        DocumentEditorHelper.prototype._FindAll = function (text, findOption) {
            this.textSearchResults._ClearResults();
            var pattern = HelperMethods._StringToRegex(text, findOption);
            if (this.Document == null || !this.IsDocumentLoaded)
                return;
            this.Document._Find(pattern, findOption, false, this.textSearchResults);
            if (this.textSearchResults.CurrentIndex < 0 && this.textSearchResults.Count > 0)
                this.textSearchResults.CurrentIndex = 0;
            if (this.textSearchResults.CurrentSearchResult != null) {
                this.textSearchResults.CurrentSearchResult._Navigate();
                return this.textSearchResults;
            }
            return null;
        };
        DocumentEditorHelper.prototype._Replace = function (text, findOption, textToReplace) {
            var count = 0;
            if ((text == "" && text == undefined && text == null) || (textToReplace == "" && textToReplace == undefined && textToReplace == null))
                return false;
            this._Find(text, findOption);
            if (this.textSearchResults.Count > 0 && this.textSearchResults.CurrentSearchResult != null) {
                count = this.textSearchResults.CurrentSearchResult._Replace(textToReplace);
                return (count == 1) ? true : false;
            }
            return false;
        };
        DocumentEditorHelper.prototype._ReplaceAll = function (text, findOption, textToReplace) {
            if ((text == "" && text == undefined && text == null) || (textToReplace == "" && textToReplace == undefined && textToReplace == null))
                return 0;
            this._FindAll(text, findOption);
            if (this.textSearchResults.Count > 0)
                return this.textSearchResults._ReplaceAll(textToReplace);
            return 0;
        };
        DocumentEditorHelper.prototype._InsertTableInBlocks = function (rowCount, columnCount) {
            if (rowCount == 0 || columnCount == 0)
                return;
            var table = new TableAdv(null);
            table._CreateTable(rowCount, columnCount);
            this.Selection._InsertTable(table);
        };
        DocumentEditorHelper.prototype._InsertRowInTable = function (rowPlacement) {
            this.Selection._InsertRow(rowPlacement);
        };
        DocumentEditorHelper.prototype._InsertColumnInTable = function (columnPlacement) {
            this.Selection._InsertColumn(columnPlacement);
        };
        DocumentEditorHelper.prototype._DeleteTableFromBlocks = function () {
            this.Selection._DeleteTable();
        };
        DocumentEditorHelper.prototype._DeleteColumnFromTable = function () {
            this.Selection._DeleteColumn();
        };
        DocumentEditorHelper.prototype._DeleteRowFromTable = function () {
            this.Selection._DeleteRow();
        };
        DocumentEditorHelper.PropertyUnsetValue = "UnsetValue";
        return DocumentEditorHelper;
    }());
    DocumentEditorFeatures.DocumentEditorHelper = DocumentEditorHelper;
    var MathHelper = (function () {
        function MathHelper() {
        }
        MathHelper._Round = function (value, decimalDigits) {
            var temp = value;
            for (var i = 0; i < decimalDigits; i++) {
                temp = temp * 10;
            }
            temp = Math.round(temp);
            for (var i = 0; i < decimalDigits; i++) {
                temp = temp / 10;
            }
            return temp;
        };
        return MathHelper;
    }());
    DocumentEditorFeatures.MathHelper = MathHelper;
    var TextHelper = (function () {
        function TextHelper() {
        }
        Object.defineProperty(TextHelper, "ParagraphMark", {
            get: function () {
                return "¶";
            },
            enumerable: true,
            configurable: true
        });
        TextHelper._GetParagraphMarkSize = function (characterFormat) {
            var width = TextHelper._GetWidth(this.ParagraphMark, characterFormat);
            var height = 0;
            var baselineOffset = 0;
            var textHelper = TextHelper._GetHeight(characterFormat);
            return {
                "Width": width, "Height": textHelper.Height, "BaselineOffset": textHelper.BaselineOffset
            };
        };
        TextHelper._GetTextSize = function (elementBox, characterFormat) {
            elementBox.Width = TextHelper._GetWidth(elementBox.Text, characterFormat);
            var textHelper = TextHelper._GetHeight(characterFormat);
            elementBox.Height = textHelper.Height;
            elementBox.BaselineOffset = textHelper.BaselineOffset;
        };
        TextHelper._UpdateTextSize = function (elementBox) {
            var listCharacterFormat = elementBox.ListLevel.CharacterFormat;
            var breakCharacterFormat = elementBox.Paragraph.CharacterFormat;
            listCharacterFormat.FontSize = listCharacterFormat.FontSize == 11 ? breakCharacterFormat.FontSize : listCharacterFormat.FontSize;
            listCharacterFormat.FontFamily = listCharacterFormat.FontFamily == "verdana" ? breakCharacterFormat.FontFamily : listCharacterFormat.FontFamily;
            elementBox.Width = TextHelper._GetWidth(elementBox.Text, listCharacterFormat);
            var textHelper = TextHelper._GetHeight(listCharacterFormat);
            elementBox.Height = textHelper.Height;
            elementBox.BaselineOffset = textHelper.BaselineOffset;
        };
        TextHelper._MeasureText = function (text, characterFormat) {
            var width = TextHelper._GetWidth(text, characterFormat);
            var height = 0;
            var baselineOffset = 0;
            var textHelper = TextHelper._GetHeight(characterFormat);
            return {
                "Width": width, "Height": textHelper.Height, "BaselineOffset": textHelper.BaselineOffset
            };
        };
        TextHelper._MeasureTextExcludIngSpaceAtEnd = function (text, characterFormat) {
            var width = TextHelper._GetWidth(text.replace(/\s\s*$/, ''), characterFormat);
            var height = 0;
            var baselineOffset = 0;
            var textHelper = TextHelper._GetHeight(characterFormat);
            return {
                "Width": width, "Height": textHelper.Height, "BaselineOffset": textHelper.BaselineOffset
            };
        };
        TextHelper._GetHeight = function (characterFormat) {
            var textHeight = 0;
            var baselineOffset = 0;
            var spanElement = document.createElement("span");
            spanElement.id = "tempSpan";
            spanElement.style.whiteSpace = "nowrap";
            spanElement.innerText = "m";
            TextHelper._ApplyStyle(spanElement, characterFormat);
            var body = document.getElementsByTagName("body");
            if (body != null && body.length > 0) {
                var parentDiv = document.createElement("div");
                parentDiv.style.display = "inline-block";
                var tempDiv = document.createElement("div");
                tempDiv.setAttribute("style", "display:inline-block;width: 1px; height: 0px;vertical-align: baseline;");
                parentDiv.appendChild(spanElement);
                parentDiv.appendChild(tempDiv);
                document.body.appendChild(parentDiv);
                textHeight = spanElement.getBoundingClientRect().height;
                var textTopVal = spanElement.getBoundingClientRect().top;
                var tempDivTopVal = tempDiv.getBoundingClientRect().top;
                baselineOffset = tempDivTopVal - textTopVal;
                document.body.removeChild(parentDiv);
            }
            return { "Height": textHeight, "BaselineOffset": baselineOffset };
        };
        TextHelper._GetWidth = function (text, characterFormat) {
            var canvas = document.createElement("canvas");
            var context = canvas.getContext("2d");
            var bold = "";
            var italic = "";
            var fontFamily = "";
            var fontSize = 11;
            bold = characterFormat.Bold ? "bold" : "";
            italic = characterFormat.Italic ? "italic" : "";
            fontFamily = characterFormat.FontFamily;
            fontSize = characterFormat.FontSize == 0 ? 0.5 : characterFormat.FontSize / (characterFormat.BaselineAlignment == BaselineAlignment.Normal ? 1 : 1.5);
            context.font = bold + " " + italic + " " + fontSize + "px" + " " + fontFamily;
            return context.measureText(text).width;
        };
        TextHelper._ApplyStyle = function (spanElement, characterFormat) {
            if (spanElement != undefined && spanElement != null && characterFormat != undefined && characterFormat != null) {
                if (characterFormat.Bold)
                    spanElement.style.fontWeight = "bold";
                if (characterFormat.Italic)
                    spanElement.style.fontStyle = "italic";
                if (characterFormat.FontFamily != "")
                    spanElement.style.fontFamily = characterFormat.FontFamily;
                var fontSize = characterFormat.FontSize;
                if (fontSize <= 0.5)
                    fontSize = 0.5;
                spanElement.style.fontSize = fontSize.toString() + "px";
            }
        };
        return TextHelper;
    }());
    DocumentEditorFeatures.TextHelper = TextHelper;
    var HelperMethods = (function () {
        function HelperMethods() {
        }
        HelperMethods._StringToRegex = function (textToFind, option) {
            if (option == FindOptions.WholeWord || option == FindOptions.CaseSensitiveWholeWord) {
                textToFind = this.WORD_BEFORE + textToFind + this.WORD_AFTER;
            }
            return new RegExp(textToFind, (option == FindOptions.CaseSensitive || option == FindOptions.CaseSensitiveWholeWord) ? 'g' : 'ig');
        };
        HelperMethods._IsPatternEmpty = function (pattern) {
            var wordEmpty = this.WORD_BEFORE + this.WORD_AFTER;
            var patternRegExp = pattern.toString();
            return (patternRegExp.length == 0 || patternRegExp == wordEmpty);
        };
        HelperMethods._AddCssStyle = function (css) {
            var style = document.createElement('style');
            if (style.style.cssText) {
                style.style.cssText = css;
            }
            else {
                style.appendChild(document.createTextNode(css));
            }
            document.getElementsByTagName('head')[0].appendChild(style);
        };
        HelperMethods._IsVeryDark = function (backColor) {
            backColor = backColor.substring(1);
            var r = parseInt(backColor.substr(0, 2), 16);
            var g = parseInt(backColor.substr(2, 2), 16);
            var b = parseInt(backColor.substr(4, 2), 16);
            var contrast = ((r * 299) + (g * 587) + (b * 114)) / 1000;
            return contrast <= 60;
        };
        HelperMethods._GetHighlightColorCode = function (highlightColor) {
            var color = "#ffffff";
            switch (highlightColor) {
                case HighlightColor.Yellow:
                    color = "#ffff00";
                    break;
                case HighlightColor.BrightGreen:
                    color = "#00ff00";
                    break;
                case HighlightColor.Turquoise:
                    color = "#00ffff";
                    break;
                case HighlightColor.Pink:
                    color = "#ff00ff";
                    break;
                case HighlightColor.Blue:
                    color = "#0000ff";
                    break;
                case HighlightColor.Red:
                    color = "#ff0000";
                    break;
                case HighlightColor.DarkBlue:
                    color = "#000080";
                    break;
                case HighlightColor.Teal:
                    color = "#008080";
                    break;
                case HighlightColor.Green:
                    color = "#008000";
                    break;
                case HighlightColor.Violet:
                    color = "#800080";
                    break;
                case HighlightColor.DarkRed:
                    color = "#800000";
                    break;
                case HighlightColor.DarkYellow:
                    color = "#808000";
                    break;
                case HighlightColor.Gray50:
                    color = "#808080";
                    break;
                case HighlightColor.Gray25:
                    color = "#c0c0c0";
                    break;
                case HighlightColor.Black:
                    color = "#000000";
                    break;
            }
            return color;
        };
        HelperMethods._IndexOfAny = function (txt, WordSplitCharacter) {
            var index = undefined;
            for (var j = 0; j < WordSplitCharacter.length; j++) {
                var temp = txt.indexOf(WordSplitCharacter[j]);
                if (temp != -1 && index == undefined)
                    index = temp;
                else if (temp != -1 && temp < index) {
                    index = temp;
                }
            }
            return index == undefined ? -1 : index;
        };
        HelperMethods._LastIndexOfAny = function (txt, WordSplitCharacter) {
            for (var i = txt.length - 1; i >= 0; i--) {
                for (var j = 0; j <= WordSplitCharacter.length - 1; j++) {
                    if (txt[i] == WordSplitCharacter[j])
                        return i;
                }
            }
            return -1;
        };
        HelperMethods._GetHtmlTextAlign = function (alignment) {
            switch (alignment) {
                case TextAlignment.Center:
                    return "center";
                case TextAlignment.Right:
                    return "right";
                case TextAlignment.Justify:
                    return "justify";
                default:
                    return "left";
            }
        };
        HelperMethods._Insert = function (Text, index, text) {
            if (index >= 0) {
                var string = [Text.slice(0, index) + text + Text.slice(index)].join('');
                return string;
            }
            else
                return text + this;
        };
        HelperMethods._Remove = function (Text, index, length) {
            if (index == 0) {
                return Text.substring(index + 1, Text.length);
            }
            else
                return Text.substring(0, index) + Text.substring(index + 1, Text.length);
        };
        HelperMethods._GetText = function (start, end) {
            return this._GetTextInternal(start, end, false);
        };
        HelperMethods._GetTextInternal = function (start, end, includeObject) {
            if (start != null && end != null && start.Paragraph != null && end.Paragraph != null) {
                if (start._IsAtSamePosition(end))
                    return "";
                if (start._IsExistAfter(end)) {
                    var temp = end;
                    end = start;
                    start = temp;
                }
                var startIndex = 0;
                var endIndex = 0;
                var startInlineObj = start.Paragraph._GetInline(start.Offset, startIndex);
                startIndex = startInlineObj.index;
                var inline = startInlineObj.inline;
                if (inline instanceof FieldBeginAdv && inline.fieldEnd != null) {
                    if (inline.fieldSeparator != null)
                        inline = inline.fieldSeparator;
                    else
                        inline = inline.fieldEnd;
                    startIndex = 0;
                }
                var endInlineObj = end.Paragraph._GetInline(end.Offset, endIndex);
                var endInline = endInlineObj.inline;
                endIndex = endInlineObj.index;
                var text = "";
                if (inline instanceof ImageAdv && includeObject && startIndex == 0)
                    text = Inline.OBJECT_CHARACTER.toString();
                else if (inline instanceof SpanAdv)
                    text = (inline.Text) == null && (inline.Text) == "" || inline.Text.length < startIndex ? text : inline.Text.substring(startIndex);
                if (start.Paragraph == end.Paragraph) {
                    if (inline instanceof Inline) {
                        if (inline == endInline && inline instanceof SpanAdv)
                            text = text.length < endIndex - startIndex ? text : text.substring(0, endIndex - startIndex);
                        else if (inline.NextNode instanceof Inline)
                            text = text + inline.NextNode._GetText(end.Paragraph, endInline, endIndex, includeObject);
                    }
                }
                else {
                    if (inline instanceof Inline && inline.NextNode instanceof Inline)
                        text = text + inline.NextNode._GetText(end.Paragraph, null, 0, includeObject);
                    else {
                        var nextParagraph = start.Paragraph._GetNextParagraph();
                        text = text + "\r";
                        while (nextParagraph != null && nextParagraph._IsEmpty()) {
                            text = text + "\r";
                            if (nextParagraph == end.Paragraph)
                                return text;
                            nextParagraph = nextParagraph._GetNextParagraph();
                        }
                        if (nextParagraph != null && !nextParagraph._IsEmpty())
                            text = text + nextParagraph.Inlines[0]._GetText(end.Paragraph, endInline, endIndex, includeObject);
                    }
                }
                if (end.Offset == end.Paragraph._GetEndOffset() + 1)
                    text = text + "\r";
                return text;
            }
            return null;
        };
        HelperMethods._GetDefaultImageString = function () {
            return "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAIAAAADnC86AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAADQSURBVFhH7ZbRDYQgDIYZ5UZhFEdxlBuFUUhY4N7vwWtTURJz5tem8GAbTYS0/eGjWsN7hJVSAuku3c2FuyF31BvqBNu90/mLmnSRjKDbMZULt2csz/kV8hRbVjSkSZkxRC0yKcbl+6FLhttSDIV5W6vYnKeZVWkR1WyFGbhIHrAbCzPhEcL1XCvqptYMd7xXExUXM4+pT3ENe53OP5yGqJ8kDDZGpIld6E730uFR/uuDs1J6OmolQDzcUeOslJ6OWgkQD3fUOCulJ6Ome4j9AGEu0k90WN54AAAAAElFTkSuQmCC";
        };
        HelperMethods.WORD_BEFORE = "\\b";
        HelperMethods.WORD_AFTER = "\\b";
        return HelperMethods;
    }());
    DocumentEditorFeatures.HelperMethods = HelperMethods;
    var CssConstants = (function () {
        function CssConstants() {
        }
        Object.defineProperty(CssConstants, "Maroon", {
            get: function () { return "maroon"; },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(CssConstants, "Red", {
            get: function () { return "red"; },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(CssConstants, "Orange", {
            get: function () { return "orange"; },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(CssConstants, "Yellow", {
            get: function () { return "yellow"; },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(CssConstants, "Olive", {
            get: function () { return "olive"; },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(CssConstants, "Fuchsia", {
            get: function () { return "fuchsia"; },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(CssConstants, "Lime", {
            get: function () { return "lime"; },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(CssConstants, "White", {
            get: function () { return "white"; },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(CssConstants, "Green", {
            get: function () { return "green"; },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(CssConstants, "Navy", {
            get: function () { return "navy"; },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(CssConstants, "Blue", {
            get: function () { return "blue"; },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(CssConstants, "Aqua", {
            get: function () { return "aqua"; },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(CssConstants, "Teal", {
            get: function () { return "teal"; },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(CssConstants, "Black", {
            get: function () { return "black"; },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(CssConstants, "Silver", {
            get: function () { return "silver"; },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(CssConstants, "Gray", {
            get: function () { return "gray"; },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(CssConstants, "Purple", {
            get: function () { return "purple"; },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(CssConstants, "XXSmall", {
            get: function () { return "xx-small"; },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(CssConstants, "XSmall", {
            get: function () { return "x-small"; },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(CssConstants, "Medium", {
            get: function () { return "medium"; },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(CssConstants, "XLarge", {
            get: function () { return "x-large"; },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(CssConstants, "XXLarge", {
            get: function () { return "xx-large"; },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(CssConstants, "Small", {
            get: function () { return "small"; },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(CssConstants, "Smaller", {
            get: function () { return "smaller"; },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(CssConstants, "Larger", {
            get: function () { return "bigger"; },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(CssConstants, "Large", {
            get: function () { return "large"; },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(CssConstants, "Underline", {
            get: function () { return "underline"; },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(CssConstants, "LineThrough", {
            get: function () { return "line-through"; },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(CssConstants, "LineHeight", {
            get: function () { return "line-height"; },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(CssConstants, "SubScript", {
            get: function () { return "sub"; },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(CssConstants, "SuperScript", {
            get: function () { return "super"; },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(CssConstants, "Font", {
            get: function () { return "font"; },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(CssConstants, "LeftIndent", {
            get: function () { return "left-indent"; },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(CssConstants, "TextIndent", {
            get: function () { return "text-indent"; },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(CssConstants, "FontFamily", {
            get: function () { return "font-family"; },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(CssConstants, "FontSize", {
            get: function () { return "font-size"; },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(CssConstants, "FontStyle", {
            get: function () { return "font-style"; },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(CssConstants, "FontWeight", {
            get: function () { return "font-weight"; },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(CssConstants, "TextDecoration", {
            get: function () { return "text-decoration"; },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(CssConstants, "TextAlign", {
            get: function () { return "text-align"; },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(CssConstants, "SubSuperScripts", {
            get: function () { return "vertical-align"; },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(CssConstants, "Background", {
            get: function () { return "background-color"; },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(CssConstants, "Color", {
            get: function () { return "color"; },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(CssConstants, "HyperlinkColor", {
            get: function () { return "hyperlinkcolor"; },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(CssConstants, "Baseline", {
            get: function () { return "baseline"; },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(CssConstants, "ListType", {
            get: function () { return "listType"; },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(CssConstants, "Margin", {
            get: function () { return "margin"; },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(CssConstants, "Border", {
            get: function () { return "border"; },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(CssConstants, "BgColor", {
            get: function () { return "bgcolor"; },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(CssConstants, "Align", {
            get: function () { return "align"; },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(CssConstants, "Cm", {
            get: function () { return "cm"; },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(CssConstants, "Mm", {
            get: function () { return "mm"; },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(CssConstants, "Px", {
            get: function () { return "px"; },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(CssConstants, "In", {
            get: function () { return "in"; },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(CssConstants, "Ex", {
            get: function () { return "ex"; },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(CssConstants, "Em", {
            get: function () { return "em"; },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(CssConstants, "Pt", {
            get: function () { return "pt"; },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(CssConstants, "Pc", {
            get: function () { return "pc"; },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(CssConstants, "Percentage", {
            get: function () { return "%"; },
            enumerable: true,
            configurable: true
        });
        return CssConstants;
    }());
    DocumentEditorFeatures.CssConstants = CssConstants;
    var HTMLOperators = (function () {
        function HTMLOperators() {
        }
        Object.defineProperty(HTMLOperators, "Dot", {
            get: function () { return "."; },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(HTMLOperators, "OpenBrace", {
            get: function () { return "{"; },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(HTMLOperators, "CloseBrace", {
            get: function () { return "}"; },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(HTMLOperators, "Colon", {
            get: function () { return ":"; },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(HTMLOperators, "SemiColon", {
            get: function () { return ";"; },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(HTMLOperators, "Equal", {
            get: function () { return "="; },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(HTMLOperators, "Quotes", {
            get: function () { return "\""; },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(HTMLOperators, "LessthanSymbol", {
            get: function () { return "<"; },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(HTMLOperators, "GreaterthanSymbol", {
            get: function () { return ">"; },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(HTMLOperators, "Endslash", {
            get: function () { return "/"; },
            enumerable: true,
            configurable: true
        });
        return HTMLOperators;
    }());
    DocumentEditorFeatures.HTMLOperators = HTMLOperators;
    var HtmlAsciiCodesInfo = (function () {
        function HtmlAsciiCodesInfo() {
        }
        Object.defineProperty(HtmlAsciiCodesInfo, "HtmlAsciiCodeTable", {
            get: function () {
                if (HtmlAsciiCodesInfo.htmlAsciiCodeTable == null) {
                    HtmlAsciiCodesInfo.htmlAsciiCodeTable = new Dictionary();
                    HtmlAsciiCodesInfo.htmlNameTable = new Dictionary();
                    HtmlAsciiCodesInfo._AddHtmlAsciiSymbols();
                    HtmlAsciiCodesInfo._AddHtmlNames();
                }
                return HtmlAsciiCodesInfo.htmlAsciiCodeTable;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(HtmlAsciiCodesInfo, "HtmlNameTable", {
            get: function () {
                if (HtmlAsciiCodesInfo.htmlNameTable == null) {
                    HtmlAsciiCodesInfo.htmlAsciiCodeTable = new Dictionary();
                    HtmlAsciiCodesInfo.htmlNameTable = new Dictionary();
                    HtmlAsciiCodesInfo._AddHtmlAsciiSymbols();
                    HtmlAsciiCodesInfo._AddHtmlNames();
                }
                return HtmlAsciiCodesInfo.htmlNameTable;
            },
            enumerable: true,
            configurable: true
        });
        HtmlAsciiCodesInfo._AddHtmlAsciiSymbols = function () {
            var HtmlCodeSymbols = new Array();
            HtmlCodeSymbols = [" ", "\"\"", "!", "#", "$", "%", "&", "'", "(", ")", "*", " +", ", ", " - ", ".", "/ ", "0", "1", "2", "3", "4", "5", "6", "7", "8", "9", ":", ";", " < ", "=", " > ", " ? ", "@",
                "A", "B", "C", "D", "E", "F", "G", "H", "I", "J", "K", "L", "M", "N", "O", "P", "Q", "R", "S", "T", "U", "V", "W", "X", "Y", "Z", "[", "\"", "]", "^", "_", "`",
                "a", "b", "c", "d", "e", "f", "g", "h", "i", "j", "k", "l", "m", "n", "o", "p", "q", "r", "s", "t", "u", "v", "w", "x", "y", "z", "{", "|", "}", "~", " ", "¡", "¢", "£", "¤",
                "¥", "¦", "§", "¨", "©", "ª", "«", "¬", "", "­®", "¯", "°", "±", "²", "³", "´", "µ", "¶", "•", "¸", "¹", "º", "»", "¼", "½", "¾", "¿", "À", "Á", "Â", "Ã", "Ä", "Å", "Æ",
                "Ç", "È", "É", "Ê", "Ë", "Ì", "Í", "Î", "Ï", "Ð", "Ñ", "Ò", "Ó", "Ô", "Õ", "Ö", "×", "Ø", "Ù", "Ú", "Û", "Ü", "Ý", "Þ", "ß", "à", "á", "â", "ã", "ä", "å", "æ", "ç", "è",
                "é", "ê", "ë", "ì", "í", "î", "ï", "ð", "ñ", "ò", "ó", "ô", "õ", "ö", "÷", "ø", "ù", "ú", "û", "ü", "ý", "þ", "ÿ", "Œ", "œ", "Š", "š", "Ÿ", "ƒ", "–", "—", "‘", "’", "‚",
                "“", "”", "„", "†", "‡", "•", "…", "‰", "€", "™"];
            var j = -1;
            for (var i = 32; i <= 8482; i++) {
                if ((i > 126 && i < 160) || (i > 255 && i < 338) || (i > 339 && i < 352) || (i > 353 && i < 376) || (i > 376 && i < 402) || (i > 402 && i < 8211) || (i > 8212 && i < 8216)
                    || i == 8219 || i == 8223 || (i > 8226 && i < 8230) || (i > 8230 && i < 8240) || (i > 8240 && i < 8364) || (i > 8364 && i < 8482))
                    continue;
                else {
                    j++;
                    if (j < HtmlCodeSymbols.length)
                        HtmlAsciiCodesInfo.HtmlAsciiCodeTable._Add("&#" + i + ";", HtmlCodeSymbols[j]);
                }
            }
        };
        HtmlAsciiCodesInfo._AddHtmlNames = function () {
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&nbsp;", " ");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&emsp;", "\t");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&#160;", " ");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&lt;", "<");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&gt;", ">");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&amp;", "&");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&quot;", "\"");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&iexcl;", "¡");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&cent;", "¢");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&pound;", "£");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&curren;", "¤");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&yen;", "¥");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&brvbar;", "¦");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&sect;", "§");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&uml;", "¨");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&copy;", "©");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&ordf;", "ª");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&laquo;", "«");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&not;", "¬");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&reg;", "­®");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&macr;", "¯");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&deg;", "°");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&plusmn;", "±");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&sup2;", "²");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&sup3;", "³");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&acute;", "´");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&micro;", "µ");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&para;", "¶");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&middot;", "·");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&cedil;", "¸");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&sup1;", "¹");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&ordm;", "º");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&raquo;", "»");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&frac14;", "¼");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&frac12;", "½");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&frac34;", "¾");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&iquest;", "¿");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&Agrave;", "À");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&Aacute;", "Á");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&Acirc;", "Â");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&Atilde;", "Ã");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&Auml;", "Ä");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&Aring;", "Å");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&AElig;", "Æ");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&Ccedil;", "Ç");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&Egrave;", "È");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&Eacute;", "É");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&Ecirc;", "Ê");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&Euml;", "Ë");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&Igrave;", "Ì");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&Iacute;", "Í");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&Icirc;", "Î");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&Iuml;", "Ï");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&ETH;", "Ð");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&Ntilde;", "Ñ");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&Ograve;", "Ò");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&Oacute;", "Ó");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&Ocirc;", "Ô");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&Otilde;", "Õ");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&Ouml;", "Ö");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&times;", "×");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&Oslash;", "Ø");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&Ugrave;", "Ù");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&Uacute;", "Ú");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&Ucirc;", "Û");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&Uuml;", "Ü");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&Yacute;", "Ý");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&THORN;", "Þ");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&szlig;", "ß");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&agrave;", "à");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&aacute;", "á");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&acirc;", "â");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&atilde;", "ã");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&auml;", "ä");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&aring;", "å");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&aelig;", "æ");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&ccedil;", "ç");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&egrave;", "è");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&eacute;", "é");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&ecirc;", "ê");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&euml;", "ë");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&igrave;", "ì");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&iacute;", "í");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&icirc;", "î");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&iuml;", "ï");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&eth;", "ð");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&ntilde;", "ñ");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&ograve;", "ò");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&oacute;", "ó");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&ocirc;", "ô");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&otilde;", "õ");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&ouml;", "ö");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&divide;", "÷");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&oslash;", "ø");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&ugrave;", "ù");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&uacute;", "ú");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&ucirc;", "û");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&uuml;", "ü");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&yacute;", "ý");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&thorn;", "þ");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&yuml;", "ÿ");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&OElig;", "Œ");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&oelig;", "œ");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&Scaron;", "Š");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&scaron;", "š");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&Yuml;", "Ÿ");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&fnof;", "ƒ");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&ndash;", "–");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&mdash;", "—");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&lsquo;", "‘");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&rsquo;", "’");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&ldquo;", "“");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&rdquo;", "”");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&bdquo;", "„");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&dagger;", "†");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&ddagger;", "‡");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&bullet;", "•");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&hellip;", "…");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&permil;", "‰");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&trade;", "™");
            HtmlAsciiCodesInfo.HtmlNameTable._Add("&euro;", "€");
        };
        HtmlAsciiCodesInfo.htmlAsciiCodeTable = null;
        HtmlAsciiCodesInfo.htmlNameTable = null;
        return HtmlAsciiCodesInfo;
    }());
    DocumentEditorFeatures.HtmlAsciiCodesInfo = HtmlAsciiCodesInfo;
    var TextSearchResult = (function () {
        function TextSearchResult(node) {
            this.start = null;
            this.end = null;
            this.ownerControl = null;
            this.ownerControl = node;
            this.start = new TextPosition(this.ownerControl);
            this.end = new TextPosition(this.ownerControl);
        }
        Object.defineProperty(TextSearchResult.prototype, "Start", {
            get: function () {
                return this.start;
            },
            set: function (value) {
                this.start = value;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(TextSearchResult.prototype, "End", {
            get: function () {
                return this.end;
            },
            set: function (value) {
                this.end = value;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(TextSearchResult.prototype, "OwnerControl", {
            get: function () {
                return this.ownerControl;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(TextSearchResult.prototype, "Text", {
            get: function () {
                return HelperMethods._GetText(this.Start, this.End);
            },
            enumerable: true,
            configurable: true
        });
        TextSearchResult.prototype._Navigate = function () {
            if (this.OwnerControl != null && this.OwnerControl.Selection != null && this.Start != null && this.End != null && this.Start.Paragraph != null && this.End.Paragraph != null)
                this.OwnerControl.Selection._SelectRange(this.Start, this.End, true);
        };
        TextSearchResult.prototype._Highlight = function () {
            this.Start.Paragraph._HighlightSearchResult(this, this.Start, this.End);
        };
        TextSearchResult.prototype._CreateHighlightBorder = function (lineWidget, width, left, top) {
            var comment = null;
            if (this.start.Paragraph._IsInComment())
                comment = this.start.Paragraph._GetOwnerComment();
            var findHighLight = this.OwnerControl.Viewer._AddSearchHighlightBorder(lineWidget);
            var page = (this instanceof FlowLayoutViewer) ? this.OwnerControl.Viewer.CurrentPage : lineWidget.CurrentParagraphWidget._GetPage();
            if (comment != null && comment.LayoutedWidget != null && comment.LayoutedWidget.RenderedElement != null) {
                findHighLight.Left = Math.ceil(left) + comment.LayoutedWidget.X;
                top = Math.ceil(top) + comment.LayoutedWidget.Y;
            }
            else {
                findHighLight.Left = Math.ceil(left);
                top = Math.ceil(top);
            }
            findHighLight.Width = Math.floor(width);
            var height = Math.floor(lineWidget.Height);
            var backgroundContainer = document.getElementById(page.Id + "_background");
            if (backgroundContainer != null) {
                var context = backgroundContainer.getContext("2d");
                context.fillStyle = "#ffe97f";
                context.fillRect(findHighLight.Left, top, findHighLight.Width, height);
            }
        };
        TextSearchResult.prototype._AddFindResultView = function () {
            if (this.start != null && this.end != null && this.start.Paragraph != null && this.end.Paragraph != null) {
                var prefixText = void 0;
                var suffixtext = void 0;
                var currentText = void 0;
                var startIndex = 0;
                var inlineObj = this.start.Paragraph._GetInline(this.start.Offset, startIndex);
                var inline = inlineObj.inline;
                startIndex = inlineObj.index;
                var prefix = "";
                var lastIndex = 0;
                var boxObj = inline._GetElementBoxInternal(startIndex);
                var box = boxObj.element;
                startIndex = boxObj.index;
                if (box != null) {
                    if (box instanceof TextElementBox && startIndex > 0)
                        prefix = box.Text.substring(0, startIndex);
                    var boxIndex = box.CurrentLineWidget.Children._IndexOf(box);
                    while ((lastIndex = prefix.lastIndexOf(" ")) < 0 && boxIndex > 0 && box.CurrentLineWidget.Children[boxIndex - 1] instanceof TextElementBox) {
                        prefix = box.CurrentLineWidget.Children[boxIndex - 1].Text + prefix;
                        boxIndex--;
                    }
                }
                lastIndex = prefix.lastIndexOf(" ");
                prefixText = lastIndex < 0 ? prefix : prefix.substring(lastIndex + 1);
                currentText = this.Text;
                var endIndex = 0;
                var endInlineObj = this.end.Paragraph._GetInline(this.end.Offset, endIndex);
                var endInline = endInlineObj.inline;
                endIndex = endInlineObj.index;
                suffixtext = "";
                if (boxObj != null) {
                    boxObj = endInline._GetElementBoxInternal(endIndex);
                    box = boxObj.element;
                    endIndex = boxObj.index;
                }
                if (box != null) {
                    if (box instanceof TextElementBox && endIndex < box.Length)
                        suffixtext = box.Text.substring(endIndex);
                    var boxIndex = box.CurrentLineWidget.Children._IndexOf(box);
                    while (boxIndex + 1 < box.CurrentLineWidget.Children.Count && box.CurrentLineWidget.Children[boxIndex + 1] instanceof TextElementBox) {
                        suffixtext = suffixtext + box.CurrentLineWidget.Children[boxIndex + 1].Text;
                        boxIndex++;
                    }
                }
                lastIndex = suffixtext.lastIndexOf(" ");
                var listElement = "<li>" + prefix + "<b>" + this.Text + "</b>" + suffixtext + "</li>";
                this.ownerControl._AddSearchResultItems(listElement);
            }
        };
        TextSearchResult.prototype._Dispose = function () {
            if (this.Start != null) {
                this.start._Dispose();
                this.Start = null;
            }
            if (this.end != null) {
                this.end._Dispose();
                this.end = null;
            }
            this.ownerControl = null;
        };
        TextSearchResult.prototype._Replace = function (replaceText) {
            if (this.OwnerControl.Viewer != null)
                this.OwnerControl.Viewer._ClearSearchHighlight();
            this._Navigate();
            var endPosition = this.OwnerControl.Selection.Start;
            var index = this.OwnerControl.textSearchResults._IndexOf(this);
            if (index < 0)
                return 0;
            this.OwnerControl.Selection._InsertText(replaceText, true);
            var difference = this.End.Offset - (this.Start.Offset + replaceText.length);
            for (var j = index + 1; j < this.OwnerControl.textSearchResults.Count; j++) {
                var textsearchresult = this.OwnerControl.textSearchResults[j];
                if (this.end.Paragraph == textsearchresult.Start.Paragraph) {
                    textsearchresult.Start._SetPositionParagraph(textsearchresult.Start.Paragraph, textsearchresult.Start.Offset - difference);
                    if (textsearchresult.Start.Paragraph == textsearchresult.End.Paragraph)
                        textsearchresult.End._SetPositionParagraph(textsearchresult.End.Paragraph, textsearchresult.End.Offset - difference);
                    else
                        break;
                }
                else
                    break;
            }
            var startPosition = new TextPosition(this.OwnerControl);
            startPosition._SetPositionParagraph(endPosition.Paragraph, endPosition.Offset - replaceText.length);
            this.OwnerControl.Selection._SelectRange(endPosition, startPosition, true);
            this.OwnerControl.textSearchResults._Remove(this);
            return 1;
        };
        return TextSearchResult;
    }());
    DocumentEditorFeatures.TextSearchResult = TextSearchResult;
    var TextSearchResults = (function () {
        function TextSearchResults(documentHelper) {
            this.ownerControl = null;
            this.CurrentIndex = -1;
            this.ownerControl = documentHelper;
            this.innerList == new List();
        }
        Object.defineProperty(TextSearchResults.prototype, "OwnerControl", {
            get: function () {
                return this.ownerControl;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(TextSearchResults.prototype, "Count", {
            get: function () {
                if (this.innerList == null)
                    return 0;
                return this.innerList.Count;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(TextSearchResults.prototype, "CurrentSearchResult", {
            get: function () {
                if (this.innerList == null || this.CurrentIndex < 0 || this.CurrentIndex >= this.Count)
                    return null;
                return this.innerList[this.CurrentIndex];
            },
            enumerable: true,
            configurable: true
        });
        TextSearchResults.prototype._GetResult = function (index) {
            if (this.innerList == null)
                return null;
            return this.innerList[index];
        };
        TextSearchResults.prototype._AddResult = function () {
            var textSearchResult = new TextSearchResult(this.ownerControl);
            if (this.innerList == null)
                this.innerList = new List();
            this.innerList._Add(textSearchResult);
            return textSearchResult;
        };
        TextSearchResults.prototype._IndexOf = function (result) {
            if (this.innerList == null)
                return -1;
            return this.innerList._IndexOf(result);
        };
        TextSearchResults.prototype._ClearResults = function () {
            if (this.ownerControl.Viewer != null) {
                this.CurrentIndex = -1;
            }
            if (this.innerList != null)
                for (var i = this.innerList.Count - 1; i >= 0; i--) {
                    this.innerList[i]._Dispose();
                    this.innerList._RemoveAt(i);
                }
        };
        TextSearchResults.prototype._Highlight = function () {
            this.ownerControl.Viewer.SearchHighlighters = new Dictionary();
            for (var i = 0; i < this.innerList.Count; i++)
                this.innerList[i]._Highlight();
        };
        TextSearchResults.prototype._AddFindResultView = function () {
            for (var i = 0; i < this.innerList.Count; i++)
                this.innerList[i]._AddFindResultView();
        };
        TextSearchResults.prototype._Dispose = function () {
            if (this.innerList != null) {
                this._ClearResults();
                this.innerList = null;
            }
            this.ownerControl = null;
        };
        TextSearchResults.prototype._RemoveAt = function (index) {
            if (this.OwnerControl.Viewer != null)
                this.OwnerControl.Viewer._ClearSearchHighlight();
            if (this.Count > index) {
                this.innerList[index]._Dispose();
                this.innerList._RemoveAt(index);
            }
        };
        TextSearchResults.prototype._Remove = function (result) {
            if (this.OwnerControl.Viewer != null)
                this.OwnerControl.Viewer._ClearSearchHighlight();
            var index = this._IndexOf(result);
            result._Dispose();
            if (index >= 0)
                this.innerList._Remove(result);
        };
        TextSearchResults.prototype._ReplaceAll = function (replaceText) {
            if (this.OwnerControl == null)
                return 0;
            return this.OwnerControl.Selection._ReplaceAll(replaceText);
        };
        return TextSearchResults;
    }());
    DocumentEditorFeatures.TextSearchResults = TextSearchResults;
    var Stack = (function (_super) {
        __extends(Stack, _super);
        function Stack(count) {
            _super.call(this);
            this.arrayCount = count;
        }
        Object.defineProperty(Stack.prototype, "Count", {
            get: function () {
                if (this.length != undefined && this.length != null)
                    return this.length;
                return 0;
            },
            enumerable: true,
            configurable: true
        });
        Stack.prototype._Push = function (item) {
            if (true) {
                if (this.length < this.arrayCount)
                    _super.prototype.push.call(this, item);
                return item;
            }
        };
        Stack.prototype._Pop = function () {
            var item;
            if (true) {
                item = _super.prototype.pop.call(this);
                return item;
            }
        };
        Stack.prototype._Clear = function () {
            for (var i = 0; i < this.length; i++) {
                this._Pop();
            }
        };
        return Stack;
    }(Array));
    DocumentEditorFeatures.Stack = Stack;
    var List = (function (_super) {
        __extends(List, _super);
        function List() {
            _super.apply(this, arguments);
        }
        Object.defineProperty(List.prototype, "Count", {
            get: function () {
                if (this.length != undefined && this.length != null)
                    return this.length;
                return 0;
            },
            enumerable: true,
            configurable: true
        });
        List.prototype._Add = function (item) {
            if (true) {
                _super.prototype.push.call(this, item);
                return 1;
            }
        };
        List.prototype._Insert = function (index, item) {
            if (index == this.length) {
                this._Add(item);
                return;
            }
            if (index > -1 && index < this.length) {
                this._shiftItems(index, true);
                this[index] = item;
                this.length = this.length + 1;
            }
        };
        List.prototype._Remove = function (item) {
            var index = this.indexOf(item);
            if (index > -1 && index < this.length) {
                this._shiftItems(index, false);
                _super.prototype.pop.call(this);
                return true;
            }
            return false;
        };
        List.prototype._RemoveAt = function (index) {
            if (index > -1 && index < this.length) {
                var node = this[index];
                this._shiftItems(index, false);
                _super.prototype.pop.call(this);
                return true;
            }
            return false;
        };
        List.prototype._Contains = function (item) {
            var index = this.indexOf(item);
            return index > -1 && index < this.length;
        };
        List.prototype._Clear = function () {
            for (var i = this.length; i > 0; i--) {
                this._RemoveAt(i - 1);
            }
        };
        List.prototype._ToList = function () {
            var list = new List();
            for (var i = 0; i < this.length; i++) {
                list._Add(this[i]);
            }
            return list;
        };
        List.prototype._IndexOf = function (item) {
            return this.indexOf(item);
        };
        List.prototype._First = function () {
            if (this.length > 0)
                return this[0];
            return null;
        };
        List.prototype._Last = function () {
            if (this.length > 0)
                return this[this.length - 1];
            return null;
        };
        List.prototype._shiftItems = function (index, forward) {
            if (forward) {
                for (var i = this.length; i > index; i--) {
                    this[i] = this[i - 1];
                }
            }
            else {
                for (var i = index; i < this.length - 1; i++) {
                    this[i] = this[i + 1];
                }
            }
        };
        List.prototype._Sort = function () {
            _super.prototype.sort.call(this, function (a, b) {
                return a - b;
            });
        };
        return List;
    }(Array));
    DocumentEditorFeatures.List = List;
    var Dictionary = (function () {
        function Dictionary() {
            this.keys = new List();
            this.values = new List();
        }
        Object.defineProperty(Dictionary.prototype, "Count", {
            get: function () {
                return this.keys.length;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(Dictionary.prototype, "Keys", {
            get: function () {
                return this.keys._ToList();
            },
            enumerable: true,
            configurable: true
        });
        Dictionary.prototype._Add = function (key, value) {
            if (key == undefined || key == null || value == undefined || value == null)
                throw new ReferenceError("Provided key or value is not valid.");
            var index = this.keys.indexOf(key);
            if (index < 0 || index > this.keys.length - 1) {
                this.keys._Add(key);
                this.values._Add(value);
                return 1;
            }
            else {
                throw new RangeError("An item with the same key has already been added.");
            }
        };
        Dictionary.prototype._Get = function (key) {
            if (key == undefined || key == null)
                throw new ReferenceError("Provided key is not valid.");
            var index = this.keys.indexOf(key);
            if (index < 0 || index > this.keys.length - 1) {
                throw new RangeError("No item with the specified key has been added.");
            }
            else {
                return this.values[index];
            }
        };
        Dictionary.prototype._Set = function (key, value) {
            if (key == undefined || key == null)
                throw new ReferenceError("Provided key is not valid.");
            var index = this.keys.indexOf(key);
            if (index < 0 || index > this.keys.length - 1) {
                throw new RangeError("No item with the specified key has been added.");
            }
            else {
                this.values[index] = value;
            }
        };
        Dictionary.prototype._Remove = function (key) {
            if (key == undefined || key == null)
                throw new ReferenceError("Provided key is not valid.");
            var index = this.keys.indexOf(key);
            if (index < 0 || index > this.keys.length - 1) {
                throw new RangeError("No item with the specified key has been added.");
            }
            else {
                this.keys._RemoveAt(index);
                this.values._RemoveAt(index);
                return true;
            }
        };
        Dictionary.prototype._ContainsKey = function (key) {
            if (key == undefined || key == null)
                throw new ReferenceError("Provided key is not valid.");
            var index = this.keys.indexOf(key);
            if (index < 0 || index > this.keys.length - 1) {
                return false;
            }
            return true;
        };
        Dictionary.prototype._Clear = function () {
            this.keys._Clear();
            this.values._Clear();
        };
        return Dictionary;
    }());
    DocumentEditorFeatures.Dictionary = Dictionary;
    var ElementCollection = (function (_super) {
        __extends(ElementCollection, _super);
        function ElementCollection() {
            _super.apply(this, arguments);
            this.maxBaseLineOffset = 0;
            this.maxTextElementHeight = Number.NaN;
            this.maxTextElementBaselineOffset = 0;
            this.SkipClipImage = false;
        }
        Object.defineProperty(ElementCollection.prototype, "MaxBaselineOffset", {
            get: function () {
                return this.maxBaseLineOffset;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(ElementCollection.prototype, "MaxTextElementHeight", {
            get: function () {
                return this.maxTextElementHeight;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(ElementCollection.prototype, "MaxTextElementBaselineOffset", {
            get: function () {
                return this.maxTextElementBaselineOffset;
            },
            enumerable: true,
            configurable: true
        });
        ElementCollection.prototype.push = function (item) {
            return this._Add(item);
        };
        ElementCollection.prototype._Add = function (item) {
            if (item != undefined && item != null) {
                _super.prototype.push.call(this, item);
                this._UpdateMaxElementHeight(item);
                return 1;
            }
        };
        ElementCollection.prototype._Insert = function (index, item) {
            if (index == this.length) {
                this._Add(item);
                return;
            }
            if (index > -1 && index < this.length) {
                this._shiftItems(index, true);
                this[index] = item;
                this.length = this.length + 1;
                this._UpdateMaxElementHeight(item);
            }
        };
        ElementCollection.prototype._Remove = function (item) {
            var index = this.indexOf(item);
            if (index > -1 && index < this.length) {
                this._shiftItems(index, false);
                _super.prototype.pop.call(this);
                return true;
            }
            return false;
        };
        ElementCollection.prototype._RemoveAt = function (index) {
            if (index > -1 && index < this.length) {
                var node = this[index];
                this._shiftItems(index, false);
                _super.prototype.pop.call(this);
                return true;
            }
            return false;
        };
        ElementCollection.prototype._Contains = function (item) {
            var index = this.indexOf(item);
            return index > -1 && index < this.length;
        };
        ElementCollection.prototype._ToList = function () {
            var list = new List();
            for (var i = 0; i < this.length; i++) {
                list._Add(this[i]);
            }
            return list;
        };
        ElementCollection.prototype._Clear = function () {
            _super.prototype._Clear.call(this);
            this.maxBaseLineOffset = 0;
            this.maxTextElementHeight = Number.NaN;
            this.maxTextElementBaselineOffset = 0;
            this.SkipClipImage = false;
        };
        ElementCollection.prototype._UpdateMaxElement = function () {
            this.maxBaseLineOffset = 0;
            this.maxTextElementHeight = Number.NaN;
            this.maxTextElementBaselineOffset = 0;
            for (var i = 0; i < this.Count; i++) {
                this._UpdateMaxElementHeight(this[i]);
            }
        };
        ElementCollection.prototype._UpdateMaxElementHeight = function (element) {
            if (element instanceof TextElementBox || element instanceof ListTextElementBox) {
                if (isNaN(this.maxTextElementHeight))
                    this.maxTextElementHeight = 0;
                if (this.maxTextElementHeight < element.Height) {
                    this.maxTextElementHeight = element.Height;
                    this.maxTextElementBaselineOffset = element instanceof TextElementBox ? element.BaselineOffset : element.BaselineOffset;
                }
                if (this.maxBaseLineOffset < this.maxTextElementBaselineOffset)
                    this.maxBaseLineOffset = this.maxTextElementBaselineOffset;
            }
            else if (this.maxBaseLineOffset < element.Height)
                this.maxBaseLineOffset = element.Height;
        };
        return ElementCollection;
    }(List));
    DocumentEditorFeatures.ElementCollection = ElementCollection;
    var BaseNode = (function () {
        function BaseNode(owner) {
            this.ownerBase = owner;
            this._UpdateListId();
        }
        Object.defineProperty(BaseNode.prototype, "OwnerBase", {
            get: function () {
                return this.ownerBase;
            },
            enumerable: true,
            configurable: true
        });
        BaseNode.prototype._SetOwner = function (owner) {
            this.ownerBase = owner;
            this._UpdateListId();
        };
        BaseNode.prototype._SetOwnerBase = function (owner) {
            this.ownerBase = owner;
            this._UpdateListId();
        };
        BaseNode.prototype._UpdateListId = function () {
            if (this instanceof ListAdv && this.ownerBase instanceof DocumentAdv) {
                var instance = this;
                if (instance.ListId < 0) {
                    var document_1 = this.ownerBase;
                    var id = document_1.Lists.Count + 1;
                    while (document_1._GetListByID(id) != null)
                        id += 1;
                    instance.ListId = id;
                }
            }
            else if (this instanceof AbstractListAdv && this.ownerBase instanceof DocumentAdv) {
                var instance = this;
                if (instance.AbstractListId < 0) {
                    var document_2 = this.ownerBase;
                    var id = document_2.AbstractLists.Count + 1;
                    while (document_2._GetAbstractListAdvByID(id) != null)
                        id += 1;
                    instance.AbstractListId = id;
                }
            }
        };
        return BaseNode;
    }());
    DocumentEditorFeatures.BaseNode = BaseNode;
    var Node = (function (_super) {
        __extends(Node, _super);
        function Node(owner) {
            _super.call(this, owner);
        }
        Object.defineProperty(Node.prototype, "Owner", {
            get: function () {
                return this.OwnerBase;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(Node.prototype, "NextNode", {
            get: function () {
                if (this.Owner instanceof CommentAdv && this.Owner.Blocks != null)
                    return this.Owner.Blocks._GetNextNode(this);
                if (this.Owner instanceof CompositeNode)
                    return this.Owner.ChildNodes._GetNextNode(this);
                return null;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(Node.prototype, "PreviousNode", {
            get: function () {
                if (this.Owner instanceof CommentAdv && this.Owner.Blocks != null)
                    return this.Owner.Blocks._GetPreviousNode(this);
                if (this.Owner instanceof CompositeNode)
                    return this.Owner.ChildNodes._GetPreviousNode(this);
                return null;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(Node.prototype, "IsComposite", {
            get: function () {
                return this instanceof CompositeNode;
            },
            enumerable: true,
            configurable: true
        });
        Node.prototype._SetOwner = function (owner) {
            if (this.OwnerBase != owner && this.OwnerBase instanceof CompositeNode) {
                if (this instanceof FieldCharacterAdv) {
                    var instance = this;
                    if (instance._IsLinkedFieldCharacter()) {
                        instance._UnlinkFieldCharacter("", false);
                    }
                    this.OwnerBase._RemoveFieldCharacter(instance);
                    instance._CheckUnlinkFieldCharacter("", false);
                }
                if (this instanceof CommentAdv) {
                    var node = this;
                    this.OwnerBase._RemoveCommentAdv(node);
                }
                if (this.OwnerBase.ChildNodes._Contains(this)) {
                    this.OwnerBase.ChildNodes._Remove(this);
                }
            }
            this._SetOwnerBase(owner);
            if (owner instanceof CompositeNode) {
                if (this instanceof FieldCharacterAdv) {
                    owner._AttachFieldCharacter(this);
                }
                if (this instanceof CommentAdv) {
                    var node = this;
                    owner._AddCommentAdv(node);
                }
            }
        };
        Node.prototype._IsInComment = function () {
            var node = this;
            while (node.Owner instanceof Node) {
                node = node.Owner;
                if (node instanceof CommentAdv)
                    return true;
                if (node instanceof SectionAdv || node instanceof HeaderFooter)
                    return false;
            }
            return false;
        };
        Node.prototype._GetOwnerComment = function () {
            var node = this;
            while (node.Owner instanceof Node) {
                node = node.Owner;
                if (node instanceof CommentAdv)
                    return node;
            }
            return null;
        };
        Node.prototype._GetIndexInOwnerCollection = function () {
            if (this.Owner instanceof CommentAdv)
                return this.Owner.Blocks._IndexOf(this);
            var compositeNode = this.Owner;
            return compositeNode != null ? compositeNode.ChildNodes.indexOf(this) : -1;
        };
        Node.prototype._GetTopLevelOwner = function () {
            var node = this;
            while (node.Owner instanceof Node) {
                node = node.Owner;
                if (node instanceof DocumentAdv)
                    break;
            }
            return node;
        };
        Node.prototype._GetOwnerDocument = function () {
            var node = this._GetTopLevelOwner();
            return node;
        };
        return Node;
    }(BaseNode));
    DocumentEditorFeatures.Node = Node;
    var CompositeNode = (function (_super) {
        __extends(CompositeNode, _super);
        function CompositeNode(owner) {
            _super.call(this, owner);
            this.Fields = new List();
            this.FieldCharacter = new List();
            this.Comments = new List();
        }
        CompositeNode.prototype._SetOwner = function (owner) {
            if (this.OwnerBase != owner && this.OwnerBase instanceof CompositeNode) {
                if (this.Fields.Count > 0)
                    this.OwnerBase._RemoveFields(this);
                if (this.Comments.Count > 0)
                    this.OwnerBase._RemoveComment(this);
                if (this.FieldCharacter.Count > 0)
                    this.OwnerBase._RemoveFieldCharacter(this);
                if (this.OwnerBase.ChildNodes._Contains(this))
                    this.OwnerBase.ChildNodes._Remove(this);
            }
            this._SetOwnerBase(owner);
            if (owner instanceof CompositeNode) {
                if (this.FieldCharacter.Count > 0)
                    this.Owner._AttachFieldCharacter(this);
                if (this.Fields.Count > 0)
                    owner._AddFields(this);
                if (this.Comments.Count > 0)
                    owner._AddComment(this);
            }
        };
        CompositeNode.prototype._AddComment = function (compositeNode) {
            if (compositeNode instanceof HeaderFooter)
                return;
            var index = compositeNode._GetIndexInOwnerCollection();
            for (var i = 0; i < compositeNode.Comments.Count; i++) {
                this._AddCommentAdv(compositeNode.Comments[i]);
            }
        };
        CompositeNode.prototype._AddCommentAdv = function (comment) {
            var node = this;
            if (!this.Comments._Contains(comment)) {
                if (this.Comments.Count == 0)
                    this.Comments._Add(comment);
                else {
                    var currentParaIndex = comment.OwnerParagraph._GetHierarchicalIndex("");
                    var isInserted = false;
                    for (var i = 0; i < this.Comments.Count; i++) {
                        var paraIndex = this.Comments[i].OwnerParagraph._GetHierarchicalIndex("");
                        if (paraIndex.localeCompare(currentParaIndex) > 0) {
                            isInserted = true;
                            this.Comments._Insert(i, comment);
                            break;
                        }
                    }
                    if (!isInserted)
                        this.Comments._Add(comment);
                }
            }
            if (this.Owner instanceof CompositeNode && !(this instanceof HeaderFooter))
                this.Owner._AddCommentAdv(comment);
            if (this instanceof DocumentAdv && node.OwnerControl != null)
                this._CommentCollectionChanged();
        };
        CompositeNode.prototype._CommentCollectionChanged = function () {
            var node = this;
            if (node.OwnerControl.ShowComments)
                node.OwnerControl._OnShowCommentsChanged();
        };
        CompositeNode.prototype._RemoveComment = function (compositeNode) {
            if (compositeNode instanceof HeaderFooter)
                return;
            var compositeNodeIndex = compositeNode._GetHierarchicalIndex("");
            for (var i = 0; i < compositeNode.Comments.Count; i++) {
                var comment = compositeNode.Comments[i];
                var count = compositeNode.Comments.Count;
                this._RemoveCommentAdv(comment);
                if (count > compositeNode.Comments.Count)
                    i -= count - compositeNode.Comments.Count;
                if (i < -1)
                    i = -1;
            }
        };
        CompositeNode.prototype._RemoveCommentAdv = function (comment) {
            var node = this;
            node.Comments._Remove(comment);
            if (node.Owner instanceof CompositeNode && !(node instanceof HeaderFooter))
                node.Owner._RemoveCommentAdv(comment);
            if (node instanceof DocumentAdv && node.OwnerControl != null)
                this._CommentCollectionChanged();
        };
        CompositeNode.prototype._RemoveField = function (field) {
            this.Fields._Remove(field);
            if (this.Owner instanceof CompositeNode && !(this instanceof HeaderFooter))
                this.Owner._RemoveField(field);
        };
        CompositeNode.prototype._RemoveFields = function (compositeNode) {
            if (compositeNode instanceof HeaderFooter)
                return;
            var compositeNodeIndex = compositeNode._GetHierarchicalIndex("");
            for (var i = 0; i < compositeNode.Fields.Count; i++) {
                var field = compositeNode.Fields[i];
                var count = compositeNode.Fields.Count;
                if (field._IsUnlinkFieldCharacters(compositeNodeIndex))
                    field._UnlinkFieldCharacter(compositeNodeIndex, true);
                this._RemoveField(field);
                if (count > compositeNode.Fields.Count)
                    i -= count - compositeNode.Fields.Count;
                if (i < -1)
                    i = -1;
            }
        };
        CompositeNode.prototype._ClearUnlinkedFields = function () {
            var document = this._GetOwnerDocument();
            if (document != null) {
                for (var i = 0; i < this.FieldCharacter.Count; i++) {
                    var FieldChar = this.FieldCharacter[i];
                    if (FieldChar.OwnerParagraph != null && FieldChar.OwnerParagraph.Inlines != null && FieldChar.OwnerParagraph.Inlines._Contains(FieldChar))
                        FieldChar.OwnerParagraph.Inlines._Remove(FieldChar);
                    this.FieldCharacter._Remove(FieldChar);
                    i--;
                }
            }
        };
        CompositeNode.prototype._AttachFieldCharacter = function (fieldCharacter) {
            if (fieldCharacter instanceof FieldCharacterAdv) {
                if (this._LinkFieldCharacters(fieldCharacter, fieldCharacter)) {
                }
                else {
                    this._AddFieldCharacter(fieldCharacter);
                }
            }
            else if (fieldCharacter instanceof CompositeNode) {
                if (fieldCharacter instanceof HeaderFooter)
                    return;
                for (var i = 0; i < fieldCharacter.FieldCharacter.Count; i++) {
                    var count = fieldCharacter.FieldCharacter.Count;
                    var fieldChar = fieldCharacter.FieldCharacter[i];
                    if (this._LinkFieldCharacters(fieldChar, fieldCharacter)) {
                        if (count > fieldCharacter.FieldCharacter.Count)
                            i -= count - fieldCharacter.FieldCharacter.Count;
                        if (i < -1)
                            i = -1;
                    }
                    else {
                        this._AddFieldCharacter(fieldChar);
                    }
                }
            }
        };
        CompositeNode.prototype._LinkFieldCharacters = function (fieldCharacter, previousNode) {
            var field = { nestingLevel: 0 };
            if (fieldCharacter instanceof FieldBeginAdv) {
                var fieldBegin = fieldCharacter;
                if (fieldBegin.fieldEnd == null)
                    this._LinkFieldTraversingForward(fieldBegin, field, previousNode);
                if (fieldBegin.fieldEnd != null) {
                    fieldBegin._AddToLinkedFields();
                    return true;
                }
            }
            else if (fieldCharacter instanceof FieldSeparatorAdv) {
                var fieldSeparator = fieldCharacter;
                if (fieldSeparator.fieldBegin == null)
                    this._LinkFieldTraversingBackward(fieldSeparator, field, previousNode);
                if (fieldSeparator.fieldBegin != null) {
                    if (fieldSeparator.fieldEnd == null && this._LinkFieldTraversingForward(fieldSeparator.fieldBegin, field, previousNode))
                        fieldSeparator.fieldEnd = fieldSeparator.fieldBegin.fieldEnd;
                    if (fieldSeparator.fieldEnd != null) {
                        fieldSeparator.fieldBegin._AddToLinkedFields();
                        return true;
                    }
                }
            }
            else if (fieldCharacter instanceof FieldEndAdv) {
                var fieldEnd = fieldCharacter;
                if (fieldEnd.fieldBegin == null)
                    this._LinkFieldTraversingBackward(fieldEnd, field, previousNode);
                if (fieldEnd.fieldBegin != null) {
                    fieldEnd.fieldBegin._AddToLinkedFields();
                    return true;
                }
            }
            return false;
        };
        CompositeNode.prototype._LinkFieldTraversingForward = function (fieldBegin, fieldNestingLevel, previousNode) {
            var index = 0;
            if (this.ChildNodes.indexOf(previousNode) != -1)
                index = this.ChildNodes.indexOf(previousNode) + 1;
            for (var i = index; i < this.ChildNodes.length; i++) {
                var childNode = this.ChildNodes[i];
                if (childNode instanceof CompositeNode) {
                    var isEndReached = childNode._LinkFieldTraversingForward(fieldBegin, fieldNestingLevel, null);
                    if (fieldBegin.fieldEnd != null || isEndReached)
                        return true;
                }
                else {
                    if (childNode instanceof FieldCharacterAdv) {
                        if (childNode instanceof FieldBeginAdv && fieldBegin != childNode)
                            fieldNestingLevel.nestingLevel++;
                        if (childNode instanceof FieldEndAdv) {
                            if (fieldNestingLevel.nestingLevel == 0) {
                                if (childNode.fieldBegin == null)
                                    fieldBegin.fieldEnd = childNode;
                                return fieldBegin.fieldEnd != null;
                            }
                            else
                                fieldNestingLevel.nestingLevel--;
                        }
                        else if (fieldNestingLevel.nestingLevel == 0 && fieldBegin.fieldSeparator == null) {
                            if (childNode instanceof FieldSeparatorAdv) {
                                if (childNode.fieldBegin == null) {
                                    fieldBegin.fieldSeparator = childNode;
                                    if (childNode.fieldEnd != null) {
                                        fieldBegin.fieldEnd = childNode.fieldEnd;
                                        return true;
                                    }
                                }
                                else
                                    return false;
                            }
                        }
                    }
                }
            }
            if (this.Owner instanceof CompositeNode && !(this instanceof HeaderFooter))
                return this.Owner._LinkFieldTraversingForward(fieldBegin, fieldNestingLevel, this);
            else
                return true;
        };
        CompositeNode.prototype._LinkFieldTraversingBackward = function (fieldCharacter, fieldNestingLevel, previousNode) {
            if (fieldCharacter instanceof FieldEndAdv) {
                var fieldEnd = fieldCharacter;
                var index = this.ChildNodes.length - 1;
                if (this.ChildNodes.indexOf(previousNode) != -1) {
                    index = this.ChildNodes.indexOf(previousNode) - 1;
                }
                for (var i = index; i >= 0; i--) {
                    var childNode = this.ChildNodes[i];
                    if (childNode instanceof CompositeNode) {
                        var isDocumentStartReached = childNode._LinkFieldTraversingBackward(fieldEnd, fieldNestingLevel, null);
                        if (fieldEnd.fieldBegin != null || isDocumentStartReached)
                            return true;
                    }
                    else {
                        if (childNode instanceof FieldCharacterAdv) {
                            if (childNode instanceof FieldEndAdv && fieldEnd != childNode)
                                fieldNestingLevel.nestingLevel++;
                            if (childNode instanceof FieldBeginAdv) {
                                if (fieldNestingLevel.nestingLevel == 0) {
                                    if (childNode.fieldEnd == null)
                                        fieldEnd.fieldBegin = childNode;
                                    return fieldEnd.fieldBegin != null;
                                }
                                else
                                    fieldNestingLevel.nestingLevel--;
                            }
                            else if (fieldNestingLevel.nestingLevel == 0) {
                                if (childNode.fieldEnd == null) {
                                    fieldEnd.fieldSeparator = childNode;
                                    if (childNode.fieldBegin != null) {
                                        fieldEnd.fieldBegin = childNode.fieldBegin;
                                        return true;
                                    }
                                }
                                else
                                    return false;
                            }
                        }
                    }
                }
                if (this.Owner instanceof CompositeNode && !(this instanceof HeaderFooter))
                    return this.Owner._LinkFieldTraversingBackward(fieldEnd, fieldNestingLevel, this);
                else
                    return true;
            }
            else if (fieldCharacter instanceof FieldSeparatorAdv) {
                var fieldSeparator = fieldCharacter;
                var index = this.ChildNodes.length - 1;
                if (this.ChildNodes.indexOf(previousNode) != -1)
                    index = this.ChildNodes.indexOf(previousNode) - 1;
                for (var i = index; i >= 0; i--) {
                    var childNode = this.ChildNodes[i];
                    if (childNode instanceof CompositeNode) {
                        var isDocumentStartReached = childNode._LinkFieldTraversingBackward(fieldSeparator, fieldNestingLevel, null);
                        if (fieldSeparator.fieldBegin != null || isDocumentStartReached)
                            return true;
                    }
                    else {
                        if (childNode instanceof FieldCharacterAdv) {
                            if (childNode instanceof FieldEndAdv)
                                fieldNestingLevel.nestingLevel++;
                            if (childNode instanceof FieldBeginAdv) {
                                if (fieldNestingLevel.nestingLevel == 0) {
                                    if (childNode.fieldSeparator == null)
                                        fieldSeparator.fieldBegin = childNode;
                                    return fieldSeparator.fieldBegin != null;
                                }
                                else
                                    fieldNestingLevel.nestingLevel--;
                            }
                            else if (fieldNestingLevel.nestingLevel == 0)
                                return false;
                        }
                    }
                }
                if (this.Owner instanceof CompositeNode && !(this instanceof HeaderFooter))
                    return this.Owner._LinkFieldTraversingBackward(fieldSeparator, fieldNestingLevel, this);
                else
                    return true;
            }
        };
        CompositeNode.prototype._AddFields = function (fieldBegin) {
            if (fieldBegin instanceof FieldBeginAdv) {
                this.Fields._Add(fieldBegin);
                if (this.Owner instanceof CompositeNode && !(this instanceof HeaderFooter))
                    this.Owner._AddFields(fieldBegin);
            }
            else if (fieldBegin instanceof CompositeNode) {
                if (fieldBegin instanceof HeaderFooter)
                    return;
                for (var i = 0; i < fieldBegin.Fields.Count; i++) {
                    this._AddFields(fieldBegin.Fields[i]);
                }
            }
        };
        CompositeNode.prototype._AddFieldCharacter = function (fieldCharacter) {
            if (fieldCharacter instanceof FieldCharacterAdv) {
                this.FieldCharacter._Add(fieldCharacter);
                if (this.Owner instanceof CompositeNode && !(this instanceof HeaderFooter))
                    this.Owner._AddFieldCharacter(fieldCharacter);
            }
            else if (fieldCharacter instanceof CompositeNode) {
                if (fieldCharacter instanceof HeaderFooter)
                    return;
                for (var i = 0; i < fieldCharacter.FieldCharacter.Count; i++) {
                    this._AddFieldCharacter(fieldCharacter.FieldCharacter[i]);
                }
            }
        };
        CompositeNode.prototype._RemoveFieldCharacter = function (fieldCharacter) {
            if (fieldCharacter instanceof FieldCharacterAdv) {
                if (this.FieldCharacter._Contains(fieldCharacter)) {
                    this.FieldCharacter._Remove(fieldCharacter);
                    if (this.Owner instanceof CompositeNode && !(this instanceof HeaderFooter))
                        this.Owner._RemoveFieldCharacter(fieldCharacter);
                }
            }
            else if (fieldCharacter instanceof CompositeNode) {
                if (fieldCharacter instanceof HeaderFooter)
                    return;
                var compositeNodeIndex = fieldCharacter._GetHierarchicalIndex("");
                for (var i = 0; i < fieldCharacter.FieldCharacter.Count; i++) {
                    var fieldChar = fieldCharacter.FieldCharacter[i];
                    var count = fieldCharacter.FieldCharacter.Count;
                    fieldChar._CheckUnlinkFieldCharacter(compositeNodeIndex, true);
                    this._RemoveFieldCharacter(fieldChar);
                    if (count > fieldCharacter.FieldCharacter.Count)
                        i -= count - fieldCharacter.FieldCharacter.Count;
                    if (i < -1)
                        i = -1;
                }
            }
        };
        CompositeNode.prototype._GetHierarchicalIndex = function (hierarchicalIndex) {
            if (this.Owner instanceof CompositeNode) {
                if (this instanceof HeaderFooters)
                    hierarchicalIndex = "HF;" + hierarchicalIndex;
                else
                    hierarchicalIndex = this._GetIndexInOwnerCollection() + ";" + hierarchicalIndex;
                if (!(this.Owner instanceof DocumentAdv))
                    return this.Owner._GetHierarchicalIndex(hierarchicalIndex);
            }
            if (this.Owner instanceof CommentAdv) {
                var node = this;
                hierarchicalIndex = this.Owner._GetHierarchialIndex((node instanceof BlockAdv) ? node : null) + hierarchicalIndex;
            }
            return hierarchicalIndex;
        };
        CompositeNode.prototype._GetFieldCode = function (fieldBegin, isNestedFieldCode, isFieldCodeParsed, previousNode) {
            var fieldCode = "";
            var index = 0;
            if (this.ChildNodes._Contains(previousNode))
                index = this.ChildNodes._IndexOf(previousNode) + 1;
            for (var i = index; i < this.ChildNodes.Count; i++) {
                var childNode = this.ChildNodes[i];
                if (childNode instanceof CompositeNode) {
                    fieldCode += childNode._GetFieldCode(fieldBegin, isNestedFieldCode, isFieldCodeParsed, null);
                    if (isFieldCodeParsed)
                        return fieldCode;
                }
                else {
                    if (childNode instanceof FieldCharacterAdv) {
                        if (childNode instanceof FieldBeginAdv)
                            isNestedFieldCode = (fieldBegin.fieldEnd != null && fieldBegin != childNode);
                        if (childNode instanceof FieldEndAdv) {
                            if (fieldBegin.fieldEnd == childNode) {
                                isFieldCodeParsed = true;
                                return fieldCode;
                            }
                            else
                                isNestedFieldCode = false;
                        }
                        else if (childNode instanceof FieldSeparatorAdv) {
                            if (fieldBegin.fieldSeparator == childNode) {
                                isFieldCodeParsed = true;
                                return fieldCode;
                            }
                            else
                                isNestedFieldCode = false;
                        }
                    }
                    else if (childNode instanceof SpanAdv && !isNestedFieldCode)
                        fieldCode += childNode.Text;
                }
            }
            if (this.Owner instanceof CompositeNode && !(this instanceof HeaderFooter))
                fieldCode += this.Owner._GetFieldCode(fieldBegin, isNestedFieldCode, isFieldCodeParsed, this);
            return fieldCode;
        };
        CompositeNode.prototype._GetHyperlinkField = function (inline, CheckedFields) {
            for (var i = 0; i < this.Fields.length; i++) {
                if (CheckedFields._Contains(this.Fields[i]) || this.Fields[i].fieldSeparator == null)
                    continue;
                else
                    CheckedFields._Add(this.Fields[i]);
                var fieldCode = this.Fields[i]._GetFieldCode();
                fieldCode = fieldCode.trim().toLowerCase();
                if (fieldCode.match("hyperlink ") && this.Fields[i]._InlineIsInFieldResult(inline))
                    return this.Fields[i];
            }
            if (this.Owner instanceof CompositeNode && !(this instanceof HeaderFooter))
                return this.Owner._GetHyperlinkField(inline, CheckedFields);
            return null;
        };
        CompositeNode.prototype._GetHyperlinkFields = function (paragraph, CheckedFields) {
            for (var i = 0; i < this.Fields.length; i++) {
                if (CheckedFields._Contains(this.Fields[i]) || this.Fields[i].fieldSeparator == null)
                    continue;
                else
                    CheckedFields._Add(this.Fields[i]);
                var fieldCode = this.Fields[i]._GetFieldCode();
                fieldCode = fieldCode.trim().toLowerCase();
                if (fieldCode.match("hyperlink ") && this.Fields[i]._ParagraphIsInFieldResult(paragraph))
                    return this.Fields[i];
            }
            if (this.Owner instanceof CompositeNode && !(this instanceof HeaderFooter))
                return this.Owner._GetHyperlinkFields(paragraph, CheckedFields);
            return null;
        };
        CompositeNode.prototype._GetBlock = function (position) {
            if (position == "" || position == undefined)
                return null;
            var index = position.indexOf(";");
            var value = position.substring(0, index);
            position = position.substring(index).replace(";", "");
            var node = this;
            if (node instanceof DocumentAdv && value.lastIndexOf("C", 0) > 0) {
                value = value.substring(1);
                var commentIndex = parseInt(value);
                var blockObj = node.Comments[commentIndex].Blocks._GetBlock(position);
                return { "node": (blockObj != null) ? blockObj.node : null, "position": (blockObj != null) ? blockObj.position : null };
            }
            if (node instanceof SectionAdv && value == "HF") {
                var blockObj = node.HeaderFooters._GetBlock(position);
                return { "node": (blockObj != null) ? blockObj.node : null, "position": (blockObj != null) ? blockObj.position : null };
            }
            index = parseInt(value);
            if (index >= 0 && index < this.ChildNodes.Count) {
                var child = this.ChildNodes[index];
                if (position.indexOf(";") >= 0) {
                    if (child instanceof ParagraphAdv) {
                        if (position.indexOf("C;") >= 0) {
                            var paragraph = child;
                            index = position.indexOf(";");
                            value = position.substring(0, index);
                            position = position.substring(index + 2).replace(';', "");
                            var indexInInline = 0;
                            var inlineObj = paragraph._GetInline(parseInt(value), indexInInline);
                            var inline = inlineObj.inline;
                            indexInInline = inlineObj.index;
                            if (indexInInline == inline.Length)
                                inline = (inline.NextNode instanceof Inline) ? inline.NextNode : null;
                            if (inline != null)
                                var blockObj = inline.Blocks._GetBlock(position);
                            return { "node": (blockObj != null) ? blockObj.node : null, "position": (blockObj != null) ? blockObj.position : null };
                        }
                        if (position.indexOf(";") >= 0)
                            position = "0";
                        return { "node": child, "position": position };
                    }
                    if (child instanceof CompositeNode) {
                        var blockObj = child._GetBlock(position);
                        return { "node": (blockObj != null) ? blockObj.node : null, "position": (blockObj != null) ? blockObj.position : null };
                    }
                }
                else
                    return { "node": child, "position": position };
            }
        };
        CompositeNode.prototype._GetParagraph = function (position) {
            if (position.Index == null || position.Index == undefined)
                return null;
            var ins = this;
            var index = position.Index.indexOf(";");
            var value = "0";
            if (index >= 0) {
                value = position.Index.substring(0, index);
                position.Index = position.Index.substring(index).replace(";", "");
            }
            if (this instanceof SectionAdv && value == "HF")
                return ins.HeaderFooters._GetParagraph(position);
            index = parseInt(value);
            if (this instanceof TableRowAdv && index >= this.ChildNodes.Count) {
                position.Index = "0;0";
                index = this.ChildNodes.Count - 1;
            }
            if (index >= 0 && index < this.ChildNodes.Count) {
                var child = this.ChildNodes[index];
                if (child instanceof ParagraphAdv) {
                    if (position.Index.indexOf("C;") > 0) {
                        var paragraph = child;
                        index = position.Index.indexOf(";");
                        value = position.Index.substring(0, index);
                        position.Index = position.Index.substring(index + 2).replace(";", "");
                        var indexInInline = 0;
                        var inlineObj = paragraph._GetInline(parseFloat(value), indexInInline);
                        var inline = inlineObj.inline;
                        indexInInline = inlineObj.index;
                        if (indexInInline == inline.Length)
                            inline = inline.NextNode;
                        return inline.Blocks._GetParagraph(position);
                    }
                    if (position.Index.indexOf(";") > 0)
                        position.Index = "0";
                    return child;
                }
                if (child instanceof CompositeNode) {
                    if (position.Index.indexOf(";") > 0)
                        return child._GetParagraph(position);
                    else {
                        if (child instanceof TableAdv)
                            return child._GetFirstParagraphInFirstCell();
                        return null;
                    }
                }
            }
            else if (this.NextNode instanceof CompositeNode) {
                position.Index = "0";
                if (this.NextNode instanceof TableAdv)
                    return this.NextNode._GetFirstParagraphInFirstCell();
                return this.NextNode;
            }
            return null;
        };
        return CompositeNode;
    }(Node));
    DocumentEditorFeatures.CompositeNode = CompositeNode;
    var ObservableCollection = (function (_super) {
        __extends(ObservableCollection, _super);
        function ObservableCollection() {
            _super.apply(this, arguments);
            this.notifyCollectionChanged = false;
        }
        Object.defineProperty(ObservableCollection.prototype, "NotifyCollectionChanged", {
            get: function () {
                return this.notifyCollectionChanged;
            },
            set: function (value) {
                this.notifyCollectionChanged = value;
            },
            enumerable: true,
            configurable: true
        });
        ObservableCollection.prototype.push = function (item) {
            if (item != null && item != undefined) {
                _super.prototype.push.call(this, item);
                var index = this.indexOf(item);
                if (this.NotifyCollectionChanged)
                    this._CollectionChanged(item, true, index);
                return 1;
            }
            return 0;
        };
        ObservableCollection.prototype._Add = function (item) {
            if (item != null && item != undefined)
                _super.prototype.push.call(this, item);
            var index = this.indexOf(item);
            if (this.NotifyCollectionChanged)
                this._CollectionChanged(item, true, index);
            return 1;
        };
        ObservableCollection.prototype._Insert = function (index, item) {
            if (index == this.length) {
                this._Add(item);
                return;
            }
            if (index > -1 && index < this.length) {
                this._shiftItems(index, true);
                this[index] = item;
                this.length = this.length + 1;
                if (this._CollectionChanged)
                    this._CollectionChanged(item, true, index);
            }
        };
        ObservableCollection.prototype._Remove = function (item) {
            var index = this.indexOf(item);
            if (index > -1 && index < this.length) {
                this._shiftItems(index, false);
                _super.prototype.pop.call(this);
                if (this._CollectionChanged)
                    this._CollectionChanged(item, false, index);
                return true;
            }
            return false;
        };
        ObservableCollection.prototype._RemoveAt = function (index) {
            if (index > -1 && index < this.length) {
                var item = this[index];
                this._shiftItems(index, false);
                _super.prototype.pop.call(this);
                if (this._CollectionChanged)
                    this._CollectionChanged(item, false, index);
                return true;
            }
            return false;
        };
        return ObservableCollection;
    }(List));
    DocumentEditorFeatures.ObservableCollection = ObservableCollection;
    var BaseNodeCollection = (function (_super) {
        __extends(BaseNodeCollection, _super);
        function BaseNodeCollection(owner) {
            _super.call(this);
            this.ownerBase = owner;
            this.NotifyCollectionChanged = true;
        }
        Object.defineProperty(BaseNodeCollection.prototype, "OwnerBase", {
            get: function () {
                return this.ownerBase;
            },
            enumerable: true,
            configurable: true
        });
        BaseNodeCollection.prototype._Push = function (node) {
            if ((this instanceof ListAdvCollection && node instanceof ListAdv)
                || (this instanceof AbstractListAdvCollection && node instanceof AbstractListAdv)
                || (this instanceof ListLevelAdvCollection && node instanceof ListLevelAdv)
                || (this instanceof LevelOverrideAdvCollection && node instanceof LevelOverrideAdv)) {
                _super.prototype.push.call(this, node);
                return 1;
            }
            return 0;
        };
        BaseNodeCollection.prototype._Add = function (node) {
            if ((this instanceof ListAdvCollection && node instanceof ListAdv)
                || (this instanceof AbstractListAdvCollection && node instanceof AbstractListAdv)
                || (this instanceof ListLevelAdvCollection && node instanceof ListLevelAdv)
                || (this instanceof LevelOverrideAdvCollection && node instanceof LevelOverrideAdv)) {
                _super.prototype.push.call(this, node);
                return 1;
            }
            return 0;
        };
        BaseNodeCollection.prototype._CollectionChanged = function (baseNode, added) {
            if (added) {
                baseNode._SetOwnerBase(this.ownerBase);
            }
            else {
                if (baseNode instanceof BaseNode)
                    baseNode._SetOwnerBase(null);
            }
        };
        BaseNodeCollection.prototype._Dispose = function () {
            this.ownerBase = null;
            this.NotifyCollectionChanged = false;
        };
        return BaseNodeCollection;
    }(ObservableCollection));
    DocumentEditorFeatures.BaseNodeCollection = BaseNodeCollection;
    var ListAdvCollection = (function (_super) {
        __extends(ListAdvCollection, _super);
        function ListAdvCollection() {
            _super.apply(this, arguments);
        }
        return ListAdvCollection;
    }(BaseNodeCollection));
    DocumentEditorFeatures.ListAdvCollection = ListAdvCollection;
    var AbstractListAdvCollection = (function (_super) {
        __extends(AbstractListAdvCollection, _super);
        function AbstractListAdvCollection() {
            _super.apply(this, arguments);
        }
        return AbstractListAdvCollection;
    }(BaseNodeCollection));
    DocumentEditorFeatures.AbstractListAdvCollection = AbstractListAdvCollection;
    var ListLevelAdvCollection = (function (_super) {
        __extends(ListLevelAdvCollection, _super);
        function ListLevelAdvCollection() {
            _super.apply(this, arguments);
        }
        return ListLevelAdvCollection;
    }(BaseNodeCollection));
    DocumentEditorFeatures.ListLevelAdvCollection = ListLevelAdvCollection;
    var LevelOverrideAdvCollection = (function (_super) {
        __extends(LevelOverrideAdvCollection, _super);
        function LevelOverrideAdvCollection() {
            _super.apply(this, arguments);
        }
        LevelOverrideAdvCollection.prototype._Get = function (levelNumber) {
            for (var i = 0; i < this.length; i++) {
                if (this[i] instanceof LevelOverrideAdv) {
                    var levelOverride = this[i];
                    if (levelOverride.LevelNumber == levelNumber)
                        return levelOverride;
                }
            }
            return null;
        };
        return LevelOverrideAdvCollection;
    }(BaseNodeCollection));
    DocumentEditorFeatures.LevelOverrideAdvCollection = LevelOverrideAdvCollection;
    var NodeCollection = (function (_super) {
        __extends(NodeCollection, _super);
        function NodeCollection(owner) {
            _super.call(this);
            this.ownerNode = owner;
            this.NotifyCollectionChanged = true;
        }
        Object.defineProperty(NodeCollection.prototype, "OwnerNode", {
            get: function () {
                return this.ownerNode;
            },
            enumerable: true,
            configurable: true
        });
        NodeCollection.prototype._Push = function (node) {
            if ((this instanceof HeaderFooterCollection && node instanceof HeaderFooter)
                || (this instanceof SectionAdvCollection && node instanceof SectionAdv)
                || (this instanceof BlockAdvCollection && node instanceof BlockAdv)
                || (this instanceof InlineCollection && node instanceof Inline)
                || (this instanceof TableRowAdvCollection && node instanceof TableRowAdv)
                || (this instanceof TableCellAdvCollection && node instanceof TableCellAdv)) {
                _super.prototype.push.call(this, node);
                return 1;
            }
        };
        NodeCollection.prototype._Add = function (node) {
            if ((this instanceof HeaderFooterCollection && node instanceof HeaderFooter)
                || (this instanceof SectionAdvCollection && node instanceof SectionAdv)
                || (this instanceof BlockAdvCollection && node instanceof BlockAdv)
                || (this instanceof InlineCollection && node instanceof Inline)
                || (this instanceof TableRowAdvCollection && node instanceof TableRowAdv)
                || (this instanceof TableCellAdvCollection && node instanceof TableCellAdv)) {
                _super.prototype.push.call(this, node);
                return 1;
            }
            return 0;
        };
        NodeCollection.prototype._SetOwnerToNode = function (node, index) {
            if (node.Owner instanceof CompositeNode) {
                var previousOwner = node.Owner;
                if (this.indexOf(node) > -1) {
                    this.NotifyCollectionChanged = false;
                    this._RemoveAt(index);
                    if (previousOwner == this.OwnerNode)
                        this.NotifyCollectionChanged = true;
                    previousOwner.ChildNodes._Remove(node);
                    if (previousOwner == this.OwnerNode)
                        this.NotifyCollectionChanged = false;
                    this._Insert(index, node);
                    this.NotifyCollectionChanged = true;
                }
                else
                    previousOwner.ChildNodes._Remove(node);
            }
            node._SetOwner(this.OwnerNode);
        };
        NodeCollection.prototype._GetNextNode = function (node) {
            var index = this.indexOf(node);
            if (index < 0 || index > this.length - 2)
                return null;
            return this[index + 1];
        };
        NodeCollection.prototype._GetPreviousNode = function (node) {
            var index = this.indexOf(node);
            if (index < 1 || index > this.length - 1)
                return null;
            return this[index - 1];
        };
        NodeCollection.prototype._Dispose = function () {
            this.ownerNode = null;
            this.NotifyCollectionChanged = false;
        };
        return NodeCollection;
    }(ObservableCollection));
    DocumentEditorFeatures.NodeCollection = NodeCollection;
    var HeaderFooterCollection = (function (_super) {
        __extends(HeaderFooterCollection, _super);
        function HeaderFooterCollection() {
            _super.apply(this, arguments);
        }
        HeaderFooterCollection.prototype._CollectionChanged = function (node, added, nIndex) {
            if (added) {
                var index = this.indexOf(node);
                this._SetOwnerToNode(node, index);
            }
            else {
                if (node instanceof Node)
                    node._SetOwner(null);
            }
        };
        return HeaderFooterCollection;
    }(NodeCollection));
    DocumentEditorFeatures.HeaderFooterCollection = HeaderFooterCollection;
    var SectionAdvCollection = (function (_super) {
        __extends(SectionAdvCollection, _super);
        function SectionAdvCollection() {
            _super.apply(this, arguments);
        }
        SectionAdvCollection.prototype._CollectionChanged = function (node, added, NIndex) {
            if (added) {
                var index = this.indexOf(node);
                this._SetOwnerToNode(node, index);
            }
            else {
                if (node instanceof Node)
                    node._SetOwner(null);
            }
        };
        return SectionAdvCollection;
    }(NodeCollection));
    DocumentEditorFeatures.SectionAdvCollection = SectionAdvCollection;
    var BlockAdvCollection = (function (_super) {
        __extends(BlockAdvCollection, _super);
        function BlockAdvCollection() {
            _super.apply(this, arguments);
        }
        BlockAdvCollection.prototype._GetBlock = function (position) {
            if (position == "" || position == undefined || position == null)
                return null;
            var index = position.indexOf(";");
            var value = "0";
            if (index >= 0) {
                value = position.substring(0, index);
                position = position.substring(index).replace(';', "");
                index = parseInt(value);
                var child = this[index];
                if (position.indexOf(";") >= 0) {
                    if (child instanceof ParagraphAdv) {
                        if (position.indexOf("C;") >= 0) {
                            var paragraph = child;
                            index = position.indexOf(";");
                            value = position.substring(0, index);
                            position = position.substring(index + 2).replace(';', "");
                            var indexInInline = 0;
                            var inlineObj = paragraph._GetInline(parseFloat(value), indexInInline);
                            var inline = inlineObj.inline;
                            index = inlineObj.index;
                            if (indexInInline == inline.Length)
                                inline = (inline.NextNode instanceof Inline) ? inline.NextNode : null;
                            if (inline != null)
                                var blockObj = inline.Blocks._GetBlock(position);
                            return { "node": blockObj.node, "position": blockObj.position };
                        }
                        if (position.indexOf(";") >= 0)
                            position = "0";
                        return { "node": child, "position": position };
                    }
                    if (child instanceof CompositeNode) {
                        var blockObj = child._GetBlock(position);
                        return { "node": blockObj.node, "position": blockObj.position };
                    }
                    return { "node": child, "position": position };
                }
            }
        };
        BlockAdvCollection.prototype._CollectionChanged = function (node, added, nIndex) {
            if (added) {
                var index = nIndex;
                this._SetOwnerToNode(node, index);
                if (node instanceof ParagraphAdv && node.Owner != null) {
                    var paragraph = node;
                    for (var i = 0; i < paragraph.Inlines.Count; i++) {
                        var span = paragraph.Inlines[i];
                        if (span != null && span instanceof SpanAdv && span.Text != "" && span != null && span != undefined) {
                            var text = span.Text;
                            text = text.replace("\r\n", "\r");
                            text = text.replace("\n", "\r");
                            var index1 = text.indexOf("\r");
                            if (index1 > -1) {
                                span._SplitByBreakCharacter(index1);
                            }
                        }
                    }
                }
                index++;
                this._Layout(nIndex);
            }
            else {
                if (node instanceof Node)
                    node._SetOwner(null);
                if (node instanceof BlockAdv)
                    node._ClearWidgets();
                if (nIndex < this.Count)
                    this._Layout(nIndex);
            }
        };
        BlockAdvCollection.prototype._Layout = function (startIndex) {
            if (startIndex >= this.Count)
                return;
            var section = null;
            if (this.OwnerNode instanceof SectionAdv) {
                section = this.OwnerNode;
                if (section.BaseParent != null
                    && section.BaseParent.IsLayoutEnabled)
                    section._Layout(startIndex);
            }
            else if (this.OwnerNode instanceof CommentAdv)
                this.OwnerNode._Relayout();
            else if (this.OwnerNode instanceof TableCellAdv) {
                if (this.OwnerNode._IsInComment()) {
                    this.OwnerNode._GetOwnerComment()._Relayout();
                    return;
                }
                var cell = this.OwnerNode;
                cell = cell._GetContainerCell();
                section = cell.Section;
                if (section != null) {
                    var ownerDocument = section.Document;
                    var viewer = ownerDocument.OwnerControl.Viewer;
                    if (viewer.FieldEndParagraph != null && viewer.FieldEndParagraph.BaseParent == null)
                        viewer.FieldEndParagraph = cell._GetFirstParagraph();
                    if (viewer.FieldToLayout != null) {
                        var ownerParagraph = viewer.FieldToLayout.OwnerParagraph;
                        var fieldBegin = viewer.FieldToLayout;
                        viewer.FieldToLayout = null;
                        if (ownerParagraph != null && ownerParagraph.BaseParent != null) {
                            ownerParagraph._RelayoutParagraph(fieldBegin._GetIndexInOwnerCollection());
                            return;
                        }
                    }
                    if (ownerDocument.OwnerControl.IsLayoutEnabled)
                        cell.OwnerRow._Layout(viewer, false);
                }
            }
        };
        BlockAdvCollection.prototype._GetParagraph = function (position) {
            if (position.Index == null && position.Index == "" && position.Index == undefined)
                return null;
            var index = position.Index.indexOf(";");
            var value = "0";
            if (index >= 0) {
                value = position.Index.substring(0, index);
                position.Index = position.Index.substring(index).replace(";", "");
                index = parseInt(value);
                if (this[index] instanceof ParagraphAdv)
                    return this[index];
                else {
                    var tableAdv = this[index];
                    if (position.Index.indexOf(";") != -1) {
                        index = position.Index.indexOf(";");
                        value = position.Index.substring(0, index);
                        position.Index = position.Index.substring(index).replace(";", "");
                        index = parseInt(value);
                        return tableAdv.Rows[index]._GetParagraph(position);
                    }
                    else
                        return tableAdv._GetFirstParagraphInFirstCell();
                }
            }
            return null;
        };
        return BlockAdvCollection;
    }(NodeCollection));
    DocumentEditorFeatures.BlockAdvCollection = BlockAdvCollection;
    var InlineCollection = (function (_super) {
        __extends(InlineCollection, _super);
        function InlineCollection() {
            _super.apply(this, arguments);
        }
        InlineCollection.prototype._CollectionChanged = function (node, added, nIndex) {
            if (added) {
                var index = nIndex;
                this._SetOwnerToNode(node, index);
                if (node instanceof SpanAdv && node.OwnerParagraph != null && node.OwnerParagraph.Owner != null) {
                    var spanAdv = node;
                    if (spanAdv.Text != "" && spanAdv.Text != null) {
                        var text = spanAdv.Text;
                        text = text.replace("\r\n", "\r");
                        text = text.replace("\n", "\r");
                        var index1 = text.indexOf("\r");
                        if (index1 > -1) {
                            spanAdv._SplitByBreakCharacter(index);
                        }
                    }
                }
                index++;
                if (nIndex < index)
                    this._Layout(nIndex);
            }
            else {
                if (node instanceof Node)
                    node._SetOwner(null);
                if (node instanceof Inline) {
                    node._ClearElements(false);
                }
                if (nIndex - 1 < this.Count)
                    this._Layout(nIndex - 1);
            }
        };
        InlineCollection.prototype._Layout = function (startIndex) {
            if (this.OwnerNode instanceof ParagraphAdv && this.OwnerNode._IsInComment())
                this.OwnerNode._RelayoutParagraph(0);
            if (this.OwnerNode instanceof ParagraphAdv && this.OwnerNode.BaseParent != null)
                this.OwnerNode._RelayoutParagraph(startIndex);
        };
        return InlineCollection;
    }(NodeCollection));
    DocumentEditorFeatures.InlineCollection = InlineCollection;
    var TableColumnAdvCollection = (function (_super) {
        __extends(TableColumnAdvCollection, _super);
        function TableColumnAdvCollection() {
            _super.apply(this, arguments);
        }
        return TableColumnAdvCollection;
    }(List));
    DocumentEditorFeatures.TableColumnAdvCollection = TableColumnAdvCollection;
    var TableRowAdvCollection = (function (_super) {
        __extends(TableRowAdvCollection, _super);
        function TableRowAdvCollection() {
            _super.apply(this, arguments);
        }
        TableRowAdvCollection.prototype._CollectionChanged = function (node, added, nIndex) {
            if (added) {
                var index = nIndex;
                this._SetOwnerToNode(node, index);
                this._Layout();
            }
            else {
                if (node instanceof Node)
                    node._SetOwner(null);
                this._Layout();
            }
        };
        TableRowAdvCollection.prototype._Layout = function () {
            if (this.OwnerNode instanceof TableAdv) {
                var table = this.OwnerNode;
                while (table.IsInsideTable) {
                    table = table.AssociatedCell.OwnerTable;
                }
                if (table != null) {
                    var section = table.Section;
                    if (table.TableHolder != null) {
                        table._CalculateGridOnly();
                        table.IsTableGridUpdated = false;
                        table._CheckTableGrid();
                    }
                    if (section != null) {
                        var ownerDocument = section.Document;
                        var viewer = ownerDocument.OwnerControl.Viewer;
                        var tableIndex = section.Blocks._IndexOf(table);
                        if (tableIndex >= 0 && section.BaseParent != null
                            && section.BaseParent.IsLayoutEnabled)
                            section._Layout(tableIndex);
                    }
                }
            }
        };
        return TableRowAdvCollection;
    }(NodeCollection));
    DocumentEditorFeatures.TableRowAdvCollection = TableRowAdvCollection;
    var TableCellAdvCollection = (function (_super) {
        __extends(TableCellAdvCollection, _super);
        function TableCellAdvCollection() {
            _super.apply(this, arguments);
        }
        TableCellAdvCollection.prototype._CollectionChanged = function (node, added, nIndex) {
            if (added) {
                var index = nIndex;
                this._SetOwnerToNode(node, index);
                index++;
                this._Layout();
            }
            else {
                if (node instanceof Node)
                    node._SetOwner(null);
            }
        };
        TableCellAdvCollection.prototype._Layout = function () {
            if (this.OwnerNode instanceof TableRowAdv && this.OwnerNode.OwnerTable != null) {
                var table = this.OwnerNode.OwnerTable;
                while (table.IsInsideTable) {
                    table = table.AssociatedCell.OwnerTable;
                }
                if (table != null) {
                    var section = table.Section;
                    if (table.TableHolder != null) {
                        table._CalculateGridOnly();
                        table.IsTableGridUpdated = false;
                        table._CheckTableGrid();
                    }
                    if (section != null) {
                        var ownerDocument = section.Document;
                        var viewer = ownerDocument.OwnerControl.Viewer;
                        var tableIndex = section.Blocks._IndexOf(table);
                        if (tableIndex >= 0 && section.BaseParent != null
                            && section.BaseParent.IsLayoutEnabled)
                            section._Layout(tableIndex);
                    }
                }
            }
        };
        return TableCellAdvCollection;
    }(NodeCollection));
    DocumentEditorFeatures.TableCellAdvCollection = TableCellAdvCollection;
    var DocumentAdv = (function (_super) {
        __extends(DocumentAdv, _super);
        function DocumentAdv(node) {
            _super.call(this, node);
            this.defaultTabWidth = 48;
            this.backgroundColor = "#FFFFFF";
            this.ChildNodes = new SectionAdvCollection(this);
            this.lists = new ListAdvCollection(this);
            this.abstractLists = new AbstractListAdvCollection(this);
            this.renderedListLevels = new List();
            this.renderedLevelOverrides = new List();
            this.renderedLists = new Dictionary();
            this.characterFormat = new CharacterFormat(this);
            this.paragraphFormat = new ParagraphFormat(this);
            this.listParagraphs = new List();
        }
        Object.defineProperty(DocumentAdv.prototype, "Sections", {
            get: function () {
                return this.ChildNodes;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(DocumentAdv.prototype, "Lists", {
            get: function () {
                return this.lists;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(DocumentAdv.prototype, "AbstractLists", {
            get: function () {
                return this.abstractLists;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(DocumentAdv.prototype, "OwnerControl", {
            get: function () {
                return this.ownerControl;
            },
            set: function (owner) {
                this.ownerControl = owner;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(DocumentAdv.prototype, "DefaultTabWidth", {
            get: function () {
                return this.defaultTabWidth;
            },
            set: function (defaultTabWidth) {
                this.defaultTabWidth = defaultTabWidth;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(DocumentAdv.prototype, "DocumentStart", {
            get: function () {
                return this._GetDocumentStart();
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(DocumentAdv.prototype, "DocumentEnd", {
            get: function () {
                return this._GetDocumentEnd();
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(DocumentAdv.prototype, "BackgroundColor", {
            get: function () {
                return this.backgroundColor;
            },
            set: function (value) {
                this.backgroundColor = value;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(DocumentAdv.prototype, "CharacterFormat", {
            get: function () {
                return this.characterFormat;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(DocumentAdv.prototype, "ParagraphFormat", {
            get: function () {
                return this.paragraphFormat;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(DocumentAdv.prototype, "ListParagraphs", {
            get: function () {
                return this.listParagraphs;
            },
            set: function (value) {
                this.listParagraphs = value;
            },
            enumerable: true,
            configurable: true
        });
        DocumentAdv.prototype._SerializeDocument = function () {
            var document = { "Sections": [] };
            for (var i = 0; i < this.Sections.Count; i++) {
                var section = this.Sections[i];
                document.Sections[i] = section._SerializeSection();
            }
            return document;
        };
        DocumentAdv.prototype._SerializeAbstractList = function () {
            var AbstractLists = { "AbstractLists": [] };
            var ListCollections = this.AbstractLists;
            for (var i = 0; i < ListCollections.Count; i++) {
                var ListCollection = ListCollections[i];
                AbstractLists.AbstractLists[i] = ListCollection._SerializeListLevelAdvCollection();
            }
            return AbstractLists.AbstractLists;
        };
        DocumentAdv.prototype._SerializeList = function () {
            var Lists = { "Lists": [] };
            var ListCollections = this.Lists;
            for (var i = 0; i < ListCollections.length; i++) {
                var ListCollection = ListCollections[i];
                Lists.Lists[i] = {
                    "AbstractList": [], "ListId": [],
                    "AbstractListId": [], "LevelOverrides": []
                };
                var lists = Lists.Lists[i];
                lists.AbstractList = null;
                lists.ListId = ListCollection.ListId;
                lists.AbstractListId = ListCollection.AbstractListId;
                lists.LevelOverrides = ListCollection._SerializeLevelOverrides();
            }
            ;
            return Lists.Lists;
        };
        DocumentAdv.prototype._SerializeBackgroundColor = function () {
            var BackgroundColor = this.BackgroundColor;
            return BackgroundColor;
        };
        DocumentAdv.prototype._SerializeDefaultWidth = function () {
            var DefaultTabWidth = this.DefaultTabWidth;
            return DefaultTabWidth;
        };
        DocumentAdv.prototype._LayoutItems = function (viewer) {
            if (this.OwnerControl != null && this.OwnerControl.IsLayoutEnabled) {
                this._ClearWidgets();
                this.OwnerControl.Viewer._ClearContainer();
                viewer = this.ownerControl.Viewer;
                for (var i = 0; i < this.Sections.length; i++) {
                    var section = this.Sections[i];
                    section._LayoutItems(viewer);
                }
                viewer._UpdateScrollBars();
            }
        };
        DocumentAdv.prototype._ClearWidgets = function () {
            this.renderedListLevels._Clear();
            this.renderedLevelOverrides._Clear();
            this.renderedLists._Clear();
            for (var i = 0; i < this.Sections.Count; i++) {
                this.Sections[i]._ClearWidgets();
            }
        };
        DocumentAdv.prototype._UpdateListItems = function (block) {
            this.renderedLists._Clear();
            this.renderedListLevels._Clear();
            this.renderedLevelOverrides._Clear();
            if (block._IsInComment())
                return;
            for (var i = 0; i < this.Sections.Count; i++) {
                var isListUpdated = this.Sections[i]._UpdateListItems(block);
                if (isListUpdated)
                    break;
            }
        };
        DocumentAdv.prototype._Dispose = function () {
            if (this.ownerControl != null) {
                this.ownerControl = null;
            }
            if (this.ChildNodes != null) {
                this.ChildNodes._Dispose();
                for (var i = 0; i < this.Sections.Count; i++) {
                    var section = this.Sections[i];
                    section._Dispose();
                    this.Sections._Remove(section);
                    i--;
                }
            }
            if (this.renderedListLevels != null) {
                this.renderedListLevels._Clear();
                this.renderedListLevels = null;
            }
            if (this.renderedLists != null) {
                this.renderedLists._Clear();
                this.renderedLists = null;
            }
            if (this.Lists != null) {
                for (var i = 0; i < this.Lists.Count; i++) {
                    var list = this.Lists[i];
                    list._Dispose();
                    this.lists._Remove(list);
                    i--;
                }
                this.lists._Dispose();
                this.lists = null;
            }
            if (this.AbstractLists != null) {
                for (var i = 0; i < this.AbstractLists.Count; i++) {
                    var abstractList = this.AbstractLists[i];
                    abstractList._Dispose();
                    this.abstractLists._Remove(abstractList);
                    i--;
                }
                this.abstractLists._Dispose();
                this.abstractLists = null;
            }
            this.Fields = null;
            this.FieldCharacter = null;
        };
        DocumentAdv.prototype._GetListByID = function (id) {
            if (this.Lists == null)
                return null;
            for (var i = 0; i < this.Lists.length; i++) {
                if (this.Lists[i] != null && this.Lists[i].ListId == id)
                    return this.Lists[i];
            }
            return null;
        };
        DocumentAdv.prototype._GetAbstractListAdvByID = function (id) {
            if (this.AbstractLists == null)
                return null;
            for (var i = 0; i < this.AbstractLists.length; i++) {
                if (this.AbstractLists[i] != null && this.AbstractLists[i].AbstractListId == id)
                    return this.AbstractLists[i];
            }
            return null;
        };
        DocumentAdv.prototype._AddListLevel = function (abstractList) {
            for (var i = abstractList.Levels.Count; i < 9; i++) {
                var listLevel = new ListLevelAdv(abstractList);
                var val = i % 3;
                if (abstractList.Levels[0].ListLevelPattern == ListLevelPattern.Bullet) {
                    listLevel.ListLevelPattern = ListLevelPattern.Bullet;
                    listLevel.NumberFormat = val == 0 ? ListLevelAdv.DOTBULLET : val == 1 ? ListLevelAdv.SQUAREBULLET : ListLevelAdv.ARROWBULLET;
                    listLevel.CharacterFormat.FontFamily = listLevel.NumberFormat == ListLevelAdv.SQUAREBULLET ? "Wingdings" : "Symbol";
                }
                else {
                    listLevel.ListLevelPattern = val;
                    listLevel.NumberFormat = "%" + (i + 1).toString() + ".";
                    listLevel.StartAt = 1;
                    listLevel.RestartLevel = i;
                }
                listLevel.ParagraphFormat = new ParagraphFormat(listLevel);
                listLevel.ParagraphFormat.LeftIndent = 48 * (i + 1);
                listLevel.ParagraphFormat.FirstLineIndent = -24;
                abstractList.Levels._Add(listLevel);
            }
        };
        DocumentAdv.prototype._GetListNumber = function (listFormat) {
            var listAdv = listFormat.List;
            var levelNumber = listFormat.ListLevelNumber;
            var listLevel = listFormat.ListLevel;
            var levelOverrideAdv = listAdv.LevelOverrides != null ? listAdv.LevelOverrides._Get(levelNumber) : null;
            if (levelOverrideAdv != null && !this.renderedLevelOverrides._Contains(levelOverrideAdv) && levelOverrideAdv.OverrideListLevel == null) {
                this.renderedLevelOverrides._Add(listAdv.LevelOverrides[levelNumber]);
                if (this.renderedListLevels._Contains(listLevel))
                    this.renderedListLevels._Remove(listLevel);
                if (this.renderedLists._ContainsKey(listAdv.AbstractList)) {
                    var levels = this.renderedLists._Get(listAdv.AbstractList);
                    if (levels._ContainsKey(levelNumber))
                        levels._Remove(levelNumber);
                }
            }
            this._UpdateListValues(listAdv, levelNumber);
            return this._GetListText(listAdv, levelNumber, listLevel);
        };
        DocumentAdv.prototype._UpdateListValues = function (listAdv, listLevelNumber) {
            if (!this.renderedLists._ContainsKey(listAdv.AbstractList)) {
                var startVal = new Dictionary();
                this.renderedLists._Add(listAdv.AbstractList, startVal);
                var listLevel = listAdv._GetListLevel(listLevelNumber);
                for (var i = 0; i <= listLevelNumber; i++) {
                    startVal._Add(i, listAdv._GetListStartValue(i));
                }
            }
            else {
                var levels = this.renderedLists._Get(listAdv.AbstractList);
                if (levels._ContainsKey(listLevelNumber)) {
                    var startAt = levels._Get(listLevelNumber);
                    levels._Set(listLevelNumber, startAt + 1);
                    var levelNumber = listLevelNumber + 1;
                    while (levelNumber < listAdv.AbstractList.Levels.Count) {
                        var listLevel = listAdv._GetListLevel(levelNumber);
                        if (listLevel != null) {
                            if (levels._ContainsKey(levelNumber) && listLevel.RestartLevel > listLevelNumber) {
                                levels._Remove(levelNumber);
                                if (this.renderedListLevels._Contains(listLevel))
                                    this.renderedListLevels._Remove(listLevel);
                            }
                        }
                        levelNumber++;
                    }
                }
                else {
                    var levelNumber = listLevelNumber;
                    while (!levels._ContainsKey(levelNumber - 1) && levelNumber > 0) {
                        var listLevel = listAdv._GetListLevel(levelNumber - 1);
                        if (listLevel != null) {
                            levels._Add(levelNumber - 1, listAdv._GetListStartValue(levelNumber - 1));
                            if (!this.renderedListLevels._Contains(listLevel))
                                this.renderedListLevels._Add(listLevel);
                        }
                        levelNumber--;
                    }
                    var startAt = listAdv._GetListStartValue(listLevelNumber);
                    levels._Add(listLevelNumber, startAt);
                }
            }
        };
        DocumentAdv.prototype._GetListText = function (listAdv, listLevelNumber, currentListLevel) {
            var listText = currentListLevel.NumberFormat;
            if (this.renderedLists._ContainsKey(listAdv.AbstractList)) {
                var levels = this.renderedLists._Get(listAdv.AbstractList);
                var keys = levels.Keys;
                for (var i = 0; i < keys.length; i++) {
                    var levelNumber = keys[i];
                    var levelKey = "%" + (levelNumber + 1).toString();
                    var listLevel = listAdv._GetListLevel(levelNumber);
                    if (listText.match(levelKey)) {
                        if (levelNumber > listLevelNumber)
                            return "";
                        else if (levels._ContainsKey(levelNumber) && listLevel != null)
                            listText = listText.replace(levelKey, listLevel._GetListText(levels._Get(levelNumber)));
                        else
                            listText = listText.replace(levelKey, "0");
                    }
                }
            }
            return listText;
        };
        DocumentAdv.prototype._GetDocumentStart = function () {
            if (this.Sections.length == 0 || this.Sections[0].Blocks.length == 0)
                return null;
            var textPosition = null;
            var block = this.Sections[0].Blocks[0];
            if (block instanceof TableAdv)
                block = block._GetFirstParagraphInFirstCell();
            else
                block = this.Sections[0].Blocks[0];
            if (block instanceof ParagraphAdv) {
                textPosition = new TextPosition(this.OwnerControl);
                textPosition._SetPosition(block, true);
            }
            return textPosition;
        };
        DocumentAdv.prototype._GetDocumentEnd = function () {
            var textPosition = null;
            var documentStart = this.DocumentStart;
            if (documentStart != null && this.Sections.Count > 0) {
                var block = null;
                var lastBlock = this.Sections._Last().Blocks._Last();
                if (lastBlock instanceof BlockAdv)
                    block = lastBlock;
                var prevBlock = block;
                if (!this.OwnerControl.IsDocumentLoaded) {
                    if (prevBlock != null)
                        prevBlock = block.PreviousBlock;
                    if (prevBlock == null && this.Sections.Count > 1) {
                        lastBlock = this.Sections[this.Sections.Count - 2].Blocks._Last();
                        prevBlock = (lastBlock instanceof BlockAdv) ? lastBlock : null;
                    }
                }
                if (prevBlock != null)
                    block = prevBlock;
                if (block instanceof TableAdv)
                    block = block._GetLastParagraphInLastCell();
                if (block instanceof ParagraphAdv) {
                    var offset = prevBlock == null ? 0 : block._GetEndOffset();
                    textPosition = new TextPosition(this.OwnerControl);
                    textPosition._SetPositionParagraph(block, offset);
                }
                else {
                    textPosition = new TextPosition(this.OwnerControl);
                    textPosition._SetPositionParagraph(documentStart.Paragraph, documentStart.Paragraph._GetEndOffset());
                }
            }
            return textPosition;
        };
        DocumentAdv.prototype._Find = function (pattern, option, isFirstMatch, results) {
            if (this.Sections.Count == 0 || HelperMethods._IsPatternEmpty(pattern))
                return;
            var inline = null;
            var selectionEnd = null;
            var commentIndex = 0;
            if (this.OwnerControl.Selection != null && this.OwnerControl.Selection.End != null)
                selectionEnd = this.OwnerControl.Selection.End;
            if (isFirstMatch && selectionEnd != null && selectionEnd.Paragraph != null) {
                var indexInInline = 0;
                var inlineObject = selectionEnd.Paragraph._GetInline(this.OwnerControl.Selection.End.Offset, indexInInline);
                inline = inlineObject.inline;
                indexInInline = inlineObject.index;
                if (inline != null) {
                    inline._Find(pattern, option, indexInInline, isFirstMatch, selectionEnd, results);
                    if (results.Count > 0)
                        return;
                    var comment = inline.OwnerParagraph._GetOwnerComment();
                    if (comment != null) {
                        commentIndex = this.Comments._IndexOf(comment);
                        commentIndex = commentIndex + 1;
                    }
                    for (var i = commentIndex; i < this.Comments.Count; i++) {
                        var commentblock = this.Comments[i].Blocks[0];
                        var commentparagraph = commentblock._GetFirstParagraph();
                        inline = commentparagraph.Inlines[0];
                        inline._Find(pattern, option, 0, isFirstMatch, selectionEnd, results);
                        if (results.Count > 0)
                            return;
                    }
                }
            }
            var section = this.Sections[0];
            while (section != null && section.Blocks.Count == 0)
                section = (section.NextNode instanceof SectionAdv) ? section.NextNode : null;
            if (section == null || section.Blocks.Count == 0)
                return;
            var block = section.Blocks[0];
            var paragraph = null;
            if (block instanceof ParagraphAdv)
                paragraph = block._GetFirstParagraph();
            while (paragraph != null && paragraph.Inlines.Count == 0)
                paragraph = paragraph._GetNextParagraph();
            if (paragraph == null || paragraph.Inlines.Count == 0)
                return;
            var inlineCollection = paragraph.Inlines[0];
            inlineCollection._Find(pattern, option, 0, isFirstMatch, selectionEnd, results);
            if (this.Comments.Count > 0) {
                if (!isFirstMatch)
                    commentIndex = this.Comments.Count;
                for (var i = 0; i < commentIndex; i++) {
                    block = this.Comments[i].Blocks[0];
                    paragraph = block._GetFirstParagraph();
                    paragraph.Inlines[0]._Find(pattern, option, 0, isFirstMatch, selectionEnd, results);
                    if (isFirstMatch && results.Count > 0)
                        return;
                }
            }
        };
        DocumentAdv.prototype._ApplyListChanges = function (baseHistoryInfo, modifiedLevels) {
            if (this.modifiedParaFormats == null)
                this.modifiedParaFormats = new Dictionary();
            var collection = new ModifiedParagraphFormatCollection();
            for (var i = 0; i < this.ListParagraphs.Count; i++) {
                var paragraph = this.ListParagraphs[i];
                var paraFormat = paragraph.ParagraphFormat;
                var listLevel = paraFormat.ListFormat.ListLevel;
                if (modifiedLevels.ModifiedLevels._ContainsKey(paraFormat.ListFormat.ListLevelNumber) && modifiedLevels.ModifiedLevels._Get(paraFormat.ListFormat.ListLevelNumber).OwnerListLevel == listLevel) {
                    var modifiedFormat = new ParagraphFormat(null);
                    modifiedFormat.LeftIndent = paraFormat.LeftIndent;
                    modifiedFormat.FirstLineIndent = paraFormat.FirstLineIndent;
                    var modified = new ModifiedParagraphFormat(paraFormat, modifiedFormat);
                    collection.ModifiedFormats._Add(modified);
                    paraFormat._CopyFromListLevelParagrahFormat(listLevel.ParagraphFormat);
                }
            }
            this.modifiedParaFormats._Add(baseHistoryInfo, collection);
        };
        DocumentAdv.prototype._RevertListChanges = function (baseHistoryInfo) {
            if (this.modifiedParaFormats._ContainsKey(baseHistoryInfo)) {
                var collection = this.modifiedParaFormats._Get(baseHistoryInfo);
                for (var i = 0; i < collection.ModifiedFormats.Count; i++) {
                    var modified = new ParagraphFormat(null);
                    modified.LeftIndent = collection.ModifiedFormats[i].OwnerFormat.LeftIndent;
                    modified.FirstLineIndent = collection.ModifiedFormats[i].OwnerFormat.FirstLineIndent;
                    collection.ModifiedFormats[i].OwnerFormat._CopyFormat(collection.ModifiedFormats[i].ModifiedFormat);
                    collection.ModifiedFormats[i].ModifiedFormat.LeftIndent = modified.LeftIndent;
                    collection.ModifiedFormats[i].ModifiedFormat.FirstLineIndent = modified.FirstLineIndent;
                }
            }
        };
        DocumentAdv.prototype._UpdateListParagraphs = function () {
            this.ListParagraphs._Clear();
            for (var i = 0; i < this.Sections.Count; i++) {
                this.Sections[i]._UpdateListParagraphs();
            }
        };
        return DocumentAdv;
    }(CompositeNode));
    DocumentEditorFeatures.DocumentAdv = DocumentAdv;
    var SectionAdv = (function (_super) {
        __extends(SectionAdv, _super);
        function SectionAdv(node) {
            _super.call(this, node);
            this.BodyWidgets = new List();
            this.ChildNodes = new BlockAdvCollection(this);
            this.headerFooters = new HeaderFooters(this);
            this.sectionformat = new SectionFormat(this);
        }
        Object.defineProperty(SectionAdv.prototype, "Blocks", {
            get: function () {
                return this.ChildNodes;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(SectionAdv.prototype, "HeaderFooters", {
            get: function () {
                return this.headerFooters;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(SectionAdv.prototype, "SectionFormat", {
            get: function () {
                return this.sectionformat;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(SectionAdv.prototype, "Document", {
            get: function () {
                return this.Owner;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(SectionAdv.prototype, "BaseParent", {
            get: function () {
                if (this.Document != null)
                    return this.Document.OwnerControl;
                return null;
            },
            enumerable: true,
            configurable: true
        });
        SectionAdv.prototype._SerializeSection = function () {
            var section = { "Blocks": [], "SectionFormat": [], "HeaderFooters": [] };
            section.SectionFormat = this.SectionFormat._SerializeSectionFormat();
            section.HeaderFooters = this._SerializeHeaderFooters();
            for (var i = 0; i < this.Blocks.Count; i++) {
                var block = this.Blocks[i];
                if (block instanceof ParagraphAdv)
                    section.Blocks[i] = block._SerializeBlock();
                else if (block instanceof TableAdv)
                    section.Blocks[i] = block._SerializeBlock();
            }
            return section;
        };
        SectionAdv.prototype._Clone = function () {
            var section = new SectionAdv(null);
            section.SectionFormat._CopyFormat(this.SectionFormat);
            this.HeaderFooters._CloneItemsTo(section.HeaderFooters);
            for (var i = 0; i < this.Blocks.Count; i++) {
                var block = this.Blocks[i];
                section.Blocks._Add(block._Clone());
            }
            return section;
        };
        SectionAdv.prototype._AddBodyWidget = function (area) {
            var bodyWidget = new BodyWidget(this);
            bodyWidget.Width = area.Width;
            bodyWidget.X = area.X;
            bodyWidget.Y = area.Y;
            this.BodyWidgets._Add(bodyWidget);
            return bodyWidget;
        };
        SectionAdv.prototype._LayoutItems = function (viewer) {
            viewer._CreateNewPage(this);
            for (var i = 0; i < this.Blocks.length; i++) {
                var block = this.Blocks[i];
                viewer._UpdateClientAreaForBlock(block, true);
                block._LayoutItems(viewer);
                viewer._UpdateClientAreaForBlock(block, false);
            }
        };
        SectionAdv.prototype._GetCurrentHeaderFooter = function (type) {
            if (this.HeaderFooters.ChildNodes[type].Blocks.length == 0 && this.PreviousNode != null) {
                return this.PreviousNode._GetCurrentHeaderFooter(type);
            }
            return this.HeaderFooters.ChildNodes[type];
        };
        SectionAdv.prototype._GetPreviousParagraph = function () {
            if (this.PreviousNode instanceof SectionAdv) {
                var block = this.PreviousNode.Blocks[this.PreviousNode.Blocks.Count - 1];
                if (block instanceof ParagraphAdv)
                    return block;
                else
                    return block._GetLastParagraphInLastCell();
            }
            return null;
        };
        SectionAdv.prototype._GetNextParagraph = function () {
            if (this.NextNode instanceof SectionAdv) {
                var block = this.NextNode.Blocks[0];
                if (block instanceof ParagraphAdv)
                    return block;
                else
                    return block._GetFirstParagraphInFirstCell();
            }
            return null;
        };
        SectionAdv.prototype._GetPreviousBlock = function () {
            if (this.PreviousNode instanceof SectionAdv)
                return this.PreviousNode.Blocks[this.PreviousNode.Blocks.Count - 1];
            return null;
        };
        SectionAdv.prototype._GetNextSelection = function (selection) {
            if (this.NextNode instanceof SectionAdv) {
                var block = this.NextNode.Blocks[0];
                if (block instanceof ParagraphAdv)
                    return block;
                else {
                    if (selection.IsEmpty || selection.IsForward)
                        return block._GetLastParagraphInFirstRow();
                    else
                        return block.Rows[0]._GetNextParagraphSelection(selection);
                }
            }
            return null;
        };
        SectionAdv.prototype._GetPreviousSelection = function (selection) {
            if (this.PreviousNode instanceof SectionAdv) {
                var block = this.PreviousNode.Blocks[this.PreviousNode.Blocks.Count - 1];
                if (block instanceof ParagraphAdv)
                    return block;
                else {
                    if (!selection.IsForward)
                        return block._GetFirstParagraphInLastRow();
                    else
                        return block.Rows[block.Rows.Count - 1]._GetPreviousParagraphSelection(selection);
                }
            }
            return null;
        };
        SectionAdv.prototype._UpdateListItems = function (block) {
            for (var i = 0; i < this.Blocks.Count; i++) {
                var isListUpdated = this.Blocks[i]._UpdateListItems(block);
                if (isListUpdated)
                    return true;
            }
            return false;
        };
        SectionAdv.prototype._UpdateListParagraphs = function () {
            for (var i = 0; i < this.Blocks.Count; i++)
                this.Blocks[i]._UpdateListParagraphs();
        };
        SectionAdv.prototype._CombineSection = function (selection, nextSection) {
            this.Document.Sections._Remove(this);
            var insertIndex = 0;
            for (var i = 0; i < this.Blocks.Count; i++, insertIndex++) {
                var block = this.Blocks[i];
                nextSection.Blocks._Insert(insertIndex, block);
                i--;
            }
        };
        SectionAdv.prototype._Layout = function (blockIndex) {
            this._LayoutItem(blockIndex, false);
        };
        SectionAdv.prototype._LayoutItem = function (blockIndex, ShiftNextWidget) {
            var ownerDocument = this.Document;
            var viewer = ownerDocument.OwnerControl.Viewer;
            if (viewer.FieldEndParagraph != null && viewer.FieldEndParagraph.BaseParent == null && blockIndex < this.Blocks.Count) {
                viewer.FieldEndParagraph = this.Blocks[blockIndex] instanceof ParagraphAdv ? this.Blocks[blockIndex]
                    : this.Blocks[blockIndex]._GetFirstParagraphInFirstCell();
            }
            if (viewer.FieldToLayout != null) {
                var ownerParagraph = viewer.FieldToLayout.OwnerParagraph;
                var fieldBegin = viewer.FieldToLayout;
                viewer.FieldToLayout = null;
                if (ownerParagraph != null && ownerParagraph.BaseParent != null) {
                    ownerParagraph._RelayoutParagraph(fieldBegin._GetIndexInOwnerCollection());
                    return;
                }
            }
            if (viewer.Pages.Count == 0)
                viewer._CreateNewPage(this);
            viewer._UpdateClientArea(this.SectionFormat);
            if (blockIndex > 0) {
                var prevWidget = void 0;
                if (this.Blocks[blockIndex - 1] instanceof ParagraphAdv)
                    prevWidget = this.Blocks[blockIndex - 1].ParagraphWidgets[this.Blocks[blockIndex - 1].ParagraphWidgets.Count - 1];
                else
                    prevWidget = this.Blocks[blockIndex - 1].TableWidgets[this.Blocks[blockIndex - 1].TableWidgets.Count - 1];
                viewer._CutFromTop(prevWidget.Y + prevWidget.Height);
            }
            if (blockIndex < 0)
                blockIndex = 0;
            if (blockIndex < this.Blocks.Count) {
                var block = this.Blocks[blockIndex];
                if ((ownerDocument.OwnerControl.IsDocumentLoaded) && !ownerDocument.OwnerControl.IsPastingContent)
                    ownerDocument._UpdateListItems(block);
                block._ClearWidgets();
                if (viewer.Pages.Count == 0)
                    viewer._CreateNewPage(this);
                viewer._UpdateClientAreaForBlock(block, true);
                block._LayoutItems(viewer);
                viewer._UpdateClientAreaForBlock(block, false);
                if (ShiftNextWidget)
                    block._ShiftNextWidgets();
                else
                    block._LayoutNextItems(viewer);
            }
        };
        SectionAdv.prototype._SplitSection = function (newSection, splitBlock) {
            for (var i = 0; i < this.Blocks.Count; i++) {
                var block = this.Blocks[i];
                if (block == splitBlock)
                    break;
                block._RemoveBlock();
                newSection.Blocks._Add(block);
                i--;
            }
            var insertIndex = this._GetIndexInOwnerCollection();
            this.Document.Sections._Insert(insertIndex, newSection);
        };
        SectionAdv.prototype._ClearWidgets = function () {
            if (this.HeaderFooters != null) {
                for (var i = 0; i < this.HeaderFooters.ChildNodes.Count; i++) {
                    this.HeaderFooters.ChildNodes[i]._ClearWidgets();
                }
            }
            for (var i = 0; i < this.BodyWidgets.Count; i++) {
                var widget = this.BodyWidgets[i];
                widget._Dispose();
                this.BodyWidgets._Remove(widget);
                i--;
            }
        };
        SectionAdv.prototype._Dispose = function () {
            this.SectionFormat._Dispose();
            this.HeaderFooters._Dispose();
            this._SetOwner(null);
            if (this.BodyWidgets != null) {
                for (var i = 0; i < this.BodyWidgets.Count; i++) {
                    var widget = this.BodyWidgets[i];
                    widget._Dispose();
                    this.BodyWidgets._Remove(widget);
                    i--;
                }
                this.BodyWidgets = null;
            }
            if (this.Blocks != null) {
                this.Blocks._Dispose();
                for (var i = 0; i < this.Blocks.Count; i++) {
                    var block = this.Blocks[i];
                    block._Dispose();
                    this.Blocks._Remove(block);
                    i--;
                }
                this.ChildNodes = null;
            }
            this.Fields = null;
            this.FieldCharacter = null;
        };
        SectionAdv.prototype._SerializeHeaderFooters = function () {
            var HeaderFootersCollection = {};
            var InHeadersFooters = this.HeaderFooters;
            HeaderFootersCollection = InHeadersFooters._SerializeHeaderFooter();
            return HeaderFootersCollection;
        };
        return SectionAdv;
    }(CompositeNode));
    DocumentEditorFeatures.SectionAdv = SectionAdv;
    var HeaderFooter = (function (_super) {
        __extends(HeaderFooter, _super);
        function HeaderFooter(node) {
            _super.call(this, node);
            this.ChildNodes = new BlockAdvCollection(this);
            this.LayoutedWidgets = new List();
        }
        Object.defineProperty(HeaderFooter.prototype, "Blocks", {
            get: function () {
                return this.ChildNodes;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(HeaderFooter.prototype, "Type", {
            get: function () {
                return this.type;
            },
            set: function (type) {
                this.type = type;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(HeaderFooter.prototype, "Document", {
            get: function () {
                if (this.Section == null)
                    return null;
                return this.Section.Document;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(HeaderFooter.prototype, "Section", {
            get: function () {
                if (this.Owner instanceof HeaderFooters)
                    return this.Owner.Section;
                return null;
            },
            enumerable: true,
            configurable: true
        });
        HeaderFooter.prototype._CloneItemsTo = function (headerfooter) {
            for (var i = 0; i < this.Blocks.Count; i++) {
                var block = this.Blocks[i];
                headerfooter.Blocks._Add(block._Clone());
            }
        };
        HeaderFooter.prototype._LayoutItems = function (viewer) {
            var widget = new HeaderFooterWidget(this);
            widget.Page = viewer.CurrentRenderingPage;
            this.LayoutedWidgets._Add(widget);
            widget._UpdateClientAreaLocation(viewer.ClientActiveArea);
            for (var i = 0; i < this.Blocks.length; i++) {
                var block = this.Blocks[i];
                if (block instanceof TableAdv)
                    block.TableWidgets._Clear();
                viewer._UpdateClientAreaForBlock(block, true);
                block._LayoutItems(viewer);
                viewer._UpdateClientAreaForBlock(block, false);
            }
            widget.Height = viewer.ClientActiveArea.Top - viewer.ClientArea.Top;
            if (this.type == HeaderFooterType.OddFooter || this.type == HeaderFooterType.EvenFooter || this.type == HeaderFooterType.FirstPageFooter) {
                widget._ShiftChildLocation(viewer.ClientArea.Top - viewer.ClientActiveArea.Top);
            }
            return widget;
        };
        HeaderFooter.prototype._ClearWidgets = function () {
            for (var i = 0; i < this.LayoutedWidgets.Count; i++) {
                var widget = this.LayoutedWidgets[i];
                widget._Dispose();
                this.LayoutedWidgets._Remove(widget);
                i--;
            }
        };
        HeaderFooter.prototype._Dispose = function () {
            this._SetOwner(null);
            if (this.Blocks != null) {
                this.Blocks._Dispose();
                for (var i = 0; i < this.Blocks.Count; i++) {
                    var block = this.Blocks[i];
                    block._Dispose();
                    this.Blocks._Remove(block);
                    i--;
                }
                this.ChildNodes = null;
            }
            this.Fields = null;
            this.FieldCharacter = null;
            if (this.LayoutedWidgets != null) {
                this._ClearWidgets();
                this.LayoutedWidgets = null;
            }
        };
        return HeaderFooter;
    }(CompositeNode));
    DocumentEditorFeatures.HeaderFooter = HeaderFooter;
    var HeaderFooters = (function (_super) {
        __extends(HeaderFooters, _super);
        function HeaderFooters(node) {
            _super.call(this, node);
            this.ChildNodes = new HeaderFooterCollection(this);
            var evenheader = new HeaderFooter(null);
            evenheader.Type = HeaderFooterType.EvenHeader;
            this.ChildNodes._Add(evenheader);
            var header = new HeaderFooter(null);
            header.Type = HeaderFooterType.OddHeader;
            this.ChildNodes._Add(header);
            var evenfooter = new HeaderFooter(null);
            evenfooter.Type = HeaderFooterType.EvenFooter;
            this.ChildNodes._Add(evenfooter);
            var footer = new HeaderFooter(null);
            footer.Type = HeaderFooterType.OddFooter;
            this.ChildNodes._Add(footer);
            var firstpageheader = new HeaderFooter(null);
            firstpageheader.Type = HeaderFooterType.FirstPageHeader;
            this.ChildNodes._Add(firstpageheader);
            var firstpagefooter = new HeaderFooter(null);
            firstpagefooter.Type = HeaderFooterType.FirstPageFooter;
            this.ChildNodes._Add(firstpagefooter);
        }
        Object.defineProperty(HeaderFooters.prototype, "EvenHeader", {
            get: function () {
                return this.ChildNodes[0];
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(HeaderFooters.prototype, "Header", {
            get: function () {
                return this.ChildNodes[1];
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(HeaderFooters.prototype, "EvenFooter", {
            get: function () {
                return this.ChildNodes[2];
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(HeaderFooters.prototype, "Footer", {
            get: function () {
                return this.ChildNodes[3];
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(HeaderFooters.prototype, "FirstPageHeader", {
            get: function () {
                return this.ChildNodes[4];
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(HeaderFooters.prototype, "FirstPageFooter", {
            get: function () {
                return this.ChildNodes[5];
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(HeaderFooters.prototype, "Document", {
            get: function () {
                if (this.Section == null)
                    return null;
                return this.Section.Document;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(HeaderFooters.prototype, "Section", {
            get: function () {
                return this.Owner;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(HeaderFooters.prototype, "BaseParent", {
            get: function () {
                if (this.Document != null)
                    return this.Document.OwnerControl;
                return null;
            },
            enumerable: true,
            configurable: true
        });
        HeaderFooters.prototype._Dispose = function () {
            this._SetOwner(null);
            if (this.ChildNodes != null) {
                this.ChildNodes._Dispose();
                for (var i = 0; i < this.ChildNodes.Count; i++) {
                    var headerFooter = this.ChildNodes[i];
                    headerFooter._Dispose();
                    this.ChildNodes._Remove(headerFooter);
                    i--;
                }
                this.ChildNodes = null;
            }
            this.Fields = null;
            this.FieldCharacter = null;
        };
        HeaderFooters.prototype._CloneItemsTo = function (headerfooters) {
            this.FirstPageHeader._CloneItemsTo(headerfooters.FirstPageHeader);
            this.FirstPageFooter._CloneItemsTo(headerfooters.FirstPageFooter);
            this.Header._CloneItemsTo(headerfooters.Header);
            this.Footer._CloneItemsTo(headerfooters.Footer);
            this.EvenHeader._CloneItemsTo(headerfooters.EvenHeader);
            this.EvenFooter._CloneItemsTo(headerfooters.EvenFooter);
        };
        HeaderFooters.prototype._SerializeHeaderFooter = function () {
            var headerFooterObj = {
                "EvenHeader": [], "EvenFooter": [], "FirstPageFooter": [],
                "FirstPageHeader": [], "Footer": [], "Header": []
            };
            headerFooterObj.EvenHeader = this._ParseHeaderFooter(this.EvenHeader, headerFooterObj.EvenHeader);
            headerFooterObj.EvenFooter = this._ParseHeaderFooter(this.EvenFooter, headerFooterObj.EvenFooter);
            headerFooterObj.FirstPageFooter = this._ParseHeaderFooter(this.FirstPageFooter, headerFooterObj.FirstPageFooter);
            headerFooterObj.FirstPageHeader = this._ParseHeaderFooter(this.FirstPageHeader, headerFooterObj.FirstPageHeader);
            headerFooterObj.Footer = this._ParseHeaderFooter(this.Footer, headerFooterObj.Footer);
            headerFooterObj.Header = this._ParseHeaderFooter(this.Header, headerFooterObj.Header);
            return headerFooterObj;
        };
        HeaderFooters.prototype._ParseHeaderFooter = function (Header, headerFooterObj) {
            if (Header.Blocks.Count > 0) {
                headerFooterObj = { "Blocks": [], "Type": [] };
                var Blocks = Header.Blocks;
                headerFooterObj.Type = Header.Type;
                for (var i = 0; i < Blocks.Count; i++) {
                    var paragraph = Blocks[i];
                    if (paragraph instanceof ParagraphAdv)
                        headerFooterObj.Blocks[i] = paragraph._SerializeBlock();
                    else if (paragraph instanceof TableAdv)
                        headerFooterObj.Blocks[i] = paragraph._SerializeBlock();
                }
                return headerFooterObj;
            }
            return null;
        };
        return HeaderFooters;
    }(CompositeNode));
    DocumentEditorFeatures.HeaderFooters = HeaderFooters;
    var BlockAdv = (function (_super) {
        __extends(BlockAdv, _super);
        function BlockAdv() {
            _super.apply(this, arguments);
        }
        Object.defineProperty(BlockAdv.prototype, "PreviousBlock", {
            get: function () {
                var block = this.PreviousNode;
                return block;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(BlockAdv.prototype, "NextBlock", {
            get: function () {
                return this.NextNode;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(BlockAdv.prototype, "Section", {
            get: function () {
                if (this.Owner instanceof TableCellAdv)
                    return this.Owner.Section;
                if (this.Owner instanceof HeaderFooter)
                    return this.Owner.Section;
                if (this.Owner instanceof CommentAdv && this.Owner.Owner instanceof ParagraphAdv)
                    return this.Owner.Owner.Section;
                return this.Owner;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(BlockAdv.prototype, "IsInsideTable", {
            get: function () {
                return this.Owner instanceof TableCellAdv;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(BlockAdv.prototype, "AssociatedCell", {
            get: function () {
                if (this.Owner instanceof TableCellAdv)
                    return this.Owner;
                return null;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(BlockAdv.prototype, "Document", {
            get: function () {
                if (this.Section != null)
                    return this.Section.Document;
                else if (this._IsInComment())
                    return this._GetOwnerDocument();
                return null;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(BlockAdv.prototype, "IsInHeaderFooter", {
            get: function () {
                if (this.Owner instanceof TableCellAdv)
                    return this.Owner.IsInHeaderFooter;
                return this.Owner instanceof HeaderFooter;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(BlockAdv.prototype, "LeftIndent", {
            get: function () {
                var blockAdv = this;
                if (blockAdv instanceof ParagraphAdv && blockAdv.ParagraphFormat instanceof ParagraphFormat)
                    return blockAdv.ParagraphFormat.LeftIndent;
                if (blockAdv instanceof TableAdv && blockAdv.TableFormat instanceof TableFormat)
                    return blockAdv.TableFormat.LeftIndent;
                return 0;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(BlockAdv.prototype, "RightIndent", {
            get: function () {
                var blockAdv = this;
                if (blockAdv instanceof ParagraphAdv && blockAdv.ParagraphFormat instanceof ParagraphFormat)
                    return blockAdv.ParagraphFormat.RightIndent;
                return 0;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(BlockAdv.prototype, "BaseParent", {
            get: function () {
                if (this.Section != null)
                    return this.Section.BaseParent;
                return null;
            },
            enumerable: true,
            configurable: true
        });
        BlockAdv.prototype._UpdateWidgetsToBody = function (viewer, curWidget) {
            var block = this;
            var containerWidget = null;
            if (viewer.CurrentHeaderFooter == null) {
                if (curWidget.ContainerWidget != null
                    && curWidget.ContainerWidget.ChildWidgets._Contains(curWidget)) {
                    curWidget.ContainerWidget.ChildWidgets._Remove(curWidget);
                    curWidget.ContainerWidget.Height -= curWidget.Height;
                }
                var bodyWidget = null;
                var bodyWidgets = null;
                if (viewer.CurrentComment == null) {
                    if (viewer instanceof FlowLayoutViewer && viewer.CurrentPage != null)
                        bodyWidgets = viewer.CurrentPage.BodyWidgets;
                    else
                        bodyWidgets = this.Section.BodyWidgets;
                }
                else
                    bodyWidget = viewer.CurrentComment.LayoutedWidget;
                var widgets = void 0;
                if (block instanceof ParagraphAdv)
                    widgets = block.ParagraphWidgets;
                else
                    widgets = block.TableWidgets;
                if (widgets.Count > 1 && viewer.CurrentComment == null) {
                    var prevBodyWidget = null;
                    containerWidget = widgets[widgets.Count - 2].ContainerWidget;
                    if (containerWidget instanceof BodyWidget)
                        prevBodyWidget = containerWidget;
                    var prevIndex = bodyWidgets._IndexOf(prevBodyWidget);
                    if (prevIndex + 1 < bodyWidgets.Count)
                        bodyWidget = bodyWidgets[prevIndex + 1];
                    else
                        bodyWidget = bodyWidgets[bodyWidgets.Count - 1];
                    bodyWidget.ChildWidgets._Insert(0, curWidget);
                    curWidget.ContainerWidget = bodyWidget;
                    bodyWidget.Height += curWidget.Height;
                }
                else {
                    var prevBodyWidget = null;
                    var index = 0;
                    var prevWidget = null;
                    var topBorderWidth = 0;
                    if (curWidget instanceof TableWidget)
                        topBorderWidth = curWidget.TopBorderWidth;
                    if (this.PreviousBlock instanceof ParagraphAdv) {
                        prevWidget = this.PreviousBlock.ParagraphWidgets[this.PreviousBlock.ParagraphWidgets.Count - 1];
                        containerWidget = prevWidget.ContainerWidget;
                        prevBodyWidget = (containerWidget instanceof BodyWidget) ? containerWidget : null;
                        index = prevBodyWidget.ChildWidgets._IndexOf(prevWidget);
                    }
                    else if (this.PreviousBlock instanceof TableAdv) {
                        prevWidget = this.PreviousBlock.TableWidgets[this.PreviousBlock.TableWidgets.Count - 1];
                        containerWidget = prevWidget.ContainerWidget;
                        prevBodyWidget = (containerWidget instanceof BodyWidget) ? containerWidget : null;
                        index = prevBodyWidget.ChildWidgets._IndexOf(prevWidget);
                    }
                    if (prevBodyWidget != null && MathHelper._Round(curWidget.Y - topBorderWidth, 2) ==
                        MathHelper._Round(prevBodyWidget.ChildWidgets[index].Y + prevBodyWidget.ChildWidgets[index].Height, 2)) {
                        prevBodyWidget.ChildWidgets._Insert(index + 1, curWidget);
                        curWidget.ContainerWidget = prevBodyWidget;
                        prevBodyWidget.Height += curWidget.Height;
                    }
                    else {
                        if (viewer.CurrentComment == null) {
                            var prevIndex = 0;
                            var documentStart = this.Document.DocumentStart;
                            var block_1 = this;
                            if (((documentStart == null) || (block_1 == documentStart.Paragraph))
                                || (documentStart.Paragraph.IsInsideTable && this instanceof TableAdv
                                    && block_1._Contains(documentStart.Paragraph.AssociatedCell)))
                                prevIndex = -1;
                            if (prevBodyWidget != null)
                                prevIndex = bodyWidgets._IndexOf(prevBodyWidget);
                            if (viewer instanceof FlowLayoutViewer && this.Section != null) {
                                var sectionIndex = this.Section._GetIndexInOwnerCollection();
                                if (sectionIndex > bodyWidgets.Count - 1 || bodyWidgets[sectionIndex].CurrentNode != this.Section) {
                                    if (sectionIndex == 0)
                                        viewer.CurrentPage.BodyWidgets._Insert(sectionIndex, this.Section._AddBodyWidget(new Rect(viewer.ClientArea.X, viewer.ClientArea.Y, viewer.ClientArea.Width, 0)));
                                    else
                                        viewer.CurrentPage.BodyWidgets._Insert(sectionIndex, this.Section._AddBodyWidget(new Rect(bodyWidgets[sectionIndex - 1].X, bodyWidgets[sectionIndex - 1].Y, bodyWidgets[sectionIndex - 1].Width, 0)));
                                }
                                bodyWidget = this.Section.BodyWidgets[0];
                            }
                            else if (prevIndex + 1 < bodyWidgets.Count)
                                bodyWidget = bodyWidgets[prevIndex + 1];
                            else
                                bodyWidget = bodyWidgets[bodyWidgets.Count - 1];
                        }
                        bodyWidget.ChildWidgets._Insert(0, curWidget);
                        curWidget.ContainerWidget = bodyWidget;
                        bodyWidget.Height += curWidget.Height;
                    }
                }
            }
            else {
                var hfWidget = viewer.CurrentHeaderFooter.LayoutedWidgets[viewer.CurrentHeaderFooter.LayoutedWidgets.Count - 1];
                hfWidget.ChildWidgets._Add(curWidget);
                curWidget.ContainerWidget = hfWidget;
            }
        };
        BlockAdv.prototype._GetContainerTable = function () {
            var container = this;
            if (this.IsInsideTable) {
                if (this.AssociatedCell.OwnerTable.IsInsideTable)
                    container = this.AssociatedCell.OwnerTable._GetContainerTable();
                else
                    container = this.AssociatedCell.OwnerTable;
            }
            if (container instanceof TableAdv)
                return container;
            return null;
        };
        BlockAdv.prototype._GetContainerWidth = function () {
            if (this.IsInsideTable)
                return this.AssociatedCell.CellFormat.CellWidth - (this.AssociatedCell.CellFormat.LeftMargin + this.AssociatedCell.CellFormat.RightMargin);
            else if (this._IsInComment())
                return this._GetOwnerComment().LayoutedWidget.ContentWidth;
            else
                return this.Section.SectionFormat.PageWidth - (this.Section.SectionFormat.LeftMargin + this.Section.SectionFormat.RightMargin);
        };
        BlockAdv.prototype._IsExistBefore = function (block) {
            if (this.IsInsideTable) {
                var cell1 = this.AssociatedCell;
                if (block.IsInsideTable) {
                    var cell2 = block.AssociatedCell;
                    if (cell1 == cell2)
                        return cell1.Blocks._IndexOf(this) < cell1.Blocks._IndexOf(block);
                    if (cell1.OwnerRow == cell2.OwnerRow)
                        return cell1.CellIndex < cell2.CellIndex;
                    if (cell1.OwnerTable == cell2.OwnerTable)
                        return cell1.OwnerRow.RowIndex < cell2.OwnerRow.RowIndex;
                    var containerCell = cell1._GetContainerCellOf(cell2);
                    if (containerCell.OwnerTable._Contains(cell2)) {
                        cell1 = cell1._GetSelectedCell(containerCell);
                        cell2 = cell2._GetSelectedCell(containerCell);
                        if (cell1 == containerCell)
                            return this._IsExistBefore(cell2.OwnerTable);
                        if (cell2 == containerCell)
                            return cell1.OwnerTable._IsExistBefore(block);
                        if (containerCell.OwnerRow == cell2.OwnerRow)
                            return containerCell.CellIndex < cell2.CellIndex;
                        if (containerCell.OwnerTable == cell2.OwnerTable)
                            return containerCell.OwnerRow.RowIndex < cell2.OwnerRow.RowIndex;
                        return cell1.OwnerTable._IsExistBefore(cell2.OwnerTable);
                    }
                    return containerCell.OwnerTable._IsExistBefore(cell2.OwnerTable._GetContainerTable());
                }
                else {
                    var ownerTable = this._GetContainerTable();
                    return ownerTable._IsExistBefore(block);
                }
            }
            else if (block.IsInsideTable) {
                var ownerTable = block._GetContainerTable();
                return this._IsExistBefore(ownerTable);
            }
            else {
                if (this.Owner instanceof HeaderFooter)
                    return this.Owner.Blocks.indexOf(this) < block.Owner.Blocks.indexOf(block);
                else if (this.Section == block.Section)
                    return this.Section.Blocks.indexOf(this) < this.Section.Blocks.indexOf(block);
                else if (this.Document != null)
                    return this.Document.Sections.indexOf(this.Section) < this.Document.Sections.indexOf(block.Section);
            }
        };
        BlockAdv.prototype._IsExistAfter = function (block) {
            if (this.IsInsideTable) {
                var cell1 = this.AssociatedCell;
                if (block.IsInsideTable) {
                    var cell2 = block.AssociatedCell;
                    if (cell1 == cell2)
                        return cell1.Blocks._IndexOf(this) > cell1.Blocks._IndexOf(block);
                    if (cell1.OwnerRow == cell2.OwnerRow)
                        return cell1.CellIndex > cell2.CellIndex;
                    if (cell1.OwnerTable == cell2.OwnerTable)
                        return cell1.OwnerRow.RowIndex > cell2.OwnerRow.RowIndex;
                    var containerCell = cell1._GetContainerCellOf(cell2);
                    if (containerCell.OwnerTable._Contains(cell2)) {
                        cell1 = cell1._GetSelectedCell(containerCell);
                        cell2 = cell2._GetSelectedCell(containerCell);
                        if (cell1 == containerCell)
                            return this._IsExistAfter(cell2.OwnerTable);
                        if (cell2 == containerCell)
                            return cell1.OwnerTable._IsExistAfter(block);
                        if (containerCell.OwnerRow == cell2.OwnerRow)
                            return containerCell.CellIndex > cell2.CellIndex;
                        if (containerCell.OwnerTable == cell2.OwnerTable)
                            return containerCell.OwnerRow.RowIndex > cell2.OwnerRow.RowIndex;
                        return cell1.OwnerTable._IsExistAfter(cell2.OwnerTable);
                    }
                    return containerCell.OwnerTable._IsExistAfter(cell2.OwnerTable._GetContainerTable());
                }
                else {
                    var ownerTable = this._GetContainerTable();
                    return ownerTable._IsExistAfter(block);
                }
            }
            else if (block.IsInsideTable) {
                var ownerTable = block._GetContainerTable();
                return this._IsExistAfter(ownerTable);
            }
            else {
                if (this.Owner instanceof HeaderFooter)
                    return this.Owner.Blocks._IndexOf(this) > block.Owner.Blocks._IndexOf(block);
                else if (this.Section == block.Section)
                    return this.Section.Blocks._IndexOf(this) > this.Section.Blocks._IndexOf(block);
                else
                    return this.Document.Sections._IndexOf(this.Section) > this.Document.Sections._IndexOf(block.Section);
            }
        };
        BlockAdv.prototype._GetNextParagraph = function () {
            if (this.NextBlock instanceof ParagraphAdv)
                return this.NextBlock;
            else if (this.NextBlock instanceof TableAdv)
                return this.NextBlock._GetFirstParagraphInFirstCell();
            if (this.Owner instanceof TableCellAdv)
                return this.Owner._GetNextParagraph();
            else if (this.Owner instanceof SectionAdv)
                return this.Owner._GetNextParagraph();
            else if (this.Owner instanceof CommentAdv)
                return this.Owner._GetNextParagraph(this);
            return null;
        };
        BlockAdv.prototype._GetFirstParagraph = function () {
            var block = this;
            if (block instanceof ParagraphAdv)
                return block;
            else if (block instanceof TableAdv)
                return block._GetFirstParagraphInFirstCell();
            return null;
        };
        BlockAdv.prototype._GetLastParagraph = function () {
            var block = this;
            if (block instanceof ParagraphAdv)
                return block;
            else if (block instanceof TableAdv)
                return block._GetLastParagraphInLastCell();
            return null;
        };
        BlockAdv.prototype._GetPreviousParagraph = function () {
            if (this.PreviousBlock instanceof ParagraphAdv)
                return this.PreviousBlock;
            else if (this.PreviousBlock instanceof TableAdv)
                return this.PreviousBlock._GetLastParagraphInLastCell();
            if (this.Owner instanceof TableCellAdv)
                return this.Owner._GetPreviousParagraph();
            else if (this.Owner instanceof SectionAdv)
                return this.Owner._GetPreviousParagraph();
            else if (this.Owner instanceof CommentAdv)
                return this.Owner._GetPreviousParagraph(this);
            return null;
        };
        BlockAdv.prototype._GetPreviousBlock = function () {
            if (this.PreviousBlock == null) {
                if (this.Owner instanceof TableCellAdv)
                    return this.Owner.OwnerTable._GetPreviousBlock();
                else if (this.Owner instanceof SectionAdv)
                    return this.Owner._GetPreviousBlock();
            }
            return this.PreviousBlock;
        };
        BlockAdv.prototype._GetNextRenderedBlock = function () {
            if (this.NextBlock == null) {
                if (this.Owner instanceof SectionAdv
                    && this.Owner.NextNode != null)
                    return this.Owner.NextNode.Blocks[0];
            }
            return this.NextBlock;
        };
        BlockAdv.prototype._GetPreviousSelection = function (selection) {
            if (this.PreviousBlock instanceof ParagraphAdv)
                return this.PreviousBlock;
            else if (this.PreviousBlock instanceof TableAdv) {
                if (!selection.IsForward)
                    return this.PreviousBlock._GetFirstParagraphInLastRow();
                else
                    return this.PreviousBlock.Rows[this.PreviousBlock.Rows.Count - 1]._GetPreviousParagraphSelection(selection);
            }
            if (this.Owner instanceof TableCellAdv)
                return this.Owner._GetPreviousSelection(selection);
            else if (this.Owner instanceof SectionAdv)
                return this.Owner._GetPreviousSelection(selection);
            return null;
        };
        BlockAdv.prototype._GetNextSelection = function (selection) {
            if (this.NextBlock instanceof ParagraphAdv)
                return this.NextBlock;
            else if (this.NextBlock instanceof TableAdv) {
                if (selection.IsEmpty || selection.IsForward)
                    return this.NextBlock._GetLastParagraphInFirstRow();
                else
                    return this.NextBlock.Rows[0]._GetNextParagraphSelection(selection);
            }
            if (this.Owner instanceof TableCellAdv)
                return this.Owner._GetNextSelection(selection);
            else if (this.Owner instanceof SectionAdv)
                return this.Owner._GetNextSelection(selection);
            return null;
        };
        BlockAdv.prototype._GetBodyWidgetOfPreviousBlock = function (index) {
            index = 0;
            var prevBodyWidget = null;
            if (this.PreviousBlock instanceof ParagraphAdv) {
                prevBodyWidget = this.PreviousBlock.ParagraphWidgets[this.PreviousBlock.ParagraphWidgets.Count - 1].ContainerWidget;
                index = prevBodyWidget.ChildWidgets._IndexOf(this.PreviousBlock.ParagraphWidgets[this.PreviousBlock.ParagraphWidgets.Count - 1]);
            }
            else if (this.PreviousBlock instanceof TableAdv) {
                prevBodyWidget = this.PreviousBlock.TableWidgets[this.PreviousBlock.TableWidgets.Count - 1].ContainerWidget;
                index = prevBodyWidget.ChildWidgets._IndexOf(this.PreviousBlock.TableWidgets[this.PreviousBlock.TableWidgets.Count - 1]);
            }
            return { prevBodyWidget: prevBodyWidget, index: index };
        };
        BlockAdv.prototype._Layout = function () {
            this._LayoutItem(false);
        };
        BlockAdv.prototype._LayoutItem = function (shiftNextWidget) {
            var section = null;
            if (this.Owner instanceof SectionAdv) {
                section = this.Owner;
                var index = section.Blocks._IndexOf(this);
                if (section.BaseParent != null
                    && section.BaseParent.IsLayoutEnabled)
                    section._LayoutItem(index, shiftNextWidget);
            }
            else if (this.Owner instanceof TableCellAdv) {
                var cell = this.Owner;
                cell = cell._GetContainerCell();
                section = cell.Section;
                if (section != null && section.BaseParent != null) {
                    var ownerDocument = section.Document;
                    var viewer = ownerDocument.OwnerControl.Viewer;
                    if (ownerDocument.OwnerControl.IsLayoutEnabled)
                        cell.OwnerRow._Layout(viewer, shiftNextWidget);
                }
            }
            else if (this._IsInComment())
                this._GetOwnerComment()._Relayout();
        };
        BlockAdv.prototype._LayoutNextItems = function (viewer) {
            var block = this;
            if (block.NextNode == null || viewer.BlockToShift == block)
                viewer.BlockToShift = null;
            var updateNextBlockList = true;
            while (block.NextNode instanceof BlockAdv || (viewer instanceof FlowLayoutViewer && block._GetNextRenderedBlock() != null)) {
                var currentWidget = null;
                if (block instanceof ParagraphAdv)
                    currentWidget = block.ParagraphWidgets[block.ParagraphWidgets.Count - 1];
                else
                    currentWidget = block.TableWidgets[block.TableWidgets.Count - 1];
                if (viewer.FieldEndParagraph == block)
                    viewer.FieldEndParagraph = null;
                if (viewer instanceof FlowLayoutViewer)
                    block = this._GetNextRenderedBlock();
                else
                    block = block.NextNode;
                if (viewer.BlockToShift == block)
                    viewer.BlockToShift = null;
                var updateNextBlockList_1 = false;
                var nextWidget = null;
                if (block instanceof ParagraphAdv && block.ParagraphWidgets.Count > 0)
                    nextWidget = block.ParagraphWidgets[0];
                else if (block instanceof TableAdv && block.TableWidgets.Count > 0)
                    nextWidget = block.TableWidgets[0];
                if (viewer.FieldEndParagraph == null && viewer.FieldStack.Count == 0 && nextWidget != null && currentWidget.ContainerWidget == nextWidget.ContainerWidget
                    && (MathHelper._Round(nextWidget.Y, 2) == MathHelper._Round(viewer.ClientActiveArea.Y, 2))) {
                    if (viewer.BlockToShift != null)
                        viewer.BlockToShift = block;
                    break;
                }
                updateNextBlockList_1 = true;
                if (viewer.OwnerControl.IsShiftingEnabled && viewer.FieldEndParagraph == null && viewer.FieldStack.Count == 0) {
                    viewer.BlockToShift = block;
                    break;
                }
                else {
                    block._ClearWidgets();
                    viewer._UpdateClientAreaForBlock(block, true);
                    block._LayoutItems(viewer);
                    viewer._UpdateClientAreaForBlock(block, false);
                }
            }
            if (!viewer.OwnerControl.IsShiftingEnabled || viewer.BlockToShift != block)
                block._UpdateListItemsTillEnd(updateNextBlockList);
            if (viewer instanceof FlowLayoutViewer || viewer instanceof PageLayoutViewer)
                viewer._UpdateScrollBars();
        };
        BlockAdv.prototype._UpdateListItemsTillEnd = function (updateNextBlockList) {
            var block = updateNextBlockList ? this._GetNextRenderedBlock() : this;
            while (block != null) {
                block._UpdateRenderedListItems();
                block = block._GetNextRenderedBlock();
            }
        };
        BlockAdv.prototype._RelayoutOrShiftWidgets = function (viewer) {
            var relayoutItems = false;
            var block = this;
            if (block instanceof ParagraphAdv)
                relayoutItems = block.ParagraphWidgets.Count == 0;
            else
                relayoutItems = block.TableWidgets.Count == 0;
            if (relayoutItems) {
                viewer._UpdateClientAreaForBlock(this, true);
                this._LayoutItems(viewer);
                viewer._UpdateClientAreaForBlock(this, false);
            }
            else {
                this._ShiftWidgets(viewer);
                block._UpdateRenderedListItems();
            }
        };
        BlockAdv.prototype._ShiftNextWidgets = function () {
            var block = this;
            while (block.NextNode instanceof BlockAdv || (this.Document.OwnerControl.Viewer instanceof FlowLayoutViewer && block._GetNextRenderedBlock() != null)) {
                if (this.Document.OwnerControl.Viewer instanceof FlowLayoutViewer)
                    block = block._GetNextRenderedBlock();
                else
                    block = block.NextNode;
                block._RelayoutOrShiftWidgets(this.Document.OwnerControl.Viewer);
            }
        };
        BlockAdv.prototype._RemoveBlock = function () {
            if (this.IsInsideTable)
                this.AssociatedCell.Blocks._Remove(this);
            else if (this.Owner instanceof HeaderFooter)
                this.Owner.Blocks._Remove(this);
            else if (this.Owner instanceof CommentAdv)
                this.Owner.Blocks._Remove(this);
            else
                this.Owner.Blocks._Remove(this);
            this._ClearWidgets();
        };
        return BlockAdv;
    }(CompositeNode));
    DocumentEditorFeatures.BlockAdv = BlockAdv;
    var TableAdv = (function (_super) {
        __extends(TableAdv, _super);
        function TableAdv(node) {
            _super.call(this, node);
            this.flags = 0;
            this.headerHeight = 0;
            this.tableholder = null;
            this.tableGrid = new List();
            this.ChildNodes = new TableRowAdvCollection(this);
            this.TableFormat = new TableFormat(this);
            this.TableHolder = new TableHolder();
            this.SpannedRowCollection = new Dictionary();
            this.TableWidgets = new List();
        }
        Object.defineProperty(TableAdv.prototype, "TableHolder", {
            get: function () { return this.tableholder; },
            set: function (value) { this.tableholder = value; },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(TableAdv.prototype, "Rows", {
            get: function () {
                return this.ChildNodes;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(TableAdv.prototype, "Title", {
            get: function () { return this.title; },
            set: function (value) { this.title = value; },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(TableAdv.prototype, "Description", {
            get: function () { return this.description; },
            set: function (value) { this.description = value; },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(TableAdv.prototype, "TableWidth", {
            get: function () {
                if (this.Rows == null)
                    return 0;
                return this._GetTableWidth();
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(TableAdv.prototype, "ContinueHeader", {
            get: function () {
                return ((this.flags & 0x2) >> 1) != 0;
            },
            set: function (value) {
                this.flags = ((this.flags & 0xFD) | ((value ? 1 : 0) << 1));
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(TableAdv.prototype, "Header", {
            get: function () {
                return (this.flags & 0x1) != 0;
            },
            set: function (value) {
                this.flags = ((this.flags & 0xFE) | (value ? 1 : 0));
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(TableAdv.prototype, "HeaderHeight", {
            get: function () {
                return this.headerHeight;
            },
            set: function (value) {
                this.headerHeight = value;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(TableAdv.prototype, "IsTableGridUpdated", {
            get: function () {
                return ((this.flags & 0x4) >> 2) != 0;
            },
            set: function (value) {
                this.flags = ((this.flags & 0xFB) | ((value ? 1 : 0) << 2));
            },
            enumerable: true,
            configurable: true
        });
        TableAdv.prototype._SerializeBlock = function () {
            var table = { "Rows": [], "TableFormat": [], "Title": [], "Description": [], "ColumnsCount": [] };
            table.Title = this.Title;
            table.Description = this.Description;
            table.ColumnsCount = this.TableHolder.Columns.Count;
            for (var i = 0; i < this.Rows.length; i++) {
                var Row = this.Rows[i];
                table.Rows[i] = Row._SerializeRows();
            }
            table.TableFormat = this.TableFormat._SerializeTableFormat();
            return table;
        };
        TableAdv.prototype._CanMergeSelectedCells = function (selection, startCell, endCell) {
            var count = this.Rows._IndexOf(endCell.OwnerRow);
            var rowStartIndex = this.Rows._IndexOf(startCell.OwnerRow);
            if (rowStartIndex == count)
                return true;
            var start = startCell.OwnerRow._GetCellLeft(startCell);
            var end = start + startCell.CellFormat.CellWidth;
            var endCellLeft = endCell.OwnerRow._GetCellLeft(endCell);
            var endCellRight = endCellLeft + endCell.CellFormat.CellWidth;
            if (start > endCellLeft)
                start = endCellLeft;
            if (end < endCellRight)
                end = endCellRight;
            if (start > selection.UpDownSelectionLength)
                start = selection.UpDownSelectionLength;
            if (end < selection.UpDownSelectionLength)
                end = selection.UpDownSelectionLength;
            var selectionLeft = 0, selectionRight = 0;
            for (var i = rowStartIndex; i <= count; i++) {
                var row = this.Rows[i];
                var rowLeft = 0, rowRight = 0;
                var isStarted = false;
                for (var j = 0; j < row.Cells.Count; j++) {
                    var cellStart = row._GetCellLeft(row.Cells[j]);
                    if (MathHelper._Round(start, 2) <= MathHelper._Round(cellStart, 2) && MathHelper._Round(cellStart, 2) < MathHelper._Round(end, 2)) {
                        if (!isStarted) {
                            rowLeft = cellStart;
                            rowRight = cellStart;
                            isStarted = true;
                        }
                        rowRight += row.Cells[j].CellFormat.CellWidth;
                    }
                }
                if (i == rowStartIndex) {
                    selectionLeft = rowLeft;
                    selectionRight = rowRight;
                }
                else {
                    if (!(Math.round(selectionLeft) == Math.round(rowLeft) && Math.round(selectionRight) == Math.round(rowRight)))
                        return false;
                    if (i == count)
                        return true;
                }
            }
            return false;
        };
        TableAdv.prototype._Clone = function () {
            var table = new TableAdv(null);
            table.TableFormat._CopyFormat(this.TableFormat);
            for (var i = 0; i < this.Rows.Count; i++) {
                table.Rows._Add(this.Rows[i]._Clone());
            }
            return table;
        };
        TableAdv.prototype._CloneTableToHistoryInfo = function (baseHistoryInfo) {
            var clonedTable = this._Clone();
            baseHistoryInfo.RemovedNodes._Add(clonedTable);
            baseHistoryInfo.InsertPosition = this._GetHierarchicalIndex("0");
            return clonedTable;
        };
        TableAdv.prototype._LayoutItems = function (viewer) {
            if (this.TableWidgets != null && this.TableWidgets.length > 0) {
                this.TableWidgets._Clear();
            }
            if ((viewer instanceof FlowLayoutViewer || viewer.CurrentComment != null) && !this.IsInsideTable) {
                var tableWidth = 0;
                tableWidth = this._GetTableWidth();
                if (Math.round(viewer.ClientArea.Width) < Math.round(tableWidth) && (viewer.CurrentComment == null
                    && viewer.HorizontalWidth < viewer.ClientActiveArea.X + tableWidth + viewer.ClientArea.X
                    || viewer.CurrentComment != null && viewer.HorizontalWidth < viewer.ClientActiveArea.X + tableWidth)) {
                    if (viewer instanceof FlowLayoutViewer)
                        viewer.HorizontalWidth = viewer.ClientActiveArea.X + tableWidth + viewer.ClientArea.X;
                    else
                        viewer.CurrentComment.LayoutedWidget.ContentWidth = viewer.ClientActiveArea.X + tableWidth;
                }
            }
            this._AddTableWidget(viewer.ClientActiveArea);
            viewer._UpdateClientAreaTopOrLeft(this.TableWidgets[this.TableWidgets.Count - 1], true);
            if (this.Rows.Count > 0 && this.Rows[0].RowFormat.IsHeader) {
                this.Header = true;
                this.ContinueHeader = true;
                this.HeaderHeight = 0;
            }
            else {
                this.Header = false;
                this.ContinueHeader = false;
                this.HeaderHeight = 0;
            }
            for (var i = 0; i < this.Rows.length; i++) {
                var row = this.Rows[i];
                row._LayoutItems(viewer);
            }
            this._UpdateWidgetsToPage(viewer);
        };
        TableAdv.prototype._RelayoutSelection = function (selection, start, end) {
            var isEnded = false;
            this._Layout();
            if (end.Paragraph.AssociatedCell != null && this._Contains(end.Paragraph.AssociatedCell))
                return true;
            var block = this._GetNextRenderedBlock();
            if (block != null)
                isEnded = block._RelayoutSelection(selection, start, end);
            return isEnded;
        };
        TableAdv.prototype._GetHeader = function () {
            var header = null;
            var flag = true;
            for (var i = 0; i < this.Rows.length; i++) {
                var row = this.Rows[i];
                if (row.RowFormat.IsHeader)
                    header = row;
                else
                    flag = false;
                if (!flag)
                    break;
            }
            return header;
        };
        TableAdv.prototype._GetTableWidth = function () {
            var width = 0;
            for (var i = 0; i < this.Rows.length; i++) {
                var row = this.Rows[i];
                var rowWidth = 0;
                for (var j = 0; j < row.Cells.length; j++) {
                    var cell = row.Cells[j];
                    rowWidth += cell.CellFormat.CellWidth;
                }
                if (width < rowWidth)
                    width = rowWidth;
            }
            return width;
        };
        TableAdv.prototype._ApplyCharacterFormat = function (selection, start, end, property, value, update) {
            for (var i = 0; i < this.Rows.Count; i++) {
                var row = this.Rows[i];
                for (var j = 0; j < row.Cells.Count; j++) {
                    row.Cells[j]._ApplyCharacterFormatForSel(selection, property, value, update);
                }
                if (end.Paragraph.IsInsideTable && row._Contains(end.Paragraph.AssociatedCell))
                    return;
            }
            var block = this._GetNextRenderedBlock();
            block._ApplyCharacterFormat(selection, start, end, property, value, update);
        };
        TableAdv.prototype._ApplyCharacterFormatForSel = function (selection, property, value, update) {
            for (var i = 0; i < this.Rows.Count; i++) {
                var row = this.Rows[i];
                for (var j = 0; j < row.Cells.Count; j++) {
                    row.Cells[j]._ApplyCharacterFormatForSel(selection, property, value, update);
                }
            }
        };
        TableAdv.prototype._ApplyCharacterFormatForCell = function (selection, startCell, endCell, property, value, update) {
            var start = startCell.OwnerRow._GetCellLeft(startCell);
            var end = start + startCell.CellFormat.CellWidth;
            var endCellLeft = endCell.OwnerRow._GetCellLeft(endCell);
            var endCellRight = endCellLeft + endCell.CellFormat.CellWidth;
            if (start > endCellLeft)
                start = endCellLeft;
            if (end < endCellRight)
                end = endCellRight;
            if (start > selection.UpDownSelectionLength)
                start = selection.UpDownSelectionLength;
            if (end < selection.UpDownSelectionLength)
                end = selection.UpDownSelectionLength;
            var count = this.Rows._IndexOf(endCell.OwnerRow);
            var isStarted = false;
            for (var i = this.Rows._IndexOf(startCell.OwnerRow); i <= count; i++) {
                var row = this.Rows[i];
                for (var j = 0; j < row.Cells.Count; j++) {
                    var left = row._GetCellLeft(row.Cells[j]);
                    if (MathHelper._Round(start, 2) <= MathHelper._Round(left, 2) && MathHelper._Round(left, 2) < MathHelper._Round(end, 2)) {
                        if (!isStarted) {
                            value = row.Cells[j]._GetCharacterFormatValue(property, value);
                            isStarted = true;
                        }
                        row.Cells[j]._ApplyCharacterFormatForSel(selection, property, value, update);
                    }
                }
            }
        };
        TableAdv.prototype._ApplyParagraphFormatTable = function (selection, startCell, endCell, property, value, update) {
            var start = startCell.OwnerRow._GetCellLeft(startCell);
            var end = start + startCell.CellFormat.CellWidth;
            var endCellLeft = endCell.OwnerRow._GetCellLeft(endCell);
            var endCellRight = endCellLeft + endCell.CellFormat.CellWidth;
            if (start > endCellLeft)
                start = endCellLeft;
            if (end < endCellRight)
                end = endCellRight;
            if (start > selection.UpDownSelectionLength)
                start = selection.UpDownSelectionLength;
            if (end < selection.UpDownSelectionLength)
                end = selection.UpDownSelectionLength;
            var count = this.Rows._IndexOf(endCell.OwnerRow);
            var isStarted = false;
            for (var i = this.Rows._IndexOf(startCell.OwnerRow); i <= count; i++) {
                var row = this.Rows[i];
                for (var j = 0; j < row.Cells.Count; j++) {
                    var left = row._GetCellLeft(row.Cells[j]);
                    if (Math.round(start) <= Math.round(left) && Math.round(left) < Math.round(end)) {
                        if (!isStarted) {
                            value = row.Cells[j]._GetParagraphFormatValue(property, value);
                            isStarted = true;
                        }
                        row.Cells[j]._ApplyParagraphFormatTableCell(selection, property, value, update);
                    }
                }
            }
        };
        TableAdv.prototype._ApplyParagraphFormat = function (selection, start, end, property, value, update) {
            for (var i = 0; i < this.Rows.Count; i++) {
                var row = this.Rows[i];
                for (var j = 0; j < row.Cells.Count; j++) {
                    row.Cells[j]._ApplyParagraphFormatTableCell(selection, property, value, update);
                }
                if (end.Paragraph.IsInsideTable && row._Contains(end.Paragraph.AssociatedCell))
                    return;
            }
            var block = this._GetNextRenderedBlock();
            block._ApplyParagraphFormat(selection, start, end, property, value, update);
        };
        TableAdv.prototype._ApplyParagraphFormatInternal = function (selection, property, value, update) {
            for (var i = 0; i < this.Rows.Count; i++) {
                var row = this.Rows[i];
                for (var j = 0; j < row.Cells.Count; j++) {
                    row.Cells[j]._ApplyParagraphFormatTableCell(selection, property, value, update);
                }
            }
        };
        TableAdv.prototype._AddTableWidget = function (area) {
            var tableWidget = new TableWidget(this);
            tableWidget.Width = area.Width;
            tableWidget.X = area.X;
            tableWidget.Y = area.Y;
            this.TableWidgets._Add(tableWidget);
            if (this.TableFormat != null && this.TableFormat.CellSpacing > 0) {
                tableWidget.Height = tableWidget.Height + this.TableFormat.CellSpacing;
                tableWidget.LeftBorderWidth = this.TableFormat.Borders._GetTableLeftBorder()._GetLineWidth();
                tableWidget.RightBorderWidth = this.TableFormat.Borders._GetTableRightBorder()._GetLineWidth();
                tableWidget.TopBorderWidth = this.TableFormat.Borders._GetTableTopBorder()._GetLineWidth();
                tableWidget.BottomBorderWidth = this.TableFormat.Borders._GetTableBottomBorder()._GetLineWidth();
                tableWidget.X += tableWidget.LeftBorderWidth;
                tableWidget.Y += tableWidget.TopBorderWidth;
                tableWidget.Width -= tableWidget.LeftBorderWidth;
                tableWidget.Width -= tableWidget.RightBorderWidth;
                tableWidget.Height += tableWidget.BottomBorderWidth;
            }
        };
        TableAdv.prototype._CreateTable = function (rowCount, columnCount) {
            var row = null;
            var cell = null;
            for (var i = 0; i < rowCount; i++) {
                row = new TableRowAdv(null);
                for (var j = 0; j < columnCount; j++) {
                    cell = new TableCellAdv(null);
                    cell.CellFormat.CellWidth = 100;
                    cell.Blocks._Add(new ParagraphAdv(null));
                    row.Cells._Add(cell);
                }
                this.Rows._Add(row);
            }
            this.TableFormat._InitializeTableBorders();
        };
        TableAdv.prototype._BuildColumns = function () {
            if (this.tableGrid == null || TableHolder == null || this.IsTableGridUpdated)
                return;
            this.TableHolder.Columns._Clear();
            this.tableGrid._Clear();
            var toremovelast = 0;
            var rowSpannedCells = new List();
            for (var i = 0; i < this.Rows.length; i++) {
                var row = this.Rows[i];
                var columnSpan = row.GridBefore;
                var currOffset = 0;
                if (!(this.tableGrid._Contains(currOffset)))
                    this.tableGrid._Add(currOffset);
                currOffset += row.GridBeforeWidth * 15;
                var startOffset = Math.round(currOffset);
                if (!(this.tableGrid._Contains(startOffset)))
                    this.tableGrid._Add(startOffset);
                for (var j = 0; j < row.Cells.length; j++) {
                    var cell = row.Cells[j];
                    if (rowSpannedCells.length == 0)
                        cell.ColumnIndex = columnSpan;
                    for (var k = 0; k < rowSpannedCells.length; k++) {
                        if (rowSpannedCells[k].ColumnIndex < columnSpan) {
                            cell.ColumnIndex = columnSpan;
                            continue;
                        }
                        var rowSpan = 1;
                        var removeSpannedCell = true;
                        rowSpan = rowSpannedCells[k].CellFormat.RowSpan;
                        if (rowSpannedCells[k].ColumnIndex > columnSpan) {
                            cell.ColumnIndex = columnSpan;
                            removeSpannedCell = false;
                            if (j == row.Cells.length - 1 && row.GridAfter > 0)
                                currOffset += rowSpannedCells[k].CellFormat.CellWidth * 15;
                        }
                        else {
                            cell.ColumnIndex = columnSpan = this.TableHolder.Columns.indexOf(rowSpannedCells[k].OwnerColumn) + rowSpannedCells[k].CellFormat.ColumnSpan;
                            currOffset += rowSpannedCells[k].CellFormat.CellWidth * 15;
                        }
                        if (!removeSpannedCell && j == row.Cells.length - 1)
                            removeSpannedCell = true;
                        if (removeSpannedCell && i - rowSpannedCells[k].OwnerRow.RowIndex == rowSpan - 1) {
                            rowSpannedCells._RemoveAt(k);
                            k--;
                        }
                    }
                    if (cell.CellFormat.RowSpan > 1) {
                        if (rowSpannedCells.length == 0 || rowSpannedCells[rowSpannedCells.length - 1].ColumnIndex <= columnSpan)
                            rowSpannedCells._Add(cell);
                        else {
                            for (var m = rowSpannedCells.length; m > 0; m--) {
                                if (rowSpannedCells[m - 1].ColumnIndex > columnSpan)
                                    rowSpannedCells._Insert(m - 1, cell);
                            }
                        }
                    }
                    columnSpan += cell.CellFormat.ColumnSpan;
                    currOffset += cell.CellFormat.CellWidth * 15;
                    var offset = Math.round(currOffset);
                    if (!(this.tableGrid._Contains(offset)))
                        this.tableGrid._Add(offset);
                    if (j == row.Cells.length - 1 && row.GridAfterWidth > 0) {
                        currOffset += row.GridAfterWidth * 15;
                        if (!(this.tableGrid._Contains(Math.round(currOffset))))
                            this.tableGrid._Add(Math.round(currOffset));
                        columnSpan += row.GridAfter;
                    }
                    toremovelast = Math.max(toremovelast, columnSpan - 1);
                    if (this.TableHolder.Columns.length < columnSpan) {
                        var column = new TableColumnAdv();
                        this.TableHolder.Columns._Add(column);
                        while (this.TableHolder.Columns.length < columnSpan) {
                            column = new TableColumnAdv();
                            this.TableHolder.Columns._Add(column);
                        }
                    }
                }
            }
            this.tableGrid._Sort();
            for (var i = 0; i < this.tableGrid.length - 1; i++) {
                var column = this.TableHolder.Columns[i];
                column.PreferredWidth = (this.tableGrid[i + 1] - this.tableGrid[i]) / 15;
            }
            this.tableGrid._Clear();
            while ((toremovelast + 1) < this.TableHolder.Columns.length) {
                this.TableHolder.Columns._RemoveAt(this.TableHolder.Columns.length - 1);
            }
        };
        TableAdv.prototype._UpdateWidgetsToPage = function (viewer) {
            var tableWidget = this.TableWidgets[this.TableWidgets.length - 1];
            if (this.IsInsideTable) {
                this.AssociatedCell.TableCellWidgets[this.AssociatedCell.TableCellWidgets.length - 1].ChildWidgets._Add(tableWidget);
                tableWidget.ContainerWidget = this.AssociatedCell.TableCellWidgets[this.AssociatedCell.TableCellWidgets.length - 1];
                this.AssociatedCell.TableCellWidgets[this.AssociatedCell.TableCellWidgets.Count - 1].Height = this.AssociatedCell.TableCellWidgets[this.AssociatedCell.TableCellWidgets.Count - 1].Height + tableWidget.Height;
            }
            else {
                this._UpdateWidgetsToBody(viewer, tableWidget);
                tableWidget._UpdateHeight(viewer);
                if (tableWidget.ChildWidgets.Count > 0 && tableWidget.Y != tableWidget.ChildWidgets[0].Y)
                    tableWidget.Y = tableWidget.ChildWidgets[0].Y;
            }
            if (this.TableFormat.CellSpacing > 0) {
                if (tableWidget.Y + tableWidget.Height + this.TableFormat.CellSpacing > viewer.ClientArea.Bottom && viewer instanceof PageLayoutViewer)
                    tableWidget.Height = tableWidget.Height - this.TableFormat.CellSpacing / 2;
                viewer._CutFromTop(tableWidget.Y + tableWidget.Height);
            }
        };
        TableAdv.prototype._GetLastBlockInLastCell = function () {
            var table = this;
            if (table.Rows.Count > 0) {
                var lastrow = table.Rows[table.Rows.Count - 1];
                var lastcell = lastrow.Cells[lastrow.Cells.Count - 1];
                return lastcell.Blocks[lastcell.Blocks.Count - 1];
            }
            return null;
        };
        TableAdv.prototype._GetLastParagraphInFirstRow = function () {
            var table = this;
            if (table.Rows.Count > 0) {
                var row = table.Rows[0];
                var lastcell = row.Cells[row.Cells.Count - 1];
                var lastBlock = lastcell.Blocks[lastcell.Blocks.Count - 1];
                if (lastBlock instanceof ParagraphAdv)
                    return lastBlock;
                else
                    return lastBlock._GetLastParagraphInLastCell();
            }
            return null;
        };
        TableAdv.prototype._GetLastParagraphInLastCell = function () {
            var table = this;
            if (table.Rows.Count > 0) {
                var lastrow = table.Rows[table.Rows.Count - 1];
                var lastcell = lastrow.Cells[lastrow.Cells.Count - 1];
                var lastBlock = lastcell.Blocks[lastcell.Blocks.Count - 1];
                if (lastBlock instanceof ParagraphAdv)
                    return lastBlock;
                else
                    return lastBlock._GetLastParagraphInLastCell();
            }
            return null;
        };
        TableAdv.prototype._GetFirstParagraphInFirstCell = function () {
            var table = this;
            if (table.Rows.length > 0) {
                var row = table.Rows[0];
                if (row.Cells.length > 0) {
                    var cell = row.Cells[0];
                    if (cell.Blocks.length > 0) {
                        var block = cell.Blocks[0];
                        if (block instanceof ParagraphAdv)
                            return block;
                        else
                            return block._GetFirstParagraphInFirstCell();
                    }
                }
            }
            return null;
        };
        TableAdv.prototype._GetFirstBlockInFirstCell = function () {
            var table = this;
            if (table.Rows.length > 0) {
                var firstrow = table.Rows[0];
                if (firstrow.Cells.Count > 0) {
                    var firstcell = firstrow.Cells[0];
                    if (firstcell.Blocks.Count == 0)
                        return null;
                    return firstcell.Blocks[0];
                }
            }
            return null;
        };
        TableAdv.prototype._Contains = function (tableCell) {
            if (this == tableCell.OwnerTable)
                return true;
            while (tableCell.OwnerTable.IsInsideTable) {
                if (this == tableCell.OwnerTable)
                    return true;
                tableCell = tableCell.OwnerTable.AssociatedCell;
            }
            return this == tableCell.OwnerTable;
        };
        TableAdv.prototype._HighlightCells = function (selection, selectionRange, startCell, endCell) {
            var start = startCell.OwnerRow._GetCellLeft(startCell);
            var end = start + startCell.CellFormat.CellWidth;
            var endCellLeft = endCell.OwnerRow._GetCellLeft(endCell);
            var endCellRight = endCellLeft + endCell.CellFormat.CellWidth;
            if (start > endCellLeft)
                start = endCellLeft;
            if (end < endCellRight)
                end = endCellRight;
            if (start > selection.UpDownSelectionLength)
                start = selection.UpDownSelectionLength;
            if (end < selection.UpDownSelectionLength)
                end = selection.UpDownSelectionLength;
            var count = this.Rows._IndexOf(endCell.OwnerRow);
            for (var i = this.Rows._IndexOf(startCell.OwnerRow); i <= count; i++) {
                this.Rows[i]._Highlight(selection, selectionRange, start, end);
            }
        };
        TableAdv.prototype._Highlight = function (selection, selectionRange, start, end) {
            this.Rows[0]._HighlightInternal(selection, selectionRange, start, end);
            if (!end.Paragraph.IsInsideTable
                || !this._Contains(end.Paragraph.AssociatedCell)) {
                var block = this._GetNextRenderedBlock();
                block._Highlight(selection, selectionRange, start, end);
            }
        };
        TableAdv.prototype._GetSelectedContentAsHtml = function (selection, start, end) {
            var html = "<table ";
            html += this.TableFormat._GetAsHtmlStyle();
            html += ">";
            html += this.Rows[0]._GetSelectedContentAsHtml(selection, start, end);
            html += "</table>";
            if (!end.Paragraph.IsInsideTable
                || !this._Contains(end.Paragraph.AssociatedCell)) {
                var block = this._GetNextRenderedBlock();
                html += block._GetSelectedContentAsHtml(selection, start, end);
            }
            return html;
        };
        TableAdv.prototype._GetSelectedContentAsHtmlInternal = function (selection, startCell, endCell) {
            var start = startCell.OwnerRow._GetCellLeft(startCell);
            var end = start + startCell.CellFormat.CellWidth;
            var endCellLeft = endCell.OwnerRow._GetCellLeft(endCell);
            var endCellRight = endCellLeft + endCell.CellFormat.CellWidth;
            if (start > endCellLeft)
                start = endCellLeft;
            if (end < endCellRight)
                end = endCellRight;
            if (start > selection.UpDownSelectionLength)
                start = selection.UpDownSelectionLength;
            if (end < selection.UpDownSelectionLength)
                end = selection.UpDownSelectionLength;
            var count = this.Rows._IndexOf(endCell.OwnerRow);
            var html = "";
            for (var i = this.Rows._IndexOf(startCell.OwnerRow); i <= count; i++) {
                html += this.Rows[i]._GetSelectedContentAsHtmlInternal(selection, start, end);
            }
            return html;
        };
        TableAdv.prototype._GetContentAsHtml = function () {
            var html = "<table ";
            html += this.TableFormat._GetAsHtmlStyle();
            html += ">";
            for (var i = 0; i < this.Rows.length; i++) {
                html += this.Rows[i]._GetContentAsHtml();
            }
            html += "</table>";
            return html;
        };
        TableAdv.prototype._GetFirstParagraphInLastRow = function () {
            if (this.Rows.Count > 0) {
                var lastrow = this.Rows[this.Rows.Count - 1];
                var lastcell = lastrow.Cells[0];
                var lastBlock = lastcell.Blocks[0];
                if (lastBlock instanceof ParagraphAdv)
                    return lastBlock;
                else
                    return lastBlock._GetFirstParagraphInFirstCell();
            }
            return null;
        };
        TableAdv.prototype._GetCellInTable = function (tableCell) {
            while (tableCell.OwnerTable.IsInsideTable) {
                if (this == tableCell.OwnerTable)
                    return tableCell;
                tableCell = tableCell.OwnerTable.AssociatedCell;
            }
            return tableCell;
        };
        TableAdv.prototype._GetCharacterFormat = function (selection, start, end) {
            for (var i = 0; i < this.Rows.Count; i++) {
                var row = this.Rows[i];
                for (var j = 0; j < row.Cells.Count; j++) {
                    row.Cells[j]._GetCharacterFormatForSelection(selection, start, end);
                }
                if (end.Paragraph.IsInsideTable && row._Contains(end.Paragraph.AssociatedCell))
                    return;
            }
            var block = this._GetNextRenderedBlock();
            block._GetCharacterFormat(selection, start, end);
        };
        TableAdv.prototype._GetCharacterFormatInternal = function (selection, startCell, endCell, startPosition, endPosition) {
            var start = startCell.OwnerRow._GetCellLeft(startCell);
            var end = start + startCell.CellFormat.CellWidth;
            var endCellLeft = endCell.OwnerRow._GetCellLeft(endCell);
            var endCellRight = endCellLeft + endCell.CellFormat.CellWidth;
            if (start > endCellLeft)
                start = endCellLeft;
            if (end < endCellRight)
                end = endCellRight;
            if (start > selection.UpDownSelectionLength)
                start = selection.UpDownSelectionLength;
            if (end < selection.UpDownSelectionLength)
                end = selection.UpDownSelectionLength;
            var count = this.Rows._IndexOf(endCell.OwnerRow);
            for (var i = this.Rows._IndexOf(startCell.OwnerRow); i <= count; i++) {
                var row = this.Rows[i];
                for (var j = 0; j < row.Cells.Count; j++) {
                    var left = row._GetCellLeft(row.Cells[j]);
                    if (MathHelper._Round(start, 2) <= MathHelper._Round(left, 2) && MathHelper._Round(left, 2) < MathHelper._Round(end, 2)) {
                        row.Cells[j]._GetCharacterFormatForSelection(selection, startPosition, endPosition);
                    }
                }
            }
        };
        TableAdv.prototype._GetParagraphFormatInternal = function (selection, start, end) {
            for (var i = 0; i < this.Rows.Count; i++) {
                var row = this.Rows[i];
                for (var j = 0; j < row.Cells.Count; j++) {
                    row.Cells[j]._GetParagraphFormat(selection);
                }
                if (end.Paragraph.IsInsideTable && row._Contains(end.Paragraph.AssociatedCell))
                    return;
            }
            var block = this._GetNextRenderedBlock();
            block._GetParagraphFormatInternal(selection, start, end);
        };
        TableAdv.prototype._GetParagraphFormat = function (selection) {
            for (var i = 0; i < this.Rows.Count; i++) {
                var row = this.Rows[i];
                for (var j = 0; j < row.Cells.Count; j++) {
                    row.Cells[j]._GetParagraphFormat(selection);
                }
            }
        };
        TableAdv.prototype._GetParagraphFormatForTableCell = function (selection, startCell, endCell) {
            var start = startCell.OwnerRow._GetCellLeft(startCell);
            var end = start + startCell.CellFormat.CellWidth;
            var endCellLeft = endCell.OwnerRow._GetCellLeft(endCell);
            var endCellRight = endCellLeft + endCell.CellFormat.CellWidth;
            if (start > endCellLeft)
                start = endCellLeft;
            if (end < endCellRight)
                end = endCellRight;
            if (start > selection.UpDownSelectionLength)
                start = selection.UpDownSelectionLength;
            if (end < selection.UpDownSelectionLength)
                end = selection.UpDownSelectionLength;
            var count = this.Rows._IndexOf(endCell.OwnerRow);
            for (var i = this.Rows._IndexOf(startCell.OwnerRow); i <= count; i++) {
                var row = this.Rows[i];
                for (var j = 0; j < row.Cells.Count; j++) {
                    var left = row._GetCellLeft(row.Cells[j]);
                    if (MathHelper._Round(start, 2) <= MathHelper._Round(left, 2) && MathHelper._Round(left, 2) < MathHelper._Round(end, 2)) {
                        row.Cells[j]._GetParagraphFormat(selection);
                    }
                }
            }
        };
        TableAdv.prototype._GetCellFormat = function (selection, start, end) {
            var isStarted = false;
            for (var i = 0; i < this.Rows.Count; i++) {
                var row = this.Rows[i];
                if (row == start.Paragraph.AssociatedCell.OwnerRow)
                    isStarted = true;
                if (isStarted) {
                    for (var j = 0; j < row.Cells.Count; j++) {
                        var cell = row.Cells[j];
                        if (cell._IsCellSelected(start, end))
                            selection.CellFormat._CombineFormat(cell.CellFormat);
                        if (cell == end.Paragraph.AssociatedCell) {
                            selection.CellFormat._CombineFormat(cell.CellFormat);
                            return;
                        }
                    }
                }
            }
        };
        TableAdv.prototype._GetRowFormat = function (selection, start, end) {
            var tableRow = start.Paragraph.AssociatedCell.OwnerRow;
            if (tableRow == end.Paragraph.AssociatedCell.OwnerRow)
                return;
            for (var i = this.Rows._IndexOf(tableRow) + 1; i < this.Rows.Count; i++) {
                var tempTableRow = this.Rows[i];
                selection.RowFormat._CombineFormat(tempTableRow.RowFormat);
                if (tempTableRow == end.Paragraph.AssociatedCell.OwnerRow)
                    return;
            }
        };
        TableAdv.prototype._ClearWidgets = function () {
            if (this.TableWidgets != null
                && this.TableWidgets.Count > 0) {
                for (var i = 0; i < this.TableWidgets.Count; i++) {
                    var widget = this.TableWidgets[i];
                    widget._Dispose();
                    this.TableWidgets._Remove(widget);
                    i--;
                }
            }
        };
        TableAdv.prototype._ShiftWidgets = function (viewer) {
            var index = 0;
            var prevObj = this._GetBodyWidgetOfPreviousBlock(index);
            var prevBodyWidget = prevObj.prevBodyWidget;
            index = prevObj.index;
            this._UpdateVerticalPositionToTop(true);
            if (viewer instanceof PageLayoutViewer && viewer.CurrentComment == null)
                this._CombineTableWidgets(null);
            for (var i = 0; i < this.TableWidgets.Count; i++) {
                var widget = this.TableWidgets[i];
                var splittedWidget = null;
                if (viewer instanceof PageLayoutViewer && viewer.ClientActiveArea.Height < widget.Height && widget._IsFirstLineFit(widget.Y + viewer.ClientActiveArea.Height)) {
                    splittedWidget = widget._GetSplittedWidget(widget.Y + viewer.ClientActiveArea.Height);
                    splittedWidget._UpdateChildLocation(widget.Y);
                }
                if (viewer instanceof FlowLayoutViewer || viewer.CurrentComment != null) {
                    var point = new Point(widget.X, viewer.ClientActiveArea.Y);
                    widget.X = point.X;
                    widget.Y = point.Y;
                    widget._UpdateChildLocation(widget.Y);
                    viewer._CutFromTop(widget.Y + widget.Height);
                }
                else if (viewer.ClientActiveArea.Height >= widget.Height) {
                    var point = new Point(widget.X, viewer.ClientActiveArea.Y);
                    widget.X = point.X;
                    widget.Y = point.Y;
                    widget._UpdateChildLocation(widget.Y);
                    if (prevBodyWidget != widget.ContainerWidget) {
                        index++;
                        widget._UpdateContainerWidget(prevBodyWidget, index);
                    }
                    if (viewer instanceof PageLayoutViewer)
                        widget._UpdateHeight(viewer);
                    viewer._CutFromTop(widget.Y + widget.Height);
                }
                else if (splittedWidget == null) {
                    splittedWidget = widget;
                    i--;
                }
                if (splittedWidget != null) {
                    if (!this.TableWidgets._Contains(splittedWidget))
                        this.TableWidgets._Add(splittedWidget);
                    var nextBodyWidget = prevBodyWidget._CreateOrGetNextBodyWiget(viewer);
                    if (nextBodyWidget.ChildWidgets.Count > 0 || splittedWidget.ContainerWidget == nextBodyWidget)
                        viewer._UpdateClientArea(nextBodyWidget.CurrentNode.SectionFormat);
                    if (splittedWidget.ContainerWidget != nextBodyWidget)
                        splittedWidget._UpdateContainerWidget(nextBodyWidget, 0);
                    prevBodyWidget = nextBodyWidget;
                }
            }
            this._UpdateVerticalPositionToTop(false);
        };
        TableAdv.prototype._UpdateVerticalPositionToTop = function (isUpdateTop) {
            for (var i = 0; i < this.TableWidgets.Count; i++) {
                var tablewidget = this.TableWidgets[i];
                for (var j = 0; j < tablewidget.ChildWidgets.Count; j++) {
                    var rowWidget = tablewidget.ChildWidgets[j];
                    for (var k = 0; k < rowWidget.ChildWidgets.Count; k++) {
                        var cellWidget = rowWidget.ChildWidgets[k];
                        cellWidget._UpdateCellVerticalPosition(isUpdateTop, false);
                    }
                }
            }
        };
        TableAdv.prototype._CombineTableWidgets = function (cellWidget) {
            if (this.TableWidgets.Count == 0)
                return;
            var tableWidget = this.TableWidgets[0];
            if (cellWidget != null && !cellWidget.ChildWidgets._Contains(tableWidget))
                tableWidget._UpdateContainerWidgetForCell(cellWidget);
            if (this.TableWidgets.Count == 1) {
                for (var i = 0; i < this.TableWidgets[0].ChildWidgets.Count; i++) {
                    var rowWidget = this.TableWidgets[0].ChildWidgets[i];
                    for (var j = 0; j < rowWidget.ChildWidgets.Count; j++) {
                        rowWidget.ChildWidgets[j]._UpdateWidgetHeight();
                    }
                }
                return;
            }
            tableWidget.Height = 0;
            for (var i = 0; i < this.Rows.Count; i++) {
                var row = this.Rows[i];
                var rowWidget = row.TableRowWidgets[0];
                var addRowHeight = tableWidget.ChildWidgets._Contains(rowWidget);
                row._CombineTableRowWidgets(tableWidget);
                row._UpdateRowHeightBySpannedCell(tableWidget, rowWidget, tableWidget.ChildWidgets.Count);
                if (addRowHeight)
                    tableWidget.Height += rowWidget.Height;
            }
            tableWidget._UpdateChildLocation(tableWidget.Y);
            for (var i = 1; i < this.TableWidgets.Count; i++) {
                var curWidget = this.TableWidgets[i];
                curWidget._Dispose();
                i--;
            }
        };
        TableAdv.prototype._UpdateListItems = function (block) {
            for (var i = 0; i < this.Rows.Count; i++) {
                if (this == block)
                    return true;
                var isListUpdated = this.Rows[i]._UpdateListItems(block);
                if (isListUpdated)
                    return true;
            }
            return false;
        };
        TableAdv.prototype._UpdateListParagraphs = function () {
            for (var i = 0; i < this.Rows.Count; i++) {
                for (var j = 0; j < this.Rows[i].Cells.Count; j++) {
                    for (var k = 0; k < this.Rows[i].Cells[j].Blocks.Count; k++)
                        this.Rows[i].Cells[j].Blocks[k]._UpdateListParagraphs();
                }
            }
        };
        TableAdv.prototype._UpdateRenderedListItems = function () {
            for (var i = 0; i < this.Rows.Count; i++) {
                this.Rows[i]._UpdateRenderedListItems();
            }
        };
        TableAdv.prototype._Delete = function (selection, start, end, editAction) {
            if (end.Paragraph.IsInsideTable && this._Contains(end.Paragraph.AssociatedCell)) {
                if (this.Rows[this.Rows.Count - 1]._Contains(end.Paragraph.AssociatedCell))
                    this._DeleteContent(selection, editAction);
                else {
                    for (var i = 0; i < this.Rows.Count; i++) {
                        var row = this.Rows[i];
                        if (editAction < 4) {
                            this.Rows._Remove(row);
                            selection.CurrentBaseHistoryInfo.RemovedNodes._Add(row);
                            i--;
                        }
                        if (row._Contains(end.Paragraph.AssociatedCell))
                            return;
                    }
                }
            }
            else {
                var block = this._GetNextRenderedBlock();
                var section = this.Section;
                this._DeleteContent(selection, editAction);
                if (block != null) {
                    var nextSection = block.Section;
                    if (section != nextSection) {
                        if (editAction < 4)
                            section._CombineSection(selection, nextSection);
                        if (editAction > 2)
                            selection._CopySectionFormat(section);
                    }
                    block._Delete(selection, start, end, editAction);
                }
            }
        };
        TableAdv.prototype._DeleteContent = function (selection, editAction) {
            if (editAction < 4) {
                this._RemoveBlock();
                selection.CurrentBaseHistoryInfo.RemovedNodes._Add(this);
            }
        };
        TableAdv.prototype._DeleteCells = function (selection, startCell, endCell, editAction) {
            var clonedTable = null;
            var isDeleteCells = false;
            var action = Actions.Delete;
            if (selection.CurrentBaseHistoryInfo != null) {
                action = selection.CurrentBaseHistoryInfo.Action;
                isDeleteCells = selection.CurrentBaseHistoryInfo.Action == Actions.BackSpace || selection.CurrentBaseHistoryInfo.Action == Actions.DeleteCells
                    || selection.CurrentBaseHistoryInfo.Action == Actions.InsertTable || (startCell.OwnerRow.PreviousNode == null
                    && endCell.OwnerRow.NextNode == null && selection.CurrentBaseHistoryInfo.Action == Actions.Cut);
                selection.CurrentBaseHistoryInfo.Action = isDeleteCells ? Actions.DeleteCells : Actions.ClearCells;
                clonedTable = this._CloneTableToHistoryInfo(selection.CurrentBaseHistoryInfo);
                selection.OwnerControl.IsLayoutEnabled = false;
            }
            var start = startCell.OwnerRow._GetCellLeft(startCell);
            var end = start + startCell.CellFormat.CellWidth;
            var endCellLeft = endCell.OwnerRow._GetCellLeft(endCell);
            var endCellRight = endCellLeft + endCell.CellFormat.CellWidth;
            if (start > endCellLeft)
                start = endCellLeft;
            if (end < endCellRight)
                end = endCellRight;
            if (start > selection.UpDownSelectionLength)
                start = selection.UpDownSelectionLength;
            if (end < selection.UpDownSelectionLength)
                end = selection.UpDownSelectionLength;
            var endRowIndex = this.Rows._IndexOf(endCell.OwnerRow);
            var isStarted = false;
            var isCellCleared = false;
            for (var i = this.Rows._IndexOf(startCell.OwnerRow); i <= endRowIndex && i < this.Rows.Count; i++) {
                var row = this.Rows[i];
                for (var j = 0; j < row.Cells.Count; j++) {
                    var left = row._GetCellLeft(row.Cells[j]);
                    if (MathHelper._Round(start, 2) <= MathHelper._Round(left, 2) && MathHelper._Round(left, 2) < MathHelper._Round(end, 2)) {
                        if (!isStarted) {
                            row.Cells[j]._UpdateEditPosition(selection);
                            isStarted = true;
                        }
                        if (isDeleteCells) {
                            row.Cells._RemoveAt(j);
                            j--;
                        }
                        else if (editAction < 4)
                            isCellCleared = row.Cells[j]._DeleteCell(selection, editAction, false);
                    }
                }
                if (row.Cells.Count == 0) {
                    this.Rows._RemoveAt(i);
                    i--;
                    endRowIndex--;
                }
            }
            selection.OwnerControl.IsLayoutEnabled = true;
            if (this.Rows.Count == 0) {
                selection.EditPosition = this._GetHierarchicalIndex("0");
                selection.CurrentBaseHistoryInfo.Action = action;
                this._RemoveBlock();
            }
            else {
                if (!isDeleteCells && !isCellCleared)
                    selection.CurrentBaseHistoryInfo = null;
                else
                    this._Layout();
            }
        };
        TableAdv.prototype._CalculateGridOnly = function () {
            var tempGrid = new List();
            var rowSpannedCells = new List();
            for (var i = 0; i < this.Rows.Count; i++) {
                var row = this.Rows[i];
                var columnSpan = row.GridBefore;
                var currOffset = 0;
                if (!tempGrid._Contains(currOffset))
                    tempGrid._Add(currOffset);
                currOffset += row.GridBeforeWidth * 15;
                var startOffset = Math.round(currOffset);
                if (!tempGrid._Contains(startOffset))
                    tempGrid._Add(startOffset);
                for (var j = 0; j < row.Cells.Count; j++) {
                    var cell = row.Cells[j];
                    if (rowSpannedCells.Count == 0)
                        cell.ColumnIndex = columnSpan;
                    for (var k = 0; k < rowSpannedCells.Count; k++) {
                        if (rowSpannedCells[k].ColumnIndex < columnSpan) {
                            cell.ColumnIndex = columnSpan;
                            continue;
                        }
                        var rowSpan = 1;
                        var removeSpannedCell = true;
                        rowSpan = rowSpannedCells[k].CellFormat.RowSpan;
                        if (rowSpannedCells[k].ColumnIndex > columnSpan) {
                            cell.ColumnIndex = columnSpan;
                            removeSpannedCell = false;
                            if (j == row.Cells.Count - 1 && row.GridAfter > 0)
                                currOffset += rowSpannedCells[k].CellFormat.CellWidth * 15;
                        }
                        else {
                            cell.ColumnIndex = columnSpan = this.TableHolder.Columns._IndexOf(rowSpannedCells[k].OwnerColumn) + rowSpannedCells[k].CellFormat.ColumnSpan;
                            currOffset += rowSpannedCells[k].CellFormat.CellWidth * 15;
                        }
                        if (!removeSpannedCell && j == row.Cells.Count - 1)
                            removeSpannedCell = true;
                        if (removeSpannedCell && i - rowSpannedCells[k].OwnerRow.RowIndex == rowSpan - 1) {
                            rowSpannedCells._RemoveAt(k);
                            k--;
                        }
                    }
                    if (cell.CellFormat.RowSpan > 1) {
                        if (rowSpannedCells.Count == 0 || rowSpannedCells[rowSpannedCells.Count - 1].ColumnIndex <= columnSpan)
                            rowSpannedCells._Add(cell);
                        else {
                            for (var m = rowSpannedCells.Count; m > 0; m--) {
                                if (rowSpannedCells[m - 1].ColumnIndex > columnSpan)
                                    rowSpannedCells._Insert(m - 1, cell);
                            }
                        }
                    }
                    columnSpan += cell.CellFormat.ColumnSpan;
                    currOffset += cell.CellFormat.CellWidth * 15;
                    var offset = Math.round(currOffset);
                    if (!tempGrid._Contains(offset))
                        tempGrid._Add(offset);
                    if (j == row.Cells.Count - 1 && row.GridAfterWidth > 0) {
                        currOffset += row.GridAfterWidth * 15;
                        if (!tempGrid._Contains(Math.round(currOffset)))
                            tempGrid._Add(Math.round(currOffset));
                        columnSpan += row.GridAfter;
                    }
                }
            }
            tempGrid._Sort();
            if (tempGrid.Count - 1 != this.TableHolder.Columns.Count)
                this._UpdateColumnSpans(tempGrid);
        };
        TableAdv.prototype._UpdateColumnSpans = function (tempGrid) {
            for (var i = 0; i < this.Rows.length; i++) {
                var row = this.Rows[i];
                if (row.GridBeforeWidth >= 0)
                    row.GridBefore = row._GetGridCount(tempGrid, -1);
                for (var j = 0; j < row.Cells.length; j++) {
                    var cell = row.Cells[j];
                    var columnSpan = row._GetGridCount(tempGrid, cell._GetIndexInOwnerCollection());
                    if (columnSpan > 0 && cell.CellFormat.ColumnSpan != columnSpan) {
                        this.IsTableGridUpdated = false;
                        cell.CellFormat.ColumnSpan = columnSpan;
                    }
                }
                if (row.GridAfterWidth >= 0)
                    row.GridAfter = row._GetGridCount(tempGrid, row.Cells.Count);
            }
        };
        TableAdv.prototype._CheckTableGrid = function () {
            if (this.tableGrid != null && this.tableGrid.Count > 1)
                this._BuildColumns();
            else {
                this.tableGrid = new List();
                this._BuildColumns();
            }
        };
        TableAdv.prototype._FitChildsToClientArea = function () {
            var clientWidth = this._GetContainerWidth();
            if (Math.round(clientWidth) < Math.round(this.TableWidth))
                this._FitCellsToClientArea(clientWidth);
            for (var i = 0; i < this.Rows.length; i++) {
                var row = this.Rows[i];
                for (var j = 0; j < row.Cells.length; j++) {
                    var cell = row.Cells[j];
                    for (var k = 0; k < cell.Blocks.length; k++) {
                        var block = cell.Blocks[k];
                        if (block instanceof TableAdv)
                            block._FitChildsToClientArea();
                    }
                }
            }
        };
        TableAdv.prototype._GetParentTable = function () {
            var owner = this;
            while (!(owner.Owner instanceof SectionAdv) && owner.Owner instanceof TableCellAdv) {
                owner = owner.Owner.OwnerTable;
            }
            return owner;
        };
        TableAdv.prototype._FitCellsToClientArea = function (clientWidth) {
            var tableWidth = this._GetTableWidth();
            var factor = clientWidth / tableWidth;
            for (var i = 0; i < this.Rows.length; i++) {
                var row = this.Rows[i];
                row.GridAfterWidth *= factor;
                row.GridBeforeWidth *= factor;
                for (var j = 0; j < row.Cells.length; j++) {
                    var cell = row.Cells[j];
                    cell.CellFormat.CellWidth *= factor;
                }
            }
        };
        TableAdv.prototype._GetColumnCellsForSelection = function (startCell, endCell) {
            var cells = new List();
            var start = startCell.ColumnIndex;
            var end = start + 1;
            end = endCell.ColumnIndex + endCell.CellFormat.ColumnSpan;
            for (var i = 0; i < this.Rows.length; i++) {
                var row = this.Rows[i];
                for (var j = 0; j < row.Cells.length; j++) {
                    var cell = row.Cells[j];
                    var columnIndex = cell.ColumnIndex;
                    var columnSpan = 1;
                    columnSpan = cell.CellFormat.ColumnSpan;
                    if ((columnIndex + columnSpan > start && columnIndex + columnSpan < end) || (columnIndex > start && columnIndex < end)) {
                        if (!cells._Contains(cell))
                            cells._Add(cell);
                    }
                    else if ((columnIndex > start && columnIndex < end && columnIndex + columnSpan < end) || (columnIndex < start && columnIndex + columnSpan > end)) {
                        if (!cells._Contains(cell))
                            cells._Add(cell);
                    }
                    else if (columnIndex == start || columnIndex + columnSpan == end) {
                        if (!cells._Contains(cell))
                            cells._Add(cell);
                    }
                }
            }
            return cells;
        };
        TableAdv.prototype._InsertTable = function (table, moveRows) {
            var insertIndex = this._GetIndexInOwnerCollection();
            var owner = (this.Owner instanceof CompositeNode) ? this.Owner : null;
            var childNodes = null;
            var comment = (this.Owner instanceof CommentAdv) ? this.Owner : null;
            this._RemoveBlock();
            if (moveRows) {
                for (var i = 0, index = 0; i < this.Rows.Count; i++, index++) {
                    var row = this.Rows[i];
                    table.Rows._Insert(index, row);
                    i--;
                }
            }
            if (comment != null) {
                comment.Blocks._Insert(insertIndex, table);
                return;
            }
            if (owner != null)
                childNodes = owner.ChildNodes;
            if (childNodes != null && childNodes instanceof BlockAdvCollection)
                childNodes._Insert(insertIndex, table);
        };
        TableAdv.prototype._GetColumnCells = function (ColumnIndex, isLeftSideCollection) {
            var cells = new List();
            for (var i = 0; i < this.Rows.length; i++) {
                var row = this.Rows[i];
                for (var i_1 = 0; i_1 < row.Cells.length; i_1++) {
                    var cell = row.Cells[i_1];
                    if (isLeftSideCollection) {
                        if (cell.ColumnIndex + cell.CellFormat.ColumnSpan == ColumnIndex)
                            cells._Add(cell);
                    }
                    else {
                        if (cell.ColumnIndex == ColumnIndex)
                            cells._Add(cell);
                    }
                }
            }
            return cells;
        };
        TableAdv.prototype._GetLeastGridBefore = function (ignoreRow) {
            var gridBefore = 0;
            var flag = 0;
            for (var i = 0; i < this.Rows.length; i++) {
                var row = this.Rows[i];
                if (row != ignoreRow) {
                    if (flag == 0) {
                        gridBefore = row.GridBeforeWidth;
                        flag++;
                    }
                    if (row.GridBeforeWidth <= gridBefore)
                        gridBefore = row.GridBeforeWidth;
                }
            }
            return gridBefore;
        };
        TableAdv.prototype._GetOwnerWidth = function () {
            var width = 0;
            if (this.AssociatedCell != null) {
                width = this.AssociatedCell.CellFormat.CellWidth - this.AssociatedCell.LeftMargin - this.AssociatedCell.RightMargin;
            }
            else {
                if (this.Section == null)
                    return width;
                width = this.Section.SectionFormat.PageWidth;
            }
            return width;
        };
        TableAdv.prototype._GetTableClientWidth = function (clientWidth) {
            var tableWidth = 0;
            if (this.TableFormat.PreferredWidthType == WidthType.Pixel
                && this.TableFormat.PreferredWidth > 0)
                tableWidth = this.TableFormat.PreferredWidth;
            else {
                tableWidth = clientWidth;
                if (this.TableFormat.PreferredWidthType == WidthType.Percent
                    && this.TableFormat.PreferredWidth > 0) {
                    tableWidth = tableWidth * this.TableFormat.PreferredWidth / 100;
                }
            }
            return tableWidth;
        };
        TableAdv.prototype._IsColumnSelected = function (columnIndex, selection) {
            if (Document == null)
                return false;
            var selectedCells = selection._GetSelectedCells();
            var leftColumnCells = this._GetColumnCells(columnIndex, true);
            var rightColumnCells = this._GetColumnCells(columnIndex, false);
            var isColumnSelected = false;
            for (var i = 0; i < leftColumnCells.length; i++) {
                var columnCell = leftColumnCells[i];
                if (selectedCells._Contains(columnCell))
                    isColumnSelected = true;
                else
                    isColumnSelected = false;
            }
            if (!isColumnSelected) {
                for (var i = 0; i < rightColumnCells.length; i++) {
                    var columnCell = rightColumnCells[i];
                    if (selectedCells._Contains(columnCell))
                        isColumnSelected = true;
                    else
                        isColumnSelected = false;
                }
            }
            return isColumnSelected;
        };
        TableAdv.prototype._UpdateWidth = function (dragValue) {
            if (this.TableFormat.PreferredWidthType == WidthType.Auto)
                this.TableFormat.PreferredWidthType = WidthType.Pixel;
            if (this.TableFormat.PreferredWidthType == WidthType.Pixel)
                this.TableFormat.PreferredWidth = this._GetMaxRowWidth(true);
            else {
                var value = this._ConvertPixelToPercent(this._GetMaxRowWidth(true));
                this.TableFormat.PreferredWidth = value;
            }
        };
        TableAdv.prototype._GetMaxRowWidth = function (toUpdateGridAfter) {
            var width = 0;
            for (var i = 0; i < this.Rows.length; i++) {
                var row = this.Rows[i];
                var rowWidth = 0;
                if (toUpdateGridAfter)
                    rowWidth = rowWidth + row.GridBeforeWidth;
                for (var i_2 = 0; i_2 < row.Cells.length; i_2++) {
                    var cell = row.Cells[i_2];
                    rowWidth += cell.CellFormat.CellWidth;
                }
                if (width < rowWidth)
                    width = rowWidth;
            }
            return width;
        };
        TableAdv.prototype._ConvertPixelToPercent = function (tablePreferredWidth) {
            var value = 0;
            var ownerWidth = this._GetOwnerWidth();
            value = (tablePreferredWidth / ownerWidth) * 100;
            value = MathHelper._Round(value, 1);
            return value < 100 ? value : 100;
        };
        TableAdv.prototype._ConvertPercentToPixel = function (tablePreferredWidth) {
            var value = 0;
            var ownerWidth = this._GetOwnerWidth();
            value = (tablePreferredWidth * ownerWidth) / 100;
            value = MathHelper._Round(value, 2);
            return value < 2112 ? value : 2112;
        };
        TableAdv.prototype._UpdateRowsGridAfterWidth = function () {
            var maxRowWidth = this._GetMaxRowWidth(true);
            for (var i = 0; i < this.Rows.length; i++) {
                var row = this.Rows[i];
                var currentRowWidth = row._GetRowWidth(true);
                if (maxRowWidth >= currentRowWidth && row.GridAfterWidth != maxRowWidth - currentRowWidth)
                    row.GridAfterWidth = maxRowWidth - currentRowWidth;
            }
        };
        TableAdv.prototype._Dispose = function () {
            if (this.SpannedRowCollection != null) {
                this.SpannedRowCollection._Clear();
                this.SpannedRowCollection = null;
            }
            this._SetOwner(null);
            this.TableFormat._Dispose();
            if (this.tableholder != null) {
                this.tableholder._Dispose();
                this.tableholder = null;
            }
            if (this.TableWidgets != null) {
                this._ClearWidgets();
                this.TableWidgets = null;
            }
            if (this.Rows != null) {
                this.Rows._Dispose();
                for (var i = 0; i < this.Rows.Count; i++) {
                    var row = this.Rows[i];
                    row._Dispose();
                    this.Rows._Remove(row);
                    i--;
                }
                this.ChildNodes = null;
            }
            this.Fields = null;
            this.FieldCharacter = null;
        };
        return TableAdv;
    }(BlockAdv));
    DocumentEditorFeatures.TableAdv = TableAdv;
    var TableRowAdv = (function (_super) {
        __extends(TableRowAdv, _super);
        function TableRowAdv(node) {
            _super.call(this, node);
            this.gridBefore = 0;
            this.gridBeforeWidth = 0;
            this.gridAfter = 0;
            this.gridAfterWidth = 0;
            this.ChildNodes = new TableCellAdvCollection(this);
            this.RowFormat = new RowFormat(this);
            this.TableRowWidgets = new List();
        }
        Object.defineProperty(TableRowAdv.prototype, "OwnerTable", {
            get: function () {
                return this.Owner;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(TableRowAdv.prototype, "RowIndex", {
            get: function () {
                if (this.OwnerTable != null)
                    return this.OwnerTable.Rows.indexOf(this);
                return -1;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(TableRowAdv.prototype, "GridBefore", {
            get: function () { return this.gridBefore; },
            set: function (value) { this.gridBefore = value; },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(TableRowAdv.prototype, "GridBeforeWidth", {
            get: function () { return this.gridBeforeWidth; },
            set: function (value) { this.gridBeforeWidth = value; },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(TableRowAdv.prototype, "GridAfter", {
            get: function () { return this.gridAfter; },
            set: function (value) { this.gridAfter = value; },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(TableRowAdv.prototype, "GridAfterWidth", {
            get: function () { return this.gridAfterWidth; },
            set: function (value) { this.gridAfterWidth = value; },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(TableRowAdv.prototype, "Cells", {
            get: function () {
                return this.ChildNodes;
            },
            enumerable: true,
            configurable: true
        });
        TableRowAdv.prototype._ApplyCharacterFormat = function (selection, start, end, property, value, update) {
            value = this.Cells[0]._GetCharacterFormatValue(property, value);
            for (var i = this.RowIndex; i < this.OwnerTable.Rows.Count; i++) {
                var row = this.OwnerTable.Rows[i];
                for (var j = 0; j < row.Cells.Count; j++) {
                    row.Cells[j]._ApplyCharacterFormatForSel(selection, property, value, update);
                }
                if (end.Paragraph.IsInsideTable && row._Contains(end.Paragraph.AssociatedCell))
                    return;
            }
            var block = this.OwnerTable._GetNextRenderedBlock();
            block._ApplyCharacterFormat(selection, start, end, property, value, update);
        };
        TableRowAdv.prototype._LayoutItems = function (viewer) {
            if (this.TableRowWidgets != null
                && this.TableRowWidgets.length > 0) {
                this.TableRowWidgets._Clear();
            }
            this._AddTableRowWidget(viewer.ClientActiveArea);
            viewer._UpdateClientAreaForRow(this, true);
            for (var i = 0; i < this.Cells.length; i++) {
                var cell = this.Cells[i];
                cell._LayoutItems(viewer, this._GetMaxTopOrBottomCellMargin(0) + this.TableRowWidgets[this.TableRowWidgets.Count - 1].TopBorderWidth, this._GetMaxTopOrBottomCellMargin(1) + this.TableRowWidgets[this.TableRowWidgets.Count - 1].BottomBorderWidth);
            }
            viewer._UpdateClientAreaForRow(this, false);
            this._UpdateWidgetsToTable(viewer);
        };
        TableRowAdv.prototype._AddTableRowWidget = function (area) {
            var tableRowWidget = new TableRowWidget(this);
            tableRowWidget.X = area.X + this.GridBeforeWidth;
            tableRowWidget.Y = area.Y;
            tableRowWidget.Width = area.Width;
            this.TableRowWidgets._Add(tableRowWidget);
            var borderWidth = 0;
            if (this.OwnerTable != null && this.OwnerTable.TableFormat != null && this.OwnerTable.TableFormat.CellSpacing > 0) {
                tableRowWidget.Height = tableRowWidget.Height + this.OwnerTable.TableFormat.CellSpacing;
                for (var i = 0; i < this.Cells.Count; i++) {
                    if (this.Cells[i].CellFormat != null && this.Cells[i].CellFormat.Borders != null) {
                        var value = this.Cells[i].CellFormat.Borders._GetCellBottomBorder(this.Cells[i])._GetLineWidth();
                        if (value > borderWidth)
                            borderWidth = value;
                    }
                }
                tableRowWidget.BottomBorderWidth = borderWidth;
                if (this.RowIndex > 0 && this.PreviousNode != null) {
                    var prevRow = this.PreviousNode;
                    borderWidth = 0;
                    for (var i = 0; i < prevRow.Cells.Count; i++) {
                        if (prevRow.Cells[i].CellFormat != null && prevRow.Cells[i].CellFormat.Borders != null) {
                            var value = prevRow.Cells[i].CellFormat.Borders._GetCellBottomBorder(prevRow.Cells[i])._GetLineWidth();
                            if (value > borderWidth)
                                borderWidth = value;
                        }
                    }
                    tableRowWidget.TopBorderWidth = borderWidth;
                }
            }
            if (this.Cells != null)
                for (var i = 0; i < this.Cells.Count; i++) {
                    if (this.Cells[i].CellFormat != null && this.Cells[i].CellFormat.Borders != null) {
                        var value = this.Cells[i].CellFormat.Borders._GetCellTopBorder(this.Cells[i])._GetLineWidth();
                        if (value > borderWidth)
                            borderWidth = value;
                    }
                }
            tableRowWidget.TopBorderWidth = borderWidth;
            if (this.OwnerTable != null && this.OwnerTable.TableFormat != null && this.OwnerTable.TableFormat.CellSpacing <= 0 && this.RowIndex == this.OwnerTable.Rows.Count - 1) {
                for (var i = 0; i < this.Cells.Count; i++) {
                    if (this.Cells[i].CellFormat != null && this.Cells[i].CellFormat.Borders != null) {
                        var value = this.Cells[i].CellFormat.Borders._GetCellBottomBorder(this.Cells[i])._GetLineWidth();
                        if (value > borderWidth)
                            borderWidth = value;
                    }
                }
                tableRowWidget.BottomBorderWidth = borderWidth;
            }
        };
        TableRowAdv.prototype._GetHeaderHeight = function (OwnerTable) {
            var height = 0;
            if (this.OwnerTable.Rows.Count > 0 && OwnerTable.Rows[0].RowFormat.IsHeader) {
                for (var i = 0; i < OwnerTable.Rows.Count; i++) {
                    var row = OwnerTable.Rows[i];
                    if (row.RowFormat.IsHeader)
                        height = height + row._GetRowHeight();
                    else
                        break;
                }
            }
            return height;
        };
        TableRowAdv.prototype._GetRowHeight = function () {
            var height = 0;
            if (this.RowFormat.HeightType == HeightType.Exactly) {
                height = this.RowFormat.Height;
            }
            else if (this.TableRowWidgets != null && this.TableRowWidgets.Count > 0) {
                for (var i = 0; i < this.TableRowWidgets.Count; i++) {
                    height = this.TableRowWidgets[i].Height + height;
                }
                height = Math.max(height, this.RowFormat.Height);
            }
            return height;
        };
        TableRowAdv.prototype._IsVerticalMergedCellContinue = function () {
            var colIndex = 0;
            for (var i = 0; i < this.Cells.Count; i++) {
                var cell = this.Cells[i];
                if (colIndex < cell.ColumnIndex)
                    return true;
                colIndex += cell.CellFormat.ColumnSpan;
            }
            return colIndex < this.OwnerTable.TableHolder.Columns.Count;
        };
        TableRowAdv.prototype._UpdateWidgetsToTable = function (viewer) {
            var rowHeight = this._GetRowHeight();
            var isHeader = false;
            var isAllowBreakAcrossPages = true;
            var heightType = HeightType.Auto;
            var cellspacing = 0;
            var count = this.TableRowWidgets.length - 1;
            var tableRowWidget = this.TableRowWidgets[count];
            isHeader = this.RowFormat.IsHeader;
            isAllowBreakAcrossPages = this.RowFormat.AllowBreakAcrossPages;
            heightType = this.RowFormat.HeightType;
            if (this.OwnerTable != null && this.OwnerTable.ContinueHeader && !isHeader)
                this.OwnerTable.ContinueHeader = false;
            cellspacing = (this.OwnerTable != null && this.OwnerTable.TableFormat != null) ? this.OwnerTable.TableFormat.CellSpacing : 0;
            while (count < this.TableRowWidgets.length) {
                count = this.TableRowWidgets.length;
                if (viewer instanceof FlowLayoutViewer || this.OwnerTable.IsInsideTable || viewer.CurrentComment != null || (viewer.SplittedCellWidgets.length == 0 && tableRowWidget.Y + tableRowWidget.Height + cellspacing <= viewer.ClientArea.Bottom)) {
                    this._AddWidgetToTable(viewer, tableRowWidget);
                }
                else {
                    if (viewer.SplittedCellWidgets.length > 0 && tableRowWidget.Y + tableRowWidget.Height <= viewer.ClientArea.Bottom) {
                        var isRowSpanEnd = this._IsRowSpanEnd(viewer);
                        if (!isRowSpanEnd) {
                            if (this._IsVerticalMergedCellContinue()) {
                                tableRowWidget._InsertSplittedCellWidgets(viewer);
                            }
                            this._AddWidgetToTable(viewer, tableRowWidget);
                            continue;
                        }
                    }
                    var splittedWidget = tableRowWidget;
                    var tableWidget = this.OwnerTable.TableWidgets[this.OwnerTable.TableWidgets.Count - 1];
                    if (rowHeight + tableRowWidget.Y > viewer.ClientArea.Bottom) {
                        if (!isAllowBreakAcrossPages || (isHeader && this.OwnerTable.ContinueHeader) || (heightType == HeightType.Atleast && this.RowFormat.Height < viewer.ClientArea.Bottom)) {
                            if (rowHeight + tableRowWidget.Y > viewer.ClientArea.Bottom) {
                                if ((heightType == HeightType.Atleast && this.RowFormat.Height < viewer.ClientActiveArea.Height && isAllowBreakAcrossPages) || (heightType != HeightType.Exactly && tableRowWidget.Y == viewer.ClientArea.Y) || (heightType == HeightType.Auto && isAllowBreakAcrossPages)) {
                                    splittedWidget = this._SplitWidgets(tableRowWidget, viewer, splittedWidget);
                                }
                                if (heightType == HeightType.Exactly && tableRowWidget.Y == viewer.ClientArea.Y) {
                                    this._AddWidgetToTable(viewer, tableRowWidget);
                                    count++;
                                }
                                if (isHeader && this.OwnerTable.ContinueHeader) {
                                    this.OwnerTable.Header = false;
                                    this.OwnerTable.ContinueHeader = false;
                                    this.OwnerTable.HeaderHeight = 0;
                                    var pages = null;
                                    if (viewer instanceof PageLayoutViewer)
                                        pages = viewer.Pages;
                                    if (pages != null) {
                                        for (var i = 0; i < pages.Count; i++) {
                                            if (pages[i].RepeatHeaderRowTableWidget)
                                                pages[i].RepeatHeaderRowTableWidget = false;
                                        }
                                    }
                                }
                            }
                            else if (isHeader && this.OwnerTable.ContinueHeader) {
                                this._AddWidgetToTable(viewer, tableRowWidget);
                                this.OwnerTable.Header = true;
                            }
                            else if (!isAllowBreakAcrossPages) {
                                this._AddWidgetToTable(viewer, tableRowWidget);
                                if (this.OwnerTable.Header && tableRowWidget.Height + this.OwnerTable.HeaderHeight < viewer.ClientArea.Bottom) {
                                    if (this.RowFormat.Height < viewer.ClientActiveArea.Bottom) {
                                        tableRowWidget.X = tableRowWidget.X;
                                        tableRowWidget.Y = tableWidget.Y + this.OwnerTable.HeaderHeight;
                                        tableRowWidget._UpdateChildLocation(tableRowWidget.Y + this.OwnerTable.HeaderHeight);
                                    }
                                }
                            }
                        }
                        else {
                            if ((heightType == HeightType.Auto || heightType == HeightType.Atleast) && isAllowBreakAcrossPages) {
                                if (!(this.RowFormat.Height > viewer.ClientArea.Bottom) || tableRowWidget.Y == viewer.ClientArea.Y) {
                                    splittedWidget = this._SplitWidgets(tableRowWidget, viewer, splittedWidget);
                                }
                            }
                            else if (heightType == HeightType.Exactly && tableRowWidget.Y == viewer.ClientArea.Y) {
                                this._AddWidgetToTable(viewer, tableRowWidget);
                                count++;
                            }
                        }
                    }
                    else {
                        if (this._IsVerticalMergedCellContinue() && isAllowBreakAcrossPages) {
                            splittedWidget = this._SplitWidgets(tableRowWidget, viewer, splittedWidget);
                        }
                    }
                    if (splittedWidget != null) {
                        if (splittedWidget != tableRowWidget) {
                            this._AddWidgetToTable(viewer, tableRowWidget);
                            this.OwnerTable._UpdateWidgetsToPage(viewer);
                            var index = this.OwnerTable.TableWidgets._IndexOf(tableRowWidget.ContainerWidget);
                            if (index + 1 >= this.OwnerTable.TableWidgets.length)
                                this.OwnerTable._AddTableWidget(viewer.ClientActiveArea);
                            tableRowWidget = splittedWidget;
                        }
                        else {
                            if (this.RowIndex > 0) {
                                this.OwnerTable._UpdateWidgetsToPage(viewer);
                                if (this.PreviousNode instanceof TableRowAdv
                                    && this.PreviousNode.TableRowWidgets.length > 0) {
                                    var prevWidget = this.PreviousNode.TableRowWidgets[this.PreviousNode.TableRowWidgets.length - 1];
                                    if (MathHelper._Round(tableRowWidget.Y, 2) == MathHelper._Round(prevWidget.Y + prevWidget.Height, 2)) {
                                        var prevIndex = this.OwnerTable.TableWidgets._IndexOf(prevWidget.ContainerWidget);
                                        if (prevIndex + 1 >= this.OwnerTable.TableWidgets.length)
                                            this.OwnerTable._AddTableWidget(viewer.ClientActiveArea);
                                    }
                                    else
                                        this.OwnerTable._AddTableWidget(viewer.ClientActiveArea);
                                }
                                else
                                    this.OwnerTable._AddTableWidget(viewer.ClientActiveArea);
                            }
                            count--;
                        }
                        tableWidget = this.OwnerTable.TableWidgets[this.OwnerTable.TableWidgets.Count - 1];
                        var prevBodyWidget = null;
                        if (this.OwnerTable.TableWidgets.length > 1)
                            prevBodyWidget = this.OwnerTable.TableWidgets[this.OwnerTable.TableWidgets.length - 2].ContainerWidget;
                        else {
                            var previousBlock = this.OwnerTable.PreviousBlock;
                            if (previousBlock instanceof ParagraphAdv)
                                prevBodyWidget = previousBlock.ParagraphWidgets[previousBlock.ParagraphWidgets.length - 1].ContainerWidget;
                            else if (previousBlock instanceof TableAdv)
                                prevBodyWidget = previousBlock.TableWidgets[previousBlock.TableWidgets.length - 1].ContainerWidget;
                        }
                        var pageIndex = 0;
                        if (prevBodyWidget != null)
                            pageIndex = viewer.Pages.indexOf(prevBodyWidget.Page);
                        if (pageIndex == viewer.Pages.length - 1
                            || viewer.Pages[pageIndex + 1].Section != this.OwnerTable.Section) {
                            var page = viewer._CreateNewPage(this.OwnerTable.Section);
                            if (viewer.Pages[pageIndex + 1].Section != this.OwnerTable.Section)
                                viewer._InsertPage(pageIndex + 1, page);
                        }
                        else {
                            viewer.Pages[pageIndex + 1].BoundingRectangle = new Rect(viewer.Pages[pageIndex + 1].BoundingRectangle.X, viewer.Pages[pageIndex].BoundingRectangle.Bottom + 20, viewer.Pages[pageIndex + 1].BoundingRectangle.Width, viewer.Pages[pageIndex + 1].BoundingRectangle.Height);
                            viewer._UpdateClientArea(this.OwnerTable.Section.SectionFormat);
                        }
                        if (this.OwnerTable.Header && tableRowWidget.Height < viewer.ClientArea.Bottom) {
                            if (viewer instanceof PageLayoutViewer)
                                viewer.CurrentRenderingPage.RepeatHeaderRowTableWidget = true;
                            viewer._UpdateClientAreaForBlock(this.OwnerTable, true);
                            splittedWidget.X = splittedWidget.X;
                            splittedWidget.Y = tableWidget.Y + this.OwnerTable.HeaderHeight;
                            var cellspace = viewer instanceof PageLayoutViewer ? cellspacing / 2 : cellspacing;
                            splittedWidget._UpdateChildLocation(tableWidget.Y + this.OwnerTable.HeaderHeight - cellspace);
                        }
                        else {
                            viewer._UpdateClientAreaForBlock(this.OwnerTable, true);
                            splittedWidget.X = splittedWidget.X;
                            splittedWidget.Y = tableWidget.Y;
                            var cellspace = viewer instanceof PageLayoutViewer ? cellspacing / 2 : cellspacing;
                            splittedWidget._UpdateChildLocation(tableWidget.Y - cellspace);
                        }
                    }
                }
                if (isHeader && this.OwnerTable.ContinueHeader) {
                    this.OwnerTable.Header = true;
                    this.OwnerTable.HeaderHeight = rowHeight + this.OwnerTable.HeaderHeight;
                }
                if (isHeader && this.OwnerTable._GetHeader() != null && this.RowIndex == this.OwnerTable._GetHeader().RowIndex) {
                    var headerHeight = this._GetHeaderHeight(this.OwnerTable);
                    if (headerHeight > this.OwnerTable.HeaderHeight || headerHeight > this.OwnerTable.HeaderHeight)
                        this.OwnerTable.HeaderHeight = headerHeight;
                    if (this.OwnerTable.HeaderHeight > viewer.ClientArea.Height) {
                        this.OwnerTable.Header = false;
                        this.OwnerTable.ContinueHeader = false;
                        this.OwnerTable.HeaderHeight = 0;
                        var pages = viewer.Pages;
                        for (var i = 0; i < pages.Count; i++) {
                            if (pages[i].RepeatHeaderRowTableWidget)
                                pages[i].RepeatHeaderRowTableWidget = false;
                        }
                    }
                }
                if (this.OwnerTable.TableWidgets.Count > 2 && this.OwnerTable.Header && tableRowWidget.Height < viewer.ClientActiveArea.Bottom && !viewer.CurrentRenderingPage.RepeatHeaderRowTableWidget) {
                    if (viewer instanceof PageLayoutViewer)
                        viewer.CurrentRenderingPage.RepeatHeaderRowTableWidget = true;
                }
            }
        };
        TableRowAdv.prototype._SplitWidgets = function (tableRowWidget, viewer, splittedWidget) {
            if (tableRowWidget._IsFirstLineFit(viewer.ClientArea.Bottom) && tableRowWidget.ChildWidgets.Count > 0) {
                splittedWidget = tableRowWidget._GetSplittedWidget(viewer.ClientArea.Bottom);
                if (viewer.SplittedCellWidgets.length > 0 || splittedWidget != tableRowWidget)
                    splittedWidget._InsertSplittedCellWidgets(viewer);
            }
            else
                splittedWidget._InsertSplittedCellWidgets(viewer);
            return splittedWidget;
        };
        TableRowAdv.prototype._Clone = function () {
            var row = new TableRowAdv(null);
            row.RowFormat._CopyFormat(this.RowFormat);
            row.GridBefore = this.GridBefore;
            row.GridAfter = this.GridAfter;
            row.GridBeforeWidth = this.GridBeforeWidth;
            row.GridAfterWidth = this.GridAfterWidth;
            for (var i = 0; i < this.Cells.Count; i++) {
                row.Cells._Add(this.Cells[i]._Clone());
            }
            return row;
        };
        TableRowAdv.prototype._AddWidgetToTable = function (viewer, tableRowWidget) {
            var tableWidget = this.OwnerTable.TableWidgets[0];
            var index = tableWidget.ChildWidgets.length;
            var prevWidget = null;
            var rowWidgetIndex = this.TableRowWidgets.indexOf(tableRowWidget);
            if (rowWidgetIndex > 0)
                prevWidget = this.TableRowWidgets[rowWidgetIndex - 1];
            else if (this.PreviousNode instanceof TableRowAdv && this.PreviousNode.TableRowWidgets.length > 0)
                prevWidget = this.PreviousNode.TableRowWidgets[this.PreviousNode.TableRowWidgets.length - 1];
            if (prevWidget == null) {
                if (index > 0) {
                    for (var i = tableWidget.ChildWidgets.length - 1; i >= 0; i--) {
                        var widget = tableWidget.ChildWidgets[i];
                        if (widget.TableRow.RowIndex < tableRowWidget.TableRow.RowIndex) {
                            index = i + 1;
                            break;
                        }
                        else
                            index = i;
                    }
                    if (index == 0)
                        tableWidget._UpdateWidgetLocation(tableRowWidget);
                }
            }
            else {
                tableWidget = prevWidget.ContainerWidget;
                index = tableWidget.ChildWidgets.length;
                if (tableWidget.ChildWidgets._IndexOf(prevWidget) >= 0)
                    index = tableWidget.ChildWidgets._IndexOf(prevWidget) + 1;
                if (Math.round(tableRowWidget.Y) != Math.round(prevWidget.Y + prevWidget.Height)) {
                    var prevIndex = this.OwnerTable.TableWidgets._IndexOf(tableWidget);
                    if (prevIndex + 1 >= this.OwnerTable.TableWidgets.length)
                        this.OwnerTable._AddTableWidget(viewer.ClientActiveArea);
                    tableWidget = this.OwnerTable.TableWidgets[prevIndex + 1];
                    index = tableWidget.ChildWidgets.length;
                }
                if (rowWidgetIndex > 0)
                    index = 0;
            }
            this._UpdateRowHeightBySpannedCell(tableWidget, tableRowWidget, index);
            this._UpdateRowHeightByCellSpacing(tableRowWidget, viewer);
            tableWidget.ChildWidgets._Insert(index, tableRowWidget);
            tableRowWidget.ContainerWidget = tableWidget;
            tableWidget.Height = tableWidget.Height + tableRowWidget.Height;
            if (tableWidget.ContainerWidget != null
                && tableWidget.ContainerWidget.ChildWidgets._IndexOf(tableWidget) >= 0)
                tableWidget.ContainerWidget.Height += tableRowWidget.Height;
            tableRowWidget._UpdateHeight(viewer, false);
            viewer._CutFromTop(tableRowWidget.Y + tableRowWidget.Height);
        };
        TableRowAdv.prototype._UpdateRowHeightBySpannedCell = function (tableWidget, rowWidget, insertIndex) {
            var rowSpan = 1;
            if (tableWidget.ChildWidgets.length == 0 || insertIndex == 0) {
                this._UpdateRowHeight(rowWidget, rowWidget);
                return;
            }
            for (var i = 0; i < rowWidget.ChildWidgets.length; i++) {
                var cellWidget = rowWidget.ChildWidgets[i];
                rowSpan = (cellWidget == null || cellWidget.TableCell == null || cellWidget.TableCell.CellFormat == null) ? rowSpan : cellWidget.TableCell.CellFormat.RowSpan;
                if (rowSpan > 1 && this.OwnerTable != null) {
                    if (!this.OwnerTable.SpannedRowCollection._ContainsKey(this.RowIndex + rowSpan - 1))
                        this.OwnerTable.SpannedRowCollection._Add(this.RowIndex + rowSpan - 1, this.RowIndex);
                }
            }
            if (this.OwnerTable != null) {
                for (var i = 0; i < this.OwnerTable.SpannedRowCollection.Count; i++) {
                    if (this.OwnerTable.SpannedRowCollection.Keys[i] == this.RowIndex) {
                        for (var j = 0; j < insertIndex; j++) {
                            var prevRowWidget = tableWidget.ChildWidgets[j];
                            this._UpdateRowHeight(prevRowWidget, rowWidget);
                        }
                        this.OwnerTable.SpannedRowCollection._Remove(this.OwnerTable.SpannedRowCollection.Keys[i]);
                        break;
                    }
                }
            }
        };
        TableRowAdv.prototype._UpdateRowHeight = function (prevRowWidget, rowWidget) {
            var rowIndex = this.RowIndex;
            var rowSpan = 1;
            for (var i = 0; i < prevRowWidget.ChildWidgets.length; i++) {
                var cellWidget = prevRowWidget.ChildWidgets[i];
                rowSpan = (cellWidget == null || cellWidget.TableCell == null || cellWidget.TableCell.CellFormat == null) ? rowSpan : cellWidget.TableCell.CellFormat.RowSpan;
                if (rowIndex - cellWidget.TableCell.OwnerRow.RowIndex == rowSpan - 1) {
                    var mergedCellHeight = cellWidget.Y + cellWidget.Height + cellWidget.Margin.Bottom - rowWidget.Y;
                    if (rowWidget.Height < mergedCellHeight)
                        rowWidget.Height = mergedCellHeight;
                }
            }
        };
        TableRowAdv.prototype._UpdateRowHeightByCellSpacing = function (rowWidget, viewer) {
            if (this.OwnerTable.TableFormat.CellSpacing > 0) {
                if (this.OwnerTable.TableWidgets.Count > 1 && rowWidget.Y == this.OwnerTable.Document.OwnerControl.Viewer.ClientArea.Top && viewer instanceof PageLayoutViewer)
                    rowWidget.Height = rowWidget.Height - this.OwnerTable.TableFormat.CellSpacing / 2;
            }
        };
        TableRowAdv.prototype._IsRowSpanEnd = function (viewer) {
            var rowIndex = this.RowIndex;
            var rowSpan = 1;
            for (var i = 0; i < viewer.SplittedCellWidgets.length; i++) {
                var splittedCell = viewer.SplittedCellWidgets[i];
                rowSpan = rowSpan = (splittedCell == null || splittedCell.TableCell == null || splittedCell.TableCell.CellFormat == null) ? rowSpan : splittedCell.TableCell.CellFormat.RowSpan;
                if (rowIndex - splittedCell.TableCell.OwnerRow.RowIndex == rowSpan - 1)
                    return true;
            }
            return false;
        };
        TableRowAdv.prototype._GetMaxTopOrBottomCellMargin = function (topOrBottom) {
            if (this.Cells == null)
                return;
            var value = 0;
            for (var i = 0; i < this.Cells.Count; i++) {
                if (this.Cells != null && this.Cells.Count > 0) {
                    var cellFormat = this.Cells[i].CellFormat;
                    if (cellFormat._ContainsMargins()) {
                        if (topOrBottom == 0 && cellFormat.TopMargin > value)
                            value = cellFormat.TopMargin;
                        else if (topOrBottom == 1 && cellFormat.BottomMargin > value)
                            value = cellFormat.BottomMargin;
                    }
                    else {
                        var tableFormat = this.Cells[i].OwnerTable.TableFormat;
                        if (topOrBottom == 0 && tableFormat.TopMargin > value)
                            value = tableFormat.TopMargin;
                        else if (topOrBottom == 1 && tableFormat.BottomMargin > value)
                            value = tableFormat.BottomMargin;
                    }
                }
            }
            return value;
        };
        TableRowAdv.prototype._GetNextParagraph = function () {
            var row = this;
            if (row.NextNode != null) {
                var cell = row.NextNode.Cells[0];
                var block = cell.Blocks[0];
                if (block instanceof ParagraphAdv)
                    return block;
                else
                    return block._GetFirstParagraphInFirstCell();
            }
            return this.OwnerTable._GetNextParagraph();
        };
        TableRowAdv.prototype._GetPreviousParagraph = function () {
            var row = this;
            if (row.PreviousNode != null) {
                var cell = row.PreviousNode.Cells[row.PreviousNode.Cells.Count - 1];
                var block = cell.Blocks[cell.Blocks.Count - 1];
                if (block instanceof ParagraphAdv)
                    return block;
                else
                    return block._GetLastParagraphInLastCell();
            }
            return this.OwnerTable._GetPreviousParagraph();
        };
        TableRowAdv.prototype._Contains = function (tableCell) {
            if (this.Cells._Contains(tableCell))
                return true;
            while (tableCell.OwnerTable.IsInsideTable) {
                if (this.Cells._Contains(tableCell))
                    return true;
                tableCell = tableCell.OwnerTable.AssociatedCell;
            }
            return this.Cells._Contains(tableCell);
        };
        TableRowAdv.prototype._Highlight = function (selection, selectionRange, start, end) {
            for (var i = 0; i < this.Cells.Count; i++) {
                var left = this._GetCellLeft(this.Cells[i]);
                if (MathHelper._Round(start, 2) <= MathHelper._Round(left, 2) && MathHelper._Round(left, 2) < MathHelper._Round(end, 2))
                    this.Cells[i]._HighlightInternal(selection, selectionRange);
            }
        };
        TableRowAdv.prototype._HighlightInternal = function (selection, selectionRange, start, end) {
            for (var i = 0; i < this.Cells.Count; i++) {
                this.Cells[i]._HighlightInternal(selection, selectionRange);
            }
            if (end.Paragraph.IsInsideTable
                && this._Contains(end.Paragraph.AssociatedCell))
                return;
            else if (this.NextNode instanceof TableRowAdv)
                this.NextNode._HighlightInternal(selection, selectionRange, start, end);
        };
        TableRowAdv.prototype._GetCellLeft = function (cell) {
            var left = 0;
            if (cell.TableCellWidgets.Count > 0)
                left += cell.TableCellWidgets[0].X - cell.TableCellWidgets[0].Margin.Left;
            return left;
        };
        TableRowAdv.prototype._GetSelectedContentAsHtmlInternal = function (selection, start, end) {
            var html = "<tr ";
            html += this.RowFormat._GetAsHtmlStyle();
            html += ">";
            for (var i = 0; i < this.Cells.Count; i++) {
                var left = this._GetCellLeft(this.Cells[i]);
                if (MathHelper._Round(start, 2) <= MathHelper._Round(left, 2) && MathHelper._Round(left, 2) < MathHelper._Round(end, 2))
                    html += this.Cells[i]._GetContentAsHtml();
            }
            html += "</tr>";
            return html;
        };
        TableRowAdv.prototype._GetSelectedContentAsHtml = function (selection, start, end) {
            var html = "<tr ";
            html += this.RowFormat._GetAsHtmlStyle();
            html += ">";
            for (var i = 0; i < this.Cells.Count; i++) {
                html += this.Cells[i]._GetContentAsHtml();
            }
            html += "</tr>";
            if (end.Paragraph.IsInsideTable
                && this._Contains(end.Paragraph.AssociatedCell))
                return html;
            else if (this.NextNode instanceof TableRowAdv)
                return html + this.NextNode._GetSelectedContentAsHtml(selection, start, end);
            return html;
        };
        TableRowAdv.prototype._GetContentAsHtml = function () {
            var html = "<tr ";
            html += this.RowFormat._GetAsHtmlStyle();
            html += ">";
            for (var i = 0; i < this.Cells.Count; i++) {
                html += this.Cells[i]._GetContentAsHtml();
            }
            html += "</tr>";
            return html;
        };
        TableRowAdv.prototype._GetPreviousParagraphSelection = function (selection) {
            var cell = this.Cells[this.Cells.Count - 1];
            if (selection.Start.Paragraph.IsInsideTable
                && this.OwnerTable._Contains(selection.Start.Paragraph.AssociatedCell)) {
                var startCell = this.OwnerTable._GetCellInTable(selection.Start.Paragraph.AssociatedCell);
                cell = this._GetLastCellInRegion(startCell, selection.UpDownSelectionLength, true);
            }
            var block = cell.Blocks[cell.Blocks.Count - 1];
            if (block instanceof ParagraphAdv)
                return block;
            else
                return block._GetLastParagraphInLastCell();
        };
        TableRowAdv.prototype._GetNextParagraphSelection = function (selection) {
            var cell = this.Cells[0];
            if (selection.Start.Paragraph.IsInsideTable
                && this.OwnerTable._Contains(selection.Start.Paragraph.AssociatedCell)) {
                var startCell = this.OwnerTable._GetCellInTable(selection.Start.Paragraph.AssociatedCell);
                cell = this._GetFirstCellInRegion(startCell, selection.UpDownSelectionLength, false);
            }
            var block = cell.Blocks[0];
            if (block instanceof ParagraphAdv)
                return block;
            else
                return block._GetFirstParagraphInFirstCell();
        };
        TableRowAdv.prototype._GetFirstCellInRegion = function (startCell, selectionLength, isMovePrevious) {
            var start = startCell.OwnerRow._GetCellLeft(startCell);
            var end = start + startCell.CellFormat.CellWidth;
            var flag = true;
            if (start <= selectionLength && selectionLength < end) {
                for (var i = 0; i < this.Cells.Count; i++) {
                    var left = this._GetCellLeft(this.Cells[i]);
                    if (MathHelper._Round(start, 2) <= MathHelper._Round(left, 2) && MathHelper._Round(left, 2) < MathHelper._Round(end, 2)) {
                        flag = false;
                        return this.Cells[i];
                    }
                }
            }
            else {
                for (var i = 0; i < this.Cells.Count; i++) {
                    var left = this._GetCellLeft(this.Cells[i]);
                    if (left <= selectionLength && left + this.Cells[i].CellFormat.CellWidth > selectionLength) {
                        flag = false;
                        return this.Cells[i];
                    }
                }
            }
            if (flag) {
                if (this.PreviousNode != null && isMovePrevious)
                    return this.PreviousNode._GetFirstCellInRegion(startCell, selectionLength, isMovePrevious);
                else if (this.NextNode != null && !isMovePrevious)
                    return this.NextNode._GetFirstCellInRegion(startCell, selectionLength, isMovePrevious);
            }
            return this.Cells[0];
        };
        TableRowAdv.prototype._GetLastCellInRegion = function (startCell, selectionLength, isMovePrevious) {
            var start = startCell.OwnerRow._GetCellLeft(startCell);
            var end = start + startCell.CellFormat.CellWidth;
            var flag = true;
            if (start <= selectionLength && selectionLength < end) {
                for (var i = this.Cells.Count - 1; i >= 0; i--) {
                    var left = this._GetCellLeft(this.Cells[i]);
                    if (MathHelper._Round(start, 2) <= MathHelper._Round(left, 2) && MathHelper._Round(left, 2) < MathHelper._Round(end, 2)) {
                        flag = false;
                        return this.Cells[i];
                    }
                }
            }
            else {
                for (var i = this.Cells.Count - 1; i >= 0; i--) {
                    var left = this._GetCellLeft(this.Cells[i]);
                    if (left <= selectionLength && left + this.Cells[i].CellFormat.CellWidth > selectionLength) {
                        flag = false;
                        return this.Cells[i];
                    }
                }
            }
            if (flag) {
                if (this.PreviousNode != null && isMovePrevious)
                    return this.PreviousNode._GetLastCellInRegion(startCell, selectionLength, isMovePrevious);
                else if (this.NextNode != null && !isMovePrevious)
                    return this.NextNode._GetLastCellInRegion(startCell, selectionLength, isMovePrevious);
            }
            return this.Cells[this.Cells.Count - 1];
        };
        TableRowAdv.prototype._GetNextSelection = function (selection) {
            if (this.NextNode != null) {
                var isForwardSelection = selection.IsEmpty || selection.IsForward;
                if (isForwardSelection) {
                    var cell = this.NextNode.Cells[this.NextNode.Cells.Count - 1];
                    var block = cell.Blocks[cell.Blocks.Count - 1];
                    if (block instanceof ParagraphAdv)
                        return block;
                    else
                        return block._GetLastParagraphInLastCell();
                }
                else
                    return this.NextNode._GetNextParagraphSelection(selection);
            }
            return this.OwnerTable._GetNextSelection(selection);
        };
        TableRowAdv.prototype._GetPreviousSelection = function (selection) {
            if (this.PreviousNode != null) {
                if (!selection.IsForward) {
                    var cell = this.PreviousNode.Cells[0];
                    var block = cell.Blocks[0];
                    if (block instanceof ParagraphAdv)
                        return block;
                    else
                        return block._GetFirstParagraphInFirstCell();
                }
                else
                    return this.PreviousNode._GetPreviousParagraphSelection(selection);
            }
            return this.OwnerTable._GetPreviousSelection(selection);
        };
        TableRowAdv.prototype._UpdateListItems = function (block) {
            if (block.IsInsideTable && this.Cells._Contains(block.AssociatedCell._GetContainerCell())) {
                return true;
            }
            for (var i = 0; i < this.Cells.Count; i++) {
                this.Cells[i]._UpdateListItems(block);
            }
            return false;
        };
        TableRowAdv.prototype._UpdateRenderedListItems = function () {
            for (var i = 0; i < this.Cells.Count; i++) {
                this.Cells[i]._UpdateRenderedListItems();
            }
        };
        TableRowAdv.prototype._ClearWidgets = function () {
            if (this.TableRowWidgets != null
                && this.TableRowWidgets.Count > 0) {
                for (var i = 0; i < this.TableRowWidgets.Count; i++) {
                    var widget = this.TableRowWidgets[i];
                    widget._Dispose();
                    this.TableRowWidgets._Remove(widget);
                    i--;
                }
            }
        };
        TableRowAdv.prototype._GetCharacterFormat = function (selection, start, end) {
            for (var i = this.RowIndex; i < this.OwnerTable.Rows.Count; i++) {
                var row = this.OwnerTable.Rows[i];
                for (var j = 0; j < row.Cells.Count; j++) {
                    row.Cells[j]._GetCharacterFormatForSelection(selection, start, end);
                }
                if (end.Paragraph.IsInsideTable && row._Contains(end.Paragraph.AssociatedCell))
                    return;
            }
            var block = this.OwnerTable._GetNextRenderedBlock();
            block._GetCharacterFormat(selection, start, end);
        };
        TableRowAdv.prototype._GetParagraphFormat = function (selection, start, end) {
            for (var i = this.RowIndex; i < this.OwnerTable.Rows.Count; i++) {
                var row = this.OwnerTable.Rows[i];
                for (var j = 0; j < row.Cells.Count; j++) {
                    row.Cells[j]._GetParagraphFormat(selection);
                }
                if (end.Paragraph.IsInsideTable && row._Contains(end.Paragraph.AssociatedCell))
                    return;
            }
            var block = this.OwnerTable._GetNextRenderedBlock();
            block._GetParagraphFormatInternal(selection, start, end);
        };
        TableRowAdv.prototype._ApplyParagraphFormatTableRow = function (selection, start, end, property, value, update) {
            value = this.Cells[0]._GetParagraphFormatValue(property, value);
            for (var i = this.RowIndex; i < this.OwnerTable.Rows.Count; i++) {
                var row = this.OwnerTable.Rows[i];
                for (var j = 0; j < row.Cells.Count; j++) {
                    row.Cells[j]._ApplyParagraphFormatTableCell(selection, property, value, update);
                }
                if (end.Paragraph.IsInsideTable && row._Contains(end.Paragraph.AssociatedCell))
                    return;
            }
            var block = this.OwnerTable._GetNextRenderedBlock();
            block._ApplyParagraphFormat(selection, start, end, property, value, update);
        };
        TableRowAdv.prototype._LayoutInternal = function (viewer) {
            this._Layout(viewer, false);
        };
        TableRowAdv.prototype._Layout = function (viewer, ShiftNextWidget) {
            if (this._IsVerticalMergedCellContinue() && this.PreviousNode instanceof TableRowAdv) {
                this.PreviousNode._LayoutInternal(viewer);
                return;
            }
            viewer._UpdateClientArea(this.OwnerTable.Section.SectionFormat);
            var prevWidget = null;
            if (this.RowIndex > 0)
                prevWidget = this.OwnerTable.Rows[this.RowIndex - 1].TableRowWidgets[this.OwnerTable.Rows[this.RowIndex - 1].TableRowWidgets.Count - 1];
            else {
                var prevBlock = this.OwnerTable.PreviousBlock;
                if (prevBlock instanceof ParagraphAdv)
                    prevWidget = prevBlock.ParagraphWidgets[prevBlock.ParagraphWidgets.Count - 1];
                else if (prevBlock instanceof TableAdv)
                    prevWidget = prevBlock.TableWidgets[prevBlock.TableWidgets.Count - 1];
            }
            if (prevWidget != null)
                viewer._CutFromTop(prevWidget.Y + prevWidget.Height);
            var tableWidget = this.TableRowWidgets[0].ContainerWidget;
            this._ClearWidgets();
            if (this.OwnerTable.TableWidgets.Count == 0) {
                viewer._UpdateClientAreaForBlock(this.OwnerTable, true);
                this.OwnerTable._AddTableWidget(viewer.ClientActiveArea);
                tableWidget = this.OwnerTable.TableWidgets[0];
            }
            viewer._UpdateClientAreaForTable(tableWidget);
            var block = this.Cells.Count > 0 ? this.Cells[0]._GetFirstBlock() : null;
            if (block != null && (viewer.OwnerControl.IsDocumentLoaded) && !viewer.OwnerControl.IsPastingContent)
                viewer.OwnerControl.Document._UpdateListItems(block);
            this._LayoutItems(viewer);
            if (tableWidget.Table != null) {
                if (tableWidget.Table.TableFormat.CellSpacing > 0) {
                    tableWidget._RenderTableOutlines(viewer);
                }
            }
            if (ShiftNextWidget && block != null)
                block._ShiftNextWidgets();
            else
                this._LayoutNextItems(viewer);
        };
        TableRowAdv.prototype._LayoutNextItems = function (viewer) {
            var tableRow = this;
            var prevRowWidget = this.TableRowWidgets[this.TableRowWidgets.Count - 1];
            while (tableRow.NextNode instanceof TableRowAdv) {
                tableRow = tableRow.NextNode;
                if (tableRow instanceof TableRowAdv && tableRow.TableRowWidgets.Count > 0) {
                    var isVerticalMergedCellContinue = tableRow._IsVerticalMergedCellContinue();
                    if (viewer.SplittedCellWidgets.Count == 0 && !isVerticalMergedCellContinue
                        && tableRow.TableRowWidgets[0].ContainerWidget == prevRowWidget.ContainerWidget
                        && MathHelper._Round(tableRow.TableRowWidgets[0].Y, 2) == MathHelper._Round(viewer.ClientActiveArea.Y, 2)) {
                        var tableWidget = this.OwnerTable.TableWidgets[this.OwnerTable.TableWidgets.Count - 1];
                        viewer._CutFromTop(tableRow.OwnerTable.TableWidgets[tableRow.OwnerTable.TableWidgets.Count - 1].Y + tableRow.OwnerTable.TableWidgets[tableRow.OwnerTable.TableWidgets.Count - 1].Height);
                        return;
                    }
                }
                tableRow._ClearWidgets();
                tableRow._LayoutItems(viewer);
                prevRowWidget = tableRow.TableRowWidgets[tableRow.TableRowWidgets.Count - 1];
            }
            if (this.OwnerTable.TableWidgets[this.OwnerTable.TableWidgets.Count - 1].ContainerWidget instanceof Widget) {
                var tableWidget = this.OwnerTable.TableWidgets[this.OwnerTable.TableWidgets.Count - 1];
                tableWidget.ContainerWidget.ChildWidgets._Remove(tableWidget);
                if (!(tableWidget.ContainerWidget instanceof TableCellWidget))
                    tableWidget.ContainerWidget.Height -= tableWidget.Height;
            }
            this.OwnerTable._UpdateWidgetsToPage(viewer);
            viewer._UpdateClientAreaForBlock(this.OwnerTable, false);
            this.OwnerTable._LayoutNextItems(viewer);
        };
        TableRowAdv.prototype._CombineTableRowWidgets = function (tableWidget) {
            if (this.TableRowWidgets.Count == 0)
                return;
            var rowWidget = this.TableRowWidgets[0];
            if (!tableWidget.ChildWidgets._Contains(rowWidget))
                rowWidget._UpdateTableWidget(tableWidget, tableWidget.ChildWidgets.Count);
            rowWidget.Height = 0;
            for (var i = 0; i < this.Cells.Count; i++) {
                var cell = this.Cells[i];
                cell._CombineTableCellWidgets(rowWidget);
                var cellWidget = cell.TableCellWidgets[0];
                if (cell.CellFormat.RowSpan == 1) {
                    var cellHeight = cellWidget.Height + cellWidget.Margin.Top + cellWidget.Margin.Bottom;
                    if (rowWidget.Height < cellHeight)
                        rowWidget.Height = cellHeight;
                }
            }
            for (var i = 1; i < this.TableRowWidgets.Count; i++) {
                var curWidget = this.TableRowWidgets[i];
                curWidget._Dispose();
                i--;
            }
        };
        TableRowAdv.prototype._GetBlankRow = function () {
            var row = new TableRowAdv(null);
            row.GridBefore = this.GridBefore;
            row.GridAfter = this.GridAfter;
            row.GridBeforeWidth = this.GridBeforeWidth;
            row.GridAfterWidth = this.GridAfterWidth;
            for (var i = 0; i < this.Cells.length; i++) {
                var cell = this.Cells[i];
                var newCell = cell._GetBlankCell();
                row.Cells._Add(newCell);
            }
            return row;
        };
        TableRowAdv.prototype._GetGridCount = function (tableGrid, index) {
            var prevOffset = 0, width = 0;
            if (index == -1)
                width = this.GridBeforeWidth * 15;
            else {
                prevOffset += this.GridBeforeWidth * 15;
                if (index > 0)
                    prevOffset += this._GetCellOffset(index);
                if (index < this.Cells.Count)
                    width = this.Cells[index].CellFormat.CellWidth * 15;
                else
                    width = this.GridAfterWidth * 15;
            }
            var gridStartIndex = this._GetOffsetIndex(tableGrid, prevOffset);
            var gridEndIndex = this._GetOffsetIndex(tableGrid, prevOffset + width);
            return gridEndIndex - gridStartIndex;
        };
        TableRowAdv.prototype._GetOffsetIndex = function (tableGrid, offset) {
            offset = Math.round(offset);
            var index = 0;
            if (tableGrid._Contains(offset))
                index = tableGrid._IndexOf(offset);
            else {
                for (var i = 0; i < tableGrid.Count; i++) {
                    if (tableGrid[i] > offset)
                        return i;
                }
                index = tableGrid.Count - 1;
            }
            return index;
        };
        TableRowAdv.prototype._GetCellOffset = function (index) {
            var prevOffset = 0;
            for (var i = 0; i < this.Cells.Count; i++) {
                if (i == index)
                    break;
                prevOffset += this.Cells[i].CellFormat.CellWidth * 15;
            }
            return prevOffset;
        };
        TableRowAdv.prototype._UpdateHeight = function (dragValue) {
            if (this.RowFormat.HeightType == HeightType.Auto) {
                this.RowFormat.HeightType = HeightType.Atleast;
                var currentHeight = this._GetRowHeight();
                if (currentHeight + dragValue >= 3.6 && this.RowFormat.Height != currentHeight + dragValue)
                    this.RowFormat.Height = currentHeight + dragValue;
            }
            else {
                if (this.RowFormat.Height + dragValue >= 3.6 && this.RowFormat.Height != this.RowFormat.Height + dragValue)
                    this.RowFormat.Height = this.RowFormat.Height + dragValue;
            }
        };
        TableRowAdv.prototype._UpdateGridBefore = function (offset) {
            if (this.GridBeforeWidth + offset != this.GridBeforeWidth) {
                this.GridBeforeWidth = this.GridBeforeWidth + offset;
                this._LayoutInternal(this.OwnerTable._GetOwnerDocument().OwnerControl.Viewer);
            }
        };
        TableRowAdv.prototype._GetRowWidth = function (toUpdateGridAfter) {
            var rowWidth = 0;
            if (toUpdateGridAfter)
                rowWidth = rowWidth + this.GridBeforeWidth;
            for (var i = 0; i < this.Cells.length; i++) {
                var cell = this.Cells[i];
                rowWidth += cell.CellFormat.CellWidth;
            }
            return rowWidth;
        };
        TableRowAdv.prototype._ApplyRowFormat = function (selection, start, end, property, value) {
            this.RowFormat._ApplyPropertyValue(selection.CurrentBaseHistoryInfo, property, value);
            if (end.Paragraph.AssociatedCell.OwnerRow == this)
                return;
            var row = this.NextNode;
            if (row != null)
                row._ApplyRowFormat(selection, start, end, property, value);
        };
        TableRowAdv.prototype._Dispose = function () {
            this._SetOwner(null);
            if (this.TableRowWidgets != null) {
                this._ClearWidgets();
                this.TableRowWidgets = null;
            }
            if (this.Cells != null) {
                this.Cells._Dispose();
                for (var i = 0; i < this.Cells.Count; i++) {
                    var cell = this.Cells[i];
                    cell._Dispose();
                    this.Cells._Remove(cell);
                    i--;
                }
                this.ChildNodes = null;
            }
            this.Fields = null;
            this.FieldCharacter = null;
        };
        TableRowAdv.prototype._SerializeRows = function () {
            var row = {
                "Cells": [], "GridAfter": [], "GridAfterWidth": [],
                "GridBefore": [], "GridBeforeWidth": [], "RowFormat": []
            };
            row.GridAfter = this.GridAfter;
            row.GridAfterWidth = this.GridAfterWidth;
            row.GridBefore = this.GridBefore;
            row.GridBeforeWidth = this.GridBeforeWidth;
            for (var i = 0; i < this.Cells.length; i++) {
                var cell = this.Cells[i];
                row.Cells[i] = cell._SerializeCells();
            }
            row.RowFormat = this.RowFormat._SerializeRowFormat();
            return row;
        };
        return TableRowAdv;
    }(CompositeNode));
    DocumentEditorFeatures.TableRowAdv = TableRowAdv;
    var TableColumnAdv = (function () {
        function TableColumnAdv() {
            this.preferredwidth = 0;
            this.minwidth = 0;
            this.maxwidth = 0;
        }
        Object.defineProperty(TableColumnAdv.prototype, "PreferredWidth", {
            get: function () { return this.preferredwidth; },
            set: function (value) { this.preferredwidth = value; },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(TableColumnAdv.prototype, "MinWidth", {
            get: function () { return this.minwidth; },
            set: function (value) { this.minwidth = value; },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(TableColumnAdv.prototype, "MaxWidth", {
            get: function () { return this.maxwidth; },
            set: function (value) { this.maxwidth = value; },
            enumerable: true,
            configurable: true
        });
        return TableColumnAdv;
    }());
    DocumentEditorFeatures.TableColumnAdv = TableColumnAdv;
    var TableCellAdv = (function (_super) {
        __extends(TableCellAdv, _super);
        function TableCellAdv(node) {
            _super.call(this, node);
            this.colIndex = 0;
            this.ChildNodes = new BlockAdvCollection(this);
            this.CellFormat = new CellFormat(this);
            this.TableCellWidgets = new List();
        }
        Object.defineProperty(TableCellAdv.prototype, "Blocks", {
            get: function () {
                return this.ChildNodes;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(TableCellAdv.prototype, "LeftMargin", {
            get: function () {
                if (this.CellFormat._ContainsMargins())
                    return this.CellFormat.LeftMargin;
                else if (this.OwnerTable != null && this.OwnerTable.TableFormat != null)
                    return this.OwnerTable.TableFormat.LeftMargin;
                else
                    return 0;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(TableCellAdv.prototype, "TopMargin", {
            get: function () {
                if (this.CellFormat._ContainsMargins())
                    return this.CellFormat.TopMargin;
                else if (this.OwnerTable != null && this.OwnerTable.TableFormat != null)
                    return this.OwnerTable.TableFormat.TopMargin;
                else
                    return 0;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(TableCellAdv.prototype, "RightMargin", {
            get: function () {
                if (this.CellFormat._ContainsMargins())
                    return this.CellFormat.RightMargin;
                else if (this.OwnerTable != null && this.OwnerTable.TableFormat != null)
                    return this.OwnerTable.TableFormat.RightMargin;
                else
                    return 0;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(TableCellAdv.prototype, "BottomMargin", {
            get: function () {
                if (this.CellFormat._ContainsMargins())
                    return this.CellFormat.BottomMargin;
                else if (this.OwnerTable != null && this.OwnerTable.TableFormat != null)
                    return this.OwnerTable.TableFormat.BottomMargin;
                else
                    return 0;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(TableCellAdv.prototype, "OwnerRow", {
            get: function () {
                return this.Owner;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(TableCellAdv.prototype, "OwnerTable", {
            get: function () {
                if (this.OwnerRow != null)
                    return this.OwnerRow.OwnerTable;
                else
                    return null;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(TableCellAdv.prototype, "ColumnIndex", {
            get: function () { return this.colIndex; },
            set: function (value) { this.colIndex = value; },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(TableCellAdv.prototype, "OwnerColumn", {
            get: function () {
                return this.OwnerTable.TableHolder.Columns[this.ColumnIndex];
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(TableCellAdv.prototype, "Section", {
            get: function () {
                if (this.OwnerTable != null)
                    return this.OwnerTable.Section;
                return null;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(TableCellAdv.prototype, "CellIndex", {
            get: function () {
                if (this.OwnerRow != null)
                    return this.OwnerRow.Cells._IndexOf(this);
                return -1;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(TableCellAdv.prototype, "IsInHeaderFooter", {
            get: function () {
                if (this.OwnerTable != null)
                    return this.OwnerTable.IsInHeaderFooter;
                return false;
            },
            enumerable: true,
            configurable: true
        });
        TableCellAdv.prototype._Clone = function () {
            var cell = new TableCellAdv(null);
            cell.CellFormat._CopyFormat(this.CellFormat);
            for (var i = 0; i < this.Blocks.Count; i++) {
                cell.Blocks._Add(this.Blocks[i]._Clone());
            }
            return cell;
        };
        TableCellAdv.prototype._GetCharacterFormatValue = function (property, value) {
            if (typeof (value) === "boolean") {
                var firstParagraph = this._GetFirstParagraph();
                var format = firstParagraph.CharacterFormat;
                if (firstParagraph.Inlines.Count > 0)
                    format = firstParagraph.Inlines[0].CharacterFormat;
                value = !format._GetCharacterPropertyValue(property, format);
            }
            if (value == null
                && (property == CharacterFormat.BoldProperty || property == CharacterFormat.ItalicProperty)) {
                var firstParagraph = this._GetFirstParagraph();
                var format = firstParagraph.CharacterFormat;
                if (firstParagraph.Inlines.Count > 0)
                    format = firstParagraph.Inlines[0].CharacterFormat;
                value = !format._GetCharacterPropertyValue(property, format);
            }
            return value;
        };
        TableCellAdv.prototype._ApplyCharacterFormatForSel = function (selection, property, value, update) {
            for (var i = 0; i < this.Blocks.Count; i++) {
                this.Blocks[i]._ApplyCharacterFormatForSel(selection, property, value, update);
            }
        };
        TableCellAdv.prototype._ApplyCharacterFormat = function (selection, start, end, property, value, update) {
            if (end.Paragraph.IsInsideTable) {
                var containerCell = this._GetContainerCellOf(end.Paragraph.AssociatedCell);
                if (containerCell.OwnerTable._Contains(end.Paragraph.AssociatedCell)) {
                    var startCell = this._GetSelectedCell(containerCell);
                    var endCell = end.Paragraph.AssociatedCell._GetSelectedCell(containerCell);
                    if (containerCell._Contains(end.Paragraph.AssociatedCell)) {
                        if (containerCell._IsCellSelected(start, end)) {
                            value = containerCell._GetCharacterFormatValue(property, value);
                            containerCell._ApplyCharacterFormatForSel(selection, property, value, update);
                        }
                        else {
                            if (startCell == containerCell)
                                start.Paragraph._ApplyCharacterFormat(selection, start, end, property, value, update);
                            else
                                startCell.OwnerRow._ApplyCharacterFormat(selection, start, end, property, value, update);
                        }
                    }
                    else
                        containerCell.OwnerTable._ApplyCharacterFormatForCell(selection, containerCell, endCell, property, value, update);
                }
                else
                    containerCell.OwnerRow._ApplyCharacterFormat(selection, start, end, property, value, update);
            }
            else {
                var cell = this._GetContainerCell();
                cell.OwnerRow._ApplyCharacterFormat(selection, start, end, property, value, update);
            }
        };
        TableCellAdv.prototype._ApplyParagraphFormat = function (selection, start, end, property, value, update) {
            if (end.Paragraph.IsInsideTable) {
                var containerCell = this._GetContainerCell();
                if (containerCell.OwnerTable._Contains(end.Paragraph.AssociatedCell)) {
                    var startCell = this._GetSelectedCell(containerCell);
                    var endCell = end.Paragraph.AssociatedCell._GetSelectedCell(containerCell);
                    if (containerCell._Contains(end.Paragraph.AssociatedCell)) {
                        if (containerCell._IsCellSelected(start, end)) {
                            value = containerCell._GetParagraphFormatValue(property, value);
                            containerCell._ApplyParagraphFormatTableCell(selection, property, value, update);
                        }
                        else {
                            if (startCell == containerCell)
                                start.Paragraph._ApplyParagraphFormat(selection, start, end, property, value, update);
                            else
                                startCell.OwnerRow._ApplyParagraphFormatTableRow(selection, start, end, property, value, update);
                        }
                    }
                    else
                        containerCell.OwnerTable._ApplyParagraphFormatTable(selection, containerCell, endCell, property, value, update);
                }
                else
                    containerCell.OwnerRow._ApplyParagraphFormatTableRow(selection, start, end, property, value, update);
            }
            else {
                var cell = this._GetContainerCell();
                cell.OwnerRow._ApplyParagraphFormatTableRow(selection, start, end, property, value, update);
            }
        };
        TableCellAdv.prototype._ApplyParagraphFormatTableCell = function (selection, property, value, update) {
            for (var i = 0; i < this.Blocks.Count; i++) {
                this.Blocks[i]._ApplyParagraphFormatInternal(selection, property, value, update);
            }
        };
        TableCellAdv.prototype._GetParagraphFormatValue = function (property, value) {
            if (value instanceof Boolean) {
                var firstParagraph = this._GetFirstParagraph();
            }
            return value;
        };
        TableCellAdv.prototype._LayoutItems = function (viewer, maxCellMarginTop, maxCellMarginBottom) {
            if (this.TableCellWidgets != null
                && this.TableCellWidgets.length > 0) {
                this.TableCellWidgets._Clear();
            }
            this._AddTableCellWidget(viewer.ClientActiveArea, maxCellMarginTop, maxCellMarginBottom);
            viewer._UpdateClientAreaForCell(this, true);
            if (this.Blocks.length == 0) {
                var paragraph = null;
                paragraph = new ParagraphAdv(this);
                this.Blocks._Add(paragraph);
            }
            for (var i = 0; i < this.Blocks.length; i++) {
                var block = this.Blocks[i];
                viewer._UpdateClientAreaForBlock(block, true);
                block._LayoutItems(viewer);
                viewer._UpdateClientAreaForBlock(block, false);
            }
            this._UpdateWidgetToRow(viewer);
            viewer._UpdateClientAreaForCell(this, false);
        };
        TableCellAdv.prototype._AddTableCellWidget = function (area, maxCellMarginTop, maxCellMarginBottom) {
            var tableCellWidget = new TableCellWidget(this);
            var prevColumnIndex = 0;
            var cellspace = 0;
            var left = 0;
            var top = maxCellMarginTop;
            var right = 0;
            var bottom = maxCellMarginBottom;
            if (this.CellFormat != null)
                if (this.CellFormat._ContainsMargins()) {
                    left = this.CellFormat.LeftMargin;
                    right = this.CellFormat.RightMargin;
                }
                else {
                    left = this.OwnerTable.TableFormat.LeftMargin;
                    right = this.OwnerTable.TableFormat.RightMargin;
                }
            tableCellWidget.Margin = new Margin(left, top, right, bottom);
            tableCellWidget.Width = this.CellFormat != null ? this.CellFormat.CellWidth : 0;
            if (this.PreviousNode != null)
                prevColumnIndex = this.PreviousNode.ColumnIndex + (this.PreviousNode.CellFormat != null ? this.PreviousNode.CellFormat.ColumnSpan : 1);
            cellspace = this.OwnerTable != null && this.OwnerTable.TableFormat != null ? this.OwnerTable.TableFormat.CellSpacing : 0;
            this.TableCellWidgets._Add(tableCellWidget);
            var prevSpannedCellWidth = 0;
            if (prevColumnIndex < this.ColumnIndex) {
                prevSpannedCellWidth = this.OwnerTable.TableHolder._GetPreviousSpannedCellWidth(prevColumnIndex, this.ColumnIndex);
                if (prevColumnIndex == 0)
                    prevSpannedCellWidth = prevSpannedCellWidth - cellspace / 2;
            }
            tableCellWidget.X = area.X + prevSpannedCellWidth + tableCellWidget.Margin.Left;
            tableCellWidget.Y = area.Y + tableCellWidget.Margin.Top + cellspace;
            tableCellWidget.Width = tableCellWidget.Width - tableCellWidget.Margin.Left - tableCellWidget.Margin.Right;
            if (cellspace > 0) {
                tableCellWidget.X += cellspace;
                if (this.OwnerTable.TableHolder.Columns.Count == 1)
                    tableCellWidget.Width -= cellspace * 2;
                else if (this.ColumnIndex == 0 || this.ColumnIndex == this.OwnerTable.TableHolder.Columns.Count - 1)
                    tableCellWidget.Width -= ((cellspace * 2) - cellspace / 2);
                else
                    tableCellWidget.Width -= cellspace;
                tableCellWidget.RightBorderWidth = this.CellFormat.Borders._GetCellRightBorder(this)._GetLineWidth();
                tableCellWidget.Width -= tableCellWidget.RightBorderWidth;
            }
            tableCellWidget.LeftBorderWidth = this.CellFormat.Borders._GetCellLeftBorder(this)._GetLineWidth();
            tableCellWidget.X += tableCellWidget.LeftBorderWidth;
            tableCellWidget.Width -= tableCellWidget.LeftBorderWidth;
            if (cellspace > 0 || this.CellIndex == this.OwnerRow.Cells.Count - 1) {
                tableCellWidget.RightBorderWidth = this.CellFormat.Borders._GetCellRightBorder(this)._GetLineWidth();
                tableCellWidget.Width -= tableCellWidget.RightBorderWidth;
            }
            tableCellWidget.Margin.Left = tableCellWidget.Margin.Left + tableCellWidget.LeftBorderWidth;
            tableCellWidget.Margin.Right = tableCellWidget.Margin.Right + tableCellWidget.RightBorderWidth;
        };
        TableCellAdv.prototype._UpdateWidgetToRow = function (viewer) {
            var tableCellWidget = this.TableCellWidgets[this.TableCellWidgets.length - 1];
            var rowWidget = this.OwnerRow.TableRowWidgets[this.OwnerRow.TableRowWidgets.length - 1];
            var cellLeft = rowWidget.X;
            if (rowWidget.ChildWidgets.length > 0) {
                var lastWidget = rowWidget.ChildWidgets[rowWidget.ChildWidgets.length - 1];
                cellLeft = lastWidget.X + lastWidget.Width + lastWidget.Margin.Right;
            }
            rowWidget.ChildWidgets._Add(tableCellWidget);
            tableCellWidget.ContainerWidget = rowWidget;
            if (this.OwnerRow != null && this.OwnerRow.RowFormat.HeightType != HeightType.Exactly && this.OwnerRow.RowFormat.Height > 0 && this.CellIndex == 0)
                rowWidget.Height = rowWidget.Height + this.OwnerRow.RowFormat.Height;
            if (this.CellFormat.RowSpan == 1) {
                var cellHeight = tableCellWidget.Height + tableCellWidget.Margin.Top + tableCellWidget.Margin.Bottom;
                if (rowWidget.Height - this.OwnerTable.TableFormat.CellSpacing < cellHeight)
                    rowWidget.Height = cellHeight + this.OwnerTable.TableFormat.CellSpacing;
            }
        };
        TableCellAdv.prototype._GetNextParagraph = function () {
            if (this.NextNode != null) {
                var block = this.NextNode.Blocks[0];
                if (block instanceof ParagraphAdv)
                    return block;
                else
                    return block._GetFirstParagraphInFirstCell();
            }
            return this.OwnerRow._GetNextParagraph();
        };
        TableCellAdv.prototype._GetPreviousParagraph = function () {
            if (this.PreviousNode != null) {
                var block = this.PreviousNode.Blocks[this.PreviousNode.Blocks.Count - 1];
                if (block instanceof ParagraphAdv)
                    return block;
                else
                    return block._GetLastParagraphInLastCell();
            }
            return this.OwnerRow._GetPreviousParagraph();
        };
        TableCellAdv.prototype._GetFirstParagraph = function () {
            var firstBlock = this.Blocks[0];
            if (firstBlock instanceof ParagraphAdv)
                return firstBlock;
            else
                return firstBlock._GetFirstParagraphInFirstCell();
        };
        TableCellAdv.prototype._GetFirstBlock = function () {
            if (this.Blocks.Count > 0)
                return this.Blocks[0];
            return null;
        };
        TableCellAdv.prototype._GetLastParagraph = function () {
            var lastBlock = this.Blocks[this.Blocks.Count - 1];
            if (lastBlock instanceof ParagraphAdv)
                return lastBlock;
            else
                return lastBlock._GetLastParagraphInLastCell();
        };
        TableCellAdv.prototype._Contains = function (cell) {
            if (this == cell)
                return true;
            while (cell.OwnerTable.IsInsideTable) {
                if (this == cell.OwnerTable.AssociatedCell)
                    return true;
                cell = cell.OwnerTable.AssociatedCell;
            }
            return false;
        };
        TableCellAdv.prototype._GetContainerCell = function () {
            var cell = this;
            while (cell.OwnerTable != null && cell.OwnerTable.IsInsideTable) {
                cell = cell.OwnerTable.AssociatedCell;
            }
            return cell;
        };
        TableCellAdv.prototype._GetContainerCellOf = function (tableCell) {
            var cell = this;
            while (cell.OwnerTable.IsInsideTable) {
                if (cell.OwnerTable._Contains(tableCell))
                    return cell;
                cell = cell.OwnerTable.AssociatedCell;
            }
            return cell;
        };
        TableCellAdv.prototype._GetSelectedCell = function (containerCell) {
            var cell = this;
            if (cell.OwnerTable == containerCell.OwnerTable)
                return cell;
            while (cell.OwnerTable.IsInsideTable) {
                if (cell.OwnerTable.AssociatedCell == containerCell)
                    return cell;
                cell = cell.OwnerTable.AssociatedCell;
            }
            return cell;
        };
        TableCellAdv.prototype._IsCellSelected = function (startPosition, endPosition) {
            var lastParagraph = this._GetLastParagraph();
            var isAtCellEnd = lastParagraph == endPosition.Paragraph && endPosition.Offset == lastParagraph._GetLength() + 1;
            return isAtCellEnd || (!this._Contains(startPosition.Paragraph.AssociatedCell) || !this._Contains(endPosition.Paragraph.AssociatedCell));
        };
        TableCellAdv.prototype._Highlight = function (selection, selectionRange, start, end) {
            if (end.Paragraph.IsInsideTable) {
                var containerCell = this._GetContainerCellOf(end.Paragraph.AssociatedCell);
                if (containerCell.OwnerTable._Contains(end.Paragraph.AssociatedCell)) {
                    var startCell = this._GetSelectedCell(containerCell);
                    var endCell = end.Paragraph.AssociatedCell._GetSelectedCell(containerCell);
                    if (containerCell._Contains(end.Paragraph.AssociatedCell)) {
                        if (containerCell._IsCellSelected(start, end))
                            containerCell._HighlightInternal(selection, selectionRange);
                        else {
                            if (startCell == containerCell)
                                start.Paragraph._Highlight(selection, selectionRange, start, end);
                            else
                                startCell._HighlightContainer(selection, selectionRange, start, end);
                        }
                    }
                    else {
                        containerCell._HighlightInternal(selection, selectionRange);
                        if (containerCell.OwnerRow == endCell.OwnerRow) {
                            startCell = containerCell;
                            while (startCell.NextNode != null) {
                                startCell = startCell.NextNode;
                                startCell._HighlightInternal(selection, selectionRange);
                                if (startCell == endCell)
                                    break;
                            }
                        }
                        else
                            containerCell.OwnerTable._HighlightCells(selection, selectionRange, containerCell, endCell);
                    }
                }
                else
                    containerCell._HighlightContainer(selection, selectionRange, start, end);
            }
            else {
                var cell = this._GetContainerCell();
                cell._HighlightContainer(selection, selectionRange, start, end);
            }
        };
        TableCellAdv.prototype._HighlightInternal = function (selection, selectionRange) {
            for (var i = 0; i < this.TableCellWidgets.Count; i++) {
                this.TableCellWidgets[i]._Highlight(selection, selectionRange);
            }
        };
        TableCellAdv.prototype._HighlightContainer = function (selection, selectionRange, start, end) {
            this.OwnerRow._HighlightInternal(selection, selectionRange, start, end);
            var block = this.OwnerTable._GetNextRenderedBlock();
            block._Highlight(selection, selectionRange, start, end);
        };
        TableCellAdv.prototype._GetCellLeft = function (cell) {
            var left = 0;
            if (cell.TableCellWidgets.Count > 0)
                left += cell.TableCellWidgets[0].X - cell.TableCellWidgets[0].Margin.Left;
            return left;
        };
        TableCellAdv.prototype._GetSelectedContentAsHtmlInternal = function (selection, start, end) {
            var html = "";
            if (end.Paragraph.IsInsideTable) {
                var containerCell = this._GetContainerCellOf(end.Paragraph.AssociatedCell);
                if (containerCell.OwnerTable._Contains(end.Paragraph.AssociatedCell)) {
                    html += "<table ";
                    html += containerCell.OwnerTable.TableFormat._GetAsHtmlStyle();
                    html += ">";
                    var startCell = this._GetSelectedCell(containerCell);
                    var endCell = end.Paragraph.AssociatedCell._GetSelectedCell(containerCell);
                    if (containerCell._Contains(end.Paragraph.AssociatedCell)) {
                        if (containerCell._IsCellSelected(start, end)) {
                            html += "<tr ";
                            html += containerCell.OwnerRow.RowFormat._GetAsHtmlStyle();
                            html += ">";
                            html += containerCell._GetContentAsHtml();
                            html += "</tr>";
                        }
                        else {
                            if (startCell == containerCell) {
                                html = start.Paragraph._GetSelectedContentAsHtml(selection, start, end);
                            }
                            else {
                                html = startCell._GetSelectedContentAsHtml(selection, start, end);
                            }
                        }
                    }
                    else {
                        if (containerCell.OwnerRow == endCell.OwnerRow) {
                            html += "<tr ";
                            html += containerCell.OwnerRow.RowFormat._GetAsHtmlStyle();
                            html += ">";
                            html += containerCell._GetContentAsHtml();
                            startCell = containerCell;
                            while (startCell.NextNode != null) {
                                startCell = startCell.NextNode;
                                html += startCell._GetContentAsHtml();
                                if (startCell == endCell)
                                    break;
                            }
                            html += "</tr>";
                        }
                        else
                            html += containerCell.OwnerTable._GetSelectedContentAsHtmlInternal(selection, containerCell, endCell);
                    }
                    html += "</table>";
                }
                else {
                    html += containerCell._GetSelectedContentAsHtml(selection, start, end);
                }
            }
            else {
                var cell = this._GetContainerCell();
                html += cell._GetSelectedContentAsHtml(selection, start, end);
            }
            return html;
        };
        TableCellAdv.prototype._GetSelectedContentAsHtml = function (selection, start, end) {
            var html = "";
            html += "<table ";
            html += this.OwnerTable.TableFormat._GetAsHtmlStyle();
            html += ">";
            html += this.OwnerRow._GetSelectedContentAsHtml(selection, start, end);
            html += "</table>";
            var block = this.OwnerTable._GetNextRenderedBlock();
            html += block._GetSelectedContentAsHtml(selection, start, end);
            return html;
        };
        TableCellAdv.prototype._GetContentAsHtml = function () {
            var html = "<td ";
            html += this.CellFormat._GetAsHtmlStyle();
            html += ">";
            for (var i = 0; i < this.Blocks.Count; i++) {
                html += this.Blocks[i]._GetContentAsHtml();
            }
            html += "</td>";
            return html;
        };
        TableCellAdv.prototype._GetNextSelection = function (selection) {
            if (this.NextNode != null) {
                if (selection.IsEmpty || selection.IsForward) {
                    var block = this.NextNode.Blocks[this.NextNode.Blocks.Count - 1];
                    if (block instanceof ParagraphAdv)
                        return block;
                    else
                        return block._GetLastParagraphInLastCell();
                }
                else {
                    var block = this.NextNode.Blocks[0];
                    if (block instanceof ParagraphAdv)
                        return block;
                    else
                        return block.Rows[0]._GetNextParagraphSelection(selection);
                }
            }
            return this.OwnerRow._GetNextSelection(selection);
        };
        TableCellAdv.prototype._GetPreviousSelection = function (selection) {
            if (this.PreviousNode != null) {
                if (!selection.IsForward) {
                    var block = this.PreviousNode.Blocks[0];
                    if (block instanceof ParagraphAdv)
                        return block;
                    else
                        return block._GetFirstParagraphInLastRow();
                }
                else {
                    var block = this.PreviousNode.Blocks[this.PreviousNode.Blocks.Count - 1];
                    if (block instanceof ParagraphAdv)
                        return block;
                    else
                        return block.Rows[block.Rows.Count - 1]._GetPreviousParagraphSelection(selection);
                }
            }
            return this.OwnerRow._GetPreviousSelection(selection);
        };
        TableCellAdv.prototype._UpdateListItems = function (block) {
            for (var i = 0; i < this.Blocks.Count; i++) {
                this.Blocks[i]._UpdateListItems(block);
            }
        };
        TableCellAdv.prototype._UpdateRenderedListItems = function () {
            for (var i = 0; i < this.Blocks.Count; i++) {
                this.Blocks[i]._UpdateRenderedListItems();
            }
        };
        TableCellAdv.prototype._GetCharacterFormat = function (selection, start, end) {
            if (end.Paragraph.IsInsideTable) {
                var containerCell = this._GetContainerCellOf(end.Paragraph.AssociatedCell);
                if (containerCell.OwnerTable._Contains(end.Paragraph.AssociatedCell)) {
                    var startCell = this._GetSelectedCell(containerCell);
                    var endCell = end.Paragraph.AssociatedCell._GetSelectedCell(containerCell);
                    if (containerCell._Contains(end.Paragraph.AssociatedCell)) {
                        if (containerCell._IsCellSelected(start, end)) {
                            containerCell._GetCharacterFormatForSelection(selection, start, end);
                        }
                        else {
                            if (startCell == containerCell)
                                start.Paragraph._GetCharacterFormat(selection, start, end);
                            else
                                startCell.OwnerRow._GetCharacterFormat(selection, start, end);
                        }
                    }
                    else
                        containerCell.OwnerTable._GetCharacterFormatInternal(selection, containerCell, endCell, start, end);
                }
                else
                    containerCell.OwnerRow._GetCharacterFormat(selection, start, end);
            }
            else {
                var cell = this._GetContainerCell();
                cell.OwnerRow._GetCharacterFormat(selection, start, end);
            }
        };
        TableCellAdv.prototype._GetCharacterFormatForSelection = function (selection, start, end) {
            for (var i = 0; i < this.Blocks.Count; i++) {
                this.Blocks[i]._GetCharacterFormat(selection, start, end);
            }
        };
        TableCellAdv.prototype._GetParagraphFormat = function (selection) {
            for (var i = 0; i < this.Blocks.Count; i++) {
                this.Blocks[i]._GetParagraphFormat(selection);
            }
        };
        TableCellAdv.prototype._GetParagraphFormatInternal = function (selection, start, end) {
            if (end.Paragraph.IsInsideTable) {
                var containerCell = this._GetContainerCellOf(end.Paragraph.AssociatedCell);
                if (containerCell.OwnerTable._Contains(end.Paragraph.AssociatedCell)) {
                    var startCell = this._GetSelectedCell(containerCell);
                    var endCell = end.Paragraph.AssociatedCell._GetSelectedCell(containerCell);
                    if (containerCell._Contains(end.Paragraph.AssociatedCell)) {
                        if (containerCell._IsCellSelected(start, end)) {
                            containerCell._GetParagraphFormat(selection);
                        }
                        else {
                            if (startCell == containerCell)
                                start.Paragraph._GetParagraphFormatInternal(selection, start, end);
                            else
                                startCell.OwnerRow._GetParagraphFormat(selection, start, end);
                        }
                    }
                    else
                        containerCell.OwnerTable._GetParagraphFormatForTableCell(selection, containerCell, endCell);
                }
                else
                    containerCell.OwnerRow._GetParagraphFormat(selection, start, end);
            }
            else {
                var cell = this._GetContainerCell();
                cell.OwnerRow._GetParagraphFormat(selection, start, end);
            }
        };
        TableCellAdv.prototype._ClearWidgets = function () {
            if (this.TableCellWidgets != null
                && this.TableCellWidgets.Count > 0) {
                for (var i = 0; i < this.TableCellWidgets.Count; i++) {
                    var widget = this.TableCellWidgets[i];
                    widget._Dispose();
                    this.TableCellWidgets._Remove(widget);
                    i--;
                }
            }
        };
        TableCellAdv.prototype._UpdateCellVerticalPosition = function (viewer) {
            var cellWidget = this.TableCellWidgets[0];
            var widget = cellWidget.ContainerWidget;
            while (widget.ContainerWidget instanceof Widget)
                widget = widget.ContainerWidget;
            var page = null;
            if (widget instanceof BodyWidget)
                page = widget.Page;
            cellWidget._UpdateCellVerticalPosition(false, false);
            if (viewer instanceof PageLayoutViewer && viewer.VisiblePages._Contains(page)) {
                if (viewer.CommentWidgets.Count > 0)
                    viewer._MoveCommentsToPage(page);
            }
            else if (viewer instanceof FlowLayoutViewer && viewer.CurrentPage == page)
                cellWidget._Render(viewer);
        };
        TableCellAdv.prototype._Delete = function (selection, start, end, editAction) {
            if (end.Paragraph.IsInsideTable) {
                var containerCell = this._GetContainerCellOf(end.Paragraph.AssociatedCell);
                if (containerCell.OwnerTable._Contains(end.Paragraph.AssociatedCell)) {
                    var startCell = this._GetSelectedCell(containerCell);
                    var endCell = end.Paragraph.AssociatedCell._GetSelectedCell(containerCell);
                    if (containerCell._Contains(end.Paragraph.AssociatedCell)) {
                        if (containerCell._IsCellSelected(start, end)) {
                            containerCell._UpdateEditPosition(selection);
                            if (editAction == 1) {
                                this.OwnerRow.OwnerTable._DeleteCells(selection, containerCell, containerCell, editAction);
                            }
                            else {
                                var isCellCleared = containerCell._DeleteCell(selection, editAction, true);
                                if (!isCellCleared && editAction != 2)
                                    selection.CurrentBaseHistoryInfo = null;
                            }
                        }
                        else {
                            if (startCell == containerCell)
                                start.Paragraph._Delete(selection, start, end, editAction);
                            else
                                startCell._DeleteContainer(selection, start, end, editAction);
                        }
                    }
                    else {
                        if (editAction == 2)
                            this._DeleteCell(selection, 2, false);
                        else
                            containerCell.OwnerTable._DeleteCells(selection, containerCell, endCell, editAction);
                    }
                }
                else
                    containerCell._DeleteContainer(selection, start, end, editAction);
            }
            else {
                var cell = this._GetContainerCell();
                cell._DeleteContainer(selection, start, end, editAction);
            }
        };
        TableCellAdv.prototype._DeleteCell = function (selection, editAction, copyChildsToClipboard) {
            var block = this.Blocks[0];
            for (var i = 0; i < this.Blocks.Count; i++) {
                block = this.Blocks[i];
                if (editAction < 4) {
                    if (block instanceof ParagraphAdv && this.Blocks.Count == 1) {
                        var paragraph = block;
                        for (var j = 0; j < paragraph.Inlines.Count; j++) {
                            var inline = paragraph.Inlines[j];
                            paragraph.Inlines._Remove(inline);
                            j--;
                            if (selection.CurrentBaseHistoryInfo.Action != Actions.ClearCells)
                                selection.CurrentBaseHistoryInfo.RemovedNodes._Add(inline);
                        }
                        if (selection.CurrentBaseHistoryInfo.Action != Actions.ClearCells) {
                            selection.EditPosition = paragraph._GetHierarchicalIndex("0");
                            selection.CurrentBaseHistoryInfo.InsertPosition = selection.EditPosition;
                        }
                        break;
                    }
                    block._RemoveBlock();
                    i--;
                    if (selection.CurrentBaseHistoryInfo.Action != Actions.ClearCells)
                        selection.CurrentBaseHistoryInfo.RemovedNodes._Add(block);
                }
            }
            return true;
        };
        TableCellAdv.prototype._DeleteContainer = function (selection, start, end, editAction) {
            this.OwnerRow.Cells[0]._UpdateEditPosition(selection);
            var deleteNextBlock = !(end.Paragraph.IsInsideTable && this.OwnerTable._Contains(end.Paragraph.AssociatedCell));
            var block = this.OwnerTable._GetNextRenderedBlock();
            var section = this.Section;
            if (this.OwnerRow.RowIndex == 0 && (!end.Paragraph.IsInsideTable
                || !this.OwnerTable._Contains(end.Paragraph.AssociatedCell)
                || this.OwnerTable.Rows[this.OwnerTable.Rows.Count - 1]._Contains(end.Paragraph.AssociatedCell))) {
                this.OwnerTable._DeleteContent(selection, editAction);
            }
            else {
                var table = null;
                var ownerTable = this.OwnerTable;
                if (deleteNextBlock || end.Paragraph.IsInsideTable && ownerTable.Rows[ownerTable.Rows.Count - 1]._Contains(end.Paragraph.AssociatedCell)) {
                    ownerTable._DeleteContent(selection, editAction);
                }
                else {
                    for (var i = this.OwnerRow.RowIndex; i < ownerTable.Rows.Count; i++) {
                        var row = ownerTable.Rows[i];
                        if (editAction < 4) {
                            ownerTable.Rows._Remove(row);
                            i--;
                        }
                        if (end.Paragraph.IsInsideTable && row._Contains(end.Paragraph.AssociatedCell))
                            return;
                    }
                }
            }
            if (deleteNextBlock && block != null) {
                var nextSection = block.Section;
                if (section != nextSection) {
                    if (editAction < 4)
                        section._CombineSection(selection, nextSection);
                    if (editAction > 2)
                        selection._CopySectionFormat(section);
                }
                block._Delete(selection, start, end, editAction);
            }
        };
        TableCellAdv.prototype._UpdateEditPosition = function (selection) {
            var firstParagraph = this._GetFirstParagraph();
            selection.EditPosition = firstParagraph._GetHierarchicalIndex("0");
        };
        TableCellAdv.prototype._CombineTableCellWidgets = function (rowWidget) {
            if (this.TableCellWidgets.Count == 0)
                return;
            var cellWidget = this.TableCellWidgets[0];
            if (!rowWidget.ChildWidgets._Contains(cellWidget))
                cellWidget._UpdateTableRowWidget(rowWidget, rowWidget.ChildWidgets.Count);
            cellWidget._UpdateWidgetHeight();
            for (var i = 0; i < this.Blocks.Count; i++) {
                var block = this.Blocks[i];
                if (block instanceof ParagraphAdv)
                    block._CombineParagraphWidgets(cellWidget);
                else
                    block._CombineTableWidgets(cellWidget);
            }
            for (var i = 1; i < this.TableCellWidgets.Count; i++) {
                var curWidget = this.TableCellWidgets[i];
                curWidget._Dispose();
                i--;
            }
        };
        TableCellAdv.prototype._GetBlankCell = function () {
            var cell = new TableCellAdv(null);
            cell.CellFormat._CopyFormat(this.CellFormat);
            var lastParagraph = this._GetLastParagraph();
            var newParagraph = new ParagraphAdv(null);
            newParagraph.ParagraphFormat._CopyFormat(lastParagraph.ParagraphFormat);
            newParagraph.CharacterFormat._CopyFormat(lastParagraph.CharacterFormat);
            cell.Blocks._Add(newParagraph);
            return cell;
        };
        TableCellAdv.prototype._DecreaseWidth = function (dragValue) {
            this.CellFormat.CellWidth = this.CellFormat.CellWidth - dragValue > 1.06 + this.OwnerTable.TableFormat.CellSpacing + this.LeftMargin + this.RightMargin ? this.CellFormat.CellWidth - dragValue : 1.06 + this.OwnerTable.TableFormat.CellSpacing + this.LeftMargin + this.RightMargin;
            if (this.CellFormat.PrefferedWidthType == WidthType.Auto)
                this.CellFormat.PrefferedWidthType = WidthType.Pixel;
            if (this.CellFormat.PrefferedWidthType == WidthType.Pixel)
                this.CellFormat.PrefferedWidthType = this.CellFormat.CellWidth;
            else {
                var value = this._ConvertPixelToPercent(this.CellFormat.CellWidth);
                this.CellFormat.PrefferedWidth = value;
            }
        };
        TableCellAdv.prototype._IncreaseWidth = function (dragValue) {
            this.CellFormat.CellWidth = this.CellFormat.CellWidth + dragValue > 1.06 + this.OwnerTable.TableFormat.CellSpacing + this.LeftMargin + this.RightMargin ? this.CellFormat.CellWidth + dragValue : 1.06 + this.OwnerTable.TableFormat.CellSpacing + this.LeftMargin + this.RightMargin;
            if (this.CellFormat.PrefferedWidthType == WidthType.Auto)
                this.CellFormat.PrefferedWidthType = WidthType.Pixel;
            if (this.CellFormat.PrefferedWidthType == WidthType.Pixel)
                this.CellFormat.PrefferedWidth = this.CellFormat.CellWidth;
            else {
                var value = this._ConvertPixelToPercent(this.CellFormat.CellWidth);
                this.CellFormat.PrefferedWidth = value;
            }
        };
        TableCellAdv.prototype._ConvertPixelToPercent = function (cellPreferredWidth) {
            var value = 0;
            var clientWidth = this.OwnerTable._GetOwnerWidth();
            var tableWidth = this.OwnerTable._GetTableClientWidth(clientWidth);
            value = (cellPreferredWidth / tableWidth) * 100;
            value = MathHelper._Round(value, 1);
            return value < 100 ? value : 100;
        };
        TableCellAdv.prototype._ApplyCellFormat = function (selection, start, end, property, value) {
            this.CellFormat._ApplyPropertyValue(selection.CurrentBaseHistoryInfo, property, value);
            if (end.Paragraph.AssociatedCell == this)
                return;
            var cell = this._GetNextCell();
            if (cell != null)
                cell._ApplyCellFormat(selection, start, end, property, value);
        };
        TableCellAdv.prototype._GetNextCell = function () {
            if (this.NextNode == null) {
                if (this.Owner instanceof TableRowAdv
                    && this.Owner.NextNode != null)
                    return this.Owner.NextNode.Cells[0];
            }
            return (this.NextNode == null) ? null : this.NextNode;
        };
        TableCellAdv.prototype._ConvertPercentToPixel = function (cellPreferredWidth) {
            var value = 0;
            var clientWidth = this.OwnerTable._GetOwnerWidth();
            var tableWidth = this.OwnerTable._GetTableClientWidth(clientWidth);
            value = (cellPreferredWidth * tableWidth) / 100;
            value = MathHelper._Round(value, 2);
            return value < 2112 ? value : 2112;
        };
        TableCellAdv.prototype._Dispose = function () {
            this._SetOwner(null);
            this.CellFormat._Dispose();
            if (this.TableCellWidgets != null) {
                this._ClearWidgets();
                this.TableCellWidgets = null;
            }
            if (this.Blocks != null) {
                this.Blocks._Dispose();
                for (var i = 0; i < this.Blocks.Count; i++) {
                    var block = this.Blocks[i];
                    block._Dispose();
                    this.Blocks._Remove(block);
                    i--;
                }
                this.ChildNodes = null;
            }
            this.Fields = null;
            this.FieldCharacter = null;
        };
        TableCellAdv.prototype._SerializeCells = function () {
            var cells = { "Blocks": [], "CellFormat": [], "ColumnIndex": [] };
            for (var i = 0; i < this.Blocks.Count; i++) {
                var block = this.Blocks[i];
                if (block instanceof ParagraphAdv)
                    cells.Blocks[i] = block._SerializeBlock();
                else if (block instanceof TableAdv)
                    cells.Blocks[i] = block._SerializeBlock();
            }
            var cellFormat = this.CellFormat;
            cells.CellFormat = cellFormat._SerializeCellFormat();
            cells.ColumnIndex = this.ColumnIndex;
            return cells;
        };
        return TableCellAdv;
    }(CompositeNode));
    DocumentEditorFeatures.TableCellAdv = TableCellAdv;
    var HyperlinkDialog = (function () {
        function HyperlinkDialog(viewer) {
            this.layoutViewer = null;
            this.InsertHyperlinkDialog = null;
            this.NavigationUrl = null;
            this.DisplayText = "";
            this.displayTextbox = null;
            this.urlTextbox = null;
            this.layoutViewer = viewer;
            this._InitHyperlinkDialog();
        }
        HyperlinkDialog.prototype._InitHyperlinkDialog = function () {
            var instance = this.layoutViewer;
            this.InsertHyperlinkDialog = instance.OwnerControl.ej.buildTag("div", "", { "display": "none", "width": "auto" }, { "id": "documentEditor_" + instance.OwnerControl.ContainerId + "_insertHyperlinkDialog", "title": "Insert Hyperlink" });
            instance.OwnerControl.DocumentEditorElement.appendChild(this.InsertHyperlinkDialog[0]);
            var innerDiv = document.createElement("div");
            var table = document.createElement("TABLE");
            table.innerHTML += "<tr style='height: 50px;'><td style= 'width:40%'>Text to Display</td><td><input type='text' id= '" + this.InsertHyperlinkDialog[0].id + "_displayText' style= 'width:100%' /></td></tr><tr style='height:50px;'><td style='width:35%'>Address</td><td><input type='text' id= '" + this.InsertHyperlinkDialog[0].id + "_address' style= 'width:100%' / ></td></tr>";
            innerDiv.appendChild(table);
            var ins = this;
            var okBtn = instance.OwnerControl.ej.buildTag("input", "", { "margin-left": "0px", "width": "55px", "left": "145px", "position": "relative" }, {
                "type": "button", "id": this.InsertHyperlinkDialog[0].id + "_ok", "value": "Ok"
            });
            okBtn.ejButton({
                click: instance.OwnerControl.ej.proxy(ins._OnInsertHyperlink, ins)
            });
            var cancelBtn = instance.OwnerControl.ej.buildTag("input", "", { "margin-left": "0px", "width": "55px", "left": "165px", "position": "relative" }, { "id": this.InsertHyperlinkDialog[0].id + "_cancel", "type": "button", "value": "Cancel" });
            cancelBtn.ejButton({
                click: function (args) {
                    if (!args.cancel)
                        ins.InsertHyperlinkDialog.ejDialog("close");
                }
            });
            innerDiv.appendChild(okBtn[0]);
            innerDiv.appendChild(cancelBtn[0]);
            this.InsertHyperlinkDialog[0].appendChild(innerDiv);
            this.displayTextbox = this.InsertHyperlinkDialog.find("#" + this.InsertHyperlinkDialog[0].id + "_displayText")[0];
            this.urlTextbox = this.InsertHyperlinkDialog.find("#" + this.InsertHyperlinkDialog[0].id + "_address")[0];
            this.displayTextbox.addEventListener("keyup", function () {
                ins.DisplayText = ins.displayTextbox.value;
            });
            this.urlTextbox.addEventListener("keyup", function () {
                var selectedText = instance.OwnerControl.Selection.Text;
                var urlValue = ins.urlTextbox.value;
                if (urlValue.substring(0, 4).toLowerCase() == "www.")
                    ins.urlTextbox.value = "http://" + urlValue;
                if (ins.DisplayText == "" && urlValue != "")
                    ins.displayTextbox.value = urlValue;
            });
            this.InsertHyperlinkDialog.keyup(function (evt) {
                if (evt.keyCode == 13) {
                    if (ins.displayTextbox.value != "" && ins.urlTextbox.value != "")
                        ins._OnInsertHyperlink();
                }
            });
        };
        HyperlinkDialog.prototype._loadHyperlinkFieldOnDialog = function () {
            var fieldBegin = this.layoutViewer.OwnerControl.Selection._GetHyperlinkField();
            if (fieldBegin != null) {
                if (fieldBegin.fieldSeparator != null) {
                    var isNestedField = false;
                    var format = null;
                    var fieldObj = fieldBegin.fieldSeparator.OwnerParagraph._GetHyperlinkDisplayText(fieldBegin.fieldSeparator, fieldBegin.fieldEnd, isNestedField, format);
                    this.DisplayText = fieldObj.displayText;
                }
                this.displayTextbox.value = this.DisplayText;
                var hyperlink = new HyperLink(fieldBegin);
                this.urlTextbox.value = this.NavigationUrl = hyperlink.NavigationLink;
            }
            else {
                this.DisplayText = this.layoutViewer.OwnerControl.Selection._GetText(true);
                if (this.DisplayText != "" && this.DisplayText != undefined) {
                    if (this.DisplayText.indexOf("\r") > 0 && (this.DisplayText.lastIndexOf("\r") > 0 && this.DisplayText.slice(0, -1).indexOf('\r') > 0)) {
                        this.displayTextbox.value = "<<Selection in document>>";
                        this.displayTextbox.disabled = true;
                    }
                    else
                        this.displayTextbox.value = this.DisplayText;
                }
            }
            var ins = this;
            setTimeout(function () { ins.urlTextbox.focus(); }, 405);
        };
        HyperlinkDialog.prototype._OnInsertHyperlink = function () {
            var selection = this.layoutViewer.OwnerControl.Selection;
            var displayText = this.displayTextbox.value;
            var address = this.urlTextbox.value;
            if (this.NavigationUrl != null)
                selection._EditHyperlink(address, displayText);
            else
                selection._InsertHyperlink(address, displayText, (selection.Text != displayText && !this.displayTextbox.disabled));
            this.InsertHyperlinkDialog.ejDialog("close");
            this.NavigationUrl = null;
        };
        HyperlinkDialog.prototype._ClearValues = function () {
            this.displayTextbox.value = "";
            this.urlTextbox.value = "";
            this.DisplayText = "";
            this.displayTextbox.disabled = false;
        };
        return HyperlinkDialog;
    }());
    DocumentEditorFeatures.HyperlinkDialog = HyperlinkDialog;
    var ParagraphDialog = (function () {
        function ParagraphDialog(viewer) {
            this.layoutViewer = null;
            this.Alignment = null;
            this.LeftIndent = null;
            this.Special = null;
            this.RightIndent = null;
            this.By = null;
            this.BeforeSpacing = null;
            this.LineSpacing = null;
            this.AfterSpacing = null;
            this.LineSpacingAt = null;
            this.currentalign = null;
            this.InsertParagraphDialog = null;
            this.layoutViewer = viewer;
            this._InitParagraphDialog();
        }
        ParagraphDialog.prototype._InitParagraphDialog = function () {
            var instance = this.layoutViewer;
            this.InsertParagraphDialog = instance.OwnerControl.ej.buildTag("div", "", { "display": "none" }, {
                "id": "documentEditor_" + instance.OwnerControl.ContainerId + "_insertParagraphDialog", "title": "Paragraph"
            });
            instance.OwnerControl.DocumentEditorElement.appendChild(this.InsertParagraphDialog[0]);
            var innerDiv = document.createElement("div");
            innerDiv.style.width = "475px";
            innerDiv.style.height = "520px";
            var table = document.createElement("TABLE");
            table.style.width = "500px";
            table.style.height = "auto";
            table.style.padding = "20px";
            table.style.margin = "10px";
            table.innerHTML += "<tr style='height:10px;'><td><label style='font-size:12px;color:blue;'>General</label></td></tr><tr><td><label>Alignment</label></br><input type= 'text' class='nodetext' id= '" + this.InsertParagraphDialog[0].id + "_Alignment'></td></tr>";
            table.innerHTML += "<tr><td><label style='font-size:12px;color:blue;'>Indentation</label></td></tr></br><tr><td><label>Left</label></br><input type='text' class='nodetext' id='" + this.InsertParagraphDialog[0].id + "_leftIndent'></br><label>Special</label></br><input type='text' class='nodetext' id='" + this.InsertParagraphDialog[0].id + "_special'></td></br><td><label>Right</label></br><input type='text' class='nodetext' id='" + this.InsertParagraphDialog[0].id + "_rightIndent'></br><label>By</label></br><input type='text' class='nodetext' id='" + this.InsertParagraphDialog[0].id + "_By'></td></tr>";
            table.innerHTML += "<tr><td><label style='font-size:12px;color:blue;'>Spacing</label></td></tr></br><tr><td><label>Before</label></br><input type='text' class='nodetext' id= '" + this.InsertParagraphDialog[0].id + "_beforeSpacing'></br><label>Line Spacing</label></br><input type='text' class='nodetext' id='" + this.InsertParagraphDialog[0].id + "_lineSpacing'></td></br><td><label>After</label></br><input type='text' class='nodetext' id='" + this.InsertParagraphDialog[0].id + "_afterSpacing'></br><label>At</label></br><input type='text' class='nodetext' id='" + this.InsertParagraphDialog[0].id + "_lineSpacingAt'></td></tr>";
            innerDiv.appendChild(table);
            var okBtn = instance.OwnerControl.ej.buildTag("input", "", { "margin-left": "0px", "left": "250px", "position": "relative" }, {
                "type": "button", "id": this.InsertParagraphDialog[0].id + "_ok", "value": "Ok"
            });
            var cancelBtn = instance.OwnerControl.ej.buildTag("input", "", { "margin-left": "0px", "left": "280px", "position": "relative" }, {
                "type": "button", "id": this.InsertParagraphDialog[0].id + "_cancel", "value": "Cancel"
            });
            var currentIns = this;
            cancelBtn.ejButton({
                width: "90px",
                height: "23px",
                click: function (args) {
                    if (!args.cancel)
                        currentIns.InsertParagraphDialog.ejDialog("close");
                }
            });
            okBtn.ejButton({
                width: "90px",
                height: "23px",
                click: instance.OwnerControl.ej.proxy(this._OnInsertParagraphFormat, this)
            });
            innerDiv.appendChild(okBtn[0]);
            innerDiv.appendChild(cancelBtn[0]);
            this.InsertParagraphDialog[0].appendChild(innerDiv);
            this.Alignment = this.InsertParagraphDialog.find("#" + this.InsertParagraphDialog[0].id + "_Alignment");
            this.LeftIndent = this.InsertParagraphDialog.find("#" + this.InsertParagraphDialog[0].id + "_leftIndent");
            this.Special = this.InsertParagraphDialog.find("#" + this.InsertParagraphDialog[0].id + "_special");
            this.RightIndent = this.InsertParagraphDialog.find("#" + this.InsertParagraphDialog[0].id + "_rightIndent");
            this.By = this.InsertParagraphDialog.find("#" + this.InsertParagraphDialog[0].id + "_By");
            this.BeforeSpacing = this.InsertParagraphDialog.find("#" + this.InsertParagraphDialog[0].id + "_beforeSpacing");
            this.LineSpacing = this.InsertParagraphDialog.find("#" + this.InsertParagraphDialog[0].id + "_lineSpacing");
            this.AfterSpacing = this.InsertParagraphDialog.find("#" + this.InsertParagraphDialog[0].id + "_afterSpacing");
            this.LineSpacingAt = this.InsertParagraphDialog.find("#" + this.InsertParagraphDialog[0].id + "_lineSpacingAt");
            instance._CreateEjDropDownList(this.Alignment);
            instance._CreateEjNumericTextbox(this.LeftIndent);
            instance._CreateEjDropDownList(this.Special);
            instance._CreateEjNumericTextbox(this.RightIndent);
            instance._CreateEjNumericTextbox(this.BeforeSpacing);
            instance._CreateEjDropDownList(this.LineSpacing);
            instance._CreateEjNumericTextbox(this.AfterSpacing);
            instance._CreateEjNumericTextbox(this.LineSpacingAt);
            this.Alignment.ejDropDownList({
                select: "Alignment",
                dataSource: ["Center", "Left", "Right", "Justify"],
                width: "200px",
                selectedItemIndex: 0
            });
            this.LeftIndent.ejNumericTextbox({
                minValue: -2112, maxValue: 2112, width: 200, change: ""
            });
            this.Special.ejDropDownList({
                select: "Special",
                dataSource: ["(None)", "First line", "Hanging"],
                width: "200px",
                selectedItemIndex: 0
            });
            this.RightIndent.ejNumericTextbox({
                minValue: -2112, maxValue: 2112, width: 200, change: ""
            });
            this.By.ejNumericTextbox({
                minValue: 0, maxValue: 2112, width: 200, change: ""
            });
            this.BeforeSpacing.ejNumericTextbox({
                minValue: 0, maxValue: 2112, width: 200, incrementStep: 6, change: ""
            });
            this.LineSpacing.ejDropDownList({
                select: "LineSpacing",
                dataSource: ["Atleast", "Exactly", "Multiple"],
                width: "200px",
                selectedItemIndex: 2
            });
            this.AfterSpacing.ejNumericTextbox({
                minValue: 0, maxValue: 2112, width: 200, incrementStep: 6, change: ""
            });
            this.LineSpacingAt.ejNumericTextbox({
                minValue: 0, maxValue: 2112, width: 200, incrementStep: 0.5, decimalPlaces: 2, change: ""
            });
        };
        ParagraphDialog.prototype._OnInsertParagraphFormat = function () {
            var selection = this.layoutViewer.OwnerControl.Selection;
            if (!this.ParagraphFormat._IsEqualFormat(selection.ParagraphFormat)) {
                var format = new ParagraphFormat(null);
                this.ParagraphFormat._CopyToFormat(format);
                selection._OnParagraphFormat(format);
            }
            this.InsertParagraphDialog.ejDialog("close");
        };
        ParagraphDialog.prototype._WireEventsAndBindings = function () {
            this.ParagraphFormat = new SelectionParagraphFormat(null);
            var ins = this;
            var indentType = this.Special.data("ejDropDownList");
            var indentVal = indentType.model.value;
            this.Alignment.ejDropDownList({
                change: function (args) {
                    if (args.text == "Left")
                        ins.ParagraphFormat.TextAlignment = 1;
                    else if (args.text == "Right")
                        ins.ParagraphFormat.TextAlignment = 2;
                    else if (args.text == "Center")
                        ins.ParagraphFormat.TextAlignment = 0;
                    else
                        ins.ParagraphFormat.TextAlignment = 3;
                }
            });
            this.LineSpacing.ejDropDownList({
                change: function (args) {
                    ins.ParagraphFormat.LineSpacingType = args.itemId;
                }
            });
            this.LeftIndent.ejNumericTextbox({
                change: function (args) {
                    ins.ParagraphFormat.LeftIndent = args.value;
                }
            });
            this.Special.ejDropDownList({
                change: function (args) {
                    var value = ins.ParagraphFormat.FirstLineIndent;
                    if (args.text == "Hanging")
                        ins.ParagraphFormat.FirstLineIndent = value > 0 ? -(value) : value;
                    else if (args.text == "First line")
                        ins.ParagraphFormat.FirstLineIndent = value < 0 ? -(value) : value;
                }
            });
            this.RightIndent.ejNumericTextbox({
                change: function (args) {
                    ins.ParagraphFormat.RightIndent = args.value;
                }
            });
            this.By.ejNumericTextbox({
                change: function (args) {
                    var value = args.value;
                    if (indentVal == "Hanging")
                        ins.ParagraphFormat.FirstLineIndent = value > 0 ? -(value) : value;
                    else
                        ins.ParagraphFormat.FirstLineIndent = value < 0 ? -(value) : value;
                }
            });
            this.AfterSpacing.ejNumericTextbox({
                change: function (args) {
                    ins.ParagraphFormat.AfterSpacing = args.value;
                }
            });
            this.BeforeSpacing.ejNumericTextbox({
                change: function (args) {
                    ins.ParagraphFormat.BeforeSpacing = args.value;
                }
            });
            this.LineSpacingAt.ejNumericTextbox({
                change: function (args) {
                    ins.ParagraphFormat.LineSpacing = args.value;
                }
            });
        };
        ParagraphDialog.prototype.UnWireEventsAndBindings = function () {
            this.Alignment.ejDropDownList({ change: "" });
            this.LineSpacing.ejDropDownList({ change: "" });
            this.LeftIndent.ejNumericTextbox({ change: "" });
            this.RightIndent.ejNumericTextbox({ change: "" });
            this.By.ejNumericTextbox({ change: "" });
            this.AfterSpacing.ejNumericTextbox({ change: "" });
            this.BeforeSpacing.ejNumericTextbox({ change: "" });
            this.LineSpacingAt.ejNumericTextbox({ change: "" });
            this.ParagraphFormat = null;
        };
        ParagraphDialog.prototype._LoadParagraphDialog = function () {
            this._WireEventsAndBindings();
            this.ParagraphFormat._CloneFormat(this.layoutViewer.OwnerControl.Selection.ParagraphFormat);
            this.currentalign = this.Alignment.data("ejDropDownList");
            if (this.ParagraphFormat.TextAlignment == 0)
                this.Alignment[0].value = this.currentalign.selectItemByIndex(0);
            else if (this.ParagraphFormat.TextAlignment == 1)
                this.Alignment[0].value = this.currentalign.selectItemByIndex(1);
            else if (this.ParagraphFormat.TextAlignment == 2)
                this.Alignment[0].value = this.currentalign.selectItemByIndex(2);
            else if (this.ParagraphFormat.TextAlignment == 3)
                this.Alignment[0].value = this.currentalign.selectItemByIndex(3);
            var currentleftindent = this.InsertParagraphDialog.find("#" + this.InsertParagraphDialog[0].id + "_leftIndent").data("ejNumericTextbox");
            currentleftindent.setModel({ value: this.ParagraphFormat.LeftIndent });
            var currentrightindent = this.InsertParagraphDialog.find("#" + this.InsertParagraphDialog[0].id + "_rightIndent").data("ejNumericTextbox");
            currentrightindent.setModel({ value: this.ParagraphFormat.RightIndent });
            var currentbeforespacing = this.InsertParagraphDialog.find("#" + this.InsertParagraphDialog[0].id + "_beforeSpacing").data("ejNumericTextbox");
            currentbeforespacing.setModel({ value: this.ParagraphFormat.BeforeSpacing });
            var currentafterspacing = this.InsertParagraphDialog.find("#" + this.InsertParagraphDialog[0].id + "_afterSpacing").data("ejNumericTextbox");
            currentafterspacing.setModel({ value: this.ParagraphFormat.AfterSpacing });
            var currentfirstline = this.InsertParagraphDialog.find("#" + this.InsertParagraphDialog[0].id + "_special").data("ejDropDownList");
            var firstlinevalue = this.InsertParagraphDialog.find("#" + this.InsertParagraphDialog[0].id + "_By").data("ejNumericTextbox");
            if (this.ParagraphFormat.FirstLineIndent > 0) {
                this.Special.value = currentfirstline.selectItemByIndex(1);
                firstlinevalue.setModel({ value: this.ParagraphFormat.FirstLineIndent });
            }
            else if (this.ParagraphFormat.FirstLineIndent < 0) {
                this.Special.value = currentfirstline.selectItemByIndex(2);
                firstlinevalue.setModel({ value: -(this.ParagraphFormat.FirstLineIndent) });
            }
            else {
                this.Special.value = currentfirstline.selectItemByIndex(0);
                firstlinevalue.setModel({ value: "" });
            }
            var lineSpacingType = this.InsertParagraphDialog.find("#" + this.InsertParagraphDialog[0].id + "_lineSpacing").data("ejDropDownList");
            lineSpacingType.selectItemByIndex(this.ParagraphFormat.LineSpacingType);
            var linespacing = this.InsertParagraphDialog.find("#" + this.InsertParagraphDialog[0].id + "_lineSpacingAt").data("ejNumericTextbox");
            linespacing.setModel({ value: this.ParagraphFormat.LineSpacing });
        };
        return ParagraphDialog;
    }());
    DocumentEditorFeatures.ParagraphDialog = ParagraphDialog;
    var TableDialog = (function () {
        function TableDialog(owner) {
            this.skipUpdating = false;
            this.IsTableBordersAndShadingUpdated = false;
            this.IsCellBordersAndShadingUpdated = false;
            this.tableFormat = null;
            this.ownerControl = owner;
        }
        Object.defineProperty(TableDialog.prototype, "TableFormat", {
            get: function () {
                if (this.tableFormat == null)
                    this.tableFormat = new TableFormat(null);
                return this.tableFormat;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(TableDialog.prototype, "CellFormat", {
            get: function () {
                if (this.cellFormat == null)
                    this.cellFormat = new CellFormat(null);
                return this.cellFormat;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(TableDialog.prototype, "TablePreferredWidth", {
            get: function () {
                return this.tablePreferredWidth;
            },
            set: function (value) {
                this.tablePreferredWidth = value;
                this._NotifyPropertyChanged("TablePreferredWidth");
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(TableDialog.prototype, "TablePreferredWidthType", {
            get: function () {
                return this.tablePreferredWidthType;
            },
            set: function (value) {
                this.tablePreferredWidthType = value;
                this._NotifyPropertyChanged("TablePreferredWidthType");
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(TableDialog.prototype, "TableAlignment", {
            get: function () {
                return this.tableAlignment;
            },
            set: function (value) {
                this.tableAlignment = value;
                this._NotifyPropertyChanged("TableAlignment");
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(TableDialog.prototype, "LeftIndent", {
            get: function () {
                return this.leftIndent;
            },
            set: function (value) {
                this.leftIndent = value;
                this._NotifyPropertyChanged("LeftIndent");
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(TableDialog.prototype, "HasTableWidth", {
            get: function () {
                return this.hasTableWidth;
            },
            set: function (value) {
                this.hasTableWidth = value;
                this._NotifyPropertyChanged("HasTableWidth");
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(TableDialog.prototype, "RowHeight", {
            get: function () {
                return this.rowHeight;
            },
            set: function (value) {
                this.rowHeight = value;
                this._NotifyPropertyChanged("RowHeight");
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(TableDialog.prototype, "RowHeightType", {
            get: function () {
                return this.rowHeightType;
            },
            set: function (value) {
                this.rowHeightType = value;
                this._NotifyPropertyChanged("RowHeightType");
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(TableDialog.prototype, "AllowBreakAcrossPages", {
            get: function () {
                return this.allowRowBreakAcrossPages;
            },
            set: function (value) {
                this.allowRowBreakAcrossPages = value;
                this._NotifyPropertyChanged("AllowBreakAcrossPages");
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(TableDialog.prototype, "IsHeader", {
            get: function () {
                return this.isHeader;
            },
            set: function (value) {
                this.isHeader = value;
                this._NotifyPropertyChanged("IsHeader");
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(TableDialog.prototype, "HasRowHeight", {
            get: function () {
                return this.hasRowHeight;
            },
            set: function (value) {
                this.hasRowHeight = value;
                this._NotifyPropertyChanged("HasRowHeight");
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(TableDialog.prototype, "CellPreferredWidth", {
            get: function () {
                return this.cellPreferredWidth;
            },
            set: function (value) {
                this.cellPreferredWidth = value;
                this._NotifyPropertyChanged("CellPreferredWidth");
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(TableDialog.prototype, "CellPreferredWidthType", {
            get: function () {
                return this.cellPreferredWidthType;
            },
            set: function (value) {
                this.cellPreferredWidthType = value;
                this._NotifyPropertyChanged("CellPreferredWidthType");
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(TableDialog.prototype, "CellContentAlignment", {
            get: function () {
                return this.cellContentAlignment;
            },
            set: function (value) {
                this.cellContentAlignment = value;
                this._NotifyPropertyChanged("CellContentAlignment");
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(TableDialog.prototype, "HasCellWidth", {
            get: function () {
                return this.hasCellWidth;
            },
            set: function (value) {
                this.hasCellWidth = value;
                this._NotifyPropertyChanged("HasCellWidth");
            },
            enumerable: true,
            configurable: true
        });
        TableDialog.prototype._NotifyPropertyChanged = function (propertyName) {
            if (this.skipUpdating)
                return;
            switch (propertyName) {
                case "TablePreferredWidthType":
                    this.skipUpdating = true;
                    if (this.TablePreferredWidthType == WidthType.Percent)
                        this.TablePreferredWidth = this.SelectedCell.OwnerTable._ConvertPixelToPercent(this.TablePreferredWidth);
                    else
                        this.TablePreferredWidth = this.SelectedCell.OwnerTable._ConvertPercentToPixel(this.TablePreferredWidth);
                    this.skipUpdating = false;
                    break;
                case "CellPreferredWidthType":
                    this.skipUpdating = true;
                    if (this.CellPreferredWidthType == WidthType.Percent)
                        this.CellPreferredWidth = this.SelectedCell._ConvertPixelToPercent(this.CellPreferredWidth);
                    else
                        this.CellPreferredWidth = this.SelectedCell._ConvertPercentToPixel(this.CellPreferredWidth);
                    this.skipUpdating = false;
                    break;
                case "HasRowHeight":
                    this.skipUpdating = true;
                    this.RowHeightType = HeightType.Atleast;
                    this.skipUpdating = false;
                    break;
            }
        };
        TableDialog.prototype._CloneTableFormat = function (tableFormat) {
            if (tableFormat != null) {
                this.HasTableWidth = tableFormat._HasValue(TableFormat.PreferredWidthProperty);
                if (this.HasTableWidth) {
                    this.TablePreferredWidth = tableFormat.PreferredWidth;
                    this.TablePreferredWidthType = tableFormat.PreferredWidthType;
                }
                this.LeftIndent = tableFormat.LeftIndent;
            }
        };
        TableDialog.prototype._CloneRowFormat = function (rowFormat) {
            if (rowFormat != null) {
                this.AllowBreakAcrossPages = rowFormat.AllowBreakAcrossPages;
                this.IsHeader = rowFormat.IsHeader;
                this.HasRowHeight = rowFormat.HeightType != HeightType.Auto;
                if (this.HasRowHeight) {
                    this.RowHeight = rowFormat.Height;
                    this.RowHeightType = rowFormat.HeightType;
                }
            }
        };
        TableDialog.prototype._CloneCellFormat = function (cellFormat) {
            if (cellFormat != null) {
                this.CellContentAlignment = cellFormat.VerticalAlignment;
                this.HasCellWidth = cellFormat._HasValue(CellFormat.PreferredWidthProperty);
                if (this.HasCellWidth) {
                    this.CellPreferredWidth = cellFormat.PrefferedWidth;
                    this.CellPreferredWidthType = cellFormat.PrefferedWidthType;
                }
            }
        };
        TableDialog.prototype._WireUpEventsAndBindings = function () {
            if (this.ownerControl != null) {
                this._CloneTableFormat(this.ownerControl.Selection.TableFormat.Table.TableFormat);
                var start = this.ownerControl.Selection.Start;
                if (!this.ownerControl.Selection.IsForward)
                    start = this.ownerControl.Selection.End;
                this.SelectedCell = start.Paragraph.AssociatedCell;
                while (this.SelectedCell.OwnerTable != this.ownerControl.Selection.TableFormat.Table)
                    this.SelectedCell = this.SelectedCell.OwnerTable.AssociatedCell;
                this._CloneCellFormat(this.SelectedCell.CellFormat);
                this._CloneRowFormat(this.SelectedCell.OwnerRow.RowFormat);
            }
        };
        TableDialog.prototype._UnwireEventsAndBindings = function () {
            this.IsCellBordersAndShadingUpdated = false;
            this.IsTableBordersAndShadingUpdated = false;
            this.cellFormat = null;
            this.tableFormat = null;
            this.SelectedCell = null;
        };
        TableDialog.prototype._ApplyTablePropertiesButton_Click = function () {
            if (this.ownerControl != null) {
                var hasTWidth = this.SelectedCell.OwnerTable.TableFormat._HasValue(TableFormat.PreferredWidthProperty);
                if (this.tableFormat == null &&
                    ((hasTWidth ? this.SelectedCell.OwnerTable.TableFormat.PreferredWidth != this.TablePreferredWidth || this.SelectedCell.OwnerTable.TableFormat.PreferredWidthType != this.TablePreferredWidthType : this.HasTableWidth != hasTWidth)
                        || this.SelectedCell.OwnerTable.TableFormat.TableAlignment != this.TableAlignment
                        || this.SelectedCell.OwnerTable.TableFormat.LeftIndent != this.LeftIndent))
                    this.tableFormat = new TableFormat(null);
                if (this.tableFormat != null) {
                    this.tableFormat.TableAlignment = this.TableAlignment;
                    if (this.HasTableWidth) {
                        this.tableFormat.PreferredWidth = this.TablePreferredWidth;
                        this.tableFormat.PreferredWidthType = this.TablePreferredWidthType;
                    }
                    else
                        this.tableFormat.PreferredWidthType = WidthType.Auto;
                    this.tableFormat.LeftIndent = this.LeftIndent;
                }
                var hasCWidth = this.SelectedCell.CellFormat._HasValue(CellFormat.PreferredWidthProperty);
                if (this.cellFormat == null && ((hasCWidth ? this.SelectedCell.CellFormat.PrefferedWidth != this.CellPreferredWidth || this.SelectedCell.CellFormat.PrefferedWidthType != this.CellPreferredWidthType : this.HasTableWidth != hasTWidth)
                    || this.SelectedCell.CellFormat.VerticalAlignment != this.CellContentAlignment))
                    this.cellFormat = new CellFormat(null);
                if (this.cellFormat != null) {
                    this.cellFormat.VerticalAlignment = this.CellContentAlignment;
                    if (this.HasCellWidth && this.HasCellWidth) {
                        this.cellFormat.PrefferedWidth = this.CellPreferredWidth;
                        this.cellFormat.PrefferedWidthType = this.CellPreferredWidthType;
                    }
                    else
                        this.cellFormat.PrefferedWidthType = WidthType.Auto;
                }
                var rowFormat = null;
                var hasHeight = this.SelectedCell.OwnerRow.RowFormat._HasValue(RowFormat.HeightProperty);
                if ((hasHeight ? (this.SelectedCell.OwnerRow.RowFormat.Height != this.RowHeight || this.SelectedCell.OwnerRow.RowFormat.HeightType != this.RowHeightType || this.HasRowHeight != hasHeight) : this.HasRowHeight != hasHeight)
                    || this.SelectedCell.OwnerRow.RowFormat.AllowBreakAcrossPages != this.allowRowBreakAcrossPages
                    || this.SelectedCell.OwnerRow.RowFormat.IsHeader != this.IsHeader) {
                    rowFormat = new RowFormat(null);
                    if (this.AllowBreakAcrossPages)
                        rowFormat.AllowBreakAcrossPages = this.AllowBreakAcrossPages;
                    if (this.IsHeader)
                        rowFormat.IsHeader = this.IsHeader;
                    if (this.HasRowHeight && this.RowHeight >= 1.33) {
                        rowFormat.HeightType = this.RowHeightType;
                        rowFormat.Height = this.RowHeight;
                    }
                    else
                        rowFormat.HeightType = HeightType.Auto;
                }
                if (this.tableFormat != null && !this.IsTableBordersAndShadingUpdated) {
                    if (this.ownerControl.Selection.TableFormat.Table.TableFormat.Shading != null)
                        this.TableFormat.Shading = this.ownerControl.Selection.TableFormat.Table.TableFormat.Shading._Clone();
                    if (this.ownerControl.Selection.TableFormat.Table.TableFormat.Borders != null)
                        this.tableFormat.Borders = this.ownerControl.Selection.TableFormat.Table.TableFormat.Borders._Clone();
                }
                if (this.cellFormat != null && !this.IsCellBordersAndShadingUpdated) {
                    if (this.SelectedCell.CellFormat.Borders != null)
                        this.CellFormat.Borders = this.SelectedCell.CellFormat.Borders._Clone();
                    if (this.SelectedCell.CellFormat.Shading != null) {
                        this.CellFormat.Shading = this.SelectedCell.CellFormat.Shading._Clone();
                    }
                }
                if (this.tableFormat != null)
                    this.ownerControl.Selection._OnTableFormat(this.tableFormat);
                if (rowFormat != null)
                    this.ownerControl.Selection._OnRowFormat(rowFormat, this.SelectedCell.OwnerRow);
                if (this.cellFormat != null)
                    this.ownerControl.Selection._OnCellFormat(this.cellFormat, this.SelectedCell);
            }
        };
        return TableDialog;
    }());
    DocumentEditorFeatures.TableDialog = TableDialog;
    var BordersAndShadingsDialog = (function () {
        function BordersAndShadingsDialog(ownerControl) {
            this.skipUpdating = false;
            this.ownerControl = ownerControl;
        }
        Object.defineProperty(BordersAndShadingsDialog.prototype, "ApplyTo", {
            get: function () {
                return this.applyTo;
            },
            set: function (value) {
                this.applyTo = value;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(BordersAndShadingsDialog.prototype, "LineWidth", {
            get: function () {
                return this.lineWidth;
            },
            set: function (value) {
                this.lineWidth = value;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(BordersAndShadingsDialog.prototype, "LineStyle", {
            get: function () {
                return this.lineStyle;
            },
            set: function (value) {
                this.lineStyle = value;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(BordersAndShadingsDialog.prototype, "BorderColor", {
            get: function () {
                return this.borderColor;
            },
            set: function (value) {
                this.borderColor = value;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(BordersAndShadingsDialog.prototype, "ShadingFill", {
            get: function () {
                return this.shadingFill;
            },
            set: function (value) {
                this.shadingFill = value;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(BordersAndShadingsDialog.prototype, "TopBorder", {
            get: function () {
                return this.topBorder;
            },
            set: function (value) {
                this.topBorder = value;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(BordersAndShadingsDialog.prototype, "BottomBorder", {
            get: function () {
                return this.bottomBorder;
            },
            set: function (value) {
                this.bottomBorder = value;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(BordersAndShadingsDialog.prototype, "LeftBorder", {
            get: function () {
                return this.leftBorder;
            },
            set: function (value) {
                this.leftBorder = value;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(BordersAndShadingsDialog.prototype, "RightBorder", {
            get: function () {
                return this.rightBorder;
            },
            set: function (value) {
                this.rightBorder = value;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(BordersAndShadingsDialog.prototype, "VerticalBorder", {
            get: function () {
                return this.verticalBorder;
            },
            set: function (value) {
                this.verticalBorder = value;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(BordersAndShadingsDialog.prototype, "HorizontalBorder", {
            get: function () {
                return this.horizontalBorder;
            },
            set: function (value) {
                this.horizontalBorder = value;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(BordersAndShadingsDialog.prototype, "DiagonalRightBorder", {
            get: function () {
                return this.diagonalRightBorder;
            },
            set: function (value) {
                this.diagonalRightBorder = value;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(BordersAndShadingsDialog.prototype, "DiagonalLeftBorder", {
            get: function () {
                return this.diagonalLeftBorder;
            },
            set: function (value) {
                this.diagonalLeftBorder = value;
            },
            enumerable: true,
            configurable: true
        });
        BordersAndShadingsDialog.prototype._GetLineStyle = function (lineStyle) {
            switch (lineStyle) {
                case LineStyle.Single: return 1;
                case LineStyle.Dot: return 2;
                case LineStyle.DashSmallGap: return 3;
                case LineStyle.DashLargeGap: return 4;
                case LineStyle.DashDot: return 5;
                case LineStyle.DashDotDot: return 6;
                case LineStyle.Double: return 7;
                case LineStyle.Triple: return 8;
                case LineStyle.ThinThickSmallGap: return 9;
                case LineStyle.ThickThinSmallGap: return 10;
                case LineStyle.ThinThickThinSmallGap: return 11;
                case LineStyle.ThinThickMediumGap: return 12;
                case LineStyle.ThickThinMediumGap: return 13;
                case LineStyle.ThinThickThinMediumGap: return 14;
                case LineStyle.ThinThickLargeGap: return 15;
                case LineStyle.ThickThinLargeGap: return 16;
                case LineStyle.ThinThickThinLargeGap: return 17;
                case LineStyle.SingleWavy: return 18;
                case LineStyle.DoubleWavy: return 19;
                case LineStyle.DashDotStroked: return 20;
                case LineStyle.Emboss3D: return 21;
                case LineStyle.Engrave3D: return 22;
                case LineStyle.Outset: return 23;
                case LineStyle.Inset: return 24;
                case LineStyle.Thick: return 25;
            }
            return 0;
        };
        BordersAndShadingsDialog.prototype._GetBorder = function () {
            var border = new Border(null);
            border.Color = this.borderColor;
            border.LineStyle = this.lineStyle;
            border.LineWidth = this.lineWidth;
            return border;
        };
        BordersAndShadingsDialog.prototype._ApplyBordersAndShadingButton_Click = function () {
            if (this.ownerControl != null) {
                var borders = null;
                if (this.TopBorder || this.BottomBorder || this.LeftBorder || this.RightBorder
                    || this.HorizontalBorder || this.VerticalBorder || this.DiagonalRightBorder || this.DiagonalLeftBorder) {
                    borders = new Borders(null);
                    if (this.TopBorder)
                        borders.Top = this._GetBorder();
                    if (this.BottomBorder)
                        borders.Bottom = this._GetBorder();
                    if (this.LeftBorder)
                        borders.Left = this._GetBorder();
                    if (this.RightBorder)
                        borders.Right = this._GetBorder();
                    if (this.HorizontalBorder)
                        borders.Horizontal = this._GetBorder();
                    if (this.VerticalBorder)
                        borders.Vertical = this._GetBorder();
                    if (this.DiagonalLeftBorder)
                        borders.DiagonalDown = this._GetBorder();
                    if (this.DiagonalRightBorder)
                        borders.DiagonalUp = this._GetBorder();
                }
                var shading = new Shading(null);
                shading.BackgroundColor = this.ShadingFill;
                if (this.IsOpenedOnTableProperties) {
                    if (this.ApplyTo == 0) {
                        this.ownerControl.TableDialog.IsCellBordersAndShadingUpdated = true;
                        this.ownerControl.TableDialog.CellFormat.Borders = borders;
                        if (this.ownerControl.TableDialog.SelectedCell.CellFormat.Shading != null) {
                            shading.ForegroundColor = this.ownerControl.TableDialog.SelectedCell.CellFormat.Shading.ForegroundColor;
                            shading.TextureStyle = this.ownerControl.TableDialog.SelectedCell.CellFormat.Shading.TextureStyle;
                        }
                        this.ownerControl.TableDialog.CellFormat.Shading = shading;
                    }
                    else {
                        this.ownerControl.TableDialog.IsTableBordersAndShadingUpdated = true;
                        this.ownerControl.TableDialog.TableFormat.Borders = borders;
                        if (this.ownerControl.Selection.TableFormat.Table.TableFormat.Shading != null) {
                            shading.ForegroundColor = this.ownerControl.Selection.TableFormat.Table.TableFormat.Shading.ForegroundColor;
                            shading.TextureStyle = this.ownerControl.Selection.TableFormat.Table.TableFormat.Shading.TextureStyle;
                        }
                        this.ownerControl.TableDialog.TableFormat.Shading = shading;
                    }
                }
                else {
                    if (this.ApplyTo == 0) {
                        var start = this.ownerControl.Selection.Start;
                        if (!this.ownerControl.Selection.IsForward)
                            start = this.ownerControl.Selection.End;
                        start.Paragraph.AssociatedCell.CellFormat.Borders = borders;
                        if (start.Paragraph.AssociatedCell.CellFormat.Shading != null) {
                            shading.ForegroundColor = start.Paragraph.AssociatedCell.CellFormat.Shading.ForegroundColor;
                            shading.TextureStyle = start.Paragraph.AssociatedCell.CellFormat.Shading.TextureStyle;
                        }
                        start.Paragraph.AssociatedCell.CellFormat.Shading = shading;
                    }
                    else {
                        this.ownerControl.Selection.TableFormat.Table.TableFormat.Borders = borders;
                        if (this.ownerControl.Selection.TableFormat.Table.TableFormat.Shading != null) {
                            shading.ForegroundColor = this.ownerControl.Selection.TableFormat.Table.TableFormat.Shading.ForegroundColor;
                            shading.TextureStyle = this.ownerControl.Selection.TableFormat.Table.TableFormat.Shading.TextureStyle;
                        }
                        this.ownerControl.Selection.TableFormat.Table.TableFormat.Shading = shading;
                    }
                }
            }
        };
        return BordersAndShadingsDialog;
    }());
    DocumentEditorFeatures.BordersAndShadingsDialog = BordersAndShadingsDialog;
    var ParagraphAdv = (function (_super) {
        __extends(ParagraphAdv, _super);
        function ParagraphAdv(node) {
            _super.call(this, node);
            this.ChildNodes = new InlineCollection(this);
            this.CharacterFormat = new CharacterFormat(this);
            this.ParagraphFormat = new ParagraphFormat(this);
            this.paragraphWidgets = new List();
        }
        Object.defineProperty(ParagraphAdv.prototype, "Inlines", {
            get: function () {
                return this.ChildNodes;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(ParagraphAdv.prototype, "ParagraphWidgets", {
            get: function () {
                return this.paragraphWidgets;
            },
            enumerable: true,
            configurable: true
        });
        ParagraphAdv.prototype._GetClonedFieldResultWithSel = function (selection, fieldSeparator) {
            var index = this.Inlines._IndexOf(fieldSeparator);
            for (var i = index; i < this.Inlines.Count; i++) {
                var inline = this.Inlines[i];
                selection._InsertInlineInternal(inline._Clone());
            }
        };
        ParagraphAdv.prototype._GetClonedFieldResult = function (fieldSeparator) {
            var paragraph = new ParagraphAdv(null);
            paragraph.CharacterFormat._CopyFormat(this.CharacterFormat);
            paragraph.ParagraphFormat._CopyFormat(this.ParagraphFormat);
            var index = this.Inlines._IndexOf(fieldSeparator);
            for (var i = index; i < this.Inlines.Count; i++) {
                var inline = this.Inlines[i];
                paragraph.Inlines._Add(inline._Clone());
            }
            return paragraph;
        };
        ParagraphAdv.prototype._GetHyperlinkDisplayText = function (fieldSeparator, fieldEnd, isNestedField, format) {
            var para = this;
            if (para != fieldEnd.OwnerParagraph) {
                isNestedField = true;
                return { "displayText": "<<Selection in Document>>", "isNestedField": isNestedField, "format": format };
            }
            var displayText = "";
            var index = para.Inlines._IndexOf(fieldSeparator);
            for (var i = index + 1; i < para.Inlines.Count; i++) {
                var inline = para.Inlines[i];
                if (inline == fieldEnd)
                    break;
                if (inline instanceof SpanAdv) {
                    displayText += inline.Text;
                    format = inline.CharacterFormat;
                }
                else if (inline instanceof FieldCharacterAdv) {
                    if (inline instanceof FieldBeginAdv && inline.fieldEnd != null) {
                        if (inline.fieldSeparator == null)
                            index = para.Inlines._IndexOf(inline.fieldEnd);
                        else
                            index = para.Inlines._IndexOf(inline.fieldSeparator);
                    }
                }
                else {
                    isNestedField = true;
                    return { "displayText": "<<Selection in Document>>", "isNestedField": isNestedField, "format": format };
                }
            }
            return { "displayText": displayText, "isNestedField": isNestedField, "format": format };
        };
        ParagraphAdv.prototype._SerializeBlock = function () {
            var paragraph = { "Inlines": [], "CharacterFormat": [], "ParagraphFormat": [] };
            paragraph.CharacterFormat = this.CharacterFormat._SerializeCharacterFormat();
            paragraph.ParagraphFormat = this.ParagraphFormat._SerializeParagraphFormat();
            for (var i = 0; i < this.Inlines.Count; i++) {
                var inline = this.Inlines[i];
                if (inline instanceof SpanAdv)
                    paragraph.Inlines[i] = inline._SerializeInline();
                else if (inline instanceof ImageAdv)
                    paragraph.Inlines[i] = inline._SerializeInline();
                else if (inline instanceof FieldBeginAdv)
                    paragraph.Inlines[i] = inline._SerializeInline();
                else if (inline instanceof FieldEndAdv)
                    paragraph.Inlines[i] = inline._SerializeInline();
                else if (inline instanceof FieldSeparatorAdv)
                    paragraph.Inlines[i] = inline._SerializeInline();
                else if (inline instanceof CommentStartAdv)
                    paragraph.Inlines[i] = inline._SerializeInline();
                else if (inline instanceof CommentEndAdv)
                    paragraph.Inlines[i] = inline._SerializeInline();
                else if (inline instanceof CommentAdv)
                    paragraph.Inlines[i] = inline._SerializeInline();
            }
            return paragraph;
        };
        ParagraphAdv.prototype._IsEmpty = function () {
            if (this.Inlines.length == 0)
                return true;
            for (var i = 0; i < this.Inlines.Count; i++) {
                var inline = this.Inlines[i];
                if (inline.Length == 0)
                    continue;
                if (inline instanceof SpanAdv || inline instanceof CommentCharacterAdv || inline instanceof ImageAdv
                    || (inline instanceof FieldCharacterAdv && inline._IsLinkedFieldCharacter()))
                    return false;
            }
            return true;
        };
        ParagraphAdv.prototype._Clone = function () {
            var paragraph = new ParagraphAdv(null);
            paragraph.ParagraphFormat._CopyFormat(this.ParagraphFormat);
            paragraph.CharacterFormat._CopyFormat(this.CharacterFormat);
            for (var i = 0; i < this.Inlines.Count; i++) {
                paragraph.Inlines._Add(this.Inlines[i]._Clone());
            }
            return paragraph;
        };
        ParagraphAdv.prototype._GetTabWidth = function (viewer) {
            if (viewer.ClientActiveArea.X < viewer.ClientArea.X)
                return viewer.ClientArea.X - viewer.ClientActiveArea.X;
            var position = viewer.ClientActiveArea.X - (viewer.ClientArea.X - this.LeftIndent);
            var defaultTabWidth = this.Document.DefaultTabWidth;
            if (position == 0 || defaultTabWidth == 0)
                return defaultTabWidth;
            else {
                var diff = ((Math.round(position) * 100) % (Math.round(defaultTabWidth) * 100)) / 100;
                var cnt = (Math.round(position) - diff) / Math.round(defaultTabWidth);
                var fposition = (cnt + 1) * defaultTabWidth;
                return (fposition - position) > 0 ? fposition - position : defaultTabWidth;
            }
        };
        ParagraphAdv.prototype._AddParagraphWidget = function (area) {
            var paragraphWidget = new ParagraphWidget(this);
            if (this._IsEmpty() && this.ParagraphFormat != null && (this.ParagraphFormat.TextAlignment == TextAlignment.Center || this.ParagraphFormat.TextAlignment == TextAlignment.Right)) {
                var size = this._GetParagraphMarkSize(0, 0);
                var top_1 = size.TopMargin;
                var bottom = size.BottomMargin;
                var width = size.Width;
                var left = area.Left;
                if (this.ParagraphFormat.TextAlignment == TextAlignment.Center)
                    left += (area.Width - width) / 2;
                else
                    left += area.Width - width;
                paragraphWidget.Width = width;
                paragraphWidget.X = area.X;
                paragraphWidget.Y = area.Y;
            }
            else {
                paragraphWidget.Width = area.Width;
                paragraphWidget.X = area.X;
                paragraphWidget.Y = area.Y;
            }
            this.ParagraphWidgets._Add(paragraphWidget);
        };
        ParagraphAdv.prototype._LayoutItems = function (viewer) {
            if (this.paragraphWidgets != null
                && this.paragraphWidgets.Count > 0) {
                this.paragraphWidgets._Clear();
            }
            this._AddParagraphWidget(viewer.ClientActiveArea);
            if (!viewer.IsFieldCode) {
                if (this.ParagraphFormat != null && this.ParagraphFormat.ListFormat != null && this.ParagraphFormat.ListFormat.List != null &&
                    this.ParagraphFormat.ListFormat.ListLevelNumber >= 0 && this.ParagraphFormat.ListFormat.ListLevelNumber < 9)
                    this._LayoutList(viewer);
            }
            if (this._IsEmpty()) {
                this._LayoutEmptyLineWidget(viewer);
            }
            else {
                for (var i = 0; i < this.Inlines.length; i++) {
                    if (i == 0) {
                        if (this.ParagraphFormat != null)
                            viewer._UpdateClientWidth(-this.ParagraphFormat.FirstLineIndent);
                    }
                    var inline = this.Inlines[i];
                    inline._LayoutItems(viewer);
                }
            }
            this._UpdateWidgetToPage(viewer);
        };
        ParagraphAdv.prototype._LayoutList = function (viewer) {
            viewer._UpdateClientWidth(-this.ParagraphFormat.FirstLineIndent);
            var document = this.Document;
            var currentListLevel = this.ParagraphFormat.ListFormat.ListLevel;
            if (currentListLevel == null)
                return;
            var element = new ListTextElementBox(this, currentListLevel, false);
            if (currentListLevel.ListLevelPattern == ListLevelPattern.Bullet)
                element.Text = currentListLevel.NumberFormat;
            else
                element.Text = document._GetListNumber(this.ParagraphFormat.ListFormat);
            TextHelper._UpdateTextSize(element);
            viewer._CutFromLeft(viewer.ClientActiveArea.X + element.Width);
            viewer.LineElements._Add(element);
            if (currentListLevel.FollowCharacter == FollowCharacterType.None)
                return;
            element = new ListTextElementBox(this, currentListLevel, true);
            if (currentListLevel.FollowCharacter == FollowCharacterType.Tab) {
                element.Text = "\t";
                element.Width = this._GetTabWidth(viewer);
            }
            else {
                element.Text = " ";
                TextHelper._UpdateTextSize(element);
            }
            viewer._CutFromLeft(viewer.ClientActiveArea.X + element.Width);
            viewer.LineElements._Add(element);
            viewer._UpdateClientWidth(this.ParagraphFormat.FirstLineIndent);
        };
        ParagraphAdv.prototype._LayoutEmptyLineWidget = function (viewer) {
            var paragraphMarkSize = TextHelper._GetParagraphMarkSize(this.CharacterFormat);
            var maxHeight = paragraphMarkSize.Height;
            var maxDescent = maxHeight - paragraphMarkSize.BaselineOffset;
            if (!isNaN(viewer.LineElements.MaxTextElementHeight)
                && maxHeight < viewer.LineElements.MaxTextElementHeight) {
                maxHeight = viewer.LineElements.MaxTextElementHeight;
                maxDescent = maxHeight - viewer.LineElements.MaxTextElementBaselineOffset;
            }
            var beforeSpacing = this._GetBeforeSpacing();
            if (viewer.CurrentComment == null && viewer.CurrentHeaderFooter == null && viewer instanceof PageLayoutViewer
                && viewer.ClientActiveArea.Height < beforeSpacing + maxHeight && viewer.ClientActiveArea.Y != viewer.ClientArea.Y)
                this._MoveToNextPage(viewer);
            var lineSpacing = this._GetLineSpacing(maxHeight);
            var lineWidget = this._AddLineWidget();
            var topMargin = 0, bottomMargin = 0, leftMargin = 0, height = maxHeight, listTopMargin = 0;
            var element = null;
            if (viewer.LineElements.Count > 0)
                element = viewer.LineElements[0];
            if (element != null) {
                var baselineOffset = element.BaselineOffset;
                topMargin = viewer.LineElements.MaxBaselineOffset - baselineOffset;
                if (element.Height < maxHeight)
                    listTopMargin = maxHeight - maxDescent - (element.Height - (element.Height - baselineOffset));
                else
                    height = element.Height;
            }
            var lineSpacingType = this.ParagraphFormat != null ? this.ParagraphFormat.LineSpacingType : LineSpacingType.Multiple;
            if (lineSpacingType == LineSpacingType.Multiple) {
                if (lineSpacing > maxHeight)
                    bottomMargin += lineSpacing - maxHeight;
                else
                    topMargin += lineSpacing - maxHeight;
            }
            else if (lineSpacingType == LineSpacingType.Exactly)
                topMargin += lineSpacing - (topMargin + height + bottomMargin);
            else if (lineSpacing > topMargin + height + bottomMargin)
                topMargin += lineSpacing - (topMargin + height + bottomMargin);
            topMargin += beforeSpacing;
            bottomMargin += this.ParagraphFormat != null ? this.ParagraphFormat.AfterSpacing : 0;
            if (element != null) {
                var textAlignment = this.ParagraphFormat.TextAlignment;
                if (textAlignment == TextAlignment.Right)
                    leftMargin = viewer.ClientArea.Width - element.Width;
                else if (textAlignment == TextAlignment.Center)
                    leftMargin = (viewer.ClientArea.Width - element.Width) / 2;
                element.Margin = new Margin(leftMargin, listTopMargin + topMargin, 0, bottomMargin);
                element.CurrentLineWidget = lineWidget;
                lineWidget.Height = topMargin + height + bottomMargin;
                lineWidget.Children._Add(element);
            }
            if (viewer.LineElements.Count > 1 && viewer.LineElements[1] instanceof ListTextElementBox) {
                element = viewer.LineElements[1];
                var textAlignment = this.ParagraphFormat.TextAlignment;
                if (textAlignment == TextAlignment.Right)
                    leftMargin = viewer.ClientArea.Width - element.Width;
                else if (textAlignment == TextAlignment.Center)
                    leftMargin = (viewer.ClientArea.Width - element.Width) / 2;
                element.Margin = new Margin(leftMargin, listTopMargin + topMargin, 0, bottomMargin);
                element.CurrentLineWidget = lineWidget;
                lineWidget.Height = topMargin + height + bottomMargin;
                lineWidget.Children._Add(element);
            }
            lineWidget.Height = topMargin + height + bottomMargin;
            viewer._CutFromTop(viewer.ClientActiveArea.Y + lineWidget.Height);
            viewer.LineElements._Clear();
        };
        ParagraphAdv.prototype._MoveToNextPage = function (viewer) {
            var paragraphWidget = this.ParagraphWidgets[this.ParagraphWidgets.length - 1];
            var elements = null;
            if (viewer.LineElements.length > 0) {
                elements = viewer.LineElements._ToList();
                viewer.LineElements._Clear();
            }
            var prevBodyWidget = null;
            if (paragraphWidget.ChildWidgets.Count > 0) {
                this._UpdateWidgetToPage(viewer);
                prevBodyWidget = (paragraphWidget.ContainerWidget instanceof BodyWidget) ? paragraphWidget.ContainerWidget : null;
            }
            else {
                if (this.PreviousBlock instanceof ParagraphAdv)
                    prevBodyWidget = this.PreviousBlock.ParagraphWidgets[this.PreviousBlock.ParagraphWidgets.Count - 1].ContainerWidget;
                else if (this.PreviousBlock instanceof TableAdv)
                    prevBodyWidget = this.PreviousBlock.TableWidgets[this.PreviousBlock.TableWidgets.Count - 1].ContainerWidget;
            }
            var pageIndex = 0;
            if (prevBodyWidget != null && prevBodyWidget.Page != null)
                pageIndex = viewer.Pages._IndexOf(prevBodyWidget.Page);
            if (pageIndex == viewer.Pages.Count - 1
                || viewer.Pages[pageIndex + 1].Section != this.Section) {
                var page = viewer._CreateNewPage(this.Section);
                if (viewer.Pages[pageIndex + 1].Section != this.Section)
                    viewer._InsertPage(pageIndex + 1, page);
            }
            else {
                viewer.Pages[pageIndex + 1].BoundingRectangle = new Rect(viewer.Pages[pageIndex + 1].BoundingRectangle.X, viewer.Pages[pageIndex].BoundingRectangle.Bottom + 20, viewer.Pages[pageIndex + 1].BoundingRectangle.Width, viewer.Pages[pageIndex + 1].BoundingRectangle.Height);
                viewer._UpdateClientArea(this.Section.SectionFormat);
            }
            viewer._UpdateClientAreaForBlock(this, true);
            if (paragraphWidget.ChildWidgets.Count > 0)
                this._AddParagraphWidget(viewer.ClientActiveArea);
            else
                paragraphWidget._UpdateClientAreaLocation(viewer.ClientActiveArea);
            if (elements != null && viewer.LineElements.Count == 0) {
                var left = viewer.ClientActiveArea.X;
                for (var i = 0; i < elements.Count; i++) {
                    var element = elements[i];
                    left += element.Width;
                    viewer.LineElements._Add(element);
                }
                viewer._CutFromLeft(left);
            }
        };
        ParagraphAdv.prototype._UpdateWidgetToPage = function (viewer) {
            var paragraphWidget = this.ParagraphWidgets[this.ParagraphWidgets.length - 1];
            if (this.IsInsideTable) {
                var cellWidget = this.AssociatedCell.TableCellWidgets[this.AssociatedCell.TableCellWidgets.length - 1];
                paragraphWidget.Height = viewer.ClientActiveArea.Y - paragraphWidget.Y;
                if (viewer instanceof PageLayoutViewer) {
                    if (this.AssociatedCell == null || this.AssociatedCell.OwnerRow == null || this.AssociatedCell.OwnerRow.RowFormat == null)
                        return;
                    if (this.AssociatedCell.OwnerRow.RowFormat.HeightType == HeightType.Exactly)
                        cellWidget.Height = this.AssociatedCell.OwnerRow.RowFormat.Height;
                    else {
                        if (this.AssociatedCell.TableCellWidgets.Count <= 1 && this.AssociatedCell.OwnerRow.RowFormat.HeightType == HeightType.Atleast)
                            cellWidget.Height = Math.max(this.AssociatedCell.OwnerRow.RowFormat.Height, cellWidget._GetCellContentHeight() + paragraphWidget.Height);
                        else
                            cellWidget.Height = cellWidget.Height + paragraphWidget.Height;
                    }
                }
                else
                    cellWidget.Height = cellWidget.Height + paragraphWidget.Height;
                cellWidget.ChildWidgets._Add(paragraphWidget);
                paragraphWidget.ContainerWidget = cellWidget;
            }
            else {
                paragraphWidget.Height = viewer.ClientActiveArea.Y - paragraphWidget.Y;
                this._UpdateWidgetsToBody(viewer, paragraphWidget);
                if (viewer.CurrentComment == null) {
                    if (viewer.CommentWidgets && viewer.CommentWidgets.Count > 0)
                        viewer._MoveCommentsToPage(paragraphWidget.ContainerWidget.Page);
                    if (viewer instanceof PageLayoutViewer && viewer.Pages._Contains(paragraphWidget.ContainerWidget.Page))
                        paragraphWidget._render(paragraphWidget.ContainerWidget.Page);
                    else if (viewer instanceof FlowLayoutViewer)
                        paragraphWidget._Render(viewer);
                }
            }
        };
        ParagraphAdv.prototype._GetBeforeSpacing = function () {
            var beforeSpacing = 0;
            if (this.PreviousBlock instanceof ParagraphAdv) {
                if (this.PreviousBlock.ParagraphFormat.AfterSpacing < this.ParagraphFormat.BeforeSpacing)
                    beforeSpacing = this.ParagraphFormat.BeforeSpacing - this.PreviousBlock.ParagraphFormat.AfterSpacing;
            }
            else
                beforeSpacing = this.ParagraphFormat.BeforeSpacing;
            return beforeSpacing;
        };
        ParagraphAdv.prototype._GetLineSpacing = function (maxHeight) {
            if (this.ParagraphFormat == null)
                return 0;
            var lineSpacing = 0;
            switch (this.ParagraphFormat.LineSpacingType) {
                case LineSpacingType.AtLeast:
                case LineSpacingType.Exactly:
                    lineSpacing = this.ParagraphFormat.LineSpacing;
                    break;
                default:
                    lineSpacing = this.ParagraphFormat.LineSpacing * maxHeight;
                    break;
            }
            return lineSpacing;
        };
        ParagraphAdv.prototype._GetParagraphMarkSize = function (topMargin, bottomMargin) {
            var size = TextHelper._GetParagraphMarkSize(this.CharacterFormat);
            var baselineOffset = size.BaselineOffset;
            var maxHeight = size.Height;
            var maxBaselineOffset = baselineOffset;
            if (this.paragraphWidgets.Count > 0 && this.paragraphWidgets[0].ChildWidgets.Count > 0) {
                var lineWidget = this.paragraphWidgets[0].ChildWidgets[0];
                if (lineWidget.Children.Count > 0 && lineWidget.Children[0] instanceof ListTextElementBox
                    && maxHeight < lineWidget.Children[0].Height) {
                    maxHeight = lineWidget.Children[0].Height;
                    maxBaselineOffset = lineWidget.Children[0].BaselineOffset;
                }
            }
            var lineSpacing = this._GetLineSpacing(maxHeight);
            var beforeSpacing = this._GetBeforeSpacing();
            topMargin = maxBaselineOffset - baselineOffset;
            bottomMargin = maxHeight - maxBaselineOffset - (size.Height - baselineOffset);
            var lineSpacingType = this.ParagraphFormat.LineSpacingType;
            if (lineSpacingType == LineSpacingType.Multiple) {
                if (lineSpacing > maxHeight)
                    bottomMargin += lineSpacing - maxHeight;
                else
                    topMargin += lineSpacing - maxHeight;
            }
            else if (lineSpacingType == LineSpacingType.Exactly)
                topMargin += lineSpacing - (topMargin + size.Height + bottomMargin);
            else if (lineSpacing > topMargin + size.Height + bottomMargin)
                topMargin += lineSpacing - (topMargin + size.Height + bottomMargin);
            topMargin += beforeSpacing;
            bottomMargin += this.ParagraphFormat.AfterSpacing;
            return { "Width": size.Width, "Height": size.Height, "TopMargin": topMargin, "BottomMargin": bottomMargin };
        };
        ParagraphAdv.prototype._AddLineWidget = function () {
            var line = null;
            if (this.paragraphWidgets != null && this.paragraphWidgets.Count > 0) {
                var paragraphWidget = void 0;
                paragraphWidget = this.ParagraphWidgets[this.ParagraphWidgets.length - 1];
                line = new LineWidget(paragraphWidget);
                line.Width = paragraphWidget.Width;
                paragraphWidget.ChildWidgets._Add(line);
                line.CurrentParagraphWidget = paragraphWidget;
            }
            return line;
        };
        ParagraphAdv.prototype._GetStartOffset = function () {
            var startOffset = 0;
            for (var i = 0; i < this.Inlines.length; i++) {
                var inline = this.Inlines[i];
                if (inline.Length == 0)
                    continue;
                if (inline instanceof SpanAdv || inline instanceof ImageAdv || inline instanceof CommentCharacterAdv
                    || (inline instanceof FieldCharacterAdv && inline._IsLinkedFieldCharacter()))
                    return startOffset;
                startOffset += inline.Length;
            }
            return startOffset;
        };
        ParagraphAdv.prototype._GetLength = function () {
            var index = 0;
            for (var i = 0; i < this.Inlines.length; i++) {
                index += this.Inlines[i].Length;
            }
            return index;
        };
        ParagraphAdv.prototype._GetOffset = function (inline, index) {
            if (inline == null)
                return index;
            var textIndex = index;
            for (var i = 0; i < this.Inlines.length; i++) {
                if (inline == this.Inlines[i])
                    break;
                textIndex += this.Inlines[i].Length;
            }
            return textIndex;
        };
        ParagraphAdv.prototype._GetLineWidget = function (offset) {
            var lineWidget = null;
            if (this._IsEmpty()) {
                if (this.paragraphWidgets.Count > 0 && this.paragraphWidgets[0].ChildWidgets.Count > 0)
                    lineWidget = this.paragraphWidgets[0].ChildWidgets[0];
            }
            else {
                var indexInInline = 0;
                var inlineInfo = this._GetInline(offset, indexInInline);
                var inline = inlineInfo.inline;
                indexInInline = inlineInfo.index;
                lineWidget = inline._GetLineWidget(indexInInline);
            }
            return lineWidget;
        };
        ParagraphAdv.prototype._GetLineWidgetInternal = function (offset, moveToNextLine) {
            var lineWidget = null;
            if (this._IsEmpty()) {
                if (this.paragraphWidgets.Count > 0 && this.paragraphWidgets[0].ChildWidgets.Count > 0)
                    lineWidget = this.paragraphWidgets[0].ChildWidgets[0];
            }
            else {
                var indexInInline = 0;
                var inlineInfo = this._GetInline(offset, indexInInline);
                var inline = inlineInfo.inline;
                indexInInline = inlineInfo.index;
                lineWidget = inline._GetLineWidgetInternal(indexInInline, moveToNextLine);
            }
            return lineWidget;
        };
        ParagraphAdv.prototype._GetPhysicalPosition = function (offset) {
            return this._GetPhysicalPositionInternal(offset, true);
        };
        ParagraphAdv.prototype._GetPhysicalPositionInternal = function (offset, moveNextLine) {
            if (this._IsEmpty()) {
                var left = this.paragraphWidgets[0].X;
                if (this.paragraphWidgets[0].ChildWidgets.length > 0) {
                    var lineWidget = this.paragraphWidgets[0].ChildWidgets[0];
                    left = lineWidget._GetLeft();
                }
                var topMargin = 0;
                var bottomMargin = 0;
                var size = this._GetParagraphMarkSize(topMargin, bottomMargin);
                if (offset > 0)
                    left += size.Width;
                return new Point(left, this.paragraphWidgets[0].Y + topMargin);
            }
            else {
                var indexInInline = 0;
                var inlineObj = this._GetInline(offset, indexInInline);
                var inline = inlineObj.inline;
                indexInInline = inlineObj.index;
                if (inline.Length == indexInInline && inline.NextNode != null && inline.Elements.Count > 0 && inline.NextNode.Elements.Count > 0
                    && inline.Elements[inline.Elements.Count - 1].CurrentLineWidget != inline.NextNode.Elements[0].CurrentLineWidget) {
                    inline = inline.NextNode;
                    indexInInline = 0;
                }
                return inline._GetPhysicalPosition(indexInInline, moveNextLine);
            }
        };
        ParagraphAdv.prototype._GetEndPosition = function () {
            var widget = this.paragraphWidgets[this.paragraphWidgets.Count - 1];
            var left = widget.X;
            var top = widget.Y;
            var lineWidget = null;
            if (widget.ChildWidgets.Count > 0) {
                lineWidget = widget.ChildWidgets[widget.ChildWidgets.Count - 1];
                left += lineWidget._GetWidth(false);
            }
            if (lineWidget != null)
                top = lineWidget._GetTop();
            var topMargin = 0, bottomMargin = 0;
            var size = this._GetParagraphMarkSize(topMargin, bottomMargin);
            return new Point(left, top + size.TopMargin);
        };
        ParagraphAdv.prototype._GetInline = function (offset, indexInInline) {
            var inline = null;
            var count = 0;
            var isStarted = false;
            for (var i = 0; i < this.Inlines.length; i++) {
                inline = this.Inlines[i];
                if (!isStarted && (inline instanceof SpanAdv || inline instanceof ImageAdv || inline instanceof CommentCharacterAdv
                    || (inline instanceof FieldCharacterAdv && inline._IsLinkedFieldCharacter())))
                    isStarted = true;
                if (isStarted && offset <= count + inline.Length) {
                    indexInInline = (offset - count);
                    if (indexInInline < 0)
                        indexInInline = 0;
                    return { "inline": inline, "index": indexInInline };
                }
                count += inline.Length;
            }
            if (offset > count)
                indexInInline = inline == null ? offset : inline.Length;
            return { "inline": inline, "index": indexInInline };
        };
        ParagraphAdv.prototype._HighlightSelectedContent = function (selection, selectionRange, start, end) {
            if (start.Paragraph.IsInsideTable && (!end.Paragraph.IsInsideTable
                || start.Paragraph.AssociatedCell != end.Paragraph.AssociatedCell
                || start.Paragraph.AssociatedCell._IsCellSelected(start, end))) {
                start.Paragraph.AssociatedCell._Highlight(selection, selectionRange, start, end);
            }
            else {
                var inline = null;
                var index = 0;
                if (this == end.Paragraph) {
                    if (start.Offset + 1 == end.Offset) {
                        var inlineObj = this._GetInline(end.Offset, index);
                        inline = inlineObj.inline;
                        index = inlineObj.index;
                        if (inline instanceof ImageAdv) {
                            var startOffset = this._GetOffset(inline, 0);
                            if (startOffset != start.Offset)
                                inline = null;
                        }
                    }
                    else {
                        var indexInInline = 0;
                        var startInlineObj = start.Paragraph._GetInline(start.Offset, indexInInline);
                        var startInline = startInlineObj.inline;
                        indexInInline = startInlineObj.index;
                        if (indexInInline == startInline.Length)
                            startInline = startInline._GetNextRenderedInline(indexInInline);
                        var endInlineObj = end.Paragraph._GetInline(end.Offset, indexInInline);
                        var endInline = endInlineObj.inline;
                        indexInInline = endInlineObj.index;
                        if (startInline instanceof FieldBeginAdv && endInline instanceof FieldEndAdv && startInline.fieldSeparator != null) {
                            var fieldValue = startInline.fieldSeparator.NextNode;
                            if (fieldValue instanceof ImageAdv && fieldValue.NextNode == endInline)
                                inline = fieldValue;
                        }
                    }
                }
                if (inline instanceof ImageAdv && selection.OwnerControl.IsDocumentLoaded) {
                    var elementBoxObj = inline._GetElementBoxInternal(index);
                    var elementBox = elementBoxObj.element;
                    index = elementBoxObj.index;
                    selection.OwnerControl.Viewer._PositionImageResizer(elementBox);
                    selection.OwnerControl.Viewer._ShowImageResizer();
                }
                else
                    this._Highlight(selection, selectionRange, start, end);
            }
        };
        ParagraphAdv.prototype._Highlight = function (selection, selectionRange, start, end) {
            var selectionStartIndex = 0;
            var selectionEndIndex = 0;
            var startElement = null;
            var endElement = null;
            var startLineObj = this._GetStartLineWidget(start, startElement, selectionStartIndex);
            var startLineWidget = startLineObj.lineWidget;
            startElement = startLineObj.startElement;
            selectionStartIndex = startLineObj.lineIndex;
            var endLineObj = this._GetEndLineWidget(end, endElement, selectionEndIndex);
            var endLineWidget = endLineObj.lineWidget;
            endElement = endLineObj.endElement;
            selectionEndIndex = endLineObj.lineIndex;
            var top = 0;
            var left = 0;
            if (startLineWidget != null) {
                top = startLineWidget._GetTop();
                left = startLineWidget._GetLeftInternal(startElement, selectionStartIndex);
            }
            if (startLineWidget != null && startLineWidget == endLineWidget) {
                var right = endLineWidget._GetLeftInternal(endElement, selectionEndIndex);
                selection._CreateHighlightBorder(selectionRange, startLineWidget, right - left, left, top);
            }
            else {
                var paragraph = this;
                if (startLineWidget != null) {
                    if (paragraph != startLineWidget.CurrentParagraphWidget.CurrentNode)
                        paragraph = startLineWidget.CurrentParagraphWidget.CurrentNode;
                    selection._CreateHighlightBorder(selectionRange, startLineWidget, startLineWidget._GetWidth(true) - (left - startLineWidget.CurrentParagraphWidget.X), left, top);
                    var lineIndex = startLineWidget.CurrentParagraphWidget.ChildWidgets._IndexOf(startLineWidget);
                    var startParagraphWidget = paragraph.ParagraphWidgets._IndexOf(startLineWidget.CurrentParagraphWidget);
                    for (var i = startParagraphWidget; i < paragraph.ParagraphWidgets.Count; i++) {
                        if (i == startParagraphWidget)
                            lineIndex += 1;
                        paragraph.ParagraphWidgets[i]._Highlight(selection, selectionRange, lineIndex, endLineWidget, endElement, selectionEndIndex);
                        if (paragraph.ParagraphWidgets[i] == endLineWidget.CurrentParagraphWidget)
                            return;
                        else
                            lineIndex = 0;
                    }
                }
                var block = paragraph._GetNextRenderedBlock();
                if (block != null)
                    block._Highlight(selection, selectionRange, start, end);
            }
        };
        ParagraphAdv.prototype._HighlightSearchResult = function (searchResult, start, end) {
            var selectionStartIndex = 0;
            var selectionEndIndex = 0;
            var startElement = null;
            var endElement = null;
            var lineWidget = this._GetStartLineWidget(start, startElement, selectionStartIndex);
            var startLineWidget = lineWidget.lineWidget;
            selectionStartIndex = lineWidget.lineIndex;
            startElement = lineWidget.startElement;
            var endLine = this._GetEndLineWidget(end, endElement, selectionEndIndex);
            var endLineWidget = endLine.lineWidget;
            selectionEndIndex = endLine.lineIndex;
            endElement = endLine.endElement;
            var top = startLineWidget._GetTop();
            var left = startLineWidget._GetLeftInternal(startElement, selectionStartIndex);
            if (startLineWidget != null && startLineWidget == endLineWidget) {
                var right = endLineWidget._GetLeftInternal(endElement, selectionEndIndex);
                searchResult._CreateHighlightBorder(startLineWidget, right - left, left, top);
            }
            else {
                var paragraph = this;
                if (startLineWidget != null) {
                    if (paragraph != startLineWidget.CurrentParagraphWidget.CurrentNode)
                        paragraph = startLineWidget.CurrentParagraphWidget.CurrentNode;
                    searchResult._CreateHighlightBorder(startLineWidget, startLineWidget._GetWidth(true) - (left - startLineWidget.CurrentParagraphWidget.X), left, top);
                    var lineIndex = startLineWidget.CurrentParagraphWidget.ChildWidgets._IndexOf(startLineWidget);
                    var startParagraphWidget = paragraph.ParagraphWidgets._IndexOf(startLineWidget.CurrentParagraphWidget);
                    for (var i = startParagraphWidget; i < paragraph.ParagraphWidgets.Count; i++) {
                        if (i == startParagraphWidget)
                            lineIndex += 1;
                        paragraph.ParagraphWidgets[i]._HighlightSearchResult(searchResult, lineIndex, endLineWidget, endElement, selectionEndIndex);
                        if (paragraph.ParagraphWidgets[i] == endLineWidget.CurrentParagraphWidget)
                            return;
                        else
                            lineIndex = 0;
                    }
                }
            }
        };
        ParagraphAdv.prototype._GetStartLineWidget = function (start, startElement, selectionStartIndex) {
            var offset = (this == start.Paragraph ? start.Offset : this._GetStartOffset());
            var startInlineObj = this._GetInline(offset, selectionStartIndex);
            var startInline = startInlineObj.inline;
            selectionStartIndex = startInlineObj.index;
            if (startInline != null && start.OwnerControl.Selection.IsHighlightingCommentRange && startInline.Length == selectionStartIndex && startInline.NextNode != null) {
                startInline = startInline.NextNode;
                selectionStartIndex = 0;
            }
            if (startInline instanceof FieldCharacterAdv) {
                var inlineInfo = startInline._GetRenderedInline(selectionStartIndex);
                startInline = inlineInfo.Inline;
                selectionStartIndex = inlineInfo.InlineIndex;
            }
            if (offset == this._GetLength() + 1)
                selectionStartIndex++;
            if (startInline == null) {
                if (this.ParagraphWidgets.Count > 0) {
                    var widget = this.ParagraphWidgets[0];
                    return { "lineWidget": widget.ChildWidgets.Count > 0 ? widget.ChildWidgets[0] : null, "lineIndex": selectionStartIndex, "startElement": startElement };
                }
                else
                    return null;
            }
            else {
                var startElementObj = startInline._GetElementBoxInternal(selectionStartIndex);
                startElement = startElementObj.element;
                selectionStartIndex = startElementObj.index;
                var lineWidget = void 0;
                if (startElement == null)
                    lineWidget = startInline._GetLineWidget(selectionStartIndex);
                else
                    lineWidget = startElement.CurrentLineWidget;
                return { "lineWidget": lineWidget, "lineIndex": selectionStartIndex, "startElement": startElement };
            }
        };
        ParagraphAdv.prototype._GetEndLineWidget = function (end, endElement, selectionEndIndex) {
            var endInlineObj = end.Paragraph._GetInline(end.Offset, selectionEndIndex);
            var endInline = endInlineObj.inline;
            selectionEndIndex = endInlineObj.index;
            if (endInline instanceof FieldCharacterAdv) {
                var inlineInfo = endInline._GetRenderedInline(selectionEndIndex);
                endInline = inlineInfo.Inline;
                selectionEndIndex = inlineInfo.InlineIndex;
            }
            if (endInline == null) {
                if (end.Offset == end.Paragraph._GetLength() + 1)
                    selectionEndIndex = 1;
                if (end.Paragraph.ParagraphWidgets.Count > 0) {
                    var widget = end.Paragraph.ParagraphWidgets[end.Paragraph.ParagraphWidgets.Count - 1];
                    return { "lineWidget": widget.ChildWidgets.Count > 0 ? widget.ChildWidgets[widget.ChildWidgets.Count - 1] : null, "lineIndex": selectionEndIndex, "endElement": endElement };
                }
                else
                    return null;
            }
            else {
                if (end.Offset == end.Paragraph._GetLength() + 1)
                    selectionEndIndex = endInline.Length + 1;
                var endElementObj = endInline._GetElementBoxInternal(selectionEndIndex);
                endElement = endElementObj.element;
                selectionEndIndex = endElementObj.index;
                if (endElement == null)
                    return { "lineWidget": endInline._GetLineWidget(selectionEndIndex), "lineIndex": selectionEndIndex, "endElement": endElement };
                return { "lineWidget": endElement.CurrentLineWidget, "lineIndex": selectionEndIndex, "endElement": endElement };
            }
        };
        ParagraphAdv.prototype._HasValidInline = function (start, end) {
            for (var i = this.Inlines._IndexOf(start); i < this.Inlines.Count; i++) {
                var inline = this.Inlines[i];
                if (inline.Length == 0)
                    continue;
                if (inline == end)
                    return false;
                if (inline instanceof SpanAdv || inline instanceof ImageAdv
                    || (inline instanceof FieldCharacterAdv && inline._IsLinkedFieldCharacter()))
                    return true;
            }
            return false;
        };
        ParagraphAdv.prototype._GetPreviousValidOffset = function (offset) {
            if (offset == 0)
                return 0;
            var validOffset = 0;
            var count = 0;
            for (var i = 0; i < this.Inlines.Count; i++) {
                var inline = this.Inlines[i];
                if (inline.Length == 0)
                    continue;
                if (offset <= count + inline.Length)
                    return offset - 1 == count ? validOffset : offset - 1;
                if (inline instanceof SpanAdv || inline instanceof ImageAdv
                    || (inline instanceof FieldCharacterAdv && inline._IsLinkedFieldCharacter()))
                    validOffset = count + inline.Length;
                count += inline.Length;
            }
            return offset - 1 == count ? validOffset : offset - 1;
        };
        ParagraphAdv.prototype._GetEndOffset = function () {
            var startOffset = 0;
            var count = 0;
            for (var i = 0; i < this.Inlines.Count; i++) {
                var inline = this.Inlines[i];
                if (this.Inlines.length == 0)
                    continue;
                if (inline instanceof SpanAdv || inline instanceof ImageAdv || inline instanceof CommentCharacterAdv
                    || (inline instanceof FieldCharacterAdv && inline._IsLinkedFieldCharacter()))
                    startOffset = count + inline.Length;
                count += inline.Length;
            }
            return startOffset;
        };
        ParagraphAdv.prototype._GetNextStartInline = function (offset) {
            var indexInInline = 0;
            var inlineObj = this._GetInline(offset, indexInInline);
            var inline = inlineObj.inline;
            indexInInline = inlineObj.index;
            if (inline != null && indexInInline == inline.Length && inline.NextNode instanceof FieldCharacterAdv) {
                var nextValidInline = inline.NextNode._GetNextValidInline();
                if (nextValidInline instanceof FieldBeginAdv)
                    inline = nextValidInline;
            }
            return inline;
        };
        ParagraphAdv.prototype._GetNextValidOffset = function (offset) {
            var count = 0;
            for (var i = 0; i < this.Inlines.Count; i++) {
                var inline = this.Inlines[i];
                if (inline.Length == 0)
                    continue;
                if (offset < count + inline.Length) {
                    if (inline instanceof SpanAdv || inline instanceof ImageAdv
                        || (inline instanceof FieldCharacterAdv && inline._IsLinkedFieldCharacter()))
                        return (offset > count ? offset : count) + 1;
                }
                count += inline.Length;
            }
            return offset;
        };
        ParagraphAdv.prototype._GetSelectedContent = function (selection, start, end) {
            if (start.Paragraph.IsInsideTable && (!end.Paragraph.IsInsideTable
                || start.Paragraph.AssociatedCell != end.Paragraph.AssociatedCell
                || start.Paragraph.AssociatedCell._IsCellSelected(start, end))) {
                return start.Paragraph.AssociatedCell._GetSelectedContentAsHtmlInternal(selection, start, end);
            }
            else {
                return this._GetSelectedContentAsHtml(selection, start, end);
            }
        };
        ParagraphAdv.prototype._GetSelectedContentAsHtml = function (selection, start, end) {
            var html = "";
            var inline = null, startInline = null, endInline = null;
            var startInlineIndex = 0, endInlineIndex = 0;
            var listLevel = null;
            if (this.ParagraphFormat.ListFormat != null)
                listLevel = this.ParagraphFormat.ListFormat.ListLevel;
            if (end.Paragraph == this) {
                if (end.Paragraph._IsEmpty()) {
                    if (end.Offset = this._GetStartOffset())
                        return "";
                    if (listLevel != null) {
                        html += this._GetHtmlList(listLevel, start);
                        html += "<li ";
                    }
                    else
                        html += "<p ";
                    html += this.ParagraphFormat._GetAsHtmlStyle() + "/>";
                    if (html.indexOf("<ul") > -1)
                        html += "</ul>";
                    else if (html.indexOf("<ol") > -1)
                        html += "</ol>";
                    return html;
                }
                var inlineInfo = this._GetInline(end.Offset, 0);
                endInline = inlineInfo.inline;
                endInlineIndex = inlineInfo.index;
            }
            if (start.Paragraph == this) {
                if (start.Offset == this._GetLength() + 1) {
                }
                else {
                    if (listLevel != null) {
                        html += this._GetHtmlList(listLevel, start);
                        html += "<li ";
                    }
                    else
                        html += "<p ";
                    html += this.ParagraphFormat._GetAsHtmlStyle() + ">";
                    if (!this._IsEmpty()) {
                        var inlineInfo = this._GetInline(start.Offset, 0);
                        inline = startInline = inlineInfo.inline;
                        startInlineIndex = inlineInfo.index;
                    }
                }
            }
            else {
                if (listLevel != null) {
                    html += this._GetHtmlList(listLevel, start);
                    html += "<li ";
                }
                else
                    html += "<p ";
                html += this.ParagraphFormat._GetAsHtmlStyle() + ">";
                if (this.Inlines.Count > 0)
                    inline = this.Inlines[0];
            }
            var currentParagraph = this;
            if (inline == null && html != null)
                html += "&nbsp;";
            while (inline != null) {
                if (inline instanceof SpanAdv) {
                    html += "<span ";
                    html += inline.CharacterFormat._GetAsHtmlStyle();
                    html += ">";
                    if (endInline == inline) {
                        if (endInline == startInline)
                            html += this._DecodeHtmlNames(inline.Text.substring(startInlineIndex, endInlineIndex));
                        else
                            html += this._DecodeHtmlNames(inline.Text.substring(0, endInlineIndex));
                    }
                    else if (startInline == inline)
                        html += this._DecodeHtmlNames(inline.Text.substring(startInlineIndex, startInline.Length));
                    else
                        html += this._DecodeHtmlNames(inline.Text);
                    html += "</span>";
                }
                else if (inline instanceof ImageAdv) {
                    html += "<img ";
                    html += "width=\"" + inline.Width + "\" ";
                    html += "height=\"" + inline.Height + "\" ";
                    html += "src=\"" + inline.ImageString + "\" ";
                    html += inline.CharacterFormat._GetAsHtmlStyle();
                    html += "/>";
                }
                else if (inline instanceof FieldBeginAdv && inline._IsLinkedFieldCharacter()) {
                    var fieldCode = inline._GetFieldCode();
                    var fieldCodeLower = fieldCode.toLowerCase();
                    var index = fieldCodeLower.indexOf("hyperlink");
                    if (index > -1) {
                        fieldCode = fieldCode.substr(index + 9).trim();
                        html += "<a href=" + fieldCode + ">";
                    }
                    inline = inline.fieldSeparator;
                }
                else if (inline instanceof FieldEndAdv && inline._IsLinkedFieldCharacter()) {
                    var fieldCode = inline.FieldBegin._GetFieldCode();
                    var fieldCodeLower = fieldCode.toLowerCase();
                    var index = fieldCodeLower.indexOf("hyperlink");
                    if (index > -1) {
                        html += "</a>";
                    }
                }
                currentParagraph = inline.OwnerParagraph;
                if (inline == endInline)
                    break;
                inline = inline.NextNode;
            }
            if (html != "") {
                if (listLevel != null) {
                    html += "</li>";
                    if (html.indexOf("<ul") > -1)
                        html += "</ul>";
                    else if (html.indexOf("<ol") > -1)
                        html += "</ol>";
                }
                else
                    html += "</p>";
            }
            if (end.Paragraph != currentParagraph) {
                var block = this._GetNextRenderedBlock();
                if (block != null)
                    html += block._GetSelectedContentAsHtml(selection, start, end);
            }
            return html;
        };
        ParagraphAdv.prototype._GetContentAsHtml = function () {
            var listLevel = null;
            if (this.ParagraphFormat.ListFormat != null)
                listLevel = this.ParagraphFormat.ListFormat.ListLevel;
            var html = "";
            if (listLevel != null) {
                html += this._GetHtmlList(listLevel, null);
                html += "<li ";
            }
            else
                html += "<p ";
            html += this.ParagraphFormat._GetAsHtmlStyle();
            html += ">";
            if (this.Inlines.length == 0)
                html += "&nbsp;";
            for (var i = 0; i < this.Inlines.length; i++) {
                var inline = this.Inlines[i];
                if (inline instanceof SpanAdv) {
                    html += "<span ";
                    html += inline.CharacterFormat._GetAsHtmlStyle();
                    html += ">";
                    html += this._DecodeHtmlNames(inline.Text);
                    html += "</span>";
                }
                else if (inline instanceof ImageAdv) {
                    html += "<img ";
                    html += "width=\"" + inline.Width + "\" ";
                    html += "height=\"" + inline.Height + "\" ";
                    html += "src=\"" + inline.ImageString + "\" ";
                    html += inline.CharacterFormat._GetAsHtmlStyle();
                    html += "/>";
                }
            }
            if (listLevel != null) {
                html += "</li>";
                if (html.indexOf("<ul") > -1)
                    html += "</ul>";
                else if (html.indexOf("<ol") > -1)
                    html += "</ol>";
            }
            else
                html += "</p>";
            return html;
        };
        ParagraphAdv.prototype._GetHtmlList = function (listLevel, start) {
            var html = "";
            if (listLevel.ListLevelPattern == ListLevelPattern.Bullet) {
                html += "<ul type=\"";
                switch (listLevel.NumberFormat) {
                    case ListLevelAdv.SQUAREBULLET:
                        if (listLevel.CharacterFormat.FontFamily != null && listLevel.CharacterFormat.FontFamily == "Wingdings")
                            html += "square";
                        break;
                    case ListLevelAdv.DOTBULLET:
                        if (listLevel.CharacterFormat.FontFamily != null && listLevel.CharacterFormat.FontFamily == "Symbol")
                            html += "disc";
                        break;
                    case ListLevelAdv.CIRCLEBULLET:
                        if (listLevel.CharacterFormat.FontFamily != null && listLevel.CharacterFormat.FontFamily == "Symbol")
                            html += "circle";
                        break;
                }
                html += "\">";
            }
            else {
                html += "<ol type=\"";
                switch (listLevel.ListLevelPattern) {
                    case ListLevelPattern.Number:
                    case ListLevelPattern.Arabic:
                    case ListLevelPattern.Ordinal:
                        html += "1";
                        break;
                    case ListLevelPattern.LowLetter:
                        html += "a";
                        break;
                    case ListLevelPattern.UpLetter:
                        html += "A";
                        break;
                    case ListLevelPattern.LowRoman:
                        html += "i";
                        break;
                    case ListLevelPattern.UpRoman:
                        html += "I";
                        break;
                }
                html += "\" start=\"" + listLevel.StartAt.toString() + "\">";
            }
            return html;
        };
        ParagraphAdv.prototype._GetBodyWidgetOfPreviousBlock = function (index) {
            index = 0;
            var prevBodyWidget = null;
            var prevWidget = null;
            if (this.PreviousBlock instanceof ParagraphAdv) {
                prevWidget = this.PreviousBlock.ParagraphWidgets[this.PreviousBlock.ParagraphWidgets.Count - 1];
                prevBodyWidget = (prevWidget.ContainerWidget instanceof BodyWidget) ? prevWidget.ContainerWidget : null;
                index = prevBodyWidget.ChildWidgets._IndexOf(prevWidget);
            }
            else if (this.PreviousBlock instanceof TableAdv) {
                prevWidget = this.PreviousBlock.TableWidgets[this.PreviousBlock.TableWidgets.Count - 1];
                prevBodyWidget = (prevWidget.ContainerWidget instanceof BodyWidget) ? prevWidget.ContainerWidget : null;
                index = prevBodyWidget.ChildWidgets._IndexOf(prevWidget);
            }
            return { prevBodyWidget: prevBodyWidget, index: index };
        };
        ParagraphAdv.prototype._GetLineWidgetToClear = function (viewer, inline, prevElement) {
            var index = this.Inlines._IndexOf(inline);
            var startLineWidget = null;
            if (index > 0) {
                var prevInline = this.Inlines[index - 1];
                prevElement = prevInline._GetPreviousElementBox();
                if (prevElement != null)
                    startLineWidget = prevElement.CurrentLineWidget;
            }
            if (startLineWidget == null && this.paragraphWidgets[0].ChildWidgets.Count > 0)
                startLineWidget = this.paragraphWidgets[0].ChildWidgets[0];
            return {
                prevElement: prevElement,
                startLineWidget: startLineWidget
            };
        };
        ParagraphAdv.prototype._UpdateListItems = function (block) {
            if (this == block)
                return true;
            else {
                var document_3 = this.Document;
                var currentList = null;
                var listLevelNumber = 0;
                if (this.ParagraphFormat != null && this.ParagraphFormat.ListFormat != null) {
                    currentList = this.ParagraphFormat.ListFormat.List;
                    listLevelNumber = this.ParagraphFormat.ListFormat.ListLevelNumber;
                }
                if (currentList != null && currentList.AbstractList != null
                    && currentList.AbstractList.Levels[listLevelNumber] != null) {
                    var currentListLevel = currentList._GetListLevel(listLevelNumber);
                    if (currentListLevel.ListLevelPattern != ListLevelPattern.Bullet)
                        document_3._GetListNumber(this.ParagraphFormat.ListFormat);
                }
            }
            return false;
        };
        ParagraphAdv.prototype._UpdateListParagraphs = function () {
            if (this.Document != null && this.ParagraphFormat != null && this.ParagraphFormat.ListFormat != null && this.ParagraphFormat.ListFormat.List != null)
                this.Document.ListParagraphs._Add(this);
        };
        ParagraphAdv.prototype._UpdateRenderedListItems = function () {
            if (this.ParagraphFormat.ListFormat.List != null) {
                var document_4 = this.Document;
                var currentList = this.ParagraphFormat.ListFormat.List;
                var listLevelNumber = this.ParagraphFormat.ListFormat.ListLevelNumber;
                if (currentList != null && currentList.AbstractList != null
                    && currentList.AbstractList.Levels[this.ParagraphFormat.ListFormat.ListLevelNumber] != null) {
                    var currentListLevel = currentList._GetListLevel(listLevelNumber);
                    if (currentListLevel.ListLevelPattern != ListLevelPattern.Bullet) {
                        var element = null;
                        if (this.paragraphWidgets.Count > 0 && this.paragraphWidgets[0].ChildWidgets.Count > 0) {
                            var lineWidget = this.paragraphWidgets[0].ChildWidgets[0];
                            if (lineWidget.Children.Count > 0)
                                element = lineWidget.Children[0];
                        }
                        if (element != null)
                            element.Text = document_4._GetListNumber(this.ParagraphFormat.ListFormat);
                    }
                }
            }
        };
        ParagraphAdv.prototype._SplitParagraph = function (startOffset, endOffset) {
            var paragraph = new ParagraphAdv(null);
            paragraph.ParagraphFormat._CopyFormat(this.ParagraphFormat);
            paragraph.CharacterFormat._CopyFormat(this.CharacterFormat);
            this._MoveInlines(paragraph, 0, startOffset, endOffset);
            if (this.Owner instanceof CommentAdv) {
                var index = this.Owner.Blocks.indexOf(this);
                this.Owner.Blocks._Insert(index, paragraph);
                return paragraph;
            }
            var insertIndex = this._GetIndexInOwnerCollection();
            this.Owner.ChildNodes._Insert(insertIndex, paragraph);
            return paragraph;
        };
        ParagraphAdv.prototype._SplitParagraphInternal = function (offset) {
            var insertIndex = 0;
            var paragraph = new ParagraphAdv(null);
            if (offset == this._GetLength()) {
                paragraph.ParagraphFormat._CopyFormat(this.ParagraphFormat);
                paragraph.CharacterFormat._CopyFormat(this.CharacterFormat);
                insertIndex++;
            }
            else {
                paragraph.ParagraphFormat._CopyFormat(this.ParagraphFormat);
                paragraph.CharacterFormat._CopyFormat(this.CharacterFormat);
                if (offset > 0)
                    this._MoveInlines(paragraph, 0, 0, offset);
            }
            if (this.Owner instanceof CommentAdv) {
                insertIndex += this.Owner.Blocks._IndexOf(this);
                this.Owner.Blocks._Insert(insertIndex, paragraph);
                return;
            }
            insertIndex += this._GetIndexInOwnerCollection();
            var owner = null;
            if (this.Owner instanceof CompositeNode)
                owner = this.Owner;
            if (owner != null)
                owner.ChildNodes._Insert(insertIndex, paragraph);
        };
        ParagraphAdv.prototype._MoveInlines = function (paragraph, insertIndex, startOffset, endOffset) {
            var count = 0;
            for (var i = 0; i < this.Inlines.Count; i++) {
                var inline = this.Inlines[i];
                if (startOffset >= count + inline.Length) {
                    count += inline.Length;
                    continue;
                }
                var startIndex = 0;
                if (startOffset > count)
                    startIndex = (startOffset - count);
                var endIndex = (endOffset - count);
                if (endIndex > inline.Length)
                    endIndex = inline.Length;
                if (startIndex > 0)
                    count += startIndex;
                if (startIndex == 0 && endIndex == inline.Length) {
                    paragraph.Inlines._Insert(insertIndex, inline);
                    insertIndex++;
                    i--;
                }
                else if (inline instanceof SpanAdv) {
                    var span = new SpanAdv(null);
                    span.CharacterFormat._CopyFormat(inline.CharacterFormat);
                    span.Text = inline.Text.substring(startIndex, endIndex - startIndex);
                    paragraph.Inlines._Insert(insertIndex, span);
                    insertIndex++;
                    inline.Text = inline.Text.slice(endIndex - startIndex);
                }
                if (endOffset <= count + endIndex - startIndex)
                    break;
                count += endIndex - startIndex;
            }
        };
        ParagraphAdv.prototype._DeleteSelectedContent = function (selection, start, end, editAction) {
            var indexInInline = 0;
            var inlineObj = start.Paragraph._GetInline(start.Offset, indexInInline);
            var inline = inlineObj.inline;
            indexInInline = inlineObj.index;
            if (inline != null)
                inline = inline._GetNextRenderedInline(indexInInline);
            if (inline instanceof FieldBeginAdv && inline.fieldEnd != null) {
                var fieldEndOffset = inline.fieldEnd.OwnerParagraph._GetOffset(inline.fieldEnd, 1);
                var fieldEndIndex = inline.fieldEnd.OwnerParagraph._GetHierarchicalIndex(fieldEndOffset.toString());
                var selectionEndIndex = end._GetHierarchicalIndexInternal();
                if (!TextPosition._IsForwardSelection(fieldEndIndex, selectionEndIndex)) {
                    start._MoveToInline(inline.fieldSeparator, 1);
                    selection.EditPosition = start._GetHierarchicalIndexInternal();
                    if (selection.CurrentBaseHistoryInfo != null)
                        selection.CurrentBaseHistoryInfo.InsertPosition = selection.EditPosition;
                }
            }
            indexInInline = 0;
            inlineObj = end.Paragraph._GetInline(end.Offset, indexInInline);
            inline = inlineObj.inline;
            indexInInline = inlineObj.index;
            if (inline != null)
                inline = inline._GetNextRenderedInline(indexInInline);
            if (inline instanceof FieldEndAdv && inline.FieldBegin != null) {
                var fieldBeginOffset = inline.FieldBegin.OwnerParagraph._GetOffset(inline.FieldBegin, 0);
                var fieldBeginIndex = inline.FieldBegin.OwnerParagraph._GetHierarchicalIndex(fieldBeginOffset.toString());
                var selectionStartIndex = start._GetHierarchicalIndexInternal();
                if (!TextPosition._IsForwardSelection(selectionStartIndex, fieldBeginIndex)) {
                    var prevInline = inline._GetPreviousTextInline();
                    if (prevInline == null)
                        end._MoveBackward();
                    else
                        end._MoveToInline(prevInline, prevInline.Length);
                }
            }
            if (start.Paragraph != this) {
                start.Paragraph._DeleteSelectedContent(selection, start, end, editAction);
                return;
            }
            if (start.Paragraph.IsInsideTable && (!end.Paragraph.IsInsideTable
                || start.Paragraph.AssociatedCell != end.Paragraph.AssociatedCell
                || start.Paragraph.AssociatedCell._IsCellSelected(start, end)))
                start.Paragraph.AssociatedCell._Delete(selection, start, end, editAction);
            else
                this._Delete(selection, start, end, editAction);
        };
        ParagraphAdv.prototype._Delete = function (selection, start, end, editAction) {
            var paragraphStart = this._GetStartOffset();
            var endParagraphStartOffset = end.Paragraph._GetStartOffset();
            var startOffset = paragraphStart;
            var isCombineNextParagraph = false;
            var length = this._GetLength();
            var currentParagraph = this;
            var section = this.Section;
            if (this == start.Paragraph) {
                startOffset = start.Offset;
                if (end.Paragraph.IsInsideTable)
                    isCombineNextParagraph = this._IsEndInAdjacentTable(end.Paragraph);
            }
            if (this != start.Paragraph && selection.IsSkipLayouting)
                selection.IsSkipLayouting = false;
            var block = this._GetNextRenderedBlock();
            if (startOffset > paragraphStart && startOffset == length && (this == end.Paragraph && end.Offset == startOffset + 1
                || block == end.Paragraph && end.Offset == endParagraphStartOffset))
                isCombineNextParagraph = true;
            if (startOffset > paragraphStart && (end.Paragraph != this || end.Offset > length)) {
                if (editAction == 4)
                    return;
                else {
                    currentParagraph = this._SplitParagraph(0, startOffset);
                    this._RemoveBlock();
                    selection.CurrentBaseHistoryInfo.RemovedNodes._Add(this);
                }
                if (block != null && end.Paragraph != this
                    && !(block == end.Paragraph && end.Offset == endParagraphStartOffset)) {
                    var nextSection = block.Section;
                    if (section != nextSection) {
                        if (editAction < 4)
                            section._CombineSection(selection, nextSection);
                        if (editAction > 2)
                            selection._CopySectionFormat(section);
                    }
                    block._Delete(selection, start, end, editAction);
                }
            }
            else if (end.Paragraph == this && end.Offset <= length) {
                if (end.Offset > paragraphStart)
                    this._RemoveInlines(selection, startOffset, end.Offset, editAction);
            }
            else {
                var newParagraph = null;
                var previousBlock = this.PreviousBlock;
                var prevParagraph = (previousBlock instanceof ParagraphAdv) ? previousBlock : null;
                if (editAction < 4) {
                    if (this == end.Paragraph && this.NextBlock == null && prevParagraph == null) {
                        newParagraph = new ParagraphAdv(null);
                        if (editAction == 1) {
                            newParagraph.CharacterFormat._CopyFormat(this.CharacterFormat);
                            newParagraph.ParagraphFormat._CopyFormat(this.ParagraphFormat);
                        }
                        if (this.Owner instanceof CommentAdv)
                            this.Owner.Blocks._Add(newParagraph);
                        else if (this.Owner instanceof CompositeNode && this.Owner.ChildNodes instanceof BlockAdvCollection)
                            this.Owner.ChildNodes._Add(newParagraph);
                    }
                    this._RemoveBlock();
                    selection.CurrentBaseHistoryInfo.RemovedNodes._Add(this);
                    if (newParagraph != null) {
                        selection.EditPosition = newParagraph._GetHierarchicalIndex("0");
                        var offset = newParagraph._GetLength() + 1;
                        selection.CurrentBaseHistoryInfo.EndPosition = newParagraph._GetHierarchicalIndex(offset.toString());
                    }
                    else if (this == end.Paragraph && this.NextBlock == null && prevParagraph != null) {
                        if (block == null) {
                            var offset = prevParagraph._GetLength();
                            selection.EditPosition = prevParagraph._GetHierarchicalIndex(offset.toString());
                            selection.CurrentBaseHistoryInfo.InsertPosition = selection.EditPosition;
                            selection.CurrentBaseHistoryInfo.EndPosition = selection.EditPosition;
                        }
                        else {
                            var offset = this._GetLength() + 1;
                            if (block instanceof ParagraphAdv)
                                prevParagraph = block;
                            if (block instanceof TableAdv)
                                prevParagraph = block._GetFirstParagraphInFirstCell();
                            selection.EditPosition = prevParagraph._GetHierarchicalIndex("0");
                        }
                    }
                }
                if (end.Paragraph != this && block != null) {
                    var nextSection = block.Section;
                    if (section != nextSection) {
                        if (editAction < 4)
                            section._CombineSection(selection, nextSection);
                        if (editAction > 2)
                            selection._CopySectionFormat(section);
                    }
                    block._Delete(selection, start, end, editAction);
                }
            }
            if (selection.OwnerControl.History.IsUndoing || selection.OwnerControl.History.IsRedoing) {
                var nextParagraph = currentParagraph._GetNextParagraph();
                if (nextParagraph == end.Paragraph && this == start.Paragraph
                    && selection.CurrentBaseHistoryInfo.Action == Actions.Paste) {
                    var insertIndex = 0;
                    for (var i = 0; i < currentParagraph.Inlines.Count; i++) {
                        var inline = currentParagraph.Inlines[i];
                        i--;
                        nextParagraph.Inlines._Insert(insertIndex, inline);
                        insertIndex++;
                    }
                    currentParagraph._RemoveBlock();
                    isCombineNextParagraph = false;
                    var offset = selection.EditPosition.substring(selection.EditPosition.lastIndexOf(";") + 1);
                    selection.EditPosition = nextParagraph._GetHierarchicalIndex(offset);
                }
            }
            if (isCombineNextParagraph)
                currentParagraph._DeleteParagraphMark(selection, editAction);
        };
        ParagraphAdv.prototype._DeleteParagraphMark = function (selection, editAction) {
            var nextParagraph = this._GetNextParagraph();
            if (this.IsInsideTable && this.NextBlock == null || nextParagraph == null)
                return;
            var section = this.Section;
            var table = null;
            if (this._GetNextRenderedBlock() instanceof TableAdv)
                table = this._GetNextRenderedBlock();
            else
                table = null;
            if (nextParagraph.IsInsideTable && table != null && table._Contains(nextParagraph.AssociatedCell)) {
                if (editAction < 4) {
                    var nextSection = table.Section;
                    if (section != nextSection)
                        section._CombineSection(selection, nextSection);
                    var offset = 0;
                    for (var i = this.Inlines.Count - 1; i >= 0; i--) {
                        var inline = this.Inlines[i];
                        offset += inline.Length;
                        nextParagraph.Inlines._Insert(0, inline);
                    }
                    this._RemoveBlock();
                    if (offset > 0)
                        selection.EditPosition = nextParagraph._GetHierarchicalIndex(offset.toString());
                }
            }
            else {
                if (editAction < 4) {
                    var nextSection = nextParagraph.Section;
                    if (section != nextSection)
                        section._CombineSection(selection, nextSection);
                    for (var i = 0; i < nextParagraph.Inlines.Count; i++) {
                        var inline = nextParagraph.Inlines[i];
                        i--;
                        this.Inlines._Add(inline);
                    }
                    nextParagraph._RemoveBlock();
                    selection.CurrentBaseHistoryInfo.RemovedNodes._Add(nextParagraph);
                }
            }
        };
        ParagraphAdv.prototype._IsEndInAdjacentTable = function (endParagraph) {
            var start = this._GetHierarchicalIndex("");
            var end = endParagraph._GetHierarchicalIndex("");
            var selectionStart = start.split(";");
            var selectionEnd = end.split(";");
            return selectionStart.length < selectionEnd.length;
        };
        ParagraphAdv.prototype._InsertParagraph = function (paragraph, offset, insertAfter) {
            if (insertAfter) {
                var length_1 = this._GetLength();
                this._MoveInlines(paragraph, paragraph.Inlines.Count, offset, length_1);
            }
            else if (offset > 0)
                this._MoveInlines(paragraph, 0, 0, offset);
            if (this.Owner instanceof CommentAdv) {
                var index = this.Owner.Blocks._IndexOf(this);
                if (insertAfter)
                    index++;
                this.Owner.Blocks._Insert(index, paragraph);
                return;
            }
            var insertIndex = this._GetIndexInOwnerCollection();
            if (insertAfter)
                insertIndex++;
            this.Owner.ChildNodes._Insert(insertIndex, paragraph);
        };
        ParagraphAdv.prototype._RemoveInlines = function (selection, startOffset, endOffset, editAction) {
            var count = 0;
            for (var i = 0; i < this.Inlines.Count; i++) {
                var inline = this.Inlines[i];
                if (startOffset >= count + inline.Length) {
                    count += inline.Length;
                    continue;
                }
                var startIndex = 0;
                if (startOffset > count)
                    startIndex = startOffset - count;
                var endIndex = endOffset - count;
                if (endIndex > inline.Length)
                    endIndex = inline.Length;
                if (startIndex > 0)
                    count += startIndex;
                if (startIndex == 0 && endIndex == inline.Length) {
                    if (editAction < 4) {
                        if (inline instanceof CommentCharacterAdv && !(selection.OwnerControl.History.IsUndoing || selection.OwnerControl.History.IsRedoing))
                            selection.RemovedCommentCharacters._Add(inline);
                        this.Inlines._Remove(inline);
                        i--;
                        selection.CurrentBaseHistoryInfo.RemovedNodes._Add(inline);
                    }
                }
                else if (inline instanceof SpanAdv) {
                    if (editAction < 4) {
                        var span = new SpanAdv(null);
                        span.CharacterFormat._CopyFormat(inline.CharacterFormat);
                        span.Text = inline.Text.substr(startIndex, endIndex - startIndex);
                        selection.CurrentBaseHistoryInfo.RemovedNodes._Add(span);
                        inline.Text = inline.Text.slice(0, startIndex) + inline.Text.slice(endIndex);
                    }
                }
                if (endOffset <= count + endIndex - startIndex)
                    break;
                count += endIndex - startIndex;
            }
        };
        ParagraphAdv.prototype._RemoveAtOffset = function (baseHistoryInfo, offset) {
            var count = 0;
            for (var i = 0; i < this.Inlines.Count; i++) {
                var inline = this.Inlines[i];
                if (offset < count + inline.Length) {
                    var indexInInline = offset - count;
                    if (offset == count && inline.Length == 1) {
                        this.Inlines._Remove(inline);
                        baseHistoryInfo.RemovedNodes._Add(inline);
                    }
                    else {
                        var span = new SpanAdv(this);
                        span.CharacterFormat._CopyFormat(inline.CharacterFormat);
                        span.Text = inline.Text.substr(indexInInline, 1);
                        inline.Text = HelperMethods._Remove(inline.Text, indexInInline, 1);
                        baseHistoryInfo.RemovedNodes._Add(span);
                    }
                    break;
                }
                count += inline.Length;
            }
        };
        ParagraphAdv.prototype._ClearLineWidgets = function (viewer, startLineWidget, prevElement) {
            if (this.paragraphWidgets[0].ChildWidgets == null || this.paragraphWidgets[0].ChildWidgets.Count == 0) {
                if (this.paragraphWidgets[0].ContainerWidget != null
                    && this.paragraphWidgets[0].ContainerWidget.ChildWidgets._Contains(this.paragraphWidgets[0])) {
                    this.paragraphWidgets[0].ContainerWidget.ChildWidgets._Remove(this.paragraphWidgets[0]);
                    this.paragraphWidgets[0].ContainerWidget.Height -= this.paragraphWidgets[0].Height;
                }
                viewer._CutFromTop(this.paragraphWidgets[0].Y);
                return;
            }
            var top = startLineWidget.CurrentParagraphWidget.Y;
            var left = viewer.ClientActiveArea.X;
            var paraWidgetIndex = this.paragraphWidgets._IndexOf(startLineWidget.CurrentParagraphWidget);
            for (var i = paraWidgetIndex; i < this.paragraphWidgets.Count; i++) {
                var paragraphWidget = this.paragraphWidgets[i];
                if (paragraphWidget.ContainerWidget != null
                    && paragraphWidget.ContainerWidget.ChildWidgets._Contains(paragraphWidget)) {
                    paragraphWidget.ContainerWidget.ChildWidgets._Remove(paragraphWidget);
                    paragraphWidget.ContainerWidget.Height -= paragraphWidget.Height;
                }
                if (i == paraWidgetIndex) {
                    paraWidgetIndex = -1;
                    var lineIndex = paragraphWidget.ChildWidgets._IndexOf(startLineWidget);
                    for (var j = lineIndex; j < paragraphWidget.ChildWidgets.Count; j++) {
                        var lineWidget = paragraphWidget.ChildWidgets[j];
                        if (j == lineIndex) {
                            lineIndex = -1;
                            left += lineWidget._ClearChildWidgets(viewer, prevElement);
                        }
                        else
                            lineWidget._Dispose();
                        if (paragraphWidget.ChildWidgets == null)
                            break;
                        if (paragraphWidget.ChildWidgets._Contains(lineWidget)) {
                            paragraphWidget.ChildWidgets._Remove(lineWidget);
                            paragraphWidget.Height -= paragraphWidget.ChildWidgets.Count == 0 ? paragraphWidget.Height : lineWidget.Height;
                        }
                        j--;
                    }
                    top += paragraphWidget.Height;
                }
                else {
                    paragraphWidget._Dispose();
                    this.paragraphWidgets._Remove(paragraphWidget);
                    i--;
                }
            }
            viewer._CutFromTop(top);
            viewer._CutFromLeft(left);
        };
        ParagraphAdv.prototype._ShiftWidgets = function (viewer) {
            var index = 0;
            var prevBodyObj = this._GetBodyWidgetOfPreviousBlock(index);
            var prevBodyWidget = prevBodyObj.prevBodyWidget;
            index = prevBodyObj.index;
            var prevWidget = null;
            for (var i = 0; i < this.paragraphWidgets.Count; i++) {
                var widget = this.paragraphWidgets[i];
                if (prevWidget != null) {
                    widget._ShiftToPreviousWidget(viewer, prevWidget);
                    if (widget.ChildWidgets == null || widget.ChildWidgets.Count == 0) {
                        i--;
                        continue;
                    }
                    prevWidget = null;
                    if (prevBodyWidget != widget.ContainerWidget)
                        prevBodyWidget = widget.ContainerWidget;
                }
                if (viewer instanceof FlowLayoutViewer || viewer.CurrentComment != null) {
                    var point = new Point(widget.X, viewer.ClientActiveArea.Y);
                    widget.X = point.X;
                    widget.Y = point.Y;
                    viewer._CutFromTop(viewer.ClientActiveArea.Y + widget.Height);
                }
                else if (widget._IsFitInClientArea(viewer)) {
                    prevWidget = widget;
                    widget.Y = viewer.ClientActiveArea.Y;
                    viewer._CutFromTop(viewer.ClientActiveArea.Y + widget.Height);
                    if (prevBodyWidget != widget.ContainerWidget) {
                        index++;
                        widget._UpdateContainerWidget(prevBodyWidget, index);
                    }
                }
                else {
                    var isSplittedToNewPage = widget._SplitWidget(viewer, prevBodyWidget, index + 1);
                    prevWidget = null;
                    if (prevBodyWidget != widget.ContainerWidget) {
                        prevBodyWidget = widget.ContainerWidget;
                        i--;
                    }
                    index = prevBodyWidget.ChildWidgets._IndexOf(widget);
                    if (isSplittedToNewPage)
                        prevBodyWidget = this.paragraphWidgets[i + 1].ContainerWidget;
                }
            }
        };
        ParagraphAdv.prototype._RelayoutParagraph = function (startIndex) {
            var baseParent = this.BaseParent;
            var document = this.Document;
            if (document != null && document.OwnerControl != null && document.OwnerControl.Selection.IsSkipLayouting)
                return;
            if (this._IsInComment())
                this._GetOwnerComment()._Relayout();
            else if (baseParent != null) {
                var section = this.Section;
                var ownerDocument = section.Document;
                var viewer = ownerDocument.OwnerControl.Viewer;
                if (viewer.FieldEndParagraph != null && viewer.FieldEndParagraph.BaseParent == null)
                    viewer.FieldEndParagraph = this;
                if (viewer.FieldToLayout != null) {
                    var ownerParagraph = viewer.FieldToLayout.OwnerParagraph;
                    var fieldBegin = viewer.FieldToLayout;
                    viewer.FieldToLayout = null;
                    if (ownerParagraph != null && ownerParagraph.BaseParent != null) {
                        startIndex = fieldBegin._GetIndexInOwnerCollection();
                        if (ownerParagraph != this) {
                            ownerParagraph._RelayoutParagraph(startIndex);
                            return;
                        }
                        if (startIndex == 0 && this.ParagraphWidgets.Count == 0) {
                            this._Layout();
                            return;
                        }
                    }
                }
                if (viewer.BlockToShift == this)
                    this._Layout();
                if (ownerDocument.OwnerControl.IsLayoutEnabled) {
                    if (viewer.Pages.Count == 0)
                        viewer._CreateNewPage(section);
                    if (this.IsInsideTable) {
                        var cell = this.AssociatedCell._GetContainerCell();
                        cell.OwnerRow._Layout(viewer, false);
                    }
                    else {
                        viewer._UpdateClientArea(section.SectionFormat);
                        if ((ownerDocument.OwnerControl.IsDocumentLoaded) && !ownerDocument.OwnerControl.IsPastingContent)
                            ownerDocument._UpdateListItems(this);
                        viewer._UpdateClientAreaForBlock(this, true);
                        if (!this._IsEmpty() && startIndex > 0) {
                            var inline = this.Inlines[startIndex];
                            var prevElement = null;
                            var lineObj = this._GetLineWidgetToClear(viewer, inline, prevElement);
                            var lineWidget = lineObj.startLineWidget;
                            prevElement = lineObj.prevElement;
                            if (lineWidget != null) {
                                this._UpdateListItems(null);
                                var currentNode = null;
                                if (lineWidget.CurrentParagraphWidget.CurrentNode instanceof ParagraphAdv)
                                    currentNode = lineWidget.CurrentParagraphWidget.CurrentNode;
                                if (currentNode != null)
                                    currentNode._ClearLineWidgets(viewer, lineWidget, prevElement);
                                inline._RelayoutItems(viewer);
                                return;
                            }
                        }
                        this._Relayout(viewer, section);
                    }
                }
            }
        };
        ParagraphAdv.prototype._GetNextValidCharacterFormat = function (inline) {
            var startInline = inline._GetNextTextInline();
            if (startInline == null)
                return inline.OwnerParagraph.CharacterFormat;
            var fieldBegin = null;
            if (startInline instanceof FieldBeginAdv)
                fieldBegin = startInline;
            if (fieldBegin == null)
                return startInline.CharacterFormat;
            else
                return this._GetNextValidCharacterFormatofField(fieldBegin);
        };
        ParagraphAdv.prototype._GetNextValidCharacterFormatofField = function (fieldBegin) {
            var startInline = fieldBegin;
            if (fieldBegin._IsLinkedFieldCharacter()) {
                if (fieldBegin.fieldSeparator == null)
                    startInline = fieldBegin.fieldEnd;
                else
                    startInline = fieldBegin.fieldSeparator;
            }
            var nextValidInline = null;
            if (startInline.NextNode != null)
                nextValidInline = startInline.NextNode._GetNextValidInline();
            if (nextValidInline == null) {
                return startInline.OwnerParagraph.CharacterFormat;
            }
            return nextValidInline.CharacterFormat;
        };
        ParagraphAdv.prototype._GetCharacterFormatForSelection = function (selection, start, end) {
            if (start.Paragraph.IsInsideTable && (!end.Paragraph.IsInsideTable
                || start.Paragraph.AssociatedCell != end.Paragraph.AssociatedCell
                || start.Paragraph.AssociatedCell._IsCellSelected(start, end)))
                start.Paragraph.AssociatedCell._GetCharacterFormat(selection, start, end);
            else
                this._GetCharacterFormat(selection, start, end);
        };
        ParagraphAdv.prototype._GetCharacterFormat = function (selection, start, end) {
            if (this != start.Paragraph && this != end.Paragraph) {
                this._GetCharacterFormatInternal(selection);
                return;
            }
            if (end.Paragraph == this && start.Paragraph != this && end.Offset == 0)
                return;
            var startOffset = 0;
            var length = this._GetLength();
            if (this == start.Paragraph) {
                startOffset = start.Offset;
                var index = 0;
                var inlineAndIndex = this._GetInline(startOffset, index);
                index = inlineAndIndex.index;
                var inline = inlineAndIndex.inline;
                if (startOffset < length) {
                    if (selection.IsEmpty) {
                        if (inline instanceof SpanAdv || inline instanceof FieldBeginAdv || inline instanceof FieldEndAdv)
                            selection.CharacterFormat._CopyFormat(inline.CharacterFormat);
                        else {
                            if (inline._GetPreviousTextInline() != null)
                                selection.CharacterFormat._CopyFormat(inline._GetPreviousTextInline().CharacterFormat);
                            else if (inline._GetNextTextInline() != null)
                                selection.CharacterFormat._CopyFormat(inline._GetNextTextInline().CharacterFormat);
                            else
                                selection.CharacterFormat._CopyFormat(this.CharacterFormat);
                        }
                        return;
                    }
                    else {
                        if (index == inline.Length && inline.NextNode != null)
                            selection.CharacterFormat._CopyFormat(this._GetNextValidCharacterFormat(inline));
                        else if (inline instanceof SpanAdv)
                            selection.CharacterFormat._CopyFormat(inline.CharacterFormat);
                        else if (inline instanceof FieldBeginAdv)
                            selection.CharacterFormat._CopyFormat(this._GetNextValidCharacterFormatofField(inline));
                    }
                }
                else {
                    if (length == end.Offset) {
                        if (inline instanceof SpanAdv || inline instanceof FieldEndAdv)
                            selection.CharacterFormat._CopyFormat(inline.CharacterFormat);
                        else if ((inline = inline._GetPreviousTextInline()) != null)
                            selection.CharacterFormat._CopyFormat(inline.CharacterFormat);
                        else
                            selection.CharacterFormat._CopyFormat(this.CharacterFormat);
                        return;
                    }
                }
            }
            var endOffset = end.Offset;
            if (this != end.Paragraph)
                endOffset = length;
            var count = 0;
            var isFieldStartSelected = false;
            for (var i = 0; i < this.Inlines.Count; i++) {
                var inline = this.Inlines[i];
                if (startOffset >= count + inline.Length) {
                    count += inline.Length;
                    continue;
                }
                if (inline instanceof FieldBeginAdv && inline._IsLinkedFieldCharacter()) {
                    var nextInline = inline.fieldSeparator == null ? inline.fieldEnd : inline.fieldSeparator;
                    do {
                        count += inline.Length;
                        inline = inline.NextNode;
                        i++;
                    } while (inline != nextInline);
                    isFieldStartSelected = true;
                }
                if (inline instanceof FieldEndAdv && inline._IsLinkedFieldCharacter() && isFieldStartSelected) {
                    var fieldInline = inline.FieldBegin;
                    do {
                        selection.CharacterFormat._CombineFormat(fieldInline.CharacterFormat);
                        fieldInline = fieldInline.NextNode;
                    } while (!(fieldInline instanceof FieldEndAdv));
                }
                if (inline instanceof SpanAdv)
                    selection.CharacterFormat._CombineFormat(inline.CharacterFormat);
                if (endOffset <= count + inline.Length)
                    break;
                count += inline.Length;
            }
            if (end.Paragraph == this)
                return;
            var block = this._GetNextRenderedBlock();
            if (block != null)
                block._GetCharacterFormat(selection, start, end);
        };
        ParagraphAdv.prototype._GetCharacterFormatInternal = function (selection) {
            for (var i = 0; i < this.Inlines.Count; i++) {
                if (!(this.Inlines[i] instanceof ImageAdv)) {
                    var inline = this.Inlines[i];
                    selection.CharacterFormat._CombineFormat(inline.CharacterFormat);
                }
            }
        };
        ParagraphAdv.prototype._GetCharacterFormatofTextPostion = function (start) {
            var startOffset = start.Offset;
            var index = 0;
            var inlineObj = this._GetInline(startOffset, index);
            var inline = inlineObj.inline;
            index = inlineObj.index;
            if (inline != null && index == inline.Length && inline.NextNode != null)
                return this._GetNextValidCharacterFormat(inline);
            else if (inline != null && inline instanceof FieldBeginAdv)
                return this._GetNextValidCharacterFormat(inline);
            else if (inline != null)
                return inline.CharacterFormat;
            return null;
        };
        ParagraphAdv.prototype._GetParagraphFormat = function (selection) {
            selection.ParagraphFormat._CombineFormat(this.ParagraphFormat);
        };
        ParagraphAdv.prototype._GetParagraphFormatInternal = function (selection, start, end) {
            if (start.Paragraph == this)
                selection.ParagraphFormat._CopyFormat(this.ParagraphFormat);
            else
                selection.ParagraphFormat._CombineFormat(this.ParagraphFormat);
            if (end.Paragraph == this)
                return;
            var block = this._GetNextRenderedBlock();
            if (block != null)
                block._GetParagraphFormatInternal(selection, start, end);
        };
        ParagraphAdv.prototype._GetParagraphFormatForSelection = function (selection, start, end) {
            if (start.Paragraph.IsInsideTable && (!end.Paragraph.IsInsideTable
                || start.Paragraph.AssociatedCell != end.Paragraph.AssociatedCell
                || start.Paragraph.AssociatedCell._IsCellSelected(start, end)))
                start.Paragraph.AssociatedCell._GetParagraphFormatInternal(selection, start, end);
            else
                this._GetParagraphFormatInternal(selection, start, end);
        };
        ParagraphAdv.prototype._Relayout = function (viewer, section) {
            if (this.ParagraphWidgets == null)
                return;
            var bodyWidget = null;
            var containerWidget = this.paragraphWidgets[0].ContainerWidget;
            if (containerWidget instanceof BodyWidget)
                bodyWidget = containerWidget;
            this._PreservePreviousElements(viewer);
            if (bodyWidget == null)
                viewer._CutFromTop(this.ParagraphWidgets.Count > 0 ? this.ParagraphWidgets[0].Y : viewer.ClientArea.Top);
            else {
                var widgetIndex = bodyWidget.ChildWidgets._IndexOf(this.ParagraphWidgets[0]);
                if (widgetIndex > 0)
                    viewer._CutFromTop(this.ParagraphWidgets[0].Y);
                else {
                    var bodyWidgets = this.Section.BodyWidgets;
                    var bodyWidgetIndex = bodyWidgets._IndexOf(bodyWidget);
                    if (bodyWidgetIndex > 0) {
                        bodyWidget = bodyWidgets[bodyWidgetIndex - 1];
                        var lastWidget = bodyWidget.ChildWidgets[bodyWidget.ChildWidgets.Count - 1];
                        viewer._CutFromTop(lastWidget.Y + lastWidget.Height);
                    }
                }
            }
            this._ClearWidgets();
            if (viewer.Pages.Count == 0) {
                viewer._CreateNewPage(section);
                viewer._UpdateClientAreaForBlock(this, true);
            }
            this._LayoutItems(viewer);
            viewer._UpdateClientAreaForBlock(this, false);
            this._LayoutNextItems(viewer);
        };
        ParagraphAdv.prototype._PreservePreviousElements = function (viewer) {
            if (this.paragraphWidgets.Count > 0) {
                var paragraphWidget = this.paragraphWidgets[0];
                if (paragraphWidget.ChildWidgets.Count > 0) {
                    var lineWidget = paragraphWidget.ChildWidgets[0];
                    var left = viewer.ClientActiveArea.X;
                    left += lineWidget._PreservePreviousElements(viewer);
                    var firstLineIndent = 0;
                    firstLineIndent = paragraphWidget.CurrentNode.ParagraphFormat.FirstLineIndent;
                    if (left - firstLineIndent != viewer.ClientActiveArea.X) {
                        this._UpdateListItems(null);
                        viewer._CutFromLeft(left);
                    }
                }
            }
        };
        ParagraphAdv.prototype._CombineParagraphWidgets = function (cellWidget) {
            if (this.paragraphWidgets.Count == 0)
                return;
            var paragraphWidget = this.ParagraphWidgets[0];
            if (!cellWidget.ChildWidgets._Contains(paragraphWidget))
                paragraphWidget._UpdateContainerWidgetForCell(cellWidget);
            if (this.paragraphWidgets.Count == 1)
                return;
            for (var i = 1; i < this.paragraphWidgets.Count; i++) {
                var widget = this.paragraphWidgets[i];
                widget._ShiftChildsToWidget(paragraphWidget);
                i--;
            }
        };
        ParagraphAdv.prototype._RemoveSelectedContent = function (selection, start, end) {
            if (end.Paragraph.IsInsideTable
                && end.Paragraph != end.Paragraph.AssociatedCell.OwnerTable._GetLastParagraphInLastCell()
                && (!start.Paragraph.IsInsideTable || start.Paragraph.AssociatedCell.OwnerTable != end.Paragraph.AssociatedCell.OwnerTable))
                return false;
            selection.OwnerControl.IsShiftingEnabled = true;
            this._DeleteSelectedContent(selection, start, end, 2);
            return true;
        };
        ParagraphAdv.prototype._ApplyCharacterFormatForSelection = function (selection, start, end, property, value, update) {
            selection.OwnerControl.IsLayoutEnabled = false;
            if (start.Paragraph.IsInsideTable && (!end.Paragraph.IsInsideTable
                || start.Paragraph.AssociatedCell != end.Paragraph.AssociatedCell
                || start.Paragraph.AssociatedCell._IsCellSelected(start, end)))
                start.Paragraph.AssociatedCell._ApplyCharacterFormat(selection, start, end, property, value, update);
            else
                this._ApplyCharacterFormat(selection, start, end, property, value, update);
        };
        ParagraphAdv.prototype._GetCurrentSelectionValue = function (selection, property, value) {
            if ((property == CharacterFormat.BoldProperty || property == CharacterFormat.ItalicProperty)) {
                var selectionRange = selection.CurrentSelectionRange;
                var index = 0;
                var start = selectionRange.Start;
                if (!selectionRange.IsForward)
                    start = selectionRange.End;
                var paragraph = start.Paragraph;
                var inlineObj = paragraph._GetInline(start.Offset, index);
                var inline = inlineObj.inline;
                index = inlineObj.index;
                var characterformat = this.CharacterFormat;
                if (inline != null) {
                    if (index == inline.Length)
                        characterformat = inline.NextNode == null ? this.CharacterFormat : inline.NextNode.CharacterFormat;
                    else
                        characterformat = inline.CharacterFormat;
                }
                if (property == CharacterFormat.BoldProperty)
                    value = !(characterformat.Bold);
                if (property == CharacterFormat.ItalicProperty)
                    value = !(characterformat.Italic);
            }
            return value;
        };
        ParagraphAdv.prototype._ApplyCharacterFormatForCell = function () { };
        ParagraphAdv.prototype._ApplyCharacterFormatForSel = function (selection, property, value, update) {
            for (var i = 0; i < this.Inlines.Count; i++) {
                this.Inlines[i].CharacterFormat._ApplyPropertyValue(selection.CurrentBaseHistoryInfo, property, value, update);
            }
            this.CharacterFormat._ApplyPropertyValue(selection.CurrentBaseHistoryInfo, property, value, update);
        };
        ParagraphAdv.prototype._StartSelectionRelayouting = function (selection, start, end) {
            selection.OwnerControl.IsLayoutEnabled = true;
            if (start.Paragraph.IsInsideTable) {
                var table = start.Paragraph.AssociatedCell.OwnerTable;
                while (table.IsInsideTable)
                    table = table.AssociatedCell.OwnerTable;
                table._RelayoutSelection(selection, start, end);
            }
            else
                this._RelayoutSelection(selection, start, end);
        };
        ParagraphAdv.prototype._RelayoutWithIndex = function (startIndex) {
            var baseParent = this.BaseParent;
            var document = this.Document;
            if (document != null && document.OwnerControl != null && document.OwnerControl.Selection.IsSkipLayouting)
                return;
            if (this._IsInComment())
                this._GetOwnerComment()._Relayout();
            else if (baseParent != null) {
                var section = this.Section;
                var ownerDocument = section.Document;
                var viewer = ownerDocument.OwnerControl.Viewer;
                if (viewer.FieldEndParagraph != null && viewer.FieldEndParagraph.BaseParent == null)
                    viewer.FieldEndParagraph = this;
                if (viewer.FieldToLayout != null) {
                    var ownerParagraph = viewer.FieldToLayout.OwnerParagraph;
                    var fieldBegin = viewer.FieldToLayout;
                    viewer.FieldToLayout = null;
                    if (ownerParagraph != null && ownerParagraph.BaseParent != null) {
                        startIndex = fieldBegin._GetIndexInOwnerCollection();
                        if (ownerParagraph != this) {
                            ownerParagraph._RelayoutWithIndex(startIndex);
                            return;
                        }
                        if (startIndex == 0 && this.ParagraphWidgets.Count == 0) {
                            this._Layout();
                            return;
                        }
                    }
                }
                if (viewer.BlockToShift == this)
                    this._Layout();
                else if (ownerDocument.OwnerControl.IsLayoutEnabled) {
                    if (viewer.Pages.Count == 0)
                        viewer._CreateNewPage(section);
                    if (this.IsInsideTable) {
                        var cell = this.AssociatedCell._GetContainerCell();
                    }
                    else {
                        viewer._UpdateClientArea(section.SectionFormat);
                        if ((ownerDocument.OwnerControl.IsDocumentLoaded))
                            ownerDocument._UpdateListItems(this);
                        viewer._UpdateClientAreaForBlock(this, true);
                        if (!this._IsEmpty() && startIndex > 0) {
                            var inline = this.Inlines[startIndex];
                            var prevElement = null;
                            var lineWidgetObj = this._GetLineWidgetToClear(viewer, inline, prevElement);
                            var lineWidget = lineWidgetObj.startLineWidget;
                            prevElement = lineWidgetObj.prevElement;
                            if (lineWidget != null) {
                                this._UpdateListItems(null);
                                var currentNode = null;
                                if (lineWidget.CurrentParagraphWidget.CurrentNode instanceof ParagraphAdv)
                                    currentNode = lineWidget.CurrentParagraphWidget.CurrentNode;
                                if (currentNode != null)
                                    currentNode._ClearLineWidgets(viewer, lineWidget, prevElement);
                                inline._RelayoutItems(viewer);
                                return;
                            }
                        }
                        this._Relayout(viewer, section);
                    }
                }
            }
        };
        ParagraphAdv.prototype._RelayoutSelection = function (selection, start, end) {
            if (start.Paragraph == this) {
                var startOffset = start.Offset;
                var length_2 = this._GetLength();
                var indexInInline = 0;
                var index = 0;
                var inlineObj = this._GetInline(start.Offset, indexInInline);
                var inline = inlineObj.inline;
                indexInInline = inlineObj.index;
                if (inline != null) {
                    if (indexInInline == inline.Length && inline.NextNode != null)
                        inline = inline.NextNode;
                    index = inline._GetIndexInOwnerCollection();
                }
                if (inline instanceof SpanAdv && inline.Elements.Count == 0 && index > 0)
                    this._RelayoutWithIndex(index - 1);
                else
                    this._RelayoutWithIndex(index);
            }
            else
                this._RelayoutWithIndex(0);
            if (end.Paragraph == this)
                return true;
            var block = this._GetNextRenderedBlock();
            if (block != null)
                return block._RelayoutSelection(selection, start, end);
            return false;
        };
        ParagraphAdv.prototype._ApplyCharacterFormat = function (selection, start, end, property, value, update) {
            var startOffset = 0;
            var length = this._GetLength();
            if (selection != null && selection.SelectionRanges.Count > 0) {
                if (this == start.Paragraph) {
                    startOffset = start.Offset;
                    value = this._GetCurrentSelectionValue(selection, property, value);
                }
            }
            var endOffset = end.Offset;
            if (this != end.Paragraph) {
                this.CharacterFormat._ApplyPropertyValue(selection.CurrentBaseHistoryInfo, property, value, update);
                endOffset = length;
            }
            var count = 0;
            for (var i = 0; i < this.Inlines.Count; i++) {
                var inline = this.Inlines[i];
                if (startOffset >= count + inline.Length) {
                    count += inline.Length;
                    continue;
                }
                var startIndex = 0;
                if (startOffset > count)
                    startIndex = startOffset - count;
                var endIndex = endOffset - count;
                var inlineLength = inline.Length;
                if (endIndex > inlineLength)
                    endIndex = inlineLength;
                inline._ApplyCharacterFormat(selection, startIndex, endIndex, property, value, update);
                if (endOffset <= count + inlineLength)
                    break;
                count += inlineLength;
                if (startIndex > 0)
                    i++;
            }
            if (end.Paragraph == this) {
                if (endOffset == length + 1)
                    this.CharacterFormat._ApplyPropertyValue(selection.CurrentBaseHistoryInfo, property, value, update);
                return;
            }
            var block = this._GetNextRenderedBlock();
            if (block != null)
                block._ApplyCharacterFormat(selection, start, end, property, value, update);
        };
        ParagraphAdv.prototype._ApplyParagraphFormatForSelection = function (selection, start, end, property, value, update) {
            if (start.Paragraph.IsInsideTable && (!end.Paragraph.IsInsideTable
                || start.Paragraph.AssociatedCell != end.Paragraph.AssociatedCell
                || start.Paragraph.AssociatedCell._IsCellSelected(start, end)))
                start.Paragraph.AssociatedCell._ApplyParagraphFormat(selection, start, end, property, value, update);
            else
                this._ApplyParagraphFormat(selection, start, end, property, value, update);
        };
        ParagraphAdv.prototype._ApplyParagraphFormat = function (selection, start, end, property, value, update) {
            this.ParagraphFormat._ApplyPropertyValue(selection.CurrentBaseHistoryInfo, property, value, update);
            if (end.Paragraph == this)
                return;
            var block = this._GetNextRenderedBlock();
            if (block != null)
                block._ApplyParagraphFormat(selection, start, end, property, value, update);
        };
        ParagraphAdv.prototype._ApplyParagraphFormatInternal = function (selection, property, value, update) {
            this.ParagraphFormat._ApplyPropertyValue(selection.CurrentBaseHistoryInfo, property, value, update);
        };
        ParagraphAdv.prototype._ClearWidgets = function () {
            if (this.paragraphWidgets != null
                && this.paragraphWidgets.Count > 0) {
                for (var i = 0; i < this.paragraphWidgets.Count; i++) {
                    var widget = this.paragraphWidgets[i];
                    widget._Dispose();
                    this.paragraphWidgets._Remove(widget);
                    i--;
                }
            }
        };
        ParagraphAdv.prototype._Dispose = function () {
            this.CharacterFormat._Dispose();
            this.ParagraphFormat._Dispose();
            this._SetOwner(null);
            if (this.paragraphWidgets != null) {
                this._ClearWidgets();
                this.paragraphWidgets = null;
            }
            if (this.Inlines != null) {
                this.Inlines._Dispose();
                for (var i = 0; i < this.Inlines.Count; i++) {
                    var inline = this.Inlines[i];
                    inline._Dispose();
                    this.Inlines._Remove(inline);
                    i--;
                }
                this.ChildNodes = null;
            }
            this.Fields = null;
            this.FieldCharacter = null;
        };
        ParagraphAdv.prototype._DecodeHtmlNames = function (text) {
            if (text == "\t")
                return "&emsp;";
            var splittedText = text.split(" ");
            var htmlText = "";
            if (splittedText.length > 0) {
                htmlText = splittedText[0];
                for (var i = 0; i < splittedText.length - 1; i++) {
                    htmlText += "&nbsp;" + splittedText[i + 1];
                }
            }
            return htmlText;
        };
        return ParagraphAdv;
    }(BlockAdv));
    DocumentEditorFeatures.ParagraphAdv = ParagraphAdv;
    var Inline = (function (_super) {
        __extends(Inline, _super);
        function Inline(owner) {
            _super.call(this, owner);
            this.WordSplitCharacters = [' ', ',', '.', ':', ';', '<', '>', '=', '+', '-', '_', '{', '}', '[', ']', '`', '~', '!', '@', '#', '$', '%', '^', '&', '*', '(', ')', '"', '?', '/', '|', '\\', '”'];
            this.characterFormat = new CharacterFormat(this);
            this.Elements = new List();
        }
        Object.defineProperty(Inline.prototype, "CharacterFormat", {
            get: function () {
                return this.characterFormat;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(Inline.prototype, "OwnerParagraph", {
            get: function () {
                if (this.Owner instanceof ParagraphAdv)
                    return this.Owner;
                return null;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(Inline.prototype, "Length", {
            get: function () {
                return 1;
            },
            enumerable: true,
            configurable: true
        });
        Inline.prototype._RelayoutItems = function (viewer) {
            this._LayoutItems(viewer);
            var inline = this;
            while (inline.NextNode instanceof Inline) {
                inline = inline.NextNode;
                inline._LayoutItems(viewer);
            }
            this.OwnerParagraph._UpdateWidgetToPage(viewer);
            viewer._UpdateClientAreaForBlock(this.OwnerParagraph, false);
            this.OwnerParagraph._LayoutNextItems(viewer);
        };
        Inline.prototype._LayoutFieldCharacter = function (viewer) {
            if (this instanceof FieldBeginAdv) {
                var field = this;
                if (!viewer.IsFieldCode && (field.fieldEnd != null || field.HasFieldEnd)) {
                    viewer.FieldStack._Add(field);
                    viewer.IsFieldCode = true;
                }
            }
            else if (viewer.FieldStack.Count > 0) {
                if (this instanceof FieldSeparatorAdv) {
                    var field = viewer.FieldStack._Last();
                    var fieldLink = this;
                    if (field.fieldSeparator == fieldLink && (field.fieldEnd != null || field.HasFieldEnd))
                        viewer.IsFieldCode = false;
                }
                else {
                    var field = viewer.FieldStack._Last();
                    var instance = this;
                    if (field.fieldEnd == instance) {
                        viewer.FieldStack._RemoveAt(viewer.FieldStack.length - 1);
                        viewer.IsFieldCode = false;
                        if (field.HasFieldEnd)
                            field.HasFieldEnd = false;
                    }
                }
            }
        };
        Inline.prototype._LayoutItems = function (viewer) {
            if (this instanceof FieldCharacterAdv) {
                this._LayoutFieldCharacter(viewer);
                if (this.NextNode == null && !viewer.IsFieldCode) {
                    if (viewer.LineElements.length == 0)
                        this.OwnerParagraph._LayoutEmptyLineWidget(viewer);
                    else
                        this._MoveToNextLine(viewer);
                }
                return;
            }
            if (viewer.IsFieldCode)
                return;
            if (this.Elements == null)
                return;
            if (this.Elements.Count > 0)
                this.Elements._Clear();
            this._AddElementBox(viewer);
            if (this instanceof CommentCharacterAdv) {
                if (this.Elements != null && this.Elements.Count > 0)
                    viewer.LineElements._Add(this.Elements[0]);
                if (this.NextNode == null && !viewer.IsFieldCode) {
                    if (viewer.LineElements.Count == 0)
                        this.OwnerParagraph._LayoutEmptyLineWidget(viewer);
                    else
                        this._MoveToNextLine(viewer);
                }
                if (this instanceof CommentAdv && viewer instanceof PageLayoutViewer) {
                    var comment = this;
                    comment._LayoutCommentItems(viewer);
                }
                return;
            }
            var element = this.Elements[0];
            var text = "";
            var index = 0;
            var count = 0;
            if (this instanceof SpanAdv) {
                var inline = this;
                text = inline.Text;
            }
            while (count < this.Elements.Count) {
                if (this.Elements == null)
                    return;
                element = this.Elements[count];
                if (element instanceof TextElementBox && element == this.Elements[0]) {
                    TextHelper._GetTextSize(element, this.CharacterFormat);
                    if (text == "\t")
                        element.Width = this.OwnerParagraph._GetTabWidth(viewer);
                }
                if (viewer.CurrentComment == null && viewer.CurrentHeaderFooter == null && viewer instanceof PageLayoutViewer
                    && viewer.ClientActiveArea.Height < element.Height && viewer.ClientActiveArea.Y != viewer.ClientArea.Y)
                    this.OwnerParagraph._MoveToNextPage(viewer);
                var previoueInline = this.PreviousNode instanceof Inline ? this.PreviousNode : null;
                if (previoueInline != null && previoueInline instanceof SpanAdv && previoueInline.Text == "\v") {
                    this._MoveToNextLine(viewer);
                    element.Width = element.Width;
                }
                if (element.Width < viewer.ClientActiveArea.Width || !viewer.TextWrap)
                    this._AddElementToline(viewer, element);
                else if (element instanceof TextElementBox) {
                    if (element.Text == "\t") {
                        this._MoveToNextLine(viewer);
                        element.Width = this.OwnerParagraph._GetTabWidth(viewer);
                        this._AddElementToline(viewer, element);
                    }
                    else
                        this._SplitTextForClientArea(viewer, element, element.Text, element.Width, this.CharacterFormat);
                }
                else
                    this._SplitElementForClientArea(element, viewer);
                count = this.Elements._IndexOf(element) + 1;
                if (count >= this.Elements.Count && this.NextNode == null) {
                    this._MoveToNextLine(viewer);
                }
            }
        };
        Inline.prototype._GetSubWidth = function (viewer, justify, spaceCount, firstLineIndent) {
            var width = 0;
            var trimSpace = true;
            var lineText = "";
            for (var i = viewer.LineElements.length - 1; i >= 0; i--) {
                var element = viewer.LineElements[i];
                if (element instanceof TextElementBox) {
                    var elementText = element.Text;
                    lineText = elementText + lineText;
                    if (trimSpace && elementText.trim() != "") {
                        if (/ $/.test(elementText)) {
                            var trimSpaceAtEnd = elementText.replace(/\s\s*$/, '');
                            width += TextHelper._MeasureTextExcludIngSpaceAtEnd(trimSpaceAtEnd, this.CharacterFormat).Width;
                        }
                        else
                            width += element.Width;
                        trimSpace = false;
                    }
                    else if (!trimSpace)
                        width += element.Width;
                }
                else if (element instanceof CommentElementBox)
                    continue;
                else {
                    lineText = "a" + lineText;
                    trimSpace = false;
                    width += element.Width;
                }
                if (!justify)
                    width = Math.round(width);
            }
            lineText = lineText.trim();
            spaceCount = lineText.length - lineText.replace(/\s/g, "").length;
            var subWidth = (viewer.ClientArea.Width - firstLineIndent - width);
            if (subWidth <= 0 || (spaceCount == 0 && justify)) {
                spaceCount = 0;
                subWidth = 0;
            }
            else if (justify)
                subWidth = subWidth / spaceCount;
            return { "subWidth": subWidth, "spaceCount": spaceCount };
        };
        Inline.prototype._IsParagraphFirstLine = function (paragraph) {
            if (paragraph.ParagraphWidgets.length == 1) {
                var widget = paragraph.ParagraphWidgets[0];
                return widget.ChildWidgets == null || widget.ChildWidgets.length == 0;
            }
            return false;
        };
        Inline.prototype._IsParagraphLastLine = function (viewer, paragraph) {
            var lastInline = paragraph.Inlines[paragraph.Inlines.length - 1];
            if (this == lastInline)
                return lastInline.Elements.Count == 0 || viewer.LineElements._Contains(lastInline.Elements[lastInline.Elements.Count - 1]);
            return false;
        };
        Inline.prototype._AlignLineElements = function (viewer, element, topMargin, bottomMargin, maxDescent, addSubWidth, subWidth, textAlignment, whiteSpaceCount, isLastElement) {
            if (element instanceof TextElementBox || element instanceof ListTextElementBox) {
                var textElement = element instanceof TextElementBox ? element : null;
                var baselineOffset = element instanceof TextElementBox ? textElement.BaselineOffset : element.BaselineOffset;
                topMargin += viewer.LineElements.MaxBaselineOffset - baselineOffset;
                bottomMargin += maxDescent - (element.Height - baselineOffset);
                if (textElement != null && textAlignment == TextAlignment.Justify && whiteSpaceCount > 0) {
                    var width = textElement.Width;
                    var text = textElement.Text;
                    if (!addSubWidth) {
                        text = text.replace(/^\s\s*/, '');
                        addSubWidth = (text.length > 0);
                    }
                    if (addSubWidth) {
                        var spaceCount = text.length - text.replace(/\s/g, "").length;
                        if (isLastElement)
                            spaceCount -= text.length - text.replace(/\s\s*$/, '').length;
                        if (whiteSpaceCount < spaceCount) {
                            width = TextHelper._MeasureTextExcludIngSpaceAtEnd(text, this.CharacterFormat).Width;
                            spaceCount = whiteSpaceCount;
                        }
                        if (spaceCount > 0) {
                            textElement.Width = width + subWidth * spaceCount;
                            whiteSpaceCount -= spaceCount;
                        }
                    }
                }
            }
            else if (element instanceof CommentElementBox) {
                element.Height = viewer.LineElements.MaxTextElementBaselineOffset;
                topMargin += viewer.LineElements.MaxBaselineOffset - element.Height;
                bottomMargin += maxDescent;
            }
            else {
                addSubWidth = true;
                topMargin += viewer.LineElements.MaxBaselineOffset - element.Height;
                bottomMargin += maxDescent;
            }
            return { "topMargin": topMargin, "bottomMargin": bottomMargin, "addSubWidth": addSubWidth, "whiteSpaceCount": whiteSpaceCount };
        };
        Inline.prototype._MoveToNextLine = function (viewer) {
            var ownerParagraph = this.Owner;
            var paraFormat = ownerParagraph.ParagraphFormat;
            var isParagraphStart = this._IsParagraphFirstLine(ownerParagraph);
            var isParagraphEnd = this._IsParagraphLastLine(viewer, ownerParagraph);
            var maxDescent = 0, afterSpacing = 0, beforeSpacing = 0, lineSpacing = 0, firstLineIndent = 0;
            if (isParagraphStart) {
                beforeSpacing = ownerParagraph._GetBeforeSpacing();
                firstLineIndent = paraFormat.FirstLineIndent;
            }
            if (isParagraphEnd)
                afterSpacing = paraFormat.AfterSpacing;
            var height = 0;
            if (isNaN(viewer.LineElements.MaxTextElementHeight)) {
                var measurement = TextHelper._MeasureText("a", ownerParagraph.CharacterFormat);
                height = measurement.Height;
                maxDescent = height - measurement.BaselineOffset;
            }
            else {
                height = viewer.LineElements.MaxTextElementHeight;
                maxDescent = height - viewer.LineElements.MaxTextElementBaselineOffset;
            }
            if (viewer.CurrentComment == null && viewer.CurrentHeaderFooter == null && viewer instanceof PageLayoutViewer && viewer.ClientActiveArea.Height < beforeSpacing + viewer.LineElements.MaxBaselineOffset + maxDescent && viewer.ClientActiveArea.Y != viewer.ClientArea.Y)
                ownerParagraph._MoveToNextPage(viewer);
            lineSpacing = ownerParagraph._GetLineSpacing(height);
            if (paraFormat.LineSpacingType == LineSpacingType.Exactly
                && lineSpacing < maxDescent + viewer.LineElements.MaxBaselineOffset)
                lineSpacing = maxDescent + viewer.LineElements.MaxBaselineOffset;
            var subWidth = 0;
            var whiteSpaceCount = 0;
            var textAlignment = paraFormat.TextAlignment;
            if (textAlignment != TextAlignment.Left && viewer.TextWrap && !(textAlignment == TextAlignment.Justify && isParagraphEnd)) {
                var getWidthAndSpace = this._GetSubWidth(viewer, textAlignment == TextAlignment.Justify, whiteSpaceCount, firstLineIndent);
                subWidth = getWidthAndSpace.subWidth;
                whiteSpaceCount = getWidthAndSpace.spaceCount;
            }
            var line = this.OwnerParagraph._AddLineWidget();
            var addSubWidth = false;
            var lineSpacingType = paraFormat.LineSpacingType;
            for (var i = 0; i < viewer.LineElements.length; i++) {
                var topMargin = 0, bottomMargin = 0, leftMargin = 0;
                var elementBox = viewer.LineElements[i];
                var alignElements = this._AlignLineElements(viewer, elementBox, topMargin, bottomMargin, maxDescent, addSubWidth, subWidth, textAlignment, whiteSpaceCount, i == viewer.LineElements.length - 1);
                topMargin = alignElements.topMargin;
                bottomMargin = alignElements.bottomMargin;
                addSubWidth = alignElements.addSubWidth;
                whiteSpaceCount = alignElements.whiteSpaceCount;
                if (lineSpacingType == LineSpacingType.Multiple) {
                    if (lineSpacing > height)
                        bottomMargin += lineSpacing - height;
                    else
                        topMargin += lineSpacing - height;
                }
                else if (lineSpacingType == LineSpacingType.Exactly)
                    topMargin += lineSpacing - (topMargin + elementBox.Height + bottomMargin);
                else if (lineSpacing > topMargin + elementBox.Height + bottomMargin)
                    topMargin += lineSpacing - (topMargin + elementBox.Height + bottomMargin);
                topMargin += beforeSpacing;
                bottomMargin += afterSpacing;
                if (i == 0) {
                    line.Height = topMargin + elementBox.Height + bottomMargin;
                    if (textAlignment == TextAlignment.Right)
                        leftMargin = subWidth;
                    else if (textAlignment == TextAlignment.Center)
                        leftMargin = subWidth / 2;
                }
                elementBox.Margin = new Margin(leftMargin, topMargin, 0, bottomMargin);
                elementBox.CurrentLineWidget = line;
                line.Children._Add(elementBox);
            }
            viewer._CutFromTop(viewer.ClientActiveArea.Y + line.Height);
            viewer.LineElements._Clear();
        };
        Inline.prototype._AddElementToline = function (viewer, element) {
            var inline = this;
            if ((viewer instanceof FlowLayoutViewer || viewer.CurrentComment != null) && !(element instanceof TextElementBox)
                && viewer.ClientActiveArea.Width < element.Width)
                if (viewer instanceof FlowLayoutViewer)
                    viewer.HorizontalWidth = viewer.ClientActiveArea.X + element.Width + viewer.ClientArea.X;
                else
                    viewer.CurrentComment.LayoutedWidget.ContentWidth = viewer.ClientActiveArea.X + element.Width;
            viewer._CutFromLeft(viewer.ClientActiveArea.X + element.Width);
            if (this.OwnerParagraph.ParagraphFormat.TextAlignment == TextAlignment.Justify && element instanceof TextElementBox)
                this._SplitTextElementWordByWord(element, viewer);
            if (this instanceof ImageAdv)
                viewer.LineElements.SkipClipImage = !inline.IsInlineImage;
            viewer.LineElements.push(element);
        };
        Inline.prototype._CheckPreviousElement = function (viewer, characterFormat) {
            var isSplitByWord = false;
            var lastTextElement = 0;
            for (var i = viewer.LineElements.length - 1; i >= 0; i--) {
                if (viewer.LineElements[i] instanceof TextElementBox) {
                    var textElement = viewer.LineElements[i];
                    var text = textElement.Text;
                    lastTextElement = i;
                    if (/ $/.test(text)) {
                        if (i == viewer.LineElements.length - 1) {
                            this._MoveToNextLine(viewer);
                            return true;
                        }
                        isSplitByWord = true;
                        break;
                    }
                    else if (text.indexOf(" ") >= 0) {
                        isSplitByWord = true;
                        var index = text.lastIndexOf(' ') + 1;
                        var splittedElement = new TextElementBox(textElement.Inline);
                        splittedElement.Index = textElement.Index + index;
                        splittedElement.Length = textElement.Length - index;
                        textElement.Length -= splittedElement.Length;
                        this.Elements._Add(splittedElement);
                        TextHelper._GetTextSize(splittedElement, characterFormat);
                        textElement.Width -= splittedElement.Width;
                        textElement.Height = splittedElement.Height;
                        viewer.LineElements.splice(i + 1, 0, splittedElement);
                        break;
                    }
                }
                else if (viewer.LineElements[i] instanceof CommentElementBox)
                    continue;
                else {
                    lastTextElement = i;
                    isSplitByWord = true;
                    break;
                }
            }
            if (isSplitByWord) {
                while (lastTextElement < viewer.LineElements.length - 1 && viewer.LineElements[lastTextElement + 1].Inline instanceof CommentCharacterAdv)
                    lastTextElement++;
                lastTextElement++;
                var elements = new List();
                if (lastTextElement < viewer.LineElements.Count) {
                    var splitWidth = 0;
                    for (var i = lastTextElement; i < viewer.LineElements.Count; i++) {
                        splitWidth += viewer.LineElements[i].Width;
                        elements._Add(viewer.LineElements[i]);
                        viewer.LineElements.splice(i, 1);
                        i--;
                    }
                    viewer._UpdateClientWidth(splitWidth);
                }
                this._MoveToNextLine(viewer);
                if (elements.length > 0 && elements[0] instanceof TextElementBox && elements[0].Text == "\t")
                    elements[0].Width = this.OwnerParagraph._GetTabWidth(viewer);
                for (var i = 0; i < elements.length; i++) {
                    this._AddElementToline(viewer, elements[i]);
                }
                elements._Clear();
            }
            return isSplitByWord;
        };
        Inline.prototype._SplitTextForClientArea = function (viewer, element, text, width, charaterFormat) {
            var isSplitByWord = true;
            var index = -1;
            if (!(text.substring(0, 1) == " ")) {
                var textWidth = width;
                var characterUptoWS = 0;
                var matchedch = text.match(/.+?\s+/);
                if (matchedch != null && matchedch.length > 0) {
                    characterUptoWS = matchedch[0].length;
                }
                else
                    characterUptoWS = text.replace(/\s\s*$/, '').indexOf(' ') + 1;
                if ((index = characterUptoWS) > 0)
                    textWidth = TextHelper._MeasureTextExcludIngSpaceAtEnd(text.slice(0, index), charaterFormat).Width;
                if (viewer.ClientActiveArea.Width < textWidth) {
                    isSplitByWord = this._CheckPreviousElement(viewer, charaterFormat);
                    if (isSplitByWord)
                        isSplitByWord = textWidth <= viewer.ClientActiveArea.Width;
                }
            }
            else
                index = 1;
            if (width <= viewer.ClientActiveArea.Width)
                this._AddElementToline(viewer, element);
            else if (isSplitByWord && (index > 0 || text.indexOf(" ") > 0))
                this._SplitByWord(viewer, element, text, width, charaterFormat);
            else
                this._SplitByCharacter(viewer, element, text, width, charaterFormat);
        };
        Inline.prototype._SplitByWord = function (viewer, element, text, width, characterFormat) {
            var index = this._GetSplitIndexByWord(viewer.ClientActiveArea.Width, text, width, characterFormat);
            if (index > 0 && index < element.Length) {
                var splittedElement = new TextElementBox(element.Inline);
                text = text.substring(index);
                if (text[0] == ' ') {
                    var prevLength = text.length;
                    text = text.replace(/^\s\s*/, '');
                    index += prevLength - text.Length;
                }
                splittedElement.Index = element.Index + index;
                splittedElement.Length = element.Length - index;
                element.Length -= splittedElement.Length;
                this.Elements._Add(splittedElement);
                TextHelper._GetTextSize(splittedElement, characterFormat);
                element.Width -= splittedElement.Width;
                element.Height = splittedElement.Height;
                this._AddElementToline(viewer, element);
                this._MoveToNextLine(viewer);
            }
        };
        Inline.prototype._GetSplitIndexByWord = function (clientActiveWidth, text, width, charaterFormat) {
            var index = 0;
            var length = text.length;
            while (index < length) {
                var nextIndex = this._GetTextIndexAfterSpace(text, index);
                if (nextIndex == 0 || nextIndex == length)
                    nextIndex = length - 1;
                var splitWidth = width;
                if ((nextIndex < length - 1 || (nextIndex == length - 1 && text[nextIndex - 1] == ' ')) && index != nextIndex)
                    splitWidth = TextHelper._MeasureTextExcludIngSpaceAtEnd(text.slice(0, nextIndex), charaterFormat).Width;
                if (splitWidth <= clientActiveWidth)
                    index = nextIndex;
                else {
                    if (index == 0 && text[0] == ' ')
                        index = this._GetTextIndexAfterSpace(text, 0);
                    break;
                }
            }
            return index;
        };
        Inline.prototype._GetTextIndexAfterSpace = function (text, startIndex) {
            var length = text.length;
            var index = 0;
            var matchedch = text.substring(startIndex).match(/.+?\s+/);
            if (matchedch != null && matchedch.length > 0) {
                index = startIndex + matchedch[0].length;
            }
            else
                index = text.indexOf(' ', startIndex) + 1;
            var nextIndex = index;
            if (nextIndex == 0 || nextIndex == length)
                return nextIndex;
            while (text[nextIndex] == ' ') {
                nextIndex++;
                if (nextIndex == length)
                    break;
            }
            return nextIndex;
        };
        Inline.prototype._SplitByCharacter = function (viewer, textElement, text, width, characterFormat) {
            var index = this._GetTextSplitIndexByCharacter(viewer.ClientArea.Width, viewer.ClientActiveArea.Width, text, width, characterFormat);
            var splitWidth = 0;
            if (index < textElement.Length) {
                splitWidth = TextHelper._MeasureTextExcludIngSpaceAtEnd(text.substring(0, index), characterFormat).Width;
                text = text.substring(index);
            }
            if (splitWidth > viewer.ClientActiveArea.Width && viewer.LineElements.length > 0)
                this._MoveToNextLine(viewer);
            if (index < textElement.Length) {
                var splittedElement = new TextElementBox(textElement.Inline);
                splittedElement.Index = textElement.Index + index;
                splittedElement.Length = textElement.Length - index;
                textElement.Length -= splittedElement.Length;
                this.Elements._Add(splittedElement);
                TextHelper._GetTextSize(splittedElement, characterFormat);
                textElement.Width -= splittedElement.Width;
                textElement.Height = splittedElement.Height;
                this._AddElementToline(viewer, textElement);
                this._MoveToNextLine(viewer);
            }
            else
                this._AddElementToline(viewer, textElement);
        };
        Inline.prototype._GetTextSplitIndexByCharacter = function (totalClientWidth, clientActiveAreaWidth, text, width, charaterFormat) {
            var length = text.length;
            for (var i = 0; i < length; i++) {
                var splitWidth = width;
                if (i + 1 < length)
                    splitWidth = TextHelper._MeasureTextExcludIngSpaceAtEnd(text.substring(0, i + 1), charaterFormat).Width;
                if (splitWidth > clientActiveAreaWidth) {
                    if (i == 0 && splitWidth > totalClientWidth)
                        return (length > 1 && text[1] == ' ') ? this._GetTextIndexAfterSpace(text, 1) : 1;
                    return i;
                }
            }
            return 0;
        };
        Inline.prototype._SplitTextElementWordByWord = function (textElement, viewer) {
            var text = textElement.Text;
            var format;
            var characterUptoWs = text.trim().indexOf(" ");
            if (characterUptoWs <= 0) {
                var matchedch = text.match(/.+?\s+/);
                if (matchedch != null && matchedch.length > 0)
                    characterUptoWs = matchedch[0].length;
            }
            if (characterUptoWs >= 0) {
                format = this.CharacterFormat;
                var fontSize = format.FontSize;
                var baselineAlignment = format.BaselineAlignment;
                var isBold = format.Bold;
                var isItalic = format.Italic;
                var index = textElement.Length - text.replace(/^\s\s*/, '').length;
                while (index < textElement.Length) {
                    index = this._GetTextIndexAfterSpace(text, index);
                    if (index == 0 || index == textElement.Length)
                        break;
                    if (index < textElement.Length) {
                        var splittedElement = new TextElementBox(textElement.Inline);
                        var splittedText = text.substring(0, index);
                        text = text.substring(index);
                        if (text.substring(0, 1) == " ")
                            index += text.length - text.replace(/^\s\s*/, '').length;
                        splittedElement.Index = textElement.Index;
                        splittedElement.Length = index;
                        this.Elements.splice(this.Elements.indexOf(textElement), 0, splittedElement);
                        TextHelper._GetTextSize(splittedElement, format);
                        viewer.LineElements.push(splittedElement);
                        textElement.Index += index;
                        textElement.Length -= index;
                        textElement.Width -= splittedElement.Width;
                        index = 0;
                    }
                }
            }
        };
        Inline.prototype._SplitElementForClientArea = function (element, viewer) {
            if (viewer.LineElements.length > 0)
                this._MoveToNextLine(viewer);
            if (viewer.LineElements.length == 0) {
                this._AddElementToline(viewer, element);
            }
        };
        Inline.prototype._GetPhysicalPosition = function (index, moveNextLine) {
            if (this instanceof CommentCharacterAdv)
                return this._GetCommentCharacterPosition();
            var elementObj = this._GetElementBox(index, moveNextLine);
            var element = elementObj.element;
            index = elementObj.index;
            if (element == null || element.CurrentLineWidget == null) {
                if (this instanceof FieldCharacterAdv)
                    return this._GetFieldCharacterPosition();
                return new Point(0, 0);
            }
            var top = 0;
            var left = 0;
            top = element.CurrentLineWidget._GetTop();
            if (element instanceof ImageElementBox) {
                var format = this.OwnerParagraph.CharacterFormat;
                var previousInline = this._GetPreviousTextInline();
                if (previousInline != null)
                    format = previousInline.CharacterFormat;
                else {
                    var nextInline = this._GetNextTextInline();
                    if (nextInline != null)
                        format = nextInline.CharacterFormat;
                }
                var measureObj = TextHelper._MeasureText("a", format);
                var baselineOffset = measureObj.BaselineOffset;
                if (element.Margin.Top + element.Height - baselineOffset > 0)
                    top += element.Margin.Top + element.Height - baselineOffset;
            }
            else {
                top += element.Margin.Top > 0 ? element.Margin.Top : 0;
            }
            left = (element == null || element.CurrentLineWidget == null) ? 0 : element.CurrentLineWidget._GetLeftInternal(element, index);
            return new Point(left, top);
        };
        Inline.prototype._GetCommentCharacterPosition = function () {
            var startInline = this;
            var nextValidInline = null;
            if (startInline.NextNode != null)
                nextValidInline = startInline.NextNode._GetNextValidInline();
            if (nextValidInline == null) {
                var nextParagraph = startInline.OwnerParagraph;
                return nextParagraph._GetEndPosition();
            }
            else
                return nextValidInline._GetPhysicalPosition(0, true);
        };
        Inline.prototype._GetFieldCharacterPosition = function () {
            var startInline = this;
            if (this instanceof FieldBeginAdv && startInline._IsLinkedFieldCharacter()) {
                if (startInline.fieldSeparator == null)
                    startInline = startInline.fieldEnd;
                else
                    startInline = startInline.fieldSeparator;
            }
            var nextValidInline = null;
            if (startInline.NextNode != null)
                nextValidInline = startInline.NextNode._GetNextValidInline();
            if (nextValidInline == null) {
                var nextParagraph = startInline.OwnerParagraph;
                return nextParagraph._GetEndPosition();
            }
            else
                return nextValidInline._GetPhysicalPosition(0, true);
        };
        Inline.prototype._GetText = function (endParagraph, endInline, endIndex, includeObject) {
            var text = "";
            var inline = this;
            do {
                if (inline == endInline) {
                    if (inline instanceof SpanAdv) {
                        var span = inline;
                        if (!(span.Text == null || span.Text == "")) {
                            if (span.Text.length < endIndex)
                                text = text + span.Text;
                            else
                                text = text + span.Text.substring(0, endIndex);
                        }
                    }
                    else if (inline instanceof ImageAdv && includeObject && endIndex == inline.Length)
                        text = text + Inline.OBJECT_CHARACTER;
                    return text;
                }
                if (inline instanceof SpanAdv)
                    text = text + inline.Text;
                else if (inline instanceof ImageAdv && includeObject)
                    text = text + Inline.OBJECT_CHARACTER;
                else if (inline instanceof FieldBeginAdv && inline.fieldEnd != null) {
                    if (inline.fieldSeparator != null)
                        inline = inline.fieldSeparator;
                    else
                        inline = inline.fieldEnd;
                }
                if (inline.NextNode == null)
                    break;
                inline = inline.NextNode;
            } while (true);
            if (endParagraph == this.OwnerParagraph)
                return text;
            var nextParagraph = this.OwnerParagraph._GetNextParagraph();
            while (nextParagraph != null && nextParagraph._IsEmpty()) {
                text = text + "\r";
                if (nextParagraph == endParagraph)
                    return text;
                nextParagraph = nextParagraph._GetNextParagraph();
            }
            if (nextParagraph != null && !nextParagraph._IsEmpty())
                text = text + "\r" + nextParagraph.Inlines[0]._GetText(endParagraph, endInline, endIndex, includeObject);
            return text;
        };
        Inline.prototype._GetElementBox = function (index, moveToNextLine) {
            var element = null;
            if (this.Elements.Count > 0)
                element = this.Elements[this.Elements.Count - 1];
            if (element instanceof TextElementBox) {
                for (var i = 0; i < this.Elements.Count; i++) {
                    var length_3 = (this.Elements[i] instanceof TextElementBox) ? this.Elements[i].Length : 1;
                    if (length_3 >= index || (length_3 + 1 == index && i == this.Elements.Count - 1)) {
                        element = this.Elements[i];
                        if (moveToNextLine && index == length_3 && i < this.Elements.Count - 1 && element.CurrentLineWidget != this.Elements[i + 1].CurrentLineWidget) {
                            element = this.Elements[i + 1];
                            index = 0;
                        }
                        break;
                    }
                    index -= length_3;
                }
            }
            return { "index": index, "element": element };
        };
        Inline.prototype._GetElementBoxInternal = function (index) {
            var element = null;
            if (this.Elements.Count > 0)
                element = this.Elements[this.Elements.Count - 1];
            if (element instanceof TextElementBox) {
                for (var i = 0; i < this.Elements.Count; i++) {
                    var length_4 = (this.Elements[i] instanceof TextElementBox) ? this.Elements[i].Length : 1;
                    if (length_4 >= index || (length_4 + 1 == index && i == this.Elements.Count - 1)) {
                        element = this.Elements[i];
                        break;
                    }
                    index -= length_4;
                }
            }
            return {
                "element": element, "index": index
            };
        };
        Inline.prototype._GetPreviousTextInline = function () {
            if (this.PreviousNode instanceof SpanAdv)
                return this.PreviousNode;
            if (this.PreviousNode != null)
                return this.PreviousNode._GetPreviousTextInline();
            return null;
        };
        Inline.prototype._GetNextTextInline = function () {
            if (this.NextNode instanceof SpanAdv)
                return this.NextNode;
            if (this.NextNode instanceof FieldCharacterAdv && (this.NextNode._IsLinkedFieldCharacter())) {
                if (this.NextNode instanceof FieldEndAdv || this.NextNode instanceof FieldBeginAdv)
                    return this.NextNode;
                return this.NextNode.fieldEnd;
            }
            if (this.NextNode != null)
                return this.NextNode._GetNextTextInline();
            return null;
        };
        Inline.prototype._GetLineWidget = function (index) {
            return this._GetLineWidgetInternal(index, true);
        };
        Inline.prototype._GetLineWidgetInternal = function (index, moveToNextLine) {
            var elementObj = this._GetElementBox(index, moveToNextLine);
            var element = elementObj.element;
            index = elementObj.index;
            if (element != null)
                return element.CurrentLineWidget;
            var startInline = this;
            if (this instanceof FieldBeginAdv && startInline._IsLinkedFieldCharacter()) {
                if (startInline.fieldSeparator == null)
                    startInline = startInline.fieldEnd;
                else
                    startInline = startInline.fieldSeparator;
            }
            var nextValidInline = null;
            if (startInline.NextNode != null)
                nextValidInline = startInline.NextNode._GetNextValidInline();
            if (nextValidInline == null) {
                var nextParagraph = startInline.OwnerParagraph;
                var lineWidget = null;
                if (nextParagraph.ParagraphWidgets.Count > 0) {
                    var widget = nextParagraph.ParagraphWidgets[nextParagraph.ParagraphWidgets.Count - 1];
                    if (widget.ChildWidgets.Count > 0)
                        lineWidget = widget.ChildWidgets[widget.ChildWidgets.Count - 1];
                }
                return lineWidget;
            }
            else
                return nextValidInline._GetLineWidget(0);
        };
        Inline.prototype._GetCaretHeight = function (index, format, isEmptySelection, topMargin, isItalic) {
            var elementBoxInfo = this._GetElementBox(index, false);
            index = elementBoxInfo.index;
            var element = elementBoxInfo.element;
            var currentInline = this;
            if (element == null) {
                if (currentInline instanceof FieldCharacterAdv) {
                    return currentInline._GetFieldCharacterHeight(format, isEmptySelection, topMargin, isItalic);
                }
                return { "Height": TextHelper._MeasureText("a", format).Height, "TopMargin": topMargin, "IsItalic": isItalic };
            }
            var maxLineHeight = 0;
            if (element instanceof ImageElementBox || element instanceof CommentElementBox) {
                var previousInline = this._GetPreviousTextInline();
                var nextInline = this._GetNextTextInline();
                if (previousInline == null && nextInline == null) {
                    var top_2 = 0, bottom = 0;
                    var sizeInfo = this.OwnerParagraph._GetParagraphMarkSize(top_2, bottom);
                    top_2 = sizeInfo.TopMargin;
                    bottom = sizeInfo.BottomMargin;
                    maxLineHeight = sizeInfo.Height;
                    isItalic = this.OwnerParagraph.CharacterFormat.Italic;
                    if (!isEmptySelection)
                        maxLineHeight += this.OwnerParagraph.ParagraphFormat.AfterSpacing;
                }
                else if (previousInline == null) {
                    isItalic = nextInline.CharacterFormat.Italic;
                    return nextInline._GetCaretHeight(0, nextInline.CharacterFormat, isEmptySelection, topMargin, isItalic);
                }
                else {
                    if (nextInline != null && element instanceof ImageElementBox) {
                        var textSizeInfo = TextHelper._MeasureText("a", element.Inline.CharacterFormat);
                        var charHeight = textSizeInfo.Height;
                        var baselineOffset = textSizeInfo.BaselineOffset;
                        maxLineHeight = (element.Margin.Top < 0 && baselineOffset > element.Margin.Top + element.Height) ? element.Margin.Top + element.Height + charHeight - baselineOffset : charHeight;
                        if (!isEmptySelection)
                            maxLineHeight += element.Margin.Bottom;
                    }
                    else {
                        isItalic = previousInline.CharacterFormat.Italic;
                        return previousInline._GetCaretHeight(previousInline.Length, previousInline.CharacterFormat, isEmptySelection, topMargin, isItalic);
                    }
                }
            }
            else {
                var baselineAlignment = format.BaselineAlignment;
                var elementHeight = element.Height;
                if (baselineAlignment != BaselineAlignment.Normal && isEmptySelection) {
                    elementHeight = elementHeight / 1.5;
                    if (baselineAlignment == BaselineAlignment.Subscript)
                        topMargin = element.Height - elementHeight;
                }
                maxLineHeight = (element.Margin.Top < 0 ? element.Margin.Top : 0) + elementHeight;
                if (!isEmptySelection)
                    maxLineHeight += element.Margin.Bottom;
            }
            if (!isEmptySelection)
                return { "Height": maxLineHeight, "TopMargin": topMargin, "IsItalic": isItalic };
            var height = TextHelper._MeasureText("a", format).Height;
            if (height > maxLineHeight)
                height = maxLineHeight;
            return { "Height": height, "TopMargin": topMargin, "IsItalic": isItalic };
        };
        Inline.prototype._GetFieldCharacterHeight = function (format, isEmptySelection, topMargin, isItalic) {
            var startInline = this;
            if (startInline instanceof FieldBeginAdv && startInline._IsLinkedFieldCharacter()) {
                if (startInline.fieldSeparator == null)
                    startInline = startInline.fieldEnd;
                else
                    startInline = startInline.fieldSeparator;
            }
            var nextValidInline = null;
            if (startInline.NextNode != null)
                nextValidInline = startInline.NextNode._GetNextValidInline();
            if (nextValidInline == null) {
                var nextParagraph = startInline.OwnerParagraph;
                var height = TextHelper._GetParagraphMarkSize(format).Height;
                var top_3 = 0, bottom = 0;
                var sizeInfo = nextParagraph._GetParagraphMarkSize(top_3, bottom);
                var maxLineHeight = sizeInfo.Height;
                top_3 = sizeInfo.TopMargin;
                bottom = sizeInfo.BottomMargin;
                if (!isEmptySelection) {
                    maxLineHeight += bottom;
                    return { "Height": maxLineHeight, "TopMargin": topMargin, "IsItalic": isItalic };
                }
                if (height > maxLineHeight)
                    height = maxLineHeight;
                return { "Height": height, "TopMargin": topMargin, "IsItalic": isItalic };
            }
            else
                return nextValidInline._GetCaretHeight(0, format, isEmptySelection, topMargin, isItalic);
        };
        Inline.prototype._GetPreviousValidInline = function () {
            var inline = this;
            var previousValidInline = null;
            while (inline instanceof FieldCharacterAdv) {
                if (inline._IsLinkedFieldCharacter()) {
                    if (inline instanceof FieldBeginAdv)
                        previousValidInline = inline;
                    else if (inline instanceof FieldEndAdv) {
                        previousValidInline = inline;
                        if (inline.FieldSeparator == null) {
                            inline = inline.FieldBegin;
                            previousValidInline = inline;
                        }
                    }
                    else {
                        inline = inline.fieldBegin;
                        previousValidInline = inline;
                    }
                }
                inline = inline.PreviousNode;
            }
            return previousValidInline == null ? inline : previousValidInline;
        };
        Inline.prototype._ValidateTextPosition = function (index) {
            var inline = this;
            if (inline.Length == index && inline.NextNode instanceof FieldCharacterAdv) {
                var nextInline = inline.NextNode._GetNextValidInline();
                if (nextInline instanceof FieldEndAdv) {
                    inline = nextInline;
                    index = 1;
                }
            }
            else if (index == 0 && inline.PreviousNode instanceof FieldCharacterAdv) {
                var prevInline = inline.PreviousNode._GetPreviousValidInline();
                inline = prevInline;
                index = inline instanceof FieldCharacterAdv ? 0 : inline.Length;
                if (inline instanceof FieldEndAdv)
                    index++;
            }
            return {
                "inline": inline, "index": index
            };
        };
        Inline.prototype._GetNextValidInline = function () {
            var inline = this;
            var nextValidInline = null;
            while (inline instanceof FieldCharacterAdv) {
                if (inline instanceof FieldBeginAdv && inline.fieldEnd != null)
                    return nextValidInline == null ? inline : nextValidInline;
                else if (inline instanceof FieldEndAdv && inline.FieldBegin != null)
                    nextValidInline = inline;
                inline = inline.NextNode;
            }
            return nextValidInline == null ? inline : nextValidInline;
        };
        Inline.prototype._InsertInline = function (inline, index) {
            if (index == this.Length) {
                var insertIndex = this.OwnerParagraph.Inlines._IndexOf(this);
                insertIndex++;
                this.OwnerParagraph.Inlines._Insert(insertIndex, inline);
            }
            else if (index == 0) {
                if (this.PreviousNode == null)
                    this.OwnerParagraph.Inlines._Insert(0, inline);
                else {
                    var insertIndex = this.OwnerParagraph.Inlines._IndexOf(this);
                    this.OwnerParagraph.Inlines._Insert(insertIndex, inline);
                }
            }
            else {
                var node = this;
                var insertIndex = node.OwnerParagraph.Inlines.indexOf(this);
                insertIndex++;
                var span = new SpanAdv(null);
                span.CharacterFormat._CopyFormat(node.CharacterFormat);
                span.Text = node.Text.substring(index);
                node.Text = node.Text.substr(0, index);
                this.OwnerParagraph.Inlines._Insert(insertIndex, span);
                this.OwnerParagraph.Inlines._Insert(insertIndex, inline);
            }
        };
        Inline.prototype._IsLastRenderedInline = function (index) {
            var inline = this;
            while (index == inline.Length && inline.NextNode instanceof FieldCharacterAdv) {
                var nextValidInline = inline.NextNode._GetNextValidInline();
                index = 0;
                if (nextValidInline instanceof FieldBeginAdv)
                    inline = nextValidInline;
                if (inline instanceof FieldBeginAdv && inline.fieldEnd != null) {
                    var fieldBegin = inline;
                    if (fieldBegin.fieldSeparator == null) {
                        inline = fieldBegin.fieldEnd;
                        index = 1;
                    }
                    else {
                        inline = fieldBegin.fieldSeparator;
                        var paragraph = inline.OwnerParagraph;
                        index = 1;
                        if (paragraph == fieldBegin.fieldEnd.OwnerParagraph
                            && !paragraph._HasValidInline(inline, fieldBegin.fieldEnd))
                            inline = fieldBegin.fieldEnd;
                        else
                            break;
                    }
                }
            }
            return index == inline.Length && inline.NextNode == null;
        };
        Inline.prototype._GetNextRenderedInline = function (indexInInline) {
            var inline = this;
            if (inline instanceof FieldBeginAdv) {
                var fieldBegin = inline;
                inline = fieldBegin._GetRenderedField();
                if (fieldBegin == inline)
                    return fieldBegin;
                indexInInline = 1;
            }
            while (inline != null && indexInInline == inline.Length && inline.NextNode instanceof FieldCharacterAdv) {
                var nextValidInline = inline.NextNode._GetNextValidInline();
                if (nextValidInline instanceof FieldBeginAdv) {
                    var fieldBegin = null;
                    if (nextValidInline instanceof FieldBeginAdv)
                        fieldBegin = nextValidInline;
                    if (fieldBegin != null)
                        inline = fieldBegin._GetRenderedField();
                    if (inline != null && fieldBegin == inline)
                        return fieldBegin;
                    indexInInline = 1;
                }
                else
                    inline = nextValidInline;
            }
            return inline;
        };
        Inline.prototype._GetPreviousElementBox = function () {
            var prevInline = this;
            while (prevInline != null && prevInline.Elements.Count == 0) {
                if (prevInline instanceof FieldSeparatorAdv && prevInline._IsLinkedFieldCharacter())
                    prevInline = prevInline.fieldBegin;
                prevInline = prevInline.PreviousNode;
            }
            if (prevInline == null)
                return null;
            return prevInline.Elements.Count > 0 ? prevInline.Elements[prevInline.Elements.Count - 1] : null;
        };
        Inline.prototype._IsExistAfter = function (inline) {
            if (this.OwnerParagraph == inline.OwnerParagraph)
                return this.OwnerParagraph.Inlines._IndexOf(this) > this.OwnerParagraph.Inlines._IndexOf(inline);
            if (this.OwnerParagraph.Owner == inline.OwnerParagraph.Owner) {
                if (this.OwnerParagraph.IsInsideTable)
                    return this.OwnerParagraph.AssociatedCell.Blocks._IndexOf(this.OwnerParagraph) > inline.OwnerParagraph.AssociatedCell.Blocks._IndexOf(inline.OwnerParagraph);
                else if (this.OwnerParagraph.Owner instanceof HeaderFooter)
                    return this.OwnerParagraph.Owner.Blocks._IndexOf(this.OwnerParagraph) > inline.OwnerParagraph.Owner.Blocks._IndexOf(inline.OwnerParagraph);
                else
                    return this.OwnerParagraph.Section.Blocks._IndexOf(this.OwnerParagraph) > inline.OwnerParagraph.Section.Blocks._IndexOf(inline.OwnerParagraph);
            }
            return this.OwnerParagraph._IsExistAfter(inline.OwnerParagraph);
        };
        Inline.prototype._IsExistBefore = function (inline) {
            if (this.OwnerParagraph == inline.OwnerParagraph)
                return this.OwnerParagraph.Inlines._IndexOf(this) < this.OwnerParagraph.Inlines._IndexOf(inline);
            if (this.OwnerParagraph.Owner == inline.OwnerParagraph.Owner) {
                if (this.OwnerParagraph.IsInsideTable)
                    return this.OwnerParagraph.AssociatedCell.Blocks._IndexOf(this.OwnerParagraph) < inline.OwnerParagraph.AssociatedCell.Blocks._IndexOf(inline.OwnerParagraph);
                else if (this.OwnerParagraph.Owner instanceof HeaderFooter)
                    return this.OwnerParagraph.Owner.Blocks._IndexOf(this.OwnerParagraph) < inline.OwnerParagraph.Owner.Blocks._IndexOf(inline.OwnerParagraph);
                else
                    return this.OwnerParagraph.Section.Blocks._IndexOf(this.OwnerParagraph) < inline.OwnerParagraph.Section.Blocks._IndexOf(inline.OwnerParagraph);
            }
            return this.OwnerParagraph._IsExistBefore(inline.OwnerParagraph);
        };
        Inline.prototype._Find = function (pattern, option, indexInInline, isFirstMatch, selectionEnd, results) {
            var inline = this;
            var stringBuilder = new String();
            var spans = new Dictionary();
            do {
                if (inline instanceof SpanAdv && (inline.Text != null && inline.Text != "")) {
                    spans._Add(inline, stringBuilder.length);
                    if (inline == this)
                        stringBuilder = stringBuilder + (inline.Text.substring(indexInInline));
                    else
                        stringBuilder = stringBuilder + (inline.Text);
                }
                else if (inline instanceof FieldBeginAdv) {
                    var fieldBegin = inline;
                    if (fieldBegin.fieldEnd != null)
                        inline = fieldBegin.fieldSeparator == null ? fieldBegin.fieldEnd : fieldBegin.fieldSeparator;
                }
                if (inline.NextNode == null)
                    break;
                inline = inline.NextNode;
            } while (true);
            var text = stringBuilder.toString();
            var matches = [];
            var matchObject;
            while ((matchObject = pattern.exec(text)) != null) {
                matches.push(matchObject);
            }
            for (var i = 0; i < matches.length; i++) {
                var match = matches[i];
                var result = results._AddResult();
                var spanKeys = spans.Keys;
                for (var i_3 = 0; i_3 < spanKeys.Count; i_3++) {
                    var span = spanKeys[i_3];
                    var startIndex = spans._Get(span);
                    var spanLength = span.Length;
                    if (span == this)
                        spanLength -= indexInInline;
                    if (result.Start.Paragraph == null && match.index <= startIndex + spanLength) {
                        var index = match.index - startIndex;
                        if (span == this)
                            index += indexInInline;
                        var offset = span.OwnerParagraph._GetOffset(span, index);
                        result.Start._SetPositionParagraph(span.OwnerParagraph, offset);
                    }
                    if (match.index + match[0].length <= startIndex + spanLength) {
                        var index = (match.index + match[0].length) - startIndex;
                        if (span == this)
                            index += indexInInline;
                        var offset = span.OwnerParagraph._GetOffset(span, index);
                        result.End._SetPositionParagraph(span.OwnerParagraph, offset);
                        break;
                    }
                }
                result.End._UpdateTextPositionOnFieldCharacter(result.Start);
                if (isFirstMatch) {
                    results.CurrentIndex = 0;
                    return true;
                }
                else if (results.CurrentIndex < 0 && result.Start.Paragraph._GetOwnerComment() == selectionEnd.Paragraph._GetOwnerComment() && selectionEnd != null && selectionEnd._IsExistBefore(result.Start))
                    results.CurrentIndex = results._IndexOf(result);
            }
            var paragraph = inline.OwnerParagraph._GetNextParagraph();
            while (paragraph != null && paragraph.Inlines.Count == 0)
                paragraph = paragraph._GetNextParagraph();
            if (paragraph != null && paragraph.Inlines.Count > 0) {
                var inline_1 = paragraph.Inlines[0];
                return inline_1._Find(pattern, option, 0, isFirstMatch, selectionEnd, results);
            }
            return false;
        };
        Inline.prototype._ApplyCharacterFormat = function (selection, startIndex, endIndex, property, value, update) {
            if (startIndex == 0 && endIndex == this.Length)
                this.CharacterFormat._ApplyPropertyValue(selection.CurrentBaseHistoryInfo, property, value, update);
            else if (this instanceof SpanAdv) {
                this._FormatInline(selection, startIndex, endIndex, property, value, update);
            }
        };
        Inline.prototype._FormatInline = function (selection, startIndex, endIndex, property, value, update) {
            var node = this;
            var index = node.OwnerParagraph.Inlines._IndexOf(node);
            var span;
            if (startIndex > 0) {
                span = new SpanAdv(null);
                span.CharacterFormat._CopyFormat(node.CharacterFormat);
                span.Text = node.Text.substr(startIndex, endIndex - startIndex);
                span.CharacterFormat._ApplyPropertyValue(selection.CurrentBaseHistoryInfo, property, value, update);
                index++;
                node.OwnerParagraph.Inlines._Insert(index, span);
            }
            if (endIndex < node.Length) {
                span = new SpanAdv(null);
                span.CharacterFormat._CopyFormat(this.CharacterFormat);
                span.Text = node.Text.substring(endIndex);
                index++;
                node.OwnerParagraph.Inlines._Insert(index, span);
            }
            if (startIndex == 0) {
                node.Text = node.Text.substr(0, endIndex);
                this.CharacterFormat._ApplyPropertyValue(selection.CurrentBaseHistoryInfo, property, value, update);
            }
            else
                node.Text = node.Text.substr(0, startIndex);
        };
        Inline.prototype._ClearElements = function (dispose) {
            if (this.Elements != null) {
                for (var i = 0; i < this.Elements.Count; i++) {
                    var element = this.Elements[i];
                    element._Dispose();
                    this.Elements._Remove(element);
                    i--;
                }
            }
            if (dispose)
                this.Elements._Clear();
        };
        Inline.OBJECT_CHARACTER = "￼";
        Inline.WordSplitCharacters = new Array();
        return Inline;
    }(Node));
    DocumentEditorFeatures.Inline = Inline;
    var SpanAdv = (function (_super) {
        __extends(SpanAdv, _super);
        function SpanAdv(node) {
            _super.call(this, node);
            this.text = "";
        }
        Object.defineProperty(SpanAdv.prototype, "Text", {
            get: function () {
                return this.text;
            },
            set: function (text) {
                this.text = text;
                if (this.text != null && this.text != "" && this.OwnerParagraph instanceof ParagraphAdv) {
                    text = text.replace('\r\n', '\r');
                    text = text.replace('\n', '\r');
                    var index = text.indexOf('\r');
                    if (index > -1) {
                        this._SplitByBreakCharacter(index);
                    }
                }
                this._OnTextChanged();
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(SpanAdv.prototype, "Length", {
            get: function () {
                return this.text.length;
            },
            enumerable: true,
            configurable: true
        });
        SpanAdv.prototype._SerializeInline = function () {
            var span = { "Text": [], "CharacterFormat": [] };
            span.Text = this.Text;
            span.CharacterFormat = this.CharacterFormat._SerializeCharacterFormat();
            return span;
        };
        SpanAdv.prototype._OnTextChanged = function () {
            this._ClearElements(false);
            if (this.OwnerParagraph != null)
                this.OwnerParagraph._RelayoutParagraph(this.OwnerParagraph.Inlines._IndexOf(this));
        };
        SpanAdv.prototype._AddElementBox = function (viewer) {
            var index = -1;
            var spanText = this.Text;
            if (spanText != null && spanText != "") {
                spanText = spanText.toLocaleLowerCase();
                var char = ['\t', '\v'];
                var index_1 = HelperMethods._IndexOfAny(spanText, char);
                if (index_1 > -1) {
                    var character = spanText[index_1];
                    if (character == '\t' && spanText != "\t")
                        this._SplitByTab(viewer, index_1);
                    else if (character == '\v' && spanText != "\v")
                        this._SplitByLineBreakCharacter(viewer, index_1);
                }
            }
            var textElement = new TextElementBox(this);
            textElement.Index = 0;
            textElement.Length = this.Text != null ? this.Text.length : 0;
            this.Elements._Add(textElement);
        };
        SpanAdv.prototype._SplitByLineBreakCharacter = function (viewer, index) {
            var isLayoutingEnabled = viewer.OwnerControl.IsLayoutEnabled;
            viewer.OwnerControl.IsLayoutEnabled = false;
            var inlineIndex = this.OwnerParagraph.Inlines._IndexOf(this);
            var value = this.Text;
            var remainder = value.substring(index + 1);
            var newSpan = new SpanAdv(null);
            newSpan.CharacterFormat._CopyFormat(this.CharacterFormat);
            this.OwnerParagraph.Inlines._Insert(inlineIndex + 1, newSpan);
            if (index > 0) {
                newSpan.Text = value.substring(index);
                this.text = value.substring(0, index);
            }
            else if (remainder != "") {
                newSpan.Text = remainder;
                this.text = "\v";
            }
            if (isLayoutingEnabled)
                viewer.OwnerControl.IsLayoutEnabled = true;
        };
        SpanAdv.prototype._SplitByTab = function (viewer, index) {
            var isLayoutingEnabled = viewer.OwnerControl.IsLayoutEnabled;
            viewer.OwnerControl.IsLayoutEnabled = false;
            var inlineIndex = this.OwnerParagraph.Inlines._IndexOf(this);
            var value = this.Text;
            var remainder = value.substring(index + 1);
            var newSpan = new SpanAdv(null);
            newSpan.CharacterFormat._CopyFormat(this.CharacterFormat);
            this.OwnerParagraph.Inlines._Insert(inlineIndex + 1, newSpan);
            if (index > 0) {
                newSpan.Text = value.substring(index);
                this.text = value.substring(0, index);
            }
            else if (remainder != "") {
                newSpan.Text = remainder;
                this.text = "\t";
            }
            if (isLayoutingEnabled)
                viewer.OwnerControl.IsLayoutEnabled = true;
        };
        SpanAdv.prototype._SplitByBreakCharacter = function (index) {
            var currentParagraph = this.OwnerParagraph;
            if (currentParagraph == null || currentParagraph.Owner == null)
                return;
            var ownerControl = currentParagraph.BaseParent;
            var isLayoutEnabled = false;
            if (ownerControl != null && ownerControl.IsLayoutEnabled) {
                isLayoutEnabled = true;
                ownerControl.IsLayoutEnabled = false;
            }
            var inlineIndex = currentParagraph.Inlines._IndexOf(this);
            var value = this.Text;
            var remainder = value.substring(index + 1);
            var newParagraph = null;
            newParagraph = new ParagraphAdv(null);
            newParagraph.CharacterFormat._CopyFormat(currentParagraph.CharacterFormat);
            newParagraph.ParagraphFormat._CopyFormat(currentParagraph.ParagraphFormat);
            for (var i = inlineIndex + 1; i < currentParagraph.Inlines.Count; i++) {
                var inline = currentParagraph.Inlines[i];
                currentParagraph.Inlines._Remove(inline);
                newParagraph.Inlines._Add(inline);
                inline._SetOwnerBase(newParagraph);
                if (inline instanceof FieldBeginAdv) {
                    currentParagraph.Fields._Remove(inline);
                    newParagraph.Fields._Add(inline);
                }
                else if (inline instanceof FieldCharacterAdv) {
                    currentParagraph.FieldCharacter._Remove(inline);
                    newParagraph.FieldCharacter._Add(inline);
                }
                else if (inline instanceof CommentAdv) {
                    currentParagraph.Comments._Remove(inline);
                    newParagraph.Comments._Add(inline);
                }
                i--;
            }
            if (index > 0)
                this.text = value.substring(0, index);
            else if (remainder != "")
                this.text = "";
            if (index < value.length - 1) {
                var newSpan = null;
                newSpan = new SpanAdv(null);
                newSpan.CharacterFormat._CopyFormat(this.CharacterFormat);
                if (index > 0)
                    newSpan.Text = value.substring(index + 1);
                else if (remainder != "")
                    newSpan.Text = remainder;
                newParagraph.Inlines._Insert(0, newSpan);
            }
            var blocks = null;
            blocks = currentParagraph.Owner instanceof SectionAdv ? currentParagraph.Owner.Blocks :
                (currentParagraph.Owner instanceof TableCellAdv) ? currentParagraph.Owner.Blocks :
                    currentParagraph.Owner instanceof CommentAdv ? currentParagraph.Owner.Blocks :
                        currentParagraph.Owner instanceof HeaderFooter ? currentParagraph.Owner.Blocks : null;
            if (blocks != null)
                blocks._Insert(currentParagraph._GetIndexInOwnerCollection() + 1, newParagraph);
            if (isLayoutEnabled)
                ownerControl.IsLayoutEnabled = true;
        };
        SpanAdv.prototype._GetNextWordOffset = function (indexInInline, type, isInField, endSelection, endPosition, excludeSpace) {
            if (this.Text == "\t") {
                if (isInField) {
                    endPosition._SetPositionParagraph(this.OwnerParagraph, this.OwnerParagraph._GetOffset(this, indexInInline));
                    endSelection = false;
                    return;
                }
                if (indexInInline == 0) {
                    endSelection = true;
                    var startOffset = this.OwnerParagraph._GetOffset(this, 0);
                    if (endPosition.Offset == startOffset)
                        endPosition._SetPositionParagraph(this.OwnerParagraph, startOffset + this.Length);
                    else
                        endPosition._SetPositionParagraph(this.OwnerParagraph, startOffset);
                }
                else if (this.NextNode != null && this.NextNode instanceof SpanAdv)
                    this.NextNode._GetNextWordOffset(0, type, isInField, endSelection, endPosition, excludeSpace);
            }
            else {
                var wordEndIndex = 0;
                if (indexInInline == 0 && endSelection && (this.WordSplitCharacters.indexOf(this.Text[0]) == -1)) {
                    endPosition._SetPositionParagraph(this.OwnerParagraph, this.OwnerParagraph._GetOffset(this, indexInInline));
                    if (isInField)
                        return;
                }
                else if (indexInInline < this.Length) {
                    var txt = indexInInline > 0 && this.Text.length - 1 >= indexInInline ? this.Text.slice(indexInInline, this.Length) : this.Text;
                    wordEndIndex = HelperMethods._IndexOfAny(txt, this.WordSplitCharacters);
                    if (wordEndIndex != -1) {
                        if (isInField) {
                            endSelection = false;
                            return;
                        }
                        var offset = this.OwnerParagraph._GetOffset(this, wordEndIndex + indexInInline);
                        if ((excludeSpace || txt[wordEndIndex] != ' ') && !endSelection && this.OwnerParagraph == endPosition.Paragraph && offset != endPosition.Offset) {
                            endSelection = true;
                            endPosition._SetPositionParagraph(this.OwnerParagraph, offset);
                            return;
                        }
                        wordEndIndex++;
                        while (wordEndIndex < txt.length && this.WordSplitCharacters.indexOf(txt[wordEndIndex]) != -1) {
                            if (txt[wordEndIndex] != ' ' && txt[wordEndIndex - 1] == ' ')
                                break;
                            wordEndIndex++;
                        }
                        endSelection = true;
                        if (wordEndIndex < txt.length)
                            endPosition._SetPositionParagraph(this.OwnerParagraph, this.OwnerParagraph._GetOffset(this, wordEndIndex + indexInInline));
                        else if (this.NextNode != null && this.NextNode instanceof Inline)
                            this.NextNode._GetNextWordOffset(0, type, isInField, endSelection, endPosition, excludeSpace);
                        else {
                            if (isInField) {
                                endSelection = false;
                                return;
                            }
                            endPosition._SetPositionParagraph(this.OwnerParagraph, this.OwnerParagraph._GetOffset(this, wordEndIndex + indexInInline));
                        }
                    }
                    else if (this.NextNode != null && this.NextNode instanceof Inline)
                        this.NextNode._GetNextWordOffset(0, type, isInField, endSelection, endPosition, excludeSpace);
                    else {
                        if (isInField) {
                            endSelection = false;
                            return;
                        }
                        endPosition._SetPositionParagraph(this.OwnerParagraph, this.OwnerParagraph._GetEndOffset());
                    }
                }
                else if (this.NextNode != null && this.NextNode instanceof Inline)
                    this.NextNode._GetNextWordOffset(0, type, isInField, endSelection, endPosition, excludeSpace);
            }
        };
        SpanAdv.prototype._GetPreviousWordOffset = function (indexInInline, type, isInField, isStarted, endSelection, endPosition) {
            if (this.Text == "\t") {
                if (isInField) {
                    endSelection = false;
                    return;
                }
                if (indexInInline == 0) {
                    endSelection = true;
                    var endOffset = this.OwnerParagraph._GetOffset(this, this.Length);
                    if (endOffset == endPosition.Offset)
                        endPosition._SetPositionParagraph(this.OwnerParagraph, endOffset - this.Length);
                    else
                        endPosition._SetPositionParagraph(this.OwnerParagraph, endOffset);
                }
                else if (this.PreviousNode != null && this.PreviousNode instanceof Inline)
                    this.PreviousNode._GetPreviousWordOffset(this.PreviousNode.Length, type, isInField, isStarted, endSelection, endPosition);
            }
            else {
                var wordStartIndex = 0;
                if (!isStarted) {
                    while (indexInInline > 0 && this.Text[indexInInline - 1] == ' ')
                        indexInInline--;
                    endPosition._SetPositionParagraph(this.OwnerParagraph, this.OwnerParagraph._GetOffset(this, indexInInline));
                }
                if (indexInInline > 0) {
                    isStarted = true;
                    if (indexInInline == 0 && endSelection && (this.WordSplitCharacters.indexOf(this.Text[0])) == -1) {
                        endPosition._SetPositionParagraph(this.OwnerParagraph, this.OwnerParagraph._GetOffset(this, indexInInline));
                        endSelection = true;
                        return;
                    }
                    var txt = this.Text.length > indexInInline ? this.Text.slice(0, indexInInline) : this.Text;
                    wordStartIndex = HelperMethods._LastIndexOfAny(txt, this.WordSplitCharacters);
                    if (wordStartIndex != -1) {
                        if (isInField) {
                            endSelection = false;
                            return;
                        }
                        while (wordStartIndex > 0 && endSelection && txt[wordStartIndex] != ' ' && (this.WordSplitCharacters.indexOf(txt[wordStartIndex - 1])) != -1)
                            wordStartIndex--;
                        if (txt[wordStartIndex] == ' ' || !endSelection)
                            wordStartIndex++;
                        endSelection = true;
                        if (wordStartIndex > 0) {
                            var offset = this.OwnerParagraph._GetOffset(this, wordStartIndex);
                            if (this.OwnerParagraph == endPosition.Paragraph && offset == endPosition.Offset)
                                this._GetPreviousWordOffset(indexInInline, type, isInField, isStarted, endSelection, endPosition);
                            else
                                endPosition._SetPositionParagraph(this.OwnerParagraph, offset);
                        }
                        else if (this.PreviousNode != null && this.PreviousNode instanceof Inline)
                            this.PreviousNode._GetPreviousWordOffset(this.PreviousNode.Length, type, isInField, isStarted, endSelection, endPosition);
                        else
                            endPosition._SetPositionParagraph(this.OwnerParagraph, this.OwnerParagraph._GetOffset(this, 0));
                    }
                    else if (this.PreviousNode != null && this.PreviousNode instanceof Inline)
                        this.PreviousNode._GetPreviousWordOffset(this.PreviousNode.Length, type, isInField, isStarted, endSelection, endPosition);
                    else
                        endPosition._SetPositionParagraph(this.OwnerParagraph, this.OwnerParagraph._GetStartOffset());
                }
                else if (this.PreviousNode != null && this.PreviousNode instanceof Inline)
                    this.PreviousNode._GetPreviousWordOffset(this.PreviousNode.Length, type, isInField, isStarted, endSelection, endPosition);
                else
                    endPosition._SetPositionParagraph(this.OwnerParagraph, this.OwnerParagraph._GetStartOffset());
            }
        };
        SpanAdv.prototype._InsertText = function (selection, text, index) {
            if (index >= 0) {
                this.Text = HelperMethods._Insert(this.Text, index, text);
            }
            else {
                var prevInline = null;
                var prevTextInline = this._GetPreviousTextInline();
                if (prevInline instanceof Inline)
                    prevInline = prevTextInline;
                if (prevInline == null) {
                    this.Text = HelperMethods._Insert(this.Text, index, text);
                }
                else {
                    index = this.OwnerParagraph.Inlines._IndexOf(this);
                    var span = new SpanAdv(this);
                    span.CharacterFormat._CopyFormat(prevInline.CharacterFormat);
                    span.Text = text;
                    this.OwnerParagraph.Inlines._Insert(index, span);
                }
            }
        };
        SpanAdv.prototype._Clone = function () {
            var span = new SpanAdv(null);
            span.CharacterFormat._CopyFormat(this.CharacterFormat);
            span.Text = this.Text;
            return span;
        };
        SpanAdv.prototype._Dispose = function () {
            this.CharacterFormat._Dispose();
            this.text = "";
            this._SetOwner(null);
        };
        return SpanAdv;
    }(Inline));
    DocumentEditorFeatures.SpanAdv = SpanAdv;
    var ImageAdv = (function (_super) {
        __extends(ImageAdv, _super);
        function ImageAdv(node, isInline, isMetaImage) {
            _super.call(this, node);
            this.imageString = "";
            this.width = 0;
            this.height = 0;
            this.isInlineImage = true;
            this.isMetaFile = false;
            this.isInlineImage = isInline;
            this.isMetaFile = isMetaImage;
        }
        Object.defineProperty(ImageAdv.prototype, "ImageString", {
            get: function () {
                return this.imageString;
            },
            set: function (value) {
                this.imageString = value;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(ImageAdv.prototype, "Width", {
            get: function () {
                return this.width;
            },
            set: function (value) {
                this.width = value;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(ImageAdv.prototype, "Height", {
            get: function () {
                return this.height;
            },
            set: function (value) {
                this.height = value;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(ImageAdv.prototype, "IsInlineImage", {
            get: function () {
                return this.isInlineImage;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(ImageAdv.prototype, "IsMetaFile", {
            get: function () {
                return this.isMetaFile;
            },
            enumerable: true,
            configurable: true
        });
        ImageAdv.prototype._SerializeInline = function () {
            var inline = {
                "IsInlineImage": [], "IsMetaFile": [], "Length": [],
                "Width": [], "ImageString": [], "Height": [], "CharacterFormat": []
            };
            inline.CharacterFormat = this.CharacterFormat._SerializeCharacterFormat();
            inline.IsInlineImage = this.IsInlineImage;
            inline.IsMetaFile = this.IsMetaFile;
            inline.Length = this.Length;
            inline.Width = this.Width;
            inline.Height = this.Height;
            inline.ImageString = this.ImageString;
            return inline;
        };
        ImageAdv.prototype._AddElementBox = function (viewer) {
            var imageElement = new ImageElementBox(this);
            imageElement.Height = this.Height;
            imageElement.Width = this.Width;
            this.Elements._Add(imageElement);
        };
        ImageAdv.prototype._GetNextWordOffset = function (indexInInline, type, isInField, endSelection, endPosition, excludeSpace) {
            if (isInField) {
                endPosition._SetPositionParagraph(this.OwnerParagraph, this.OwnerParagraph._GetOffset(this, indexInInline));
                endSelection = false;
                return;
            }
            if (indexInInline == 0) {
                var startOffset = this.OwnerParagraph._GetOffset(this, 0);
                endSelection = true;
                if (endPosition.Offset == startOffset) {
                    if (this.NextNode == null)
                        endPosition._SetPositionParagraph(this.OwnerParagraph, startOffset + this.Length);
                    else
                        this.NextNode._GetNextWordOffset(0, type, isInField, endSelection, endPosition, excludeSpace);
                }
                else
                    endPosition._SetPositionParagraph(this.OwnerParagraph, startOffset);
            }
            else if (this.NextNode != null && this.NextNode instanceof Inline)
                this.NextNode._GetNextWordOffset(0, type, isInField, endSelection, endPosition, excludeSpace);
        };
        ImageAdv.prototype._GetPreviousWordOffset = function (indexInInline, type, isInField, isStarted, endSelection, endPosition) {
            if (isInField) {
                endPosition._SetPositionParagraph(this.OwnerParagraph, this.OwnerParagraph._GetOffset(this, indexInInline));
                endSelection = false;
                return;
            }
            if (indexInInline == this.Length) {
                var endOffset = this.OwnerParagraph._GetOffset(this, this.Length);
                if (endOffset == endPosition.Offset)
                    endPosition._SetPositionParagraph(this.OwnerParagraph, endOffset - this.Length);
                else
                    endPosition._SetPositionParagraph(this.OwnerParagraph, endOffset);
            }
            else if (this.PreviousNode != null && this.PreviousNode instanceof Inline)
                this.PreviousNode._GetPreviousWordOffset(this.PreviousNode.Length, type, isInField, isStarted, endSelection, endPosition);
        };
        ImageAdv.prototype._InsertText = function (selection, text, index) {
            var previousInline = this._GetPreviousTextInline();
            var nextInline = this._GetNextTextInline();
            var span = new SpanAdv(this);
            span.Text = text;
            var spanIndex = this.OwnerParagraph.Inlines._IndexOf(this);
            if (index == this.Length)
                spanIndex++;
            if (previousInline == null && nextInline == null)
                span.CharacterFormat._CopyFormat(this.OwnerParagraph.CharacterFormat);
            else if (previousInline == null)
                span.CharacterFormat._CopyFormat(nextInline.CharacterFormat);
            else
                span.CharacterFormat._CopyFormat(previousInline.CharacterFormat);
            this.OwnerParagraph.Inlines._Insert(spanIndex, span);
        };
        ImageAdv.prototype._Clone = function () {
            var image = new ImageAdv(null, this.IsInlineImage, this.IsMetaFile);
            image.CharacterFormat._CopyFormat(this.CharacterFormat);
            image.ImageString = this.ImageString;
            image.Width = this.Width;
            image.Height = this.Height;
            return image;
        };
        ImageAdv.prototype._Dispose = function () {
            this.CharacterFormat._Dispose();
            this.imageString = "";
            this._SetOwner(null);
            this._ClearElements(true);
        };
        return ImageAdv;
    }(Inline));
    DocumentEditorFeatures.ImageAdv = ImageAdv;
    var ImageFormat = (function () {
        function ImageFormat(imageContainer) {
            this.Width = 0;
            this.Height = 0;
            this.Width = imageContainer.Width;
            this.Height = imageContainer.Height;
        }
        return ImageFormat;
    }());
    DocumentEditorFeatures.ImageFormat = ImageFormat;
    var FieldCharacterAdv = (function (_super) {
        __extends(FieldCharacterAdv, _super);
        function FieldCharacterAdv() {
            _super.apply(this, arguments);
        }
        FieldCharacterAdv.prototype._AddElementBox = function (viewer) { };
        FieldCharacterAdv.prototype._GetRenderedInline = function (inlineIndex) {
            var prevInline = this._GetPreviousValidInline();
            while (prevInline instanceof FieldCharacterAdv) {
                prevInline = prevInline._GetPreviousTextInline();
                if (prevInline instanceof FieldCharacterAdv)
                    prevInline = prevInline.PreviousNode;
            }
            if (prevInline != null) {
                inlineIndex = prevInline.Length;
                return { "Inline": prevInline, "InlineIndex": inlineIndex };
            }
            inlineIndex = 0;
            var nextInline = this._GetNextRenderedInline(0);
            if (nextInline instanceof FieldBeginAdv) {
                nextInline = nextInline.fieldSeparator;
                nextInline = nextInline.NextNode;
                while (nextInline instanceof FieldCharacterAdv) {
                    if (nextInline instanceof FieldBeginAdv && nextInline._IsLinkedFieldCharacter()) {
                        if (nextInline.fieldSeparator == null)
                            nextInline = nextInline.fieldEnd;
                        else
                            nextInline = nextInline.fieldSeparator;
                    }
                    nextInline = nextInline.NextNode;
                }
            }
            return { "Inline": prevInline, "InlineIndex": inlineIndex };
        };
        FieldCharacterAdv.prototype._Dispose = function () {
            this.CharacterFormat._Dispose();
            this._SetOwner(null);
            this._ClearElements(true);
        };
        FieldCharacterAdv.prototype._GetLayoutViewer = function () {
            if (this.OwnerParagraph != null) {
                var document_5 = this.OwnerParagraph.BaseParent;
                if (document_5 != null && this.OwnerParagraph.ParagraphWidgets.Count > 0)
                    return document_5.Viewer;
            }
            return null;
        };
        return FieldCharacterAdv;
    }(Inline));
    DocumentEditorFeatures.FieldCharacterAdv = FieldCharacterAdv;
    var FieldBeginAdv = (function (_super) {
        __extends(FieldBeginAdv, _super);
        function FieldBeginAdv(node) {
            _super.call(this, node);
            this.FieldSeparator = null;
            this.FieldEnd = null;
        }
        Object.defineProperty(FieldBeginAdv.prototype, "fieldSeparator", {
            get: function () {
                return this.FieldSeparator;
            },
            set: function (value) {
                if (this.FieldSeparator != value) {
                    var preFieldSeparator = this.fieldSeparator;
                    this.FieldSeparator = value;
                    if (preFieldSeparator != null) {
                        preFieldSeparator.fieldBegin = null;
                        preFieldSeparator = null;
                    }
                    if (this.fieldSeparator != null) {
                        this.fieldSeparator.fieldBegin = this;
                    }
                }
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(FieldBeginAdv.prototype, "fieldEnd", {
            get: function () {
                return this.FieldEnd;
            },
            set: function (value) {
                if (this.FieldEnd != value) {
                    var prevFieldEnd = this.fieldEnd;
                    this.FieldEnd = value;
                    if (prevFieldEnd != null) {
                        prevFieldEnd.fieldBegin = null;
                        prevFieldEnd = null;
                    }
                    if (this.fieldEnd != null)
                        this.fieldEnd.fieldBegin = this;
                }
            },
            enumerable: true,
            configurable: true
        });
        FieldBeginAdv.prototype._SerializeInline = function () {
            var inline = {
                "CharacterFormat": [], "HasFieldEnd": [], "FieldBegin": []
            };
            inline.CharacterFormat = this.CharacterFormat._SerializeCharacterFormat();
            inline.HasFieldEnd = this.HasFieldEnd;
            inline.FieldBegin = true;
            return inline;
        };
        FieldBeginAdv.prototype._IsLinkedFieldCharacter = function () { return this.fieldEnd != null; };
        ;
        FieldBeginAdv.prototype._CheckUnlinkFieldCharacter = function (compositeNodeIndex, isCheckFieldCharacters) {
            if (this.fieldSeparator != null) {
                if (isCheckFieldCharacters) {
                    var fieldOwnerIndex = this.fieldSeparator.OwnerParagraph._GetHierarchicalIndex("");
                    if (fieldOwnerIndex.indexOf(compositeNodeIndex) >= 0)
                        return;
                }
                this.fieldSeparator.fieldBegin = null;
                this.fieldSeparator = null;
            }
        };
        ;
        FieldBeginAdv.prototype._AddToLinkedFields = function () {
            var fields = this;
            fields._RemoveAfterLinking(fields);
            if (fields.FieldSeparator != null)
                fields._RemoveAfterLinking(fields.FieldSeparator);
            fields._RemoveAfterLinking(fields.FieldEnd);
            this.Owner._AddFields(this);
            if (this.OwnerParagraph != null && !this.HasFieldEnd) {
                var document_6 = this.OwnerParagraph.BaseParent;
                if (document_6 != null) {
                    var viewer = document_6.Viewer;
                    if (viewer != null && this.OwnerParagraph.ParagraphWidgets.Count > 0) {
                        if (viewer.FieldToLayout != null && viewer.FieldToLayout.OwnerParagraph != null) {
                            var prevStartIndex = viewer.FieldToLayout._GetIndexInOwnerCollection().toString();
                            prevStartIndex = viewer.FieldToLayout.OwnerParagraph._GetHierarchicalIndex(prevStartIndex);
                            var startIndex = this._GetIndexInOwnerCollection().toString();
                            startIndex = this.OwnerParagraph._GetHierarchicalIndex(startIndex);
                            if (TextPosition._IsForwardSelection(startIndex, prevStartIndex))
                                viewer.FieldToLayout = this;
                        }
                        else
                            viewer.FieldToLayout = this;
                        if (viewer.FieldEndParagraph != null) {
                            var prevEndIndex = viewer.FieldEndParagraph._GetHierarchicalIndex("");
                            var endIndex = this.fieldEnd.OwnerParagraph._GetHierarchicalIndex("");
                            if (TextPosition._IsForwardSelection(prevEndIndex, endIndex))
                                viewer.FieldEndParagraph = this.fieldEnd.OwnerParagraph;
                        }
                        else
                            viewer.FieldEndParagraph = this.fieldEnd.OwnerParagraph;
                    }
                }
            }
        };
        ;
        FieldBeginAdv.prototype._IsUnlinkFieldCharacters = function (compositeNodeINdex) {
            if (this.fieldEnd == null)
                return false;
            var fieldEndOwnerIndex = this.fieldEnd.OwnerParagraph._GetHierarchicalIndex("");
            return !(fieldEndOwnerIndex.indexOf(fieldEndOwnerIndex) >= 0);
        };
        FieldBeginAdv.prototype._UnlinkFieldCharacter = function (compositeNodeIndex, isAddToFieldCharacters) {
            var viewer = this._GetLayoutViewer();
            if (this.fieldSeparator != null) {
                var isUnlinkSeparator = true;
                if (isAddToFieldCharacters) {
                    var fieldOwnerIndex = this.fieldSeparator.OwnerParagraph._GetHierarchicalIndex("");
                    if (fieldOwnerIndex.indexOf(compositeNodeIndex) >= 0)
                        isUnlinkSeparator = false;
                }
                if (isUnlinkSeparator) {
                    this.fieldSeparator.Owner._AddFieldCharacter(this.fieldSeparator);
                    this.fieldSeparator.fieldBegin = null;
                    this.fieldSeparator = null;
                }
                else
                    this.fieldSeparator.Owner._AddFieldCharacter(this.fieldSeparator);
            }
            if (this.fieldEnd != null) {
                if (viewer != null) {
                    viewer.FieldToLayout = this;
                    viewer.FieldEndParagraph = this.fieldEnd.OwnerParagraph;
                }
                this.fieldEnd.Owner._AddFieldCharacter(this.fieldEnd);
                this.fieldEnd.fieldBegin = null;
                this.fieldEnd = null;
            }
            if (this.Owner.Fields._Contains(this))
                this.Owner.Fields._Remove(this);
            if (isAddToFieldCharacters)
                this.Owner._AddFieldCharacter(this);
        };
        ;
        FieldBeginAdv.prototype._RemoveAfterLinking = function (fieldCharacter) {
            var owner = (this.Owner instanceof CompositeNode) ? this.Owner : null;
            if (owner != null)
                owner._RemoveFieldCharacter(fieldCharacter);
        };
        FieldBeginAdv.prototype._GetRenderedField = function () {
            var inline = this;
            if (this.FieldSeparator == null)
                inline = this.FieldEnd;
            else {
                inline = this.FieldSeparator;
                var paragraph = inline.OwnerParagraph;
                if (paragraph == this.FieldEnd.OwnerParagraph && !paragraph._HasValidInline(inline, this.FieldEnd))
                    inline = this.FieldEnd;
                else
                    return this;
            }
            return inline;
        };
        FieldBeginAdv.prototype._GetFieldCode = function () {
            if (this.fieldEnd == null || this.OwnerParagraph == null)
                return "";
            var isNestedFieldCode = false;
            var isFieldCodeParsed = false;
            return this.OwnerParagraph._GetFieldCode(this, isNestedFieldCode, isFieldCodeParsed, this);
        };
        FieldBeginAdv.prototype._InlineIsInFieldResult = function (inline) {
            if (this.fieldEnd != null && this.fieldSeparator != null) {
                if (this.fieldSeparator._IsExistBefore(inline))
                    return this.fieldEnd._IsExistAfter(inline);
            }
            return false;
        };
        FieldBeginAdv.prototype._ParagraphIsInFieldResult = function (paragraph) {
            if (this.fieldEnd != null && this.fieldSeparator != null) {
                if (this.fieldSeparator.Owner == paragraph || this.fieldSeparator.OwnerParagraph._IsExistBefore(paragraph))
                    return (this.fieldEnd.Owner != paragraph && this.fieldEnd.OwnerParagraph._IsExistAfter(paragraph));
            }
            return false;
        };
        FieldBeginAdv.prototype._GetNextWordOffset = function (indexInInline, type, isInField, endSelection, endPosition, excludeSpace) {
            var startOffset = this.OwnerParagraph._GetOffset(this, 0);
            var endOffset = startOffset + this.Length;
            if (this.FieldSeparator == null)
                this.fieldEnd._GetNextWordOffset(0, type, isInField, endSelection, endPosition, excludeSpace);
            else if (this.fieldEnd != null && type != 0) {
                var inline = this.FieldSeparator;
                if (inline.OwnerParagraph == this.FieldEnd.OwnerParagraph && !inline.OwnerParagraph._HasValidInline(inline, this.FieldEnd))
                    inline = this.FieldEnd;
                inline._GetNextWordOffset(0, type, !(endPosition.Paragraph == this.OwnerParagraph && endPosition.Offset == startOffset), endSelection, endPosition, excludeSpace);
                if (endSelection && this.fieldSeparator != null && endPosition.Paragraph == this.OwnerParagraph && endPosition.Offset == this.fieldSeparator.OwnerParagraph._GetOffset(this.fieldSeparator, this.fieldSeparator.Length)) {
                    endPosition._SetPositionParagraph(this.OwnerParagraph, startOffset);
                    return;
                }
                if (!endSelection)
                    endPosition._SetPositionParagraph(this.fieldEnd.OwnerParagraph, this.fieldEnd.OwnerParagraph._GetOffset(this.fieldEnd, this.fieldEnd.Length));
            }
        };
        FieldBeginAdv.prototype._GetPreviousWordOffset = function (indexInInline, type, isInField, isStarted, endSelection, endPosition) {
            var startOffset = this.OwnerParagraph._GetOffset(this, 0);
            var endOffset = startOffset + this.Length;
            if (endPosition.Offset == endOffset)
                endPosition._SetPositionParagraph(this.OwnerParagraph, startOffset);
            if (this.PreviousNode != null && this.PreviousNode instanceof Inline) {
                this.PreviousNode._GetPreviousWordOffset(this.PreviousNode.Length, type, false, isStarted, endSelection, endPosition);
                if (endPosition.Offset == startOffset) {
                    if (type != 0 && this.fieldSeparator != null)
                        endPosition._SetPositionParagraph(this.OwnerParagraph, endOffset);
                }
            }
            else
                endPosition._SetPositionParagraph(this.OwnerParagraph, this.OwnerParagraph._GetStartOffset());
        };
        FieldBeginAdv.prototype._InsertText = function (selection, text, index) {
            var span = new SpanAdv(this);
            span.Text = text;
            var spanIndex = this.OwnerParagraph.Inlines._IndexOf(this);
            span.CharacterFormat._CopyFormat(this.CharacterFormat);
            this.OwnerParagraph.Inlines._Insert(spanIndex, span);
        };
        FieldBeginAdv.prototype._Clone = function () {
            var fieldBegin = new FieldBeginAdv(this);
            fieldBegin.CharacterFormat._CopyFormat(this.CharacterFormat);
            return fieldBegin;
        };
        return FieldBeginAdv;
    }(FieldCharacterAdv));
    DocumentEditorFeatures.FieldBeginAdv = FieldBeginAdv;
    var FieldSeparatorAdv = (function (_super) {
        __extends(FieldSeparatorAdv, _super);
        function FieldSeparatorAdv(node) {
            _super.call(this, node);
            this.FieldBegin = null;
            this.FieldEnd = null;
        }
        Object.defineProperty(FieldSeparatorAdv.prototype, "fieldBegin", {
            get: function () {
                return this.FieldBegin;
            },
            set: function (value) {
                if (this.FieldBegin != value) {
                    var prevFieldBegin = this.FieldBegin;
                    this.FieldBegin = value;
                    if (prevFieldBegin != null) {
                        prevFieldBegin.fieldSeparator = null;
                        prevFieldBegin = null;
                    }
                    if (this.fieldBegin != null)
                        this.fieldBegin.fieldSeparator = this;
                }
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(FieldSeparatorAdv.prototype, "fieldEnd", {
            get: function () {
                return this.FieldEnd;
            },
            set: function (value) {
                if (this.FieldEnd != value) {
                    var prevFieldEnd = this.FieldEnd;
                    this.FieldEnd = value;
                    if (prevFieldEnd != null) {
                        prevFieldEnd.fieldSeparator = null;
                        prevFieldEnd = null;
                    }
                    if (this.fieldEnd != null)
                        this.fieldEnd.fieldSeparator = this;
                }
            },
            enumerable: true,
            configurable: true
        });
        FieldSeparatorAdv.prototype._SerializeInline = function () {
            var inline = { "CharacterFormat": [], "FieldSeparator": [] };
            inline.CharacterFormat = this.CharacterFormat._SerializeCharacterFormat();
            inline.FieldSeparator = true;
            return inline;
        };
        FieldSeparatorAdv.prototype._IsLinkedFieldCharacter = function () {
            return this.fieldBegin != null && this.fieldEnd != null;
        };
        ;
        FieldSeparatorAdv.prototype._GetNextWordOffset = function (indexInInline, type, isInField, endSelection, endPosition, excludeSpace) {
            if (this.NextNode != null && this.NextNode instanceof Inline)
                this.NextNode._GetNextWordOffset(0, type, isInField, endSelection, endPosition, excludeSpace);
        };
        FieldSeparatorAdv.prototype._GetPreviousWordOffset = function (indexInInline, type, isInField, isStarted, endSelection, endPosition) {
            this.FieldBegin._GetPreviousWordOffset(this.FieldBegin.Length, type, isInField, isStarted, endSelection, endPosition);
        };
        FieldSeparatorAdv.prototype._UnlinkFieldCharacter = function (compositeNodeIndex, isAddToFieldCharacters) {
            if (this.fieldBegin != null && this.fieldBegin.Owner instanceof CompositeNode) {
                var isUnlinkSeparator = true;
                if (isAddToFieldCharacters) {
                    var fieldOwnerIndex = this.fieldBegin.OwnerParagraph._GetHierarchicalIndex("");
                    if (fieldOwnerIndex.indexOf(compositeNodeIndex) >= 0)
                        isUnlinkSeparator = false;
                }
                if (this.fieldEnd != null) {
                    var viewer = this._GetLayoutViewer();
                    if (viewer != null) {
                        viewer.FieldToLayout = this.fieldBegin;
                        viewer.FieldEndParagraph = this.fieldEnd.OwnerParagraph;
                    }
                }
                if (isUnlinkSeparator) {
                    this.fieldBegin.Owner._AddFieldCharacter(this.fieldBegin);
                    this.fieldBegin.fieldSeparator = null;
                    this.fieldBegin = null;
                }
                else
                    this.fieldBegin.Owner._AddFieldCharacter(this.fieldBegin);
            }
            if (this.fieldEnd != null && this.fieldEnd.Owner instanceof CompositeNode) {
                var isUnlinkSeparator = true;
                if (isAddToFieldCharacters) {
                    var fieldOwnerIndex = this.fieldEnd.OwnerParagraph._GetHierarchicalIndex("");
                    if (fieldOwnerIndex.indexOf(compositeNodeIndex) > 0)
                        isUnlinkSeparator = false;
                }
                if (isUnlinkSeparator) {
                    this.fieldEnd.Owner._AddFieldCharacter(this.fieldEnd);
                    this.fieldEnd.fieldSeparator = null;
                    this.fieldEnd = null;
                }
                else
                    this.fieldEnd.Owner._AddFieldCharacter(this.fieldEnd);
            }
            if (isAddToFieldCharacters)
                this.Owner._AddFieldCharacter(this);
        };
        ;
        FieldSeparatorAdv.prototype._CheckUnlinkFieldCharacter = function (compositeNodeIndex, isCheckFieldCharacters) {
            if (this.fieldBegin != null) {
                if (isCheckFieldCharacters) {
                    var fieldOwnerIndex = this.fieldBegin.OwnerParagraph._GetHierarchicalIndex("");
                    if (fieldOwnerIndex.indexOf(compositeNodeIndex) >= 0)
                        return;
                }
                this.fieldBegin.fieldSeparator = null;
                this.fieldBegin = null;
            }
            if (this.fieldEnd != null) {
                if (isCheckFieldCharacters) {
                    var fieldOwnerIndex = this.fieldEnd.OwnerParagraph._GetHierarchicalIndex("");
                    if (fieldOwnerIndex.indexOf(compositeNodeIndex) >= 0)
                        return;
                }
                this.fieldEnd.fieldSeparator = null;
                this.fieldEnd = null;
            }
        };
        ;
        FieldSeparatorAdv.prototype._InsertText = function (selection, text, index) {
            var previousInline = this._GetPreviousTextInline();
            var nextInline = this._GetNextTextInline();
            var span = new SpanAdv(this);
            span.Text = text;
            var spanIndex = this.OwnerParagraph.Inlines._IndexOf(this);
            if (index == this.Length)
                spanIndex++;
            if (previousInline == null && nextInline == null)
                span.CharacterFormat._CopyFormat(this.OwnerParagraph.CharacterFormat);
            else if (previousInline == null)
                span.CharacterFormat._CopyFormat(nextInline.CharacterFormat);
            else
                span.CharacterFormat._CopyFormat(previousInline.CharacterFormat);
            this.OwnerParagraph.Inlines._Insert(spanIndex, span);
        };
        FieldSeparatorAdv.prototype._Clone = function () {
            var fieldSeparator = new FieldSeparatorAdv(this);
            fieldSeparator.CharacterFormat._CopyFormat(this.CharacterFormat);
            return fieldSeparator;
        };
        return FieldSeparatorAdv;
    }(FieldCharacterAdv));
    DocumentEditorFeatures.FieldSeparatorAdv = FieldSeparatorAdv;
    var FieldEndAdv = (function (_super) {
        __extends(FieldEndAdv, _super);
        function FieldEndAdv(node) {
            _super.call(this, node);
            this.FieldBegin = null;
            this.FieldSeparator = null;
        }
        Object.defineProperty(FieldEndAdv.prototype, "fieldBegin", {
            get: function () {
                return this.FieldBegin;
            },
            set: function (value) {
                if (this.FieldBegin != value) {
                    var prevFieldBegin = this.FieldBegin;
                    this.FieldBegin = value;
                    if (prevFieldBegin != null) {
                        prevFieldBegin.fieldEnd = null;
                        prevFieldBegin = null;
                    }
                    if (this.fieldBegin != null)
                        this.fieldBegin.fieldEnd = this;
                }
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(FieldEndAdv.prototype, "fieldSeparator", {
            get: function () {
                return this.FieldSeparator;
            },
            set: function (value) {
                if (this.FieldSeparator != value) {
                    var prevFieldSeparator = this.FieldSeparator;
                    this.FieldSeparator = value;
                    if (prevFieldSeparator != null) {
                        prevFieldSeparator.fieldEnd = null;
                        prevFieldSeparator = null;
                    }
                    if (this.fieldSeparator != null)
                        this.fieldSeparator.fieldEnd = this;
                }
            },
            enumerable: true,
            configurable: true
        });
        FieldEndAdv.prototype._SerializeInline = function () {
            var inline = { "CharacterFormat": [], "FieldEnd": [] };
            inline.CharacterFormat = this.CharacterFormat._SerializeCharacterFormat();
            inline.FieldEnd = true;
            return inline;
        };
        FieldEndAdv.prototype._IsLinkedFieldCharacter = function () {
            return this.fieldBegin != null;
        };
        ;
        FieldEndAdv.prototype._CheckUnlinkFieldCharacter = function (compositeNodeIndex, isCheckFieldCharacters) {
            if (this.fieldSeparator != null) {
                if (isCheckFieldCharacters) {
                    var fieldOwnerIndex = this.fieldSeparator.OwnerParagraph._GetHierarchicalIndex("");
                    if (fieldOwnerIndex.indexOf(compositeNodeIndex) >= 0)
                        return;
                }
                this.fieldSeparator.fieldEnd = null;
                this.fieldSeparator = null;
            }
        };
        ;
        FieldEndAdv.prototype._UnlinkFieldCharacter = function (compositeNodeIndex, isAddToFieldCharacters) {
            if (this.fieldBegin != null) {
                var viewer = this._GetLayoutViewer();
                if (viewer != null) {
                    viewer.FieldToLayout = this.fieldBegin;
                    viewer.FieldEndParagraph = this.OwnerParagraph;
                }
                if (this.fieldBegin.Owner.Fields._Contains(this.fieldBegin))
                    this.fieldBegin.Owner.Fields._Remove(this.fieldBegin);
                this.fieldBegin.Owner._AddFieldCharacter(this.fieldBegin);
                this.fieldBegin.fieldEnd = null;
                this.fieldBegin = null;
            }
            if (this.fieldSeparator != null) {
                var isUnlinkSeparator = true;
                if (isAddToFieldCharacters) {
                    var fieldOwnerIndex = this.fieldSeparator.OwnerParagraph._GetHierarchicalIndex("");
                    if (fieldOwnerIndex.indexOf(compositeNodeIndex) > 0)
                        isUnlinkSeparator = false;
                }
                if (isUnlinkSeparator) {
                    this.fieldSeparator.Owner._AddFieldCharacter(this.fieldSeparator);
                    this.fieldSeparator.fieldEnd = null;
                    this.fieldSeparator = null;
                }
                else
                    this.fieldSeparator.Owner._AddFieldCharacter(this.fieldSeparator);
            }
            if (isAddToFieldCharacters)
                this.Owner._AddFieldCharacter(this);
        };
        FieldEndAdv.prototype._GetNextWordOffset = function (indexInInline, type, isInField, endSelection, endPosition, excludeSpace) {
            var startOffset = this.OwnerParagraph._GetOffset(this, 0);
            var endOffset = startOffset + this.Length;
            if (endPosition.Offset == startOffset) {
                endPosition._SetPositionParagraph(this.OwnerParagraph, endOffset);
                if (this.NextNode == null)
                    return;
            }
            if (this.NextNode != null && this.NextNode instanceof Inline) {
                this.NextNode._GetNextWordOffset(0, type, false, endSelection, endPosition, excludeSpace);
                if (endPosition.Offset == endOffset)
                    endPosition._SetPositionParagraph(this.OwnerParagraph, startOffset);
            }
            else
                endPosition._SetPositionParagraph(this.OwnerParagraph, startOffset);
            endSelection = true;
        };
        FieldEndAdv.prototype._GetPreviousWordOffset = function (indexInInline, type, isInField, isStarted, endSelection, endPosition) {
            var startOffset = this.OwnerParagraph._GetOffset(this, 0);
            var endOffset = startOffset + this.Length;
            if (this.FieldSeparator == null)
                this.fieldBegin._GetPreviousWordOffset(0, type, isInField, isStarted, endSelection, endPosition);
            else if (this.fieldBegin != null && type != 0) {
                var inline = this.PreviousNode;
                if (inline == null || (inline.OwnerParagraph == this.fieldBegin.OwnerParagraph && !inline.OwnerParagraph._HasValidInline(inline, this.fieldBegin)))
                    inline = this.fieldBegin;
                inline._GetPreviousWordOffset(inline.Length, type, !(endPosition.Paragraph == this.OwnerParagraph && endPosition.Offset == endOffset), isStarted, endSelection, endPosition);
                if (endSelection && endPosition.Paragraph == this.OwnerParagraph && endPosition.Offset == startOffset) {
                    endPosition._SetPositionParagraph(this.OwnerParagraph, endOffset);
                    return;
                }
                if (!endSelection)
                    endPosition._SetPositionParagraph(this.fieldBegin.OwnerParagraph, this.fieldBegin.OwnerParagraph._GetOffset(this.fieldBegin, 0));
            }
        };
        FieldEndAdv.prototype._InsertText = function (selection, text, index) {
            var span = new SpanAdv(this);
            span.Text = text;
            var spanIndex = this.OwnerParagraph.Inlines._IndexOf(this);
            span.CharacterFormat._CopyFormat(this.CharacterFormat);
            this.OwnerParagraph.Inlines._Insert(spanIndex + 1, span);
        };
        FieldEndAdv.prototype._Clone = function () {
            var fieldEnd = new FieldEndAdv(this);
            fieldEnd.CharacterFormat._CopyFormat(this.CharacterFormat);
            return fieldEnd;
        };
        return FieldEndAdv;
    }(FieldCharacterAdv));
    DocumentEditorFeatures.FieldEndAdv = FieldEndAdv;
    var RequestNavigateEventArgs = (function () {
        function RequestNavigateEventArgs(hyperLink) {
            this.hyperLink = hyperLink;
        }
        Object.defineProperty(RequestNavigateEventArgs.prototype, "Hyperlink", {
            get: function () {
                return this.hyperLink;
            },
            enumerable: true,
            configurable: true
        });
        return RequestNavigateEventArgs;
    }());
    DocumentEditorFeatures.RequestNavigateEventArgs = RequestNavigateEventArgs;
    var HyperLink = (function () {
        function HyperLink(fieldBeginAdv) {
            var fieldCode = fieldBeginAdv._GetFieldCode();
            var lowercase = fieldCode.toLowerCase();
            fieldCode = fieldCode.substring(lowercase.indexOf("hyperlink") + 9);
            this._ParseFieldValues(fieldCode.trim());
        }
        Object.defineProperty(HyperLink.prototype, "NavigationLink", {
            get: function () {
                return this.navigationLink;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(HyperLink.prototype, "LinkType", {
            get: function () {
                return this.linkType;
            },
            enumerable: true,
            configurable: true
        });
        HyperLink.prototype._ParseFieldValue = function (value, switchLevel, endChar) {
            value.string = value.string.substring(1);
            var endIndex = value.string.indexOf(endChar);
            if (endIndex == -1)
                endIndex = value.string.length;
            else {
                if (this.navigationLink == null)
                    this.navigationLink = value.string.substring(0, endIndex);
            }
            value.string = value.string.substring(endIndex + 1).trim();
        };
        HyperLink.prototype._ParseFieldValues = function (value) {
            var Value = {
                "string": value
            };
            var switchLevel = 0;
            while (Value.string.length > 0) {
                var currentChar = Value.string.substring(0, 1);
                switch (currentChar) {
                    case "\"":
                        this._ParseFieldValue(Value, switchLevel, "\"");
                        switchLevel = 0;
                        break;
                    case "\\l":
                    case "\\t":
                        value = value.substring(2);
                    default:
                        this._ParseFieldValue(Value, switchLevel, " ");
                        switchLevel = 0;
                        break;
                }
                Value.string = Value.string.trim();
            }
            this.navigationLink = this.navigationLink.trim();
            if (this.navigationLink.match("http://") || this.navigationLink.match("https://"))
                this.linkType = HyperlinkType.Webpage;
            else if (this.navigationLink.match("mailto:"))
                this.linkType = HyperlinkType.Email;
            else {
                if (this.navigationLink.match("www.")) {
                    this.navigationLink = "http://" + this.navigationLink;
                    this.linkType = HyperlinkType.Webpage;
                }
                else if (this.navigationLink.match("@")) {
                    this.navigationLink = "mailto:" + this.navigationLink;
                    this.linkType = HyperlinkType.Email;
                }
                else
                    this.linkType = HyperlinkType.File;
            }
        };
        return HyperLink;
    }());
    DocumentEditorFeatures.HyperLink = HyperLink;
    var Rect = (function () {
        function Rect(x, y, width, height) {
            this.X = this._left = x;
            this.Y = this._top = y;
            this._right = x + width;
            this._bottom = y + height;
            this.Width = width;
            this.Height = height;
        }
        Object.defineProperty(Rect.prototype, "Left", {
            get: function () {
                return this.X;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(Rect.prototype, "Right", {
            get: function () {
                return this._right;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(Rect.prototype, "Top", {
            get: function () {
                return this.Y;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(Rect.prototype, "Bottom", {
            get: function () {
                return this._bottom;
            },
            enumerable: true,
            configurable: true
        });
        return Rect;
    }());
    DocumentEditorFeatures.Rect = Rect;
    var Line = (function () {
        function Line(x1, y1, x2, y2) {
            this.X1 = 0;
            this.Y1 = 0;
            this.X2 = 0;
            this.Y2 = 0;
            this.X1 = x1;
            this.Y1 = y1;
            this.X2 = x2;
            this.Y2 = y2;
        }
        return Line;
    }());
    DocumentEditorFeatures.Line = Line;
    var Margin = (function () {
        function Margin(leftMargin, topMargin, rightMargin, bottomMargin) {
            this.left = leftMargin;
            this.top = topMargin;
            this.right = rightMargin;
            this.bottom = bottomMargin;
        }
        Object.defineProperty(Margin.prototype, "Left", {
            get: function () {
                return this.left;
            },
            set: function (value) {
                this.left = value;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(Margin.prototype, "Top", {
            get: function () {
                return this.top;
            },
            set: function (value) {
                this.top = value;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(Margin.prototype, "Right", {
            get: function () {
                return this.right;
            },
            set: function (value) {
                this.right = value;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(Margin.prototype, "Bottom", {
            get: function () {
                return this.bottom;
            },
            set: function (value) {
                this.bottom = value;
            },
            enumerable: true,
            configurable: true
        });
        return Margin;
    }());
    DocumentEditorFeatures.Margin = Margin;
    var Point = (function () {
        function Point(xPosition, yPosition) {
            this.x = 0;
            this.y = 0;
            this.x = xPosition;
            this.y = yPosition;
        }
        Object.defineProperty(Point.prototype, "X", {
            get: function () {
                return this.x;
            },
            set: function (value) {
                this.x = value;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(Point.prototype, "Y", {
            get: function () {
                return this.y;
            },
            set: function (value) {
                this.y = value;
            },
            enumerable: true,
            configurable: true
        });
        return Point;
    }());
    DocumentEditorFeatures.Point = Point;
    var TextPosition = (function () {
        function TextPosition(value) {
            this.currentParagraph = null;
            this.offset = 0;
            this.location = new Point(0, 0);
            this.isUpdateLocation = true;
            this.ownerControl = value;
        }
        Object.defineProperty(TextPosition.prototype, "OwnerControl", {
            get: function () {
                return this.ownerControl;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(TextPosition.prototype, "Document", {
            get: function () {
                return this.OwnerControl.Document;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(TextPosition.prototype, "Paragraph", {
            get: function () {
                return this.currentParagraph;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(TextPosition.prototype, "Offset", {
            get: function () {
                return this.offset;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(TextPosition.prototype, "Location", {
            get: function () {
                return this.location;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(TextPosition.prototype, "IsAtParagraphStart", {
            get: function () {
                return this.offset == this.Paragraph._GetStartOffset();
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(TextPosition.prototype, "IsUpdateLocation", {
            get: function () {
                return this.isUpdateLocation;
            },
            set: function (value) {
                this.isUpdateLocation = value;
            },
            enumerable: true,
            configurable: true
        });
        TextPosition.prototype._SetPosition = function (paragraph, positionAtStart) {
            this.currentParagraph = paragraph;
            this.offset = positionAtStart ? paragraph._GetStartOffset() : paragraph._GetLength() + 1;
            this._UpdatePhysicalPosition();
        };
        TextPosition.prototype._SetPositionInternal = function (textPosition) {
            this.currentParagraph = textPosition.currentParagraph;
            this.offset = textPosition.offset;
            this.location = textPosition.location;
        };
        TextPosition.prototype._SetPositionForCurrentIndex = function (hierarchicalIndex) {
            var index = { Index: hierarchicalIndex };
            var paragraph = this.OwnerControl.Document._GetParagraph(index);
            this.offset = parseFloat(index.Index);
            this._SetPositionParagraph(paragraph, this.offset);
        };
        TextPosition.prototype._SetPositionParagraph = function (paragraph, offsetInParagraph) {
            this.currentParagraph = paragraph;
            this.offset = offsetInParagraph;
            this._UpdatePhysicalPosition();
        };
        TextPosition.prototype._SetPositionPhysicalLocation = function (paragraph, inline, index, physicalLocation) {
            var isParagraphEnd = false;
            if (inline == null)
                this.currentParagraph = paragraph;
            else {
                this.currentParagraph = inline.OwnerParagraph;
                if (inline.NextNode instanceof FieldCharacterAdv && index > inline.Length)
                    isParagraphEnd = inline._IsLastRenderedInline(inline.Length);
            }
            this.location = physicalLocation;
            if (isParagraphEnd)
                this.offset = this.currentParagraph._GetLength() + 1;
            else
                this.offset = this.currentParagraph._GetOffset(inline, index);
        };
        TextPosition.prototype._UpdatePhysicalPosition = function () {
            if (this.currentParagraph.ParagraphWidgets.Count > 0 && this.ownerControl.IsLayoutEnabled && this.IsUpdateLocation)
                this.location = this.currentParagraph._GetPhysicalPosition(this.offset);
        };
        TextPosition.prototype._UpdatePhysicalPositionInternal = function (moveNextLine) {
            if (this.currentParagraph.ParagraphWidgets.Count > 0 && this.ownerControl.IsLayoutEnabled && this.IsUpdateLocation)
                this.location = this.currentParagraph._GetPhysicalPositionInternal(this.offset, moveNextLine);
        };
        TextPosition.prototype._SetPositionForSelection = function (paragraph, inline, index, physicalLocation) {
            var isParagraphEnd = false;
            if (inline == null)
                this.currentParagraph = paragraph;
            else {
                this.currentParagraph = inline.OwnerParagraph;
                if (inline.NextNode instanceof FieldCharacterAdv && index > inline.Length)
                    isParagraphEnd = inline._IsLastRenderedInline(inline.Length);
            }
            this.location = physicalLocation;
            if (isParagraphEnd)
                this.offset = this.currentParagraph._GetLength() + 1;
            else
                this.offset = this.currentParagraph._GetOffset(inline, index);
        };
        TextPosition.prototype._ValidateBackwardFieldSelection = function (currentIndex, selectionEndIndex) {
            var textPosition = new TextPosition(this.OwnerControl);
            textPosition._SetPositionForCurrentIndex(currentIndex);
            textPosition.IsUpdateLocation = false;
            var selectionStartIndex = this.OwnerControl.Selection.Start._GetHierarchicalIndexInternal();
            while (currentIndex != selectionEndIndex && TextPosition._IsForwardSelection(selectionEndIndex, currentIndex)) {
                var indexInInline = 0;
                var inlineObj = textPosition.Paragraph._GetInline(textPosition.Offset, indexInInline);
                var inline = inlineObj.inline;
                indexInInline = inlineObj.index;
                if (inline != null) {
                    var nextInline = inline._GetNextRenderedInline(indexInInline);
                    if (nextInline instanceof FieldBeginAdv) {
                        var fieldEndOffset = nextInline.fieldEnd.OwnerParagraph._GetOffset(nextInline.fieldEnd, 1);
                        var fieldEndIndex = nextInline.fieldEnd.OwnerParagraph._GetHierarchicalIndex(fieldEndOffset.toString());
                        if (!TextPosition._IsForwardSelection(fieldEndIndex, selectionStartIndex)) {
                            this.OwnerControl.Selection.Start._SetPositionParagraph(nextInline.fieldEnd.OwnerParagraph, fieldEndOffset);
                            selectionStartIndex = fieldEndIndex;
                        }
                    }
                }
                if (inline instanceof FieldEndAdv && inline.FieldBegin != null) {
                    var fieldBeginOffset = inline.FieldBegin.OwnerParagraph._GetOffset(inline.FieldBegin, 0);
                    var fieldBeginIndex = inline.FieldBegin.OwnerParagraph._GetHierarchicalIndex(fieldBeginOffset.toString());
                    if (!TextPosition._IsForwardSelection(selectionEndIndex, fieldBeginIndex)) {
                        this._MoveToInline(inline.FieldBegin, 0);
                        return;
                    }
                    textPosition._MoveToInline(inline.FieldBegin, 0);
                }
                else
                    textPosition._MovePreviousPosition();
                currentIndex = textPosition._GetHierarchicalIndexInternal();
            }
        };
        TextPosition.prototype._ValidateForwardFieldSelection = function (currentIndex, selectionEndIndex) {
            var textPosition = new TextPosition(this.OwnerControl);
            textPosition._SetPositionForCurrentIndex(currentIndex);
            textPosition.IsUpdateLocation = false;
            var isTextPositionMoved = false;
            while (currentIndex != selectionEndIndex && TextPosition._IsForwardSelection(currentIndex, selectionEndIndex)) {
                if (!isTextPositionMoved) {
                    textPosition._MoveNextPosition();
                    var nextIndex = textPosition._GetHierarchicalIndexInternal();
                    if (currentIndex == nextIndex)
                        break;
                }
                var indexInInline = 0;
                var inlineObj = textPosition.Paragraph._GetInline(textPosition.Offset, indexInInline);
                var inline = inlineObj.inline;
                indexInInline = inlineObj.index;
                if (inline != null) {
                    var selectionStartIndex = this.OwnerControl.Selection.Start._GetHierarchicalIndexInternal();
                    if (indexInInline == inline.Length && inline instanceof FieldEndAdv) {
                        if (inline.OwnerParagraph._GetOffset(inline, 0) == this.offset)
                            return;
                        var fieldBeginOffset = inline.FieldBegin.OwnerParagraph._GetOffset(inline.FieldBegin, 0);
                        var fieldBeginIndex = inline.FieldBegin.OwnerParagraph._GetHierarchicalIndex(fieldBeginOffset.toString());
                        if (!TextPosition._IsForwardSelection(selectionStartIndex, fieldBeginIndex))
                            this.OwnerControl.Selection.Start._SetPositionParagraph(inline.FieldBegin.OwnerParagraph, fieldBeginOffset);
                    }
                    var nextInline = inline._GetNextRenderedInline(indexInInline);
                    if (nextInline != null && nextInline instanceof Inline)
                        inline = nextInline;
                }
                if (isTextPositionMoved = (inline instanceof FieldBeginAdv && inline.fieldEnd != null)) {
                    if (inline.OwnerParagraph._GetOffset(inline, 0) == this.offset)
                        return;
                    var fieldEndOffset = inline.fieldEnd.OwnerParagraph._GetOffset(inline.fieldEnd, 1);
                    var fieldEndIndex = inline.fieldEnd.OwnerParagraph._GetHierarchicalIndex(fieldEndOffset.toString());
                    if (!TextPosition._IsForwardSelection(fieldEndIndex, selectionEndIndex)) {
                        this._MoveToInline(inline.fieldEnd, 1);
                        return;
                    }
                    textPosition._MoveToInline(inline.fieldEnd, 1);
                }
                currentIndex = textPosition._GetHierarchicalIndexInternal();
            }
        };
        TextPosition.prototype._MoveToInline = function (inline, index) {
            this.currentParagraph = inline.OwnerParagraph;
            this.offset = this.currentParagraph._GetOffset(inline, index);
            this._UpdatePhysicalPosition();
        };
        TextPosition.prototype._MovePreviousPosition = function () {
            var indexInInline = 0;
            var inlineObj = this.currentParagraph._GetInline(this.offset, indexInInline);
            var inline = inlineObj.inline;
            indexInInline = inlineObj.index;
            if (inline instanceof FieldEndAdv && inline.FieldBegin != null)
                this._MovePreviousPositionInternal(inline);
            var prevOffset = this.currentParagraph._GetPreviousValidOffset(this.offset);
            if (this.offset > prevOffset)
                this.offset = prevOffset;
            else {
                var previousParagraph = this.currentParagraph._GetPreviousParagraph();
                if (previousParagraph != null) {
                    this.currentParagraph = previousParagraph;
                    this.offset = previousParagraph._GetEndOffset();
                }
            }
            indexInInline = 0;
            inlineObj = this.currentParagraph._GetInline(this.offset, indexInInline);
            inline = inlineObj.inline;
            indexInInline = inlineObj.index;
            if (inline instanceof FieldCharacterAdv) {
                var prevInline = inline._GetPreviousValidInline();
                if (prevInline != null) {
                    inline = prevInline;
                    this.currentParagraph = inline.OwnerParagraph;
                    this.offset = this.currentParagraph._GetOffset(inline, inline.Length);
                    if (inline instanceof FieldBeginAdv)
                        this.offset--;
                }
            }
            this._UpdatePhysicalPosition();
        };
        TextPosition.prototype._MoveNextPosition = function () {
            var inline = this.currentParagraph._GetNextStartInline(this.offset);
            if (inline instanceof FieldBeginAdv && inline.fieldEnd != null) {
                this._MoveNextPositionInternal(inline);
                this._MoveNextPosition();
                return;
            }
            var nextOffset = this.currentParagraph._GetNextValidOffset(this.offset);
            var indexInInline = 0;
            if (nextOffset > this.offset) {
                this.offset = nextOffset;
                var inlineObj = this.currentParagraph._GetInline(this.offset, indexInInline);
                inline = inlineObj.inline;
                indexInInline = inlineObj.index;
                if (inline != null && indexInInline == inline.Length && inline.NextNode instanceof FieldCharacterAdv) {
                    var nextValidInline = inline.NextNode._GetNextValidInline();
                    if (nextValidInline instanceof FieldEndAdv) {
                        inline = nextValidInline;
                        this.offset = this.currentParagraph._GetOffset(inline, 1);
                    }
                }
            }
            else {
                var nextParagraph = this.currentParagraph._GetNextParagraph();
                if (nextParagraph != null) {
                    this.currentParagraph = nextParagraph;
                    this.offset = this.currentParagraph._GetStartOffset();
                }
                var inlineObj = this.currentParagraph._GetInline(this.offset, indexInInline);
                inline = inlineObj.inline;
                indexInInline = inlineObj.index;
                if (inline instanceof FieldEndAdv)
                    this.offset++;
            }
            this._UpdatePhysicalPosition();
        };
        TextPosition.prototype._MoveNextPositionInternal = function (fieldBegin) {
            var inline;
            if (fieldBegin.fieldSeparator == null)
                inline = fieldBegin.fieldEnd;
            else {
                inline = fieldBegin.fieldSeparator;
                this.currentParagraph = inline.OwnerParagraph;
                if (this.currentParagraph == fieldBegin.fieldEnd.OwnerParagraph && !this.currentParagraph._HasValidInline(inline, fieldBegin.fieldEnd))
                    inline = fieldBegin.fieldEnd;
            }
            this.currentParagraph = inline.OwnerParagraph;
            this.offset = this.currentParagraph._GetOffset(inline, 1);
        };
        TextPosition.prototype._MovePreviousPositionInternal = function (fieldEnd) {
            var inline;
            if (fieldEnd.FieldSeparator == null)
                inline = fieldEnd.FieldBegin._GetPreviousValidInline();
            else
                inline = fieldEnd._GetPreviousValidInline();
            this.currentParagraph = inline.OwnerParagraph;
            this.offset = this.currentParagraph._GetOffset(inline, inline instanceof FieldCharacterAdv ? 0 : inline.Length);
        };
        TextPosition.prototype._UpdateTextPositionOnFieldCharacter = function (startPosition) {
            var textPosition = new TextPosition(this.OwnerControl);
            textPosition._SetPositionInternal(startPosition);
            var currentIndex = startPosition._GetHierarchicalIndexInternal();
            var selectionEndIndex = this._GetHierarchicalIndexInternal();
            var isTextPositionMoved = false;
            while (currentIndex != selectionEndIndex && TextPosition._IsForwardSelection(currentIndex, selectionEndIndex)) {
                if (!isTextPositionMoved) {
                    textPosition._MoveNextPosition();
                    var nextIndex = textPosition._GetHierarchicalIndexInternal();
                    if (currentIndex == nextIndex)
                        break;
                }
                var indexInInline = 0;
                var inlineObj = textPosition.Paragraph._GetInline(textPosition.Offset, indexInInline);
                var inline = inlineObj.inline;
                indexInInline = inlineObj.index;
                if (inline != null) {
                    var start = startPosition;
                    if (start == null)
                        return;
                    var selectionStartIndex = start._GetHierarchicalIndexInternal();
                    if (indexInInline == inline.Length && inline instanceof FieldEndAdv && inline.FieldBegin != null) {
                        if (inline.OwnerParagraph._GetOffset(inline, 0) == this.offset)
                            return;
                        var fieldBeginOffset = inline.FieldBegin.OwnerParagraph._GetOffset(inline.FieldBegin, 0);
                        var fieldBeginIndex = inline.FieldBegin.OwnerParagraph._GetHierarchicalIndex(fieldBeginOffset.toString());
                        if (!TextPosition._IsForwardSelection(selectionStartIndex, fieldBeginIndex))
                            startPosition._SetPositionParagraph(inline.FieldBegin.OwnerParagraph, fieldBeginOffset);
                    }
                    inline = inline._GetNextRenderedInline(indexInInline);
                }
                if (isTextPositionMoved = (inline instanceof FieldBeginAdv && inline.fieldEnd != null)) {
                    if (inline.OwnerParagraph._GetOffset(inline, 0) == this.offset)
                        return;
                    var fieldEndOffset = inline.fieldEnd.OwnerParagraph._GetOffset(inline.fieldEnd, 1);
                    var fieldEndIndex = inline.fieldEnd.OwnerParagraph._GetHierarchicalIndex(fieldEndOffset.toString());
                    if (!TextPosition._IsForwardSelection(fieldEndIndex, selectionEndIndex)) {
                        this._MoveToInline(inline.fieldEnd, 1);
                        return;
                    }
                    textPosition._MoveToInline(inline.fieldEnd, 1);
                }
                currentIndex = textPosition._GetHierarchicalIndexInternal();
            }
        };
        TextPosition.prototype._MoveForward = function () {
            var indexInInline = 0;
            var inlineObj = this.currentParagraph._GetInline(this.offset, indexInInline);
            var inline = inlineObj.inline;
            indexInInline = inlineObj.index;
            if (inline != null) {
                if (!this.OwnerControl.Selection.IsEmpty && indexInInline == inline.Length && inline instanceof FieldEndAdv) {
                    var hierarchicalIndex = this.OwnerControl.Selection.Start._GetHierarchicalIndexInternal();
                    var fieldBeginOffset = inline.FieldBegin.OwnerParagraph._GetOffset(inline.FieldBegin, 0);
                    var fieldBeginIndex = inline.FieldBegin.OwnerParagraph._GetHierarchicalIndex(fieldBeginOffset.toString());
                    if (!TextPosition._IsForwardSelection(hierarchicalIndex, fieldBeginIndex)) {
                        this.OwnerControl.Selection.Start._SetPositionParagraph(inline.FieldBegin.OwnerParagraph, fieldBeginOffset);
                        return;
                    }
                }
                inline = inline._GetNextRenderedInline(indexInInline);
            }
            if (inline instanceof FieldBeginAdv && inline.fieldEnd != null) {
                var selectionStartParagraph = this.OwnerControl.Selection.Start.Paragraph;
                var selectionStartIndex = 0;
                var selectionStartInlineObj = selectionStartParagraph._GetInline(this.OwnerControl.Selection.Start.Offset, selectionStartIndex);
                var selectionStartInline = selectionStartInlineObj.inline;
                selectionStartIndex = selectionStartInlineObj.index;
                var nextRenderInline = selectionStartInline._GetNextRenderedInline(selectionStartIndex);
                if (nextRenderInline == inline)
                    this._MoveNextPositionInternal(inline);
                else {
                    inline = inline.fieldEnd;
                    this.currentParagraph = inline.OwnerParagraph;
                    this.offset = this.currentParagraph._GetOffset(inline, 1);
                    this._UpdatePhysicalPosition();
                    return;
                }
            }
            else if (inline instanceof FieldBeginAdv || inline instanceof FieldEndAdv) {
                this.currentParagraph = inline.OwnerParagraph;
                this.offset = this.currentParagraph._GetOffset(inline, 1);
            }
            indexInInline = 0;
            var nextOffset = this.currentParagraph._GetNextValidOffset(this.offset);
            var length = this.currentParagraph._GetLength() - 1;
            if (this.offset <= nextOffset && this.offset < length + 1) {
                if (this.offset == nextOffset)
                    this.offset = length + 1;
                else {
                    this.offset = nextOffset;
                    var inlineObj_1 = this.currentParagraph._GetInline(this.offset, indexInInline);
                    inline = inlineObj_1.inline;
                    indexInInline = inlineObj_1.index;
                    if (inline != null && indexInInline == inline.Length && inline.NextNode instanceof FieldCharacterAdv) {
                        var nextValidInline = inline.NextNode._GetNextValidInline();
                        if (nextValidInline instanceof FieldEndAdv) {
                            inline = nextValidInline;
                            this.offset = this.currentParagraph._GetOffset(inline, 1);
                        }
                    }
                }
            }
            else {
                var lastParagraph = this.currentParagraph._GetNextSelection(this.OwnerControl.Selection);
                if (lastParagraph != null) {
                    var positionAtEnd = false;
                    if (lastParagraph.Owner instanceof TableCellAdv) {
                        if (this.OwnerControl.Selection.Start.Paragraph.IsInsideTable) {
                            var containerCell = this.OwnerControl.Selection.Start.Paragraph.AssociatedCell._GetContainerCellOf(lastParagraph.AssociatedCell);
                            positionAtEnd = !containerCell._Contains(lastParagraph.AssociatedCell);
                        }
                        else
                            positionAtEnd = true;
                    }
                    this.currentParagraph = lastParagraph;
                    this.offset = positionAtEnd ? this.currentParagraph._GetLength() + 1 : 1;
                }
                var inlineObj_2 = this.currentParagraph._GetInline(this.offset, indexInInline);
                inline = inlineObj_2.inline;
                indexInInline = inlineObj_2.index;
                if (inline instanceof FieldEndAdv)
                    this.offset++;
            }
            this._UpdatePhysicalPosition();
        };
        TextPosition.prototype._MoveBackward = function () {
            var indexInInline = 0;
            var inlineObj = this.currentParagraph._GetInline(this.offset, indexInInline);
            var inline = inlineObj.inline;
            indexInInline = inlineObj.index;
            if (!this.OwnerControl.Selection.IsEmpty && inline != null) {
                var nextInline = inline._GetNextRenderedInline(indexInInline);
                if (nextInline instanceof FieldBeginAdv) {
                    var hierarchicalIndex = this.OwnerControl.Selection.Start._GetHierarchicalIndexInternal();
                    var fieldEndOffset = nextInline.fieldEnd.OwnerParagraph._GetOffset(nextInline.fieldEnd, 1);
                    var fieldEndIndex = nextInline.fieldEnd.OwnerParagraph._GetHierarchicalIndex(fieldEndOffset.toString());
                    if (!TextPosition._IsForwardSelection(fieldEndIndex, hierarchicalIndex)) {
                        this.OwnerControl.Selection.Start._SetPositionParagraph(nextInline.fieldEnd.OwnerParagraph, fieldEndOffset);
                        return;
                    }
                }
            }
            if (inline instanceof FieldEndAdv && inline.FieldBegin != null) {
                var hierarchicalIndex = this.OwnerControl.Selection.Start._GetHierarchicalIndexInternal();
                var fieldEndOffset = inline.OwnerParagraph._GetOffset(inline, 1);
                var fieldEndIndex = inline.OwnerParagraph._GetHierarchicalIndex(fieldEndOffset.toString());
                if (!TextPosition._IsForwardSelection(hierarchicalIndex, fieldEndIndex)) {
                    var fieldBeginOffset = inline.FieldBegin.OwnerParagraph._GetOffset(inline.FieldBegin, 0);
                    this.currentParagraph = inline.FieldBegin.OwnerParagraph;
                    this.offset = fieldBeginOffset;
                    this._UpdatePhysicalPosition();
                    return;
                }
                this._MovePreviousPositionInternal(inline);
            }
            var prevOffset = this.currentParagraph._GetPreviousValidOffset(this.offset);
            if (this.offset > prevOffset)
                this.offset = prevOffset;
            else {
                var lastParagraph = this.currentParagraph._GetPreviousSelection(this.OwnerControl.Selection);
                if (lastParagraph != null) {
                    var positionAtStart = false;
                    if (lastParagraph.Owner instanceof TableCellAdv) {
                        if (this.OwnerControl.Selection.Start.Paragraph.IsInsideTable) {
                            var containerCell = this.OwnerControl.Selection.Start.Paragraph.AssociatedCell._GetContainerCellOf(lastParagraph.AssociatedCell);
                            positionAtStart = !containerCell._Contains(lastParagraph.AssociatedCell);
                        }
                        else
                            positionAtStart = true;
                    }
                    this.currentParagraph = lastParagraph;
                    this.offset = positionAtStart ? this.currentParagraph._GetStartOffset() : this.currentParagraph._GetEndOffset();
                }
            }
            indexInInline = 0;
            inlineObj = this.currentParagraph._GetInline(this.offset, indexInInline);
            inline = inlineObj.inline;
            indexInInline = inlineObj.index;
            if (inline instanceof FieldCharacterAdv) {
                var prevInline = inline._GetPreviousValidInline();
                if (prevInline != null) {
                    inline = prevInline;
                    this.currentParagraph = inline.OwnerParagraph;
                    this.offset = this.currentParagraph._GetOffset(inline, inline instanceof FieldBeginAdv ? 0 : inline.Length);
                }
            }
            this._UpdatePhysicalPosition();
        };
        TextPosition.prototype._MoveToWordEnd = function (type, excludeSpace) {
            var endOffset = this.currentParagraph._GetEndOffset();
            if (this.offset == endOffset || this.offset == endOffset + 1) {
                if (this.offset == endOffset && type != 0)
                    this._SetPositionParagraph(this.currentParagraph, endOffset + 1);
                else {
                    var nextParagraph = this.currentParagraph._GetNextParagraph();
                    if (nextParagraph == null)
                        return;
                    this.currentParagraph = nextParagraph;
                    this.offset = this.currentParagraph._GetStartOffset();
                    if (type == 1) {
                        if ((this.OwnerControl.Selection.Start.Paragraph.IsInsideTable || this.Paragraph.IsInsideTable)
                            && (this.OwnerControl.Selection.Start.Paragraph.AssociatedCell != this.Paragraph.AssociatedCell || this.OwnerControl.Selection.Start.Paragraph.AssociatedCell._IsCellSelected(this.OwnerControl.Selection.Start, this)))
                            this._MoveToNextParagraphInTable();
                        else
                            this._MoveToWordEnd(type, excludeSpace);
                    }
                }
            }
            else {
                var indexInInline = 0;
                var endSelection = false;
                var EndSelection = { endSelection: endSelection };
                var inlineObj = this.currentParagraph._GetInline(this.Offset, indexInInline);
                var inline = inlineObj.inline;
                indexInInline = inlineObj.index;
                inline._GetNextWordOffset(indexInInline, type, false, EndSelection.endSelection, this, excludeSpace);
            }
            if (type != 0) {
                var selectionStartIndex = this.OwnerControl.Selection.Start._GetHierarchicalIndexInternal();
                var selectionEndIndex = this._GetHierarchicalIndexInternal();
                if (selectionStartIndex != selectionEndIndex)
                    this._ValidateForwardFieldSelection(selectionStartIndex, selectionEndIndex);
            }
            this._UpdatePhysicalPosition();
        };
        TextPosition.prototype._MoveToWordStart = function (type) {
            var endOffset = this.currentParagraph._GetEndOffset();
            if (type == 2 && (this.offset == endOffset || this.offset == endOffset + 1))
                return;
            if (this.offset == endOffset + 1) {
                this.offset = endOffset;
            }
            else if (this.offset == this.currentParagraph._GetStartOffset()) {
                var previousParagraph = this.currentParagraph._GetPreviousParagraph();
                if (previousParagraph == null)
                    return;
                this.currentParagraph = previousParagraph;
                this.offset = this.currentParagraph._GetEndOffset();
            }
            else {
                var isStarted = false;
                var endSelection = false;
                var indexInInline = 0;
                var inlineObj = this.currentParagraph._GetInline(this.offset, indexInInline);
                var inline = inlineObj.inline;
                indexInInline = inlineObj.index;
                inline._GetPreviousWordOffset(indexInInline, type, inline instanceof FieldEndAdv, isStarted, endSelection, this);
            }
            if (type == 1) {
                var selectionStartIndex = this.OwnerControl.Selection.Start._GetHierarchicalIndexInternal();
                var selectionEndIndex = this._GetHierarchicalIndexInternal();
                if (selectionStartIndex != selectionEndIndex)
                    this._ValidateBackwardFieldSelection(selectionStartIndex, selectionEndIndex);
            }
            this._UpdatePhysicalPosition();
        };
        TextPosition.prototype._MoveToLineStart = function (movepreviousline) {
            if (this.Location.X > this.OwnerControl.Viewer.ClientActiveArea.Right)
                this.offset = this.offset - 1;
            var currentLine = this.currentParagraph._GetLineWidgetInternal(this.offset, movepreviousline);
            var firstElement = currentLine._GetFirstElementInternal();
            var startOffset = this.currentParagraph._GetStartOffset();
            if (firstElement == null && this.offset > startOffset)
                this.offset = startOffset;
            else if (firstElement != null) {
                var indexInInline = firstElement._GetIndexInInline();
                this.currentParagraph = firstElement.Inline.OwnerParagraph;
                this.offset = this.currentParagraph._GetOffset(firstElement.Inline, indexInInline);
                indexInInline = 0;
                var inlineObj = this.currentParagraph._GetInline(this.offset, indexInInline);
                var inline = inlineObj.inline;
                indexInInline = inlineObj.index;
                if (inline instanceof FieldCharacterAdv) {
                    var prevInline = inline._GetPreviousValidInline();
                    if (prevInline != null) {
                        inline = prevInline;
                        this.currentParagraph = inline.OwnerParagraph;
                        this.offset = this.currentParagraph._GetOffset(inline, inline.Length);
                        if (inline instanceof FieldBeginAdv)
                            this.offset--;
                    }
                }
            }
            this._UpdatePhysicalPosition();
        };
        TextPosition.prototype._MoveToLineEnd = function (movetonextline) {
            if (this.Location.X > this.OwnerControl.Viewer.ClientActiveArea.Right)
                this.offset = this.offset - 1;
            var currentLine = this.currentParagraph._GetLineWidget(this.offset);
            var firstElement = currentLine._GetFirstElementInternal();
            if (firstElement == null && this.offset == this.Paragraph._GetStartOffset()) {
                this.offset = this.Paragraph._GetLength() + 1;
                this._UpdatePhysicalPosition();
            }
            else if (firstElement != null) {
                var lastElement = currentLine.Children[currentLine.Children.Count - 1];
                var index = lastElement._GetIndexInInline();
                index += lastElement instanceof TextElementBox ? lastElement.Length : 1;
                this.currentParagraph = lastElement.Inline.OwnerParagraph;
                if (index == lastElement.Inline.Length
                    && lastElement.Inline.NextNode == null)
                    this.offset = this.currentParagraph._GetLength() + 1;
                else {
                    var inline = lastElement.Inline;
                    while (inline != null && inline.Length == index && inline.NextNode instanceof FieldCharacterAdv) {
                        var nextInline = inline.NextNode._GetNextValidInline();
                        if (inline != nextInline) {
                            inline = nextInline;
                            index = 0;
                        }
                        if (inline instanceof FieldBeginAdv && inline.fieldEnd != null) {
                            var fieldBegin = inline;
                            if (fieldBegin.fieldSeparator == null)
                                inline = fieldBegin.fieldEnd;
                            else {
                                inline = fieldBegin.fieldSeparator;
                                this.currentParagraph = inline.OwnerParagraph;
                                if (this.currentParagraph == fieldBegin.fieldEnd.OwnerParagraph && !this.currentParagraph._HasValidInline(inline, fieldBegin.fieldEnd))
                                    inline = fieldBegin.fieldEnd;
                            }
                            this.currentParagraph = inline.OwnerParagraph;
                        }
                        if (inline instanceof FieldCharacterAdv)
                            index = 1;
                    }
                    if (index == inline.Length && inline.NextNode == null)
                        index++;
                    this.offset = this.currentParagraph._GetOffset(inline, index);
                }
                this._UpdatePhysicalPositionInternal(movetonextline);
            }
        };
        TextPosition.prototype._MoveToNextLine = function (left) {
            var textPosition = new TextPosition(this.OwnerControl);
            textPosition._SetPositionInternal(this);
            var currentIndex = this._GetHierarchicalIndexInternal();
            var currentLine = this.currentParagraph._GetLineWidget(this.offset);
            this._MoveToLineEnd(true);
            var isMoveToLineEnd = !textPosition._IsAtSamePosition(this);
            textPosition._SetPositionInternal(this);
            if (this.currentParagraph.IsInsideTable)
                this._MoveDownInTable();
            else
                this._MoveForward();
            var nextLine = this.currentParagraph._GetLineWidget(this.offset);
            var lineStart = nextLine._GetLeft();
            var firstElement = nextLine._GetFirstElementInternal();
            var firstItemWidth = firstElement == null ? nextLine._GetWidth(true) : nextLine._GetLeftInternal(firstElement, 1) - lineStart;
            if (lineStart < left && (firstItemWidth / 2 < left - lineStart)) {
                var top_4 = nextLine._GetTop();
                var point = new Point(left, top_4);
                nextLine._UpdateTextPositionWidget(this.OwnerControl, point, this, true);
                var width = nextLine._GetWidth(true);
                if (width < left - lineStart)
                    this._MoveToLineEnd(true);
            }
            else if (isMoveToLineEnd && this.currentParagraph.IsInsideTable
                && this.currentParagraph.Owner == this.OwnerControl.Selection.Start.currentParagraph.Owner)
                this._SetPositionInternal(textPosition);
            else if (!isMoveToLineEnd)
                this._MoveToLineEnd(true);
            var selectionEndIndex = this._GetHierarchicalIndexInternal();
            this._ValidateForwardFieldSelection(currentIndex, selectionEndIndex);
        };
        TextPosition.prototype._MoveDownInTable = function () {
            var isPositionUpdated = false;
            var isForwardSelection = this.OwnerControl.Selection.IsEmpty || this.OwnerControl.Selection.IsForward;
            if (isPositionUpdated = this.OwnerControl.Selection.Start.Paragraph.IsInsideTable) {
                var startCell = this.OwnerControl.Selection.Start.Paragraph.AssociatedCell;
                var endCell = this.currentParagraph.AssociatedCell;
                var containerCell = startCell._GetContainerCellOf(endCell);
                if (isPositionUpdated = containerCell.OwnerTable._Contains(endCell)) {
                    startCell = startCell._GetSelectedCell(containerCell);
                    endCell = endCell._GetSelectedCell(containerCell);
                    var isInContainerCell = containerCell._Contains(this.currentParagraph.AssociatedCell);
                    var isContainerCellSelected = containerCell._IsCellSelected(this.OwnerControl.Selection.Start, this);
                    if ((isInContainerCell && isContainerCellSelected
                        || !isInContainerCell) && endCell.OwnerRow.NextNode != null) {
                        var row = endCell.OwnerRow.NextNode;
                        var cell = row._GetLastCellInRegion(containerCell, this.OwnerControl.Selection.UpDownSelectionLength, false);
                        this._SetPosition(cell._GetLastParagraph(), false);
                        return;
                    }
                    else if (isInContainerCell && isContainerCellSelected && endCell.OwnerRow.NextNode == null || !isInContainerCell) {
                        if (isForwardSelection) {
                            endCell = endCell.OwnerRow.Cells[endCell.OwnerRow.Cells.Count - 1];
                            this._SetPosition(endCell._GetLastParagraph(), false);
                        }
                        else {
                            endCell = endCell.OwnerRow.Cells[0];
                            this._SetPosition(endCell._GetFirstParagraph(), true);
                        }
                    }
                }
            }
            if (!isPositionUpdated) {
                var cell = this.currentParagraph.AssociatedCell._GetContainerCell();
                if (isForwardSelection) {
                    cell = cell.OwnerRow.Cells[cell.OwnerRow.Cells.Count - 1];
                    this._SetPosition(cell._GetLastParagraph(), false);
                }
                else {
                    cell = cell.OwnerRow.Cells[0];
                    this._SetPosition(cell._GetFirstParagraph(), true);
                }
            }
            this._MoveForward();
        };
        TextPosition.prototype._MoveToPreviousLine = function (left) {
            var currentIndex = this._GetHierarchicalIndexInternal();
            var currentLine = this.currentParagraph._GetLineWidget(this.offset);
            this._MoveToLineStart(true);
            if (this.currentParagraph.IsInsideTable)
                this._MoveUpInTable();
            else
                this._MoveBackward();
            var prevLine = this.currentParagraph._GetLineWidget(this.offset);
            var lineStart = prevLine._GetLeft();
            var lineWidth = prevLine._GetWidth(true);
            if (lineWidth + lineStart >= left && currentLine != prevLine) {
                var top_5 = prevLine._GetTop();
                var point = new Point(left, top_5);
                prevLine._UpdateTextPositionWidget(this.OwnerControl, point, this, true);
            }
            var selectionEndIndex = this._GetHierarchicalIndexInternal();
            this._ValidateBackwardFieldSelection(currentIndex, selectionEndIndex);
        };
        TextPosition.prototype._MoveUpInTable = function () {
            var isPositionUpdated = false;
            var end = this.OwnerControl.Selection.End;
            var isBackwardSelection = !this.OwnerControl.Selection.IsEmpty;
            if (isPositionUpdated = end.Paragraph.IsInsideTable) {
                var startCell = this.currentParagraph.AssociatedCell;
                var endCell = end.Paragraph.AssociatedCell;
                var containerCell = endCell._GetContainerCellOf(startCell);
                if (isPositionUpdated = containerCell.OwnerTable._Contains(startCell)) {
                    endCell = endCell._GetSelectedCell(containerCell);
                    startCell = startCell._GetSelectedCell(containerCell);
                    var isInContainerCell = containerCell._Contains(this.currentParagraph.AssociatedCell);
                    var isContainerCellSelected = containerCell._IsCellSelected(this, end);
                    if (!isContainerCellSelected)
                        isContainerCellSelected = this.currentParagraph == containerCell._GetFirstParagraph() && this.IsAtParagraphStart;
                    if ((isInContainerCell && isContainerCellSelected
                        || !isInContainerCell) && startCell.OwnerRow.PreviousNode != null) {
                        var row = startCell.OwnerRow.PreviousNode;
                        var cell = row._GetFirstCellInRegion(containerCell, this.OwnerControl.Selection.UpDownSelectionLength, true);
                        this._SetPosition(cell._GetFirstParagraph(), true);
                        return;
                    }
                    else if (isInContainerCell && isContainerCellSelected && startCell.OwnerRow.PreviousNode == null || !isInContainerCell) {
                        if (isBackwardSelection) {
                            startCell = startCell.OwnerRow.Cells[0];
                            this._SetPosition(startCell._GetFirstParagraph(), true);
                        }
                        else {
                            startCell = startCell.OwnerRow.Cells[startCell.OwnerRow.Cells.Count - 1];
                            this._SetPosition(startCell._GetLastParagraph(), false);
                        }
                    }
                }
            }
            if (!isPositionUpdated) {
                var cell = this.currentParagraph.AssociatedCell._GetContainerCell();
                if (isBackwardSelection) {
                    cell = cell.OwnerRow.Cells[0];
                    this._SetPosition(cell._GetFirstParagraph(), true);
                }
                else {
                    cell = cell.OwnerRow.Cells[cell.OwnerRow.Cells.Count - 1];
                    this._SetPosition(cell._GetLastParagraph(), false);
                }
            }
            this._MoveBackward();
        };
        TextPosition.prototype._MoveToParagraphStart = function (moveToPreviousParagraph) {
            var startOffset = this.currentParagraph._GetStartOffset();
            if (this.offset == startOffset && moveToPreviousParagraph) {
                if ((this.OwnerControl.Selection.Start.Paragraph.IsInsideTable || this.Paragraph.IsInsideTable)
                    && (this.OwnerControl.Selection.Start.Paragraph.AssociatedCell != this.Paragraph.AssociatedCell
                        || this.OwnerControl.Selection.Start.Paragraph.AssociatedCell._IsCellSelected(this.OwnerControl.Selection.Start, this)))
                    this._MoveToPreviousParagraphInTable();
                else if (this.currentParagraph._GetPreviousParagraph() != null) {
                    this.currentParagraph = this.currentParagraph._GetPreviousParagraph();
                    this.offset = this.currentParagraph._GetStartOffset();
                }
            }
            else
                this.offset = this.currentParagraph._GetStartOffset();
            var selectionStartIndex = this.OwnerControl.Selection.Start._GetHierarchicalIndexInternal();
            var selectionEndIndex = this._GetHierarchicalIndexInternal();
            if (selectionStartIndex != selectionEndIndex)
                this._ValidateBackwardFieldSelection(selectionStartIndex, selectionEndIndex);
            this._UpdatePhysicalPosition();
        };
        TextPosition.prototype._MoveToParagraphEnd = function (moveToNextParagraph) {
            var startParagraph = this.OwnerControl.Selection.Start.Paragraph;
            var endOffset = this.currentParagraph._GetEndOffset() + 1;
            if (this.offset == endOffset && moveToNextParagraph) {
                if ((this.OwnerControl.Selection.Start.Paragraph.IsInsideTable || this.Paragraph.IsInsideTable)
                    && (this.OwnerControl.Selection.Start.Paragraph.AssociatedCell != this.Paragraph.AssociatedCell
                        || this.OwnerControl.Selection.Start.Paragraph.AssociatedCell._IsCellSelected(this.OwnerControl.Selection.Start, this)))
                    this._MoveToNextParagraphInTable();
                else if (this.currentParagraph._GetNextParagraph() != null) {
                    this.currentParagraph = this.currentParagraph._GetNextParagraph();
                    this.offset = this.currentParagraph._GetEndOffset() + 1;
                }
            }
            else
                this.offset = this.currentParagraph._GetEndOffset() + 1;
            var selectionStartIndex = this.OwnerControl.Selection.Start._GetHierarchicalIndexInternal();
            var selectionEndIndex = this._GetHierarchicalIndexInternal();
            if (selectionStartIndex != selectionEndIndex)
                this._ValidateForwardFieldSelection(selectionStartIndex, selectionEndIndex);
            this._UpdatePhysicalPosition();
        };
        TextPosition.prototype._MoveToPreviousParagraphInTable = function () {
            var previousParagraph;
            if (this.currentParagraph.IsInsideTable)
                previousParagraph = this.currentParagraph.AssociatedCell._GetPreviousSelection(this.OwnerControl.Selection);
            else
                previousParagraph = this.currentParagraph._GetPreviousParagraph();
            if (previousParagraph == null)
                return;
            this.currentParagraph = previousParagraph;
            this.offset = this.currentParagraph._GetStartOffset();
        };
        TextPosition.prototype._MoveToNextParagraphInTable = function () {
            var nextParagraph;
            if (this.currentParagraph.IsInsideTable)
                nextParagraph = this.currentParagraph.AssociatedCell._GetNextSelection(this.OwnerControl.Selection);
            else
                nextParagraph = this.currentParagraph._GetNextParagraph();
            if (nextParagraph == null)
                return;
            this.currentParagraph = nextParagraph;
            this.offset = this.currentParagraph._GetEndOffset() + 1;
        };
        TextPosition.prototype._MoveToPreviousParagraph = function () {
            var startOffset = this.currentParagraph._GetStartOffset();
            if (this.offset == startOffset && this.currentParagraph._GetPreviousParagraph() != null) {
                this.currentParagraph = this.currentParagraph._GetPreviousParagraph();
                this.offset = this.currentParagraph._GetStartOffset();
            }
            else
                this.offset = this.currentParagraph._GetStartOffset();
            this._UpdatePhysicalPosition();
        };
        TextPosition.prototype._MoveToNextParagraph = function () {
            if (this.currentParagraph._GetNextParagraph() != null) {
                this.currentParagraph = this.currentParagraph._GetNextParagraph();
                this.offset = this.currentParagraph._GetStartOffset();
                this._UpdatePhysicalPosition();
            }
        };
        TextPosition.prototype._MoveDown = function (left) {
            var prevParagraph = this.currentParagraph;
            var prevOffset = this.offset;
            this._MoveToLineEnd(true);
            var length = this.currentParagraph._GetLength();
            if (this.offset > length)
                this.offset = length;
            this._MoveNextPosition();
            var nextLine = null;
            if (prevParagraph.IsInsideTable && prevParagraph != this.currentParagraph && prevParagraph.AssociatedCell != this.currentParagraph.AssociatedCell) {
                var ownerRow = this.currentParagraph.AssociatedCell.OwnerRow;
                if (prevParagraph.IsInsideTable && prevParagraph.AssociatedCell.CellFormat.RowSpan > 1 && prevParagraph.AssociatedCell.CellFormat.RowSpan + prevParagraph.AssociatedCell.OwnerRow.RowIndex == prevParagraph.AssociatedCell.OwnerTable.Rows.Count) {
                    ownerRow = this.currentParagraph.AssociatedCell.OwnerTable.Rows[this.currentParagraph.AssociatedCell.OwnerTable.Rows.Count - 1];
                }
                if (ownerRow.NextNode instanceof TableRowAdv) {
                    var cell = ownerRow.NextNode._GetLastCellInRegion(this.currentParagraph.AssociatedCell, left, false);
                    this._SetPosition(cell._GetFirstParagraph(), true);
                }
                else {
                    var nextBlock = ownerRow.OwnerTable._GetNextRenderedBlock();
                    do {
                        if (nextBlock instanceof TableAdv)
                            nextBlock = nextBlock._GetFirstBlockInFirstCell();
                    } while (nextBlock instanceof TableAdv);
                    if (nextBlock instanceof ParagraphAdv)
                        this._SetPosition(nextBlock, true);
                }
                nextLine = this.currentParagraph._GetLineWidget(this.offset);
            }
            else {
                if (!prevParagraph.IsInsideTable && this.currentParagraph.IsInsideTable) {
                    var cell = this.currentParagraph.AssociatedCell.OwnerRow._GetLastCellInRegion(this.currentParagraph.AssociatedCell, this.OwnerControl.Selection.UpDownSelectionLength, false);
                    this._SetPosition(cell._GetFirstParagraph(), true);
                }
                nextLine = this.currentParagraph._GetLineWidget(this.offset);
            }
            var top = nextLine._GetTop();
            nextLine._UpdateTextPositionWidget(this.OwnerControl, new Point(left, top), this, false);
        };
        TextPosition.prototype._MoveUp = function (left) {
            var paragraph = this.currentParagraph;
            this._MoveToLineStart(true);
            this._MovePreviousPosition();
            var prevLine = null;
            if (paragraph.IsInsideTable && paragraph != this.currentParagraph && paragraph.AssociatedCell != this.currentParagraph.AssociatedCell && (this.currentParagraph.AssociatedCell != null && (paragraph.AssociatedCell.OwnerRow == this.currentParagraph.AssociatedCell.OwnerRow))) {
                var ownerRow = this.currentParagraph.AssociatedCell.OwnerRow;
                if (ownerRow.PreviousNode instanceof TableRowAdv) {
                    var cell = ownerRow.PreviousNode._GetFirstCellInRegion(this.currentParagraph.AssociatedCell, left, true);
                    this._SetPosition(cell._GetLastParagraph(), false);
                }
                else {
                    var prevBlock = ownerRow.OwnerTable._GetPreviousBlock();
                    do {
                        if (prevBlock instanceof TableAdv)
                            prevBlock = prevBlock._GetLastBlockInLastCell();
                    } while (prevBlock instanceof TableAdv);
                    if (prevBlock instanceof ParagraphAdv)
                        this._SetPosition(prevBlock, false);
                }
                prevLine = this.currentParagraph._GetLineWidget(this.offset);
            }
            else {
                if (!paragraph.IsInsideTable && this.currentParagraph.IsInsideTable) {
                    var cell = this.currentParagraph.AssociatedCell.OwnerRow._GetFirstCellInRegion(this.currentParagraph.AssociatedCell, this.OwnerControl.Selection.UpDownSelectionLength, true);
                    this._SetPosition(cell._GetLastParagraph(), false);
                }
                else if (paragraph.IsInsideTable && (this.currentParagraph.AssociatedCell != null && paragraph.AssociatedCell.OwnerRow.PreviousNode == this.currentParagraph.AssociatedCell.OwnerRow)) {
                    var cell = this.currentParagraph.AssociatedCell.OwnerRow._GetLastCellInRegion(this.currentParagraph.AssociatedCell, this.OwnerControl.Selection.UpDownSelectionLength, true);
                    this._SetPosition(cell._GetLastParagraph(), false);
                }
                prevLine = this.currentParagraph._GetLineWidget(this.offset);
            }
            var top = prevLine._GetTop();
            prevLine._UpdateTextPositionWidget(this.OwnerControl, new Point(left, top), this, false);
        };
        TextPosition.prototype._IsInSameDocument = function (textPosition) {
            if (textPosition == null)
                throw new RangeError("The textPosition cannot be null.");
            return this.Document == textPosition.Document;
        };
        TextPosition.prototype._IsAtSamePosition = function (textPosition) {
            return this.currentParagraph == textPosition.currentParagraph
                && this.offset == textPosition.offset;
        };
        TextPosition.prototype._IsExistBefore = function (textPosition) {
            if (textPosition == null)
                throw new Error("textPosition is null.");
            if (!this._IsInSameDocument(textPosition))
                throw new Error("textPosition is not in the same document.");
            if (this.currentParagraph == textPosition.currentParagraph)
                return this.offset < textPosition.offset;
            if (this.currentParagraph.Owner == textPosition.currentParagraph.Owner) {
                if (this.currentParagraph.IsInsideTable)
                    return this.currentParagraph.AssociatedCell.Blocks._IndexOf(this.currentParagraph) < textPosition.currentParagraph.AssociatedCell.Blocks._IndexOf(textPosition.currentParagraph);
                else if (this.currentParagraph.Owner instanceof HeaderFooter)
                    return this.currentParagraph.Owner.Blocks.indexOf(this.currentParagraph) < textPosition.currentParagraph.Owner.Blocks.indexOf(textPosition.currentParagraph);
                else if (this.currentParagraph.Owner instanceof CommentAdv)
                    return this.currentParagraph.Owner.Blocks._IndexOf(this.currentParagraph) < textPosition.currentParagraph.Owner.Blocks._IndexOf(textPosition.currentParagraph);
                else
                    return this.currentParagraph.Section.Blocks.indexOf(this.currentParagraph) < textPosition.currentParagraph.Section.Blocks.indexOf(textPosition.currentParagraph);
            }
            return this.currentParagraph._IsExistBefore(textPosition.currentParagraph);
        };
        TextPosition.prototype._IsExistAfter = function (textPosition) {
            if (textPosition == null)
                throw new Error("textPosition is null.");
            if (!this._IsInSameDocument(textPosition))
                throw new Error("textPosition is not in the same document.");
            if (this.currentParagraph == textPosition.currentParagraph)
                return this.offset > textPosition.offset;
            if (this.currentParagraph.Owner == textPosition.currentParagraph.Owner) {
                if (this.currentParagraph.IsInsideTable)
                    return this.currentParagraph.AssociatedCell.Blocks._IndexOf(this.currentParagraph) > textPosition.currentParagraph.AssociatedCell.Blocks._IndexOf(textPosition.currentParagraph);
                else if (this.currentParagraph.Owner instanceof HeaderFooter)
                    return this.currentParagraph.Owner.Blocks._IndexOf(this.currentParagraph) > textPosition.currentParagraph.Owner.Blocks._IndexOf(textPosition.currentParagraph);
                else if (this.currentParagraph.Owner instanceof CommentAdv)
                    return this.currentParagraph.Owner.Blocks._IndexOf(this.currentParagraph) > textPosition.currentParagraph.Owner.Blocks._IndexOf(textPosition.currentParagraph);
                else
                    return this.currentParagraph.Section.Blocks._IndexOf(this.currentParagraph) > textPosition.currentParagraph.Section.Blocks._IndexOf(textPosition.currentParagraph);
            }
            return this.currentParagraph._IsExistAfter(textPosition.currentParagraph);
        };
        TextPosition.prototype._IsInSameParagraph = function (textPosition) {
            if (textPosition == null)
                throw new Error("textPosition is null.");
            return this.Paragraph == textPosition.Paragraph;
        };
        TextPosition.prototype._Clone = function () {
            var textPosition = new TextPosition(this.OwnerControl);
            textPosition.currentParagraph = this.currentParagraph;
            textPosition.offset = this.offset;
            textPosition.location = this.location;
            return textPosition;
        };
        TextPosition.prototype._GetHierarchicalIndexInternal = function () {
            return this.Paragraph._GetHierarchicalIndex(this.Offset.toString());
        };
        TextPosition.prototype._Dispose = function () {
            this.currentParagraph = null;
            this.location = null;
        };
        TextPosition._IsForwardSelection = function (start, end) {
            if (start == end)
                return true;
            start = start.replace(/C;/g, "");
            end = end.replace(/C;/g, "");
            var selectionStart = start.split(";");
            var selectionEnd = end.split(";");
            var length = selectionStart.length;
            if (length > selectionEnd.length)
                length = selectionEnd.length - 1;
            for (var i = 0; i < length; i++) {
                var startOffset = parseFloat(selectionStart[i]);
                var endOffset = parseFloat(selectionEnd[i]);
                if (startOffset != endOffset)
                    return startOffset < endOffset;
            }
            return false;
        };
        return TextPosition;
    }());
    DocumentEditorFeatures.TextPosition = TextPosition;
    var SelectionRange = (function () {
        function SelectionRange(owner) {
            this.SelectedWidgets = null;
            this.ownerControl = owner;
            this.SelectedWidgets = new Dictionary();
        }
        Object.defineProperty(SelectionRange.prototype, "Start", {
            get: function () {
                if (this.start == null && this.ownerControl != null && this.ownerControl.Document != null)
                    this.start = this.ownerControl.Document.DocumentStart;
                return this.start;
            },
            set: function (value) {
                this.start = value;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(SelectionRange.prototype, "End", {
            get: function () {
                if (this.end == null && this.Start != null)
                    this.end = this.Start._Clone();
                return this.end;
            },
            set: function (value) {
                this.end = value;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(SelectionRange.prototype, "IsEmpty", {
            get: function () {
                if (this.Start == null)
                    return true;
                return this.Start._IsAtSamePosition(this.End);
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(SelectionRange.prototype, "IsForward", {
            get: function () {
                return this.Start._IsExistBefore(this.End);
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(SelectionRange.prototype, "OwnerControl", {
            get: function () {
                return this.ownerControl;
            },
            enumerable: true,
            configurable: true
        });
        SelectionRange.prototype._ClearSelectionHighlight = function () {
            var widgets = this.SelectedWidgets.Keys;
            for (var i = 0; i < widgets.Count; i++) {
                this._RemoveSelectionHighlight(widgets[i]);
            }
            this.SelectedWidgets._Clear();
        };
        SelectionRange.prototype._ClearSelectionHighlightInternal = function (widget) {
            this._RemoveSelectionHighlight(widget);
            this.SelectedWidgets._Remove(widget);
        };
        SelectionRange.prototype._RemoveSelectionHighlight = function (widget) {
            var left = 0, top = 0, width = 0, height = 0;
            var page = null;
            if (widget instanceof LineWidget) {
                var lineWidget = widget;
                var currentParaWidget = lineWidget.CurrentParagraphWidget;
                page = (currentParaWidget != undefined || currentParaWidget != null) ? (lineWidget.CurrentParagraphWidget)._GetPage() : null;
                if (page == null)
                    return;
                var widgetInfo = this.SelectedWidgets._Get(widget);
                width = widgetInfo.Width;
                left = widgetInfo.Left;
                top = lineWidget._GetTop();
                height = lineWidget.Height;
            }
            if (widget instanceof TableCellWidget) {
                var tableCellWidget = widget;
                page = tableCellWidget._GetPage();
                if (page == null)
                    return;
                var widgetInfo = this.SelectedWidgets._Get(widget);
                width = widgetInfo.Width;
                left = widgetInfo.Left;
                top = widget.Y;
                height = widget.Height;
            }
            if (page == null)
                return;
            var selectionContainer = document.getElementById(page.Id + "_selection");
            if (selectionContainer == null)
                return;
            var context = selectionContainer.getContext("2d");
            context.clearRect(left, top, width, height);
        };
        SelectionRange.prototype._AddSelectionHighlight = function (CanvasContext, widget, top) {
            if (this.SelectedWidgets._ContainsKey(widget)) {
                var height = widget.Height;
                var widgetInfo = this.SelectedWidgets._Get(widget);
                var width = widgetInfo.Width;
                var left = widgetInfo.Left;
                if (widget.CurrentParagraphWidget.CurrentNode._IsInComment()) {
                    var comment = this.Start.Paragraph._GetOwnerComment();
                    left = left + comment.LayoutedWidget.X;
                }
                CanvasContext.fillStyle = "gray";
                CanvasContext.globalAlpha = 0.4;
                CanvasContext.fillRect(left, top, width, height);
            }
        };
        SelectionRange.prototype._AddSelectionHighlightTable = function (CanvasContext, TableCellWidget) {
            if (this.SelectedWidgets._ContainsKey(TableCellWidget)) {
                var selectionWidget = this.SelectedWidgets._Get(TableCellWidget);
                var left = selectionWidget.Left;
                var top_6 = TableCellWidget.Y;
                var width = selectionWidget.Width;
                var height = TableCellWidget.Height;
                if (TableCellWidget.ContainerWidget.CurrentNode._IsInComment()) {
                    var comment = this.Start.Paragraph._GetOwnerComment();
                    left = left + comment.LayoutedWidget.X;
                }
                CanvasContext.fillStyle = "gray";
                CanvasContext.globalAlpha = 0.4;
                CanvasContext.fillRect(left, top_6, width, height);
            }
        };
        SelectionRange.prototype._GetSelectedContentAsHTML = function () {
            if (this.IsForward)
                return this.Start.Paragraph._GetSelectedContent(this.OwnerControl.Selection, this.Start, this.End);
            else
                return this.End.Paragraph._GetSelectedContent(this.OwnerControl.Selection, this.End, this.Start);
        };
        SelectionRange.prototype._Dispose = function () {
            if (this.start != null) {
                this.start._Dispose();
                this.start = null;
            }
            if (this.end != null) {
                this.end._Dispose();
                this.end = null;
            }
            this._ClearSelectionHighlight();
            this.ownerControl = null;
        };
        return SelectionRange;
    }());
    DocumentEditorFeatures.SelectionRange = SelectionRange;
    var SelectionRangeCollection = (function () {
        function SelectionRangeCollection(documentEditorHelper) {
            this.ranges = new List();
            this.ownerControl = documentEditorHelper;
        }
        Object.defineProperty(SelectionRangeCollection.prototype, "Count", {
            get: function () {
                if (this.ranges != null)
                    return this.ranges.length;
                return 0;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(SelectionRangeCollection.prototype, "OwnerControl", {
            get: function () {
                return this.ownerControl;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(SelectionRangeCollection.prototype, "First", {
            get: function () {
                if (this.ranges != null && this.ranges.Count > 0)
                    return this.ranges[0];
                return null;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(SelectionRangeCollection.prototype, "Last", {
            get: function () {
                if (this.ranges != null && this.ranges.Count > 0)
                    return this.ranges[this.ranges.length - 1];
                return null;
            },
            enumerable: true,
            configurable: true
        });
        SelectionRangeCollection.prototype._Get = function (index) {
            if (index > -1 && index < this.ranges.length)
                return this.ranges[index];
            return null;
        };
        SelectionRangeCollection.prototype._Clear = function () {
            if (this.ranges != null && this.ranges.Count > 0) {
                this.ownerControl.Viewer._ClearSelectionHighlight();
                this.ranges._Clear();
            }
        };
        SelectionRangeCollection.prototype._Contains = function (selectionRange) {
            if (selectionRange == null)
                throw new ReferenceError("SelectionRange cannot be null.");
            if (this.ranges == null)
                return false;
            return this.ranges._Contains(selectionRange);
        };
        SelectionRangeCollection.prototype._Remove = function (selectionRange) {
            if (selectionRange == null)
                throw new ReferenceError("SelectionRange cannot be null.");
            if (this.ranges != null && this.ranges._Contains(selectionRange)) {
                selectionRange._ClearSelectionHighlight();
                this.ranges._Remove(selectionRange);
                this.ownerControl.Viewer._UpdateVisiblePages(true);
                return true;
            }
            return false;
        };
        SelectionRangeCollection.prototype._AddSelection = function (startPosition, endPosition) {
            if (this.ranges == null)
                this.ranges = new List();
            var selectionRange = new SelectionRange(this.ownerControl);
            selectionRange.Start._SetPositionInternal(startPosition);
            selectionRange.End._SetPositionInternal(endPosition);
            if (!selectionRange.IsEmpty) {
                if (selectionRange.IsForward)
                    selectionRange.End._UpdateTextPositionOnFieldCharacter(selectionRange.Start);
                else
                    selectionRange.Start._UpdateTextPositionOnFieldCharacter(selectionRange.End);
                this._CheckSelectionRangesIsExist(selectionRange.Start, selectionRange.End);
            }
            this.ranges._Add(selectionRange);
        };
        SelectionRangeCollection.prototype._CheckSelectionRangesIsExist = function (startPosition, endPosition) {
            var newRangeStart = startPosition;
            var newRangeEnd = endPosition;
            if (newRangeStart._IsAtSamePosition(newRangeEnd))
                return;
            if (!startPosition._IsExistBefore(endPosition)) {
                newRangeStart = endPosition;
                newRangeEnd = startPosition;
            }
            for (var i = 0; i < this.ranges.Count - 1; i++) {
                var selectionRange = this.ranges[i];
                var existingRangeStart = selectionRange.Start;
                var existingRangeEnd = selectionRange.End;
                if (!selectionRange.Start._IsExistBefore(selectionRange.End)) {
                    existingRangeStart = selectionRange.End;
                    existingRangeEnd = selectionRange.Start;
                }
                if (newRangeStart._IsAtSamePosition(existingRangeStart) || newRangeEnd._IsAtSamePosition(existingRangeEnd)
                    || (newRangeStart._IsExistBefore(existingRangeStart) && newRangeEnd._IsExistAfter(existingRangeStart))
                    || (newRangeStart._IsExistBefore(existingRangeEnd) && newRangeEnd._IsExistAfter(existingRangeEnd))
                    || (newRangeStart._IsExistAfter(existingRangeStart) && newRangeEnd._IsExistBefore(existingRangeEnd))) {
                    this._Remove(selectionRange);
                    i--;
                }
            }
        };
        SelectionRangeCollection.prototype._UpdateSelectionRange = function () {
            var range = this.Last;
            var newRangeStart = range.Start;
            var newRangeEnd = range.End;
            if (!range.Start._IsExistBefore(range.End)) {
                newRangeStart = range.End;
                newRangeEnd = range.Start;
            }
            var newRangeIsNotEmpty = !newRangeStart._IsAtSamePosition(newRangeEnd);
            for (var i = 0; i < this.ranges.Count - 1; i++) {
                var selectionRange = this.ranges[i];
                var existingRangeStart = selectionRange.Start;
                var existingRangeEnd = selectionRange.End;
                if (existingRangeStart._IsAtSamePosition(existingRangeEnd)) {
                    this.ranges._RemoveAt(i);
                    i--;
                }
                else if (newRangeIsNotEmpty) {
                    if (!selectionRange.Start._IsExistBefore(selectionRange.End)) {
                        existingRangeStart = selectionRange.End;
                        existingRangeEnd = selectionRange.Start;
                    }
                    if (newRangeStart._IsAtSamePosition(existingRangeStart) || newRangeEnd._IsAtSamePosition(existingRangeEnd)
                        || (newRangeStart._IsExistBefore(existingRangeStart) && newRangeEnd._IsExistAfter(existingRangeStart))
                        || (newRangeStart._IsExistBefore(existingRangeEnd) && newRangeEnd._IsExistAfter(existingRangeEnd))
                        || (newRangeStart._IsExistAfter(existingRangeStart) && newRangeEnd._IsExistBefore(existingRangeEnd))) {
                        this._Remove(selectionRange);
                        i--;
                    }
                }
            }
            if (!newRangeIsNotEmpty)
                this.ranges._RemoveAt(this.ranges.Count - 1);
        };
        SelectionRangeCollection.prototype._ClearSelection = function () {
            if (this.ranges != null && this.ranges.Count > 0) {
                this.ownerControl.Viewer._ClearSelectionHighlight();
                for (var i = 0; i < this.ranges.Count - 1; i++) {
                    this.ranges[i]._Dispose();
                    this.ranges._RemoveAt(i);
                    i--;
                }
                this.OwnerControl.Selection._RetrieveCurrentFormatProperties();
            }
        };
        SelectionRangeCollection.prototype._ClearMultiSelection = function () {
            if (this.ranges != null && this.ranges.length > 1) {
                this.ownerControl.Viewer._ClearSelectionHighlight();
                for (var i = 0; i < this.ranges.Count - 1; i++) {
                    this.ranges[i]._Dispose();
                    this.ranges._RemoveAt(i);
                    i--;
                }
            }
        };
        SelectionRangeCollection.prototype._Dispose = function () {
            if (this.ranges != null && this.ranges.Count > 0) {
                for (var i = 0; i < this.ranges.Count - 1; i++) {
                    this.ranges[i]._Dispose();
                    i--;
                }
                this.ranges._Clear();
                this.ranges = null;
            }
            this.ownerControl = null;
        };
        SelectionRangeCollection.prototype._RemoveSelectionHighlight = function (widget) {
            if (this.ranges == null)
                return;
            for (var i = 0; i < this.ranges.Count; i++) {
                if (this.ranges[i].SelectedWidgets._ContainsKey(widget))
                    this.ranges[i]._RemoveSelectionHighlight(widget);
            }
        };
        SelectionRangeCollection.prototype._ClearSelectionHighlightInternal = function (widget) {
            if (this.ranges == null)
                return;
            for (var i = 0; i < this.ranges.Count; i++) {
                if (this.ranges[i].SelectedWidgets._ContainsKey(widget))
                    this.ranges[i]._ClearSelectionHighlightInternal(widget);
            }
        };
        SelectionRangeCollection.prototype._ClearSelectionHighlight = function () {
            if (this.ranges == null)
                return;
            for (var i = 0; i < this.ranges.Count; i++)
                this.ranges[i]._ClearSelectionHighlight();
        };
        SelectionRangeCollection.prototype._AddSelectionHighlight = function (Context, widget, top) {
            if (this.ranges == null)
                return;
            for (var i = 0; i < this.ranges.Count; i++) {
                this.ranges[i]._AddSelectionHighlight(Context, widget, top);
            }
        };
        SelectionRangeCollection.prototype._AddSelectionHighlightTable = function (Context, TableCellAdv) {
            if (this.ranges == null)
                return;
            for (var i = 0; i < this.ranges.Count; i++) {
                this.ranges[i]._AddSelectionHighlightTable(Context, TableCellAdv);
            }
        };
        return SelectionRangeCollection;
    }());
    DocumentEditorFeatures.SelectionRangeCollection = SelectionRangeCollection;
    var EditingContext = (function () {
        function EditingContext() {
            this.type = EditingContextType.Text;
        }
        Object.defineProperty(EditingContext.prototype, "Type", {
            get: function () {
                return this.type;
            },
            set: function (value) {
                this.type = value;
            },
            enumerable: true,
            configurable: true
        });
        return EditingContext;
    }());
    DocumentEditorFeatures.EditingContext = EditingContext;
    var HTMLParser = (function () {
        function HTMLParser() {
        }
        HTMLParser._ParseHTMLtoLogicalDom = function (htmlString) {
            var div = document.createElement("div");
            div.innerHTML = htmlString;
            this.document = new DocumentAdv(null);
            var section = this._ParseHTMLDomElement(div);
            this.document.Sections._Add(section);
            div.innerHTML = "";
            var documentAdv = this.document;
            this.document = null;
            return documentAdv;
        };
        HTMLParser._ParseHTMLDomElement = function (elements) {
            var section = new SectionAdv(null);
            var element = elements;
            for (var i = 0; i < element.children.length; i++) {
                var block = this._ParseHTMLBlockElement(element.children[i], section.Blocks);
                if (block != null)
                    section.Blocks._Add(block);
            }
            return section;
        };
        HTMLParser._ParseHTMLBlockElement = function (element, blocks) {
            if (element instanceof HTMLParagraphElement) {
                var paragraph = this._ParseParagraphLogicalDom(element, null, false);
                return paragraph;
            }
            else if (element instanceof HTMLTableElement) {
                var table = this._ParseTableLogicalDom(element);
                return table;
            }
            else if (element instanceof HTMLUListElement || element instanceof HTMLOListElement) {
                this._ParseListElement(element, blocks);
                this.listLevelCount--;
            }
        };
        HTMLParser._ParseListElement = function (list, blocks) {
            this.listLevelCount++;
            if (list instanceof HTMLUListElement) {
                if (list.getAttribute("type") != "" && list.getAttribute("type") != "") {
                    if (list.getAttribute("type") == "square")
                        this.listName = "_Bullet_Square";
                    else if (list.getAttribute("type") == "circle")
                        this.listName = "_Bullet_Circle";
                    else if (list.getAttribute("type") == "none")
                        this.listName = "_Bullet_None";
                    else
                        this.listName = "_Bullet_Dot";
                }
                else
                    this.listName = "_Bullet_Dot";
            }
            else if (list instanceof HTMLOListElement) {
                if (list.getAttribute("type") != "" && list.getAttribute("type") != "") {
                    if (list.getAttribute("type") == "a")
                        this.listName = "_Numbered_LowerLetter";
                    else if (list.getAttribute("type") == "A")
                        this.listName = "_Numbered_UpperLetter";
                    else if (list.getAttribute("type") == "i")
                        this.listName = "_Numbered_LowerRoman";
                    else if (list.getAttribute("type") == "I")
                        this.listName = "_Numbered_UpperRoman";
                    else
                        this.listName = "_Numbered_Normal";
                }
                else
                    this.listName = "_Numbered_Normal";
            }
            var currentList = this._GetAbstractListAdv(this.listName);
            if (this.listLevelCount % 9 == 0) {
                if (currentList == null)
                    this.GetOrCreateList(this.listName);
            }
            else
                currentList.Levels._Add(this.CreateListLevel(this.listName, parseInt(list.getAttribute("start"))));
            for (var i = 0; i < list.children.length; i++) {
                var paragraphAdv = this._ParseParagraphLogicalDom(list.children[i], i, true);
                blocks._Add(paragraphAdv);
            }
        };
        HTMLParser.CreateListLevel = function (listName, startAt) {
            var listLevel = new ListLevelAdv(null);
            if (listName.split("_")[1] == "Bullet") {
                listLevel.ListLevelPattern = ListLevelPattern.Bullet;
                listLevel.NumberFormat = listName.split("_")[2] == "Dot" ? ListLevelAdv.DOTBULLET
                    : listName.split("_")[2] == "Square" ? ListLevelAdv.SQUAREBULLET : ListLevelAdv.ARROWBULLET;
                listLevel.CharacterFormat.FontFamily = listName.split("_")[2] == "Square" ? "Wingdings" : "Symbol";
            }
            else {
                listLevel.ListLevelPattern = listName.split("_")[2] == "LowerRoman" ? ListLevelPattern.LowRoman
                    : listName.split("_")[2] == "LowerLetter" ? ListLevelPattern.LowLetter
                        : listName.split("_")[2] == "UpperRoman" ? ListLevelPattern.UpRoman
                            : listName.split("_")[2] == "UpperLetter" ? ListLevelPattern.UpLetter : ListLevelPattern.Arabic;
                listLevel.NumberFormat = "%" + (this.listLevelCount % 9 + 1) + ".";
                listLevel.StartAt = startAt;
            }
            listLevel.ParagraphFormat = new ParagraphFormat(null);
            listLevel.ParagraphFormat.LeftIndent = 48 * this.listLevelCount % 9;
            listLevel.ParagraphFormat.FirstLineIndent = -24;
            return listLevel;
        };
        HTMLParser._GetAbstractListAdv = function (listName) {
            var abstractLists = this.document.AbstractLists;
            if (abstractLists == null)
                return null;
            for (var i = 0; i < abstractLists.length; i++) {
                if (abstractLists[i] != null && abstractLists[i].Name == listName)
                    return abstractLists[i];
            }
            return null;
        };
        HTMLParser.GetOrCreateList = function (listName) {
            var abstractListAdv = this._GetAbstractListAdv(listName);
            if (abstractListAdv == null) {
                var documentAdv = this.document;
                abstractListAdv = new AbstractListAdv(null);
                var list = new ListAdv(null);
                abstractListAdv.AbstractListId = documentAdv.AbstractLists.Count;
                list.ListId = documentAdv.Lists.Count;
                documentAdv.AbstractLists._Add(abstractListAdv);
                documentAdv.Lists._Add(list);
                list.AbstractListId = abstractListAdv.AbstractListId;
                abstractListAdv.Name = listName;
                var listLevel = abstractListAdv.AddListLevel();
                if (listName.split("_")[1] == "Bullet") {
                    listLevel.ListLevelPattern = ListLevelPattern.Bullet;
                    listLevel.NumberFormat = listName.split("_")[2] == "Dot" ? ListLevelAdv.DOTBULLET
                        : listName.split("_")[2] == "Square" ? ListLevelAdv.SQUAREBULLET : ListLevelAdv.ARROWBULLET;
                    listLevel.CharacterFormat.FontFamily = listName.split("_")[2] == "Square" ? "Wingdings" : "Symbol";
                }
                else {
                    listLevel.ListLevelPattern = listName.split("_")[2] == "LowerRoman" ? ListLevelPattern.LowRoman
                        : listName.split("_")[2] == "LowerLetter" ? ListLevelPattern.LowLetter
                            : listName.split("_")[2] == "UpperRoman" ? ListLevelPattern.UpRoman
                                : listName.split("_")[2] == "UpperLetter" ? ListLevelPattern.UpLetter : ListLevelPattern.Arabic;
                    listLevel.NumberFormat = "%" + (this.listLevelCount % 9 + 1) + ".";
                    listLevel.StartAt = 1;
                }
                listLevel.ParagraphFormat = new ParagraphFormat(null);
                listLevel.ParagraphFormat.LeftIndent = 48;
                listLevel.ParagraphFormat.FirstLineIndent = -24;
            }
        };
        HTMLParser._ParseParagraphLogicalDom = function (paragraph, levelNumber, isList) {
            var paragraphAdv = new ParagraphAdv(null);
            var paragrpahFormat = paragraphAdv.ParagraphFormat;
            var style = paragraph.style;
            for (var i = 0; i < paragraph.children.length; i++) {
                var element = paragraph.children[i];
                if (element instanceof HTMLSpanElement) {
                    var span = this._ParseSpanLogicalDom(element);
                    paragraphAdv.Inlines._Add(span);
                }
                else if (element instanceof HTMLImageElement) {
                    var image = this._ParseImageDom(element);
                    paragraphAdv.Inlines._Add(image);
                }
                else if (element instanceof HTMLAnchorElement) {
                    this._AddHyperlink(element, paragraphAdv);
                }
            }
            if (isList) {
                paragrpahFormat.ListFormat.ListId = this._GetListAdv(this.listName).ListId;
                paragrpahFormat.ListFormat.ListLevelNumber = levelNumber % 9;
            }
            if (style.margin != null && style.margin != "") {
                var margin = style.margin.split(" ");
                if (margin[0] != null && margin[0] != "")
                    paragrpahFormat.BeforeSpacing = parseFloat(margin[0]);
                if (margin[1] != null && margin[1] != "")
                    paragrpahFormat.RightIndent = parseFloat(margin[1]);
                if (margin[2] != null && margin[2] != "")
                    paragrpahFormat.AfterSpacing = parseFloat(margin[2]);
                if (margin[3] != null && margin[3] != "")
                    paragrpahFormat.LeftIndent = parseFloat(margin[3]);
            }
            if (style.textIndent != null && style.textIndent != "")
                paragrpahFormat.FirstLineIndent = parseFloat(style.textIndent);
            paragrpahFormat.TextAlignment = this._GetTextAlignment(paragraph.style.textAlign);
            return paragraphAdv;
        };
        HTMLParser._GetTextAlignment = function (textAlign) {
            switch (textAlign) {
                case "right":
                    return TextAlignment.Right;
                case "left":
                    return TextAlignment.Left;
                case "center":
                    return TextAlignment.Center;
                case "justify":
                    return TextAlignment.Justify;
                default:
                    break;
            }
        };
        HTMLParser._ParseSpanLogicalDom = function (span) {
            var spanAdv = new SpanAdv(null);
            var style = span.style;
            var styleAttr = span.getAttribute("style").split(";");
            var characterFormat = spanAdv.CharacterFormat;
            this._ParseCharacterFormat(style, styleAttr, characterFormat);
            if (span.textContent != null && span.textContent != "")
                spanAdv.Text = span.textContent;
            return spanAdv;
        };
        HTMLParser._ParseCharacterFormat = function (style, styleAttr, characterFormat) {
            if (style.fontWeight == "bold")
                characterFormat.Bold = true;
            else
                characterFormat.Bold = false;
            if (style.fontStyle == "italic")
                characterFormat.Italic = true;
            else
                characterFormat.Italic = false;
            if (styleAttr != null) {
                if (styleAttr.indexOf(" text-decoration:underline") > -1)
                    characterFormat.Underline = Underline.Single;
                if (styleAttr.indexOf(" text-decoration:line-through") > -1)
                    characterFormat.StrikeThrough = StrikeThrough.SingleStrike;
            }
            if (style.verticalAlign == "sub")
                characterFormat.BaselineAlignment = BaselineAlignment.Subscript;
            else if (style.verticalAlign == "super")
                characterFormat.BaselineAlignment = BaselineAlignment.Superscript;
            if (style.color != null && style.color != "" && style.color != undefined)
                characterFormat.FontColor = style.color;
            if (style.fontFamily != null && style.fontFamily != "" && style.fontFamily != undefined)
                characterFormat.FontFamily = style.fontFamily;
            if (style.fontSize != null && style.fontSize != "" && style.fontSize != undefined)
                characterFormat.FontSize = parseFloat(style.fontSize);
        };
        HTMLParser._AddHyperlink = function (anchor, paragraphAdv) {
            var fieldBegin = new FieldBeginAdv(null);
            this._ParseCharacterFormat(anchor.style, null, fieldBegin.CharacterFormat);
            paragraphAdv.Inlines._Add(fieldBegin);
            paragraphAdv.Inlines._Add(this._AddFieldCode(anchor, fieldBegin.CharacterFormat));
            var fieldSeparatorAdv = new FieldSeparatorAdv(null);
            fieldSeparatorAdv.CharacterFormat._CopyFormat(fieldBegin.CharacterFormat);
            paragraphAdv.Inlines._Add(fieldSeparatorAdv);
            this._ParseSpanNodes(anchor, paragraphAdv);
            var fieldEndAdv = new FieldEndAdv(null);
            fieldEndAdv.CharacterFormat._CopyFormat(fieldBegin.CharacterFormat);
            paragraphAdv.Inlines._Add(fieldEndAdv);
        };
        HTMLParser._AddFieldCode = function (anchor, characterFormat) {
            var spanadv = null;
            spanadv = new SpanAdv(null);
            spanadv.Text = " HYPERLINK \"" + anchor.getAttribute("href") + "\" ";
            spanadv.CharacterFormat._CopyFormat(characterFormat);
            return spanadv;
        };
        HTMLParser._ParseSpanNodes = function (anchor, paragraphAdv) {
            if (anchor.children != null) {
                for (var i = 0; i < anchor.children.length; i++) {
                    var spanAdv = this._ParseSpanLogicalDom(anchor.children[i]);
                    paragraphAdv.Inlines._Add(spanAdv);
                }
            }
        };
        HTMLParser._ParseImageDom = function (image) {
            var imageAdv = new ImageAdv(null, null, null);
            imageAdv.Width = parseFloat(image.getAttribute("width"));
            imageAdv.Height = parseFloat(image.getAttribute("height"));
            imageAdv.ImageString = image.getAttribute("src");
            return imageAdv;
        };
        HTMLParser._ParseTableLogicalDom = function (table) {
            var tableAdv = new TableAdv(null);
            var tableFormat = tableAdv.TableFormat;
            var tbody = table.tBodies[0];
            for (var i = 0; i < tbody.rows.length; i++) {
                var rowAdv = this._ParseTableRowsLogicalDom(tbody.rows[i]);
                tableAdv.Rows._Add(rowAdv);
            }
            if (table.getAttribute("bgcolor") != null && table.getAttribute("bgcolor") != "")
                tableFormat.Shading.BackgroundColor = table.getAttribute("bgcolor");
            return tableAdv;
        };
        HTMLParser._ParseTableRowsLogicalDom = function (rows) {
            var tableRowAdv = new TableRowAdv(null);
            for (var i = 0; i < rows.cells.length; i++) {
                var cellAdv = this._ParseTableCellsLogicalDom(rows.cells[i]);
                tableRowAdv.Cells._Add(cellAdv);
            }
            return tableRowAdv;
        };
        HTMLParser._ParseTableCellsLogicalDom = function (cells) {
            var tableCellAdv = new TableCellAdv(null);
            for (var i = 0; i < cells.children.length; i++) {
                var block = this._ParseHTMLBlockElement(cells.children[i], tableCellAdv.Blocks);
                if (block != null)
                    tableCellAdv.Blocks._Add(block);
            }
            var cellFormat = tableCellAdv.CellFormat;
            var cssStyle = cells.style;
            cellFormat.RowSpan = parseInt(cells.getAttribute("rowspan"));
            cellFormat.ColumnSpan = parseInt(cells.getAttribute("colspan"));
            if (cells.getAttribute("bgcolor") != null && cells.getAttribute("bgcolor") != "")
                cellFormat.Shading.BackgroundColor = cells.getAttribute("bgcolor");
            cellFormat.CellWidth = parseFloat(cells.getAttribute("width"));
            return tableCellAdv;
        };
        HTMLParser._GetListAdv = function (listName) {
            var abstractList = this._GetAbstractListAdv(listName);
            if (abstractList != null) {
                for (var i = 0; i < this.document.Lists.length; i++) {
                    var list = this.document.Lists[i];
                    if (list.AbstractListId == abstractList.AbstractListId)
                        return list;
                }
            }
            return null;
        };
        HTMLParser.listLevelCount = -1;
        HTMLParser.listName = null;
        return HTMLParser;
    }());
    DocumentEditorFeatures.HTMLParser = HTMLParser;
    var SelectionAdv = (function () {
        function SelectionAdv(documentEditorHelper) {
            this.ownerControl = null;
            this.UpDownSelectionLength = 0;
            this.IsRetrieveFormatting = false;
            this.SkipFormatRetrieval = false;
            this.IsSkipLayouting = false;
            this.editPosition = "";
            this.IsHighlightingCommentRange = false;
            this.NeedToRenderMarker = true;
            this.IsSelectingComment = false;
            this.preservedFontCol = null;
            this.removedCommentCharacters = null;
            this.editingContext = null;
            this.ownerControl = documentEditorHelper;
            this.selectionRanges = new SelectionRangeCollection(documentEditorHelper);
            this.characterFormat = new SelectionCharacterFormat(this);
            this.paragraphFormat = new SelectionParagraphFormat(this);
            this.sectionFormat = new SelectionSectionFormat(this);
            this.rowFormat = new SelectionRowFormat(this);
            this.cellFormat = new SelectionCellFormat(this);
            this.tableFormat = new SelectionTableFormat(this);
            this.removedCommentCharacters = new List();
            this.editingContext = new EditingContext();
        }
        Object.defineProperty(SelectionAdv.prototype, "CanPaste", {
            get: function () {
                return DocumentEditorHelper.htmlString != null
                    && DocumentEditorHelper.htmlString != ""
                    && DocumentEditorHelper.htmlString != undefined;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(SelectionAdv.prototype, "SelectionRanges", {
            get: function () {
                return this.selectionRanges;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(SelectionAdv.prototype, "OwnerControl", {
            get: function () {
                return this.ownerControl;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(SelectionAdv.prototype, "Text", {
            get: function () {
                return this._GetText(false);
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(SelectionAdv.prototype, "EditingContext", {
            get: function () {
                return this.editingContext;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(SelectionAdv.prototype, "IsCleared", {
            get: function () {
                return this.End == null;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(SelectionAdv.prototype, "Start", {
            get: function () {
                var start = null;
                if (this.OwnerControl != null && this.OwnerControl.Document != null) {
                    if (this.SelectionRanges == null)
                        this.SelectionRanges = new SelectionRangeCollection(this.OwnerControl);
                    if (this.OwnerControl.Selection.SelectionRanges.Count == 0 && !(this.OwnerControl.History.IsUndoing || this.OwnerControl.History.IsRedoing)) {
                        start = this.ownerControl.Document.DocumentStart;
                        if (start != null) {
                            this.OwnerControl.Selection.SelectionRanges._AddSelection(start, start);
                            this._FireSelectionChanged(false);
                        }
                    }
                    if (this.OwnerControl.Selection.SelectionRanges.Count > 0)
                        return this.OwnerControl.Selection.SelectionRanges._Get(this.OwnerControl.Selection.SelectionRanges.Count - 1).Start;
                }
                return null;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(SelectionAdv.prototype, "End", {
            get: function () {
                if ((this.OwnerControl.IsDocumentLoaded && this.OwnerControl.Selection.SelectionRanges.Count > 0)
                    || (this.OwnerControl.Selection.SelectionRanges.Count > 0 && this.Start != null))
                    return this.OwnerControl.Selection.SelectionRanges._Get(this.OwnerControl.Selection.SelectionRanges.Count - 1).End;
                return null;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(SelectionAdv.prototype, "IsEmpty", {
            get: function () {
                if (this.Start == null)
                    return true;
                return this.Start._IsAtSamePosition(this.End);
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(SelectionAdv.prototype, "IsForward", {
            get: function () {
                return this.Start._IsExistBefore(this.End);
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(SelectionAdv.prototype, "CurrentSelectionRange", {
            get: function () {
                if (this.OwnerControl.IsDocumentLoaded && this.OwnerControl.Selection.SelectionRanges != null && this.OwnerControl.Selection.SelectionRanges.Count > 0)
                    return this.OwnerControl.Selection.SelectionRanges._Get(this.OwnerControl.Selection.SelectionRanges.Count - 1);
                return null;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(SelectionAdv.prototype, "CharacterFormat", {
            get: function () {
                return this.characterFormat;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(SelectionAdv.prototype, "ParagraphFormat", {
            get: function () {
                return this.paragraphFormat;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(SelectionAdv.prototype, "SectionFormat", {
            get: function () {
                return this.sectionFormat;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(SelectionAdv.prototype, "TableFormat", {
            get: function () {
                return this.tableFormat;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(SelectionAdv.prototype, "CellFormat", {
            get: function () {
                return this.cellFormat;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(SelectionAdv.prototype, "RowFormat", {
            get: function () {
                return this.rowFormat;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(SelectionAdv.prototype, "CurrentHistoryInfo", {
            get: function () {
                return this.currentHistoryInfo;
            },
            set: function (value) {
                this.currentHistoryInfo = value;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(SelectionAdv.prototype, "CurrentBaseHistoryInfo", {
            get: function () {
                return this.currentBaseHistoryInfo;
            },
            set: function (value) {
                this.currentBaseHistoryInfo = value;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(SelectionAdv.prototype, "EditPosition", {
            get: function () {
                return this.editPosition;
            },
            set: function (value) {
                this.editPosition = value;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(SelectionAdv.prototype, "RemovedCommentCharacters", {
            get: function () {
                if (this.removedCommentCharacters == null)
                    this.removedCommentCharacters = new List();
                return this.removedCommentCharacters;
            },
            enumerable: true,
            configurable: true
        });
        SelectionAdv.prototype._ApplyBullet = function (bullet, fontFamily) {
            var list = this.ParagraphFormat._GetList();
            var start = this.Start;
            if (!this.IsForward)
                start = this.End;
            var startListLevel = null;
            if (list != null)
                startListLevel = start.Paragraph.ParagraphFormat.ListFormat.ListLevel;
            if (list == null || (list != null && (startListLevel.ListLevelPattern != ListLevelPattern.Bullet || startListLevel.NumberFormat != bullet
                || startListLevel.CharacterFormat.FontFamily != fontFamily))) {
                list = new ListAdv(null);
                list.AbstractList = new AbstractListAdv(null);
                var listLevel = new ListLevelAdv(list.AbstractList);
                listLevel.ListLevelPattern = ListLevelPattern.Bullet;
                listLevel.NumberFormat = bullet;
                listLevel.CharacterFormat.FontFamily = fontFamily;
                listLevel.ParagraphFormat.LeftIndent = 48;
                listLevel.ParagraphFormat.FirstLineIndent = -24;
                list.AbstractList.Levels._Add(listLevel);
                this.ParagraphFormat._SetList(list);
                this.ParagraphFormat.ListLevelNumber = 0;
            }
            else
                this.ParagraphFormat.ListLevelNumber = -1;
        };
        SelectionAdv.prototype._ApplyNumbering = function (numberFormat, listLevelPattern) {
            var list = this.ParagraphFormat._GetList();
            var start = this.Start;
            if (!this.IsForward)
                start = this.End;
            var startListLevel = null;
            if (list != null)
                startListLevel = start.Paragraph.ParagraphFormat.ListFormat.ListLevel;
            if (list == null || (list != null && (startListLevel.ListLevelPattern != listLevelPattern || startListLevel.NumberFormat != numberFormat))) {
                list = new ListAdv(null);
                list.AbstractList = new AbstractListAdv(null);
                var listLevel = new ListLevelAdv(list.AbstractList);
                listLevel.ListLevelPattern = listLevelPattern;
                listLevel.NumberFormat = numberFormat;
                listLevel.StartAt = 1;
                listLevel.CharacterFormat.FontFamily = "Verdana";
                listLevel.ParagraphFormat.LeftIndent = 48;
                listLevel.ParagraphFormat.FirstLineIndent = -24;
                list.AbstractList.Levels._Add(listLevel);
                this.ParagraphFormat._SetList(list);
                this.ParagraphFormat.ListLevelNumber = 0;
            }
            else
                this.ParagraphFormat.ListLevelNumber = -1;
        };
        SelectionAdv.prototype._GetStart = function () {
            if (this.Start == null)
                return "0;0;0";
            return this.Start._GetHierarchicalIndexInternal();
        };
        SelectionAdv.prototype._GetEnd = function () {
            if (this.End == null)
                return "0;0;0";
            return this.End._GetHierarchicalIndexInternal();
        };
        SelectionAdv.prototype._SelectPositionBy = function (start, end) {
            if (start == "" || end == "")
                return;
            var startPosition = new TextPosition(this.OwnerControl);
            startPosition._SetPositionForCurrentIndex(start);
            var endPosition = new TextPosition(this.OwnerControl);
            endPosition._SetPositionForCurrentIndex(end);
            this._SelectPosition(startPosition, endPosition);
        };
        SelectionAdv.prototype._CanMergeSelectedCells = function () {
            if (this.IsEmpty || !this.Start.Paragraph.IsInsideTable || !this.End.Paragraph.IsInsideTable)
                return false;
            var startPosition = this.Start;
            var endPosition = this.End;
            if (!this.IsForward) {
                startPosition = this.End;
                endPosition = this.Start;
            }
            var containerCell = startPosition.Paragraph.AssociatedCell._GetContainerCellOf(endPosition.Paragraph.AssociatedCell);
            if (containerCell.OwnerTable._Contains(endPosition.Paragraph.AssociatedCell)) {
                if (!containerCell._Contains(endPosition.Paragraph.AssociatedCell)) {
                    var startCell = startPosition.Paragraph.AssociatedCell._GetSelectedCell(containerCell);
                    var endCell = endPosition.Paragraph.AssociatedCell._GetSelectedCell(containerCell);
                    if (startCell.OwnerRow == endCell.OwnerRow)
                        return true;
                    return startCell.OwnerTable._CanMergeSelectedCells(this, startCell, endCell);
                }
            }
            return false;
        };
        SelectionAdv.prototype._UpdateFocus = function () {
            this.OwnerControl.Viewer.EditableDiv.focus();
        };
        SelectionAdv.prototype._ExtendBackward = function (clearMultiSelection) {
            if (this.Start == null)
                return;
            if (clearMultiSelection)
                this.SelectionRanges._ClearMultiSelection();
            this.End._MoveBackward();
            this.UpDownSelectionLength = this.End.Location.X;
            this._FireSelectionChanged(true);
        };
        SelectionAdv.prototype._ExtendForward = function (clearMultiSelection) {
            if (this.Start == null)
                return;
            if (clearMultiSelection)
                this.SelectionRanges._ClearMultiSelection();
            this.End._MoveForward();
            this.UpDownSelectionLength = this.End.Location.X;
            this._FireSelectionChanged(true);
        };
        SelectionAdv.prototype._SelectCurrentWord = function (clearMultiSelection) {
            var startPosition = this.Start._Clone();
            var endPosition = this.End._Clone();
            this._SelectCurrentWordRange(startPosition, endPosition, false);
            this._SelectRange(startPosition, endPosition, clearMultiSelection);
        };
        SelectionAdv.prototype._SelectCurrentWordRange = function (startPosition, endPosition, excludeSpace) {
            if (startPosition != null) {
                if (startPosition.Offset > 0) {
                    var wordStart = startPosition._Clone();
                    var indexInInline = 0;
                    var inlineObj = startPosition.Paragraph._GetInline(startPosition.Offset, indexInInline);
                    var inline = inlineObj.inline;
                    indexInInline = inlineObj.index;
                    if (inline != null && inline instanceof FieldEndAdv) {
                        if (startPosition.Offset > 2 && (inline.FieldSeparator != null || inline.FieldBegin == null)) {
                            wordStart._SetPositionParagraph(wordStart.Paragraph, startPosition.Offset - 2);
                            wordStart._MoveToWordEnd(0, false);
                            if (!(wordStart.Paragraph == startPosition.Paragraph && wordStart.Offset == startPosition.Offset - 1))
                                startPosition._MoveToWordStart(2);
                        }
                        else if (startPosition.Offset > 3 && inline.FieldSeparator == null) {
                            wordStart._SetPositionParagraph(wordStart.Paragraph, startPosition.Offset - 3);
                            wordStart._MoveToWordEnd(0, false);
                            if (!(wordStart.Paragraph == startPosition.Paragraph && wordStart.Offset == startPosition.Offset))
                                startPosition._MoveToWordStart(2);
                        }
                    }
                    else {
                        wordStart._SetPositionParagraph(wordStart.Paragraph, startPosition.Offset - 1);
                        wordStart._MoveToWordEnd(0, false);
                        if (!(wordStart.Paragraph == startPosition.Paragraph && wordStart.Offset == startPosition.Offset))
                            startPosition._MoveToWordStart(2);
                    }
                }
                endPosition._MoveToWordEnd(2, excludeSpace);
            }
        };
        SelectionAdv.prototype._SelectCurrentParagraph = function (clearMultiSelection) {
            if (this.Start != null) {
                if (clearMultiSelection)
                    this.SelectionRanges._ClearMultiSelection();
                this.Start._MoveToParagraphStart(false);
                this.End._MoveToParagraphEnd(false);
                this.UpDownSelectionLength = this.End.Location.X;
                this._FireSelectionChanged(true);
            }
        };
        SelectionAdv.prototype._Select = function (paragraph, inline, index, physicalLocation, clearMultiSelection) {
            if (clearMultiSelection)
                this.SelectionRanges._ClearMultiSelection();
            this.Start._SetPositionForSelection(paragraph, inline, index, physicalLocation);
            this.End._SetPositionInternal(this.Start);
            this.UpDownSelectionLength = physicalLocation.X;
            this._FireSelectionChanged(true);
        };
        SelectionAdv.prototype._SelectRange = function (startPosition, endPosition, clearMultiSelection) {
            if (clearMultiSelection)
                this.SelectionRanges._ClearMultiSelection();
            this.Start._SetPositionInternal(startPosition);
            this.End._SetPositionInternal(endPosition);
            this.UpDownSelectionLength = this.End.Location.X;
            this._FireSelectionChanged(true);
        };
        SelectionAdv.prototype._SelectContent = function (textPosition, clearMultiSelection) {
            if (textPosition == null)
                throw new Error("textPosition is null.");
            if (clearMultiSelection)
                this.SelectionRanges._ClearMultiSelection();
            this.Start._SetPositionInternal(textPosition);
            this.End._SetPositionInternal(textPosition);
            this.UpDownSelectionLength = this.End.Location.X;
            this._FireSelectionChanged(true);
        };
        SelectionAdv.prototype._SelectPosition = function (startPosition, endPosition) {
            if (startPosition == null || endPosition == null)
                throw new Error("TextPosition cannot be null");
            if (startPosition.Paragraph == null || startPosition.Paragraph.Document != this.ownerControl.Document
                || startPosition.Offset > startPosition.Paragraph._GetLength() + 1
                || startPosition.Paragraph.IsInHeaderFooter)
                throw new Error("Start TextPosition is not valid.");
            if (endPosition.Paragraph == null || endPosition.Paragraph.Document != this.ownerControl.Document
                || endPosition.Offset > endPosition.Paragraph._GetLength() + 1
                || endPosition.Paragraph.IsInHeaderFooter)
                throw new Error("End TextPosition is not valid.");
            var startComment = startPosition.Paragraph._GetOwnerComment();
            var endComment = endPosition.Paragraph._GetOwnerComment();
            if ((startComment != null || endComment != null) && startComment != endComment)
                throw new Error("A text position within comment can be selected with another text position within the same comment only.");
            if (startPosition._IsAtSamePosition(endPosition))
                this._SelectRange(startPosition, startPosition, true);
            else {
                if (startPosition._IsExistBefore(endPosition))
                    endPosition._UpdateTextPositionOnFieldCharacter(startPosition);
                else
                    startPosition._UpdateTextPositionOnFieldCharacter(endPosition);
                this._SelectRange(startPosition, endPosition, true);
            }
        };
        SelectionAdv.prototype._Selects = function (paragraph, offset, clearMultiSelection) {
            if (clearMultiSelection)
                this.SelectionRanges._ClearMultiSelection();
            this.Start._SetPositionParagraph(paragraph, offset);
            this.End._SetPositionInternal(this.Start);
            this.UpDownSelectionLength = this.Start.Location.X;
            this._FireSelectionChanged(true);
        };
        SelectionAdv.prototype._SelectAll = function () {
            this.SelectionRanges._ClearMultiSelection();
            if (this._IsInComment() && this.ownerControl.Viewer instanceof PageLayoutViewer) {
                var comment = this.Start.Paragraph._GetOwnerComment();
                var firstParagraph = comment._GetFirstParagraph();
                var lastParagraph = comment.Blocks[comment.Blocks.Count - 1]._GetLastParagraph();
                this.Start._SetPositionParagraph(firstParagraph, firstParagraph._GetStartOffset());
                this.End._SetPositionParagraph(lastParagraph, lastParagraph._GetEndOffset() + 1);
                this.UpDownSelectionLength = this.End.Location.X;
                this._FireSelectionChanged(true);
                return;
            }
            var documentStart = null;
            if (this.OwnerControl.Document != null)
                documentStart = this.OwnerControl.Document.DocumentStart;
            if (documentStart != null) {
                this.Start._SetPositionInternal(documentStart);
                var documentEnd = this.OwnerControl.Document.DocumentEnd;
                this.End._SetPositionParagraph(documentEnd.Paragraph, documentEnd.Offset + 1);
                this.UpDownSelectionLength = this.End.Location.X;
                this._FireSelectionChanged(true);
            }
        };
        SelectionAdv.prototype._OnLeftIndent = function (leftIndent) {
            this._OnLeftIndentInternal(leftIndent, false);
        };
        SelectionAdv.prototype._OnRightIndent = function (rightIndent) {
            if (this.OwnerControl.IsReadOnlyMode || !this.OwnerControl.IsDocumentLoaded)
                return;
            this.ownerControl.IsShiftingEnabled = true;
            this._InitHistory(Actions.RightIndent);
            if (this.IsEmpty) {
                this._InitHistory(Actions.RightIndent);
                this.Start.Paragraph.ParagraphFormat._ApplyPropertyValueInternal(this.CurrentBaseHistoryInfo, "RightIndentProperty", rightIndent);
            }
            else {
                if (this.OwnerControl.Selection.SelectionRanges.Count > 0) {
                    this._UpdateMultipleSelectionParagraphFormatting(Actions.RightIndent, rightIndent, false);
                    return;
                }
            }
            this._Relayout(false);
        };
        SelectionAdv.prototype._OnFirstLineIndent = function (firstLineIndent) {
            this.ownerControl.IsShiftingEnabled = true;
            if (this.IsEmpty) {
                this._InitHistory(Actions.FirstLineIndent);
                this.Start.Paragraph.ParagraphFormat._ApplyPropertyValueInternal(this.CurrentBaseHistoryInfo, "FirstLineIndentProperty", firstLineIndent);
            }
            else {
                if (this.OwnerControl.Selection.SelectionRanges.Count > 0) {
                    this._UpdateMultipleSelectionParagraphFormatting(Actions.FirstLineIndent, firstLineIndent, false);
                    return;
                }
            }
            this._Relayout(false);
        };
        SelectionAdv.prototype._OnBeforeSpacing = function (beforeSpacing) {
            this.ownerControl.IsShiftingEnabled = true;
            if (this.IsEmpty) {
                this._InitHistory(Actions.BeforeSpacing);
                this.Start.Paragraph.ParagraphFormat._ApplyPropertyValueInternal(this.CurrentBaseHistoryInfo, "BeforeSpacingProperty", beforeSpacing);
            }
            else {
                if (this.OwnerControl.Selection.SelectionRanges.Count > 0) {
                    this._UpdateMultipleSelectionParagraphFormatting(Actions.BeforeSpacing, beforeSpacing, false);
                    return;
                }
            }
            this._Relayout(false);
        };
        SelectionAdv.prototype._OnAfterSpacing = function (afterSpacing) {
            this.ownerControl.IsShiftingEnabled = true;
            if (this.IsEmpty) {
                this._InitHistory(Actions.AfterSpacing);
                this.Start.Paragraph.ParagraphFormat._ApplyPropertyValueInternal(this.CurrentBaseHistoryInfo, "AfterSpacingProperty", afterSpacing);
            }
            {
                if (this.OwnerControl.Selection.SelectionRanges.Count > 0) {
                    this._UpdateMultipleSelectionParagraphFormatting(Actions.AfterSpacing, afterSpacing, false);
                    return;
                }
            }
            this._Relayout(false);
        };
        SelectionAdv.prototype._OnTextAlignment = function (textAlignment) {
            if (this.OwnerControl.IsReadOnlyMode || !this.OwnerControl.IsDocumentLoaded)
                return;
            this.ownerControl.IsShiftingEnabled = true;
            if (this.IsEmpty) {
                this._InitHistory(Actions.TextAlignment);
                this.Start.Paragraph.ParagraphFormat._ApplyPropertyValueInternal(this.CurrentBaseHistoryInfo, ParagraphFormat.TextAlignmentProperty, textAlignment);
            }
            else {
                if (this.OwnerControl.Selection.SelectionRanges.Count > 0) {
                    this._UpdateMultipleSelectionParagraphFormatting(Actions.TextAlignment, textAlignment, false);
                    return;
                }
            }
            this._Relayout(false);
        };
        SelectionAdv.prototype._OnLineSpacing = function (lineSpacing) {
            if (this.OwnerControl.IsReadOnlyMode || !this.OwnerControl.IsDocumentLoaded)
                return;
            this.ownerControl.IsShiftingEnabled = true;
            this._InitHistory(Actions.LineSpacing);
            if (this.IsEmpty) {
                this._InitHistory(Actions.LineSpacing);
                this.Start.Paragraph.ParagraphFormat._ApplyPropertyValueInternal(this.CurrentBaseHistoryInfo, ParagraphFormat.LineSpacingProperty, lineSpacing);
            }
            else {
                if (this.OwnerControl.Selection.SelectionRanges.Count > 0) {
                    this._UpdateMultipleSelectionParagraphFormatting(Actions.LineSpacing, lineSpacing, false);
                    return;
                }
            }
            this._Relayout(false);
        };
        SelectionAdv.prototype._OnLineSpacingType = function (lineSpacingType) {
            if (this.OwnerControl.IsReadOnlyMode || !this.OwnerControl.IsDocumentLoaded)
                return;
            this.ownerControl.IsShiftingEnabled = true;
            this._InitHistory(Actions.LineSpacingType);
            if (this.IsEmpty) {
                this._InitHistory(Actions.LineSpacingType);
                this.Start.Paragraph.ParagraphFormat._ApplyPropertyValueInternal(this.CurrentBaseHistoryInfo, ParagraphFormat.LineSpacingTypeProperty, lineSpacingType);
            }
            else {
                if (this.OwnerControl.Selection.SelectionRanges.Count > 0) {
                    this._UpdateMultipleSelectionParagraphFormatting(Actions.LineSpacingType, lineSpacingType, false);
                    return;
                }
            }
            this._Relayout(false);
        };
        SelectionAdv.prototype._OnLeftIndentInternal = function (leftIndent, update) {
            if (this.OwnerControl.IsReadOnlyMode || !this.OwnerControl.IsDocumentLoaded)
                return;
            this.ownerControl.IsShiftingEnabled = true;
            if (this.IsEmpty) {
                if (update) {
                    leftIndent = this._GetIndentIncrementValue(this.Start.Paragraph, leftIndent);
                }
                this._InitHistory(Actions.LeftIndent);
                this.Start.Paragraph.ParagraphFormat._ApplyPropertyValue(this.CurrentBaseHistoryInfo, ParagraphFormat.LeftIndentProperty, leftIndent, update);
            }
            else {
                if (this.OwnerControl.Selection.SelectionRanges.Count > 0) {
                    this._UpdateMultipleSelectionParagraphFormatting(Actions.LeftIndent, leftIndent, update);
                    return;
                }
            }
            this._Relayout(false);
        };
        SelectionAdv.prototype._OnApplyListInternal = function (list) {
            var listFormat = new ListFormat(null);
            if (list != null)
                listFormat.List = list;
            listFormat.ListId = list.ListId;
            this.OwnerControl.IsShiftingEnabled = true;
            if (this.IsEmpty) {
                this._InitHistory(Actions.ListFormat);
                this.Start.Paragraph.ParagraphFormat._ApplyPropertyValueInternal(this.CurrentBaseHistoryInfo, ParagraphFormat.ListFormatProperty, listFormat);
            }
            else {
                if (this.OwnerControl.Selection.SelectionRanges.Count > 0) {
                    this._UpdateMultipleSelectionParagraphFormatting(Actions.ListFormat, listFormat, false);
                    return;
                }
            }
            this._Relayout(false);
        };
        SelectionAdv.prototype._OnCharacterFormat = function (format) {
            if (this.IsEmpty) {
                if (this.Start.Offset == this.Start.Paragraph._GetLength()) {
                    this._InitHistory(Actions.CharacterFormat);
                    this.Start.Paragraph.CharacterFormat._ApplyPropertyValueInternal(this.CurrentBaseHistoryInfo, null, format);
                    this._UpdateHistory();
                    this._FireContentChanged();
                }
                this._UpdateFocus();
                return;
            }
            else {
                if (this.OwnerControl.Selection.SelectionRanges.Count > 0)
                    this._UpdateMultipleSelectionCharacterFormatting(Actions.CharacterFormat, format, false);
            }
        };
        SelectionAdv.prototype._UpdateMultipleSelectionParagraphFormatting = function (action, value, update) {
            this._InitComplexHistory(Actions.MultiSelection);
            for (var i = 0; i < this.OwnerControl.Selection.SelectionRanges.Count; i++) {
                var selectionRange = this.OwnerControl.Selection.SelectionRanges._Get(i);
                if (action == Actions.LeftIndent && update) {
                    if (selectionRange.Start != null && selectionRange.Start._IsExistBefore(selectionRange.End))
                        value = this._GetIndentIncrementValue(selectionRange.Start.Paragraph, value);
                    else
                        value = this._GetIndentIncrementValue(selectionRange.End.Paragraph, value);
                }
                this._UpdateParagraphFormat(selectionRange, action, value, update);
                if (this.OwnerControl.Viewer.BlockToShift != null)
                    this.OwnerControl.Viewer.BlockToShift._Layout();
                this._Relayout(false);
            }
            this._UpdateComplexHistory();
        };
        SelectionAdv.prototype._UpdateMultipleSelectionTableFormatting = function (action, value) {
            this._InitComplexHistory(Actions.MultiSelection);
            {
                for (var i = 0; i < this.OwnerControl.Selection.SelectionRanges.Count; i++) {
                    var selectionRange = this.OwnerControl.Selection.SelectionRanges[i];
                    if (this._GetTable(selectionRange.Start, selectionRange.End) != null) {
                        this._UpdateTableFormat(selectionRange, action, value);
                        if (this.OwnerControl.Viewer.BlockToShift != null)
                            this.OwnerControl.Viewer.BlockToShift._Layout();
                        this._Relayout(false);
                    }
                }
                this._UpdateComplexHistory();
            }
        };
        SelectionAdv.prototype._UpdateParagraphFormat = function (selectionRange, action, value, update) {
            switch (action) {
                case Actions.AfterSpacing:
                    this._InitializeHistory(Actions.AfterSpacing, selectionRange);
                    this._UpdateParagraphFormats(selectionRange, ParagraphFormat.AfterSpacingProperty, value);
                    break;
                case Actions.BeforeSpacing:
                    this._InitializeHistory(Actions.BeforeSpacing, selectionRange);
                    this._UpdateParagraphFormats(selectionRange, ParagraphFormat.BeforeSpacingProperty, value);
                    break;
                case Actions.RightIndent:
                    this._InitializeHistory(Actions.RightIndent, selectionRange);
                    this._UpdateParagraphFormats(selectionRange, ParagraphFormat.RightIndentProperty, value);
                    break;
                case Actions.LeftIndent:
                    this._InitializeHistory(Actions.LeftIndent, selectionRange);
                    this._UpdateParagraphFormatInternal(selectionRange, ParagraphFormat.LeftIndentProperty, value, update);
                    break;
                case Actions.FirstLineIndent:
                    this._InitializeHistory(Actions.FirstLineIndent, selectionRange);
                    this._UpdateParagraphFormats(selectionRange, ParagraphFormat.FirstLineIndentProperty, value);
                    break;
                case Actions.LineSpacing:
                    this._InitializeHistory(Actions.LineSpacing, selectionRange);
                    this._UpdateParagraphFormats(selectionRange, ParagraphFormat.LineSpacingProperty, value);
                    break;
                case Actions.LineSpacingType:
                    this._InitializeHistory(Actions.LineSpacingType, selectionRange);
                    this._UpdateParagraphFormats(selectionRange, ParagraphFormat.LineSpacingTypeProperty, value);
                    break;
                case Actions.TextAlignment:
                    this._InitializeHistory(Actions.TextAlignment, selectionRange);
                    this._UpdateParagraphFormats(selectionRange, ParagraphFormat.TextAlignmentProperty, value);
                    break;
                case Actions.ListFormat:
                    this._InitializeHistory(Actions.ListFormat, selectionRange);
                    this._UpdateParagraphFormats(selectionRange, ParagraphFormat.ListFormatProperty, value);
                    break;
                case Actions.ParagraphFormat:
                    this._InitializeHistory(Actions.ParagraphFormat, selectionRange);
                    this._UpdateParagraphFormats(selectionRange, null, value);
                    break;
            }
        };
        SelectionAdv.prototype._UpdateParagraphFormats = function (selectionRange, property, value) {
            this._UpdateParagraphFormatInternal(selectionRange, property, value, false);
        };
        SelectionAdv.prototype._UpdateParagraphFormatInternal = function (selectionRange, property, value, update) {
            var startPosition = selectionRange.Start;
            var endPosition = selectionRange.End;
            if (!selectionRange.IsForward) {
                startPosition = selectionRange.End;
                endPosition = selectionRange.Start;
            }
            if (this.CurrentBaseHistoryInfo.InsertPosition == null)
                this.CurrentBaseHistoryInfo.InsertPosition = startPosition._GetHierarchicalIndexInternal();
            startPosition.Paragraph._ApplyParagraphFormatForSelection(this, startPosition, endPosition, property, value, update);
        };
        SelectionAdv.prototype._GetIndentIncrementValue = function (currentParagraph, incrementer) {
            var currentParagraphIndent = currentParagraph.ParagraphFormat.LeftIndent;
            if (currentParagraphIndent < 0) {
                if (incrementer < 0 || currentParagraphIndent + incrementer >= 0)
                    return -currentParagraphIndent;
                else {
                    var incrementValue = -this._GetIndentIncrementValueInternal(-currentParagraphIndent, -incrementer);
                    return incrementValue % incrementer == 0 ? incrementValue : incrementValue + incrementer;
                }
            }
            else
                return this._GetIndentIncrementValueInternal(currentParagraphIndent, incrementer);
        };
        SelectionAdv.prototype._GetIndentIncrementValueInternal = function (position, incrementer) {
            var tabValue = Math.abs(incrementer);
            if (position == 0 || tabValue == 0)
                return incrementer > 0 ? tabValue : 0;
            else {
                var diff = ((Math.round(position) * 100) % (Math.round(tabValue) * 100)) / 100;
                var cnt = (Math.round(position) - diff) / Math.round(tabValue);
                var fposition = cnt * tabValue;
                if (incrementer > 0)
                    fposition += tabValue;
                return (fposition - position) == 0 ? incrementer : fposition - position;
            }
        };
        SelectionAdv.prototype._SelectParagraph = function (paragraph, positionAtStart, clearMultiSelection) {
            if (clearMultiSelection)
                this.SelectionRanges._ClearMultiSelection();
            if (positionAtStart)
                this.Start._SetPosition(paragraph, positionAtStart);
            else {
                var endOffset = paragraph._GetEndOffset();
                this.Start._SetPositionParagraph(paragraph, endOffset);
            }
            this.End._SetPositionInternal(this.Start);
            this.UpDownSelectionLength = this.Start.Location.X;
            this._FireSelectionChanged(true);
        };
        SelectionAdv.prototype._OnPageSizeChanged = function (pagesize) {
            this._InitHistory(Actions.PageSize);
            this._UpdateSectionFormat("PageSizeProperty", pagesize);
        };
        SelectionAdv.prototype._OnPageMarginChanged = function (pagemargin) {
            this._InitHistory(Actions.PageMargin);
            this._UpdateSectionFormat("PageMarginProperty", pagemargin);
        };
        SelectionAdv.prototype._OnTableAlignment = function (tablealignment) {
            this.ownerControl.IsShiftingEnabled = true;
            if (this.IsEmpty) {
                this._InitHistory(Actions.TableAlignment);
                this.Start.Paragraph.AssociatedCell.OwnerTable.TableFormat._ApplyPropertyValue(this.CurrentBaseHistoryInfo, TableFormat.TableAlignmentProperty, tablealignment);
            }
            else {
                if (this.OwnerControl.Selection.SelectionRanges.Count > 0) {
                    this._UpdateMultipleSelectionTableFormatting(Actions.TableAlignment, tablealignment);
                    return;
                }
            }
            this._Relayout(false);
        };
        SelectionAdv.prototype._OnTableLeftIndent = function (leftIndent) {
            this.ownerControl.IsShiftingEnabled = true;
            if (this.IsEmpty) {
                this._InitHistory(Actions.TableLeftIndent);
                this.Start.Paragraph.AssociatedCell.OwnerTable.TableFormat._ApplyPropertyValue(this.CurrentBaseHistoryInfo, TableFormat.LeftIndentProperty, leftIndent);
            }
            else {
                if (this.OwnerControl.Selection.SelectionRanges.Count > 0) {
                    this._UpdateMultipleSelectionTableFormatting(Actions.TableLeftIndent, leftIndent);
                    return;
                }
            }
            this._Relayout(false);
        };
        SelectionAdv.prototype._OnCellSpacing = function (cellSpacing) {
            this.ownerControl.IsShiftingEnabled = true;
            if (this.IsEmpty) {
                this._InitHistory(Actions.CellSpacing);
                this.Start.Paragraph.AssociatedCell.OwnerTable.TableFormat._ApplyPropertyValue(this.CurrentBaseHistoryInfo, TableFormat.CellSpacingProperty, cellSpacing);
            }
            else {
                if (this.OwnerControl.Selection.SelectionRanges.Count > 0) {
                    this._UpdateMultipleSelectionTableFormatting(Actions.CellSpacing, cellSpacing);
                    return;
                }
            }
            this._Relayout(false);
        };
        SelectionAdv.prototype._OnDefaultCellLeftMargin = function (leftMargin) {
            this.ownerControl.IsShiftingEnabled = true;
            if (this.IsEmpty) {
                this._InitHistory(Actions.DefaultCellLeftMargin);
                this.Start.Paragraph.AssociatedCell.OwnerTable.TableFormat._ApplyPropertyValue(this.CurrentBaseHistoryInfo, TableFormat.LeftMarginProperty, leftMargin);
            }
            else {
                if (this.OwnerControl.Selection.SelectionRanges.Count > 0) {
                    this._UpdateMultipleSelectionTableFormatting(Actions.DefaultCellLeftMargin, leftMargin);
                    return;
                }
            }
            this._Relayout(false);
        };
        SelectionAdv.prototype._OnDefaultCellRightMargin = function (rightMargin) {
            this.ownerControl.IsShiftingEnabled = true;
            if (this.IsEmpty) {
                this._InitHistory(Actions.DefaultCellRightMargin);
                this.Start.Paragraph.AssociatedCell.OwnerTable.TableFormat._ApplyPropertyValue(this.CurrentBaseHistoryInfo, TableFormat.RightMarginProperty, rightMargin);
            }
            else {
                if (this.OwnerControl.Selection.SelectionRanges.Count > 0) {
                    this._UpdateMultipleSelectionTableFormatting(Actions.DefaultCellRightMargin, rightMargin);
                    return;
                }
            }
            this._Relayout(false);
        };
        SelectionAdv.prototype._OnDefaultCellTopMargin = function (topMargin) {
            this.ownerControl.IsShiftingEnabled = true;
            if (this.IsEmpty) {
                this._InitHistory(Actions.DefaultCellTopMargin);
                this.Start.Paragraph.AssociatedCell.OwnerTable.TableFormat._ApplyPropertyValue(this.CurrentBaseHistoryInfo, TableFormat.TopMarginProperty, topMargin);
            }
            else {
                if (this.OwnerControl.Selection.SelectionRanges.Count > 0) {
                    this._UpdateMultipleSelectionTableFormatting(Actions.DefaultCellTopMargin, topMargin);
                    return;
                }
            }
            this._Relayout(false);
        };
        SelectionAdv.prototype._OnDefaultCellBottomMargin = function (bottomMargin) {
            this.ownerControl.IsShiftingEnabled = true;
            if (this.IsEmpty) {
                this._InitHistory(Actions.DefaultCellBottomMargin);
                this.Start.Paragraph.AssociatedCell.OwnerTable.TableFormat._ApplyPropertyValue(this.CurrentBaseHistoryInfo, TableFormat.BottomMarginProperty, bottomMargin);
            }
            else {
                if (this.OwnerControl.Selection.SelectionRanges.Count > 0) {
                    this._UpdateMultipleSelectionTableFormatting(Actions.DefaultCellBottomMargin, bottomMargin);
                    return;
                }
            }
            this._Relayout(false);
        };
        SelectionAdv.prototype._OnCellContentVerticalAlignment = function (verticalAlignment) {
            this.ownerControl.IsShiftingEnabled = true;
            if (this.IsEmpty) {
                this._InitHistory(Actions.CellContentVerticalAlignment);
                this.Start.Paragraph.AssociatedCell.CellFormat._ApplyPropertyValue(this.CurrentBaseHistoryInfo, CellFormat.VerticalAlignmentProperty, verticalAlignment);
            }
            else {
                if (this.OwnerControl.Selection.SelectionRanges.Count > 0) {
                    this._UpdateMultipleSelectionTableFormatting(Actions.CellContentVerticalAlignment, verticalAlignment);
                    return;
                }
            }
            this._Relayout(false);
        };
        SelectionAdv.prototype._OnCellLeftMargin = function (leftMargin) {
            this.ownerControl.IsShiftingEnabled = true;
            if (this.IsEmpty) {
                this._InitHistory(Actions.CellLeftMargin);
                this.Start.Paragraph.AssociatedCell.CellFormat._ApplyPropertyValue(this.CurrentBaseHistoryInfo, CellFormat.LeftMarginProperty, leftMargin);
            }
            else {
                if (this.OwnerControl.Selection.SelectionRanges.Count > 0) {
                    this._UpdateMultipleSelectionTableFormatting(Actions.CellLeftMargin, leftMargin);
                    return;
                }
            }
            this._Relayout(false);
        };
        SelectionAdv.prototype._OnCellRightMargin = function (rightMargin) {
            this.ownerControl.IsShiftingEnabled = true;
            if (this.IsEmpty) {
                this._InitHistory(Actions.CellRightMargin);
                this.Start.Paragraph.AssociatedCell.CellFormat._ApplyPropertyValue(this.CurrentBaseHistoryInfo, CellFormat.RightMarginProperty, rightMargin);
            }
            else {
                if (this.OwnerControl.Selection.SelectionRanges.Count > 0) {
                    this._UpdateMultipleSelectionTableFormatting(Actions.CellRightMargin, rightMargin);
                    return;
                }
            }
            this._Relayout(false);
        };
        SelectionAdv.prototype._OnCellTopMargin = function (topMargin) {
            this.ownerControl.IsShiftingEnabled = true;
            if (this.IsEmpty) {
                this._InitHistory(Actions.CellTopMargin);
                this.Start.Paragraph.AssociatedCell.CellFormat._ApplyPropertyValue(this.CurrentBaseHistoryInfo, CellFormat.TopMarginProperty, topMargin);
            }
            else {
                if (this.OwnerControl.Selection.SelectionRanges.Count > 0) {
                    this._UpdateMultipleSelectionTableFormatting(Actions.CellTopMargin, topMargin);
                    return;
                }
            }
            this._Relayout(false);
        };
        SelectionAdv.prototype._OnCellBottomMargin = function (bottomMargin) {
            this.ownerControl.IsShiftingEnabled = true;
            if (this.IsEmpty) {
                this._InitHistory(Actions.CellTopMargin);
                this.Start.Paragraph.AssociatedCell.CellFormat._ApplyPropertyValue(this.CurrentBaseHistoryInfo, CellFormat.BottomMarginProperty, bottomMargin);
            }
            else {
                if (this.OwnerControl.Selection.SelectionRanges.Count > 0) {
                    this._UpdateMultipleSelectionTableFormatting(Actions.CellBottomtMargin, bottomMargin);
                    return;
                }
            }
            this._Relayout(false);
        };
        SelectionAdv.prototype._OnRowHeight = function (height) {
            this.ownerControl.IsShiftingEnabled = true;
            if (this.IsEmpty) {
                this._InitHistory(Actions.CellTopMargin);
                this.Start.Paragraph.AssociatedCell.OwnerRow.RowFormat._ApplyPropertyValue(this.CurrentBaseHistoryInfo, RowFormat.HeightProperty, height);
            }
            else {
                if (this.OwnerControl.Selection.SelectionRanges.Count > 0) {
                    this._UpdateMultipleSelectionTableFormatting(Actions.RowHeight, height);
                    return;
                }
            }
            this._Relayout(false);
        };
        SelectionAdv.prototype._OnRowHeightType = function (heightType) {
            this.ownerControl.IsShiftingEnabled = true;
            if (this.IsEmpty) {
                this._InitHistory(Actions.CellTopMargin);
                this.Start.Paragraph.AssociatedCell.OwnerRow.RowFormat._ApplyPropertyValue(this.CurrentBaseHistoryInfo, RowFormat.HeightTypeProperty, heightType);
            }
            else {
                if (this.OwnerControl.Selection.SelectionRanges.Count > 0) {
                    this._UpdateMultipleSelectionTableFormatting(Actions.RowHeightType, heightType);
                    return;
                }
            }
            this._Relayout(false);
        };
        SelectionAdv.prototype._OnHeader = function (header) {
            this.ownerControl.IsShiftingEnabled = true;
            if (this.IsEmpty) {
                this._InitHistory(Actions.CellTopMargin);
                this.Start.Paragraph.AssociatedCell.OwnerRow.RowFormat._ApplyPropertyValue(this.CurrentBaseHistoryInfo, RowFormat.IsHeaderProperty, header);
            }
            else {
                if (this.OwnerControl.Selection.SelectionRanges.Count > 0) {
                    this._UpdateMultipleSelectionTableFormatting(Actions.RowHeader, header);
                    return;
                }
            }
            this._Relayout(false);
        };
        SelectionAdv.prototype._OnAllowBreakAcrossPages = function (allowRowBreakAcrossPages) {
            this.ownerControl.IsShiftingEnabled = true;
            if (this.IsEmpty) {
                this._InitHistory(Actions.CellTopMargin);
                this.Start.Paragraph.AssociatedCell.OwnerRow.RowFormat._ApplyPropertyValue(this.CurrentBaseHistoryInfo, RowFormat.AllowBreakAcrossPagesProperty, allowRowBreakAcrossPages);
            }
            else {
                if (this.OwnerControl.Selection.SelectionRanges.Count > 0) {
                    this._UpdateMultipleSelectionTableFormatting(Actions.AllowBreakAcrossPages, allowRowBreakAcrossPages);
                    return;
                }
            }
            this._Relayout(false);
        };
        SelectionAdv.prototype._UpdateSectionFormat = function (property, value) {
            this.OwnerControl.IsShiftingEnabled = true;
            var startPosition = this.Start;
            var endPosition = this.End;
            if (!this.IsForward) {
                startPosition = this.End;
                endPosition = this.Start;
            }
            if (this.CurrentBaseHistoryInfo.InsertPosition == null)
                this.CurrentBaseHistoryInfo.InsertPosition = startPosition._GetHierarchicalIndexInternal();
            var startSectionIndex = this.ownerControl.Document.Sections._IndexOf(this.Start.Paragraph.Section);
            var endSectionIndex = this.ownerControl.Document.Sections._IndexOf(this.End.Paragraph.Section);
            for (var i = startSectionIndex; i <= endSectionIndex; i++)
                this.ownerControl.Document.Sections[i].SectionFormat._ApplyPropertyValue(this.CurrentBaseHistoryInfo, property, value);
            this._UpdateHistory();
        };
        SelectionAdv.prototype._UpdatePhysicalPosition = function () {
            if (this.Start != null)
                this.Start._UpdatePhysicalPosition();
            if (this.End != null)
                this.End._UpdatePhysicalPosition();
        };
        SelectionAdv.prototype._FireSelectionChanged = function (isSelectionChanged) {
            if (!this.IsEmpty) {
                if (this.IsForward) {
                    this.Start._UpdatePhysicalPositionInternal(true);
                    this.End._UpdatePhysicalPositionInternal(false);
                }
                else {
                    this.Start._UpdatePhysicalPositionInternal(false);
                    this.End._UpdatePhysicalPositionInternal(true);
                }
            }
            if (!this.SkipFormatRetrieval)
                this._RetrieveCurrentFormatProperties();
            this.ownerControl.Viewer._ClearSelectionHighlight();
            if (this.OwnerControl.IsLayoutEnabled && !this.OwnerControl.IsShiftingEnabled)
                this._HighlightSelection(isSelectionChanged);
            if (isSelectionChanged)
                this.OwnerControl._RaiseClientEvent(DocumentEditorEvents.SelectionChange, null);
        };
        SelectionAdv.prototype._FireContentChanged = function () {
            if (this.OwnerControl.IsLayoutEnabled && !this.OwnerControl.IsShiftingEnabled) {
                this.OwnerControl._RaiseClientEvent(DocumentEditorEvents.ContentChange, null);
            }
        };
        SelectionAdv.prototype._HighlightSelection = function (isSelectionChanged) {
            this._HighlightSelectedComment();
            this.OwnerControl.Viewer._HideImageResizer();
            if (this._IsInComment())
                this.IsSelectingComment = true;
            if (this.IsEmpty) {
                this.OwnerControl.Viewer._UpdateCaretPosition();
            }
            else {
                var isControlPressed = false;
                isControlPressed = this.OwnerControl.Viewer.isControlPressed;
                var canHighlight = true;
                canHighlight = !isControlPressed || !this.ownerControl.Viewer.isMousedown;
                if (this.SelectionRanges.Count > 0 && canHighlight) {
                    for (var i = 0; i < this.SelectionRanges.Count; i++) {
                        var selectionRange = this.SelectionRanges._Get(i);
                        if (selectionRange.IsForward)
                            selectionRange.Start.Paragraph._HighlightSelectedContent(this, selectionRange, selectionRange.Start, selectionRange.End);
                        else
                            selectionRange.End.Paragraph._HighlightSelectedContent(this, selectionRange, selectionRange.End, selectionRange.Start);
                    }
                }
                else {
                    if (this.IsForward)
                        this.Start.Paragraph._HighlightSelectedContent(this, this.CurrentSelectionRange, this.Start, this.End);
                    else
                        this.End.Paragraph._HighlightSelectedContent(this, this.CurrentSelectionRange, this.End, this.Start);
                }
                this.OwnerControl.Viewer._UpdateTouchMarkPosition();
            }
            if (isSelectionChanged)
                this.OwnerControl.Viewer._ScrollToPosition(this.Start, this.End);
            this.IsSelectingComment = false;
        };
        SelectionAdv.prototype._HighlightSelectedComment = function () {
            if (this._IsInComment()) {
                var comment = this.Start.Paragraph._GetOwnerComment();
                if (comment.LayoutedWidget != null && comment.LayoutedWidget.Page != null) {
                    var startPosition = new TextPosition(this.OwnerControl);
                    var endPosition = new TextPosition(this.OwnerControl);
                    startPosition._SetPositionParagraph(comment.OwnerParagraph, comment.OwnerParagraph._GetOffset(comment, 0));
                    endPosition._SetPositionParagraph(comment.OwnerParagraph, comment.OwnerParagraph._GetOffset(comment, comment.Length));
                    if (comment.CommentStart != null && comment.CommentEnd != null && comment.CommentStart.OwnerParagraph != null && comment.CommentEnd.OwnerParagraph != null) {
                        startPosition._SetPositionParagraph(comment.CommentStart.OwnerParagraph, comment.CommentStart.OwnerParagraph._GetOffset(comment.CommentStart, 0));
                        endPosition._SetPositionParagraph(comment.CommentEnd.OwnerParagraph, comment.CommentEnd.OwnerParagraph._GetOffset(comment.CommentEnd, 1));
                    }
                    this.IsHighlightingCommentRange = true;
                    if (this.OwnerControl.Selection.SelectionRanges.Count > 0) {
                        for (var i = 0; i < this.OwnerControl.Selection.SelectionRanges.Count; i++) {
                            var selectionRange = this.OwnerControl.Selection.SelectionRanges._Get(i);
                            var selectionStartIndex = 0;
                            var startElement = null;
                            var startLineWidget = null;
                            var startLineWidgetObj = startPosition.Paragraph._GetStartLineWidget(startPosition, startElement, selectionStartIndex);
                            startElement = startLineWidgetObj.startElement;
                            selectionStartIndex = startLineWidgetObj.lineIndex;
                            startLineWidget = startLineWidgetObj.lineWidget;
                            if (selectionRange.SelectedWidgets._ContainsKey(startLineWidget)) {
                                selectionRange.SelectedWidgets._Remove(startLineWidget);
                            }
                        }
                    }
                    startPosition.Paragraph._HighlightSelectedContent(this, this.CurrentSelectionRange, startPosition, endPosition);
                    this.NeedToRenderMarker = true;
                    this.IsHighlightingCommentRange = false;
                }
            }
        };
        SelectionAdv.prototype._IsInComment = function () {
            return this.Start != null && this.Start.Paragraph._IsInComment() && this.End.Paragraph._IsInComment();
        };
        SelectionAdv.prototype._CreateHighlightBorder = function (selectionRange, lineWidget, width, left, top) {
            var comment = null;
            if (this._IsInComment())
                comment = this.Start.Paragraph._GetOwnerComment();
            if (width < 0)
                width = 0;
            var page = (this.OwnerControl.Viewer instanceof FlowLayoutViewer) ? this.OwnerControl.Viewer.CurrentRenderingPage : lineWidget.CurrentParagraphWidget._GetPage();
            var height = lineWidget.Height;
            var selectionWidget = null;
            var selectionContainer = document.getElementById(page.Id + "_selection");
            if (!selectionRange.SelectedWidgets._ContainsKey(lineWidget) && !this.IsHighlightingCommentRange) {
                selectionWidget = new SelectionWidgetInfo(left, width);
                selectionRange.SelectedWidgets._Add(lineWidget, selectionWidget);
            }
            else if (!this.OwnerControl.Viewer.SelectedCommentRangeWidget._ContainsKey(lineWidget) && this.IsHighlightingCommentRange) {
                selectionWidget = new SelectionWidgetInfo(left, width);
                this.OwnerControl.Viewer.SelectedCommentRangeWidget._Add(lineWidget, selectionWidget);
            }
            if (this.IsHighlightingCommentRange && this.NeedToRenderMarker) {
                if ((page == comment.LayoutedWidget.Page && this.ownerControl.Viewer.CommentRangeWidget == null) ||
                    (lineWidget.Children._Contains(comment.Elements[0]))) {
                    this.NeedToRenderMarker = false;
                    var x2 = page.BoundingRectangle.Right - page.ReviewPanelWidth - page.BoundingRectangle.Left - 40;
                    this.OwnerControl.Viewer.CommentRangeWidget = new CommentRangeWidget(lineWidget);
                    this.OwnerControl.Viewer.CommentRangeWidget.CommentRangeMarker = new Line(left, top, x2, top);
                    this.OwnerControl.Viewer.CommentRangeWidget.CommentRangeLinker = new Line(x2, top, x2 + 40, comment.LayoutedWidget.Y + 12);
                    if (selectionContainer != null) {
                        var context = selectionContainer.getContext("2d");
                        context.beginPath();
                        context.moveTo(left, top + 0.5);
                        context.lineTo(x2, top + 0.5);
                        context.moveTo(x2, top + 0.5);
                        context.lineTo(x2 + 40, comment.LayoutedWidget.Y + 12.5);
                        context.lineWidth = 0.5;
                        context.strokeStyle = "#19c7ff";
                        context.globalAlpha = 1;
                        context.stroke();
                    }
                }
            }
            if (this.IsSelectingComment && !this.IsEmpty) {
                left = left + comment.LayoutedWidget.X;
                top = top + comment.LayoutedWidget.Y;
            }
            if (selectionContainer != null) {
                var context = selectionContainer.getContext("2d");
                if (this.IsHighlightingCommentRange)
                    context.fillStyle = "#67CCEC";
                else
                    context.fillStyle = "gray";
                context.globalAlpha = 0.4;
                context.fillRect(left, top, width, height);
            }
        };
        SelectionAdv.prototype._CreateHighlightBorderInsideTable = function (cellWidget, selection, selectionRange) {
            var comment = null;
            if (this._IsInComment())
                comment = this.Start.Paragraph._GetOwnerComment();
            var page = (this.ownerControl.Viewer instanceof FlowLayoutViewer) ? this.OwnerControl.Viewer.CurrentRenderingPage : cellWidget._GetPage();
            var selectionContainer = document.getElementById(page.Id + "_selection");
            var selectionWidget = null;
            var left = cellWidget.X - cellWidget.Margin.Left + cellWidget.LeftBorderWidth;
            var width = cellWidget.Width + cellWidget.Margin.Left + cellWidget.Margin.Right - cellWidget.LeftBorderWidth - cellWidget.RightBorderWidth;
            var top = cellWidget.Y;
            var height = cellWidget.Height;
            if (selectionRange.SelectedWidgets._ContainsKey(cellWidget) && !this.IsHighlightingCommentRange) {
                selectionWidget = selectionRange.SelectedWidgets._Get(cellWidget);
                if (selectionContainer != null) {
                    var context = selectionContainer.getContext("2d");
                    context.clearRect(selectionWidget.Left, top, selectionWidget.Width, height);
                }
            }
            else if (!this.IsHighlightingCommentRange) {
                selectionWidget = new SelectionWidgetInfo(left, width);
                selectionRange.SelectedWidgets._Add(cellWidget, selectionWidget);
            }
            else if (!this.OwnerControl.Viewer.SelectedCommentRangeWidget._ContainsKey(cellWidget) && this.IsHighlightingCommentRange) {
                selectionWidget = new SelectionWidgetInfo(left, width);
                this.OwnerControl.Viewer.SelectedCommentRangeWidget._Add(cellWidget, selectionWidget);
            }
            if (this.IsHighlightingCommentRange && this.NeedToRenderMarker) {
                if ((page == comment.LayoutedWidget.Page && this.ownerControl.Viewer.CommentRangeWidget == null) ||
                    (cellWidget.ChildWidgets._Contains(comment.Elements[0]))) {
                    this.NeedToRenderMarker = false;
                    var x2 = page.BoundingRectangle.Right - page.ReviewPanelWidth - page.BoundingRectangle.Left - 40;
                    this.OwnerControl.Viewer.CommentRangeWidget = new CommentRangeWidget(cellWidget);
                    this.OwnerControl.Viewer.CommentRangeWidget.CommentRangeMarker = new Line(left, top, x2, top);
                    this.OwnerControl.Viewer.CommentRangeWidget.CommentRangeLinker = new Line(x2, top, x2 + 40, comment.LayoutedWidget.Y + 12);
                    var context = selectionContainer.getContext("2d");
                    context.beginPath();
                    context.moveTo(left, top + 0.5);
                    context.lineTo(x2, top + 0.5);
                    context.moveTo(x2, top + 0.5);
                    context.lineTo(x2 + 40, comment.LayoutedWidget.Y + 12.5);
                    context.lineWidth = 0.5;
                    context.strokeStyle = "#19c7ff";
                    context.globalAlpha = 1;
                    context.stroke();
                }
            }
            if (this.IsSelectingComment && !this.IsEmpty) {
                left = left + comment.LayoutedWidget.X;
                top = top + comment.LayoutedWidget.Y;
            }
            if (selectionContainer != null) {
                var context = selectionContainer.getContext("2d");
                context.fillStyle = "gray";
                context.globalAlpha = 0.4;
                context.fillRect(left, top, width, height);
            }
        };
        SelectionAdv.prototype._MoveTextPosition = function (cursorPoint, clearMultiSelection, textPosition, viewer) {
            if (this.Start == null)
                return;
            if (clearMultiSelection)
                this.selectionRanges._ClearMultiSelection();
            var widget = this.OwnerControl.Viewer._GetLineWidgetInternal(cursorPoint, true);
            if (widget != null)
                widget._UpdateTextPositionWidget(this.OwnerControl, cursorPoint, textPosition, true);
            this.UpDownSelectionLength = textPosition.Location.X;
            var length = textPosition.Paragraph._GetLength();
            if (!this.IsEmpty && !this.IsForward && textPosition.Offset > length) {
                var indexInInline = 0;
                var inlineInfo = textPosition.Paragraph._GetInline(length, indexInInline);
                var inline = inlineInfo.inline;
                indexInInline = inlineInfo.index;
                var paragraph = textPosition.Paragraph;
                var endOffset = 0;
                if (inline != null) {
                    inline = inline._GetPreviousValidInline();
                    indexInInline = inline instanceof FieldCharacterAdv ? 0 : inline.Length;
                    if (inline instanceof FieldEndAdv)
                        indexInInline++;
                    endOffset = inline.OwnerParagraph._GetOffset(inline, indexInInline);
                    paragraph = inline.OwnerParagraph;
                }
                textPosition._SetPositionParagraph(paragraph, endOffset);
            }
            var selectionStartIndex = this.Start._GetHierarchicalIndexInternal();
            var selectionEndIndex = this.End._GetHierarchicalIndexInternal();
            if (selectionStartIndex != selectionEndIndex) {
                if (TextPosition._IsForwardSelection(selectionStartIndex, selectionEndIndex))
                    textPosition._ValidateForwardFieldSelection(selectionStartIndex, selectionEndIndex);
                else
                    textPosition._ValidateBackwardFieldSelection(selectionStartIndex, selectionEndIndex);
            }
            this._FireSelectionChanged(true);
        };
        SelectionAdv.prototype._ExtendToWordStart = function (isNavigation, clearMultiSelection) {
            if (this.Start == null)
                return;
            if (clearMultiSelection)
                this.SelectionRanges._ClearMultiSelection();
            if ((this.Start.Paragraph.IsInsideTable || this.End.Paragraph.IsInsideTable)
                && (this.Start.Paragraph.AssociatedCell != this.End.Paragraph.AssociatedCell
                    || this.Start.Paragraph.AssociatedCell._IsCellSelected(this.Start, this.End)))
                this.End._MoveToPreviousParagraphInTable();
            else {
                this.End._MoveToWordStart(isNavigation ? 0 : 1);
            }
            if (isNavigation)
                this.Start._SetPositionInternal(this.End);
            this.UpDownSelectionLength = this.End.Location.X;
            this._FireSelectionChanged(true);
        };
        SelectionAdv.prototype._ExtendToWordEnd = function (isNavigation, clearMultiSelection) {
            if (this.Start == null)
                return;
            if (clearMultiSelection)
                this.SelectionRanges._ClearMultiSelection();
            if ((this.Start.Paragraph.IsInsideTable || this.End.Paragraph.IsInsideTable)
                && (this.Start.Paragraph.AssociatedCell != this.End.Paragraph.AssociatedCell
                    || this.Start.Paragraph.AssociatedCell._IsCellSelected(this.Start, this.End)))
                this.End._MoveToNextParagraphInTable();
            else
                this.End._MoveToWordEnd(isNavigation ? 0 : 1, false);
            if (isNavigation)
                this.Start._SetPositionInternal(this.End);
            this.UpDownSelectionLength = this.End.Location.X;
            this._FireSelectionChanged(true);
        };
        SelectionAdv.prototype._ExtendToLineStart = function (clearMultiSelection) {
            if (this.Start == null)
                return;
            if (clearMultiSelection)
                this.SelectionRanges._ClearMultiSelection();
            this.End._MoveToLineStart(true);
            this.UpDownSelectionLength = this.End.Location.X;
            this._FireSelectionChanged(true);
        };
        SelectionAdv.prototype._ExtendToLineEnd = function (clearMultiSelection) {
            if (this.Start == null)
                return;
            if (clearMultiSelection)
                this.SelectionRanges._ClearMultiSelection();
            this.End._MoveToLineEnd(true);
            this.UpDownSelectionLength = this.End.Location.X;
            this._FireSelectionChanged(true);
        };
        SelectionAdv.prototype._ExtendToParagraphStart = function (clearMultiSelection) {
            if (this.Start == null)
                return;
            if (clearMultiSelection)
                this.SelectionRanges._ClearMultiSelection();
            this.End._MoveToParagraphStart(true);
            this.UpDownSelectionLength = this.End.Location.X;
            this._FireSelectionChanged(true);
        };
        SelectionAdv.prototype._ExtendToParagraphEnd = function (clearMultiSelection) {
            if (this.Start == null)
                return;
            if (clearMultiSelection)
                this.SelectionRanges._ClearMultiSelection();
            this.End._MoveToParagraphEnd(true);
            this.UpDownSelectionLength = this.End.Location.X;
            this._FireSelectionChanged(true);
        };
        SelectionAdv.prototype._ExtendToPreviousLine = function (clearMultiSelection) {
            if (this.Start == null)
                return;
            if (clearMultiSelection)
                this.SelectionRanges._ClearMultiSelection();
            this.End._MoveToPreviousLine(this.UpDownSelectionLength);
            this._FireSelectionChanged(true);
        };
        SelectionAdv.prototype._ExtendToNextLine = function (clearMultiSelection) {
            if (this.Start == null)
                return;
            if (clearMultiSelection)
                this.SelectionRanges._ClearMultiSelection();
            this.End._MoveToNextLine(this.UpDownSelectionLength);
            this._FireSelectionChanged(true);
        };
        SelectionAdv.prototype._MoveToPreviousParagraph = function (clearMultiSelection) {
            if (this.Start == null)
                return;
            if (clearMultiSelection)
                this.SelectionRanges._ClearMultiSelection();
            this.End._MoveToPreviousParagraph();
            this.Start._SetPositionInternal(this.End);
            this.UpDownSelectionLength = this.End.Location.X;
            this._FireSelectionChanged(true);
        };
        SelectionAdv.prototype._MoveToNextParagraph = function (clearMultiSelection) {
            if (this.Start == null)
                return;
            if (clearMultiSelection)
                this.SelectionRanges._ClearMultiSelection();
            this.End._MoveToNextParagraph();
            this.Start._SetPositionInternal(this.End);
            this.UpDownSelectionLength = this.End.Location.X;
            this._FireSelectionChanged(true);
        };
        SelectionAdv.prototype._MoveUp = function (clearMultiSelection) {
            if (this.Start == null)
                return;
            if (clearMultiSelection)
                this.SelectionRanges._ClearMultiSelection();
            if (!this.IsEmpty) {
                if (this.IsForward)
                    this.End._SetPositionInternal(this.Start);
                else
                    this.Start._SetPositionInternal(this.End);
                this.UpDownSelectionLength = this.Start.Location.X;
            }
            this.Start._MoveUp(this.UpDownSelectionLength);
            this.End._SetPositionInternal(this.Start);
            this._FireSelectionChanged(true);
        };
        SelectionAdv.prototype._MoveDown = function (clearMultiSelection) {
            if (this.Start == null)
                return;
            if (clearMultiSelection)
                this.SelectionRanges._ClearMultiSelection();
            if (!this.IsEmpty) {
                if (this.IsForward)
                    this.Start._SetPositionInternal(this.End);
                else
                    this.End._SetPositionInternal(this.Start);
                this.UpDownSelectionLength = this.Start.Location.X;
            }
            this.Start._MoveDown(this.UpDownSelectionLength);
            this.End._SetPositionInternal(this.Start);
            this._FireSelectionChanged(true);
        };
        SelectionAdv.prototype._MoveNextPosition = function (clearMultiSelection) {
            if (this.Start == null)
                return;
            if (clearMultiSelection)
                this.SelectionRanges._ClearMultiSelection();
            if (this.IsEmpty) {
                this.Start._MoveNextPosition();
                this.End._SetPositionInternal(this.Start);
            }
            else {
                if (this.IsForward)
                    this.Start._SetPositionInternal(this.End);
                else
                    this.End._SetPositionInternal(this.Start);
            }
            this.UpDownSelectionLength = this.Start.Location.X;
            this._FireSelectionChanged(true);
        };
        SelectionAdv.prototype._MovePreviousPosition = function (clearMultiSelection) {
            if (this.Start == null)
                return;
            if (clearMultiSelection)
                this.SelectionRanges._ClearMultiSelection();
            if (this.IsEmpty) {
                this.Start._MovePreviousPosition();
                this.End._SetPositionInternal(this.Start);
            }
            else {
                if (this.IsForward)
                    this.End._SetPositionInternal(this.Start);
                else
                    this.Start._SetPositionInternal(this.End);
            }
            this.UpDownSelectionLength = this.Start.Location.X;
            this._FireSelectionChanged(true);
        };
        SelectionAdv.prototype._MoveToLineStart = function (clearMultiSelection) {
            if (this.Start == null)
                return;
            if (clearMultiSelection)
                this.SelectionRanges._ClearMultiSelection();
            if (!this.IsEmpty) {
                if (this.IsForward)
                    this.End._SetPositionInternal(this.Start);
                else
                    this.Start._SetPositionInternal(this.End);
            }
            this.Start._MoveToLineStart(false);
            this.End._SetPositionInternal(this.Start);
            this.UpDownSelectionLength = this.Start.Location.X;
            this._FireSelectionChanged(true);
        };
        SelectionAdv.prototype._MoveToLineEnd = function (clearMultiSelection) {
            if (this.Start == null)
                return;
            if (clearMultiSelection)
                this.SelectionRanges._ClearMultiSelection();
            if (!this.IsEmpty) {
                if (this.IsForward)
                    this.Start._SetPositionInternal(this.End);
                else
                    this.End._SetPositionInternal(this.Start);
            }
            this.Start._MoveToLineEnd(false);
            this.End._SetPositionInternal(this.Start);
            this.UpDownSelectionLength = this.Start.Location.X;
            this._FireSelectionChanged(true);
        };
        SelectionAdv.prototype._Cut = function () {
            if (this.OwnerControl.IsReadOnlyMode || this.IsEmpty)
                return;
            this._CopySelectedContent(true);
            this._Relayout(true);
            this._UpdateFocus();
        };
        SelectionAdv.prototype._Copy = function () {
            if (this.IsEmpty)
                return;
            this._CopySelectedContent(false);
            this._UpdateFocus();
        };
        SelectionAdv.prototype._PasteDocContent = function (formData) {
            var instance = this;
            var jsonResult = new Object();
            jsonResult["HtmlString"] = formData;
            $.ajax({
                type: "POST",
                timeout: instance.OwnerControl._pasteTimeOut,
                url: instance.OwnerControl.DocumentEditor.model.importExportSettings.importHtmlUrl,
                crossDomain: true,
                contentType: 'application/json; charset=utf-8',
                data: JSON.stringify(jsonResult),
                traditional: true,
                async: true,
                success: function (data) {
                    var document = instance.OwnerControl._parseDocumentInternal(JSON.parse(data));
                    instance.OwnerControl.IsReadOnlyInternal = false;
                    instance.OwnerControl.Viewer.ViewerContatiner.focus();
                    instance._PasteContents(document);
                    instance.OwnerControl.Viewer.EditableDiv.innerHTML = "";
                    instance.OwnerControl.Viewer.ViewerContatiner.style.cursor = "default";
                },
                error: function (data) {
                    instance.OwnerControl.IsReadOnlyInternal = false;
                    instance.OwnerControl.Viewer.ViewerContatiner.style.cursor = "default";
                    alert("Paste Operation Timed out");
                }
            });
        };
        SelectionAdv.prototype._Paste = function (evt) {
            this.OwnerControl.Viewer.ViewerContatiner.style.cursor = "wait";
            var winObj = window;
            this.OwnerControl.IsReadOnlyInternal = true;
            var pasteContent, textContent = "", htmlContent = "";
            var clipbordData = winObj.clipboardData ? winObj.clipboardData : evt.clipboardData;
            textContent = clipbordData.getData("Text");
            if (this.OwnerControl.ej.browserInfo().name != "msie") {
                htmlContent = clipbordData.getData("Text/Html");
                if (htmlContent.substring(5, 48) == ' xmlns:o="urn:schemas-microsoft-com:office:' || (htmlContent.substring(0, 5) != "<html")) {
                    htmlContent = "";
                }
            }
            if (htmlContent != "") {
                htmlContent = htmlContent.replace(/<!--StartFragment-->/gi, "");
                htmlContent = htmlContent.replace(/<!--EndFragment-->/gi, "");
                htmlContent = htmlContent.replace(/<div>/gi, "");
                htmlContent = htmlContent.replace(/<\/div>/gi, "");
                this._PasteDocContent(htmlContent);
            }
            else {
                if (textContent != "") {
                    this.OwnerControl.IsReadOnlyInternal = false;
                    this.OwnerControl.Viewer.ViewerContatiner.focus();
                    this._PasteContents(textContent);
                    this.OwnerControl.Viewer.ViewerContatiner.style.cursor = "default";
                    this.OwnerControl.Viewer.EditableDiv.innerHTML = "";
                }
            }
            this._UpdateFocus();
        };
        SelectionAdv.prototype._PasteInternal = function () {
            var ownerControl = this.OwnerControl;
            if (DocumentEditorHelper.htmlString != "" && DocumentEditorHelper.htmlString != null) {
                var document_7 = HTMLParser._ParseHTMLtoLogicalDom(DocumentEditorHelper.htmlString);
                this._PasteContents(document_7);
            }
        };
        SelectionAdv.prototype._PasteContents = function (content) {
            if (this.OwnerControl.IsReadOnlyMode || !this.OwnerControl.IsDocumentLoaded)
                return;
            var isRemoved = true;
            if (this.OwnerControl.Selection.SelectionRanges.Count > 0) {
                this._InitComplexHistory(Actions.Paste);
                for (var i = this.OwnerControl.Selection.SelectionRanges.Count - 1; i >= 0; i--) {
                    var selectionRange = this.SelectionRanges._Get(i);
                    this._InitializeHistory(Actions.Paste, selectionRange);
                    if (!selectionRange.IsEmpty)
                        isRemoved = this._RemoveSelectedContentInternal(selectionRange.Start, selectionRange.End);
                    if (isRemoved)
                        this._PasteContent(content);
                    else
                        this.CurrentBaseHistoryInfo = null;
                    this._Relayout(this.IsEmpty);
                }
                this._UpdateComplexHistory();
            }
        };
        SelectionAdv.prototype._PasteSectionChilds = function (section) {
            for (var i = 0; i < section.ChildNodes.Count; i++) {
                var block = section.Blocks[i];
                if (section.NextNode == null && section.Blocks[i + 1] == null && block instanceof ParagraphAdv) {
                    for (var j = 0; j < block.Inlines.Count; j++) {
                        var inline = block.Inlines[0];
                        if (!(this._IsInComment() && (inline instanceof CommentAdv || inline instanceof CommentStartAdv || inline instanceof CommentEndAdv)))
                            this._InsertInlineInternal(block.Inlines[0]);
                        j--;
                    }
                }
                else if (block instanceof BlockAdv) {
                    if (block instanceof TableAdv && this.Start.Paragraph.IsInsideTable) {
                        var clientWidth = this.Start.Paragraph._GetContainerWidth();
                        block._FitCellsToClientArea(clientWidth);
                    }
                    this._InsertBlock(block);
                    i--;
                }
            }
        };
        SelectionAdv.prototype._PasteContent = function (pasteContent) {
            this.OwnerControl.IsShiftingEnabled = true;
            if (this.CurrentBaseHistoryInfo.InsertPosition == null)
                this.CurrentBaseHistoryInfo.InsertPosition = this.Start._GetHierarchicalIndexInternal();
            this.OwnerControl.IsLayoutEnabled = true;
            if (pasteContent instanceof DocumentAdv) {
                var document_8 = pasteContent;
                for (var i = 0; i < document_8.Sections.Count; i++) {
                    var section = document_8.Sections[i];
                    this._PasteSectionChilds(section);
                    this.ownerControl.IsPastingContent = true;
                }
            }
            if (typeof (pasteContent) == "string") {
                var arr = [];
                var txt = pasteContent;
                txt = txt.replace(/\n/g, "\r");
                arr = txt.split('\r');
                for (var i = 0; i < arr.length; i++) {
                    var insertFormat = this._CopySelectionCharacterFormat();
                    var insertParaFormat = this._CopySelectionParagraphFormat();
                    var paragraphAdv = new ParagraphAdv(null);
                    paragraphAdv.ParagraphFormat._CopyFormat(insertParaFormat);
                    if (arr[i].length > 0) {
                        var spanAdv = new SpanAdv(null);
                        spanAdv.Text = arr[i];
                        spanAdv.CharacterFormat._CopyFormat(insertFormat);
                        paragraphAdv.Inlines._Add(spanAdv);
                        this._InsertBlock(paragraphAdv);
                        this.ownerControl.IsPastingContent = true;
                    }
                }
            }
            this.CurrentBaseHistoryInfo.EndPosition = this.Start._GetHierarchicalIndexInternal();
            this.ownerControl.IsPastingContent = false;
        };
        SelectionAdv.prototype._CopySelectedContent = function (isCut) {
            var htmlContent = "";
            for (var i = 0; i < this.SelectionRanges.Count; i++) {
                htmlContent += this.SelectionRanges._Get(i)._GetSelectedContentAsHTML();
            }
            if (isCut) {
                var startPosition = this.Start;
                var endPosition = this.End;
                if (!this.IsForward) {
                    startPosition = this.End;
                    endPosition = this.Start;
                }
                this.OwnerControl.IsShiftingEnabled = true;
                this.EditPosition = startPosition._GetHierarchicalIndexInternal();
                var imageAdv = null;
                if (startPosition.Paragraph == endPosition.Paragraph && startPosition.Offset + 1 == endPosition.Offset) {
                    var index = 0;
                    var currentinline = startPosition.Paragraph._GetInline(endPosition.Offset, index);
                    var inline = currentinline.inline;
                    imageAdv = inline;
                }
                if (this.OwnerControl.Selection.SelectionRanges.Count > 0) {
                    this._InitComplexHistory(Actions.MultiSelection);
                    for (var i = 0; i < this.OwnerControl.Selection.SelectionRanges.Count; i++) {
                        var selectionRange = this.OwnerControl.Selection.SelectionRanges._Get(i);
                        startPosition = selectionRange.Start;
                        endPosition = selectionRange.End;
                        if (!selectionRange.IsForward) {
                            startPosition = selectionRange.End;
                            endPosition = selectionRange.Start;
                        }
                        this._InitializeHistory(Actions.Cut, selectionRange);
                        this.CurrentBaseHistoryInfo.InsertPosition = startPosition._GetHierarchicalIndexInternal();
                        startPosition.Paragraph._DeleteSelectedContent(this, startPosition, endPosition, 3);
                        this._Relayout(true);
                        this._UpdateSelectionRangeOffSet(i, startPosition, endPosition);
                    }
                    var textPosition = new TextPosition(this.OwnerControl);
                    textPosition._SetPositionForCurrentIndex(this.EditPosition);
                    this._SelectContent(textPosition, true);
                    this._UpdateComplexHistory();
                }
            }
            this._CopyToClipboard(htmlContent);
        };
        SelectionAdv.prototype._CopyToClipboard = function (htmlContent) {
            var selection = window.getSelection();
            selection.removeAllRanges();
            var div = document.createElement("div");
            div.innerHTML = htmlContent;
            DocumentEditorHelper.htmlString = htmlContent;
            document.body.appendChild(div);
            var range = document.createRange();
            range.selectNodeContents(div);
            selection.addRange(range);
            var copysuccess = false;
            try {
                copysuccess = document.execCommand("copy");
            }
            catch (e) {
            }
            finally {
                selection.removeAllRanges();
                div.parentNode.removeChild(div);
            }
            return copysuccess;
        };
        SelectionAdv.prototype._GetHyperlinkField = function () {
            if (this.End == null)
                return null;
            var index = 0;
            var currentInline = this.End.Paragraph._GetInline(this.End.Offset, index);
            index = currentInline.index;
            var inline = currentInline.inline;
            var CheckedFields = new List();
            var field = null;
            if (inline == null)
                field = this.End.Paragraph._GetHyperlinkFields(this.End.Paragraph, CheckedFields);
            else
                field = inline.OwnerParagraph._GetHyperlinkField(inline, CheckedFields);
            CheckedFields._Clear();
            CheckedFields = null;
            return field;
        };
        SelectionAdv.prototype._GetText = function (includeObject) {
            if (this.Start == null || this.End == null || this.Start.Paragraph == null || this.End.Paragraph == null)
                return null;
            var startPosition = this.Start;
            var endPosition = this.End;
            if (startPosition == null || startPosition._IsAtSamePosition(endPosition))
                return "";
            return HelperMethods._GetTextInternal(startPosition, endPosition, includeObject);
        };
        SelectionAdv.prototype._GetTable = function (startPosition, endPosition) {
            if (startPosition.Paragraph.AssociatedCell != null && endPosition.Paragraph.AssociatedCell != null) {
                var startTable = startPosition.Paragraph.AssociatedCell.OwnerTable;
                var endTable = endPosition.Paragraph.AssociatedCell.OwnerTable;
                if (startTable == endTable)
                    return startTable;
                else {
                    if (startTable._Contains(endPosition.Paragraph.AssociatedCell))
                        return startTable;
                    else if (endTable._Contains(startPosition.Paragraph.AssociatedCell))
                        return endTable;
                    else if (!startTable.IsInsideTable || !endTable.IsInsideTable)
                        return null;
                    else {
                        do {
                            startTable = startTable.AssociatedCell.OwnerTable;
                            if (startTable == endTable || startTable._Contains(endTable.AssociatedCell))
                                return startTable;
                            else if (endTable._Contains(startTable.AssociatedCell))
                                return endTable;
                        } while (startTable.AssociatedCell != null);
                    }
                }
            }
            return null;
        };
        SelectionAdv.prototype._InsertInlineInternal = function (inline) {
            if (this.Start.Paragraph._IsEmpty())
                this.Start.Paragraph.Inlines._Add(inline);
            else {
                var indexInInline = 0;
                var inlineObj = this.Start.Paragraph._GetInline(this.Start.Offset, indexInInline);
                var curInline = inlineObj.inline;
                indexInInline = inlineObj.index;
                curInline._InsertInline(inline, indexInInline);
            }
            this._Selects(inline.OwnerParagraph, this.Start.Offset + inline.Length, true);
        };
        SelectionAdv.prototype._InsertInline = function (inline) {
            if (!this.ownerControl.History.IsRedoing)
                this.ownerControl.IsShiftingEnabled = true;
            if (!this.IsEmpty)
                this._RemoveSelectedContent();
            if (this.CurrentBaseHistoryInfo.InsertPosition == null)
                this.CurrentBaseHistoryInfo.InsertPosition = this.Start._GetHierarchicalIndexInternal();
            this._InsertInlineInternal(inline);
            if (this.CurrentBaseHistoryInfo.EndPosition == null)
                this.CurrentBaseHistoryInfo.EndPosition = this.Start._GetHierarchicalIndexInternal();
            this._FireContentChanged();
        };
        SelectionAdv.prototype._InsertText = function (text, isReplace) {
            if (this.Start == null)
                return;
            var insertPosition;
            var isRemoved = true;
            var insertFormat = this._CopySelectionCharacterFormat();
            if (this.OwnerControl.Selection.SelectionRanges.Count > 1) {
                this._SelectTextRanges();
                this._InitHistory(Actions.Insert);
                this.CurrentHistoryInfo._AddModifiedAction(this.CurrentBaseHistoryInfo);
            }
            else
                this._InitHistory(Actions.Insert);
            if (!this.IsEmpty) {
                this.IsSkipLayouting = true;
                isRemoved = this._RemoveSelectedContent();
                this.IsSkipLayouting = false;
            }
            if (isRemoved) {
                this.OwnerControl.IsShiftingEnabled = true;
                if (this.CurrentBaseHistoryInfo.InsertPosition == null)
                    this.CurrentBaseHistoryInfo.InsertPosition = this.Start._GetHierarchicalIndexInternal();
                insertPosition = this.Start;
                if (insertPosition.Paragraph._IsEmpty()) {
                    var span = new SpanAdv(null);
                    span.CharacterFormat._CopyFormat(insertFormat);
                    span.Text = text;
                    insertPosition.Paragraph.Inlines._Add(span);
                }
                else {
                    var indexInInline = 0;
                    var inlineObj = insertPosition.Paragraph._GetInline(insertPosition.Offset, indexInInline);
                    var inline = inlineObj.inline;
                    indexInInline = inlineObj.index;
                    if (insertFormat._IsEqualFormat(inline.CharacterFormat))
                        inline._InsertText(this, text, indexInInline);
                    else {
                        this._CopyInlineCharacterFormat(insertFormat, inline.CharacterFormat);
                        if (indexInInline == inline.Length) {
                            var span = new SpanAdv(null);
                            span.Text = text;
                            span.CharacterFormat._CopyFormat(insertFormat);
                            inline.OwnerParagraph.Inlines._Insert(inline.OwnerParagraph.Inlines._IndexOf(inline) + 1, span);
                        }
                        else if (indexInInline == 0) {
                            var span = new SpanAdv(null);
                            span.Text = text;
                            span.CharacterFormat._CopyFormat(insertFormat);
                            inline.OwnerParagraph.Inlines._Insert(inline.OwnerParagraph.Inlines._IndexOf(inline), span);
                        }
                        else {
                            var span = new SpanAdv(null);
                            span.Text = text;
                            span.CharacterFormat._CopyFormat(insertFormat);
                            inline.OwnerParagraph.Inlines._Insert(inline.OwnerParagraph.Inlines._IndexOf(inline) + 1, span);
                            if (inline instanceof SpanAdv) {
                                var splittedSpan = inline._Clone();
                                splittedSpan.Text = inline.Text.substring(indexInInline);
                                inline.Text = inline.Text.slice(0, indexInInline);
                                inline.OwnerParagraph.Inlines._Insert(span.OwnerParagraph.Inlines._IndexOf(span) + 1, splittedSpan);
                            }
                        }
                    }
                }
            }
            this._Selects(insertPosition.Paragraph, insertPosition.Offset + text.length, true);
            if (this.CurrentBaseHistoryInfo.EndPosition == null)
                this.CurrentBaseHistoryInfo.EndPosition = this.Start._GetHierarchicalIndexInternal();
            if (this.CurrentHistoryInfo != null && this.CurrentHistoryInfo.Action == Actions.MultiSelection)
                this._UpdateComplexHistory();
            else
                this._Relayout(true);
            if (!isReplace && isRemoved && (text == " " || text == "\t" || text == "\v"))
                this._CheckAndConvertToHyperlink();
        };
        SelectionAdv.prototype._CheckAndConvertToHyperlink = function () {
            var indexInInline = 0;
            var inlineObj = this.Start.Paragraph._GetInline(this.Start.Offset - 1, indexInInline);
            var inline = inlineObj.inline;
            indexInInline = inlineObj.index;
            if (indexInInline == 0) {
                if (inline.PreviousNode == null)
                    return;
                inline = inline.PreviousNode;
                indexInInline = inline.Length;
            }
            if (!(inline instanceof SpanAdv))
                return;
            var span = inline;
            var text = span.Text.substring(0, indexInInline);
            var index = 0;
            var lastTabChar = text.lastIndexOf('\t');
            index = (lastTabChar >= 0) ? lastTabChar + 1 : text.lastIndexOf(' ') + 1;
            while (index > 0 && span.PreviousNode instanceof SpanAdv) {
                span = span.PreviousNode;
                var previousText = span.Text;
                index = previousText.lastIndexOf('\t');
                text = span.Text + text;
            }
            text = text.substring(index);
            var textToLC = text.toLowerCase();
            var containsURL = false;
            if (textToLC.substring(0, 8) == "file:///"
                || (textToLC.substring(0, 7) == "http://" && textToLC.length > 7)
                || (textToLC.substring(0, 8) == "https://" && textToLC.length > 8)
                || (textToLC.substring(0, 4) == "www." && textToLC.length > 4)
                || (textToLC.substring(0, 3) == "\\" && textToLC.length > 3)
                || (textToLC.substring(0, 7) == "mailto:" && textToLC.length > 7)) {
                containsURL = true;
                if (textToLC.substring(0, 4) == "www." && textToLC.length > 4)
                    text = "http://" + text;
            }
            else {
                var indexOfAt = text.indexOf('@');
                var indexOfDot = text.indexOf('.');
                if (indexOfAt > 0 && indexOfAt < indexOfDot && indexOfDot < text.length - 1) {
                    containsURL = true;
                    text = "mailto:" + text;
                }
            }
            if (containsURL) {
                var startPosition = new TextPosition(this.OwnerControl);
                startPosition._SetPositionParagraph(span.OwnerParagraph, span.OwnerParagraph._GetOffset(span, index));
                var endPosition = new TextPosition(this.OwnerControl);
                endPosition._SetPositionParagraph(this.End.Paragraph, this.End.Offset - 1);
                this._AutoFormatHyperlink(text, startPosition, endPosition);
            }
        };
        SelectionAdv.prototype._AutoFormatHyperlink = function (url, startPosition, endPosition) {
            this.preservedFontCol = this._GetFontColor();
            this._InitComplexHistory(Actions.AutoFormatHyperlink);
            this.CurrentHistoryInfo.InsertPosition = startPosition._GetHierarchicalIndexInternal();
            this.Start._SetPositionInternal(startPosition);
            this.End._SetPositionInternal(endPosition);
            var format = this._GetCharacterFormat()._CloneFormat();
            this._InitHistory(Actions.Underline);
            this._UpdateCharacterFormatForSelRange(this.CurrentSelectionRange, CharacterFormat.UnderlineProperty, Underline.Single);
            this._Relayout(false);
            this._InitHistory(Actions.FontColor);
            this._UpdateCharacterFormatForSelRange(this.CurrentSelectionRange, CharacterFormat.FontColorProperty, "#0563c1");
            this._Relayout(false);
            var fieldEnd = new FieldEndAdv(null);
            fieldEnd.CharacterFormat._CopyFormat(format);
            this.Start._SetPositionInternal(this.End);
            this._InitInsertInline(fieldEnd);
            this.Start._SetPositionInternal(startPosition);
            this.End._SetPositionInternal(startPosition);
            var fieldBegin = new FieldBeginAdv(null);
            fieldBegin.CharacterFormat._CopyFormat(format);
            this._InitInsertInline(fieldBegin);
            var span = new SpanAdv(null);
            span.CharacterFormat._CopyFormat(format);
            span.Text = " HYPERLINK \"" + url + "\" ";
            this._InitInsertInline(span);
            var fieldSeparator = new FieldSeparatorAdv(null);
            fieldSeparator.CharacterFormat._CopyFormat(format);
            this._InitInsertInline(fieldSeparator);
            this.Start._SetPositionParagraph(fieldEnd.OwnerParagraph, fieldEnd.OwnerParagraph._GetOffset(fieldEnd, 1));
            this.Start._MoveNextPosition();
            this.End._SetPositionInternal(this.Start);
            this.CurrentHistoryInfo.EndPosition = this.End._GetHierarchicalIndexInternal();
            this._UpdateComplexHistory();
        };
        SelectionAdv.prototype._InsertTable = function (table) {
            this.OwnerControl.IsShiftingEnabled = true;
            this._InitHistory(Actions.InsertTable);
            var clientWidth = this.Start.Paragraph._GetContainerWidth();
            table._FitCellsToClientArea(clientWidth);
            this._InsertBlock(table);
            this.Start._SetPosition(table._GetFirstParagraphInFirstCell(), true);
            this.End._SetPositionInternal(this.Start);
            var lastPargaraph = table._GetLastParagraphInLastCell();
            var endOffset = lastPargaraph._GetLength() + 1;
            this.CurrentBaseHistoryInfo.EndPosition = lastPargaraph._GetHierarchicalIndex(endOffset.toString());
            this._Relayout(true);
        };
        SelectionAdv.prototype._InsertRow = function (rowPlacement) {
            if (this.Start.Paragraph.IsInsideTable) {
                if (!this.OwnerControl.History.IsRedoing)
                    this._InitHistory(rowPlacement == RowPlacement.Above ? Actions.InsertRowAbove : Actions.InsertRowBelow);
                this.OwnerControl.IsShiftingEnabled = true;
                var row = this.IsForward ? this.Start.Paragraph.AssociatedCell.OwnerRow : this.End.Paragraph.AssociatedCell.OwnerRow;
                var clonedTable = row.OwnerTable._CloneTableToHistoryInfo(this.CurrentBaseHistoryInfo);
                var insertRow = void 0;
                var index = row.RowIndex;
                if (rowPlacement == RowPlacement.Below) {
                    index = this.IsForward ? this.End.Paragraph.AssociatedCell.OwnerRow.RowIndex : this.Start.Paragraph.AssociatedCell.OwnerRow.RowIndex;
                    index++;
                }
                var rowCount = this._GetRowCountToInsert();
                for (var i = 0; i < rowCount; i++) {
                    insertRow = row._GetBlankRow();
                    row.OwnerTable.Rows._Insert(index, insertRow);
                }
                this.Start._SetPosition(row.OwnerTable.Rows[index].Cells[0]._GetFirstParagraph(), true);
                if (!this.OwnerControl.History.IsRedoing)
                    this._Relayout(true);
            }
        };
        SelectionAdv.prototype._InsertColumn = function (columnPlacement) {
            if (this.Start.Paragraph.IsInsideTable) {
                if (!this.OwnerControl.History.IsRedoing)
                    this._InitHistory(columnPlacement == ColumnPlacement.Left ? Actions.InsertColumnLeft : Actions.InsertColumnRight);
                this.OwnerControl.IsShiftingEnabled = true;
                var start = this.CurrentSelectionRange.Start;
                var end = this.CurrentSelectionRange.End;
                if (!this.CurrentSelectionRange.IsForward) {
                    start = this.CurrentSelectionRange.End;
                    end = this.CurrentSelectionRange.Start;
                }
                var cell = start.Paragraph.AssociatedCell;
                var table = cell.OwnerRow.OwnerTable;
                var clonedTable = table._CloneTableToHistoryInfo(this.CurrentBaseHistoryInfo);
                this.OwnerControl.IsLayoutEnabled = false;
                var cellIndex = cell.CellIndex;
                if (columnPlacement == ColumnPlacement.Right) {
                    cellIndex = end.Paragraph.AssociatedCell.CellIndex;
                    cellIndex++;
                }
                var startParagraph = null;
                var newCell = null;
                var columnCount = this._GetColumnCountToInsert();
                for (var i = 0; i < columnCount; i++) {
                    for (var i_4 = 0; i_4 < table.Rows.length; i_4++) {
                        var row = table.Rows[i_4];
                        newCell = cell._GetBlankCell();
                        if (startParagraph == null)
                            startParagraph = newCell._GetFirstParagraph();
                        if (cellIndex > row.Cells.Count)
                            row.Cells._Add(newCell);
                        else
                            row.Cells._Insert(cellIndex, newCell);
                    }
                }
                var parentTable = table._GetParentTable();
                if (parentTable != null)
                    parentTable._FitChildsToClientArea();
                else
                    table._FitChildsToClientArea();
                this.OwnerControl.IsLayoutEnabled = true;
                table._Layout();
                this.Start._SetPosition(startParagraph, true);
                this.End._SetPosition(newCell._GetLastParagraph(), false);
                if (!this.OwnerControl.History.IsRedoing)
                    this._Relayout(true);
            }
        };
        SelectionAdv.prototype._InsertBlock = function (block) {
            var isRemoved = true;
            if (!this.IsEmpty)
                isRemoved = this._RemoveSelectedContent();
            if (!isRemoved)
                this._SelectContent(this.Start, false);
            this._InsertBlockInternal(block);
            if (this.CurrentBaseHistoryInfo.InsertPosition == null) {
                var paragraph = null;
                if (block instanceof ParagraphAdv)
                    paragraph = block;
                if (block instanceof TableAdv)
                    paragraph = block._GetFirstParagraphInFirstCell();
                this.CurrentBaseHistoryInfo.InsertPosition = paragraph._GetHierarchicalIndex("0");
            }
            this._FireContentChanged();
        };
        SelectionAdv.prototype._InsertBlockInternal = function (block) {
            if (!this.Start.IsAtParagraphStart) {
                if (block instanceof ParagraphAdv) {
                    this._InsertParagraph(block, false);
                    return;
                }
                if (this.CurrentBaseHistoryInfo.InsertPosition == null)
                    this.CurrentBaseHistoryInfo.InsertPosition = this.Start._GetHierarchicalIndexInternal();
                this.Start.Paragraph._SplitParagraph(0, this.Start.Offset);
                this._SelectParagraph(this.Start.Paragraph, true, false);
            }
            if (this.Start.Paragraph.Owner instanceof CommentAdv) {
                var insertIndex = this.Start.Paragraph.Owner.Blocks.indexOf(this.Start.Paragraph);
                this.Start.Paragraph.Owner.Blocks._Insert(insertIndex, block);
                return;
            }
            var index = this.Start.Paragraph._GetIndexInOwnerCollection();
            var childNodes = this.Start.Paragraph.Owner.ChildNodes;
            var blockAdvCollection = (childNodes instanceof BlockAdvCollection) ? childNodes : null;
            if (blockAdvCollection != null)
                blockAdvCollection._Insert(index, block);
        };
        SelectionAdv.prototype._InsertSection = function (section) {
            if (this.CurrentBaseHistoryInfo.InsertPosition == null)
                this.CurrentBaseHistoryInfo.InsertPosition = this.Start._GetHierarchicalIndexInternal();
            var ownerSection = this.Start.Paragraph.Section;
            ownerSection._SplitSection(section, this.Start.Paragraph);
        };
        SelectionAdv.prototype._InsertSectionInternal = function (section, table) {
            if (this.CurrentBaseHistoryInfo.InsertPosition == null)
                this.CurrentBaseHistoryInfo.InsertPosition = this.Start._GetHierarchicalIndexInternal();
            var ownerSection = table.Section;
            ownerSection._SplitSection(section, table);
        };
        SelectionAdv.prototype._InsertBlockTable = function (block, table) {
            var offset = this.Start.Offset;
            if (block instanceof ParagraphAdv && offset > 0) {
                this.Start.Paragraph._MoveInlines(block, 0, 0, offset);
                this._SelectParagraph(this.Start.Paragraph, true, false);
                if (this.CurrentBaseHistoryInfo.InsertPosition == null)
                    this.CurrentBaseHistoryInfo.InsertPosition = block._GetHierarchicalIndex(offset.toString());
            }
            if (offset > 0 && this.CurrentBaseHistoryInfo.InsertPosition == null)
                this.CurrentBaseHistoryInfo.InsertPosition = this.Start._GetHierarchicalIndexInternal();
            if (this.Start.Paragraph.Owner instanceof CommentAdv) {
                var insertIndex = table.Owner.Blocks.indexOf(table);
                table.Owner.Blocks._Insert(insertIndex, block);
                return;
            }
            var index = table._GetIndexInOwnerCollection();
            table.Owner.ChildNodes._Insert(index, block);
            if (this.CurrentBaseHistoryInfo.InsertPosition == null) {
                var paragraph = null;
                if (block instanceof ParagraphAdv)
                    paragraph = block;
                if (block instanceof TableAdv)
                    paragraph = block._GetFirstParagraphInFirstCell();
                this.CurrentBaseHistoryInfo.InsertPosition = paragraph._GetHierarchicalIndex("0");
            }
        };
        SelectionAdv.prototype._InsertImage = function (image) {
            if (this.OwnerControl.Selection.SelectionRanges.Count > 0) {
                this._SelectTextRanges();
                this._InitHistory(Actions.InsertInline);
                this.CurrentHistoryInfo._AddModifiedAction(this.CurrentBaseHistoryInfo);
            }
            this._FitImageToPage(image);
            this._InsertInline(image);
            if (this.CurrentHistoryInfo != null)
                this._UpdateComplexHistory();
        };
        SelectionAdv.prototype._GetCharacterFormat = function () {
            if (this.Start.Paragraph._IsEmpty())
                return this.Start.Paragraph.CharacterFormat;
            else {
                var indexInInline = 0;
                var inlineObj = this.Start.Paragraph._GetInline(this.Start.Offset, indexInInline);
                var curInline = inlineObj.inline;
                indexInInline = inlineObj.index;
                return curInline.CharacterFormat;
            }
        };
        SelectionAdv.prototype._GetFontColor = function () {
            var fontColor = this.CharacterFormat.FontColor;
            if (fontColor == null) {
                var index = 0;
                var startPosition = this.Start;
                if (!this.IsForward)
                    startPosition = this.End;
                var inlineObj = startPosition.Paragraph._GetInline(startPosition.Offset, index);
                var inline = inlineObj.inline;
                index = inlineObj.index;
                if (inline != null && index == inline.Length && inline.NextNode != null) {
                    inline = inline.NextNode;
                    index = 0;
                }
                if (inline != null)
                    fontColor = inline.CharacterFormat.FontColor;
            }
            return fontColor;
        };
        SelectionAdv.prototype._InitInsertInline = function (inline) {
            this._InitHistory(Actions.InsertInline);
            this._InsertInline(inline);
            this._UpdateHistory();
        };
        SelectionAdv.prototype._InsertHyperlinkByFormat = function (url, displayText, format) {
            if (this.CurrentBaseHistoryInfo.InsertPosition == null)
                this.CurrentBaseHistoryInfo.InsertPosition = this.Start._GetHierarchicalIndexInternal();
            this.OwnerControl.IsShiftingEnabled = true;
            this.preservedFontCol = this._GetFontColor();
            var fieldBegin = new FieldBeginAdv(null);
            fieldBegin.CharacterFormat._CopyFormat(format);
            this._InsertInlineInternal(fieldBegin);
            var span = new SpanAdv(null);
            span.CharacterFormat._CopyFormat(format);
            span.Text = " HYPERLINK \"" + url + "\" ";
            this._InsertInlineInternal(span);
            var fieldSeparator = new FieldSeparatorAdv(null);
            fieldSeparator.CharacterFormat._CopyFormat(format);
            this._InsertInlineInternal(fieldSeparator);
            if (displayText != null || displayText != "" || displayText != undefined) {
                span = new SpanAdv(null);
                span.CharacterFormat._CopyFormat(format);
                span.CharacterFormat.Underline = Underline.Single;
                span.CharacterFormat.FontColor = "#0563c1";
                span.Text = displayText;
                this._InsertInlineInternal(span);
            }
            var fieldEnd = new FieldEndAdv(null);
            fieldEnd.CharacterFormat._CopyFormat(format);
            this._InsertInlineInternal(fieldEnd);
            var offset = fieldEnd.OwnerParagraph._GetOffset(fieldEnd, 1);
            this._Selects(fieldEnd.OwnerParagraph, offset, true);
            this.CurrentBaseHistoryInfo.EndPosition = this.Start._GetHierarchicalIndexInternal();
            this._Relayout(true);
        };
        SelectionAdv.prototype._InserthyperlinkInternal = function (url, displayText) {
            if (this.Start == null)
                return;
            if (this._EditHyperlink(url, displayText))
                return;
            this._InitHistory(Actions.InsertHyperlink);
            var isRemoved = true;
            if (!this.IsEmpty)
                isRemoved = this._RemoveSelectedContent();
            if (isRemoved) {
                var format = this._GetCharacterFormat();
                this._InsertHyperlinkByFormat(url, displayText, format);
            }
        };
        SelectionAdv.prototype._EditHyperlink = function (url, displayText) {
            var fieldBegin = this._GetHyperlinkField();
            if (fieldBegin == null)
                return false;
            this._InitHistory(Actions.InsertHyperlink);
            var fieldResult = "";
            var isNestedField = false;
            var format = this._GetCharacterFormat();
            var fieldSeparator = null;
            if (fieldBegin.fieldSeparator != null) {
                fieldSeparator = fieldBegin.fieldSeparator;
                var fieldObj = fieldBegin.fieldSeparator.OwnerParagraph._GetHyperlinkDisplayText(fieldBegin.fieldSeparator, fieldBegin.fieldEnd, isNestedField, format);
                var fieldResult_1 = fieldObj.displayText;
                isNestedField = fieldObj.isNestedField;
                format = fieldObj.format;
            }
            var offset = fieldBegin.OwnerParagraph._GetOffset(fieldBegin, 0);
            this.Start._SetPositionParagraph(fieldBegin.OwnerParagraph, offset);
            offset = fieldBegin.fieldEnd.OwnerParagraph._GetOffset(fieldBegin.fieldEnd, 1);
            this.End._SetPositionParagraph(fieldBegin.fieldEnd.OwnerParagraph, offset);
            this._DeleteSelectedContents(false);
            if (!isNestedField && fieldResult != displayText || fieldSeparator == null)
                this._InsertHyperlinkByFormat(url, displayText, format);
            else {
                if (this.CurrentBaseHistoryInfo.InsertPosition == null)
                    this.CurrentBaseHistoryInfo.InsertPosition = this.Start._GetHierarchicalIndexInternal();
                var newfieldBegin = new FieldBeginAdv(null);
                newfieldBegin.CharacterFormat._CopyFormat(fieldBegin.CharacterFormat);
                this._InsertInlineInternal(newfieldBegin);
                var span = new SpanAdv(null);
                span.CharacterFormat._CopyFormat(fieldBegin.CharacterFormat);
                span.Text = " HYPERLINK \"" + url + "\" ";
                this._InsertInlineInternal(span);
                this.CurrentBaseHistoryInfo._InsertClonedFieldResult(fieldSeparator);
                this._Selects(newfieldBegin.fieldEnd.OwnerParagraph, offset, true);
                this.CurrentBaseHistoryInfo.EndPosition = this.Start._GetHierarchicalIndexInternal();
                this._Relayout(true);
            }
            return true;
        };
        SelectionAdv.prototype._InsertHyperlink = function (url, displayText, remove) {
            if (this.Start.Paragraph.AssociatedCell != this.End.Paragraph.AssociatedCell)
                return;
            if (remove)
                this._InserthyperlinkInternal(url, displayText);
            else {
                this.preservedFontCol = this._GetFontColor();
                var startPosition = this.Start;
                var endPosition = this.End;
                if (!this.IsForward) {
                    startPosition = this.End;
                    endPosition = this.Start;
                }
                var fiedStartPosition = new TextPosition(this.ownerControl);
                fiedStartPosition._SetPositionInternal(startPosition);
                var format = this._GetCharacterFormat()._CloneFormat();
                this._InitComplexHistory(Actions.InsertHyperlink);
                this.CurrentHistoryInfo.InsertPosition = startPosition._GetHierarchicalIndexInternal();
                this._InitHistory(Actions.Underline);
                this._UpdateCharacterFormatForSelRange(this.CurrentSelectionRange, CharacterFormat.UnderlineProperty, Underline.Single);
                this._Relayout(false);
                this._InitHistory(Actions.FontColor);
                this._UpdateCharacterFormatForSelRange(this.CurrentSelectionRange, CharacterFormat.FontColorProperty, "#0563c1");
                this._Relayout(false);
                startPosition._SetPositionInternal(endPosition);
                endPosition._SetPositionInternal(startPosition);
                var fieldEnd = new FieldEndAdv(null);
                fieldEnd.CharacterFormat._CopyFormat(format);
                startPosition._SetPositionInternal(endPosition);
                this._InitInsertInline(fieldEnd);
                startPosition._SetPositionInternal(fiedStartPosition);
                endPosition._SetPositionInternal(startPosition);
                var fieldBegin = new FieldBeginAdv(null);
                fieldBegin.CharacterFormat._CopyFormat(format);
                this._InitInsertInline(fieldBegin);
                var span = new SpanAdv(null);
                span.CharacterFormat._CopyFormat(format);
                span.Text = " HYPERLINK \"" + url + "\" ";
                this._InitInsertInline(span);
                var fieldSeparator = new FieldSeparatorAdv(null);
                fieldSeparator.CharacterFormat._CopyFormat(format);
                this._InitInsertInline(fieldSeparator);
                this._Selects(fieldEnd.OwnerParagraph, fieldEnd.OwnerParagraph._GetOffset(fieldEnd, fieldEnd.Length), true);
                this.CurrentHistoryInfo.EndPosition = endPosition._GetHierarchicalIndexInternal();
                this._UpdateComplexHistory();
            }
        };
        SelectionAdv.prototype._RemoveHyperlink = function () {
            var fontColor = this.preservedFontCol;
            var fieldBegin = this._GetHyperlinkField();
            if (fieldBegin == null)
                return;
            var fieldEnd = fieldBegin.fieldEnd;
            var fieldSeparator = fieldBegin.fieldSeparator;
            var fieldStartPosition = new TextPosition(this.ownerControl);
            fieldStartPosition._SetPositionParagraph(fieldBegin.OwnerParagraph, fieldBegin.OwnerParagraph._GetOffset(fieldBegin, 0));
            var fieldSeparatorPosition = new TextPosition(this.ownerControl);
            fieldSeparatorPosition._SetPositionParagraph(fieldSeparator.OwnerParagraph, fieldSeparator.OwnerParagraph._GetOffset(fieldSeparator, fieldSeparator.Length));
            this._InitComplexHistory(Actions.RemoveHyperlink);
            this.Start._SetPositionParagraph(fieldEnd.OwnerParagraph, fieldEnd.OwnerParagraph._GetOffset(fieldEnd, 0));
            this.End._SetPositionInternal(this.Start);
            this._OnDelete();
            this.Start._SetPositionInternal(fieldSeparatorPosition);
            this._InitHistory(Actions.Underline);
            this._UpdateCharacterFormatForSelRange(this.CurrentSelectionRange, CharacterFormat.UnderlineProperty, Underline.None);
            this._Relayout(false);
            this._InitHistory(Actions.FontColor);
            this._UpdateCharacterFormatForSelRange(this.CurrentSelectionRange, CharacterFormat.FontColorProperty, fontColor);
            this._Relayout(false);
            this.End._SetPositionInternal(this.Start);
            this.Start._SetPositionInternal(fieldStartPosition);
            this._InitHistory(Actions.Delete);
            this._DeleteSelectedContents(false);
            this._Relayout(true);
            this._UpdateComplexHistory();
        };
        SelectionAdv.prototype._GetRowCountToInsert = function () {
            var count = 1;
            var selectionRange = this.CurrentSelectionRange;
            var start = selectionRange.Start;
            var end = selectionRange.End;
            if (!selectionRange.IsForward) {
                start = selectionRange.End;
                end = selectionRange.Start;
            }
            if (start != null && end != null && this._GetTable(start, end) != null) {
                if (start.Paragraph.AssociatedCell == end.Paragraph.AssociatedCell || start.Paragraph.AssociatedCell.OwnerRow == end.Paragraph.AssociatedCell.OwnerRow) {
                    return count = 1;
                }
                else {
                    return count = count + end.Paragraph.AssociatedCell.OwnerRow.RowIndex - start.Paragraph.AssociatedCell.OwnerRow.RowIndex;
                }
            }
            return count == 0 ? 1 : count;
        };
        SelectionAdv.prototype._GetColumnCountToInsert = function () {
            var count = 1;
            var selectionRange = this.CurrentSelectionRange;
            var start = selectionRange.Start;
            var end = selectionRange.End;
            if (!selectionRange.IsForward) {
                start = selectionRange.End;
                end = selectionRange.Start;
            }
            if (start != null && end != null && this._GetTable(start, end) != null) {
                if (start.Paragraph.AssociatedCell == end.Paragraph.AssociatedCell) {
                    return count = 1;
                }
                if (start.Paragraph.AssociatedCell.OwnerRow == end.Paragraph.AssociatedCell.OwnerRow) {
                    return count = count + end.Paragraph.AssociatedCell.CellIndex - start.Paragraph.AssociatedCell.CellIndex;
                }
                else {
                    count = 0;
                    var selectedCells = start.Paragraph.AssociatedCell.OwnerTable._GetColumnCellsForSelection(start.Paragraph.AssociatedCell, end.Paragraph.AssociatedCell);
                    for (var i = void 0; i < selectedCells.length; i++) {
                        var cell = selectedCells[i];
                        if (start.Paragraph.AssociatedCell.OwnerRow == cell.OwnerRow)
                            count++;
                    }
                }
            }
            return count == 0 ? 1 : count;
        };
        SelectionAdv.prototype._DeleteTable = function () {
            if (this.Start.Paragraph.IsInsideTable) {
                var table = this.Start.Paragraph.AssociatedCell.OwnerTable;
                this.OwnerControl.IsShiftingEnabled = true;
                if (!this.OwnerControl.History.IsRedoing)
                    this._InitHistory(Actions.DeleteTable);
                this.CurrentBaseHistoryInfo.InsertPosition = table._GetHierarchicalIndex("0");
                var paragraph = null;
                if (table.NextBlock != null)
                    paragraph = table.NextBlock instanceof ParagraphAdv ? table.NextBlock : table.NextBlock._GetFirstParagraphInFirstCell();
                else if (table.PreviousBlock != null)
                    paragraph = table.PreviousBlock instanceof ParagraphAdv ? table.PreviousBlock : table.NextBlock._GetLastParagraphInLastCell();
                table._RemoveBlock();
                this.CurrentBaseHistoryInfo.RemovedNodes._Add(table);
                this._SelectParagraph(paragraph, true, true);
                if (!this.OwnerControl.History.IsRedoing)
                    this._Relayout(true);
            }
        };
        SelectionAdv.prototype._DeleteRow = function () {
            if (this.Start.Paragraph.IsInsideTable) {
                var row = this.Start.Paragraph.AssociatedCell.OwnerRow;
                if (!this.OwnerControl.History.IsRedoing)
                    this._InitHistory(Actions.DeleteRow);
                this.OwnerControl.IsShiftingEnabled = true;
                var clonedTable = row.OwnerTable._CloneTableToHistoryInfo(this.CurrentBaseHistoryInfo);
                var paragraph = null;
                if (row.NextNode != null) {
                    var nextCell = row.NextNode.Cells[0];
                    paragraph = nextCell._GetFirstParagraph();
                }
                if (paragraph == null) {
                    if (row.OwnerTable.NextBlock != null)
                        paragraph = row.OwnerTable.NextBlock instanceof ParagraphAdv ? row.OwnerTable.NextBlock : row.OwnerTable.NextBlock._GetFirstParagraphInFirstCell();
                    else if (row.OwnerTable.PreviousBlock != null)
                        paragraph = row.OwnerTable.PreviousBlock instanceof ParagraphAdv ? row.OwnerTable.PreviousBlock : row.OwnerTable.NextBlock._GetLastParagraphInLastCell();
                }
                if (!this.IsEmpty) {
                    var containerCell = this.Start.Paragraph.AssociatedCell._GetContainerCellOf(this.End.Paragraph.AssociatedCell);
                    if (containerCell.OwnerTable._Contains(this.End.Paragraph.AssociatedCell)) {
                        var startCell = this.Start.Paragraph.AssociatedCell._GetSelectedCell(containerCell);
                        var endCell = this.End.Paragraph.AssociatedCell._GetSelectedCell(containerCell);
                        if (containerCell._Contains(this.End.Paragraph.AssociatedCell)) {
                            row = startCell.OwnerRow;
                            if (row.OwnerTable.Rows.Count == 1) {
                                row.OwnerTable._RemoveBlock();
                            }
                            else
                                row.OwnerTable.Rows._Remove(row);
                        }
                        else {
                            row = startCell.OwnerRow;
                            var endRow = endCell.OwnerRow;
                            var table = row.OwnerTable;
                            paragraph = null;
                            if (endRow.NextNode != null) {
                                var nextCell = endRow.NextNode.Cells[0];
                                paragraph = nextCell._GetFirstParagraph();
                            }
                            if (paragraph == null) {
                                if (endRow.OwnerTable.NextBlock != null)
                                    paragraph = endRow.OwnerTable.NextBlock instanceof ParagraphAdv ? endRow.OwnerTable.NextBlock : endRow.OwnerTable.NextBlock._GetFirstParagraphInFirstCell();
                                else if (endRow.OwnerTable.PreviousBlock != null)
                                    paragraph = endRow.OwnerTable.PreviousBlock instanceof ParagraphAdv ? endRow.OwnerTable.PreviousBlock : endRow.OwnerTable.NextBlock._GetLastParagraphInLastCell();
                            }
                            for (var i = 0; i < table.Rows.Count; i++) {
                                if (table.Rows[i].RowIndex >= row.RowIndex && table.Rows[i].RowIndex <= endRow.RowIndex) {
                                    table.Rows._RemoveAt(i);
                                    i--;
                                }
                            }
                            if (table.Rows.Count == 0) {
                                table._RemoveBlock();
                            }
                        }
                    }
                }
                else {
                    if (row.OwnerTable.Rows.Count == 1) {
                        row.OwnerTable._RemoveBlock();
                    }
                    else
                        row.OwnerTable.Rows._Remove(row);
                }
                this._SelectParagraph(paragraph, true, true);
                if (!this.OwnerControl.History.IsRedoing)
                    this._Relayout(true);
            }
        };
        SelectionAdv.prototype._DeleteColumn = function () {
            if (this.Start.Paragraph.IsInsideTable) {
                if (!this.OwnerControl.History.IsRedoing)
                    this._InitHistory(Actions.DeleteColumn);
                this.OwnerControl.IsShiftingEnabled = true;
                var cell = this.Start.Paragraph.AssociatedCell;
                var endCell = this.End.Paragraph.AssociatedCell;
                var table = cell.OwnerTable;
                var clonedTable = table._CloneTableToHistoryInfo(this.CurrentBaseHistoryInfo);
                this.OwnerControl.IsLayoutEnabled = false;
                var paragraph = null;
                if (endCell.NextNode != null) {
                    var nextCell = endCell.NextNode;
                    paragraph = nextCell._GetFirstParagraph();
                }
                else if (cell.PreviousNode != null) {
                    var previousCell = cell.PreviousNode;
                    paragraph = previousCell._GetFirstParagraph();
                }
                if (paragraph == null) {
                    if (table.NextBlock != null)
                        paragraph = table.NextBlock instanceof ParagraphAdv ? table.NextBlock : table.NextBlock._GetFirstParagraphInFirstCell();
                    else if (table.PreviousBlock != null)
                        paragraph = table.PreviousBlock instanceof ParagraphAdv ? table.PreviousBlock : table.NextBlock._GetLastParagraphInLastCell();
                }
                var deleteCells = table._GetColumnCellsForSelection(cell, endCell);
                for (var i = 0; i < table.Rows.Count; i++) {
                    var row = table.Rows[i];
                    if (row.Cells.Count == 1) {
                        if (deleteCells._Contains(row.Cells[0])) {
                            table.Rows._Remove(row);
                            i--;
                        }
                    }
                    else {
                        for (var j = 0; j < row.Cells.Count; j++) {
                            if (deleteCells._Contains(row.Cells[j])) {
                                row.Cells._RemoveAt(j);
                                j--;
                            }
                        }
                    }
                }
                this.OwnerControl.IsLayoutEnabled = true;
                if (table.Rows.Count == 0) {
                    table._RemoveBlock();
                    this.CurrentBaseHistoryInfo.Action = Actions.Delete;
                }
                else
                    table._Layout();
                this._SelectParagraph(paragraph, true, true);
                if (!this.OwnerControl.History.IsRedoing)
                    this._Relayout(true);
            }
        };
        SelectionAdv.prototype._RemoveSelectedContent = function () {
            return this._RemoveSelectedContentInternal(this.Start, this.End);
        };
        SelectionAdv.prototype._RemoveSelectedContentInternal = function (starposition, endposition) {
            var startPosition = starposition;
            var endPosition = endposition;
            if (!starposition._IsExistBefore(endposition)) {
                startPosition = endposition;
                endPosition = starposition;
            }
            if (startPosition.Paragraph == endPosition.Paragraph && startPosition.Offset == startPosition.Paragraph._GetLength()
                && startPosition.Offset + 1 == endPosition.Offset) {
                this.OwnerControl.IsShiftingEnabled = true;
                this._SelectContent(startPosition, true);
                return true;
            }
            this.EditPosition = startPosition._GetHierarchicalIndexInternal();
            var isRemoved = startPosition.Paragraph._RemoveSelectedContent(this, startPosition, endPosition);
            var textPosition = new TextPosition(this.OwnerControl);
            textPosition._SetPositionForCurrentIndex(this.EditPosition);
            this._SelectContent(textPosition, false);
            return isRemoved;
        };
        SelectionAdv.prototype._Relayout = function (isSelectionChanged) {
            if (this._IsHandledComplexHistory())
                return;
            if (this._IsInComment())
                this.Start.Paragraph._GetOwnerComment()._Relayout();
            if (this.OwnerControl.IsShiftingEnabled) {
                this.OwnerControl.IsShiftingEnabled = false;
                this.OwnerControl.Viewer._ShiftLayoutedItems();
                this.Start._UpdatePhysicalPosition();
                if (isSelectionChanged)
                    this.End._SetPositionInternal(this.Start);
                else
                    this.End._UpdatePhysicalPosition();
                this.UpDownSelectionLength = this.End.Location.X;
                this._FireSelectionChanged(isSelectionChanged);
                this._UpdateFocus();
            }
            this._UpdateHistory();
            this._FireContentChanged();
        };
        SelectionAdv.prototype._CopySectionFormat = function (sectionAdv) {
        };
        SelectionAdv.prototype._CopySelectionParagraphFormat = function () {
            var format = new ParagraphFormat(null);
            if (this.ParagraphFormat.AfterSpacing != null)
                format.AfterSpacing = this.ParagraphFormat.AfterSpacing;
            if (this.ParagraphFormat.BeforeSpacing != null)
                format.BeforeSpacing = this.ParagraphFormat.BeforeSpacing;
            if (this.ParagraphFormat.FirstLineIndent != null)
                format.FirstLineIndent = this.ParagraphFormat.FirstLineIndent;
            if (this.ParagraphFormat.LeftIndent != null)
                format.LeftIndent = this.ParagraphFormat.LeftIndent;
            if (this.ParagraphFormat.RightIndent != null)
                format.RightIndent = this.ParagraphFormat.RightIndent;
            if (this.ParagraphFormat.TextAlignment != null)
                format.TextAlignment = this.ParagraphFormat.TextAlignment;
            if (this.ParagraphFormat.LineSpacing != null)
                format.LineSpacing = this.ParagraphFormat.LineSpacing;
            if (this.ParagraphFormat.LineSpacingType != null)
                format.LineSpacingType = this.ParagraphFormat.LineSpacingType;
            return format;
        };
        SelectionAdv.prototype._CopySelectionCharacterFormat = function () {
            var format = new CharacterFormat(null);
            if (this.CharacterFormat.BaselineAlignment != null)
                format.BaselineAlignment = this.CharacterFormat.BaselineAlignment;
            if (this.CharacterFormat.Bold != null)
                format.Bold = this.CharacterFormat.Bold;
            if (this.CharacterFormat.FontColor != null)
                format.FontColor = this.CharacterFormat.FontColor;
            if (this.CharacterFormat.FontFamily != null)
                format.FontFamily = this.CharacterFormat.FontFamily;
            if (this.CharacterFormat.FontSize != 0)
                format.FontSize = this.CharacterFormat.FontSize;
            if (this.CharacterFormat.HighlightColor != null)
                format.HighlightColor = this.CharacterFormat.HighlightColor;
            if (this.CharacterFormat.Italic != null)
                format.Italic = this.CharacterFormat.Italic;
            if (this.CharacterFormat.StrikeThrough != null)
                format.StrikeThrough = this.CharacterFormat.StrikeThrough;
            if (this.CharacterFormat.Underline != null)
                format.Underline = this.CharacterFormat.Underline;
            return format;
        };
        SelectionAdv.prototype._CopyInlineCharacterFormat = function (format, inlineFormat) {
            if (!format._HasValue(CharacterFormat.BaselineAlignmentProperty))
                format.BaselineAlignment = inlineFormat.BaselineAlignment;
            if (!format._HasValue(CharacterFormat.BoldProperty))
                format.Bold = inlineFormat.Bold;
            if (!format._HasValue(CharacterFormat.FontColorProperty))
                format.FontColor = inlineFormat.FontColor;
            if (!format._HasValue(CharacterFormat.FontFamilyProperty))
                format.FontFamily = inlineFormat.FontFamily;
            if (!format._HasValue(CharacterFormat.FontSizeProperty))
                format.FontSize = inlineFormat.FontSize;
            if (!format._HasValue(CharacterFormat.HighlightColorProperty))
                format.HighlightColor = inlineFormat.HighlightColor;
            if (!format._HasValue(CharacterFormat.ItalicProperty))
                format.Italic = inlineFormat.Italic;
            if (!format._HasValue(CharacterFormat.StrikeThroughProperty))
                format.StrikeThrough = inlineFormat.StrikeThrough;
            if (!format._HasValue(CharacterFormat.UnderlineProperty))
                format.Underline = inlineFormat.Underline;
        };
        SelectionAdv.prototype._RetrieveCurrentFormatProperties = function () {
            this.IsRetrieveFormatting = true;
            var startPosition = this.Start;
            var endPosition = this.End;
            if (!this.IsForward) {
                startPosition = this.End;
                endPosition = this.Start;
            }
            this._RetrieveCharacterFormat(startPosition, endPosition);
            this._RetrieveParagraphFormat(startPosition, endPosition);
            this._RetrieveSectionFormat(startPosition, endPosition);
            this._RetrieveTableFormat(startPosition, endPosition);
            if (this.OwnerControl.Selection.SelectionRanges.Count > 1 && !this.IsEmpty) {
                for (var i = 0; i < this.OwnerControl.Selection.SelectionRanges.Count; i++) {
                    var selectionRange = this.OwnerControl.Selection.SelectionRanges._Get(i);
                    var currentformat = selectionRange.Start.Paragraph._GetCharacterFormatofTextPostion(selectionRange.Start);
                    if (currentformat != null) {
                        this.CharacterFormat._CombineFormat(currentformat);
                        this.ParagraphFormat._CombineFormat(selectionRange.Start.Paragraph.ParagraphFormat);
                        if (this.Start.Paragraph.Section != null)
                            this.SectionFormat._CombineFormat(selectionRange.Start.Paragraph.Section.SectionFormat);
                    }
                }
            }
            this.IsRetrieveFormatting = false;
            this.EditingContext.Type = this.tableFormat == null || this.tableFormat.Table == null ? EditingContextType.Text : EditingContextType.Table;
        };
        SelectionAdv.prototype._InsertParagraph = function (paragraph, insertAfter) {
            if (this.CurrentBaseHistoryInfo.InsertPosition == null)
                this.CurrentBaseHistoryInfo.InsertPosition = this.Start._GetHierarchicalIndexInternal();
            this.Start.Paragraph._InsertParagraph(paragraph, this.Start.Offset, insertAfter);
            if (!insertAfter) {
                var nextParagraph = paragraph._GetNextParagraph();
                if (nextParagraph != null)
                    this._SelectParagraph(nextParagraph, true, false);
                else
                    this._SelectParagraph(paragraph, true, false);
            }
            this._FireContentChanged();
        };
        SelectionAdv.prototype._InitHistory = function (action) {
            this._InitializeHistory(action, this.CurrentSelectionRange);
        };
        SelectionAdv.prototype._InitializeHistory = function (action, selectionRange) {
            this.CurrentBaseHistoryInfo = new BaseHistoryInfo(this.OwnerControl);
            this.CurrentBaseHistoryInfo.Action = action;
            this.CurrentBaseHistoryInfo._UpdateSelectionRange(selectionRange);
        };
        SelectionAdv.prototype._InitComplexHistory = function (action) {
            this.CurrentHistoryInfo = new HistoryInfo(this.OwnerControl, this.CurrentHistoryInfo != null);
            this.CurrentHistoryInfo.Action = action;
            this.CurrentHistoryInfo._UpdateSelection(this);
        };
        SelectionAdv.prototype._FitImageToPage = function (image) {
            if (this.Start.Paragraph._IsInComment()) {
                var pageWidth = this.ownerControl.Viewer.ClientArea.Width;
                var pageHeight = 120;
                if (image.Width > pageWidth) {
                    image.Height = image.Height * pageWidth / image.Width;
                    image.Width = pageWidth;
                }
                if (image.Height > pageHeight) {
                    image.Width = image.Width * pageHeight / image.Height;
                    image.Height = pageHeight;
                }
            }
            else {
                var section = this.Start.Paragraph.Section;
                var pageWidth = section.SectionFormat.PageWidth - section.SectionFormat.LeftMargin - section.SectionFormat.RightMargin;
                var pageHeight = section.SectionFormat.PageHeight - section.SectionFormat.TopMargin - section.SectionFormat.TopMargin;
                if (image.Width > pageWidth) {
                    image.Height = image.Height * pageWidth / image.Width;
                    image.Width = pageWidth;
                }
                if (image.Height > pageHeight) {
                    image.Width = image.Width * pageHeight / image.Height;
                    image.Height = pageHeight;
                }
            }
        };
        SelectionAdv.prototype._SelectTextRanges = function () {
            this._InitComplexHistory(Actions.MultiSelection);
            var selectionRange = null;
            for (var i = 0; i < this.OwnerControl.Selection.SelectionRanges.Count - 1; i++) {
                selectionRange = this.OwnerControl.Selection.SelectionRanges._Get(i);
                this._InitializeHistory(Actions.Selection, selectionRange);
                if (this.CurrentBaseHistoryInfo.InsertPosition == null)
                    this.CurrentBaseHistoryInfo.InsertPosition = selectionRange.Start._GetHierarchicalIndexInternal();
                if (this.CurrentBaseHistoryInfo.EndPosition == null)
                    this.CurrentBaseHistoryInfo.EndPosition = selectionRange.End._GetHierarchicalIndexInternal();
                this.CurrentHistoryInfo._AddModifiedAction(this.CurrentBaseHistoryInfo);
            }
        };
        SelectionAdv.prototype._IsHandledComplexHistory = function () {
            var isHandledComplexHistory = false;
            if (this.removedCommentCharacters != null) {
                for (var i = 0; i < this.removedCommentCharacters.Count; i++) {
                    var commentCharacter = this.removedCommentCharacters[i];
                    if (commentCharacter instanceof CommentAdv) {
                        var comment = commentCharacter;
                        if (comment.CommentStart != null && comment.CommentEnd != null) {
                            var isCommentStartRemoved = this.removedCommentCharacters._Contains(comment.CommentStart);
                            var isCommentEndRemoved = this.removedCommentCharacters._Contains(comment.CommentEnd);
                            if (isCommentStartRemoved || isCommentEndRemoved) {
                                this.removedCommentCharacters._Remove(comment.CommentStart);
                                this.removedCommentCharacters._Remove(comment.CommentEnd);
                                this.removedCommentCharacters._Remove(comment);
                            }
                            else {
                                this._InitComplexHistory(this.CurrentBaseHistoryInfo.Action);
                                this._UpdateHistory();
                                if (!isCommentStartRemoved)
                                    this._RemoveInline(comment.CommentStart);
                                if (!isCommentEndRemoved)
                                    this._RemoveInline(comment.CommentEnd);
                                this._UpdateComplexHistory();
                                isHandledComplexHistory = true;
                            }
                        }
                    }
                    else if (commentCharacter instanceof CommentStartAdv) {
                        var commentStart = commentCharacter;
                        if (commentStart.Comment != null && commentStart.Comment.CommentEnd != null && this.removedCommentCharacters._Contains(commentStart.Comment.CommentEnd)) {
                            this.removedCommentCharacters._Remove(commentStart.Comment.CommentEnd);
                            this.removedCommentCharacters._Remove(commentStart);
                            if (this.removedCommentCharacters._Contains(commentStart.Comment))
                                this.removedCommentCharacters._Remove(commentStart.Comment);
                        }
                        else {
                            this._InitComplexHistory(this.CurrentBaseHistoryInfo.Action);
                            this._UpdateHistory();
                            this._InitInsertInline(commentStart._Clone());
                            this._UpdateComplexHistory();
                            isHandledComplexHistory = true;
                        }
                    }
                    else {
                        var commentEnd = commentCharacter;
                        if (commentEnd.Comment != null && commentEnd.Comment.CommentStart != null && this.removedCommentCharacters._Contains(commentEnd.Comment.CommentStart)) {
                            this.removedCommentCharacters._Remove(commentEnd.Comment.CommentStart);
                            this.removedCommentCharacters._Remove(commentEnd);
                            if (this.removedCommentCharacters._Contains(commentEnd.Comment))
                                this.removedCommentCharacters._Remove(commentEnd.Comment);
                        }
                        else {
                            this._InitComplexHistory(this.CurrentBaseHistoryInfo.Action);
                            this._UpdateHistory();
                            this._InitInsertInline(commentEnd._Clone());
                            this._UpdateComplexHistory();
                            isHandledComplexHistory = true;
                        }
                    }
                }
                this.removedCommentCharacters._Clear();
                this.removedCommentCharacters = null;
            }
            else if (this.CurrentHistoryInfo != null) {
                this._UpdateHistory();
                isHandledComplexHistory = true;
            }
            return isHandledComplexHistory;
        };
        SelectionAdv.prototype._UpdateHistory = function () {
            if (this.CurrentBaseHistoryInfo != null) {
                if (this.CurrentBaseHistoryInfo.EndPosition == null)
                    this.CurrentBaseHistoryInfo.EndPosition = this.CurrentBaseHistoryInfo.InsertPosition;
                if (this.CurrentHistoryInfo != null)
                    this.CurrentHistoryInfo._AddModifiedAction(this.CurrentBaseHistoryInfo);
                else
                    this.OwnerControl.History._RecordChanges(this.CurrentBaseHistoryInfo);
                this.CurrentBaseHistoryInfo = null;
            }
        };
        SelectionAdv.prototype._UpdateComplexHistory = function () {
            if (this.CurrentHistoryInfo.HasAction) {
                if (this.CurrentHistoryInfo.Action == Actions.AutoFormatHyperlink) {
                    var startPosition = new TextPosition(this.ownerControl);
                    startPosition._SetPositionForCurrentIndex(this.CurrentHistoryInfo.InsertPosition);
                    startPosition.Paragraph._RelayoutParagraph(0);
                    if (this.ownerControl.History.IsUndoing) {
                        this.Start._SetPositionForCurrentIndex(this.CurrentHistoryInfo.SelectionStart);
                        this.End._SetPositionForCurrentIndex(this.CurrentHistoryInfo.SelectionEnd);
                    }
                    else {
                        this.Start._SetPositionForCurrentIndex(this.CurrentHistoryInfo.EndPosition);
                        this.End._SetPositionForCurrentIndex(this.CurrentHistoryInfo.EndPosition);
                    }
                }
                if (this.CurrentHistoryInfo.Action == Actions.InsertHyperlink) {
                    var startPosition = new TextPosition(this.ownerControl);
                    startPosition._SetPositionForCurrentIndex(this.CurrentHistoryInfo.InsertPosition);
                    var endPosition = new TextPosition(this.ownerControl);
                    endPosition._SetPositionForCurrentIndex(this.CurrentHistoryInfo.EndPosition);
                    startPosition.Paragraph._RelayoutParagraph(0);
                    if (endPosition.Paragraph != startPosition.Paragraph)
                        endPosition.Paragraph._RelayoutParagraph(0);
                }
                if (this.CurrentHistoryInfo.Action == Actions.ReplaceAll || this.CurrentHistoryInfo.Action == Actions.DeleteAllComments) {
                    this.OwnerControl.IsLayoutEnabled = true;
                    this.OwnerControl.Document._LayoutItems(this.OwnerControl.Viewer);
                }
                else if (this.OwnerControl.IsShiftingEnabled)
                    this.OwnerControl.Viewer._ShiftLayoutedItems();
            }
            this.ownerControl.IsShiftingEnabled = false;
            this._AddMutipleSelectionRanges();
            this.Start._UpdatePhysicalPosition();
            if (this.IsEmpty)
                this.End._SetPositionInternal(this.Start);
            else
                this.End._UpdatePhysicalPosition();
            this.UpDownSelectionLength = this.End.Location.X;
            this._FireSelectionChanged(true);
            this._UpdateFocus();
            this._FireContentChanged();
            if (this.CurrentHistoryInfo != null) {
                if (this.CurrentHistoryInfo.EndPosition == null)
                    this.CurrentHistoryInfo.EndPosition = this.CurrentHistoryInfo.InsertPosition;
                this.OwnerControl.History._RecordChanges(this.CurrentHistoryInfo);
                this.CurrentHistoryInfo = null;
            }
        };
        SelectionAdv.prototype._AddMutipleSelectionRanges = function () {
            var isClearedSelectionCollection = { isCleared: false };
            if (this.OwnerControl.History.IsUndoing || this.OwnerControl.History.IsRedoing) {
                if (this.CurrentHistoryInfo.Action == Actions.MultiSelection) {
                    for (var i = 0; i < this.CurrentHistoryInfo.ModifiedActions.Count; i++) {
                        var basehistoryinfo = this.CurrentHistoryInfo.ModifiedActions[i];
                        if (this.OwnerControl.History.IsUndoing || (this.OwnerControl.History.IsRedoing && basehistoryinfo.ModifiedProperties.Count > 0)) {
                            this._AddSelectionRange(basehistoryinfo, isClearedSelectionCollection);
                            if (this.OwnerControl.History.IsUndoing && (basehistoryinfo.Action == Actions.Cut || basehistoryinfo.Action == Actions.Delete))
                                this._UpdateSelectionRangeOffSetInternal(i);
                        }
                    }
                }
                else if (this.CurrentHistoryInfo.Action == Actions.Paste) {
                    for (var i = this.CurrentHistoryInfo.ModifiedActions.Count - 1; i >= 0; i--) {
                        var basehistoryinfo = this.CurrentHistoryInfo.ModifiedActions[i];
                        if (this.OwnerControl.History.IsUndoing)
                            this._AddSelectionRange(basehistoryinfo, isClearedSelectionCollection);
                    }
                }
            }
        };
        SelectionAdv.prototype._AddSelectionRange = function (basehistoryinfo, isClearedSelectionCollection) {
            if (!isClearedSelectionCollection.isCleared) {
                this.SelectionRanges._Clear();
                isClearedSelectionCollection.isCleared = true;
            }
            if (basehistoryinfo instanceof HistoryInfo && basehistoryinfo.Action == Actions.InsertComment) {
                this.SelectionRanges._AddSelection(this.CurrentHistoryInfo._GetTextPosition(this.CurrentHistoryInfo.SelectionStart), this.CurrentHistoryInfo._GetTextPosition(this.CurrentHistoryInfo.SelectionEnd));
            }
            else {
                this.SelectionRanges._AddSelection(basehistoryinfo._GetTextPosition(basehistoryinfo.InsertPosition), basehistoryinfo._GetTextPosition(basehistoryinfo.EndPosition));
            }
        };
        SelectionAdv.prototype._OnEnter = function () {
            this.SkipFormatRetrieval = true;
            if (this.Start == null)
                return;
            if (this.IsEmpty) {
                var hyperlinkField = this._GetHyperlinkField();
                var isSelectionOnHyperlink = hyperlinkField != null;
                if (isSelectionOnHyperlink) {
                    this.OwnerControl._FireRequestNavigate(hyperlinkField);
                    this.SkipFormatRetrieval = false;
                    return;
                }
                var paragraph = this.Start.Paragraph;
                if (paragraph._IsEmpty() && paragraph.ParagraphFormat.ListFormat.List != null) {
                    this._OnApplyList(paragraph.ParagraphFormat.ListFormat.List, paragraph.ParagraphFormat.ListFormat.ListLevelNumber - 1);
                    return;
                }
            }
            this._InitHistory(Actions.Enter);
            var isRemoved = true;
            if (!this.IsEmpty) {
                this._SelectTextRanges();
                this._InitHistory(Actions.Enter);
                this.CurrentHistoryInfo._AddModifiedAction(this.CurrentBaseHistoryInfo);
                isRemoved = this._RemoveSelectedContent();
            }
            else
                this._InitHistory(Actions.Enter);
            if (isRemoved) {
                this.OwnerControl.IsShiftingEnabled = true;
                if (this.CurrentBaseHistoryInfo.InsertPosition == null)
                    this.CurrentBaseHistoryInfo.InsertPosition = this.Start._GetHierarchicalIndexInternal();
                this.Start.Paragraph._SplitParagraphInternal(this.Start.Offset);
                this.Start._SetPositionForCurrentIndex(this.CurrentBaseHistoryInfo.InsertPosition);
                this._SelectParagraph(this.Start.Paragraph.NextBlock, true, false);
                if (this.CurrentBaseHistoryInfo.EndPosition == null)
                    this.CurrentBaseHistoryInfo.EndPosition = this.Start._GetHierarchicalIndexInternal();
                if (this.CurrentHistoryInfo != null)
                    this._UpdateComplexHistory();
                else
                    this._Relayout(true);
                var paragraph = this.Start.Paragraph.PreviousNode;
                if (paragraph != null && !paragraph._IsEmpty() && paragraph.Inlines[paragraph.Inlines.Count - 1] instanceof SpanAdv) {
                    var span = paragraph.Inlines._Last();
                    var text = span.Text;
                    var index = 0;
                    var lastTabChar = text.lastIndexOf('\t');
                    index = (lastTabChar >= 0) ? lastTabChar + 1 : text.lastIndexOf(' ') + 1;
                    while (span.PreviousNode instanceof SpanAdv && index == 0) {
                        span = span.PreviousNode;
                        var previousText = span.Text;
                        lastTabChar = previousText.lastIndexOf('\t');
                        index = (lastTabChar >= 0) ? lastTabChar + 1 : previousText.lastIndexOf(' ') + 1;
                        text = span.Text + text;
                    }
                    text = text.substring(index);
                    var textToLC = text.toLowerCase();
                    var containsURL = false;
                    if (textToLC.substring(0, 8) == "file:///"
                        || (textToLC.substring(0, 7) == "http://" && textToLC.length > 7)
                        || (textToLC.substring(0, 8) == "https://" && textToLC.length > 8)
                        || (textToLC.substring(0, 4) == "www." && textToLC.length > 4)
                        || (textToLC.substring(0, 3) == "\\" && textToLC.length > 3)
                        || (textToLC.substring(0, 7) == "mailto:" && textToLC.length > 7)) {
                        containsURL = true;
                        if (textToLC.substring(0, 4) == "www." && textToLC.length > 4)
                            text = "http://" + text;
                    }
                    else {
                        var indexOfAt = text.indexOf('@');
                        var indexOfDot = text.indexOf('.');
                        if (indexOfAt > 0 && indexOfAt < indexOfDot && indexOfDot < text.length - 1) {
                            containsURL = true;
                            text = "mailto:" + text;
                        }
                    }
                    if (containsURL) {
                        var startPosition = new TextPosition(this.OwnerControl);
                        startPosition._SetPositionParagraph(span.OwnerParagraph, span.OwnerParagraph._GetOffset(span, index));
                        var endPosition = new TextPosition(this.OwnerControl);
                        endPosition._SetPositionParagraph(paragraph, paragraph._GetEndOffset());
                        this._AutoFormatHyperlink(text, startPosition, endPosition);
                    }
                }
            }
            this.SkipFormatRetrieval = false;
        };
        SelectionAdv.prototype._OnBackspace = function () {
            if (this.Start == null)
                return;
            if (this.IsEmpty)
                this._SingleBackspace(false);
            else {
                if (this.OwnerControl.Selection.SelectionRanges.Count > 0) {
                    this._SelectTextRanges();
                    this._InitHistory(Actions.BackSpace);
                    this.CurrentHistoryInfo._AddModifiedAction(this.CurrentBaseHistoryInfo);
                }
                var skipBackSpace = this._DeleteSelectedContents(true);
                if (skipBackSpace)
                    this.CurrentBaseHistoryInfo = null;
                else {
                    if (this.CurrentHistoryInfo != null) {
                        if (this.CurrentBaseHistoryInfo.EndPosition == null)
                            this.CurrentBaseHistoryInfo.EndPosition = this.End._GetHierarchicalIndexInternal();
                        this._UpdateComplexHistory();
                    }
                    else
                        this._Relayout(true);
                }
            }
        };
        SelectionAdv.prototype._SingleBackspace = function (isRedoing) {
            if (!isRedoing && this.SelectionRanges.Count == 1 && !this.OwnerControl.History.CanRedo && this.OwnerControl.History.CanUndo) {
                var historyInfo = this.OwnerControl.History.UndoStack[this.OwnerControl.History.UndoStack.length - 1];
                if (historyInfo.Action == Actions.AutoFormatHyperlink && historyInfo.EndPosition == this.Start._GetHierarchicalIndexInternal()
                    && historyInfo.EndPosition == this.End._GetHierarchicalIndexInternal()) {
                    this.ownerControl.History._Undo();
                    return;
                }
            }
            this._ValidateSelectionBasedOnCommentCharacter(true);
            var paragraph = this.Start.Paragraph;
            var offset = this.Start.Offset;
            var indexInInline = 0;
            var inlineObj = paragraph._GetInline(offset, indexInInline);
            var inline = inlineObj.inline;
            indexInInline = inlineObj.index;
            var previousInline = inline;
            if (inline != null && indexInInline == 0 && inline.PreviousNode != null) {
                previousInline = inline.PreviousNode;
                indexInInline = inline.Length;
            }
            if (previousInline instanceof CommentAdv) {
                this._DeleteComment(previousInline);
                return;
            }
            if (inline instanceof FieldEndAdv) {
                var prevInline = inline._GetPreviousValidInline();
                if (prevInline instanceof FieldEndAdv) {
                    inline = prevInline.FieldBegin;
                    paragraph = inline.OwnerParagraph;
                    offset = paragraph._GetOffset(inline, 0);
                    this.End._SetPositionParagraph(paragraph, offset);
                    this._FireSelectionChanged(true);
                    return;
                }
                else if (prevInline != inline) {
                    inline = prevInline;
                    paragraph = inline.OwnerParagraph;
                    offset = paragraph._GetOffset(inline, inline.Length);
                }
            }
            if (!isRedoing)
                this._InitHistory(Actions.BackSpace);
            if (offset == paragraph._GetStartOffset()) {
                if (paragraph.ParagraphFormat.ListFormat.List != null) {
                    this._OnApplyList(null, 0);
                    return;
                }
                if (paragraph.ParagraphFormat.FirstLineIndent != 0) {
                    this._OnFirstLineIndent(0);
                    return;
                }
                if (paragraph.ParagraphFormat.LeftIndent != 0) {
                    this._OnLeftIndent(0);
                    return;
                }
                if (paragraph.ParagraphFormat.TextAlignment != 1) {
                    this._OnTextAlignment(1);
                    return;
                }
                if (paragraph.PreviousBlock instanceof ParagraphAdv) {
                    this.OwnerControl.IsShiftingEnabled = true;
                    var previousParagraph = paragraph.PreviousBlock;
                    if (previousParagraph._IsEmpty()) {
                        previousParagraph._RemoveBlock();
                        this.CurrentBaseHistoryInfo.RemovedNodes._Add(previousParagraph);
                    }
                    else {
                        var endOffset = previousParagraph._GetEndOffset();
                        for (var i = 0; i < paragraph.Inlines.Count; i++) {
                            inline = paragraph.Inlines[i];
                            i--;
                            previousParagraph.Inlines._Add(inline);
                        }
                        paragraph._RemoveBlock();
                        this._Selects(previousParagraph, endOffset, true);
                        this.CurrentBaseHistoryInfo.RemovedNodes._Add(paragraph);
                    }
                    this.CurrentBaseHistoryInfo.InsertPosition = this.Start._GetHierarchicalIndexInternal();
                    this.CurrentBaseHistoryInfo.EndPosition = this.CurrentBaseHistoryInfo.InsertPosition;
                    if (!isRedoing)
                        this._Relayout(true);
                }
                else
                    this.currentBaseHistoryInfo = null;
            }
            else {
                if (!isRedoing)
                    this.OwnerControl.IsShiftingEnabled = true;
                paragraph._RemoveAtOffset(this.CurrentBaseHistoryInfo, offset - 1);
                this._Selects(this.Start.Paragraph, offset - 1, true);
                this.CurrentBaseHistoryInfo.InsertPosition = this.Start._GetHierarchicalIndexInternal();
                this.CurrentBaseHistoryInfo.EndPosition = this.CurrentBaseHistoryInfo.InsertPosition;
                if (!isRedoing)
                    this._Relayout(true);
                else
                    this._FireContentChanged();
            }
        };
        SelectionAdv.prototype._ValidateSelectionBasedOnCommentCharacter = function (isBackSpace) {
            var offset = this.Start.Offset;
            var indexInInline = 0;
            var inlineobj = this.Start.Paragraph._GetInline(this.Start.Offset, indexInInline);
            var inline = inlineobj.inline;
            indexInInline = inlineobj.index;
            if (inline == null)
                return;
            if (isBackSpace) {
                if (offset == 0)
                    return;
                if (indexInInline == 0 && inline.PreviousNode != null) {
                    inline = inline.PreviousNode;
                    indexInInline = inline.Length;
                }
                if (indexInInline > 0 && !(inline instanceof CommentCharacterAdv))
                    return;
                while (inline != null && inline instanceof CommentStartAdv || inline instanceof CommentEndAdv) {
                    offset -= inline.Length;
                    inline = inline.PreviousNode;
                }
            }
            else {
                if (indexInInline == inline.Length && inline.NextNode != null) {
                    inline = inline.NextNode;
                    indexInInline = 0;
                }
                if (indexInInline < inline.Length && !(inline instanceof CommentCharacterAdv))
                    return;
                while (inline != null && inline instanceof CommentStartAdv || inline instanceof CommentEndAdv) {
                    offset += inline.Length;
                    inline = inline.NextNode;
                }
            }
            this.Start._SetPositionParagraph(this.Start.Paragraph, offset);
            this.End._SetPositionInternal(this.Start);
        };
        SelectionAdv.prototype._InsertComment = function () {
            if (this.Start == null)
                return;
            if (this.IsEmpty)
                this._SelectCurrentWord(true);
            var format = this._GetCharacterFormat();
            this._InsertCommentInternal(format);
        };
        SelectionAdv.prototype._InsertCommentInternal = function (format) {
            var historyInfo = null;
            if (this.OwnerControl.Selection.SelectionRanges.Count > 0) {
                this._SelectTextRanges();
                historyInfo = this.CurrentHistoryInfo;
            }
            this._InitComplexHistory(Actions.InsertComment);
            var startPosition = this.Start;
            var endPosition = this.End;
            var position = new TextPosition(this.ownerControl);
            if (!this.IsForward) {
                startPosition = this.End;
                endPosition = this.Start;
            }
            position._SetPositionInternal(endPosition);
            var commentAdv = new CommentAdv(null, new Date());
            var paragraph = new ParagraphAdv(commentAdv);
            commentAdv.Blocks._Add(paragraph);
            var commentRangeStart = new CommentStartAdv(null);
            commentRangeStart.Comment = commentAdv;
            var commentRangeEnd = new CommentEndAdv(null);
            commentRangeEnd.Comment = commentAdv;
            commentAdv.CommentStart = commentRangeStart;
            commentAdv.CommentEnd = commentRangeEnd;
            var isAtSameParagraph = startPosition._IsInSameParagraph(endPosition);
            endPosition._SetPositionInternal(startPosition);
            this._InitInsertInline(commentRangeStart);
            if (isAtSameParagraph)
                position._SetPositionParagraph(position.Paragraph, position.Offset + commentRangeStart.Length);
            startPosition._SetPositionInternal(position);
            endPosition._SetPositionInternal(position);
            this._InitInsertInline(commentRangeEnd);
            this._InitInsertInline(commentAdv);
            this.Start._SetPositionParagraph(paragraph, paragraph._GetStartOffset());
            this._SelectContent(this.Start, true);
            if (historyInfo != null) {
                historyInfo._AddModifiedAction(this.CurrentHistoryInfo);
                this.CurrentHistoryInfo = historyInfo;
            }
            this.OwnerControl.Viewer._UpdateCaretPosition();
            this._UpdateComplexHistory();
        };
        SelectionAdv.prototype._DeleteAllComments = function () {
            if (this.ownerControl == null || this.ownerControl.IsReadOnlyMode
                || this.ownerControl.Document == null || this.ownerControl.Document.Comments.Count == 0)
                return;
            if (this.ownerControl.Viewer != null)
                this.ownerControl.Viewer._ClearSearchHighlight();
            this._InitComplexHistory(Actions.DeleteAllComments);
            var historyInfo = this.CurrentHistoryInfo;
            this.OwnerControl.IsLayoutEnabled = false;
            while (this.OwnerControl.Document.Comments.Count > 0) {
                var comment = this.ownerControl.Document.Comments[0];
                this._InitComplexHistory(Actions.DeleteComment);
                this._DeleteCommentInternal(comment);
                historyInfo._AddModifiedAction(this.CurrentHistoryInfo);
            }
            this._SelectContent(this.OwnerControl.Document.DocumentStart, true);
            this.CurrentHistoryInfo = historyInfo;
            this._UpdateComplexHistory();
        };
        SelectionAdv.prototype._DeleteComment = function (comment) {
            this.OwnerControl.Viewer._RemoveCommentRangeWidget();
            this._InitComplexHistory(Actions.DeleteComment);
            this._DeleteCommentInternal(comment);
            this._UpdateComplexHistory();
        };
        SelectionAdv.prototype._DeleteCommentInternal = function (comment) {
            if (comment != null) {
                var commentStart = comment.CommentStart;
                var commentEnd = comment.CommentEnd;
                this._RemoveInline(comment);
                this._RemoveInline(commentEnd);
                this._RemoveInline(commentStart);
            }
        };
        SelectionAdv.prototype._NavigatePreviousComment = function () {
            if (this._IsInComment()) {
                var comment = this.Start.Paragraph._GetOwnerComment();
                var comments = this.ownerControl.Document.Comments;
                var index = comments._IndexOf(comment);
                comment = index == 0 ? comments[comments.Count - 1] : comments[index - 1];
                var para = comment._GetFirstParagraph();
                if (para != null) {
                    this._SelectParagraph(para, true, true);
                    this._SelectContent(this.Start, true);
                }
            }
        };
        SelectionAdv.prototype._NavigateNextComment = function () {
            if (this._IsInComment()) {
                var comment = this.Start.Paragraph._GetOwnerComment();
                var comments = this.ownerControl.Document.Comments;
                var index = comments._IndexOf(comment);
                comment = (index == (comments.Count - 1)) ? comments[0] : comments[index + 1];
                var para = comment._GetFirstParagraph();
                if (para != null) {
                    this._SelectParagraph(para, true, true);
                    this._SelectContent(this.Start, true);
                }
            }
        };
        SelectionAdv.prototype._RemoveInline = function (inline) {
            this.Start._SetPositionParagraph(inline.OwnerParagraph, inline.OwnerParagraph._GetOffset(inline, 0));
            this.End._SetPositionParagraph(this.Start.Paragraph, this.Start.Offset + inline.Length);
            this._InitHistory(Actions.RemoveInline);
            if (this.CurrentBaseHistoryInfo.InsertPosition == null)
                this.CurrentBaseHistoryInfo.InsertPosition = this.Start._GetHierarchicalIndexInternal();
            this._RemoveSelectedContent();
            this._UpdateHistory();
            this._FireContentChanged();
        };
        SelectionAdv.prototype._OnParagraphFormat = function (paragraphFormat) {
            this.ownerControl.IsShiftingEnabled = true;
            if (this.IsEmpty) {
                this._InitHistory(Actions.ParagraphFormat);
                this.Start.Paragraph.ParagraphFormat._ApplyPropertyValue(this.CurrentBaseHistoryInfo, null, paragraphFormat, false);
            }
            else {
                if (this.OwnerControl.Selection.SelectionRanges.Count > 0)
                    this._UpdateMultipleSelectionParagraphFormatting(Actions.ParagraphFormat, paragraphFormat, false);
            }
            this._Relayout(false);
        };
        SelectionAdv.prototype._OnStrikeThrough = function (strikeThrough) {
            if (this.IsEmpty) {
                if (this.Start.Offset == this.Start.Paragraph._GetLength()) {
                    this._InitHistory(Actions.StrikeThrough);
                    this.Start.Paragraph.CharacterFormat._ApplyPropertyValue(this.CurrentBaseHistoryInfo, CharacterFormat.StrikeThroughProperty, strikeThrough, false);
                    this._UpdateHistory();
                    this._FireContentChanged();
                }
                this._UpdateFocus();
                return;
            }
            else {
                if (this.OwnerControl.Selection.SelectionRanges.Count > 0)
                    this._UpdateMultipleSelectionCharacterFormatting(Actions.StrikeThrough, strikeThrough, false);
            }
        };
        SelectionAdv.prototype._OnHighlightColor = function (highlightColor) {
            if (this.OwnerControl.IsReadOnlyMode || !this.OwnerControl.IsDocumentLoaded)
                return;
            if (this.IsEmpty) {
                if (this.Start.Offset == this.Start.Paragraph._GetLength()) {
                    this._InitHistory(Actions.HighlightColor);
                    this.Start.Paragraph.CharacterFormat._ApplyPropertyValue(this.CurrentBaseHistoryInfo, CharacterFormat.HighlightColorProperty, highlightColor, false);
                    this._UpdateHistory();
                    this._FireContentChanged();
                }
                this._UpdateFocus();
                return;
            }
            else {
                if (this.OwnerControl.Selection.SelectionRanges.Count > 0)
                    this._UpdateMultipleSelectionCharacterFormatting(Actions.HighlightColor, highlightColor, false);
            }
        };
        SelectionAdv.prototype._OnFontFamily = function (fontFamily) {
            if (this.OwnerControl.IsReadOnlyMode || !this.OwnerControl.IsDocumentLoaded)
                return;
            if (this.IsEmpty) {
                if (this.Start.Offset == this.Start.Paragraph._GetLength()) {
                    this._InitHistory(Actions.FontFamily);
                    this.Start.Paragraph.CharacterFormat._ApplyPropertyValue(this.CurrentBaseHistoryInfo, CharacterFormat.FontFamilyProperty, fontFamily, false);
                    this._UpdateHistory();
                    this._FireContentChanged();
                }
                this._UpdateFocus();
                return;
            }
            else {
                if (this.OwnerControl.Selection.SelectionRanges.Count > 0)
                    this._UpdateMultipleSelectionCharacterFormatting(Actions.FontFamily, fontFamily, false);
            }
        };
        SelectionAdv.prototype._OnFontColor = function (fontColor) {
            if (this.OwnerControl.IsReadOnlyMode || !this.OwnerControl.IsDocumentLoaded)
                return;
            if (this.IsEmpty) {
                if (this.Start.Offset == this.Start.Paragraph._GetLength()) {
                    this._InitHistory(Actions.FontColor);
                    this.Start.Paragraph.CharacterFormat._ApplyPropertyValue(this.CurrentBaseHistoryInfo, CharacterFormat.FontColorProperty, fontColor, false);
                    this._UpdateHistory();
                    this._FireContentChanged();
                }
                this._UpdateFocus();
                return;
            }
            else {
                if (this.OwnerControl.Selection.SelectionRanges.Count > 0)
                    this._UpdateMultipleSelectionCharacterFormatting(Actions.FontColor, fontColor, false);
            }
        };
        SelectionAdv.prototype._OnFontSize = function (fontSize) {
            if (this.OwnerControl.IsReadOnlyMode || !this.OwnerControl.IsDocumentLoaded)
                return;
            this._OnFontSizeWithUpdate(fontSize, false);
        };
        SelectionAdv.prototype._OnFontSizeWithUpdate = function (fontSize, update) {
            if (this.IsEmpty) {
                if (this.Start.Offset == this.Start.Paragraph._GetLength()) {
                    this._InitHistory(Actions.FontSize);
                    this.Start.Paragraph.CharacterFormat._ApplyPropertyValue(this.CurrentBaseHistoryInfo, CharacterFormat.FontSizeProperty, fontSize, update);
                    this._UpdateHistory();
                    this._FireContentChanged();
                }
                this._UpdateFocus();
                return;
            }
            else {
                if (this.OwnerControl.Selection.SelectionRanges.Count > 0)
                    this._UpdateMultipleSelectionCharacterFormatting(Actions.FontSize, fontSize, update);
            }
        };
        SelectionAdv.prototype._OnItalic = function () {
            if (this.OwnerControl.IsReadOnlyMode || !this.OwnerControl.IsDocumentLoaded)
                return;
            if (this.IsEmpty) {
                if (this.Start.Offset == this.Start.Paragraph._GetLength()) {
                    this._InitHistory(Actions.Italic);
                    this.Start.Paragraph.CharacterFormat._ApplyPropertyValue(this.CurrentBaseHistoryInfo, CharacterFormat.ItalicProperty, !(this.Start.Paragraph.CharacterFormat.Italic), false);
                    this._UpdateHistory();
                    this._FireContentChanged();
                }
                this._UpdateFocus();
                return;
            }
            else {
                if (this.OwnerControl.Selection.SelectionRanges.Count > 0)
                    this._UpdateMultipleSelectionCharacterFormatting(Actions.Italic, null, false);
            }
        };
        SelectionAdv.prototype._ToggleUnderline = function (underline) {
            if (this.OwnerControl.IsReadOnlyMode || !this.OwnerControl.IsDocumentLoaded)
                return;
            var startPosition = this.Start;
            var endPosition = this.End;
            if (!this.IsForward) {
                startPosition = this.End;
                endPosition = this.Start;
            }
            var indexInInline = 0;
            var inlineObj = startPosition.Paragraph._GetInline(startPosition.Offset, indexInInline);
            var inline = inlineObj.inline;
            indexInInline = inlineObj.index;
            if (inline != null && inline.Length == indexInInline)
                inline = inline.NextNode;
            var paragraph = startPosition.Paragraph;
            var currentUnderline = Underline.None;
            if (inline != null)
                currentUnderline = inline.CharacterFormat.Underline;
            else if (paragraph != null)
                currentUnderline = paragraph.CharacterFormat.Underline;
            if (underline == currentUnderline)
                this._OnUnderline(Underline.None);
            else
                this._OnUnderline(underline);
        };
        SelectionAdv.prototype._ToggleTextAlignment = function (textAlignment) {
            if (this.OwnerControl.IsReadOnlyMode || !this.OwnerControl.IsDocumentLoaded)
                return;
            if (this.ParagraphFormat.TextAlignment != null && this.ParagraphFormat.TextAlignment == textAlignment) {
                if (textAlignment == TextAlignment.Left)
                    this._OnTextAlignment(TextAlignment.Justify);
                else
                    this._OnTextAlignment(TextAlignment.Left);
            }
            else
                this._OnTextAlignment(textAlignment);
        };
        SelectionAdv.prototype._OnUnderline = function (underline) {
            if (this.OwnerControl.IsReadOnlyMode || !this.OwnerControl.IsDocumentLoaded)
                return;
            if (this.IsEmpty) {
                if (this.Start.Offset == this.Start.Paragraph._GetLength()) {
                    this._InitHistory(Actions.Underline);
                    this.Start.Paragraph.CharacterFormat._ApplyPropertyValue(this.CurrentBaseHistoryInfo, CharacterFormat.UnderlineProperty, underline, false);
                    this._UpdateHistory();
                    this._FireContentChanged();
                }
                this._UpdateFocus();
                return;
            }
            else {
                if (this.OwnerControl.Selection.SelectionRanges.Count > 0)
                    this._UpdateMultipleSelectionCharacterFormatting(Actions.Underline, underline, false);
            }
        };
        SelectionAdv.prototype._ToggleBaselineAlignment = function (basealignment) {
            var startPosition = this.Start;
            var endPosition = this.End;
            if (!this.IsForward) {
                startPosition = this.End;
                endPosition = this.Start;
            }
            var indexInInline = 0;
            var inlineObj = startPosition.Paragraph._GetInline(startPosition.Offset, indexInInline);
            var inline = inlineObj.inline;
            indexInInline = inlineObj.index;
            if (inline != null && inline.Length == indexInInline)
                inline = inline.NextNode;
            var paragraph = startPosition.Paragraph;
            var Script = BaselineAlignment.Normal;
            if (inline != null)
                Script = inline.CharacterFormat.BaselineAlignment;
            else if (paragraph != null)
                Script = paragraph.CharacterFormat.BaselineAlignment;
            if (Script == basealignment)
                this._OnBaselineAlignment(BaselineAlignment.Normal);
            else if (basealignment == BaselineAlignment.Subscript)
                this._OnBaselineAlignment(BaselineAlignment.Subscript);
            else
                this._OnBaselineAlignment(BaselineAlignment.Superscript);
        };
        SelectionAdv.prototype._OnBaselineAlignment = function (baselineAlignment) {
            if (this.OwnerControl.IsReadOnlyMode || !this.OwnerControl.IsDocumentLoaded)
                return;
            if (this.IsEmpty) {
                if (this.Start.Offset == this.Start.Paragraph._GetLength()) {
                    this._InitHistory(Actions.BaselineAlignment);
                    this.Start.Paragraph.CharacterFormat._ApplyPropertyValue(this.CurrentBaseHistoryInfo, CharacterFormat.BaselineAlignmentProperty, !(this.Start.Paragraph.CharacterFormat.BaselineAlignment), false);
                    this._UpdateHistory();
                    this._FireContentChanged();
                }
                this._UpdateFocus();
                return;
            }
            else {
                if (this.OwnerControl.Selection.SelectionRanges.Count > 0)
                    this._UpdateMultipleSelectionCharacterFormatting(Actions.BaselineAlignment, baselineAlignment, false);
            }
        };
        SelectionAdv.prototype._OnBold = function () {
            if (this.OwnerControl.IsReadOnlyMode || !this.OwnerControl.IsDocumentLoaded)
                return;
            if (this.IsEmpty) {
                if (this.Start.Offset == this.Start.Paragraph._GetLength()) {
                    this._InitHistory(Actions.Bold);
                    this.Start.Paragraph.CharacterFormat._ApplyPropertyValue(this.CurrentBaseHistoryInfo, CharacterFormat.BoldProperty, !(this.Start.Paragraph.CharacterFormat.Bold), false);
                    this._UpdateHistory();
                    this._FireContentChanged();
                }
                this._UpdateFocus();
                return;
            }
            else {
                if (this.OwnerControl.Selection.SelectionRanges.Count > 0)
                    this._UpdateMultipleSelectionCharacterFormatting(Actions.Bold, null, false);
            }
        };
        SelectionAdv.prototype._UpdateMultipleSelectionCharacterFormatting = function (actions, values, update) {
            this._InitComplexHistory(Actions.MultiSelection);
            for (var i = 0; i < this.OwnerControl.Selection.SelectionRanges.Count; i++) {
                var selectionRange = this.OwnerControl.Selection.SelectionRanges._Get(i);
                this._UpdateCharacterFormat(selectionRange, actions, values, update);
                this._Relayout(false);
            }
            this._UpdateComplexHistory();
        };
        SelectionAdv.prototype._UpdateCharacterFormat = function (selectionRange, actions, values, update) {
            switch (actions) {
                case Actions.Bold:
                    this._InitializeHistory(Actions.Bold, selectionRange);
                    this._UpdateCharacterFormatForSelRange(selectionRange, CharacterFormat.BoldProperty, values);
                    break;
                case Actions.Italic:
                    this._InitializeHistory(Actions.Italic, selectionRange);
                    this._UpdateCharacterFormatForSelRange(selectionRange, CharacterFormat.ItalicProperty, values);
                    break;
                case Actions.FontColor:
                    this._InitializeHistory(Actions.FontColor, selectionRange);
                    this._UpdateCharacterFormatForSelRange(selectionRange, CharacterFormat.FontColorProperty, values);
                    break;
                case Actions.FontFamily:
                    this._InitializeHistory(Actions.FontFamily, selectionRange);
                    this._UpdateCharacterFormatForSelRange(selectionRange, CharacterFormat.FontFamilyProperty, values);
                    break;
                case Actions.FontSize:
                    this._InitializeHistory(Actions.FontSize, selectionRange);
                    this._UpdateCharacterFormatForSelRangeWithUpdate(selectionRange, CharacterFormat.FontSizeProperty, values, update);
                    break;
                case Actions.HighlightColor:
                    this._InitializeHistory(Actions.HighlightColor, selectionRange);
                    this._UpdateCharacterFormatForSelRange(selectionRange, CharacterFormat.HighlightColorProperty, values);
                    break;
                case Actions.BaselineAlignment:
                    this._InitializeHistory(Actions.BaselineAlignment, selectionRange);
                    this._UpdateCharacterFormatForSelRange(selectionRange, CharacterFormat.BaselineAlignmentProperty, values);
                    break;
                case Actions.StrikeThrough:
                    this._InitializeHistory(Actions.StrikeThrough, selectionRange);
                    this._UpdateCharacterFormatForSelRange(selectionRange, CharacterFormat.StrikeThroughProperty, values);
                    break;
                case Actions.Underline:
                    this._InitializeHistory(Actions.Underline, selectionRange);
                    this._UpdateCharacterFormatForSelRange(selectionRange, CharacterFormat.UnderlineProperty, values);
                    break;
                case Actions.CharacterFormat:
                    this._InitializeHistory(Actions.CharacterFormat, selectionRange);
                    this._UpdateCharacterFormatForSelRange(selectionRange, null, values);
                    break;
            }
        };
        SelectionAdv.prototype._UpdateCharacterFormatForSelRange = function (selectionRange, property, value) {
            this._UpdateCharacterFormatForSelRangeWithUpdate(selectionRange, property, value, false);
        };
        SelectionAdv.prototype._UpdateCharacterFormatForSelRangeWithUpdate = function (selectionRange, property, value, update) {
            this.OwnerControl.IsShiftingEnabled = true;
            var startPosition = selectionRange.Start;
            var endPosition = selectionRange.End;
            if (!selectionRange.IsForward) {
                startPosition = selectionRange.End;
                endPosition = selectionRange.Start;
            }
            if (this.CurrentBaseHistoryInfo.InsertPosition == null)
                this.CurrentBaseHistoryInfo.InsertPosition = startPosition._GetHierarchicalIndexInternal();
            startPosition.Paragraph._ApplyCharacterFormatForSelection(this, startPosition, endPosition, property, value, update);
            startPosition.Paragraph._StartSelectionRelayouting(this, startPosition, endPosition);
        };
        SelectionAdv.prototype._OnDelete = function () {
            if (this.Start == null)
                return;
            if (this.IsEmpty)
                this._SingleDelete(false);
            else {
                if (this.OwnerControl.Selection.SelectionRanges.Count > 0) {
                    this._InitComplexHistory(Actions.MultiSelection);
                    for (var i = 0; i < this.SelectionRanges.Count; i++) {
                        var selectionRange = this.OwnerControl.Selection.SelectionRanges._Get(i);
                        this._InitializeHistory(Actions.Delete, selectionRange);
                        this._DeleteSelectedContent(false, selectionRange.Start, selectionRange.End);
                        this._Relayout(true);
                        this._UpdateSelectionRangeOffSet(i, selectionRange.Start, selectionRange.End);
                    }
                    var textPosition = new TextPosition(this.OwnerControl);
                    textPosition._SetPositionForCurrentIndex(this.EditPosition);
                    this._SelectContent(textPosition, true);
                    this._UpdateComplexHistory();
                }
            }
        };
        SelectionAdv.prototype._SingleDelete = function (isRedoing) {
            this._ValidateSelectionBasedOnCommentCharacter(false);
            var paragraph = this.Start.Paragraph;
            var offset = this.Start.Offset;
            var indexInInline = 0;
            var inlineObj = paragraph._GetInline(this.Start.Offset, indexInInline);
            var inline = inlineObj.inline;
            indexInInline = inlineObj.index;
            if (inline != null && indexInInline == inline.Length && inline.NextNode != null) {
                inline = inline.NextNode;
                indexInInline = 0;
            }
            if (inline instanceof CommentAdv) {
                this._DeleteComment(inline);
                this._FireContentChanged();
                return;
            }
            if (inline != null) {
                var nextRenderedInline = null;
                var nextInline = inline._GetNextRenderedInline(indexInInline);
                if (nextInline instanceof Inline)
                    nextRenderedInline = nextInline;
                if (nextRenderedInline != null && nextRenderedInline instanceof FieldBeginAdv) {
                    inline = nextRenderedInline.fieldEnd;
                    paragraph = inline.OwnerParagraph;
                    offset = paragraph._GetOffset(inline, 1);
                    this.End._SetPositionParagraph(paragraph, offset);
                    this._FireSelectionChanged(true);
                    return;
                }
                else if (inline != nextRenderedInline) {
                    inline = nextRenderedInline;
                    paragraph = inline.OwnerParagraph;
                    offset = paragraph._GetOffset(inline, 0);
                    if (inline instanceof FieldEndAdv)
                        offset++;
                }
            }
            if (offset == paragraph._GetLength()) {
                if (paragraph.IsInsideTable && paragraph.NextBlock == null)
                    return;
                var previousParagraph = null, newParagraph = null;
                var nextParagraph = paragraph._GetNextParagraph();
                if (nextParagraph == null) {
                    if (offset > 0)
                        return;
                    else {
                        if (paragraph.PreviousBlock instanceof ParagraphAdv)
                            previousParagraph = paragraph.PreviousBlock;
                        if (paragraph.PreviousBlock instanceof TableAdv)
                            return;
                        if (previousParagraph == null) {
                            newParagraph = new ParagraphAdv(null);
                            if (paragraph.Owner instanceof CompositeNode)
                                paragraph.Owner.ChildNodes._Add(newParagraph);
                            else if (paragraph.Owner instanceof CommentAdv)
                                paragraph.Owner.Blocks._Add(newParagraph);
                        }
                    }
                }
                if (!isRedoing)
                    this._InitHistory(Actions.Delete);
                this.EditPosition = this.Start._GetHierarchicalIndexInternal();
                if (this.CurrentBaseHistoryInfo.InsertPosition == null) {
                    this.CurrentBaseHistoryInfo.InsertPosition = this.EditPosition;
                    this.CurrentBaseHistoryInfo.EndPosition = this.EditPosition;
                }
                this.OwnerControl.IsShiftingEnabled = true;
                if (paragraph._IsEmpty()) {
                    paragraph._RemoveBlock();
                    this.CurrentBaseHistoryInfo.RemovedNodes._Add(paragraph);
                    if (nextParagraph == null) {
                        if (previousParagraph == null) {
                            this._SelectParagraph(newParagraph, true, true);
                            var paraEndOffset = newParagraph.GetLength() + 1;
                            this.CurrentBaseHistoryInfo.InsertPosition = this.Start._GetHierarchicalIndexInternal();
                            this.CurrentBaseHistoryInfo.EndPosition = newParagraph.GetHierarchicalIndex(paraEndOffset.toString());
                        }
                        else {
                            this._SelectParagraph(previousParagraph, false, true);
                            this.CurrentBaseHistoryInfo.InsertPosition = this.Start._GetHierarchicalIndexInternal();
                            this.CurrentBaseHistoryInfo.EndPosition = this.CurrentBaseHistoryInfo.InsertPosition;
                        }
                    }
                    else
                        this._SelectParagraph(nextParagraph, true, true);
                }
                else {
                    var currentParagraph = paragraph._SplitParagraph(0, this.Start.Offset);
                    paragraph._RemoveBlock();
                    currentParagraph._DeleteParagraphMark(this, 0);
                    this.CurrentBaseHistoryInfo.RemovedNodes._Add(paragraph);
                    this.Start._SetPositionForCurrentIndex(this.EditPosition);
                    this._SelectContent(this.Start, true);
                }
                if (!isRedoing)
                    this._Relayout(true);
            }
            else {
                if (!isRedoing) {
                    this.OwnerControl.IsShiftingEnabled = true;
                    this._InitHistory(Actions.Delete);
                }
                if (this.CurrentBaseHistoryInfo.InsertPosition == null) {
                    this.CurrentBaseHistoryInfo.InsertPosition = this.Start._GetHierarchicalIndexInternal();
                    this.CurrentBaseHistoryInfo.EndPosition = this.CurrentBaseHistoryInfo.InsertPosition;
                }
                paragraph._RemoveAtOffset(this.CurrentBaseHistoryInfo, this.Start.Offset);
                this._Selects(this.Start.Paragraph, this.Start.Offset, true);
                if (!isRedoing)
                    this._Relayout(true);
                else
                    this._FireContentChanged();
            }
        };
        SelectionAdv.prototype._DeleteSelectedContent = function (isBackSpace, startposition, endposition) {
            var startPosition = startposition;
            var endPosition = endposition;
            if (!startposition._IsExistBefore(endposition)) {
                startPosition = endposition;
                endPosition = startposition;
            }
            this.EditPosition = startPosition._GetHierarchicalIndexInternal();
            var skipBackSpace = false;
            if (isBackSpace && startPosition._IsInSameParagraph(endPosition)) {
                if (startPosition.Offset < endPosition.Offset && startPosition.Offset == endPosition.Paragraph._GetLength()) {
                    var nextBlock = startPosition.Paragraph._GetNextRenderedBlock();
                    skipBackSpace = nextBlock instanceof TableAdv;
                }
                if (endPosition.Offset == 1 && endPosition.Offset > endPosition.Paragraph._GetLength()
                    && !(endPosition.Paragraph.IsInsideTable && endPosition.Paragraph.NextBlock == null))
                    isBackSpace = false;
            }
            if (!skipBackSpace) {
                this.OwnerControl.IsShiftingEnabled = true;
                if (this.CurrentBaseHistoryInfo.InsertPosition == null)
                    this.CurrentBaseHistoryInfo.InsertPosition = this.EditPosition;
                var editAction = (isBackSpace ? 1 : 0);
                startPosition.Paragraph._DeleteSelectedContent(this, startPosition, endPosition, editAction);
            }
            return skipBackSpace;
        };
        SelectionAdv.prototype._DeleteSelectedContents = function (isBackSpace) {
            var skipBackSpace = this._DeleteSelectedContent(isBackSpace, this.Start, this.End);
            var textPosition = new TextPosition(this.OwnerControl);
            textPosition._SetPositionForCurrentIndex(this.EditPosition);
            this._SelectContent(textPosition, true);
            return skipBackSpace;
        };
        SelectionAdv.prototype._UpdateSelectionRangeOffSet = function (index, startPosition, endPosition) {
            var startposition = null;
            var endposition = null;
            var difference = 0;
            if (startPosition.Paragraph == endPosition.Paragraph)
                difference = endPosition.Offset - startPosition.Offset;
            else
                difference = endPosition.Offset;
            for (var j = index + 1; j < this.SelectionRanges.Count; j++) {
                var selectionRange = this.SelectionRanges._Get(j);
                startposition = selectionRange.Start;
                endposition = selectionRange.End;
                if ((startPosition.Paragraph == startposition.Paragraph && endPosition.Paragraph == endposition.Paragraph) || (endPosition.Paragraph == startposition.Paragraph && endPosition.Paragraph == endposition.Paragraph)) {
                    if (startposition.Offset > startPosition.Offset) {
                        selectionRange.Start._SetPositionParagraph(startposition.Paragraph, startposition.Offset - difference);
                        selectionRange.End._SetPositionParagraph(endposition.Paragraph, endposition.Offset - difference);
                    }
                }
                else if (endPosition.Paragraph == startposition.Paragraph)
                    selectionRange.Start._SetPositionParagraph(startposition.Paragraph, startposition.Offset - difference);
            }
        };
        SelectionAdv.prototype._UpdateSelectionRangeOffSetInternal = function (length) {
            var difference = 0;
            if (this.SelectionRanges.Count > 1) {
                for (var i = 0; i < length; i++) {
                    var selectionRange = this.SelectionRanges[i];
                    if (selectionRange.Start.Paragraph == selectionRange.End.Paragraph)
                        difference = selectionRange.End.Offset - selectionRange.Start.Offset;
                    else
                        difference = selectionRange.End.Offset;
                    if ((selectionRange.Start.Paragraph == this.Start.Paragraph && selectionRange.End.Paragraph == this.End.Paragraph) || (this.Start.Paragraph == this.End.Paragraph && selectionRange.End.Paragraph == this.Start.Paragraph && selectionRange.End.Paragraph == this.End.Paragraph)) {
                        if (selectionRange.Start.Offset < this.Start.Offset) {
                            this.Start._SetPositionParagraph(this.Start.Paragraph, this.Start.Offset + difference);
                            this.End._SetPositionParagraph(this.End.Paragraph, this.End.Offset + difference);
                        }
                    }
                    else if (selectionRange.End.Paragraph == this.Start.Paragraph)
                        this.Start._SetPositionParagraph(this.Start.Paragraph, this.Start.Offset + difference);
                }
            }
        };
        SelectionAdv.prototype._SelectTableCell = function (tableCell, clearMultiSelection) {
            var firstParagraph = tableCell._GetFirstParagraph();
            var lastParagraph = tableCell._GetLastParagraph();
            if (firstParagraph == lastParagraph && lastParagraph._IsEmpty())
                this._SelectParagraph(lastParagraph, true, clearMultiSelection);
            else {
                if (clearMultiSelection)
                    this.SelectionRanges._ClearMultiSelection();
                this.Start._SetPosition(firstParagraph, true);
                this.End._SetPositionParagraph(lastParagraph, lastParagraph._GetEndOffset());
                this._FireSelectionChanged(true);
            }
        };
        SelectionAdv.prototype._OnApplyList = function (list, listLevelNumber) {
            var listFormat = new ListFormat(null);
            if (list != null && listLevelNumber >= 0 && listLevelNumber < 9) {
                listFormat.List = list;
                listFormat.ListLevelNumber = listLevelNumber;
            }
            if (this.IsEmpty) {
                this._InitHistory(Actions.ListFormat);
                this.Start.Paragraph.ParagraphFormat._ApplyPropertyValueInternal(this.CurrentBaseHistoryInfo, ParagraphFormat.ListFormatProperty, listFormat);
            }
            else {
                if (this.OwnerControl.Selection.SelectionRanges.Count > 0) {
                    this._UpdateMultipleSelectionParagraphFormatting(Actions.ListFormat, listFormat, false);
                }
            }
            this.OwnerControl.IsShiftingEnabled = true;
            this._Relayout(false);
        };
        SelectionAdv.prototype._RetrieveCharacterFormat = function (start, end) {
            this.CharacterFormat._CopyFormat(start.Paragraph.CharacterFormat);
            if (start.Paragraph == end.Paragraph && start.Offset + 1 == end.Offset)
                return;
            var para = start.Paragraph;
            if (start.Offset == para._GetLength() && !this.IsEmpty)
                para = para._GetNextParagraph();
            while (para != null && para != end.Paragraph && para._IsEmpty())
                para = para._GetNextParagraph();
            var offset = para == start.Paragraph ? start.Offset : 0;
            var indexInInline = 0;
            if (para != null && !para._IsEmpty()) {
                var position = new TextPosition(null);
                var CurrentinlineIndex = para._GetInline(offset, indexInInline);
                position._SetPositionPhysicalLocation(para, CurrentinlineIndex.inline, CurrentinlineIndex.index, para._GetPhysicalPosition(offset));
                para._GetCharacterFormatForSelection(this, position, end);
            }
        };
        SelectionAdv.prototype._RetrieveParagraphFormat = function (start, end) {
            start.Paragraph._GetParagraphFormatForSelection(this, start, end);
        };
        SelectionAdv.prototype._RetrieveSectionFormat = function (start, end) {
            if (start.Paragraph.Section != null) {
                this.SectionFormat._CopyFormat(start.Paragraph.Section.SectionFormat);
                var startSectionIndex = this.ownerControl.Document.Sections._IndexOf(start.Paragraph.Section);
                var endSectionIndex = this.ownerControl.Document.Sections._IndexOf(end.Paragraph.Section);
                for (var i = startSectionIndex + 1; i <= endSectionIndex; i++)
                    this.SectionFormat._CombineFormat(this.ownerControl.Document.Sections[i].SectionFormat);
            }
        };
        SelectionAdv.prototype._RetrieveTableFormat = function (start, end) {
            var tableAdv = this._GetTable(start, end);
            if (tableAdv != null) {
                this.TableFormat._CopyFormat(tableAdv.TableFormat);
                this.TableFormat.Table = tableAdv;
                this._RetrieveCellFormat(start, end);
                this._RetriveRowFormat(start, end);
            }
            else {
                this.TableFormat._ClearFormat();
            }
        };
        SelectionAdv.prototype._RetrieveCellFormat = function (start, end) {
            if (start.Paragraph.IsInsideTable && end.Paragraph.IsInsideTable) {
                this.CellFormat._CopyFormat(start.Paragraph.AssociatedCell.CellFormat);
                start.Paragraph.AssociatedCell.OwnerTable._GetCellFormat(this, start, end);
            }
            else
                this.CellFormat._ClearCellFormat();
        };
        SelectionAdv.prototype._RetriveRowFormat = function (start, end) {
            if (start.Paragraph.IsInsideTable && end.Paragraph.IsInsideTable) {
                this.RowFormat._CopyFormat(start.Paragraph.AssociatedCell.OwnerRow.RowFormat);
                start.Paragraph.AssociatedCell.OwnerTable._GetRowFormat(this, start, end);
            }
            else
                this.RowFormat._ClearRowFormat();
        };
        SelectionAdv.prototype._ReplaceAll = function (textToReplace) {
            if (this.OwnerControl == null || this.OwnerControl.IsReadOnlyMode ||
                this.OwnerControl.textSearchResults == null || this.ownerControl.textSearchResults.Count == 0)
                return 0;
            if (this.OwnerControl.Viewer != null)
                this.OwnerControl.Viewer._ClearSearchHighlight();
            this._InitComplexHistory(Actions.ReplaceAll);
            var count = this.OwnerControl.textSearchResults.Count;
            this.OwnerControl.IsLayoutEnabled = false;
            for (var i = count - 1; i >= 0; i--) {
                this.OwnerControl.textSearchResults._GetResult(i)._Navigate();
                this._InsertText(textToReplace, true);
                this.OwnerControl.textSearchResults._GetResult(i)._Dispose();
                this.OwnerControl.textSearchResults._RemoveAt(i);
            }
            this._UpdateComplexHistory();
            return count;
        };
        SelectionAdv.prototype._UpdateImageSize = function (imageFormat) {
            this.OwnerControl.IsShiftingEnabled = true;
            var startPosition = this.Start;
            var endPosition = this.End;
            if (!this.IsForward) {
                startPosition = this.End;
                endPosition = this.Start;
            }
            var inline = null;
            var index = 0;
            var paragraph = startPosition.Paragraph;
            if (paragraph == endPosition.Paragraph
                && startPosition.Offset + 1 == endPosition.Offset) {
                var inlineObj = paragraph._GetInline(endPosition.Offset, index);
                inline = inlineObj.inline;
                index = inlineObj.index;
            }
            if (inline instanceof ImageAdv) {
                var width = inline.Width;
                var height = inline.Height;
                inline.Width = imageFormat.Width;
                inline.Height = imageFormat.Height;
                imageFormat.Width = width;
                imageFormat.Height = height;
                if (paragraph != null && paragraph.BaseParent != null) {
                    paragraph._RelayoutParagraph(paragraph.Inlines._IndexOf(inline));
                    this._HighlightSelection(false);
                }
            }
        };
        SelectionAdv.prototype._GetSelectedCells = function () {
            var cells = new List();
            for (var i = 0; i < this.SelectionRanges.Last.SelectedWidgets.Keys.length; i++) {
                var widget = this.SelectionRanges.Last.SelectedWidgets.Keys[i];
                if (widget instanceof TableCellWidget)
                    cells._Add(widget.TableCell);
            }
            return cells;
        };
        SelectionAdv.prototype._UpdateTableFormat = function (selectionRange, property, value) {
            var startPosition = selectionRange.Start;
            var endPosition = selectionRange.End;
            if (!selectionRange.IsForward) {
                startPosition = selectionRange.End;
                endPosition = selectionRange.Start;
            }
            if (this.CurrentBaseHistoryInfo.InsertPosition == null)
                this.CurrentBaseHistoryInfo.InsertPosition = startPosition._GetHierarchicalIndexInternal();
            startPosition.Paragraph.AssociatedCell.OwnerTable.TableFormat._ApplyPropertyValue(this.CurrentBaseHistoryInfo, property, value);
        };
        SelectionAdv.prototype._UpdateCellFormat = function (selectionRange, property, value) {
            var startPosition = selectionRange.Start;
            var endPosition = selectionRange.End;
            if (!selectionRange.IsForward) {
                startPosition = selectionRange.End;
                endPosition = selectionRange.Start;
            }
            if (this.CurrentBaseHistoryInfo.InsertPosition == null)
                this.CurrentBaseHistoryInfo.InsertPosition = startPosition._GetHierarchicalIndexInternal();
            startPosition.Paragraph.AssociatedCell._ApplyCellFormat(this, startPosition, endPosition, property, value);
        };
        SelectionAdv.prototype._UpdateRowFormat = function (selectionRange, property, value) {
            var startPosition = selectionRange.Start;
            var endPosition = selectionRange.End;
            if (!selectionRange.IsForward) {
                startPosition = selectionRange.End;
                endPosition = selectionRange.Start;
            }
            if (this.CurrentBaseHistoryInfo.InsertPosition == null)
                this.CurrentBaseHistoryInfo.InsertPosition = startPosition._GetHierarchicalIndexInternal();
            startPosition.Paragraph.AssociatedCell.OwnerRow._ApplyRowFormat(this, startPosition, endPosition, property, value);
        };
        SelectionAdv.prototype._InitResizingHistory = function (startingPoint) {
            if (this.OwnerControl.ResizeNode == 1) {
                this._InitHistory(Actions.RowResizing);
                if (this.CurrentBaseHistoryInfo != null)
                    this.CurrentBaseHistoryInfo.ModifiedProperties._Add(new RowHistoryFormat(startingPoint, this.OwnerControl.CurrentResizingTable.Rows[this.OwnerControl.ResizerPosition].RowFormat));
            }
            else {
                this._InitHistory(Actions.CellResizing);
                if (this.CurrentBaseHistoryInfo != null) {
                    var cellHistroyFormat = new CellHistoryFormat(startingPoint);
                    cellHistroyFormat.StartIndex = this.OwnerControl.ResizerPosition;
                    var tableLocation = this.OwnerControl.CurrentResizingTable.TableWidgets[this.OwnerControl.CurrentResizingTable.TableWidgets.Count - 1];
                    cellHistroyFormat.startX = startingPoint.X - tableLocation.X;
                    cellHistroyFormat.startY = startingPoint.Y - tableLocation.Y;
                    cellHistroyFormat.TableHierarchicalIndex = this.OwnerControl.CurrentResizingTable._GetHierarchicalIndex("0");
                    this.CurrentBaseHistoryInfo.ModifiedProperties._Add(cellHistroyFormat);
                }
            }
        };
        SelectionAdv.prototype._UpdateResizingHistory = function (point) {
            if (this.OwnerControl.ResizeNode == 1) {
                if (this.CurrentBaseHistoryInfo != null) {
                    var rowHistroyFormat = this.CurrentBaseHistoryInfo.ModifiedProperties[0];
                    if (rowHistroyFormat.StartingPoint.Y == point.Y)
                        this.CurrentBaseHistoryInfo.ModifiedProperties._Clear();
                    else {
                        rowHistroyFormat.Displacement = point.Y - rowHistroyFormat.StartingPoint.Y;
                        this.OwnerControl.History._RecordChanges(this.CurrentBaseHistoryInfo);
                        this.CurrentBaseHistoryInfo = null;
                    }
                }
            }
            else {
                if (this.CurrentBaseHistoryInfo != null) {
                    var cellHistroyFormat = this.CurrentBaseHistoryInfo.ModifiedProperties[0];
                    if (cellHistroyFormat.StartingPoint.X == point.X)
                        this.CurrentBaseHistoryInfo.ModifiedProperties._Clear();
                    else {
                        cellHistroyFormat.displacment = point.X - cellHistroyFormat.StartingPoint.X;
                        cellHistroyFormat.EndIndex = this.OwnerControl.Viewer._GetCellReSizerPosition(point);
                        this.OwnerControl.History._RecordChanges(this.CurrentBaseHistoryInfo);
                        this.CurrentBaseHistoryInfo = null;
                    }
                }
            }
        };
        SelectionAdv.prototype._OnTableFormat = function (format) {
            if (this.TableFormat != null) {
                this.ownerControl.IsShiftingEnabled = true;
                this._InitHistory(Actions.TableFormat);
                this.TableFormat.Table.TableFormat._ApplyPropertyValue(this.CurrentBaseHistoryInfo, null, format);
                this._Relayout(false);
            }
        };
        SelectionAdv.prototype._OnCellFormat = function (format, cell) {
            if (cell != null) {
                this.ownerControl.IsShiftingEnabled = true;
                this._InitHistory(Actions.CellFormat);
                cell.CellFormat._ApplyPropertyValue(this.CurrentBaseHistoryInfo, null, format);
                this._Relayout(false);
            }
        };
        SelectionAdv.prototype._OnRowFormat = function (format, row) {
            if (row != null) {
                this.ownerControl.IsShiftingEnabled = true;
                this._InitHistory(Actions.RowFormat);
                row.RowFormat._ApplyPropertyValue(this.CurrentBaseHistoryInfo, null, format);
                this._Relayout(false);
            }
        };
        SelectionAdv.prototype._UpdateSelectionTextPosition = function (isSelectionChanged) {
            this.Start._UpdatePhysicalPosition();
            if (this.IsEmpty)
                this.End._SetPositionInternal(this.Start);
            else
                this.End._UpdatePhysicalPosition();
            this.UpDownSelectionLength = this.End.Location.X;
            this._FireSelectionChanged(isSelectionChanged);
            this._UpdateHistory();
            this._FireContentChanged();
        };
        SelectionAdv.prototype._UpdateListChanges = function (modifiedCollection) {
            this.OwnerControl.IsLayoutEnabled = false;
            this.OwnerControl.Document._UpdateListParagraphs();
            for (var i = 0; i < modifiedCollection.ModifiedLevels.Keys.Count; i++) {
                var levelNumber = modifiedCollection.ModifiedLevels.Keys[0];
                var modifiedLevel = modifiedCollection.ModifiedLevels._Get(levelNumber);
                if (this.CurrentBaseHistoryInfo != null)
                    modifiedLevel = this.CurrentBaseHistoryInfo._AddModifiedPropertiesForList(modifiedLevel.OwnerListLevel);
                modifiedLevel.OwnerListLevel._CopyLevel(modifiedLevel.ModifiedListLevel);
            }
            this.OwnerControl.Document._RevertListChanges(this.CurrentBaseHistoryInfo);
            this.OwnerControl.IsLayoutEnabled = true;
            this.OwnerControl.Document._LayoutItems(this.OwnerControl.Viewer);
            this.Start._UpdatePhysicalPosition();
            if (this.IsEmpty)
                this.End._SetPositionInternal(this.Start);
            else
                this.End._UpdatePhysicalPosition();
            this.UpDownSelectionLength = this.End.Location.X;
            this._FireSelectionChanged(false);
            this._UpdateHistory();
            this._FireContentChanged();
        };
        SelectionAdv.prototype._Dispose = function () {
            if (this.editingContext != null && this.editingContext != undefined) {
                this.editingContext = null;
            }
        };
        return SelectionAdv;
    }());
    DocumentEditorFeatures.SelectionAdv = SelectionAdv;
    var Size = (function () {
        function Size(height, width) {
            this.height = height;
            this.width = width;
        }
        Object.defineProperty(Size.prototype, "Width", {
            get: function () {
                return this.width;
            },
            set: function (value) {
                this.width = value;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(Size.prototype, "Height", {
            get: function () {
                return this.height;
            },
            set: function (value) {
                this.height = value;
            },
            enumerable: true,
            configurable: true
        });
        return Size;
    }());
    DocumentEditorFeatures.Size = Size;
    var Thickness = (function () {
        function Thickness(left, right, top, bottom) {
            this.Left = left;
            this.Right = right;
            this.Top = top;
            this.Bottom = bottom;
        }
        Object.defineProperty(Thickness.prototype, "Left", {
            get: function () {
                return this.left;
            },
            set: function (value) {
                this.left = value;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(Thickness.prototype, "Right", {
            get: function () {
                return this.right;
            },
            set: function (value) {
                this.right = value;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(Thickness.prototype, "Top", {
            get: function () {
                return this.top;
            },
            set: function (value) {
                this.top = value;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(Thickness.prototype, "Bottom", {
            get: function () {
                return this.bottom;
            },
            set: function (value) {
                this.bottom = value;
            },
            enumerable: true,
            configurable: true
        });
        return Thickness;
    }());
    DocumentEditorFeatures.Thickness = Thickness;
    var SelectionCharacterFormat = (function () {
        function SelectionCharacterFormat(selection) {
            this.bold = null;
            this.italic = null;
            this.underline = null;
            this.strikeThrough = null;
            this.baselineAlignment = null;
            this.highlightColor = null;
            this.fontSize = 0;
            this.fontColor = null;
            this.selection = selection;
        }
        Object.defineProperty(SelectionCharacterFormat.prototype, "FontSize", {
            get: function () {
                return this.fontSize;
            },
            set: function (value) {
                if (value == this.fontSize)
                    return;
                this.fontSize = value;
                this._NotifyPropertyChanged("FontSize");
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(SelectionCharacterFormat.prototype, "FontFamily", {
            get: function () {
                return this.fontFamily;
            },
            set: function (value) {
                if (value == this.fontFamily)
                    return;
                this.fontFamily = value;
                this._NotifyPropertyChanged("FontFamily");
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(SelectionCharacterFormat.prototype, "FontColor", {
            get: function () {
                return this.fontColor;
            },
            set: function (value) {
                if (value == this.fontColor)
                    return;
                this.fontColor = value;
                this._NotifyPropertyChanged("FontColor");
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(SelectionCharacterFormat.prototype, "Bold", {
            get: function () {
                return this.bold;
            },
            set: function (value) {
                if (value == this.bold)
                    return;
                this.bold = value;
                this._NotifyPropertyChanged("Bold");
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(SelectionCharacterFormat.prototype, "Italic", {
            get: function () {
                return this.italic;
            },
            set: function (value) {
                if (value == this.italic)
                    return;
                this.italic = value;
                this._NotifyPropertyChanged("Italic");
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(SelectionCharacterFormat.prototype, "StrikeThrough", {
            get: function () {
                return this.strikeThrough;
            },
            set: function (value) {
                if (value == this.strikeThrough)
                    return;
                this.strikeThrough = value;
                this._NotifyPropertyChanged("StrikeThrough");
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(SelectionCharacterFormat.prototype, "BaselineAlignment", {
            get: function () {
                return this.baselineAlignment;
            },
            set: function (value) {
                if (value == this.baselineAlignment)
                    return;
                this.baselineAlignment = value;
                this._NotifyPropertyChanged("BaselineAlignment");
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(SelectionCharacterFormat.prototype, "Underline", {
            get: function () {
                return this.underline;
            },
            set: function (value) {
                if (value == this.underline)
                    return;
                this.underline = value;
                this._NotifyPropertyChanged("Underline");
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(SelectionCharacterFormat.prototype, "HighlightColor", {
            get: function () {
                return this.highlightColor;
            },
            set: function (value) {
                if (value == this.highlightColor)
                    return;
                this.highlightColor = value;
                this._NotifyPropertyChanged("HighlightColor");
            },
            enumerable: true,
            configurable: true
        });
        SelectionCharacterFormat.prototype._NotifyPropertyChanged = function (propertyName) {
            if (this.selection != null && !this.selection.OwnerControl.IsDocumentLoaded && !this.selection.IsRetrieveFormatting)
                return;
            if (this.selection != null && this.selection.Start != null && !this.selection.IsRetrieveFormatting) {
                switch (propertyName) {
                    case "Bold":
                        if (this.bold != null || this.bold != undefined)
                            this.selection._OnBold();
                        break;
                    case "Italic":
                        if (this.italic != null || this.italic != undefined)
                            this.selection._OnItalic();
                        break;
                    case "FontSize":
                        if (this.fontSize >= 1)
                            this.selection._OnFontSize(this.fontSize);
                        break;
                    case "FontFamily":
                        if (this.fontFamily != null || this.fontFamily != undefined)
                            this.selection._OnFontFamily(this.fontFamily);
                        break;
                    case "StrikeThrough":
                        if (this.strikeThrough != null || this.strikeThrough != undefined)
                            this.selection._OnStrikeThrough(this.strikeThrough);
                        break;
                    case "BaselineAlignment":
                        if (this.baselineAlignment != null || this.baselineAlignment != undefined)
                            this.selection._OnBaselineAlignment(this.baselineAlignment);
                        break;
                    case "HighlightColor":
                        if (this.highlightColor != null || this.highlightColor != undefined)
                            this.selection._OnHighlightColor(this.highlightColor);
                        break;
                    case "Underline":
                        if (this.underline != null || this.underline != undefined)
                            this.selection._OnUnderline(this.underline);
                        break;
                    case "FontColor":
                        if (this.fontColor != null || this.fontColor != undefined)
                            this.selection._OnFontColor(this.fontColor);
                        break;
                }
            }
        };
        SelectionCharacterFormat.prototype._CopyFormat = function (format) {
            this.FontSize = format.FontSize;
            this.FontFamily = format.FontFamily;
            this.Bold = format.Bold;
            this.Italic = format.Italic;
            this.BaselineAlignment = format.BaselineAlignment;
            this.Underline = format.Underline;
            this.FontColor = format.FontColor;
            this.HighlightColor = format.HighlightColor;
            this.StrikeThrough = format.StrikeThrough;
        };
        SelectionCharacterFormat.prototype._CombineFormat = function (format) {
            if (this.Bold != null && this.Bold != format.Bold)
                this.Bold = null;
            if (this.Italic != null && this.Italic != format.Italic)
                this.Italic = null;
            if (this.FontSize != 0 && this.FontSize != format.FontSize)
                this.FontSize = 0;
            if (this.FontFamily != null && this.FontFamily != format.FontFamily)
                this.FontFamily = null;
            if (this.HighlightColor != null && this.HighlightColor != format.HighlightColor)
                this.HighlightColor = null;
            if (this.BaselineAlignment != null && this.BaselineAlignment != format.BaselineAlignment)
                this.BaselineAlignment = null;
            if (this.FontColor != null && (this.FontColor != format.FontColor))
                this.FontColor = null;
            if (this.Underline != null && this.Underline != format.Underline)
                this.Underline = null;
            if (this.StrikeThrough != null && this.StrikeThrough != format.StrikeThrough)
                this.StrikeThrough = null;
        };
        SelectionCharacterFormat.prototype._CopyToFormat = function (format) {
            if (format == null)
                return;
            if (this.Bold != null)
                format.Bold = this.Bold;
            if (this.Italic != null)
                format.Italic = this.Italic;
            if (this.FontSize > 0)
                format.FontSize = this.FontSize;
            if (this.FontFamily != null)
                format.FontFamily = this.FontFamily;
            if (this.HighlightColor != null)
                format.HighlightColor = this.HighlightColor;
            if (this.BaselineAlignment != null)
                format.BaselineAlignment = this.BaselineAlignment;
            if (this.FontColor != null)
                format.FontColor = this.FontColor;
            if (this.Underline != null)
                format.Underline = this.Underline;
            if (this.StrikeThrough != null)
                format.StrikeThrough = this.StrikeThrough;
        };
        SelectionCharacterFormat.prototype._CloneFormat = function (selectionCharacterFormat) {
            this.Bold = selectionCharacterFormat.Bold;
            this.Italic = selectionCharacterFormat.Italic;
            this.Underline = selectionCharacterFormat.Underline;
            this.StrikeThrough = selectionCharacterFormat.StrikeThrough;
            this.BaselineAlignment = selectionCharacterFormat.BaselineAlignment;
            this.HighlightColor = selectionCharacterFormat.HighlightColor;
            this.FontSize = selectionCharacterFormat.FontSize;
            this.FontFamily = selectionCharacterFormat.FontFamily;
            this.FontColor = selectionCharacterFormat.FontColor;
        };
        SelectionCharacterFormat.prototype._IsEqualFormat = function (format) {
            return (this.FontSize == format.FontSize
                && this.FontFamily == format.FontFamily
                && this.Bold == format.Bold
                && this.Italic == format.Italic
                && this.BaselineAlignment == format.BaselineAlignment
                && this.Underline == format.Underline
                && this.FontColor == format.FontColor
                && this.StrikeThrough == format.StrikeThrough
                && this.HighlightColor == format.HighlightColor);
        };
        SelectionCharacterFormat.prototype._ClearFormat = function () {
            this.fontSize = 0;
            this.bold = null;
            this.italic = null;
            this.fontFamily = null;
            this.fontColor = null;
            this.underline = null;
            this.strikeThrough = null;
            this.baselineAlignment = null;
        };
        SelectionCharacterFormat.prototype._Dispose = function () {
            this.selection = null;
            this.bold = null;
            this.italic = null;
            this.fontFamily = null;
            this.fontColor = null;
            this.underline = null;
            this.strikeThrough = null;
            this.baselineAlignment = null;
        };
        return SelectionCharacterFormat;
    }());
    DocumentEditorFeatures.SelectionCharacterFormat = SelectionCharacterFormat;
    var SelectionParagraphFormat = (function () {
        function SelectionParagraphFormat(selection) {
            this.leftIndent = 0;
            this.rightIndent = 0;
            this.beforeSpacing = 0;
            this.afterSpacing = 0;
            this.textAlignment = null;
            this.firstLineIndent = 0;
            this.lineSpacing = 1;
            this.lineSpacingType = null;
            this.listLevelNumber = -1;
            this.selection = selection;
        }
        Object.defineProperty(SelectionParagraphFormat.prototype, "LeftIndent", {
            get: function () {
                return this.leftIndent;
            },
            set: function (value) {
                if (value == this.leftIndent)
                    return;
                this.leftIndent = value;
                this._NotifyPropertyChanged("LeftIndent");
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(SelectionParagraphFormat.prototype, "RightIndent", {
            get: function () {
                return this.rightIndent;
            },
            set: function (value) {
                if (value == this.rightIndent)
                    return;
                this.rightIndent = value;
                this._NotifyPropertyChanged("RightIndent");
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(SelectionParagraphFormat.prototype, "FirstLineIndent", {
            get: function () {
                return this.firstLineIndent;
            },
            set: function (value) {
                if (value == this.firstLineIndent)
                    return;
                this.firstLineIndent = value;
                this._NotifyPropertyChanged("FirstLineIndent");
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(SelectionParagraphFormat.prototype, "TextAlignment", {
            get: function () {
                return this.textAlignment;
            },
            set: function (value) {
                if (value == this.textAlignment)
                    return;
                this.textAlignment = value;
                this._NotifyPropertyChanged("TextAlignment");
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(SelectionParagraphFormat.prototype, "AfterSpacing", {
            get: function () {
                return this.afterSpacing;
            },
            set: function (value) {
                if (value == this.afterSpacing)
                    return;
                this.afterSpacing = value;
                this._NotifyPropertyChanged("AfterSpacing");
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(SelectionParagraphFormat.prototype, "BeforeSpacing", {
            get: function () {
                return this.beforeSpacing;
            },
            set: function (value) {
                if (value == this.beforeSpacing)
                    return;
                this.beforeSpacing = value;
                this._NotifyPropertyChanged("BeforeSpacing");
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(SelectionParagraphFormat.prototype, "LineSpacing", {
            get: function () {
                return this.lineSpacing;
            },
            set: function (value) {
                if (value == this.lineSpacing)
                    return;
                this.lineSpacing = value;
                this._NotifyPropertyChanged("LineSpacing");
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(SelectionParagraphFormat.prototype, "LineSpacingType", {
            get: function () {
                return this.lineSpacingType;
            },
            set: function (value) {
                if (value == this.lineSpacingType)
                    return;
                this.lineSpacingType = value;
                this._NotifyPropertyChanged("LineSpacingType");
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(SelectionParagraphFormat.prototype, "ListLevelNumber", {
            get: function () {
                return this.listLevelNumber;
            },
            set: function (value) {
                if (value == this.listLevelNumber)
                    return;
                this.listLevelNumber = value;
                this._NotifyPropertyChanged("ListLevelNumber");
            },
            enumerable: true,
            configurable: true
        });
        SelectionParagraphFormat.prototype._NotifyPropertyChanged = function (propertyName) {
            if (this.selection != null && (!this.selection.OwnerControl.IsDocumentLoaded) && !this.selection.IsRetrieveFormatting)
                return;
            if (this.selection != null && this.selection.Start != null && !this.selection.IsRetrieveFormatting) {
                switch (propertyName) {
                    case "LeftIndent":
                        if (this.leftIndent >= -1056 && this.leftIndent < 1056)
                            this.selection._OnLeftIndent(this.leftIndent);
                        break;
                    case "RightIndent":
                        if (this.rightIndent >= -1056 && this.rightIndent < 1056)
                            this.selection._OnRightIndent(this.rightIndent);
                        break;
                    case "FirstLineIndent":
                        if (this.firstLineIndent >= -1056 && this.firstLineIndent < 1056)
                            this.selection._OnFirstLineIndent(this.firstLineIndent);
                        break;
                    case "BeforeSpacing":
                        this.selection._OnBeforeSpacing(this.beforeSpacing);
                        break;
                    case "AfterSpacing":
                        this.selection._OnAfterSpacing(this.afterSpacing);
                        break;
                    case "TextAlignment":
                        this.selection._OnTextAlignment(this.textAlignment);
                        break;
                    case "LineSpacing":
                        this.selection._OnLineSpacing(this.lineSpacing);
                        break;
                    case "LineSpacingType":
                        if (this.lineSpacingType)
                            this.selection._OnLineSpacingType(this.lineSpacingType);
                        break;
                    case "ListLevelNumber":
                        if (this.list != null)
                            this.selection._OnApplyList(this.list, this.listLevelNumber);
                        break;
                }
            }
        };
        SelectionParagraphFormat.prototype._IsEqualFormat = function (format) {
            return (this.LeftIndent == format.LeftIndent
                && this.RightIndent == format.RightIndent
                && this.FirstLineIndent == format.FirstLineIndent
                && this.AfterSpacing == format.AfterSpacing
                && this.BeforeSpacing == format.BeforeSpacing
                && this.LineSpacing == format.LineSpacing
                && this.LineSpacingType == format.LineSpacingType
                && this.TextAlignment == format.TextAlignment);
        };
        SelectionParagraphFormat.prototype._CloneFormat = function (selectionParagraphFormat) {
            this.LeftIndent = selectionParagraphFormat.LeftIndent;
            this.RightIndent = selectionParagraphFormat.RightIndent;
            this.FirstLineIndent = selectionParagraphFormat.FirstLineIndent;
            this.AfterSpacing = selectionParagraphFormat.AfterSpacing;
            this.BeforeSpacing = selectionParagraphFormat.BeforeSpacing;
            this.LineSpacing = selectionParagraphFormat.LineSpacing;
            this.LineSpacingType = selectionParagraphFormat.LineSpacingType;
            this.TextAlignment = selectionParagraphFormat.TextAlignment;
            this.ListLevelNumber = selectionParagraphFormat.ListLevelNumber;
        };
        SelectionParagraphFormat.prototype._CopyFormat = function (format) {
            this.LeftIndent = format.LeftIndent;
            this.RightIndent = format.RightIndent;
            this.FirstLineIndent = format.FirstLineIndent;
            this.AfterSpacing = format.AfterSpacing;
            this.BeforeSpacing = format.BeforeSpacing;
            this.LineSpacing = format.LineSpacing;
            this.LineSpacingType = format.LineSpacingType;
            this.TextAlignment = format.TextAlignment;
            if (format.ListFormat != null && format.ListFormat.List != null) {
                this.list = format.ListFormat.List;
                this.listLevelNumber = format.ListFormat.ListLevelNumber;
            }
            else {
                this.list = null;
                this.listLevelNumber = 0;
            }
        };
        SelectionParagraphFormat.prototype._CombineFormat = function (format) {
            if (!isNaN(this.LeftIndent) && this.LeftIndent != format.LeftIndent)
                this.LeftIndent = Number.NaN;
            if (!isNaN(this.RightIndent) && this.RightIndent != format.RightIndent)
                this.RightIndent = Number.NaN;
            if (!isNaN(this.FirstLineIndent) && this.FirstLineIndent != format.FirstLineIndent)
                this.FirstLineIndent = Number.NaN;
            if (this.LineSpacing != 0 && this.LineSpacing != format.LineSpacing)
                this.LineSpacing = 0;
            if (this.BeforeSpacing != -1 && this.BeforeSpacing != format.BeforeSpacing)
                this.BeforeSpacing = -1;
            if (this.AfterSpacing != -1 && this.AfterSpacing != format.AfterSpacing)
                this.AfterSpacing = -1;
            if (this.LineSpacingType != null && this.LineSpacingType != format.LineSpacingType)
                this.LineSpacingType = null;
            if (this.TextAlignment != null && this.TextAlignment != format.TextAlignment)
                this.TextAlignment = null;
            if (this.ListLevelNumber >= 0 && this.list != null && (format.ListFormat == null || format.ListFormat.ListLevelNumber != this.ListLevelNumber))
                this.ListLevelNumber = -1;
            if (format.ListFormat == null || format.ListFormat.List == null || (this.list != null && this.list != format.ListFormat.List))
                this.list = null;
        };
        SelectionParagraphFormat.prototype._CopyToFormat = function (format) {
            if (!isNaN(this.LeftIndent))
                format.LeftIndent = this.LeftIndent;
            if (!isNaN(this.RightIndent))
                format.RightIndent = this.RightIndent;
            if (!isNaN(this.FirstLineIndent))
                format.FirstLineIndent = this.FirstLineIndent;
            if (this.AfterSpacing >= 0)
                format.AfterSpacing = this.AfterSpacing;
            if (this.BeforeSpacing >= 0)
                format.BeforeSpacing = this.BeforeSpacing;
            if (this.LineSpacingType != null)
                format.LineSpacingType = this.LineSpacingType;
            if (this.LineSpacing > 0)
                format.LineSpacing = this.LineSpacing;
            if (this.TextAlignment != null)
                format.TextAlignment = this.TextAlignment;
        };
        SelectionParagraphFormat.prototype._ClearFormat = function () {
            this.leftIndent = 0;
            this.rightIndent = 0;
            this.beforeSpacing = 0;
            this.afterSpacing = 0;
            this.firstLineIndent = 0;
            this.lineSpacing = 1;
            this.textAlignment = null;
            this.lineSpacingType = null;
            this.list = null;
            this.listLevelNumber = -1;
        };
        SelectionParagraphFormat.prototype._SetList = function (listAdv) {
            if (this.list != null && listAdv != null && listAdv.AbstractList != null && listAdv.SourceListId == this.list.ListId) {
                var listLevel = this.list._GetListLevel(1);
                this.selection.OwnerControl.IsLayoutEnabled = false;
                this.selection.CurrentBaseHistoryInfo = new BaseHistoryInfo(this.selection.OwnerControl);
                this.selection.CurrentBaseHistoryInfo.Action = Actions.List;
                this.selection.CurrentBaseHistoryInfo._UpdateSelection(this.selection);
                var collection = new ModifiedLevelCollection();
                for (var i = 0; i < listAdv.AbstractList.Levels.Count; i++) {
                    var value = this.selection.CurrentBaseHistoryInfo._AddModifiedPropertiesForList(this.list.AbstractList.Levels[i]);
                    var modifiedLevel = new ModifiedLevel((this.list.AbstractList.Levels[i]), (listAdv.AbstractList.Levels[i]));
                    this.list.AbstractList.Levels[i]._CopyLevel(listAdv.AbstractList.Levels[i]);
                    collection.ModifiedLevels._Add(i, modifiedLevel);
                }
                this.selection.OwnerControl.Document._UpdateListParagraphs();
                this.selection.OwnerControl.Document._ApplyListChanges(this.selection.CurrentBaseHistoryInfo, collection);
                this.selection.OwnerControl.IsLayoutEnabled = true;
                this.selection.OwnerControl.Document._LayoutItems(this.selection.OwnerControl.Viewer);
                this.selection._UpdateSelectionTextPosition(false);
            }
            else if (listAdv != null) {
                var document_9 = this.selection.OwnerControl.Document;
                if (document_9 == null)
                    return;
                this.selection.OwnerControl.IsLayoutEnabled = false;
                if (listAdv.AbstractList != null && !document_9.AbstractLists._Contains(listAdv.AbstractList))
                    document_9.AbstractLists._Add(listAdv.AbstractList);
                if (!document_9.Lists._Contains(listAdv))
                    document_9.Lists._Add(listAdv);
                listAdv.AbstractList._SetOwner(document_9);
                listAdv._SetOwner(document_9);
                listAdv.AbstractListId = listAdv.AbstractList.AbstractListId;
                this.selection.OwnerControl.IsLayoutEnabled = true;
                this.selection._OnApplyListInternal(listAdv);
            }
            else
                this.selection._OnApplyListInternal(null);
        };
        SelectionParagraphFormat.prototype._GetList = function () {
            if (this.list != null) {
                var listAdv = new ListAdv(null);
                var abstractList = new AbstractListAdv(null);
                if (this.list.AbstractList != null) {
                    for (var i = 0; i < this.list.AbstractList.Levels.Count; i++) {
                        var level = this.list.AbstractList.Levels[i]._Clone();
                        abstractList.Levels._Add(level);
                    }
                }
                else
                    abstractList.AddListLevel();
                if (this.list.LevelOverrides != null) {
                    for (var i = 0; i < this.list.LevelOverrides.Count; i++) {
                        var levelOverride = this.list.LevelOverrides[i]._Clone();
                        listAdv.LevelOverrides._Add(levelOverride);
                    }
                }
                listAdv.AbstractList = abstractList;
                listAdv.ListId = this.list.ListId;
                listAdv.SourceListId = this.list.ListId;
                return listAdv;
            }
        };
        SelectionParagraphFormat.prototype._Dispose = function () {
            this.selection = null;
            this.textAlignment = null;
            this.lineSpacingType = null;
            this.list = null;
        };
        return SelectionParagraphFormat;
    }());
    DocumentEditorFeatures.SelectionParagraphFormat = SelectionParagraphFormat;
    var SelectionSectionFormat = (function () {
        function SelectionSectionFormat(selection) {
            this.differentFirstPage = null;
            this.differentOddAndEvenPages = null;
            this.selection = selection;
        }
        Object.defineProperty(SelectionSectionFormat.prototype, "PageHeight", {
            get: function () {
                return this.pageHeight;
            },
            set: function (value) {
                this.pageHeight = value;
                this._NotifyPropertyChanged("PageSize");
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(SelectionSectionFormat.prototype, "PageWidth", {
            get: function () {
                return this.pageWidth;
            },
            set: function (value) {
                this.pageWidth = value;
                this._NotifyPropertyChanged("PageSize");
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(SelectionSectionFormat.prototype, "LeftMargin", {
            get: function () {
                return this.leftMargin;
            },
            set: function (value) {
                this.leftMargin = value;
                this._NotifyPropertyChanged("PageMargin");
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(SelectionSectionFormat.prototype, "RightMargin", {
            get: function () {
                return this.rightMargin;
            },
            set: function (value) {
                this.rightMargin = value;
                this._NotifyPropertyChanged("PageMargin");
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(SelectionSectionFormat.prototype, "TopMargin", {
            get: function () {
                return this.topMargin;
            },
            set: function (value) {
                this.topMargin = value;
                this._NotifyPropertyChanged("PageMargin");
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(SelectionSectionFormat.prototype, "BottomMargin", {
            get: function () {
                return this.bottomMargin;
            },
            set: function (value) {
                this.bottomMargin = value;
                this._NotifyPropertyChanged("PageMargin");
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(SelectionSectionFormat.prototype, "HeaderDistance", {
            get: function () {
                return this.headerDistance;
            },
            set: function (value) {
                this.headerDistance = value;
                this._NotifyPropertyChanged("HeaderDistance");
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(SelectionSectionFormat.prototype, "FooterDistance", {
            get: function () {
                return this.footerDistance;
            },
            set: function (value) {
                this.footerDistance = value;
                this._NotifyPropertyChanged("FooterDistance");
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(SelectionSectionFormat.prototype, "DifferentFirstPage", {
            get: function () {
                return this.differentFirstPage;
            },
            set: function (value) {
                this.differentFirstPage = value;
                this._NotifyPropertyChanged("DifferentFirstPage");
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(SelectionSectionFormat.prototype, "DifferentOddAndEvenPages", {
            get: function () {
                return this.differentOddAndEvenPages;
            },
            set: function (value) {
                this.differentOddAndEvenPages = value;
                this._NotifyPropertyChanged("DifferentOddAndEvenPages");
            },
            enumerable: true,
            configurable: true
        });
        SelectionSectionFormat.prototype._NotifyPropertyChanged = function (propertyName) {
            if (this.selection != null && (this.selection.IsCleared || !this.selection.OwnerControl.IsDocumentLoaded) && !this.selection.IsRetrieveFormatting)
                return;
            if (this.selection != null && this.selection.Start != null && !this.selection.IsRetrieveFormatting) {
                switch (propertyName) {
                    case "PageSize":
                        if (this.PageHeight > 0 && this.PageWidth > 0) {
                            var size = new Size(this.PageHeight, this.PageWidth);
                            this.selection._OnPageSizeChanged(size);
                        }
                        break;
                    case "PageMargin":
                        if (this.LeftMargin >= 0 && this.RightMargin >= 0 && this.TopMargin >= 0 && this.BottomMargin >= 0) {
                            var pagemargin = new Thickness(this.LeftMargin, this.RightMargin, this.TopMargin, this.BottomMargin);
                            this.selection._OnPageMarginChanged(pagemargin);
                            break;
                        }
                }
            }
        };
        SelectionSectionFormat.prototype._CopyFormat = function (format) {
            this.PageHeight = format.PageHeight;
            this.PageWidth = format.PageWidth;
            this.LeftMargin = format.LeftMargin;
            this.TopMargin = format.TopMargin;
            this.RightMargin = format.RightMargin;
            this.BottomMargin = format.BottomMargin;
            this.HeaderDistance = format.HeaderDistance;
            this.FooterDistance = format.FooterDistance;
            this.DifferentFirstPage = format.DifferentFirstPage;
            this.DifferentOddAndEvenPages = format.DifferentOddAndEvenPages;
        };
        SelectionSectionFormat.prototype._CombineFormat = function (format) {
            if (this.PageHeight > 0 && this.PageHeight != format.PageHeight)
                this.pageHeight = 0;
            if (this.PageWidth > 0 && this.PageWidth != format.PageWidth)
                this.pageWidth = 0;
            if (this.LeftMargin > -1 && this.LeftMargin != format.LeftMargin)
                this.LeftMargin - 1;
            if (this.TopMargin > -1 && this.TopMargin != format.TopMargin)
                this.TopMargin = -1;
            if (this.RightMargin > -1 && this.RightMargin != format.RightMargin)
                this.RightMargin = -1;
            if (this.BottomMargin > -1 && this.BottomMargin != format.BottomMargin)
                this.BottomMargin = -1;
            if (this.HeaderDistance != 0 && this.HeaderDistance != format.HeaderDistance)
                this.HeaderDistance = 0;
            if (this.FooterDistance != 0 && this.FooterDistance != format.FooterDistance)
                this.FooterDistance = 0;
            if (this.DifferentFirstPage != null && this.DifferentFirstPage != format.DifferentFirstPage)
                this.DifferentFirstPage = null;
            if (this.DifferentOddAndEvenPages != null && this.DifferentOddAndEvenPages != format.DifferentOddAndEvenPages)
                this.DifferentOddAndEvenPages = null;
        };
        SelectionSectionFormat.prototype._ClearFormat = function () {
            this.headerDistance = 0;
            this.footerDistance = 0;
            this.pageHeight = 0;
            this.pageWidth = 0;
            this.leftMargin = -1;
            this.rightMargin = -1;
            this.topMargin = -1;
            this.bottomMargin = -1;
            this.differentFirstPage = null;
            this.differentOddAndEvenPages = null;
        };
        SelectionSectionFormat.prototype._Dispose = function () {
            this.selection = null;
            this.differentFirstPage = null;
            this.differentOddAndEvenPages = null;
        };
        return SelectionSectionFormat;
    }());
    DocumentEditorFeatures.SelectionSectionFormat = SelectionSectionFormat;
    var SelectionTableFormat = (function () {
        function SelectionTableFormat(selection) {
            this.leftIndent = 0;
            this.background = null;
            this.tableAlignment = null;
            this.cellSpacing = 0;
            this.leftMargin = 0;
            this.rightMargin = 0;
            this.topMargin = 0;
            this.bottomMargin = 0;
            this.preferredWidth = 0;
            this.selection = selection;
        }
        Object.defineProperty(SelectionTableFormat.prototype, "Table", {
            get: function () {
                return this.table;
            },
            set: function (value) {
                this.table = value;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(SelectionTableFormat.prototype, "LeftIndent", {
            get: function () {
                return this.leftIndent;
            },
            set: function (value) {
                if (value == this.leftIndent)
                    return;
                this.leftIndent = value;
                this._NotifyPropertyChanged("LeftIndent");
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(SelectionTableFormat.prototype, "Background", {
            get: function () {
                return this.background;
            },
            set: function (value) {
                if (value == this.background)
                    return;
                this.background = value;
                this._NotifyPropertyChanged("Background");
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(SelectionTableFormat.prototype, "TableAlignment", {
            get: function () {
                return this.tableAlignment;
            },
            set: function (value) {
                if (value == this.tableAlignment)
                    return;
                this.tableAlignment = value;
                this._NotifyPropertyChanged("TableAlignment");
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(SelectionTableFormat.prototype, "CellSpacing", {
            get: function () {
                return this.cellSpacing;
            },
            set: function (value) {
                if (value == this.cellSpacing)
                    return;
                this.cellSpacing = value;
                this._NotifyPropertyChanged("CellSpacing");
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(SelectionTableFormat.prototype, "LeftMargin", {
            get: function () {
                return this.leftMargin;
            },
            set: function (value) {
                if (value == this.leftMargin)
                    return;
                this.leftMargin = value;
                this._NotifyPropertyChanged("LeftMargin");
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(SelectionTableFormat.prototype, "RightMargin", {
            get: function () {
                return this.rightMargin;
            },
            set: function (value) {
                if (value == this.rightMargin)
                    return;
                this.rightMargin = value;
                this._NotifyPropertyChanged("RightMargin");
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(SelectionTableFormat.prototype, "TopMargin", {
            get: function () {
                return this.topMargin;
            },
            set: function (value) {
                if (value == this.topMargin)
                    return;
                this.topMargin = value;
                this._NotifyPropertyChanged("TopMargin");
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(SelectionTableFormat.prototype, "BottomMargin", {
            get: function () {
                return this.bottomMargin;
            },
            set: function (value) {
                if (value == this.bottomMargin)
                    return;
                this.bottomMargin = value;
                this._NotifyPropertyChanged("BottomMargin");
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(SelectionTableFormat.prototype, "PreferredWidth", {
            get: function () {
                return this.preferredWidth;
            },
            set: function (value) {
                if (value == this.preferredWidth)
                    return;
                this.preferredWidth = value;
                this._NotifyPropertyChanged("PreferredWidth");
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(SelectionTableFormat.prototype, "PreferredWidthType", {
            get: function () {
                return this.preferredWidthType;
            },
            set: function (value) {
                if (value == this.preferredWidthType)
                    return;
                this.preferredWidthType = value;
                this._NotifyPropertyChanged("PreferredWidthType");
            },
            enumerable: true,
            configurable: true
        });
        SelectionTableFormat.prototype._NotifyPropertyChanged = function (propertyName) {
            if (this.selection != null && (this.selection.IsCleared || this.selection.OwnerControl.IsReadOnlyMode || !this.selection.OwnerControl.IsDocumentLoaded) && !this.selection.IsRetrieveFormatting)
                return;
            if (this.selection != null && this.selection.Start != null && !this.selection.IsRetrieveFormatting) {
                switch (propertyName) {
                    case "TableAlignment":
                        this.selection._OnTableAlignment(this.tableAlignment);
                        break;
                    case "LeftIndent":
                        this.selection._OnTableLeftIndent(this.leftIndent);
                        break;
                    case "CellSpacing":
                        this.selection._OnCellSpacing(this.cellSpacing);
                        break;
                    case "LeftMargin":
                        this.selection._OnDefaultCellLeftMargin(this.leftMargin);
                        break;
                    case "RightMargin":
                        this.selection._OnDefaultCellRightMargin(this.rightMargin);
                        break;
                    case "TopMargin":
                        this.selection._OnDefaultCellTopMargin(this.topMargin);
                        break;
                    case "BottomMargin":
                        this.selection._OnDefaultCellBottomMargin(this.bottomMargin);
                        break;
                }
            }
        };
        SelectionTableFormat.prototype._CopyFormat = function (format) {
            this.LeftIndent = format.LeftIndent;
            this.Background = format.Shading.BackgroundColor;
            this.TableAlignment = format.TableAlignment;
            this.LeftMargin = format.LeftMargin;
            this.RightMargin = format.RightMargin;
            this.TopMargin = format.TopMargin;
            this.bottomMargin = format.BottomMargin;
            this.CellSpacing = format.CellSpacing;
        };
        SelectionTableFormat.prototype._ClearFormat = function () {
            this.Table = null;
            this.leftIndent = 0;
            this.background = null;
            this.leftIndent = 0;
            this.leftMargin = 0;
            this.rightMargin = 0;
            this.topMargin = 0;
            this.bottomMargin = 0;
            this.cellSpacing = 0;
            this.tableAlignment = null;
        };
        SelectionTableFormat.prototype._Dispose = function () {
            this.selection = null;
            this.table = null;
            this.background = null;
            this.tableAlignment = null;
        };
        return SelectionTableFormat;
    }());
    DocumentEditorFeatures.SelectionTableFormat = SelectionTableFormat;
    var SelectionCellFormat = (function () {
        function SelectionCellFormat(selection) {
            this.verticalAlignment = null;
            this.leftMargin = 0;
            this.rightMargin = 0;
            this.topMargin = 0;
            this.bottomMargin = 0;
            this.background = null;
            this.preferredWidthType = null;
            this.selection = selection;
        }
        Object.defineProperty(SelectionCellFormat.prototype, "VerticalAlignment", {
            get: function () {
                return this.verticalAlignment;
            },
            set: function (value) {
                if (value == this.verticalAlignment)
                    return;
                this.verticalAlignment = value;
                this._NotifyPropertyChanged("VerticalAlignment");
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(SelectionCellFormat.prototype, "LeftMargin", {
            get: function () {
                return this.leftMargin;
            },
            set: function (value) {
                if (value == this.leftMargin)
                    return;
                this.leftMargin = value;
                this._NotifyPropertyChanged("LeftMargin");
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(SelectionCellFormat.prototype, "RightMargin", {
            get: function () {
                return this.rightMargin;
            },
            set: function (value) {
                if (value == this.rightMargin)
                    return;
                this.rightMargin = value;
                this._NotifyPropertyChanged("RightMargin");
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(SelectionCellFormat.prototype, "TopMargin", {
            get: function () {
                return this.topMargin;
            },
            set: function (value) {
                if (value == this.topMargin)
                    return;
                this.topMargin = value;
                this._NotifyPropertyChanged("TopMargin");
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(SelectionCellFormat.prototype, "BottomMargin", {
            get: function () {
                return this.bottomMargin;
            },
            set: function (value) {
                if (value == this.bottomMargin)
                    return;
                this.bottomMargin = value;
                this._NotifyPropertyChanged("BottomMargin");
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(SelectionCellFormat.prototype, "Background", {
            get: function () {
                return this.background;
            },
            set: function (value) {
                if (value == this.background)
                    return;
                this.background = value;
                this._NotifyPropertyChanged("Background");
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(SelectionCellFormat.prototype, "PreferredWidth", {
            get: function () {
                return this.preferredWidth;
            },
            set: function (value) {
                if (value == this.preferredWidth)
                    return;
                this.preferredWidth = value;
                this._NotifyPropertyChanged("PreferredWidth");
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(SelectionCellFormat.prototype, "PreferredWidthType", {
            get: function () {
                return this.preferredWidthType;
            },
            set: function (value) {
                if (value == this.preferredWidthType)
                    return;
                this.preferredWidthType = value;
                this._NotifyPropertyChanged("PreferredWidthType");
            },
            enumerable: true,
            configurable: true
        });
        SelectionCellFormat.prototype._NotifyPropertyChanged = function (propertyName) {
            if (this.selection != null && (this.selection.IsCleared || this.selection.OwnerControl.IsReadOnlyMode || !this.selection.OwnerControl.IsDocumentLoaded) && !this.selection.IsRetrieveFormatting)
                return;
            if (this.selection != null && this.selection.Start != null && !this.selection.IsRetrieveFormatting) {
                switch (propertyName) {
                    case "VerticalAlignment":
                        this.selection._OnCellContentVerticalAlignment(this.verticalAlignment);
                        break;
                    case "LeftMargin":
                        this.selection._OnCellLeftMargin(this.leftMargin);
                        break;
                    case "RightMargin":
                        this.selection._OnCellRightMargin(this.rightMargin);
                        break;
                    case "TopMargin":
                        this.selection._OnCellTopMargin(this.topMargin);
                        break;
                    case "BottomMargin":
                        this.selection._OnCellBottomMargin(this.bottomMargin);
                        break;
                }
            }
        };
        SelectionCellFormat.prototype._CopyFormat = function (format) {
            this.LeftMargin = format.LeftMargin;
            this.RightMargin = format.RightMargin;
            this.TopMargin = format.TopMargin;
            this.BottomMargin = format.BottomMargin;
            this.Background = format.Shading.BackgroundColor;
            this.VerticalAlignment = format.VerticalAlignment;
        };
        SelectionCellFormat.prototype._ClearCellFormat = function () {
            this.LeftMargin = Number.NaN;
            this.RightMargin = Number.NaN;
            this.TopMargin = Number.NaN;
            this.BottomMargin = Number.NaN;
            this.Background = null;
            this.VerticalAlignment = null;
        };
        SelectionCellFormat.prototype._CombineFormat = function (format) {
            if (!isNaN(this.LeftMargin) && this.LeftMargin != format.LeftMargin)
                this.LeftMargin = Number.NaN;
            if (!isNaN(this.TopMargin) && this.TopMargin != format.TopMargin)
                this.TopMargin = Number.NaN;
            if (!isNaN(this.RightMargin) && this.RightMargin != format.RightMargin)
                this.RightMargin = Number.NaN;
            if (!isNaN(this.BottomMargin) && this.BottomMargin != format.BottomMargin)
                this.BottomMargin = Number.NaN;
            if (this.Background != null && this.Background != format.Shading.BackgroundColor)
                this.Background = null;
            if (this.VerticalAlignment != null && this.VerticalAlignment != format.VerticalAlignment)
                this.VerticalAlignment = null;
        };
        SelectionCellFormat.prototype._ClearFormat = function () {
            this.background = null;
            this.bottomMargin = 0;
            this.leftMargin = 0;
            this.rightMargin = 0;
            this.topMargin = 0;
            this.verticalAlignment = null;
        };
        SelectionCellFormat.prototype._Dispose = function () {
            this.selection = null;
            this.background = null;
            this.verticalAlignment = null;
        };
        return SelectionCellFormat;
    }());
    DocumentEditorFeatures.SelectionCellFormat = SelectionCellFormat;
    var SelectionRowFormat = (function () {
        function SelectionRowFormat(selection) {
            this.isHeader = null;
            this.allowRowBreakAcrossPages = null;
            this.selection = selection;
        }
        Object.defineProperty(SelectionRowFormat.prototype, "Height", {
            get: function () {
                return this.height;
            },
            set: function (value) {
                if (value == this.height)
                    return;
                this.height = value;
                this._NotifyPropertyChanged("Height");
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(SelectionRowFormat.prototype, "HeightType", {
            get: function () {
                return this.heightType;
            },
            set: function (value) {
                if (value == this.heightType)
                    return;
                this.heightType = value;
                this._NotifyPropertyChanged("HeightType");
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(SelectionRowFormat.prototype, "IsHeader", {
            get: function () {
                return this.isHeader;
            },
            set: function (value) {
                if (value == this.isHeader)
                    return;
                this.isHeader = value;
                this._NotifyPropertyChanged("IsHeader");
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(SelectionRowFormat.prototype, "AllowBreakAcrossPages", {
            get: function () {
                return this.allowRowBreakAcrossPages;
            },
            set: function (value) {
                if (value == this.allowRowBreakAcrossPages)
                    return;
                this.allowRowBreakAcrossPages = value;
                this._NotifyPropertyChanged("AllowBreakAcrossPages");
            },
            enumerable: true,
            configurable: true
        });
        SelectionRowFormat.prototype._NotifyPropertyChanged = function (propertyName) {
            if (this.selection != null && (this.selection.IsCleared || this.selection.OwnerControl.IsReadOnlyMode || !this.selection.OwnerControl.IsDocumentLoaded) && !this.selection.IsRetrieveFormatting)
                return;
            if (this.selection != null && this.selection.Start != null && !this.selection.IsRetrieveFormatting) {
                switch (propertyName) {
                    case "Height":
                        this.selection._OnRowHeight(this.height);
                        break;
                    case "HeightType":
                        this.selection._OnRowHeightType(this.heightType);
                        break;
                    case "IsHeader":
                        this.selection._OnHeader(this.isHeader);
                        break;
                    case "AllowBreakAcrossPages":
                        this.selection._OnAllowBreakAcrossPages(this.allowRowBreakAcrossPages);
                        break;
                }
            }
        };
        SelectionRowFormat.prototype._CopyFormat = function (format) {
            this.Height = format.Height;
            this.HeightType = format.HeightType;
            this.AllowBreakAcrossPages = format.AllowBreakAcrossPages;
            this.IsHeader = format.IsHeader;
        };
        SelectionRowFormat.prototype._CombineFormat = function (format) {
            if (!isNaN(this.Height) && this.Height != format.Height)
                this.Height = Number.NaN;
            if (this.HeightType != null && this.HeightType != format.HeightType)
                this.HeightType = null;
            if (this.AllowBreakAcrossPages != null && this.AllowBreakAcrossPages != format.AllowBreakAcrossPages)
                this.AllowBreakAcrossPages = null;
            if (this.IsHeader != null && this.IsHeader != format.IsHeader)
                this.IsHeader = null;
        };
        SelectionRowFormat.prototype._ClearRowFormat = function () {
            this.Height = Number.NaN;
            this.HeightType = null;
            this.AllowBreakAcrossPages = null;
            this.IsHeader = null;
        };
        SelectionRowFormat.prototype._ClearFormat = function () {
            this.height = 0;
            this.heightType = null;
            this.allowRowBreakAcrossPages = null;
            this.isHeader = null;
        };
        SelectionRowFormat.prototype._Dispose = function () {
            this.selection = null;
            this.heightType = null;
            this.allowRowBreakAcrossPages = null;
            this.isHeader = null;
        };
        return SelectionRowFormat;
    }());
    DocumentEditorFeatures.SelectionRowFormat = SelectionRowFormat;
    var SelectionWidgetInfo = (function () {
        function SelectionWidgetInfo(left, width) {
            this.left = 0;
            this.width = 0;
            this.left = left;
            this.width = width;
        }
        Object.defineProperty(SelectionWidgetInfo.prototype, "Left", {
            get: function () {
                return this.left;
            },
            set: function (value) {
                this.left = value;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(SelectionWidgetInfo.prototype, "Width", {
            get: function () {
                return this.width;
            },
            set: function (value) {
                this.width = value;
            },
            enumerable: true,
            configurable: true
        });
        return SelectionWidgetInfo;
    }());
    DocumentEditorFeatures.SelectionWidgetInfo = SelectionWidgetInfo;
    var SearchWidgetInfo = (function () {
        function SearchWidgetInfo(left, width) {
            this.left = 0;
            this.width = 0;
            this.left = left;
            this.width = width;
        }
        Object.defineProperty(SearchWidgetInfo.prototype, "Left", {
            get: function () {
                return this.left;
            },
            set: function (value) {
                this.left = value;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(SearchWidgetInfo.prototype, "Width", {
            get: function () {
                return this.width;
            },
            set: function (value) {
                this.width = value;
            },
            enumerable: true,
            configurable: true
        });
        return SearchWidgetInfo;
    }());
    DocumentEditorFeatures.SearchWidgetInfo = SearchWidgetInfo;
    var SelectedImageInfo = (function () {
        function SelectedImageInfo(height, width) {
            this.height = 0;
            this.width = 0;
            this.height = height;
            this.width = width;
        }
        Object.defineProperty(SelectedImageInfo.prototype, "Height", {
            get: function () {
                return this.height;
            },
            set: function (value) {
                this.height = value;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(SelectedImageInfo.prototype, "Width", {
            get: function () {
                return this.width;
            },
            set: function (value) {
                this.width = value;
            },
            enumerable: true,
            configurable: true
        });
        return SelectedImageInfo;
    }());
    DocumentEditorFeatures.SelectedImageInfo = SelectedImageInfo;
    var ImageResizer = (function () {
        function ImageResizer(node) {
            this.baseHistoryInfo = null;
            this.resizeContainerDiv = null;
            this.topLeftRect = null;
            this.topMiddleRect = null;
            this.topRightRect = null;
            this.bottomLeftRect = null;
            this.bottomMiddleRect = null;
            this.bottomRightRect = null;
            this.leftMiddleRect = null;
            this.rightMiddleRect = null;
            this.resizeMarkSize = 7;
            this.SelectedImageWidget = null;
            this.ownerControl = node;
            this.SelectedImageWidget = new Dictionary();
        }
        Object.defineProperty(ImageResizer.prototype, "CurrentImageElementBox", {
            get: function () {
                return this.currentImageElementBox;
            },
            set: function (value) {
                this.currentImageElementBox = value;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(ImageResizer.prototype, "ResizeMarkSize", {
            get: function () {
                return this.resizeMarkSize;
            },
            set: function (value) {
                this.resizeMarkSize = value;
            },
            enumerable: true,
            configurable: true
        });
        ImageResizer.prototype._InitResizeMarks = function (ResizeDiv) {
            this._InitResizeContainerDiv();
            ResizeDiv.appendChild(this.resizeContainerDiv);
            this.topRightRect = document.createElement("div");
            this.topRightRect.id = this.ownerControl.ContainerId + "_TopRightRect";
            this.topRightRect.style.cursor = "ne-resize";
            this._applyProperties(this.topRightRect);
            ResizeDiv.appendChild(this.topRightRect);
            this.topLeftRect = document.createElement("div");
            this.topLeftRect.id = this.ownerControl.ContainerId + "_TopLeftRect";
            this.topLeftRect.style.cursor = "nw-resize";
            this._applyProperties(this.topLeftRect);
            ResizeDiv.appendChild(this.topLeftRect);
            this.topMiddleRect = document.createElement("div");
            this.topMiddleRect.id = this.ownerControl.ContainerId + "_TopMiddleRect";
            this.topMiddleRect.style.cursor = "n-resize";
            this._applyProperties(this.topMiddleRect);
            ResizeDiv.appendChild(this.topMiddleRect);
            this.bottomRightRect = document.createElement("div");
            this.bottomRightRect.id = this.ownerControl.ContainerId + "_BottomRightRect";
            this.bottomRightRect.style.cursor = "se-resize";
            this._applyProperties(this.bottomRightRect);
            ResizeDiv.appendChild(this.bottomRightRect);
            this.bottomLeftRect = document.createElement("div");
            this.bottomLeftRect.id = this.ownerControl.ContainerId + "_BottomLeftRect";
            this.bottomLeftRect.style.cursor = "sw-resize";
            this._applyProperties(this.bottomLeftRect);
            ResizeDiv.appendChild(this.bottomLeftRect);
            this.bottomMiddleRect = document.createElement("div");
            this.bottomMiddleRect.id = this.ownerControl.ContainerId + "_BottomMiddleRect";
            this.bottomMiddleRect.style.cursor = "s-resize";
            this._applyProperties(this.bottomMiddleRect);
            ResizeDiv.appendChild(this.bottomMiddleRect);
            this.rightMiddleRect = document.createElement("div");
            this.rightMiddleRect.id = this.ownerControl.ContainerId + "_RightMiddleRect";
            this.rightMiddleRect.style.cursor = "e-resize";
            this._applyProperties(this.rightMiddleRect);
            ResizeDiv.appendChild(this.rightMiddleRect);
            this.leftMiddleRect = document.createElement("div");
            this.leftMiddleRect.id = this.ownerControl.ContainerId + "_LeftMiddleRect";
            this.leftMiddleRect.style.cursor = "w-resize";
            this._applyProperties(this.leftMiddleRect);
            ResizeDiv.appendChild(this.leftMiddleRect);
            return this.resizeContainerDiv;
        };
        ImageResizer.prototype._SetImageResizerPosition = function (left, top, width, height) {
            this.resizeContainerDiv.style.width = width + "px";
            this.resizeContainerDiv.style.height = height + "px";
            this.resizeContainerDiv.style.left = left + "px";
            this.resizeContainerDiv.style.top = top + "px";
            this.topRightRect.style.left = ((left + width) - 3) + "px";
            this.topRightRect.style.top = (top - 3) + "px";
            this.topLeftRect.style.left = (left - 3) + "px";
            this.topLeftRect.style.top = (top - 3) + "px";
            this.topMiddleRect.style.left = ((parseFloat(this.topLeftRect.style.left) + (width / 2)) - 3) + "px";
            this.topMiddleRect.style.top = (top - 3) + "px";
            this.bottomRightRect.style.left = this.topRightRect.style.left;
            this.bottomRightRect.style.top = (parseFloat(this.topRightRect.style.top) + height) + "px";
            this.bottomLeftRect.style.left = this.topLeftRect.style.left;
            this.bottomLeftRect.style.top = (parseFloat(this.topLeftRect.style.top) + height) + "px";
            this.bottomMiddleRect.style.left = this.topMiddleRect.style.left;
            this.bottomMiddleRect.style.top = (parseFloat(this.topMiddleRect.style.top) + height) + "px";
            this.rightMiddleRect.style.left = this.topRightRect.style.left;
            this.rightMiddleRect.style.top = (parseFloat(this.topRightRect.style.top) + (height / 2)) + "px";
            this.leftMiddleRect.style.left = this.topLeftRect.style.left;
            this.leftMiddleRect.style.top = (parseFloat(this.topLeftRect.style.top) + (height / 2)) + "px";
            this._setImageResizingPoints();
        };
        ImageResizer.prototype._setImageResizingPoints = function () {
            this.ownerControl.ImageResizerPoints.resizeContainerDiv.X = parseFloat(this.resizeContainerDiv.style.left);
            this.ownerControl.ImageResizerPoints.resizeContainerDiv.Y = parseFloat(this.resizeContainerDiv.style.top);
            this.ownerControl.ImageResizerPoints.bottomLeftRect.X = parseFloat(this.bottomLeftRect.style.left);
            this.ownerControl.ImageResizerPoints.bottomLeftRect.Y = parseFloat(this.bottomLeftRect.style.top);
            this.ownerControl.ImageResizerPoints.bottomRightRect.X = parseFloat(this.bottomRightRect.style.left);
            this.ownerControl.ImageResizerPoints.bottomRightRect.Y = parseFloat(this.bottomRightRect.style.top);
            this.ownerControl.ImageResizerPoints.bottomMiddleRect.X = parseFloat(this.bottomMiddleRect.style.left);
            this.ownerControl.ImageResizerPoints.bottomMiddleRect.Y = parseFloat(this.bottomMiddleRect.style.top);
            this.ownerControl.ImageResizerPoints.topLeftRect.X = parseFloat(this.topLeftRect.style.left);
            this.ownerControl.ImageResizerPoints.topLeftRect.Y = parseFloat(this.topLeftRect.style.top);
            this.ownerControl.ImageResizerPoints.topRightRect.X = parseFloat(this.topRightRect.style.left);
            this.ownerControl.ImageResizerPoints.topRightRect.Y = parseFloat(this.topRightRect.style.top);
            this.ownerControl.ImageResizerPoints.topMiddleRect.X = parseFloat(this.topMiddleRect.style.left);
            this.ownerControl.ImageResizerPoints.topMiddleRect.Y = parseFloat(this.topMiddleRect.style.top);
            this.ownerControl.ImageResizerPoints.leftMiddleRect.X = parseFloat(this.leftMiddleRect.style.left);
            this.ownerControl.ImageResizerPoints.leftMiddleRect.Y = parseFloat(this.leftMiddleRect.style.top);
            this.ownerControl.ImageResizerPoints.rightMiddleRect.X = parseFloat(this.rightMiddleRect.style.left);
            this.ownerControl.ImageResizerPoints.rightMiddleRect.Y = parseFloat(this.rightMiddleRect.style.top);
        };
        ImageResizer.prototype._InitResizeContainerDiv = function () {
            this.resizeContainerDiv = document.createElement("div");
            this.resizeContainerDiv.id = this.ownerControl.ContainerId + "_ResizeDivElement";
            this.resizeContainerDiv.style.position = "absolute";
            this.resizeContainerDiv.style.border = "1px solid black";
            this.resizeContainerDiv.style.zIndex = "30";
            this.resizeContainerDiv.style.backgroundColor = "transparent";
            this.resizeContainerDiv.style.display = "none";
        };
        ImageResizer.prototype._applyProperties = function (resizeRectElement) {
            resizeRectElement.style.position = "absolute";
            resizeRectElement.style.backgroundColor = "gray";
            resizeRectElement.style.width = "7px";
            resizeRectElement.style.height = "7px";
            resizeRectElement.style.fontSize = "0px";
            resizeRectElement.style.zIndex = " 551";
        };
        ImageResizer.prototype._InitHistory = function (imageContainer) {
            if (this.ownerControl != null && this.baseHistoryInfo == null) {
                this.baseHistoryInfo = new BaseHistoryInfo(this.ownerControl);
                this.baseHistoryInfo.Action = Actions.ImageReszing;
                this.baseHistoryInfo._UpdateSelection(this.ownerControl.Selection);
                this.baseHistoryInfo.ModifiedProperties._Add(new ImageFormat(imageContainer));
            }
        };
        ImageResizer.prototype._UpdateHistory = function () {
            if (this.ownerControl != null && this.baseHistoryInfo != null) {
                var imageFormat = this.baseHistoryInfo.ModifiedProperties[0];
                if (this.CurrentImageElementBox.ImageContainer.Width == imageFormat.Width
                    && this.CurrentImageElementBox.ImageContainer.Height == imageFormat.Height)
                    this.baseHistoryInfo.ModifiedProperties._Clear();
                else
                    this.ownerControl.History._RecordChanges(this.baseHistoryInfo);
                this.baseHistoryInfo = null;
            }
        };
        ImageResizer.prototype._RenderImageResizer = function (page) {
            var ResizeDiv;
            if (page != null)
                ResizeDiv = document.getElementById(page.Id + "_resize");
            this._DrawImageResizer(ResizeDiv);
        };
        ImageResizer.prototype._ReDrawImageResizer = function (widget, page) {
            if (this.SelectedImageWidget._ContainsKey(widget)) {
                var ResizeDiv = void 0;
                if (page != null)
                    ResizeDiv = document.getElementById(page.Id + "_resize");
                this._DrawImageResizer(ResizeDiv);
            }
        };
        ImageResizer.prototype._DrawImageResizer = function (ResizeDiv) {
            if (ResizeDiv != null) {
                if (this.resizeContainerDiv != null)
                    ResizeDiv.appendChild(this.resizeContainerDiv);
                if (this.bottomLeftRect != null)
                    ResizeDiv.appendChild(this.bottomLeftRect);
                if (this.bottomRightRect != null)
                    ResizeDiv.appendChild(this.bottomRightRect);
                if (this.bottomMiddleRect != null)
                    ResizeDiv.appendChild(this.bottomMiddleRect);
                if (this.rightMiddleRect != null)
                    ResizeDiv.appendChild(this.rightMiddleRect);
                if (this.topRightRect != null)
                    ResizeDiv.appendChild(this.topRightRect);
                if (this.topLeftRect != null)
                    ResizeDiv.appendChild(this.topLeftRect);
                if (this.leftMiddleRect != null)
                    ResizeDiv.appendChild(this.leftMiddleRect);
                if (this.topMiddleRect != null)
                    ResizeDiv.appendChild(this.topMiddleRect);
            }
        };
        return ImageResizer;
    }());
    DocumentEditorFeatures.ImageResizer = ImageResizer;
    var ImageResizingPoints = (function () {
        function ImageResizingPoints() {
            this.resizeContainerDiv = new Point(0, 0);
            this.topLeftRect = new Point(0, 0);
            this.topMiddleRect = new Point(0, 0);
            this.topRightRect = new Point(0, 0);
            this.bottomLeftRect = new Point(0, 0);
            this.bottomMiddleRect = new Point(0, 0);
            this.bottomRightRect = new Point(0, 0);
            this.leftMiddleRect = new Point(0, 0);
            this.rightMiddleRect = new Point(0, 0);
        }
        return ImageResizingPoints;
    }());
    DocumentEditorFeatures.ImageResizingPoints = ImageResizingPoints;
    var LayoutViewer = (function () {
        function LayoutViewer(owner) {
            this.CurrentPage = null;
            this.tableLeft = [];
            this.Pages = new List();
            this.selectionStartPage = null;
            this.selectionEndPage = null;
            this.zoomFactor = 1;
            this.touchStart = null;
            this.touchEnd = null;
            this.Caret = null;
            this.IsTouchInput = false;
            this.IsFieldCode = false;
            this.CurrentComment = null;
            this.CurrentHeaderFooter = null;
            this.SplittedCellWidgets = null;
            this.isMousedown = false;
            this.isSelectionChangedOnMouseMoved = false;
            this.HorizontalScrollBar = null;
            this.VerticalScrollBar = null;
            this.preZoomFactor = 0;
            this.preDifference = -1;
            this.PointerCount = 0;
            this.Pointers = [];
            this.ScrollStartX = -1;
            this.ScrollStartY = -1;
            this.SearchHighlighters = null;
            this.TouchDownOnSelectionMark = 0;
            this.useTouchSelectionMark = true;
            this.isTouchScroll = false;
            this.BlockToShift = null;
            this.FieldToLayout = null;
            this.FieldEndParagraph = null;
            this.isControlPressed = false;
            this.HorizontalWidth = 0;
            this.InsertTableDialog = null;
            this.InsertFindAndReplaceDialog = null;
            this.InsertAlertDialog = null;
            this.InsertListDialog = null;
            this.InsertCellMarginsDialog = null;
            this.CommentRangeWidget = null;
            this.SelectedCommentRangeWidget = new Dictionary();
            this.pageFitType = PageFitType.None;
            this.tapCount = 0;
            this.timer = -1;
            this.TextWrap = true;
            this.isReviewPanelShow = false;
            this.IsImageResizing = false;
            this.isImageResizerVisible = false;
            this.TablePropertiesDialog = null;
            this.viewModel = new ListDialogVieModel();
            this.TableBorderAndShadingDialog = null;
            this.isOptionsPaneShow = false;
            this.LineElements = new ElementCollection();
            this.FieldStack = new List();
            this.CommentWidgets = new List();
            this.ImageResizer = new ImageResizer(owner);
            if (owner != null) {
                this.Pages = new List();
                this.SplittedCellWidgets = new List();
                this.OwnerControl = owner;
                this.fontDialog = new FontDialog(this);
                var viewer_1 = this;
                if (this.OwnerControl.DocumentEditorElement == null)
                    return;
                this._InitOptionPane();
                var OptionPaneContiner = document.createElement('div');
                OptionPaneContiner.className = DocumentEditorThemeHelper.OptionsPane;
                if (navigator.userAgent.match('Safari') && navigator.vendor.match('Apple'))
                    OptionPaneContiner.setAttribute('style', 'display:-webkit-inline-box');
                else
                    OptionPaneContiner.setAttribute('style', 'display:inline-flex');
                OptionPaneContiner.appendChild(this.OptionsPane);
                this.ViewerContatiner = document.createElement("div");
                this.ViewerContatiner.style.touchAction = "pan-x pan-y";
                OptionPaneContiner.appendChild(this.ViewerContatiner);
                this.OwnerControl.DocumentEditorElement.appendChild(OptionPaneContiner);
                this.Container = document.createElement("div");
                this.Container.setAttribute("id", this.OwnerControl.ContainerId + "_viewerContainer");
                this.Container.style.overflow = "hidden";
                this.Container.style.cssFloat = "left";
                this.Container.style.position = "relative";
                this.Container.style.pointerEvents = "none";
                this.Container.className = DocumentEditorThemeHelper.DocumentEditor;
                this.ViewerContatiner.appendChild(this.Container);
                this.ViewerContatiner.tabIndex = 0;
                this.ViewerContatiner.style.outline = "none";
                this.EditableDiv = document.createElement("div");
                this.EditableDiv.contentEditable = "true";
                this.EditableDiv.style.position = "fixed";
                this.EditableDiv.style.left = "-150em";
                this.EditableDiv.style.width = "100%";
                this.EditableDiv.style.height = "100%";
                this.EditableDiv.id = this.OwnerControl.ContainerId + "_editableDiv";
                document.body.appendChild(this.EditableDiv);
                var verticalScrollBar = this.OwnerControl.ej.buildTag("div", "", { "display": "none", "float": "right" }, { "id": this.OwnerControl.ContainerId + "_verticalScrollBar" });
                verticalScrollBar.ejScrollBar({
                    orientation: "vertical",
                    minimum: 0,
                    width: 18,
                    height: 0,
                    infiniteScrolling: false,
                    scroll: $.proxy(this._VerticalScrollBar_ValueChanged, this)
                });
                this.VerticalScrollBar = verticalScrollBar.data("ejScrollBar");
                this.ViewerContatiner.appendChild(verticalScrollBar[0]);
                var horizontalScrollBar = this.OwnerControl.ej.buildTag("div", "", { "display": "none" }, { "id": this.OwnerControl.ContainerId + "_horizontalScrollBar" });
                horizontalScrollBar.ejScrollBar({
                    orientation: "horizontal",
                    minimum: 0,
                    width: 0,
                    height: 18,
                    infiniteScrolling: false,
                    scroll: $.proxy(this._HorizontalScrollBar_ValueChanged, this)
                });
                this.HorizontalScrollBar = horizontalScrollBar.data("ejScrollBar");
                this.ViewerContatiner.appendChild(horizontalScrollBar[0]);
                this._UpdateViewerSize();
                this.ParagraphDialog = new ParagraphDialog(this);
                this.HyperlinkDialog = new HyperlinkDialog(this);
                this._InitContextMenu();
                var resizeTimer_1 = 0;
                this.windowResizeHandler = function (event) {
                    if (resizeTimer_1) {
                        clearTimeout(resizeTimer_1);
                    }
                    resizeTimer_1 = setTimeout(function () {
                        viewer_1._UpdateViewerSizeOnWindowResize();
                    }, 100);
                    viewer_1.ContextMenu.style.display = "none";
                };
                this.windowMouseDownHandler = function (e) {
                    viewer_1._HideContextMenu();
                };
                this.windowKeyUpHandler = function (e) {
                    if (e.keyCode == 27)
                        viewer_1._HideContextMenu();
                    if (e.ctrlKey || (e.keyCode == 17 || e.which == 17))
                        viewer_1.isControlPressed = false;
                };
                window.addEventListener("resize", this.windowResizeHandler);
                this.ViewerContatiner.addEventListener("mousedown", function (event) {
                    viewer_1.timer = setTimeout(function () {
                        viewer_1.tapCount++;
                        if (viewer_1.tapCount == 4) {
                            viewer_1.tapCount = 2;
                        }
                    }, 200);
                    viewer_1._OnMouseDownInternal(event);
                });
                this.ContextMenu.addEventListener("mousedown", function (event) {
                    var contextMenuItem = viewer_1._GetContextMenuItem(event, DocumentEditorThemeHelper.ContextMenuItem);
                    if (contextMenuItem != null) {
                        viewer_1._HandleContextMenuItem(contextMenuItem.id);
                        return;
                    }
                });
                this.ViewerContatiner.addEventListener("mousemove", function (event) {
                    viewer_1._OnMouseMoveInternal(event);
                });
                this.ViewerContatiner.addEventListener("mouseup", function (event) {
                    viewer_1._OnMouseUpInternal(event, viewer_1.tapCount);
                });
                this.ViewerContatiner.addEventListener("mousewheel", function (event) {
                    viewer_1._OnMouseWheelInternal(event);
                });
                this.ViewerContatiner.addEventListener("dblclick", function (event) {
                    if (!(navigator.userAgent.match("MSIE 10.0")))
                        viewer_1._OnDoubleTap(event);
                });
                if (navigator.userAgent.match("Firefox"))
                    this.ViewerContatiner.addEventListener("DOMMouseScroll", function (event) {
                        viewer_1._OnMouseWheelInternal(event);
                    });
                this.ViewerContatiner.addEventListener("contextmenu", function (e) {
                    viewer_1._OnContextMenuInternal(e);
                });
                this.EditableDiv.addEventListener("keydown", function (event) {
                    viewer_1._OnkeyDownInternal(event);
                });
                this.EditableDiv.addEventListener("keypress", function (event) {
                    viewer_1.OnTextInputInternal(event);
                    event.preventDefault();
                });
                this.EditableDiv.addEventListener("paste", function (event) {
                    viewer_1._OnPaste(event);
                });
                window.addEventListener("mousedown", this.windowMouseDownHandler);
                window.addEventListener("keyup", this.windowKeyUpHandler);
                viewer_1._InitFindAndReplaceDialog();
                viewer_1._InitTableDialog();
                viewer_1._InitAlertDialog();
                viewer_1._InitCellMarginsDialog();
                viewer_1._InitListDialog();
                viewer_1._InitTouchEvents();
                viewer_1.EditableDiv.focus();
                viewer_1._InitTablePropertyDialog();
                viewer_1._InitBordersShadingsPropertiesDialog();
            }
        }
        ;
        Object.defineProperty(LayoutViewer.prototype, "VisibleBounds", {
            get: function () {
                return this.visibleBounds;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(LayoutViewer.prototype, "CurrentRenderingPage", {
            get: function () {
                if (this.Pages.length == 0)
                    return null;
                return this.Pages[this.Pages.length - 1];
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(LayoutViewer.prototype, "SelectionStartPage", {
            get: function () {
                return this.selectionStartPage;
            },
            set: function (value) {
                this.selectionStartPage = value;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(LayoutViewer.prototype, "SelectionEndPage", {
            get: function () {
                return this.selectionEndPage;
            },
            set: function (value) {
                this.selectionEndPage = value;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(LayoutViewer.prototype, "ZoomFactor", {
            get: function () {
                return this.zoomFactor;
            },
            set: function (value) {
                this.zoomFactor = value;
                this._OnZoomFactorChanged();
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(LayoutViewer.prototype, "TouchStart", {
            get: function () {
                return this.touchStart;
            },
            set: function (value) {
                this.touchStart = value;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(LayoutViewer.prototype, "TouchEnd", {
            get: function () {
                return this.touchEnd;
            },
            set: function (value) {
                this.touchEnd = value;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(LayoutViewer.prototype, "caret", {
            get: function () {
                return this.Caret;
            },
            set: function (value) {
                this.Caret = value;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(LayoutViewer.prototype, "PageFitType", {
            get: function () {
                return this.pageFitType;
            },
            set: function (value) {
                this.pageFitType = value;
                this._OnPageFitTypeChanged(this.pageFitType);
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(LayoutViewer.prototype, "List", {
            get: function () {
                if (this.viewModel != null)
                    return this.viewModel.List;
                return null;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(LayoutViewer.prototype, "ListLevel", {
            get: function () {
                if (this.viewModel != null)
                    return this.viewModel.ListLevel;
                return null;
            },
            enumerable: true,
            configurable: true
        });
        LayoutViewer.prototype._InitOptionPane = function () {
            var instance = this;
            this.OptionsPane = document.createElement("div");
            this.OptionsPane.setAttribute('style', 'display:none;width:300px;top:0px;border-right: 1px solid #e1e1e1');
            var searchDiv = document.createElement('div');
            searchDiv.innerHTML = 'Search';
            searchDiv.setAttribute('style', 'font-size:15px;position:relative;top:20px;left:25px;width:90%');
            this.OptionsPane.appendChild(searchDiv);
            var closeButton = document.createElement('div');
            closeButton.setAttribute('class', 'e-icon e-close_01');
            closeButton.setAttribute('style', 'font-size:large;position:relative;left:85%;cursor:pointer');
            this.OptionsPane.appendChild(closeButton);
            var searchTextBoxContiainer = document.createElement('div');
            searchTextBoxContiainer.setAttribute('style', 'width:82%;height:30px;position:relative;left:25px;top:20px;border-color:#c8c8c8 #c8c8c8;border-style:solid;border-width:1px;padding:0px;margin:0px');
            this.OptionsPane.appendChild(searchTextBoxContiainer);
            var input = document.createElement('input');
            input.setAttribute('type', 'text');
            input.setAttribute('class', 'e-textbox');
            if (navigator.userAgent.match('MSIE') || navigator.userAgent.match('.NET'))
                input.setAttribute('style', 'height:29px;width:87.8%;');
            else
                input.setAttribute('style', 'height:29px;width:87.8%;padding-left: 7px;margin:1px 1px 0px 1px');
            input.setAttribute('id', this.OwnerControl.ContainerId + "_option_search_text_box");
            searchTextBoxContiainer.appendChild(input);
            var searchIcon = document.createElement('span');
            searchIcon.setAttribute('style', 'position:relative;float:right;margin-right: 0px;padding-top:3px;width:10px;height:27px;padding-right:15px;padding-left:3px;cursor:pointer');
            var aTag = document.createElement('a');
            aTag.setAttribute('class', 'e-icon e-search');
            aTag.setAttribute('style', 'font-size:x-large;text-decoration:none');
            searchIcon.appendChild(aTag);
            searchTextBoxContiainer.appendChild(searchIcon);
            var resultContainer = document.createElement('div');
            resultContainer.setAttribute('style', 'position:relative;top:35px;left:25px;height:30px;width:85%');
            this.OptionsPane.appendChild(resultContainer);
            var resultText = document.createElement('div');
            resultText.innerHTML = "Result";
            resultText.setAttribute('style', 'font-size:15px;');
            var spanArrow = document.createElement('div');
            spanArrow.setAttribute('style', 'display:none;position:absolute;top:0px;left:85%');
            spanArrow.setAttribute('id', instance.OwnerControl.ContainerId + "_navigation_bar");
            var navigatePreviousResultButton = document.createElement('span');
            navigatePreviousResultButton.setAttribute('class', 'e-icon e-arrow-up');
            navigatePreviousResultButton.setAttribute('style', 'margin:0px;font-size:large;cursor:pointer');
            var navigateNextResultButton = document.createElement('span');
            navigateNextResultButton.setAttribute('class', 'e-icon e-arrow-down');
            navigateNextResultButton.setAttribute('style', 'margin:0px;font-size:large;cursor:pointer');
            spanArrow.appendChild(navigatePreviousResultButton);
            spanArrow.appendChild(navigateNextResultButton);
            resultContainer.appendChild(resultText);
            resultContainer.appendChild(spanArrow);
            var messageDiv = document.createElement('div');
            messageDiv.innerHTML = "Use search box for find text in the document";
            messageDiv.setAttribute('id', instance.OwnerControl.ContainerId + "_search_status");
            messageDiv.setAttribute('style', 'position:relative;top:33px;left:25px;width:90%');
            this.OptionsPane.appendChild(messageDiv);
            var resultsListBlock = instance.OwnerControl.ej.buildTag("div", "", { "display": "none", "position": "relative", "top": "50px", "left": "25px" }, { "id": this.OwnerControl.ContainerId + "_list_box_container" });
            var UL = instance.OwnerControl.ej.buildTag('ul', "", "", { "id": this.OwnerControl.ContainerId + '_option_pane_list_view' });
            resultsListBlock[0].appendChild(UL[0]);
            UL.ejListBox();
            this.OptionsPane.appendChild(resultsListBlock[0]);
            searchIcon.addEventListener('click', function () {
                var inputElement = document.getElementById(instance.OwnerControl.ContainerId + "_option_search_text_box");
                var Text = inputElement.value;
                if (Text == "")
                    return;
                instance.OwnerControl._ClearSearchResultItems();
                instance._ClearSearchHighlight();
                instance.OwnerControl._FindAll(Text, FindOptions.None);
                if (instance.OwnerControl.textSearchResults != null && instance.OwnerControl.textSearchResults.Count > 0) {
                    instance.OwnerControl.textSearchResults._Highlight();
                    instance.OwnerControl.textSearchResults._AddFindResultView();
                    resultsListBlock[0].style.display = "block";
                    spanArrow.style.display = "flex";
                    var list = instance.OwnerControl.findResultsList;
                    var text = "";
                    for (var i = 0; i < list.length; i++)
                        text += list[i];
                    UL.data('ejListBox').destroy();
                    UL[0].innerHTML = "";
                    UL[0].innerHTML = text;
                    UL.ejListBox({ width: "83%" });
                    UL.ejListBox({
                        select: function (args) {
                            instance.OwnerControl.textSearchResults.CurrentIndex = args.index;
                            instance.OwnerControl.textSearchResults.CurrentSearchResult._Navigate();
                            messageDiv.innerHTML = "Result   " + (args.index + 1) + " of " + instance.OwnerControl.textSearchResults.Count;
                        }
                    });
                    var currentIndex = instance.OwnerControl.textSearchResults.CurrentIndex;
                    messageDiv.innerHTML = "Result    " + (currentIndex + 1) + " of " + instance.OwnerControl.textSearchResults.Count;
                    UL.ejListBox("selectItemByIndex", currentIndex);
                }
                else {
                    messageDiv.innerHTML = "We Couldn't find what you looking for.";
                    resultsListBlock[0].style.display = "none";
                    spanArrow.style.display = "none";
                }
            });
            navigateNextResultButton.addEventListener('click', function () {
                if (UL.data('ejListBox') != null) {
                    if (instance.OwnerControl.textSearchResults.CurrentIndex < instance.OwnerControl.textSearchResults.Count - 1) {
                        var index = instance.OwnerControl.textSearchResults.CurrentIndex;
                        UL.ejListBox('selectItemByIndex', ++index);
                    }
                    else {
                        UL.ejListBox('selectItemByIndex', 0);
                    }
                }
            });
            navigatePreviousResultButton.addEventListener('click', function () {
                if (UL.data('ejListBox') != null) {
                    if (instance.OwnerControl.textSearchResults.CurrentIndex == 0) {
                        UL.ejListBox('selectItemByIndex', instance.OwnerControl.textSearchResults.Count - 1);
                    }
                    else {
                        var index = instance.OwnerControl.textSearchResults.CurrentIndex;
                        UL.ejListBox('selectItemByIndex', --index);
                    }
                }
            });
            closeButton.addEventListener('click', function () {
                instance._ShowHideOptionsPane(false);
            });
            input.addEventListener('keydown', function (event) {
                var code = event.which || event.keyCode;
                if (code == 13) {
                    var inputElement = document.getElementById(instance.OwnerControl.ContainerId + "_option_search_text_box");
                    inputElement.blur();
                    var Text_1 = inputElement.value;
                    if (Text_1 == "")
                        return;
                    var resultsContainerHeight = instance.OwnerControl.DocumentEditorElement.offsetHeight - 200;
                    instance.OwnerControl._ClearSearchResultItems();
                    instance._ClearSearchHighlight();
                    instance.OwnerControl._FindAll(Text_1, FindOptions.None);
                    if (instance.OwnerControl.textSearchResults != null && instance.OwnerControl.textSearchResults.Count > 0) {
                        instance.OwnerControl.textSearchResults._Highlight();
                        instance.OwnerControl.textSearchResults._AddFindResultView();
                        resultsListBlock[0].style.display = "block";
                        resultsListBlock[0].style.height = resultsContainerHeight + "px";
                        spanArrow.style.display = "flex";
                        var list = instance.OwnerControl.findResultsList;
                        var text = "";
                        for (var i = 0; i < list.length; i++)
                            text += list[i];
                        UL.data('ejListBox').destroy();
                        UL[0].innerHTML = "";
                        UL[0].innerHTML = text;
                        UL.ejListBox({ width: "83%", height: resultsContainerHeight + "px" });
                        UL.ejListBox({
                            change: function (args) {
                                instance.OwnerControl.textSearchResults.CurrentIndex = args.index;
                                instance.OwnerControl.textSearchResults.CurrentSearchResult._Navigate();
                                messageDiv.innerHTML = "Result   " + (args.index + 1) + " of " + instance.OwnerControl.textSearchResults.Count;
                            }
                        });
                        var currentIndex = instance.OwnerControl.textSearchResults.CurrentIndex;
                        messageDiv.innerHTML = "Result    " + (currentIndex + 1) + " of " + instance.OwnerControl.textSearchResults.Count;
                        UL.ejListBox("selectItemByIndex", currentIndex);
                    }
                    else {
                        messageDiv.innerHTML = "We Couldn't find what you looking for.";
                        resultsListBlock[0].style.display = "none";
                        spanArrow.style.display = "none";
                    }
                }
                else {
                    resultsListBlock[0].style.display = "none";
                    messageDiv.innerHTML = "Use search box for find text in the document";
                    spanArrow.style.display = "none";
                }
                if (instance.InsertFindAndReplaceDialog.data("ejDialog") != null)
                    if (instance.InsertFindAndReplaceDialog.data("ejDialog").isOpen()) {
                        var dlgobj = instance.InsertFindAndReplaceDialog.data("ejDialog");
                        dlgobj.close();
                    }
            });
        };
        LayoutViewer.prototype._ShowHideOptionsPane = function (show) {
            if (show) {
                this.OptionsPane.style.display = "block";
                this.isOptionsPaneShow = true;
                var textbox = document.getElementById(this.OwnerControl.DocumentEditorElement.id + "_option_search_text_box");
                var selectedText = this.OwnerControl.Selection.Text;
                textbox.value = selectedText;
                textbox.select();
            }
            else {
                this._ClearSearchHighlight();
                this.OptionsPane.style.display = "none";
                this.isOptionsPaneShow = false;
                var resultListBox = document.getElementById(this.OwnerControl.ContainerId + "_list_box_container");
                resultListBox.style.display = "none";
                var message = document.getElementById(this.OwnerControl.ContainerId + "_search_status");
                message.innerHTML = "Use search box for find text in the document";
                var navigationIcon = document.getElementById(this.OwnerControl.ContainerId + "_navigation_bar");
                navigationIcon.style.display = "none";
                this.OwnerControl.Selection._UpdateFocus();
            }
            this._UpdateViewerSizeOnWindowResize();
        };
        LayoutViewer.prototype._OnPaste = function (evt) {
            var viewer = this;
            viewer.OwnerControl.Selection._Paste(evt);
        };
        LayoutViewer.prototype._OnPasteMenuClick = function () {
            this.OwnerControl.Selection._PasteInternal();
        };
        LayoutViewer.prototype._OnInsertTable = function () {
            var rowCount = this.InsertTableDialog.find("#" + this.InsertTableDialog[0].id + "_row")[0].value;
            var columnCount = this.InsertTableDialog.find("#" + this.InsertTableDialog[0].id + "_column")[0].value;
            this.OwnerControl._InsertTableInBlocks(rowCount, columnCount);
            this.InsertTableDialog.ejDialog("close");
        };
        LayoutViewer.prototype._InitTableDialog = function () {
            var instance = this;
            instance.InsertTableDialog = instance.OwnerControl.ej.buildTag("div", "", { "display": "none" }, { "id": "documentEditor_" + instance.OwnerControl.ContainerId + "_insertTableDialog", "title": "Insert Table" });
            instance.OwnerControl.DocumentEditorElement.appendChild(instance.InsertTableDialog[0]);
            var innerDiv = document.createElement("div");
            var table = document.createElement("TABLE");
            table.innerHTML += "<tr style='height: 50px;'><td style= 'width:35%'>Column Size</td><td><input type='text' id= '" + instance.InsertTableDialog[0].id + "_column' style= 'width:100%' /></td></tr><tr style='height:50px;'><td style='width:35%'>Row Size</td><td><input type='text' id= '" + instance.InsertTableDialog[0].id + "_row' style= 'width:100%' / ></td></tr>";
            innerDiv.appendChild(table);
            var insertBtn = instance.OwnerControl.ej.buildTag("input", "", { "margin-left": "0px", "width": "55px", "left": "100px", "position": "relative" }, {
                "type": "button", "id": instance.InsertTableDialog[0].id + "_insert", "value": "Insert"
            });
            insertBtn.ejButton({
                click: instance.OwnerControl.ej.proxy(instance._OnInsertTable, instance)
            });
            var cancelBtn = instance.OwnerControl.ej.buildTag("input", "", { "margin-left": "0px", "width": "55px", "left": "130px", "position": "relative" }, { "id": instance.InsertTableDialog[0].id + "_cancel", "type": "button", "value": "Cancel" });
            cancelBtn.ejButton({
                click: function (args) {
                    if (!args.cancel)
                        instance.InsertTableDialog.ejDialog("close");
                }
            });
            innerDiv.appendChild(insertBtn[0]);
            innerDiv.appendChild(cancelBtn[0]);
            instance.InsertTableDialog[0].appendChild(innerDiv);
            var rowTextBox = instance.InsertTableDialog.find("#" + instance.InsertTableDialog[0].id + "_row");
            rowTextBox.ejNumericTextbox({
                value: 2,
                minValue: 1,
                maxValue: 32767,
                height: 25,
                enablePersistence: false
            });
            var columnTextBox = instance.InsertTableDialog.find("#" + instance.InsertTableDialog[0].id + "_column");
            columnTextBox.ejNumericTextbox({
                value: 2,
                minValue: 1,
                maxValue: 63,
                height: 25,
                enablePersistence: false
            });
            instance.InsertTableDialog.keyup(function (evt) {
                if (evt.keyCode == 13) {
                    if (columnTextBox[0].value != "" && rowTextBox[0] != "")
                        instance._OnInsertTable();
                }
            });
        };
        LayoutViewer.prototype._InitFindAndReplaceDialog = function () {
            var instance = this;
            instance.InsertFindAndReplaceDialog = instance.OwnerControl.ej.buildTag("div", "", { "display": "none" }, { "id": "documentEditor_" + instance.OwnerControl.ContainerId + "_insertFindAndReplaceDialog", "title": "Insert Find And Replace" });
            instance.OwnerControl.DocumentEditorElement.appendChild(instance.InsertFindAndReplaceDialog[0]);
            var innerDiv = document.createElement("div");
            innerDiv.style.width = "auto";
            innerDiv.style.height = "auto";
            var ul = instance.OwnerControl.ej.buildTag("div", "<ul><li><a href='#" + instance.InsertFindAndReplaceDialog[0].id + "_find' > Find </a></li><li><a href='#" + instance.InsertFindAndReplaceDialog[0].id + "_find' > Replace </a></li ></ul>", "", { "id": instance.InsertFindAndReplaceDialog[0].id + "_tab" });
            innerDiv.appendChild(ul[0]);
            ul.ejTab({
                itemActive: function (e) {
                    instance._OnFindReplaceTabChange(e.activeIndex);
                }
            });
            var findDiv = ul.find("#" + instance.InsertFindAndReplaceDialog[0].id + "_find");
            var table = document.createElement("TABLE");
            table.innerHTML += "<tr id='" + instance.InsertFindAndReplaceDialog[0].id + "_findrow' style='height: 50px;'><td style= 'width:40%'>Find What</td><td><input type='text' id= '" + instance.InsertFindAndReplaceDialog[0].id + "_FindWhatText' style= 'width:200px;' /></td></tr>";
            table.innerHTML += "<tr id='" + instance.InsertFindAndReplaceDialog[0].id + "_replaceTextBox' style='height:50px;'><td style='width:35%;'>Replace With</td><td><input type='text' id= '" + instance.InsertFindAndReplaceDialog[0].id + "_replaceText' style= 'width:200px;' / ></td></tr>";
            findDiv[0].appendChild(table);
            var findNxt = instance.OwnerControl.ej.buildTag("input", "", { "margin-left": "0px", "width": "55px", "left": "20px", "position": "relative" }, {
                "type": "button", "id": instance.InsertFindAndReplaceDialog[0].id + "_FindNext", "value": "Find Next"
            });
            findNxt.ejButton({
                click: instance.OwnerControl.ej.proxy(instance._onFindNext, instance)
            });
            var cancelBtn = instance.OwnerControl.ej.buildTag("input", "", { "margin-left": "0px", "width": "55px", "left": "30px", "position": "relative" }, { "id": instance.InsertFindAndReplaceDialog[0].id + "_cancel", "type": "button", "value": "Cancel" });
            cancelBtn.ejButton({
                click: function (args) {
                    if (!args.cancel)
                        instance.InsertFindAndReplaceDialog.ejDialog("close");
                }
            });
            var replaceBtn = instance.OwnerControl.ej.buildTag("input", "", { "margin-left": "0px", "width": "55px", "position": "relative" }, {
                "type": "button", "id": instance.InsertFindAndReplaceDialog[0].id + "_replace", "value": "Replace"
            });
            replaceBtn.ejButton({
                click: instance.OwnerControl.ej.proxy(instance._Replace, instance)
            });
            var replaceAllBtn = instance.OwnerControl.ej.buildTag("input", "", { "margin-left": "0px", "width": "55px", "left": "10px", "position": "relative" }, {
                "type": "button", "id": instance.InsertFindAndReplaceDialog[0].id + "_replaceAll", "value": "ReplaceAll"
            });
            replaceAllBtn.ejButton({
                click: instance.OwnerControl.ej.proxy(instance._ReplaceAll, instance)
            });
            findDiv[0].appendChild(replaceBtn[0]);
            findDiv[0].appendChild(replaceAllBtn[0]);
            findDiv[0].appendChild(findNxt[0]);
            findDiv[0].appendChild(cancelBtn[0]);
            instance.InsertFindAndReplaceDialog[0].appendChild(innerDiv);
            var divBtn = document.createElement("div");
            var MoreLessBtn = instance.OwnerControl.ej.buildTag("input", "", { "margin-left": "0px", "width": "55px", "left": "10px", "position": "relative" }, {
                "type": "checkbox", "id": instance.InsertFindAndReplaceDialog[0].id + "_MoreLess"
            });
            divBtn.appendChild(MoreLessBtn[0]);
            findDiv[0].appendChild(divBtn);
            var tableCheck = document.createElement("table");
            tableCheck.style.display = "none";
            tableCheck.innerHTML += "<tr><td><input type='checkbox' id= '" + this.InsertFindAndReplaceDialog[0].id + "_matchcase' style= 'width:25%' /><br/></td></tr><tr><td><input type='checkbox' id= '" + this.InsertFindAndReplaceDialog[0].id + "_wholeword' style= 'width:25%' /></td></tr><tr><td><input type='checkbox' id= '" + this.InsertFindAndReplaceDialog[0].id + "_regular' style= 'width:25%' /></td></tr>";
            divBtn.appendChild(tableCheck);
            var match = instance.InsertFindAndReplaceDialog.find("#" + this.InsertFindAndReplaceDialog[0].id + "_matchcase");
            var wholeword = instance.InsertFindAndReplaceDialog.find("#" + this.InsertFindAndReplaceDialog[0].id + "_wholeword");
            var regular = instance.InsertFindAndReplaceDialog.find("#" + this.InsertFindAndReplaceDialog[0].id + "_regular");
            match.ejCheckBox({
                text: "Match Case",
                width: "auto",
            });
            wholeword.ejCheckBox({
                text: "Find Whole Words Only",
                width: "auto"
            });
            regular.ejCheckBox({
                text: "Use regular expression",
                width: "auto",
                change: function (args) {
                    if (args.isChecked) {
                        match.ejCheckBox("disable");
                        wholeword.ejCheckBox("disable");
                    }
                    else {
                        match.ejCheckBox("enable");
                        wholeword.ejCheckBox("enable");
                    }
                }
            });
            MoreLessBtn.ejToggleButton({
                defaultText: "More >>",
                activeText: "<< Less",
                click: function () {
                    if (tableCheck.style.display == "none")
                        tableCheck.style.display = "block";
                    else
                        tableCheck.style.display = "none";
                }
            });
            instance.InsertFindAndReplaceDialog.keyup(function (event) {
                if (event.keycode == 13) {
                    instance._onFindNext();
                }
            });
            this._CreateEjDialog(this.InsertFindAndReplaceDialog);
        };
        LayoutViewer.prototype._InitListDialog = function () {
            var instance = this;
            instance.InsertListDialog = instance.OwnerControl.ej.buildTag("div", "", { "display": "none" }, {
                "id": "documentEditor_" + instance.OwnerControl.ContainerId + "_insertListDialog", "title": "Define List"
            });
            instance.OwnerControl.DocumentEditorElement.appendChild(this.InsertListDialog[0]);
            var innerDiv = document.createElement("div");
            innerDiv.style.width = "480px";
            innerDiv.style.height = "auto";
            innerDiv.style.paddingBottom = "20px";
            var table = document.createElement("TABLE");
            table.style.width = "500px";
            table.style.height = "auto";
            table.style.padding = "20px";
            table.style.margin = "10px";
            table.innerHTML += "<tr><td><label>List Level</label></td></tr><tr><td style='font-size:12px'><label style='font-weight:normal'>Choose Level to modify</label></br><input type='text' id='" + this.InsertListDialog[0].id + "_listlevel'></br>";
            table.innerHTML += "<tr><td><label>Number Format</label></td></tr><tr><td style='font-size:12px'><label style='font-weight:normal'>Number Style for this level</label></br><input type='text' id='" + this.InsertListDialog[0].id + "_numberStyle'/></td><td style='font-size:12px'><label style='font-weight:normal'>Formatting For Number</label></br><input type='text' style='width:200px;height:15px;font-size:12px;' id='" + this.InsertListDialog[0].id + "_numberFormat' ></td></tr><tr><td style='font-size:12px'><label style='font-weight:normal'>Start At</label></br><input type='text' id='" + this.InsertListDialog[0].id + "_startAt' ></td><td style='font-size:12px'><label style='font-weight:normal'>Restart By</label></br><input type='text' id='" + this.InsertListDialog[0].id + "_restartBy'/> <div id='" + this.InsertListDialog[0].id + "_restartbyList' ></td> </tr></br> ";
            table.innerHTML += "<tr><td><label>Indents</label></td></tr><tr><td style='font-size:12px'><label style='font-weight:normal'>Text indent at</label></br><input type='text' id='" + this.InsertListDialog[0].id + "_textIndent'/></td><td style='font-size:12px'><label style='font-weight:normal'>Aligned At</label></br><input type='text' id='" + this.InsertListDialog[0].id + "_alignedAt'/></br></td></tr><tr><td style='font-size:12px'><label style='font-weight:normal'>Follow Number With</label></br><input type='text' id='" + this.InsertListDialog[0].id + "_followCharacter'></br></td></tr>";
            innerDiv.appendChild(table);
            var fontBtn = instance.OwnerControl.ej.buildTag("input", "", { "margin-left": "0px", "position": "relative" }, {
                "type": "button", "id": instance.InsertListDialog[0].id + "_font", "value": "Font"
            });
            var okBtn = instance.OwnerControl.ej.buildTag("input", "", { "margin-left": "0px", "left": "160px", "position": "relative" }, {
                "type": "button", "id": instance.InsertListDialog[0].id + "_ok", "value": "OK"
            });
            var cancelBtn = instance.OwnerControl.ej.buildTag("input", "", { "margin-left": "0px", "left": "190px", "position": "relative" }, {
                "type": "button", "id": instance.InsertListDialog[0].id + "_cancel", "value": "Cancel"
            });
            cancelBtn.ejButton({
                width: "90px",
                height: "23px",
                click: function (args) {
                    instance._DisposeBindingForListUI();
                    if (!args.cancel)
                        instance.InsertListDialog.ejDialog("close");
                }
            });
            okBtn.ejButton({
                width: "90px",
                height: "23px",
                click: function (args) {
                    instance._OnApplyListButton();
                }
            });
            fontBtn.ejButton({
                width: "90px",
                height: "23px",
                click: function (args) {
                    instance._ShowFontDialog();
                }
            });
            innerDiv.appendChild(fontBtn[0]);
            innerDiv.appendChild(okBtn[0]);
            innerDiv.appendChild(cancelBtn[0]);
            instance.InsertListDialog[0].appendChild(innerDiv);
            var startAtTextBox = instance.InsertListDialog.find("#" + instance.InsertListDialog[0].id + "_startAt");
            var textIndentAtTextBox = instance.InsertListDialog.find("#" + instance.InsertListDialog[0].id + "_textIndent");
            var alignedAtTextBox = instance.InsertListDialog.find("#" + instance.InsertListDialog[0].id + "_alignedAt");
            startAtTextBox.ejNumericTextbox({
                minValue: 0,
                maxValue: 50,
                width: "200px",
                height: 25,
                enablePersistence: false,
                change: function (args) {
                    instance.viewModel.ListLevel.StartAt = args.value;
                }
            });
            textIndentAtTextBox.ejNumericTextbox({
                maxValue: 1584,
                incrementStep: 4,
                width: "200px",
                height: 25,
                enablePersistence: false,
                change: function (args) {
                    instance.viewModel.ListLevel.ParagraphFormat.LeftIndent = args.value;
                }
            });
            alignedAtTextBox.ejNumericTextbox({
                maxValue: 1584,
                incrementStep: 6,
                width: "200px",
                height: 25,
                enablePersistence: false,
                change: function (args) {
                    instance.viewModel.ListLevel.ParagraphFormat.FirstLineIndent = args.value;
                }
            });
            var followCharacter = this.InsertListDialog.find("#" + this.InsertListDialog[0].id + "_followCharacter");
            var restartBy = this.InsertListDialog.find("#" + this.InsertListDialog[0].id + "_restartBy");
            var listLevel = this.InsertListDialog.find("#" + this.InsertListDialog[0].id + "_listlevel");
            var numberStyle = this.InsertListDialog.find("#" + this.InsertListDialog[0].id + "_numberStyle");
            followCharacter.ejDropDownList({
                dataSource: ["Tab", "Space", "None"],
                width: "200px",
                height: 25,
                select: function (args) {
                    instance._OnFollowCharacterValueChanged(args.value);
                }
            });
            restartBy.ejDropDownList({
                select: "restartBy",
                dataSource: ["No Restart"],
                width: "200px",
                height: 25,
                selectedItemIndex: 0
            });
            listLevel.ejDropDownList({
                dataSource: ["Level 1", "Level 2", "Level 3", "Level 4", "Level 5", "Level 6", "Level 7", "Level 8", "Level 9"],
                width: "200px",
                selectedItemIndex: 0,
                height: 25,
                select: function (args) {
                    instance.viewModel.LevelNumber = args.itemId;
                    instance._OnListLevelChanged();
                }
            });
            numberStyle.ejDropDownList({
                dataSource: ["Arabic", "UpRoman", "LowRoman", "Up Letter", "Low Letter", "Number", "Leading Zero", "Bullet", "Ordinal", "Ordinal Text", "Special", "Far East"],
                width: "200px",
                height: 25,
                select: function (args) {
                    instance._OnLevelPatternValueChanged(args);
                },
                change: function (args) {
                    instance._OnLevelPatternValueChanged(args);
                }
            });
        };
        LayoutViewer.prototype._InitAlertDialog = function () {
            var instance = this;
            instance.InsertAlertDialog = instance.OwnerControl.ej.buildTag("div", "", { "display": "none" }, { "id": "documentEditor_" + instance.OwnerControl.ContainerId + "_InsertAlertDialog", "title": "DocumentEditor" });
            instance.OwnerControl.DocumentEditorElement.appendChild(instance.InsertAlertDialog[0]);
        };
        LayoutViewer.prototype._InitCellMarginsDialog = function () {
            var instance = this;
            instance.InsertCellMarginsDialog = instance.OwnerControl.ej.buildTag("div", "", { "display": "none", "width": "500px" }, { "id": "documentEditor_" + instance.OwnerControl.ContainerId + "_insertCellMarginsDialog", "title": "Table Options" });
            instance.OwnerControl.DocumentEditorElement.appendChild(instance.InsertCellMarginsDialog[0]);
            var innerDiv = document.createElement("div");
            innerDiv.innerText = "Default cell Margins";
            innerDiv.style.fontSize = "12px";
            innerDiv.style.padding = "10px";
            innerDiv.style.color = "blue";
            var table = document.createElement("TABLE");
            table.style.padding = "10px";
            table.innerHTML += "<tr style='height: 50px;color:black;'><td style= 'width:70%'>Top<br/><input type='text' id= '" + this.InsertCellMarginsDialog[0].id + "_Top' style= 'width:25%' /></td><td style= 'width:70%'>Left<input type='text' id= '" + this.InsertCellMarginsDialog[0].id + "_left' style= 'width:100%' /></td></tr><tr style='height:50px;color:black;'><td style= 'width:40%'>Bottom<input type='text' id= '" + this.InsertCellMarginsDialog[0].id + "_bottom' style= 'width:100%' /></td><td style= 'width:40%'>Right<input type='text' id= '" + this.InsertCellMarginsDialog[0].id + "_right' style= 'width:100%' /></td></tr>";
            innerDiv.appendChild(table);
            var okBtn = instance.OwnerControl.ej.buildTag("input", "", { "margin-left": "0px", "width": "65px", "left": "170px", "position": "relative" }, {
                "type": "button", "id": instance.InsertCellMarginsDialog[0].id + "_ok", "value": "OK"
            });
            okBtn.ejButton({
                width: 75
            });
            var cancelBtn = instance.OwnerControl.ej.buildTag("input", "", { "margin-left": "0px", "width": "65px", "left": "190px", "position": "relative" }, { "id": instance.InsertCellMarginsDialog[0].id + "_cancel", "type": "button", "value": "Cancel" });
            cancelBtn.ejButton({
                click: function (args) {
                    if (!args.cancel)
                        instance.InsertCellMarginsDialog.ejDialog("close");
                },
                width: 75
            });
            var borderdiv = document.createElement("div");
            borderdiv.style.lineHeight = "1px";
            borderdiv.style.height = "1px";
            borderdiv.style.backgroundColor = " #D9D9D9";
            borderdiv.style.width = "100%";
            var div = document.createElement("div");
            div.innerText = "Default Cell spacing";
            div.style.fontSize = "12px";
            div.style.color = "blue";
            div.style.padding = "10px";
            var table2 = document.createElement("table");
            table2.style.padding = "10px";
            table2.style.height = "75px";
            table2.innerHTML += "<tr><td style='width:70%'><input type='checkbox' id= '" + this.InsertCellMarginsDialog[0].id + "_cellcheck' style= 'width:25%' /></td><td><input type='text' id= '" + this.InsertCellMarginsDialog[0].id + "_cellspacing' style= 'width:25%' /></td></tr>";
            div.appendChild(table2);
            var divBtn = document.createElement("div");
            divBtn.appendChild(okBtn[0]);
            divBtn.appendChild(cancelBtn[0]);
            instance.InsertCellMarginsDialog[0].appendChild(innerDiv);
            instance.InsertCellMarginsDialog[0].appendChild(borderdiv);
            instance.InsertCellMarginsDialog[0].appendChild(div);
            instance.InsertCellMarginsDialog[0].appendChild(divBtn);
            var topTextBox = instance.InsertCellMarginsDialog.find("#" + instance.InsertCellMarginsDialog[0].id + "_Top");
            topTextBox.ejNumericTextbox({
                value: 0,
                minValue: 0,
                width: 100,
                height: 25,
                decimalPlaces: 2,
                enablePersistence: false
            });
            var leftTextBox = instance.InsertCellMarginsDialog.find("#" + instance.InsertCellMarginsDialog[0].id + "_left");
            leftTextBox.ejNumericTextbox({
                value: 0,
                minValue: 0,
                width: 100,
                height: 25,
                decimalPlaces: 2,
                enablePersistence: false
            });
            var bottomTextBox = instance.InsertCellMarginsDialog.find("#" + instance.InsertCellMarginsDialog[0].id + "_bottom");
            bottomTextBox.ejNumericTextbox({
                value: 0,
                minValue: 0,
                width: 100,
                height: 25,
                decimalPlaces: 2,
                enablePersistence: false
            });
            var rightTextBox = instance.InsertCellMarginsDialog.find("#" + instance.InsertCellMarginsDialog[0].id + "_right");
            rightTextBox.ejNumericTextbox({
                value: 0,
                minValue: 0,
                width: 100,
                height: 25,
                decimalPlaces: 2,
                enablePersistence: false
            });
            var cellspacingTextBox = instance.InsertCellMarginsDialog.find("#" + instance.InsertCellMarginsDialog[0].id + "_cellspacing");
            cellspacingTextBox.ejNumericTextbox({
                value: 0,
                minValue: 0,
                width: 100,
                height: 25,
                decimalPlaces: 2,
                enablePersistence: false
            });
            var cellCheckBox = instance.InsertCellMarginsDialog.find("#" + instance.InsertCellMarginsDialog[0].id + "_cellcheck");
            cellCheckBox.ejCheckBox({
                text: "Allow Spacing between cells",
                width: 100,
                change: function (args) {
                    if (args.isChecked)
                        cellspacingTextBox.ejNumericTextbox("enable");
                    else
                        cellspacingTextBox.ejNumericTextbox("disable");
                }
            });
            cellspacingTextBox.ejNumericTextbox("disable");
        };
        LayoutViewer.prototype._InitTablePropertyDialog = function () {
            var instance = this;
            instance.TablePropertiesDialog = instance.OwnerControl.ej.buildTag("div", "", { "display": "none" }, { "id": instance.OwnerControl.ContainerId + "_TablePropertiesDialog", "title": "Table Properties" });
            instance.OwnerControl.DocumentEditorElement.appendChild(instance.TablePropertiesDialog[0]);
            var ejtabContainer = document.createElement("div");
            var ejtab = instance.OwnerControl.ej.buildTag("div", "", { "height": "auto" }, { "id": instance.OwnerControl.ContainerId + "_TablePropertiesDialogTab" });
            var ul = document.createElement("ul");
            ul.innerHTML = "<li><a href=" + "#" + instance.TablePropertiesDialog[0].id + "_TableProperties" + ">Table</a></li><li><a href=" + "#" + instance.TablePropertiesDialog[0].id + "_TableRowProperties" + ">Row</a></li><li><a href=" + "#" + instance.TablePropertiesDialog[0].id + "_TableCellProperties" + ">Cell</a></li>";
            var tableProperty = instance.OwnerControl.ej.buildTag("div", "", { "padding-bottom": "0px", "padding-top": "8px", }, { "id": instance.TablePropertiesDialog[0].id + "_TableProperties" });
            var tableRowProperty = instance.OwnerControl.ej.buildTag("div", "", { "padding-bottom": "0px", "padding-top": "8px" }, { "id": instance.TablePropertiesDialog[0].id + "_TableRowProperties" });
            var tableCellProperty = instance.OwnerControl.ej.buildTag("div", "", { "padding-bottom": "0px", "padding-top": "8px" }, { "id": instance.TablePropertiesDialog[0].id + "_TableCellProperties" });
            this._InitTableProperties(tableProperty[0]);
            this._InitTableRowProperties(tableRowProperty[0]);
            this._InitTableCellProprties(tableCellProperty[0]);
            ejtabContainer.appendChild(ejtab[0]);
            ejtab[0].appendChild(ul);
            ejtab[0].appendChild(tableProperty[0]);
            ejtab[0].appendChild(tableRowProperty[0]);
            ejtab[0].appendChild(tableCellProperty[0]);
            var applyProperties = document.createElement("div");
            applyProperties.style.cssFloat = "right";
            var ok = instance.OwnerControl.ej.buildTag("button", "Ok", { "margin-bottom": "5px", "margin-top": "6px", "margin-right": "10px" }, { "id": instance.TablePropertiesDialog[0].id + "_ok", });
            var cancel = instance.OwnerControl.ej.buildTag("button", "Cancel", { "margin-bottom": "5px", "margin-top": "6px", "margin-right": "10px" }, { "id": instance.TablePropertiesDialog[0].id + "_cancel", });
            cancel.ejButton({
                click: function (args) {
                    if (!args.cancel)
                        instance.TablePropertiesDialog.ejDialog("close");
                }
            });
            ok.ejButton({ showRoundedCorner: false, size: "small" });
            ok.ejButton({
                click: function () {
                    instance.TablePropertiesDialog.ejDialog("close");
                    instance._OnInsertTableProperties();
                }
            });
            cancel.ejButton({ showRoundedCorner: false, size: "small" });
            applyProperties.appendChild(ok[0]);
            applyProperties.appendChild(cancel[0]);
            ejtabContainer.appendChild(applyProperties);
            instance.TablePropertiesDialog[0].appendChild(ejtabContainer);
            ejtab.ejTab({ height: "350px", width: "auto" });
            tableProperty[0].style.height = "300px";
            tableRowProperty[0].style.height = "300px";
            tableCellProperty[0].style.height = "300px";
            instance.TablePropertiesDialog.ejDialog({ showOnInit: false, width: "500px", enableResize: false });
            instance.TablePropertiesDialog.ejDialog({
                close: function () {
                    instance._UpdateClassForAlignmetProperties();
                    instance._UpdateClassForCellAlignment();
                }
            });
            var alignMentButton = instance.TablePropertiesDialog.find('.' + tableProperty[0].id + 'e-de-table-alignment');
            for (var i = 0; i < alignMentButton.length; i++) {
                alignMentButton[i].addEventListener('click', function (e) {
                    instance._UpdateClassForAlignmetProperties();
                    var id = e.target.id;
                    var htmlElement = document.getElementById(id);
                    var className = htmlElement.className;
                    className = className.replace('e-de-table-properties-alignment', 'e-de-table-alignment-active');
                    htmlElement.className = className;
                });
            }
            var cellAlignment = instance.TablePropertiesDialog.find('.' + tableCellProperty[0].id + 'e-de-table-cell-alignment');
            for (var i = 0; i < cellAlignment.length; i++) {
                cellAlignment[i].addEventListener('click', function (e) {
                    instance._UpdateClassForCellAlignment();
                    var id = e.target.id;
                    var htmlElement = document.getElementById(id);
                    var className = htmlElement.className;
                    className = className.replace('e-de-tablecell-alignment', 'e-de-table-alignment-active');
                    htmlElement.className = className;
                });
            }
        };
        LayoutViewer.prototype._InitBordersShadingsPropertiesDialog = function () {
            var instance = this;
            instance.TableBorderAndShadingDialog = instance.OwnerControl.ej.buildTag("div", "", { "display": "none" }, { "id": instance.OwnerControl.ContainerId + "_table_border_shadings", "title": "Borders and Shading" });
            var DisplayText = instance.OwnerControl.ej.buildTag("div", "Borders", { "color": "#6db4df", "width": "100%", "display": "block", "float": "left", "margin-bottom": "10px" });
            var settingsContiner = instance.OwnerControl.ej.buildTag("div", "", { "display": "inline-block", "position": "absolute", "left": "15px", "top": "30px", "width": "100px", "height": "235px", "padding": "0px", "border-style": "none" }, { "id": instance.TableBorderAndShadingDialog[0].id + "_border_settings" });
            var styleContainer = instance.OwnerControl.ej.buildTag("div", "", { "display": "inline-block", "position": "absolute", "left": "125px", "top": "30px", "width": "130px", "height": "235px", "padding-left": "5px", "border-style": "none" }, { "id": instance.TableBorderAndShadingDialog[0].id + "_border_style" });
            var previewContiner = instance.OwnerControl.ej.buildTag("div", "", { "display": "inline-block", "position": "absolute", "left": "245px", "top": "30px", "width": "170px", "height": "235px", "padding": "0px", "border-style": "none" }, { "id": instance.TableBorderAndShadingDialog[0].id + "_border_preview" });
            var listElement = "";
            var borderStyleContainer = [
                { text: "None" }, { text: "Single" }, { text: "Dot" }, { text: "DashSmallGap" }, { text: "DashLargeGap" }, { text: "DashDot" }, { text: "DashDotDot" }, { text: "Double" }, { text: "Triple" }, { text: "ThinThickSmallGap" }, { text: "ThickThinSmallGap" }, { text: "ThinThickThinSmallGap" }, { text: "ThinThickMediumGap" },
                { text: "ThickThinMediumGap" }, { text: "ThinThickThinMediumGap" }, { text: "ThinThickLargeGap" }, { text: "ThickThinLargeGap" }, { text: "ThinThickThinLargeGap" }, { text: "SingleWavy" }, { text: "DoubleWavy" }, { text: "DashDotStroked " }, { text: "Emboss3D" }, { text: "Engrave3D" },
                { text: "Outset" }, { text: "Inset" }, { text: "Thick" }];
            var styleText = instance.OwnerControl.ej.buildTag("div", "Style", { "width": "100%", "margin-bottom": "7px" });
            var dropDownList = instance.OwnerControl.ej.buildTag("input", "", { "display": "inline" }, { "id": instance.TableBorderAndShadingDialog[0].id + "_border_style_dropDown", "type": "text" });
            var widthText = instance.OwnerControl.ej.buildTag("div", "Width", { "width": "100%", "margin-bottom": "7px", "margin-top": "7px" });
            var widthNumeric = instance.OwnerControl.ej.buildTag("input", "", { "width": "100%" }, { "id": instance.TableBorderAndShadingDialog[0].id + "_width", "type": "text" });
            var ColorText = instance.OwnerControl.ej.buildTag("div", "Color", { "width": "100%", "margin-bottom": "7px", "margin-top": "7px" });
            var colorPicker = instance.OwnerControl.ej.buildTag("input", "", "", { "id": instance.TableBorderAndShadingDialog[0].id + "_border_color", "type": "text" });
            var divline = instance.OwnerControl.ej.buildTag("div", "", { "width": "420px", "margin-top": "8px", "margin-bottom": "8px", "padding": "0px", "height": "0px", "border-style": "solid", "border-color": "#e9e9e9", "border-width": "1px", "position": "absolute", "top": "250px" });
            var settingText = instance.OwnerControl.ej.buildTag("div", "Setting", { "width": "100%", "margin-bottom": "7px" });
            var noneDivContainer = instance.OwnerControl.ej.buildTag("div", "", { "top": "25px", "position": "absolute" }, { "id": instance.TableBorderAndShadingDialog[0].id + "_None_Div_Container" });
            var noneDiv = instance.OwnerControl.ej.buildTag("div", "", { "width": "40px", "height": "40px", "border": "1px solid black", "display": "inline-block" }, { "id": instance.TableBorderAndShadingDialog[0].id + "_None_Div" });
            var noneDivLabel = instance.OwnerControl.ej.buildTag("label", "None", { "font-size": "11px", "font-weight": "normal", "margin-left": "10px", "top": "15px", "position": "absolute" }, { "for": instance.TableBorderAndShadingDialog[0].id + "_None_Div_Label" });
            var boxDivContainer = instance.OwnerControl.ej.buildTag("div", "", { "top": "75px", "position": "absolute" }, { "id": instance.TableBorderAndShadingDialog[0].id + "_Box_Div_Container" });
            var boxDiv = instance.OwnerControl.ej.buildTag("div", "", { "width": "40px", "height": "40px", "border": "1px solid black", "display": "inline-block" }, { "id": instance.TableBorderAndShadingDialog[0].id + "_Box_Div" });
            var boxDivLabel = instance.OwnerControl.ej.buildTag("label", "Box", { "font-size": "11px", "font-weight": "normal", "margin-left": "10px", "top": "15px", "position": "absolute" }, { "for": instance.TableBorderAndShadingDialog[0].id + "_Box_Div_Label" });
            var allDivContainer = instance.OwnerControl.ej.buildTag("div", "", { "top": "125px", "position": "absolute" }, { "id": instance.TableBorderAndShadingDialog[0].id + "_All_Div_Container" });
            var allDiv = instance.OwnerControl.ej.buildTag("div", "", { "width": "40px", "height": "40px", "border": "1px solid black", "display": "inline-block" }, { "id": instance.TableBorderAndShadingDialog[0].id + "_All_Div" });
            var allDivLabel = instance.OwnerControl.ej.buildTag("label", "All", { "font-size": "11px", "font-weight": "normal", "margin-left": "10px", "top": "15px", "position": "absolute" }, { "for": instance.TableBorderAndShadingDialog[0].id + "_All_Div_Label" });
            var customDivContainer = instance.OwnerControl.ej.buildTag("div", "", { "top": "175px", "position": "absolute" }, { "id": instance.TableBorderAndShadingDialog[0].id + "_Custom_Div_Container" });
            var customDiv = instance.OwnerControl.ej.buildTag("div", "", { "width": "40px", "height": "40px", "border": "1px solid black", "display": "inline-block" }, { "id": instance.TableBorderAndShadingDialog[0].id + "_Custom_Div" });
            var customDivLabel = instance.OwnerControl.ej.buildTag("label", "Custom", { "font-size": "11px", "font-weight": "normal", "margin-left": "10px", "top": "15px", "position": "absolute" }, { "for": instance.TableBorderAndShadingDialog[0].id + "_Custom_Div_Label" });
            var noneDivTransparent = instance.OwnerControl.ej.buildTag("div", "", "", { "id": instance.TableBorderAndShadingDialog[0].id + "_None_Div_Transparent", "class": "e-de-table-border-setting" });
            var boxDivTransparent = instance.OwnerControl.ej.buildTag("div", "", "", { "id": instance.TableBorderAndShadingDialog[0].id + "_Box_Div_Transparent", "class": "e-de-table-border-setting" });
            var allDivTransparent = instance.OwnerControl.ej.buildTag("div", "", "", { "id": instance.TableBorderAndShadingDialog[0].id + "_All_Div_Transparent", "class": "e-de-table-border-setting" });
            var customDivTransparent = instance.OwnerControl.ej.buildTag("div", "", "", { "id": instance.TableBorderAndShadingDialog[0].id + "_Custom_Div_Transparent", "class": "e-de-table-border-setting" });
            var previewText = instance.OwnerControl.ej.buildTag("div", "Preview", { "width": "100%", "margin-bottom": "7px" });
            noneDivContainer.on("click", function (event) {
                instance._HandleSettingCheckBoxAction(event);
            });
            boxDivContainer.on("click", function (event) {
                instance._HandleSettingCheckBoxAction(event);
            });
            allDivContainer.on("click", function (event) {
                instance._HandleSettingCheckBoxAction(event);
            });
            customDivContainer.on("click", function (event) {
                instance._HandleSettingCheckBoxAction(event);
            });
            var previewDiv = instance.OwnerControl.ej.buildTag("div", "", {
                "width": "80px",
                "height": "80px",
                "border": "1px solid black",
                "position": "absolute",
                "left": "50px",
                "top": "50px"
            }, { "id": instance.TableBorderAndShadingDialog[0].id + "_Preview_Div" });
            var previewRightDiagonalDiv = instance.OwnerControl.ej.buildTag("div", "", {
                "position": "absolute",
                "width": "1px",
                "height": "113px",
                "background-color": "grey",
                "left": "88px",
                "top": "34px",
                "transform": "rotate(135deg)"
            }, { "id": instance.TableBorderAndShadingDialog[0].id + "_Preview_Div_Right_Diagonal" });
            var previewLeftDiagonalDiv = instance.OwnerControl.ej.buildTag("div", "", {
                "position": "absolute",
                "width": "1px",
                "height": "113px",
                "background-color": "grey",
                "left": "90px",
                "top": "34px",
                "transform": "rotate(45deg)"
            }, { "id": instance.TableBorderAndShadingDialog[0].id + "_Preview_Div_Left_Diagonal" });
            var previewVerticalDiv = instance.OwnerControl.ej.buildTag("div", "", {
                "width": "1px",
                "height": "81px",
                "background-color": "grey",
                "position": "absolute",
                "left": "90px",
                "top": "50px",
            }, { "id": instance.TableBorderAndShadingDialog[0].id + "_Preview_Div_Vertical" });
            var previewHorizontalDiv = instance.OwnerControl.ej.buildTag("div", "", {
                "width": "81px",
                "height": "1px",
                "background-color": "grey",
                "position": "absolute",
                "left": "50px",
                "top": "90px",
            }, { "id": instance.TableBorderAndShadingDialog[0].id + "_Preview_Div_Horizontal" });
            var previewDivTopTopContainer = instance.OwnerControl.ej.buildTag("div", "", {
                "top": "50px", "position": "absolute", "left": "10px"
            }, { "id": instance.TableBorderAndShadingDialog[0].id + "_Preview_Div_TopTop_Container" });
            var previewDivTopTop = instance.OwnerControl.ej.buildTag("div", "", {
                "width": "20px", "height": "20px", "border": "1px solid black", "display": "inline-block"
            }, { "id": instance.TableBorderAndShadingDialog[0].id + "_Preview_Div_TopTop" });
            var previewDivTopCenterContainer = instance.OwnerControl.ej.buildTag("div", "", {
                "top": "80px", "position": "absolute", "left": "10px"
            }, { "id": instance.TableBorderAndShadingDialog[0].id + "_Preview_Div_TopCenter_Container" });
            var previewDivTopCenter = instance.OwnerControl.ej.buildTag("div", "", {
                "width": "20px", "height": "20px", "border": "1px solid black", "display": "inline-block"
            }, { "id": instance.TableBorderAndShadingDialog[0].id + "_Preview_Div_TopCenter" });
            var previewDivTopBottomContainer = instance.OwnerControl.ej.buildTag("div", "", {
                "top": "110px", "position": "absolute", "left": "10px"
            }, { "id": instance.TableBorderAndShadingDialog[0].id + "_Preview_Div_TopBottom_Container" });
            var previewDivTopBottom = instance.OwnerControl.ej.buildTag("div", "", {
                "width": "20px", "height": "20px", "border": "1px solid black", "display": "inline-block"
            }, { "id": instance.TableBorderAndShadingDialog[0].id + "_Preview_Div_TopBottom" });
            var previewDivLeftDiagonalContainer = instance.OwnerControl.ej.buildTag("div", "", {
                "top": "150px", "position": "absolute", "left": "10px"
            }, { "id": instance.TableBorderAndShadingDialog[0].id + "_Preview_Div_LeftDiagonal_Container" });
            var previewDivLeftDiagonal = instance.OwnerControl.ej.buildTag("div", "", {
                "width": "20px", "height": "20px", "border": "1px solid black", "display": "inline-block"
            }, { "id": instance.TableBorderAndShadingDialog[0].id + "_Preview_Div_LeftDiagonal" });
            var previewDivBottomLeftContainer = instance.OwnerControl.ej.buildTag("div", "", {
                "top": "150px", "position": "absolute", "left": "50px"
            }, { "id": instance.TableBorderAndShadingDialog[0].id + "_Preview_Div_BottomLeft_Container" });
            var previewDivBottomLeft = instance.OwnerControl.ej.buildTag("div", "", {
                "width": "20px", "height": "20px", "border": "1px solid black", "display": "inline-block"
            }, { "id": instance.TableBorderAndShadingDialog[0].id + "_Preview_Div_BottomLeft" });
            var previewDivBottomcenterContainer = instance.OwnerControl.ej.buildTag("div", "", {
                "top": "150px", "position": "absolute", "left": "80px"
            }, { "id": instance.TableBorderAndShadingDialog[0].id + "_Preview_Div_BottomCenter_Container" });
            var previewDivBottomcenter = instance.OwnerControl.ej.buildTag("div", "", {
                "width": "20px", "height": "20px", "border": "1px solid black", "display": "inline-block"
            }, { "id": instance.TableBorderAndShadingDialog[0].id + "_Preview_Div_BottomCenter" });
            var previewDivBottomRightContainer = instance.OwnerControl.ej.buildTag("div", "", {
                "top": "150px", "position": "absolute", "left": "110px"
            }, { "id": instance.TableBorderAndShadingDialog[0].id + "_Preview_Div_BottomRight_Container" });
            var previewDivBottomRight = instance.OwnerControl.ej.buildTag("div", "", {
                "width": "20px", "height": "20px", "border": "1px solid black", "display": "inline-block"
            }, { "id": instance.TableBorderAndShadingDialog[0].id + "_Preview_Div_BottomRight" });
            var previewDivDiagonalRightContainer = instance.OwnerControl.ej.buildTag("div", "", {
                "top": "150px", "position": "absolute", "left": "150px"
            }, { "id": instance.TableBorderAndShadingDialog[0].id + "_Preview_Div_RightDiagonal_Container" });
            var previewDivDiagonalRight = instance.OwnerControl.ej.buildTag("div", "", {
                "width": "20px", "height": "20px", "border": "1px solid black", "display": "inline-block"
            }, { "id": instance.TableBorderAndShadingDialog[0].id + "_Preview_Div_RightDiagonal" });
            var previewDivTopTopTransParent = instance.OwnerControl.ej.buildTag("div", "", "", { "id": instance.TableBorderAndShadingDialog[0].id + "_previewDivTopTopTransParent", "class": "e-de-table-border-preview" });
            var previewDivTopCenterTransParent = instance.OwnerControl.ej.buildTag("div", "", "", { "id": instance.TableBorderAndShadingDialog[0].id + "_previewDivTopCenterTransParent", "class": "e-de-table-border-preview" });
            var previewDivTopBottomTransParent = instance.OwnerControl.ej.buildTag("div", "", "", { "id": instance.TableBorderAndShadingDialog[0].id + "_previewDivTopBottomTransParent", "class": "e-de-table-border-preview" });
            var previewDivLeftDiagonalTransParent = instance.OwnerControl.ej.buildTag("div", "", "", { "id": instance.TableBorderAndShadingDialog[0].id + "_previewDivLeftDiagonalTransParent", "class": "e-de-table-border-preview" });
            var previewDivBottomLeftTransparent = instance.OwnerControl.ej.buildTag("div", "", "", { "id": instance.TableBorderAndShadingDialog[0].id + "_previewDivBottomLeftTransparent", "class": "e-de-table-border-preview" });
            var previewDivBottomcenterTransparent = instance.OwnerControl.ej.buildTag("div", "", "", { "id": instance.TableBorderAndShadingDialog[0].id + "_previewDivBottomcenterTransparent", "class": "e-de-table-border-preview" });
            var previewDivBottomRightTransparent = instance.OwnerControl.ej.buildTag("div", "", "", { "id": instance.TableBorderAndShadingDialog[0].id + "_previewDivBottomRightTransparent", "class": "e-de-table-border-preview" });
            var previewDivDiagonalRightTransparent = instance.OwnerControl.ej.buildTag("div", "", "", { "id": instance.TableBorderAndShadingDialog[0].id + "_previewDivDiagonalRightTransparent", "class": "e-de-table-border-preview" });
            previewDivBottomcenterContainer.on("click", function (event) {
                instance._HandlePreviewCheckBoxAction(event);
            });
            previewDivBottomLeftContainer.on("click", function (event) {
                instance._HandlePreviewCheckBoxAction(event);
            });
            previewDivBottomRightContainer.on("click", function (event) {
                instance._HandlePreviewCheckBoxAction(event);
            });
            previewDivTopTopContainer.on("click", function (event) {
                instance._HandlePreviewCheckBoxAction(event);
            });
            previewDivTopBottomContainer.on("click", function (event) {
                instance._HandlePreviewCheckBoxAction(event);
            });
            previewDivTopCenterContainer.on("click", function (event) {
                instance._HandlePreviewCheckBoxAction(event);
            });
            previewDivDiagonalRightContainer.on("click", function (event) {
                instance._HandlePreviewCheckBoxAction(event);
            });
            previewDivLeftDiagonalContainer.on("click", function (event) {
                instance._HandlePreviewCheckBoxAction(event);
            });
            var shadingContiner = instance.OwnerControl.ej.buildTag("div", "", { "display": "inline-block", "position": "absolute", "left": "15px", "top": "255px", "width": "400px", "height": "130px", "padding": "0px", "border-style": "none" }, { "id": instance.TableBorderAndShadingDialog[0].id + "_shading_preview" });
            var shadingText = instance.OwnerControl.ej.buildTag("div", "Shading", { "width": "100%", "margin-top": "10px", "margin-bottom": "10px", "color": "#6db4df" });
            var shadings = document.createElement("div");
            var label = document.createElement("div");
            label.setAttribute("style", "float:left;margin-top:5px;margin-right:20px");
            label.innerHTML = "Fill";
            var shadingColorPicker = instance.OwnerControl.ej.buildTag("input", "", "", { "id": instance.TableBorderAndShadingDialog[0].id + "_shading_color", "type": "text" });
            var shdApply = document.createElement("div");
            shdApply.setAttribute("style", "position:absolute;top:45px;left:230px;width:180px");
            var div = document.createElement("div");
            div.setAttribute("style", "width:100px;padding-top:4px;margin-right:5px");
            ;
            div.innerHTML = "Apply To";
            var divsion = document.createElement("div");
            divsion.setAttribute("style", "width:100px;position:absolute;left:60px;top:0px");
            var dropDownShading = instance.OwnerControl.ej.buildTag("input", "", "", { "type": "text", "id": instance.TableBorderAndShadingDialog[0].id + "_Apply_To" });
            var ulelementShading = instance.OwnerControl.ej.buildTag("ul", "<li>Cell</li><li>Table</li>", "", { "id": instance.TableBorderAndShadingDialog[0].id + "_shading" });
            divsion.appendChild(dropDownShading[0]);
            divsion.appendChild(ulelementShading[0]);
            noneDiv[0].appendChild(noneDivTransparent[0]);
            boxDiv[0].appendChild(boxDivTransparent[0]);
            allDiv[0].appendChild(allDivTransparent[0]);
            customDiv[0].appendChild(customDivTransparent[0]);
            noneDivContainer[0].appendChild(noneDiv[0]);
            noneDivContainer[0].appendChild(noneDivLabel[0]);
            boxDivContainer[0].appendChild(boxDiv[0]);
            boxDivContainer[0].appendChild(boxDivLabel[0]);
            allDivContainer[0].appendChild(allDiv[0]);
            allDivContainer[0].appendChild(allDivLabel[0]);
            customDivContainer[0].appendChild(customDiv[0]);
            customDivContainer[0].appendChild(customDivLabel[0]);
            settingsContiner[0].appendChild(settingText[0]);
            settingsContiner[0].appendChild(noneDivContainer[0]);
            settingsContiner[0].appendChild(boxDivContainer[0]);
            settingsContiner[0].appendChild(allDivContainer[0]);
            settingsContiner[0].appendChild(customDivContainer[0]);
            previewDivBottomcenter[0].appendChild(previewDivBottomcenterTransparent[0]);
            previewDivBottomRight[0].appendChild(previewDivBottomRightTransparent[0]);
            previewDivBottomLeft[0].appendChild(previewDivBottomLeftTransparent[0]);
            previewDivTopTop[0].appendChild(previewDivTopTopTransParent[0]);
            previewDivTopCenter[0].appendChild(previewDivTopCenterTransParent[0]);
            previewDivTopBottom[0].appendChild(previewDivTopBottomTransParent[0]);
            previewDivDiagonalRight[0].appendChild(previewDivDiagonalRightTransparent[0]);
            previewDivLeftDiagonal[0].appendChild(previewDivLeftDiagonalTransParent[0]);
            previewDivBottomcenterContainer[0].appendChild(previewDivBottomcenter[0]);
            previewDivBottomLeftContainer[0].appendChild(previewDivBottomLeft[0]);
            previewDivBottomRightContainer[0].appendChild(previewDivBottomRight[0]);
            previewDivDiagonalRightContainer[0].appendChild(previewDivDiagonalRight[0]);
            previewDivLeftDiagonalContainer[0].appendChild(previewDivLeftDiagonal[0]);
            previewDivTopBottomContainer[0].appendChild(previewDivTopBottom[0]);
            previewDivTopCenterContainer[0].appendChild(previewDivTopCenter[0]);
            previewDivTopTopContainer[0].appendChild(previewDivTopTop[0]);
            previewContiner[0].appendChild(previewText[0]);
            previewContiner[0].appendChild(previewDiv[0]);
            previewContiner[0].appendChild(previewRightDiagonalDiv[0]);
            previewContiner[0].appendChild(previewHorizontalDiv[0]);
            previewContiner[0].appendChild(previewLeftDiagonalDiv[0]);
            previewContiner[0].appendChild(previewVerticalDiv[0]);
            previewContiner[0].appendChild(previewDivBottomcenterContainer[0]);
            previewContiner[0].appendChild(previewDivBottomLeftContainer[0]);
            previewContiner[0].appendChild(previewDivBottomRightContainer[0]);
            previewContiner[0].appendChild(previewDivDiagonalRightContainer[0]);
            previewContiner[0].appendChild(previewDivLeftDiagonalContainer[0]);
            previewContiner[0].appendChild(previewDivTopBottomContainer[0]);
            previewContiner[0].appendChild(previewDivTopCenterContainer[0]);
            previewContiner[0].appendChild(previewDivTopTopContainer[0]);
            shdApply.appendChild(div);
            shdApply.appendChild(divsion);
            shadings.appendChild(label);
            shadings.appendChild(shadingColorPicker[0]);
            shadings.appendChild(shdApply);
            shadingContiner[0].appendChild(shadingText[0]);
            shadingContiner[0].appendChild(shadings);
            styleContainer[0].appendChild(styleText[0]);
            styleContainer[0].appendChild(dropDownList[0]);
            styleContainer[0].appendChild(widthText[0]);
            styleContainer[0].appendChild(widthNumeric[0]);
            styleContainer[0].appendChild(ColorText[0]);
            styleContainer[0].appendChild(colorPicker[0]);
            var applyProperties = document.createElement("div");
            applyProperties.style.cssFloat = "right";
            applyProperties.style.position = "absolute";
            applyProperties.style.top = "350px";
            applyProperties.style.left = "225px";
            var ok = instance.OwnerControl.ej.buildTag("button", "OK", { "margin-bottom": "5px", "margin-top": "6px", "margin-right": "10px" }, { "id": instance.TablePropertiesDialog[0].id + "_ok", });
            var cancel = instance.OwnerControl.ej.buildTag("button", "Cancel", { "margin-bottom": "5px", "margin-top": "6px", "margin-right": "10px" }, { "id": instance.TablePropertiesDialog[0].id + "_cancel", });
            cancel.ejButton({
                click: function (args) {
                    if (!args.cancel)
                        instance.TableBorderAndShadingDialog.ejDialog("close");
                }
            });
            ok.ejButton({ showRoundedCorner: false, size: "small" });
            ok.ejButton({
                click: function () {
                    instance._InsertTableBorderShadingProperties();
                    instance.TableBorderAndShadingDialog.ejDialog("close");
                }
            });
            cancel.ejButton({ showRoundedCorner: false, size: "small" });
            applyProperties.appendChild(ok[0]);
            applyProperties.appendChild(cancel[0]);
            instance.TableBorderAndShadingDialog[0].appendChild(DisplayText[0]);
            instance.TableBorderAndShadingDialog[0].appendChild(settingsContiner[0]);
            instance.TableBorderAndShadingDialog[0].appendChild(styleContainer[0]);
            instance.TableBorderAndShadingDialog[0].appendChild(previewContiner[0]);
            instance.TableBorderAndShadingDialog[0].appendChild(divline[0]);
            instance.TableBorderAndShadingDialog[0].appendChild(shadingContiner[0]);
            instance.TableBorderAndShadingDialog[0].appendChild(applyProperties);
            dropDownShading.ejDropDownList({ targetID: instance.TableBorderAndShadingDialog[0].id + "_shading", width: "100px", selectedItemIndex: 1 });
            shadingColorPicker.ejColorPicker({ value: "#000000" });
            colorPicker.ejColorPicker({ value: "#000000" });
            dropDownList.ejDropDownList({ dataSource: borderStyleContainer, targetID: instance.TableBorderAndShadingDialog[0].id + "_border_style_dropDown", width: "100px", selectedItemIndex: 0 });
            widthNumeric.ejNumericTextbox({ name: "numeric", value: 0, width: "100px", minValue: 0, maxValue: 6, incrementStep: .25, decimalPlaces: 2 });
            instance.TableBorderAndShadingDialog.ejDialog({ showOnInit: false, width: "450px", height: "500px", enableResize: false, overflow: "none" });
            colorPicker.ejColorPicker({
                select: function (args) {
                    instance._ApplyPreviewTableBorderColor(args);
                }
            });
            shadingColorPicker.ejColorPicker({
                select: function (args) {
                    instance._ApplyPreviewTableBackgroundColor(args);
                }
            });
            dropDownShading.ejDropDownList({
                change: function (args) {
                    instance._ApplyTableCellPreviewBoxes(args);
                }
            });
            this.TableBorderAndShadingDialog.find("#" + this.TableBorderAndShadingDialog[0].id + "_shading_colorWrapper").css("width", "100px");
            this.TableBorderAndShadingDialog.find("#" + this.TableBorderAndShadingDialog[0].id + "_shading_colorWrapper").css("height", "22px");
            this.TableBorderAndShadingDialog.find("#" + this.TableBorderAndShadingDialog[0].id + "_shading_colorWrapper").css("border-radius", "0px");
            this.TableBorderAndShadingDialog.find("#" + this.TableBorderAndShadingDialog[0].id + "_border_colorWrapper").css("width", "100px");
            this.TableBorderAndShadingDialog.find("#" + this.TableBorderAndShadingDialog[0].id + "_border_colorWrapper").css("height", "22px");
            this.TableBorderAndShadingDialog.find("#" + this.TableBorderAndShadingDialog[0].id + "_border_colorWrapper").css("border-radius", "0px");
            this.TableBorderAndShadingDialog.find(".e-selected-color").css("width", "75px");
            this.TableBorderAndShadingDialog.find(".e-selected-color").css("height", "12px");
        };
        LayoutViewer.prototype._InsertTableBorderShadingProperties = function () {
            var bordersAndShadingProperties = this.OwnerControl.TableBoderShadingDialog;
            var tableBorderDialog = this.TableBorderAndShadingDialog;
            var tableBorderDialogId = this.TableBorderAndShadingDialog[0].id;
            var borderStyleDropDown = tableBorderDialog.find("#" + tableBorderDialog[0].id + "_border_style_dropDown");
            var borderWidth = tableBorderDialog.find("#" + tableBorderDialog[0].id + "_width");
            var borderColor = tableBorderDialog.find("#" + tableBorderDialog[0].id + "_border_color");
            var shadingBackgroundColor = tableBorderDialog.find("#" + tableBorderDialog[0].id + "_shading_color");
            var applyTo = tableBorderDialog.find("#" + tableBorderDialog[0].id + "_Apply_To");
            var topTopDiv = tableBorderDialog.find("#" + tableBorderDialog[0].id + "_previewDivTopTopTransParent");
            var topCenterDiv = tableBorderDialog.find("#" + tableBorderDialog[0].id + "_previewDivTopCenterTransParent");
            var topBottomDiv = tableBorderDialog.find("#" + tableBorderDialog[0].id + "_previewDivTopBottomTransParent");
            var leftDiagonalDiv = tableBorderDialog.find("#" + tableBorderDialog[0].id + "_previewDivLeftDiagonalTransParent");
            var rightDiagoalDiv = tableBorderDialog.find("#" + tableBorderDialog[0].id + "_previewDivDiagonalRightTransparent");
            var bottomLeftDiv = tableBorderDialog.find("#" + tableBorderDialog[0].id + "_previewDivBottomLeftTransparent");
            var bottomCenterDiv = tableBorderDialog.find("#" + tableBorderDialog[0].id + "_previewDivBottomcenterTransparent");
            var bottomRightDiv = tableBorderDialog.find("#" + tableBorderDialog[0].id + "_previewDivBottomRightTransparent");
            bordersAndShadingProperties.BorderColor = borderColor.data("ejColorPicker").model.value;
            bordersAndShadingProperties.LineWidth = borderWidth.data("ejNumericTextbox").model.value;
            bordersAndShadingProperties.LineStyle = borderStyleDropDown.data("ejDropDownList").model.selectedIndex;
            bordersAndShadingProperties.ShadingFill = shadingBackgroundColor.data("ejColorPicker").model.value;
            bordersAndShadingProperties.ApplyTo = applyTo.data("ejDropDownList").model.selectedIndex;
            bordersAndShadingProperties.TopBorder = topTopDiv.hasClass("e-de-table-border-preview-click");
            bordersAndShadingProperties.BottomBorder = topBottomDiv.hasClass("e-de-table-border-preview-click");
            bordersAndShadingProperties.LeftBorder = bottomLeftDiv.hasClass("e-de-table-border-preview-click");
            bordersAndShadingProperties.RightBorder = bottomRightDiv.hasClass("e-de-table-border-preview-click");
            bordersAndShadingProperties.HorizontalBorder = topCenterDiv.hasClass("e-de-table-border-preview-click");
            bordersAndShadingProperties.VerticalBorder = bottomCenterDiv.hasClass("e-de-table-border-preview-click");
            bordersAndShadingProperties.DiagonalLeftBorder = leftDiagonalDiv.hasClass("e-de-table-border-preview-click");
            bordersAndShadingProperties.DiagonalRightBorder = rightDiagoalDiv.hasClass("e-de-table-border-preview-click");
            bordersAndShadingProperties._ApplyBordersAndShadingButton_Click();
        };
        LayoutViewer.prototype._ApplyPreviewTableBackgroundColor = function (args) {
            if (this.TableBorderAndShadingDialog != null && args.value != "")
                this.TableBorderAndShadingDialog.find("#" + this.TableBorderAndShadingDialog[0].id + "_Preview_Div")[0].style.backgroundColor = args.value;
        };
        LayoutViewer.prototype._ApplyPreviewTableBorderColor = function (args) {
            var tableBorderDialog = this.TableBorderAndShadingDialog;
            if (tableBorderDialog != null && args.value != "") {
                tableBorderDialog.find("#" + tableBorderDialog[0].id + "_Preview_Div")[0].style.borderColor = args.value;
                tableBorderDialog.find("#" + tableBorderDialog[0].id + "_Preview_Div_Right_Diagonal")[0].style.backgroundColor = args.value;
                tableBorderDialog.find("#" + tableBorderDialog[0].id + "_Preview_Div_Left_Diagonal")[0].style.backgroundColor = args.value;
                tableBorderDialog.find("#" + tableBorderDialog[0].id + "_Preview_Div_Vertical")[0].style.backgroundColor = args.value;
                tableBorderDialog.find("#" + tableBorderDialog[0].id + "_Preview_Div_Horizontal")[0].style.backgroundColor = args.value;
            }
        };
        LayoutViewer.prototype._ApplyTableCellPreviewBoxes = function (args) {
            var tableBorderDialog = this.TableBorderAndShadingDialog;
            tableBorderDialog.find("#" + tableBorderDialog[0].id + "_Custom_Div_Container").click();
            if (tableBorderDialog != null && args.model.selectedIndex == 0) {
                tableBorderDialog.find("#" + tableBorderDialog[0].id + "_Preview_Div_BottomCenter_Container")[0].style.display = "none";
                tableBorderDialog.find("#" + tableBorderDialog[0].id + "_Preview_Div_TopCenter_Container")[0].style.display = "none";
            }
            else {
                tableBorderDialog.find("#" + tableBorderDialog[0].id + "_Preview_Div_BottomCenter_Container")[0].style.display = "";
                tableBorderDialog.find("#" + tableBorderDialog[0].id + "_Preview_Div_TopCenter_Container")[0].style.display = "";
            }
        };
        LayoutViewer.prototype._HandleSettingCheckBoxAction = function (event) {
            var targetId = event.target.id;
            var tableBorderDialog = this.TableBorderAndShadingDialog;
            var tableBorderDialogId = this.TableBorderAndShadingDialog[0].id;
            var targetDiv;
            if (targetId == tableBorderDialogId + "_None_Div" || targetId == tableBorderDialogId + "_None_Div_Container" || targetId == tableBorderDialogId + "_None_Div_Transparent") {
                this._UpdateClassForSettingDivElements();
                tableBorderDialog.find("#" + tableBorderDialog[0].id + "_None_Div_Transparent").addClass("e-de-table-border-setting-click");
                this._SetSettingPreviewDivElement("none");
            }
            else if (targetId == tableBorderDialogId + "_Box_Div" || targetId == tableBorderDialogId + "_Box_Div_Container" || targetId == tableBorderDialogId + "_Box_Div_Transparent") {
                this._UpdateClassForSettingDivElements();
                tableBorderDialog.find("#" + tableBorderDialog[0].id + "_Box_Div_Transparent").addClass("e-de-table-border-setting-click");
                this._SetSettingPreviewDivElement("box");
            }
            else if (targetId == tableBorderDialogId + "_All_Div" || targetId == tableBorderDialogId + "_All_Div_Container" || targetId == tableBorderDialogId + "_All_Div_Transparent") {
                this._UpdateClassForSettingDivElements();
                tableBorderDialog.find("#" + tableBorderDialog[0].id + "_All_Div_Transparent").addClass("e-de-table-border-setting-click");
                this._SetSettingPreviewDivElement("all");
            }
            else {
                this._UpdateClassForSettingDivElements();
                tableBorderDialog.find("#" + tableBorderDialog[0].id + "_Custom_Div_Transparent").addClass("e-de-table-border-setting-click");
            }
        };
        LayoutViewer.prototype._HandlePreviewCheckBoxAction = function (event) {
            var target = event.target;
            var targetId = target.id;
            var tableBorderDialog = this.TableBorderAndShadingDialog;
            var tableBorderDialogId = tableBorderDialog[0].id;
            var checkBox;
            var compareClass = "e-de-table-border-preview-click";
            tableBorderDialog.find("#" + tableBorderDialog[0].id + "_Custom_Div_Container").click();
            if (targetId == tableBorderDialogId + "_Preview_Div_TopTop_Container" || targetId == tableBorderDialogId + "_Preview_Div_TopTop" || targetId == tableBorderDialogId + "_previewDivTopTopTransParent") {
                this._HandlePreviewCheckBoxShowHide(tableBorderDialog, tableBorderDialogId, compareClass, "_previewDivTopTopTransParent");
                this._ShowHidePreviewDivElements(tableBorderDialog, tableBorderDialogId, compareClass, "_Preview_Div", "_previewDivTopTopTransParent", "TopTop");
            }
            else if (targetId == tableBorderDialogId + "_Preview_Div_TopCenter_Container" || targetId == tableBorderDialogId + "_Preview_Div_TopCenter" || targetId == tableBorderDialogId + "_previewDivTopCenterTransParent") {
                this._HandlePreviewCheckBoxShowHide(tableBorderDialog, tableBorderDialogId, compareClass, "_previewDivTopCenterTransParent");
                this._ShowHidePreviewDivElements(tableBorderDialog, tableBorderDialogId, compareClass, "_Preview_Div_Horizontal", "_previewDivTopCenterTransParent", "TopCenter");
            }
            else if (targetId == tableBorderDialogId + "_Preview_Div_TopBottom_Container" || targetId == tableBorderDialogId + "_Preview_Div_TopBottom" || targetId == tableBorderDialogId + "_previewDivTopBottomTransParent") {
                this._HandlePreviewCheckBoxShowHide(tableBorderDialog, tableBorderDialogId, compareClass, "_previewDivTopBottomTransParent");
                this._ShowHidePreviewDivElements(tableBorderDialog, tableBorderDialogId, compareClass, "_Preview_Div", "_previewDivTopBottomTransParent", "TopBottom");
            }
            else if (targetId == tableBorderDialogId + "_Preview_Div_LeftDiagonal_Container" || targetId == tableBorderDialogId + "_Preview_Div_LeftDiagonal" || targetId == tableBorderDialogId + "_previewDivLeftDiagonalTransParent") {
                this._HandlePreviewCheckBoxShowHide(tableBorderDialog, tableBorderDialogId, compareClass, "_previewDivLeftDiagonalTransParent");
                this._ShowHidePreviewDivElements(tableBorderDialog, tableBorderDialogId, compareClass, "_Preview_Div_Left_Diagonal", "_previewDivLeftDiagonalTransParent", "LeftDiagonal");
            }
            else if (targetId == tableBorderDialogId + "_Preview_Div_BottomLeft_Container" || targetId == tableBorderDialogId + "_Preview_Div_BottomLeft" || targetId == tableBorderDialogId + "_previewDivBottomLeftTransparent") {
                this._HandlePreviewCheckBoxShowHide(tableBorderDialog, tableBorderDialogId, compareClass, "_previewDivBottomLeftTransparent");
                this._ShowHidePreviewDivElements(tableBorderDialog, tableBorderDialogId, compareClass, "_Preview_Div", "_previewDivBottomLeftTransparent", "BottomLeft");
            }
            else if (targetId == tableBorderDialogId + "_Preview_Div_BottomCenter_Container" || targetId == tableBorderDialogId + "_Preview_Div_BottomCenter" || targetId == tableBorderDialogId + "_previewDivBottomcenterTransparent") {
                this._HandlePreviewCheckBoxShowHide(tableBorderDialog, tableBorderDialogId, compareClass, "_previewDivBottomcenterTransparent");
                this._ShowHidePreviewDivElements(tableBorderDialog, tableBorderDialogId, compareClass, "_Preview_Div_Vertical", "_previewDivBottomcenterTransparent", "BottomCenter");
            }
            else if (targetId == tableBorderDialogId + "_Preview_Div_BottomRight_Container" || targetId == tableBorderDialogId + "_Preview_Div_BottomRight" || targetId == tableBorderDialogId + "_previewDivBottomRightTransparent") {
                this._HandlePreviewCheckBoxShowHide(tableBorderDialog, tableBorderDialogId, compareClass, "_previewDivBottomRightTransparent");
                this._ShowHidePreviewDivElements(tableBorderDialog, tableBorderDialogId, compareClass, "_Preview_Div", "_previewDivBottomRightTransparent", "BottomRight");
            }
            else if (targetId == tableBorderDialogId + "_Preview_Div_RightDiagonal_Container" || targetId == tableBorderDialogId + "_Preview_Div_RightDiagonal" || targetId == tableBorderDialogId + "_previewDivDiagonalRightTransparent") {
                this._HandlePreviewCheckBoxShowHide(tableBorderDialog, tableBorderDialogId, compareClass, "_previewDivDiagonalRightTransparent");
                this._ShowHidePreviewDivElements(tableBorderDialog, tableBorderDialogId, compareClass, "_Preview_Div_Right_Diagonal", "_previewDivDiagonalRightTransparent", "RightDiagonal");
            }
        };
        LayoutViewer.prototype._HandlePreviewCheckBoxShowHide = function (tableBorderDialog, tableBorderDialogId, compareClass, elementClass) {
            var element = tableBorderDialog.find("#" + tableBorderDialogId + elementClass);
            if (element.hasClass(compareClass))
                element.removeClass(compareClass);
            else
                element.addClass(compareClass);
        };
        LayoutViewer.prototype._ShowHidePreviewDivElements = function (tableBorderDialog, tableBorderDialogId, compareClass, elementClass, compareElementClass, Position) {
            var setElement = tableBorderDialog.find("#" + tableBorderDialogId + elementClass);
            var compareElement = tableBorderDialog.find("#" + tableBorderDialogId + compareElementClass);
            if (Position == "TopTop")
                this._SetPropertyPreviewDivElement(setElement, compareElement, compareClass, "border-top");
            else if (Position == "TopCenter")
                this._SetPropertyPreviewDivElement(setElement, compareElement, compareClass, "display");
            else if (Position == "TopBottom")
                this._SetPropertyPreviewDivElement(setElement, compareElement, compareClass, "border-bottom");
            else if (Position == "LeftDiagonal")
                this._SetPropertyPreviewDivElement(setElement, compareElement, compareClass, "display");
            else if (Position == "BottomLeft")
                this._SetPropertyPreviewDivElement(setElement, compareElement, compareClass, "border-left");
            else if (Position == "BottomCenter")
                this._SetPropertyPreviewDivElement(setElement, compareElement, compareClass, "display");
            else if (Position == "BottomRight")
                this._SetPropertyPreviewDivElement(setElement, compareElement, compareClass, "border-right");
            else if (Position == "RightDiagonal")
                this._SetPropertyPreviewDivElement(setElement, compareElement, compareClass, "display");
        };
        LayoutViewer.prototype._SetPropertyPreviewDivElement = function (element, compareElement, compareClass, property) {
            if (compareElement.hasClass(compareClass) && property.split("-")[0] == "border")
                element.css(property, "1px solid black");
            else if (compareElement.hasClass(compareClass) && property == "display")
                element.css(property, "block");
            else
                element.css(property, "none");
        };
        LayoutViewer.prototype._SetSettingPreviewDivElement = function (position) {
            var tableBorderDialog = this.TableBorderAndShadingDialog;
            var tableBorderDialogId = tableBorderDialog[0].id;
            var topTop = tableBorderDialog.find("#" + tableBorderDialog[0].id + "_previewDivTopTopTransParent");
            var topCenter = tableBorderDialog.find("#" + tableBorderDialog[0].id + "_previewDivTopCenterTransParent");
            var topBottom = tableBorderDialog.find("#" + tableBorderDialog[0].id + "_previewDivTopBottomTransParent");
            var leftDiagonal = tableBorderDialog.find("#" + tableBorderDialog[0].id + "_previewDivLeftDiagonalTransParent");
            var rightDiagonal = tableBorderDialog.find("#" + tableBorderDialog[0].id + "_previewDivDiagonalRightTransparent");
            var bottomRight = tableBorderDialog.find("#" + tableBorderDialog[0].id + "_previewDivBottomRightTransparent");
            var bottomLeft = tableBorderDialog.find("#" + tableBorderDialog[0].id + "_previewDivBottomLeftTransparent");
            var bottomCenter = tableBorderDialog.find("#" + tableBorderDialog[0].id + "_previewDivBottomcenterTransparent");
            switch (position) {
                case "none":
                    topTop.removeClass("e-de-table-border-preview-click");
                    topCenter.removeClass("e-de-table-border-preview-click");
                    topBottom.removeClass("e-de-table-border-preview-click");
                    leftDiagonal.removeClass("e-de-table-border-preview-click");
                    rightDiagonal.removeClass("e-de-table-border-preview-click");
                    bottomRight.removeClass("e-de-table-border-preview-click");
                    bottomLeft.removeClass("e-de-table-border-preview-click");
                    bottomCenter.removeClass("e-de-table-border-preview-click");
                    this._isShowHidePreviewTableElements("none");
                    break;
                case "box":
                    topCenter.removeClass("e-de-table-border-preview-click");
                    leftDiagonal.removeClass("e-de-table-border-preview-click");
                    rightDiagonal.removeClass("e-de-table-border-preview-click");
                    bottomCenter.removeClass("e-de-table-border-preview-click");
                    topTop.addClass("e-de-table-border-preview-click");
                    topBottom.addClass("e-de-table-border-preview-click");
                    bottomRight.addClass("e-de-table-border-preview-click");
                    bottomLeft.addClass("e-de-table-border-preview-click");
                    this._isShowHidePreviewTableElements("box");
                    break;
                case "all":
                    leftDiagonal.removeClass("e-de-table-border-preview-click");
                    rightDiagonal.removeClass("e-de-table-border-preview-click");
                    bottomCenter.addClass("e-de-table-border-preview-click");
                    topTop.addClass("e-de-table-border-preview-click");
                    topBottom.addClass("e-de-table-border-preview-click");
                    bottomRight.addClass("e-de-table-border-preview-click");
                    bottomLeft.addClass("e-de-table-border-preview-click");
                    topCenter.addClass("e-de-table-border-preview-click");
                    this._isShowHidePreviewTableElements("all");
                    break;
                case "default":
                    break;
            }
        };
        LayoutViewer.prototype._UpdateClassForSettingDivElements = function () {
            var settingDivs = this.TableBorderAndShadingDialog.find('.e-de-table-border-setting');
            for (var j = 0; j < settingDivs.length; j++) {
                if (settingDivs[j].className.indexOf("e-de-table-border-setting-click") != -1) {
                    var tempClassName = settingDivs[j].className;
                    tempClassName = tempClassName.replace('e-de-table-border-setting-click', '');
                    settingDivs[j].className = tempClassName;
                }
            }
        };
        LayoutViewer.prototype._isShowHidePreviewTableElements = function (settingDiv) {
            var tableBorderDialog = this.TableBorderAndShadingDialog;
            var tableBorderDialogId = tableBorderDialog[0].id;
            var previewDiv = tableBorderDialog.find("#" + tableBorderDialog[0].id + "_Preview_Div");
            var divRightDiagonal = tableBorderDialog.find("#" + tableBorderDialog[0].id + "_Preview_Div_Right_Diagonal");
            var divLeftDiagonal = tableBorderDialog.find("#" + tableBorderDialog[0].id + "_Preview_Div_Left_Diagonal");
            var divHorizontal = tableBorderDialog.find("#" + tableBorderDialog[0].id + "_Preview_Div_Horizontal");
            var divVertical = tableBorderDialog.find("#" + tableBorderDialog[0].id + "_Preview_Div_Vertical");
            switch (settingDiv) {
                case "none":
                    previewDiv.css("border-bottom", "none");
                    previewDiv.css("border-top", "none");
                    previewDiv.css("border-left", "none");
                    previewDiv.css("border-right", "none");
                    divRightDiagonal.css("display", "none");
                    divLeftDiagonal.css("display", "none");
                    divHorizontal.css("display", "none");
                    divVertical.css("display", "none");
                    break;
                case "box":
                    previewDiv.css("border-bottom", "1px solid black");
                    previewDiv.css("border-top", "1px solid black");
                    previewDiv.css("border-left", "1px solid black");
                    previewDiv.css("border-right", "1px solid black");
                    divRightDiagonal.css("display", "none");
                    divLeftDiagonal.css("display", "none");
                    divHorizontal.css("display", "none");
                    divVertical.css("display", "none");
                    break;
                case "all":
                    previewDiv.css("border-bottom", "1px solid black");
                    previewDiv.css("border-top", "1px solid black");
                    previewDiv.css("border-left", "1px solid black");
                    previewDiv.css("border-right", "1px solid black");
                    divRightDiagonal.css("display", "none");
                    divLeftDiagonal.css("display", "none");
                    divHorizontal.css("display", "block");
                    divVertical.css("display", "block");
                    break;
                case "default":
                    break;
            }
        };
        LayoutViewer.prototype._UpdateClassForAlignmetProperties = function () {
            var id1 = this.TablePropertiesDialog[0].id + "_TableProperties";
            var groupbutton1 = this.TablePropertiesDialog.find('.' + id1 + 'e-de-table-alignment');
            for (var j = 0; j < groupbutton1.length; j++) {
                if (groupbutton1[j].className.indexOf("e-de-table-alignment-active") != -1) {
                    var tempClassName = groupbutton1[j].className;
                    tempClassName = tempClassName.replace('e-de-table-alignment-active', 'e-de-table-properties-alignment');
                    groupbutton1[j].className = tempClassName;
                }
            }
        };
        LayoutViewer.prototype._UpdateClassForCellAlignment = function () {
            var instance = this;
            var finClassName = instance.TablePropertiesDialog[0].id + "_TableCellProperties";
            var cellAlignments = instance.TablePropertiesDialog.find('.' + finClassName + 'e-de-table-cell-alignment');
            for (var j = 0; j < cellAlignments.length; j++) {
                if (cellAlignments[j].className.indexOf("e-de-table-alignment-active") != -1) {
                    var tempClassName = cellAlignments[j].className;
                    tempClassName = tempClassName.replace('e-de-table-alignment-active', 'e-de-tablecell-alignment');
                    cellAlignments[j].className = tempClassName;
                }
            }
        };
        LayoutViewer.prototype._InitTableProperties = function (element) {
            var instance = this;
            var container = instance.OwnerControl.ej.buildTag("div", "", { "width": "100%" });
            var sizeHeader = instance.OwnerControl.ej.buildTag("div", "Size", { "color": "#6db4df", "width": "100%", "margin": "0px" });
            var parentContainer = instance.OwnerControl.ej.buildTag("div", "", { "display": "inline", "width": "100%" });
            var childContainer1 = instance.OwnerControl.ej.buildTag("div", "", { "display": "inline-block", "width": "100px", "float": "left", "margin-top": "8px" });
            var childContainer2 = instance.OwnerControl.ej.buildTag("div", "", { "display": "inline-block", "padding-left": "10px", "padding-top": "5px" });
            var child1 = instance.OwnerControl.ej.buildTag("div", "", { "display": "inline", "float": "left" });
            var child2 = instance.OwnerControl.ej.buildTag("div", "", { "display": "inline", "float": "right" });
            var childContainer3 = instance.OwnerControl.ej.buildTag("div", "", { "float": "right", "display": "inline", "width": "auto", "margin-top": "5px" });
            var preferCheckBox = instance.OwnerControl.ej.buildTag("input", "", "", { "type": "checkbox", "id": element.id + "_Prefer_Width_CheckBox" }, { "class": "nodetext" });
            var label = instance.OwnerControl.ej.buildTag("label", "Preferred Width", { "font-size": "11px", "font-weight": "normal", "margin-left": "5px" }, { "class": "clslab" }, { "for": element.id + "_Prefer_Width_CheckBox" });
            var preferredWidth = instance.OwnerControl.ej.buildTag("input", "", { "width": "80px" }, { "id": element.id + "preferred_Width", "type": "text" });
            var controlDiv = instance.OwnerControl.ej.buildTag("div", "");
            var dropDownList = instance.OwnerControl.ej.buildTag("input", "", { "display": "inline" }, { "type": "text", "id": element.id + "_width_dropdownList" });
            var ulelement = instance.OwnerControl.ej.buildTag("ul", "<li>Pixel</li><li>Percent</li>", "", { "id": element.id + "_width_dropdown" });
            var labeltext = instance.OwnerControl.ej.buildTag("label", "Measure in", { "font-size": "11px", "font-weight": "normal", "padding-right": "10px", "padding-top": "7px" });
            var Separator = instance.OwnerControl.ej.buildTag("div", "", { "width": "100%", "margin-top": "8px", "margin-bottom": "8px", "padding": "0px", "height": "0px", "border-style": "inherit", "border-bottom-color": "gray", "border-width": "inherit" });
            var AlignmentHeader = instance.OwnerControl.ej.buildTag("div", "Alignment", { "color": "#6db4df", "width": "100%", "margin": "0px" });
            var AlignmentContainer = instance.OwnerControl.ej.buildTag("div", "", { "width": "100%", "height": "70px", "margin-top": "10px" });
            var className = element.id + "e-de-table-alignment";
            var left = instance.OwnerControl.ej.buildTag("div", "<div class='e-de-table-properties-alignment  e-de-table-left-alignment " + className + "'  id= '" + element.id + "_left_alignment' style= 'width:100%;height:100%;padding:0px;margin:0px' ></div>", { "width": "50px", "height": "50px", "display": "inline-block", "border-style": "solid", "margin": "0px 3px 0px 0px", "border-width": "1px", "padding": "5px 8px 8px 5px" });
            var center = instance.OwnerControl.ej.buildTag("div", "<div class='e-de-table-properties-alignment  e-de-table-center-alignment " + className + "'  id='" + element.id + "_center_alignment' style='width:100%;height:100%;padding:0px;margin:0px'></div>", { "width": "50px", "height": "50px", "display": "inline-block", "border-style": "solid", "margin": "0px 3px 0px 5px", "border-width": "1px", "padding": "5px 8px 8px 5px" });
            var right = instance.OwnerControl.ej.buildTag("div", "<div class='e-de-table-properties-alignment  e-de-table-right-alignment " + className + "'  id='" + element.id + "_right_alignment' style='width:100%;height:100%;padding:0px;margin:0px'></div>", { "width": "50px", "height": "50px", "display": "inline-block", "border-style": "solid", "margin": "0px 3px 0px 5px", "border-width": "1px", "padding": "5px 8px 8px 5px" });
            var leftlabel = instance.OwnerControl.ej.buildTag("label", "Left", { "position": "absolute", "top": "235px", "left": "57px", "font-size": "13px", "font-weight": "normal" });
            var centerlabel = instance.OwnerControl.ej.buildTag("label", "Center", { "position": "absolute", "top": "235px", "left": "123px", "font-size": "13px", "font-weight": "normal" });
            var rightlabel = instance.OwnerControl.ej.buildTag("label", "Right", { "position": "absolute", "top": "235px", "left": "197px", "font-size": "13px", "font-weight": "normal" });
            var leftIndenetContainer = instance.OwnerControl.ej.buildTag("div", "", { "width": "auto", "height": "auto", "display": "inline", "padding-top": "15px", "margin": "5px", "float": "right" });
            var leftIndentLabel = instance.OwnerControl.ej.buildTag("label", "Indent from Left", { "float": "right", "font-weight": "normal", "margin-top": "7px", "margin-right": "5px", "font-size": "11px" });
            var leftIndent = instance.OwnerControl.ej.buildTag("input", "", { "float": "right" }, { "id": element.id + "_left_indent", "type": "text" });
            var TableOptionContiner = document.createElement("div");
            TableOptionContiner.setAttribute('style', 'position:absolute;top:300px;left:250px');
            var borderAndShading = instance.OwnerControl.ej.buildTag("button", "Borders and Shadings", { "margin-bottom": "5px", "margin-top": "6px", "margin-right": "10px" }, { "id": element.id + "_borders_and_shadings", });
            var options = instance.OwnerControl.ej.buildTag("button", "Options", { "margin-bottom": "5px", "margin-top": "6px", "margin-right": "10px" }, { "id": element.id + "_table_cellmargin", });
            options.ejButton({ click: function () { instance._ShowCellMarginsDialog(); } });
            borderAndShading.ejButton({ click: function () { instance._ShowBordersShadingsPropertiesDialog(); } });
            borderAndShading.ejButton({ showRoundedCorner: false, width: "150px", height: "auto" });
            options.ejButton({ showRoundedCorner: false, width: "auto", height: "auto" });
            TableOptionContiner.appendChild(borderAndShading[0]);
            TableOptionContiner.appendChild(options[0]);
            leftIndenetContainer[0].appendChild(leftIndent[0]);
            leftIndenetContainer[0].appendChild(leftIndentLabel[0]);
            AlignmentContainer[0].appendChild(left[0]);
            AlignmentContainer[0].appendChild(center[0]);
            AlignmentContainer[0].appendChild(right[0]);
            AlignmentContainer[0].appendChild(leftlabel[0]);
            AlignmentContainer[0].appendChild(centerlabel[0]);
            AlignmentContainer[0].appendChild(rightlabel[0]);
            AlignmentContainer[0].appendChild(leftIndenetContainer[0]);
            container[0].appendChild(sizeHeader[0]);
            element.appendChild(container[0]);
            childContainer1[0].appendChild(preferCheckBox[0]);
            childContainer1[0].appendChild(label[0]);
            parentContainer[0].appendChild(childContainer1[0]);
            childContainer2[0].appendChild(preferredWidth[0]);
            parentContainer[0].appendChild(childContainer2[0]);
            controlDiv[0].appendChild(dropDownList[0]);
            controlDiv[0].appendChild(ulelement[0]);
            child1[0].appendChild(labeltext[0]);
            child2[0].appendChild(controlDiv[0]);
            childContainer3[0].appendChild(child1[0]);
            childContainer3[0].appendChild(child2[0]);
            parentContainer[0].appendChild(childContainer3[0]);
            element.appendChild(parentContainer[0]);
            element.appendChild(Separator[0]);
            element.appendChild(AlignmentHeader[0]);
            element.appendChild(AlignmentContainer[0]);
            element.appendChild(TableOptionContiner);
            preferCheckBox.ejCheckBox({
                change: function (args) {
                    instance._ChangeTableCheckBox(this);
                }
            });
            preferredWidth.ejNumericTextbox({ name: "numeric", value: 0, width: "100px", minValue: 0, maxValue: 2112, decimalPlaces: 2 });
            leftIndent.ejNumericTextbox({ name: "numeric", value: 0, width: "100px", minValue: -1440, maxValue: 1440, decimalPlaces: 2 });
            dropDownList.ejDropDownList({ targetID: element.id + "_width_dropdown", width: "100px", watermarkText: "Measure in" });
        };
        LayoutViewer.prototype._InitTableRowProperties = function (element) {
            var instance = this;
            var sizeDiv = instance.OwnerControl.ej.buildTag("div", "", { "width": "100%" });
            var div = instance.OwnerControl.ej.buildTag("div", "Size", { "color": "#6db4df", "width": "100%", "margin": "0px" });
            var parentdiv = instance.OwnerControl.ej.buildTag("div", "", { "display": "inline", "width": "100%" });
            var childdiv1 = instance.OwnerControl.ej.buildTag("div", "", { "display": "inline", "width": "100px", "float": "left", "margin-top": "8px" });
            var input = instance.OwnerControl.ej.buildTag("input", "", "", { "type": "checkbox", "id": element.id + "_height_CheckBox" }, { "class": "nodetext" });
            var label = instance.OwnerControl.ej.buildTag("label", "Specify height", { "font-size": "11px", "font-weight": "normal", "margin-left": "5px" }, { "class": "clslab" }, { "for": element.id + "_height_CheckBox" });
            var childdiv2 = instance.OwnerControl.ej.buildTag("div", "", { "display": "inline-block", "padding-left": "10px", "padding-top": "5px" });
            var NumericTextBox = instance.OwnerControl.ej.buildTag("input", "", "", { "type": "text", "id": element.id + "_table_row_height" });
            var child2 = instance.OwnerControl.ej.buildTag("div", "", { "float": "right", "display": "inline", "width": "auto", "margin-top": "5px" });
            var child3 = instance.OwnerControl.ej.buildTag("div", "", { "display": "inline", "float": "left" });
            var child4 = instance.OwnerControl.ej.buildTag("div", "", { "display": "inline", "float": "right" });
            var controlDiv = instance.OwnerControl.ej.buildTag("div", "");
            var dropDownList = instance.OwnerControl.ej.buildTag("input", "", { "display": "inline" }, { "type": "text", "id": element.id + "_height_type_dropdownlist" });
            var ulelement = instance.OwnerControl.ej.buildTag("ul", "<li>At least</li><li>Exactly</li>", "", { "id": element.id + "_height_type" });
            var labeltext = instance.OwnerControl.ej.buildTag("label", "Specify height", { "font-size": "11px", "font-weight": "normal", "padding-right": "10px", "padding-top": "7px" });
            sizeDiv[0].appendChild(div[0]);
            element.appendChild(sizeDiv[0]);
            childdiv1[0].appendChild(input[0]);
            childdiv1[0].appendChild(label[0]);
            parentdiv[0].appendChild(childdiv1[0]);
            childdiv2[0].appendChild(NumericTextBox[0]);
            parentdiv[0].appendChild(childdiv2[0]);
            controlDiv[0].appendChild(dropDownList[0]);
            controlDiv[0].appendChild(ulelement[0]);
            child3[0].appendChild(labeltext[0]);
            child4[0].appendChild(controlDiv[0]);
            child2[0].appendChild(child3[0]);
            child2[0].appendChild(child4[0]);
            parentdiv[0].appendChild(child2[0]);
            element.appendChild(parentdiv[0]);
            var divline = instance.OwnerControl.ej.buildTag("div", "", { "width": "100%", "margin-top": "8px", "margin-bottom": "8px", "padding": "0px", "height": "0px", "border-style": "inherit", "border-bottom-color": "gray", "border-width": "inherit" });
            var AlignmentDiv = instance.OwnerControl.ej.buildTag("div", "Options", { "color": "#6db4df", "width": "100%", "margin-bottom": "10px", "margin-top": "0px" });
            var tablerowoptions1 = instance.OwnerControl.ej.buildTag("input", "", "", { "type": "checkbox", "id": element.id + "_allow_row_break" }, { "class": "nodetext" });
            var textOption1 = instance.OwnerControl.ej.buildTag("label", "Allow row to break  across pages</br>", { "width": "400px", "font-weight": "normal", "font-size": "12px" }, { "class": "clslab" }, { "for": "options1" });
            var tablerowoptions2 = instance.OwnerControl.ej.buildTag("input", "", "", { "type": "checkbox", "id": element.id + "_repeat_header" }, { "class": "nodetext" });
            var textOption2 = instance.OwnerControl.ej.buildTag("label", "Repeat as header row at the top of each page", { "font-size": "12px", "font-weight": "normal" }, { "class": "clslab" }, { "for": "options2" });
            element.appendChild(divline[0]);
            element.appendChild(AlignmentDiv[0]);
            element.appendChild(tablerowoptions1[0]);
            element.appendChild(textOption1[0]);
            element.appendChild(tablerowoptions2[0]);
            element.appendChild(textOption2[0]);
            input.ejCheckBox({
                change: function (args) {
                    instance._ChangeTableRowCheckBox(this);
                }
            });
            tablerowoptions1.ejCheckBox();
            tablerowoptions2.ejCheckBox();
            NumericTextBox.ejNumericTextbox({ name: "numeric", value: 0, width: "100px", minValue: 0, maxValue: 2112, decimalPlaces: 2 });
            dropDownList.ejDropDownList({ targetID: element.id + "_height_type", width: "100px", watermarkText: "Specify" });
        };
        LayoutViewer.prototype._InitTableCellProprties = function (element) {
            var instance = this;
            var sizeDiv = instance.OwnerControl.ej.buildTag("div", "", { "width": "100%" });
            var div = instance.OwnerControl.ej.buildTag("div", "Size", { "color": "#6db4df", "width": "100%", "margin": "0px" });
            var parentdiv = instance.OwnerControl.ej.buildTag("div", "", { "display": "inline", "width": "100%" });
            var childdiv1 = instance.OwnerControl.ej.buildTag("div", "", { "display": "inline", "width": "100px", "float": "left", "margin-top": "8px" });
            var input = instance.OwnerControl.ej.buildTag("input", "", "", { "type": "checkbox", "id": element.id + "_Prefer_Width_CheckBox_cell" }, { "class": "nodetext" });
            var label = instance.OwnerControl.ej.buildTag("label", "Preferred Width", { "font-size": "11px", "font-weight": "normal", "margin-left": "5px" }, { "class": "clslab" }, { "for": element.id + "Prefer_Width_CheckBox" });
            var childdiv2 = instance.OwnerControl.ej.buildTag("div", "", { "display": "inline-block", "padding-left": "10px", "padding-top": "5px" });
            var NumericTextBox = instance.OwnerControl.ej.buildTag("input", "", "", { "id": element.id + "tablecell_Width_textBox" }, { "type": "text" });
            var child2 = instance.OwnerControl.ej.buildTag("div", "", { "float": "right", "display": "inline", "width": "auto", "margin-top": "5px" });
            var child3 = instance.OwnerControl.ej.buildTag("div", "", { "display": "inline", "float": "left" });
            var child4 = instance.OwnerControl.ej.buildTag("div", "", { "display": "inline", "float": "right" });
            var controlDiv = instance.OwnerControl.ej.buildTag("div", "");
            var dropDownList = instance.OwnerControl.ej.buildTag("input", "", { "display": "inline" }, { "type": "text", "id": element.id + "_measure_type_cell_dropdownlist" });
            var ulelement = instance.OwnerControl.ej.buildTag("ul", "<li>Pixel</li><li>Percent</li>", "", { "id": element.id + "_measure_type_cell" });
            var labeltext = instance.OwnerControl.ej.buildTag("label", "Measure in", { "font-size": "11px", "font-weight": "normal", "padding-right": "10px", "padding-top": "7px" });
            sizeDiv[0].appendChild(div[0]);
            element.appendChild(sizeDiv[0]);
            childdiv1[0].appendChild(input[0]);
            childdiv1[0].appendChild(label[0]);
            parentdiv[0].appendChild(childdiv1[0]);
            childdiv2[0].appendChild(NumericTextBox[0]);
            parentdiv[0].appendChild(childdiv2[0]);
            controlDiv[0].appendChild(dropDownList[0]);
            controlDiv[0].appendChild(ulelement[0]);
            child3[0].appendChild(labeltext[0]);
            child4[0].appendChild(controlDiv[0]);
            child2[0].appendChild(child3[0]);
            child2[0].appendChild(child4[0]);
            parentdiv[0].appendChild(child2[0]);
            element.appendChild(parentdiv[0]);
            var divline = instance.OwnerControl.ej.buildTag("div", "", { "width": "100%", "margin-top": "8px", "margin-bottom": "8px", "padding": "0px", "height": "0px", "border-style": "inherit", "border-bottom-color": "gray", "border-width": "inherit" });
            var AlignmentDiv = instance.OwnerControl.ej.buildTag("div", "Vertical Alignment", { "color": "#6db4df", "width": "100%", "margin": "0px" });
            var className = element.id + 'e-de-table-cell-alignment';
            var divAlignment = instance.OwnerControl.ej.buildTag("div", "", { "width": "100%", "height": "100px", "margin-top": "10px" });
            var leftalignmentdiv = instance.OwnerControl.ej.buildTag("div", "<div class='e-de-tablecell-alignment e-de-tablecell-top-alignment " + className + "' id='" + element.id + "_cell_top-alignment' style='width:100%;height:100%;padding:0px;margin:0px;border-style:solid;border-width:2px'></div>", { "width": "50px", "height": "50px", "display": "inline-block", "border-style": "solid", "margin": "0px 3px 0px 0px", "border-width": "1px", "padding": "5px 8px 8px 5px" });
            var centeralignmentdiv = instance.OwnerControl.ej.buildTag("div", "<div class='e-de-tablecell-alignment  e-de-tablecell-center-alignment " + className + "' id='" + element.id + "_cell_center-alignment' style='width:100%;height:100%;padding:0px;margin:0px;border-style:solid;border-width:2px'></div>", { "width": "50px", "height": "50px", "display": "inline-block", "border-style": "solid", "margin": "0px 3px 0px 5px", "border-width": "1px", "padding": "5px 8px 8px 5px" });
            var rightalignmentdiv = instance.OwnerControl.ej.buildTag("div", "<div class='e-de-tablecell-alignment e-de-tablecell-bottom-alignment  " + className + "' id='" + element.id + "_cell_bottom-alignment' style='width:100%;height:100%;padding:0px;margin:0px;border-style:solid;border-width:2px'></div>", { "width": "50px", "height": "50px", "display": "inline-block", "border-style": "solid", "margin": "0px 3px 0px 5px", "border-width": "1px", "padding": "5px 8px 8px 5px" });
            var leftlabel = instance.OwnerControl.ej.buildTag("label", "Top", { "position": "absolute", "top": "235px", "left": "55px", "font-size": "13px", "font-weight": "normal" });
            var centerlabel = instance.OwnerControl.ej.buildTag("label", "Center", { "position": "absolute", "top": "235px", "left": "120px", "font-size": "13px", "font-weight": "normal" });
            var rightlabel = instance.OwnerControl.ej.buildTag("label", "Bottom", { "position": "absolute", "top": "235px", "left": "190px", "font-size": "13px", "font-weight": "normal" });
            var ApplyPropertyDiv = document.createElement("div");
            ApplyPropertyDiv.style.cssFloat = "right";
            ApplyPropertyDiv.style.marginTop = "30px";
            divAlignment[0].appendChild(leftalignmentdiv[0]);
            divAlignment[0].appendChild(centeralignmentdiv[0]);
            divAlignment[0].appendChild(rightalignmentdiv[0]);
            divAlignment[0].appendChild(leftlabel[0]);
            divAlignment[0].appendChild(centerlabel[0]);
            divAlignment[0].appendChild(rightlabel[0]);
            element.appendChild(divline[0]);
            element.appendChild(AlignmentDiv[0]);
            element.appendChild(divAlignment[0]);
            element.appendChild(ApplyPropertyDiv);
            input.ejCheckBox({
                change: function (args) {
                    instance._ChangeTableCellCheckBox(this);
                }
            });
            NumericTextBox.ejNumericTextbox({ name: "numeric", value: 0, width: "100px", minValue: 0, maxValue: 2112, decimalPlaces: 2 });
            dropDownList.ejDropDownList({ targetID: element.id + "_measure_type_cell", width: "100px", watermarkText: "Measure in" });
        };
        LayoutViewer.prototype._ChangeTableCheckBox = function (checkBox) {
            var tablePropertyId = "#" + this.TablePropertiesDialog[0].id + "_TableProperties";
            var preferredWidth = this.TablePropertiesDialog.find(tablePropertyId + "preferred_Width");
            var widthTypeDropDown = this.TablePropertiesDialog.find(tablePropertyId + "_width_dropdownList");
            if (checkBox.isChecked()) {
                preferredWidth.ejNumericTextbox('enable');
                widthTypeDropDown.ejDropDownList('enable');
            }
            else {
                preferredWidth.ejNumericTextbox('disable');
                widthTypeDropDown.ejDropDownList('disable');
            }
        };
        LayoutViewer.prototype._ChangeTableRowCheckBox = function (checkBox) {
            var rowPropertyId = "#" + this.TablePropertiesDialog[0].id + "_TableRowProperties";
            var tableRowHeight = this.TablePropertiesDialog.find(rowPropertyId + "_table_row_height");
            var rowHeighType = this.TablePropertiesDialog.find(rowPropertyId + "_height_type_dropdownlist");
            if (checkBox.isChecked()) {
                tableRowHeight.ejNumericTextbox('enable');
                rowHeighType.ejDropDownList('enable');
            }
            else {
                tableRowHeight.ejNumericTextbox('disable');
                rowHeighType.ejDropDownList('disable');
            }
        };
        LayoutViewer.prototype._ChangeTableCellCheckBox = function (checkBox) {
            var cellPropertyId = "#" + this.TablePropertiesDialog[0].id + "_TableCellProperties";
            var cellPreferedWidth = this.TablePropertiesDialog.find(cellPropertyId + "tablecell_Width_textBox");
            var cellMeasureDropDown = this.TablePropertiesDialog.find(cellPropertyId + "_measure_type_cell_dropdownlist");
            if (checkBox.isChecked()) {
                cellPreferedWidth.ejNumericTextbox('enable');
                cellMeasureDropDown.ejDropDownList('enable');
            }
            else {
                cellPreferedWidth.ejNumericTextbox('disable');
                cellMeasureDropDown.ejDropDownList('disable');
            }
        };
        LayoutViewer.prototype._CreateEjDialog = function (element) {
            var viewer = this;
            element.ejDialog({
                showOnInit: false,
                width: "auto",
                enableResize: false,
                close: function () {
                    viewer.EditableDiv.focus();
                    viewer.fontDialog._UnWireEventsAndBindings();
                    viewer.ParagraphDialog.UnWireEventsAndBindings();
                    viewer.HyperlinkDialog._ClearValues();
                }
            });
        };
        LayoutViewer.prototype._CreateEjListBox = function (element) {
            element.ejListBox({});
        };
        LayoutViewer.prototype._CreateEjDropDownList = function (element) {
            element.ejDropDownList({});
        };
        LayoutViewer.prototype._CreateEjCheckBox = function (element) {
            element.ejCheckBox({
                checked: false
            });
        };
        LayoutViewer.prototype._CreateEjNumericTextbox = function (element) {
            element.ejNumericTextbox({
                name: "numeric",
                value: 0,
                width: 115,
                decimalPlaces: 2
            });
        };
        LayoutViewer.prototype._CreateEjButton = function (element) {
            element.ejButton({});
        };
        LayoutViewer.prototype._CreateEjColorPicker = function (element) {
            element.ejColorPicker({
                value: "#FFFF00",
                modelType: "palette"
            });
        };
        LayoutViewer.prototype._ValidateClosestElement = function (target) {
            var closestElm;
            var isVerticalScroller = false;
            var isHorizontalScroller = false;
            var isClosestToContainer = false;
            if (this.VerticalScrollBar != null || this.VerticalScrollBar != undefined) {
                var verticalScrollBar = document.getElementById(this.VerticalScrollBar._id);
                closestElm = this._Closest(target, verticalScrollBar);
                isVerticalScroller = (closestElm != null && closestElm != undefined) ? true : false;
            }
            if (this.HorizontalScrollBar != null || this.HorizontalScrollBar != undefined) {
                var horizontolScrollBar = document.getElementById(this.HorizontalScrollBar._id);
                closestElm = this._Closest(target, horizontolScrollBar);
                isHorizontalScroller = (closestElm != null && closestElm != undefined) ? true : false;
            }
            if (this.ViewerContatiner != null || this.ViewerContatiner != undefined) {
                closestElm = this._Closest(target, this.ViewerContatiner);
                isClosestToContainer = (closestElm != null && closestElm != undefined) ? true : false;
            }
            return { "isVerticalScroller": isVerticalScroller, "isHorizontalScroller": isHorizontalScroller, "isClosestToContainer": isClosestToContainer };
        };
        LayoutViewer.prototype._Closest = function (el, targetelem) {
            var containerId = (targetelem.id != "" && targetelem.id != undefined && targetelem != null) ? targetelem.id : ((targetelem.parentElement.id != "" && targetelem.parentElement.id != undefined && targetelem.parentElement != null) ? targetelem.parentElement.id : targetelem.parentElement.parentElement.id);
            var sel = "#" + containerId;
            while ((el = el.parentElement) && !((el.matches || el.matchesSelector || el.msMatchesSelector || el.oMatchesSelector || el.mozMatchesSelector || el.webkitMatchesSelector).call(el, sel)))
                ;
            return (el != null || el != undefined) ? el : null;
        };
        LayoutViewer.prototype._OnInsertTableProperties = function () {
            this.OwnerControl.TableDialog._WireUpEventsAndBindings();
            var tablePropertyId = this.TablePropertiesDialog[0].id + "_TableProperties";
            if ($("#" + tablePropertyId + "_Prefer_Width_CheckBox").data("ejCheckBox").isChecked()) {
                this.OwnerControl.TableDialog.HasTableWidth = true;
                this.OwnerControl.TableDialog.TablePreferredWidth = parseFloat(this.TablePropertiesDialog.find("#" + this.TablePropertiesDialog[0].id + "_TableProperties" + "preferred_Width")[0].value);
                var widthType = this.TablePropertiesDialog.find("#" + this.TablePropertiesDialog[0].id + "_TableProperties" + "_width_dropdownList").data("ejDropDownList");
                if (widthType.selectedIndexValue == 0)
                    this.OwnerControl.TableDialog.TablePreferredWidthType = WidthType.Pixel;
                else if (widthType.selectedIndexValue == 1)
                    this.OwnerControl.TableDialog.TablePreferredWidthType = WidthType.Percent;
            }
            else if (!$("#" + tablePropertyId + "_Prefer_Width_CheckBox").data("ejCheckBox").isChecked())
                this.OwnerControl.TableDialog.HasTableWidth = false;
            this.OwnerControl.TableDialog.LeftIndent = parseFloat(this.TablePropertiesDialog.find("#" + this.TablePropertiesDialog[0].id + "_TableProperties" + "_left_indent")[0].value);
            var alignMentButton = this.TablePropertiesDialog.find('.' + tablePropertyId + 'e-de-table-alignment');
            for (var i = 0; i < alignMentButton.length; i++) {
                var className = alignMentButton[i].className;
                if (className.indexOf('e-de-table-alignment-active') != -1) {
                    if (i == 0)
                        this.OwnerControl.TableDialog.TableAlignment = TableAlignment.Left;
                    else if (i == 1)
                        this.OwnerControl.TableDialog.TableAlignment = TableAlignment.Center;
                    else if (i == 2)
                        this.OwnerControl.TableDialog.TableAlignment = TableAlignment.Right;
                    className = className.replace('e-de-table-alignment-active', 'e-de-table-properties-alignment');
                    alignMentButton[i].className = className;
                }
            }
            if ($("#" + this.TablePropertiesDialog[0].id + "_TableRowProperties" + "_height_CheckBox").data("ejCheckBox").isChecked()) {
                this.OwnerControl.TableDialog.HasRowHeight = true;
                this.OwnerControl.TableDialog.RowHeight = parseFloat(this.TablePropertiesDialog.find("#" + this.TablePropertiesDialog[0].id + "_TableRowProperties" + "_table_row_height")[0].value);
                var heightType = this.TablePropertiesDialog.find("#" + this.TablePropertiesDialog[0].id + "_TableRowProperties" + "_height_type_dropdownlist").data("ejDropDownList");
                if (heightType.selectedIndexValue == 0)
                    this.OwnerControl.TableDialog.RowHeightType = HeightType.Atleast;
                else if (heightType.selectedIndexValue == 1)
                    this.OwnerControl.TableDialog.RowHeightType = HeightType.Exactly;
            }
            else if (!$("#" + this.TablePropertiesDialog[0].id + "_TableRowProperties" + "_height_CheckBox").data("ejCheckBox").isChecked())
                this.OwnerControl.TableDialog.HasRowHeight = false;
            this.OwnerControl.TableDialog.AllowBreakAcrossPages = this.TablePropertiesDialog.find("#" + this.TablePropertiesDialog[0].id + "_TableRowProperties" + "_allow_row_break").data("ejCheckBox").isChecked();
            this.OwnerControl.TableDialog.IsHeader = this.TablePropertiesDialog.find("#" + this.TablePropertiesDialog[0].id + "_TableRowProperties" + "_repeat_header").data("ejCheckBox").isChecked();
            var tableCellPropertyId = this.TablePropertiesDialog[0].id + "_TableCellProperties";
            if ($("#" + tableCellPropertyId + "_Prefer_Width_CheckBox_cell").data("ejCheckBox").isChecked()) {
                this.OwnerControl.TableDialog.HasCellWidth = true;
                this.OwnerControl.TableDialog.CellPreferredWidth = parseFloat(this.TablePropertiesDialog.find("#" + this.TablePropertiesDialog[0].id + "_TableCellProperties" + "tablecell_Width_textBox")[0].value);
                var cellWidthType = this.TablePropertiesDialog.find("#" + this.TablePropertiesDialog[0].id + "_TableCellProperties" + "_measure_type_cell_dropdownlist").data("ejDropDownList");
                if (cellWidthType.selectedIndexValue == 0)
                    this.OwnerControl.TableDialog.CellPreferredWidthType = WidthType.Pixel;
                else if (cellWidthType.selectedIndexValue == 1)
                    this.OwnerControl.TableDialog.CellPreferredWidthType = WidthType.Percent;
            }
            else if (!$("#" + tableCellPropertyId + "_Prefer_Width_CheckBox_cell").data("ejCheckBox").isChecked())
                this.OwnerControl.TableDialog.HasCellWidth = false;
            var cellAlignMentButton = this.TablePropertiesDialog.find('.' + tableCellPropertyId + 'e-de-table-cell-alignment');
            for (var i = 0; i < cellAlignMentButton.length; i++) {
                var className = cellAlignMentButton[i].className;
                if (className.indexOf('e-de-table-alignment-active') != -1) {
                    if (i == 0)
                        this.OwnerControl.TableDialog.CellContentAlignment = CellVerticalAlignment.Top;
                    else if (i == 1)
                        this.OwnerControl.TableDialog.CellContentAlignment = CellVerticalAlignment.Center;
                    else if (i == 2)
                        this.OwnerControl.TableDialog.CellContentAlignment = CellVerticalAlignment.Bottom;
                    className = className.replace('e-de-table-alignment-active', 'e-de-tablecell-alignment');
                    cellAlignMentButton[i].className = className;
                }
            }
            this.OwnerControl.TableDialog._ApplyTablePropertiesButton_Click();
            this.OwnerControl.TableDialog._UnwireEventsAndBindings();
        };
        LayoutViewer.prototype._InitContextMenu = function () {
            HelperMethods._AddCssStyle("." + DocumentEditorThemeHelper.ContextMenuItem + "{display:block}");
            HelperMethods._AddCssStyle("." + DocumentEditorThemeHelper.HiddenContextMenuItem + "{display:none;}");
            this.ContextMenu = document.createElement("nav");
            this.ContextMenu.style.zIndex = "10000";
            this.ContextMenu.style.display = "none";
            this.ContextMenu.style.position = "absolute";
            this.ContextMenu.style.width = "260px";
            this.ContextMenu.className = DocumentEditorThemeHelper.DocumentEditor;
            this.ContextMenu.style.border = "1px solid #D3D3D3";
            this.ContextMenu.style.padding = "4px 0px";
            this.ContextMenu.style.fontSize = "12px";
            this.ContextMenu.style.fontStyle = "normal";
            document.body.appendChild(this.ContextMenu);
            var ul = document.createElement("ul");
            ul.style.listStyle = "none";
            ul.style.margin = "0px";
            ul.style.padding = "0px";
            this.ContextMenu.appendChild(ul);
            var li1 = document.createElement("li");
            li1.style.display = "block";
            ul.appendChild(li1);
            var a1 = document.createElement("a");
            a1.className = DocumentEditorThemeHelper.ContextMenuItem;
            a1.id = DocumentEditorThemeHelper.ContextMenuCut;
            this._SetStyleToContextMenuItem(a1);
            li1.appendChild(a1);
            var span1 = document.createElement("span");
            span1.innerText = "Cut";
            a1.appendChild(span1);
            var li2 = document.createElement("li");
            li2.style.display = "block";
            ul.appendChild(li2);
            var a2 = document.createElement("a");
            a2.className = DocumentEditorThemeHelper.ContextMenuItem;
            a2.id = DocumentEditorThemeHelper.ContextMenuCopy;
            this._SetStyleToContextMenuItem(a2);
            li2.appendChild(a2);
            var span2 = document.createElement("span");
            span2.innerText = "Copy";
            a2.appendChild(span2);
            var li3 = document.createElement("li");
            li3.style.display = "block";
            ul.appendChild(li3);
            var a3 = document.createElement("a");
            a3.className = DocumentEditorThemeHelper.ContextMenuItem;
            a3.id = DocumentEditorThemeHelper.ContextMenuOpenHyperlink;
            this._SetStyleToContextMenuItem(a3);
            li3.appendChild(a3);
            var span3 = document.createElement("span");
            span3.innerText = "Open link";
            a3.appendChild(span3);
            var li4 = document.createElement("li");
            li4.style.display = "block";
            ul.appendChild(li4);
            var a4 = document.createElement("a");
            a4.className = DocumentEditorThemeHelper.ContextMenuItem;
            a4.id = DocumentEditorThemeHelper.ContextMenuCopyHyperlink;
            this._SetStyleToContextMenuItem(a4);
            li4.appendChild(a4);
            var span4 = document.createElement("span");
            span4.innerText = "Copy link address";
            a4.appendChild(span4);
            var li5 = document.createElement("li");
            li5.style.display = "block";
            ul.appendChild(li5);
            var a5 = document.createElement("a");
            a5.className = DocumentEditorThemeHelper.ContextMenuItem;
            a5.id = DocumentEditorThemeHelper.ContextMenuEditHyperlink;
            this._SetStyleToContextMenuItem(a5);
            li5.appendChild(a5);
            var span5 = document.createElement("span");
            span5.innerText = "Edit Hyperlink";
            a5.appendChild(span5);
            var li6 = document.createElement("li");
            li6.style.display = "block";
            ul.appendChild(li6);
            var a6 = document.createElement("a");
            a6.className = DocumentEditorThemeHelper.ContextMenuItem;
            a6.id = DocumentEditorThemeHelper.ContextMenuHyperlink;
            this._SetStyleToContextMenuItem(a6);
            li6.appendChild(a6);
            var span6 = document.createElement("span");
            span6.innerText = "Hyperlink";
            a6.appendChild(span6);
            var li7 = document.createElement("li");
            li7.style.display = "block";
            ul.appendChild(li7);
            var a7 = document.createElement("a");
            a7.className = DocumentEditorThemeHelper.ContextMenuItem;
            a7.id = DocumentEditorThemeHelper.ContextMenuFont;
            this._SetStyleToContextMenuItem(a7);
            li7.appendChild(a7);
            var span7 = document.createElement("span");
            span7.innerText = "Font";
            a7.appendChild(span7);
            var li8 = document.createElement("li");
            li8.style.display = "block";
            ul.appendChild(li8);
            var a8 = document.createElement("a");
            a8.className = DocumentEditorThemeHelper.ContextMenuItem;
            a8.id = DocumentEditorThemeHelper.ContextMenuParagraph;
            this._SetStyleToContextMenuItem(a8);
            li8.appendChild(a8);
            var span8 = document.createElement("span");
            span8.innerText = "Paragraph";
            a8.appendChild(span8);
            var tablePropertieContainer = document.createElement("li");
            tablePropertieContainer.style.display = "block";
            ul.appendChild(tablePropertieContainer);
            var tableProperties = document.createElement("a");
            tableProperties.className = DocumentEditorThemeHelper.ContextMenuItem;
            tableProperties.id = DocumentEditorThemeHelper.ContextMenuTableProperties;
            this._SetStyleToContextMenuItem(tableProperties);
            tablePropertieContainer.appendChild(tableProperties);
            var spanText = document.createElement("span");
            spanText.innerText = "Table Properties";
            tableProperties.appendChild(spanText);
            var remHyperlinkListTag = document.createElement("li");
            remHyperlinkListTag.style.display = "block";
            ul.appendChild(remHyperlinkListTag);
            var remHyperlinkAnchorTag = document.createElement("a");
            remHyperlinkAnchorTag.className = DocumentEditorThemeHelper.ContextMenuItem;
            remHyperlinkAnchorTag.id = DocumentEditorThemeHelper.ContextMenuRemoveHyperlink;
            this._SetStyleToContextMenuItem(remHyperlinkAnchorTag);
            remHyperlinkListTag.appendChild(remHyperlinkAnchorTag);
            var remHyperlinkSpanTag = document.createElement("span");
            remHyperlinkSpanTag.innerText = "Remove Hyperlink";
            remHyperlinkAnchorTag.appendChild(remHyperlinkSpanTag);
            var pasteListTag = document.createElement("li");
            pasteListTag.style.display = "block";
            ul.appendChild(pasteListTag);
            var pasteAnchorTag = document.createElement("a");
            pasteAnchorTag.className = DocumentEditorThemeHelper.ContextMenuItem;
            pasteAnchorTag.id = DocumentEditorThemeHelper.ContextMenuPaste;
            this._SetStyleToContextMenuItem(pasteAnchorTag);
            pasteListTag.appendChild(pasteAnchorTag);
            var pasteSpanTag = document.createElement("span");
            pasteSpanTag.innerText = "Paste";
            pasteAnchorTag.appendChild(pasteSpanTag);
        };
        LayoutViewer.prototype._SetStyleToContextMenuItem = function (element) {
            element.style.textDecoration = "none";
            element.style.fontSize = "12px";
            element.style.fontFamily = "Segoe UI";
            element.style.cursor = "default";
            element.style.position = "relative";
            element.style.lineHeight = "27px";
            element.style.padding = "4px 20px";
        };
        LayoutViewer.prototype._OnContextMenuInternal = function (e) {
            var validateElem = this._ValidateClosestElement(e.target);
            var isClosestToContainer = validateElem.isClosestToContainer;
            var isVerticalScroller = validateElem.isVerticalScroller;
            var isHorizontalScroller = validateElem.isHorizontalScroller;
            e.preventDefault();
            if (e.target != this.ViewerContatiner && isClosestToContainer && (isVerticalScroller || isHorizontalScroller))
                return;
            if (this.OwnerControl.ej.browserInfo().name != "webkit") {
                this._AddContextMenuItems();
                this._ShowContextMenu();
                this._PositionContextMenu(e);
            }
        };
        LayoutViewer.prototype._AddContextMenuItems = function () {
            var cut = document.getElementById(DocumentEditorThemeHelper.ContextMenuCut);
            var copy = document.getElementById(DocumentEditorThemeHelper.ContextMenuCopy);
            var paste = document.getElementById(DocumentEditorThemeHelper.ContextMenuPaste);
            var hyperlink = document.getElementById(DocumentEditorThemeHelper.ContextMenuHyperlink);
            var OpenHyperlink = document.getElementById(DocumentEditorThemeHelper.ContextMenuOpenHyperlink);
            var CopyHyperlink = document.getElementById(DocumentEditorThemeHelper.ContextMenuCopyHyperlink);
            var EditHyperlink = document.getElementById(DocumentEditorThemeHelper.ContextMenuEditHyperlink);
            var RemoveHyperlink = document.getElementById(DocumentEditorThemeHelper.ContextMenuRemoveHyperlink);
            var TableProperties = document.getElementById(DocumentEditorThemeHelper.ContextMenuTableProperties);
            var Font = document.getElementById(DocumentEditorThemeHelper.ContextMenuFont);
            var Paragraph = document.getElementById(DocumentEditorThemeHelper.ContextMenuParagraph);
            if (this.OwnerControl.IsReadOnlyMode && !this.OwnerControl.Selection.IsEmpty) {
                copy.className = DocumentEditorThemeHelper.ContextMenuItem;
                cut.className = DocumentEditorThemeHelper.HiddenContextMenuItem;
                hyperlink.className = DocumentEditorThemeHelper.HiddenContextMenuItem;
            }
            else if (this.OwnerControl.Selection.IsEmpty) {
                if (this.OwnerControl.IsReadOnlyMode) {
                    copy.className = DocumentEditorThemeHelper.DisabledContextMenuItem;
                    cut.className = DocumentEditorThemeHelper.HiddenContextMenuItem;
                    hyperlink.className = DocumentEditorThemeHelper.HiddenContextMenuItem;
                }
                else {
                    cut.className = DocumentEditorThemeHelper.DisabledContextMenuItem;
                    copy.className = DocumentEditorThemeHelper.DisabledContextMenuItem;
                }
            }
            else {
                cut.className = DocumentEditorThemeHelper.ContextMenuItem;
                copy.className = DocumentEditorThemeHelper.ContextMenuItem;
            }
            if (!this.OwnerControl.IsReadOnlyMode && this.OwnerControl.Selection.Start.Paragraph.IsInsideTable && this.OwnerControl.Selection.End.Paragraph.IsInsideTable) {
                TableProperties.className = DocumentEditorThemeHelper.ContextMenuItem;
            }
            else {
                TableProperties.className = DocumentEditorThemeHelper.HiddenContextMenuItem;
            }
            if (this.OwnerControl._CanInsertHyperlink() && !this.OwnerControl.IsReadOnlyMode)
                hyperlink.className = DocumentEditorThemeHelper.ContextMenuItem;
            else
                hyperlink.className = DocumentEditorThemeHelper.HiddenContextMenuItem;
            var field = this.OwnerControl.Selection._GetHyperlinkField();
            if (field == null) {
                OpenHyperlink.className = DocumentEditorThemeHelper.HiddenContextMenuItem;
                CopyHyperlink.className = DocumentEditorThemeHelper.HiddenContextMenuItem;
                EditHyperlink.className = DocumentEditorThemeHelper.HiddenContextMenuItem;
                RemoveHyperlink.className = DocumentEditorThemeHelper.HiddenContextMenuItem;
            }
            else if (!this.OwnerControl.IsReadOnlyMode) {
                hyperlink.className = DocumentEditorThemeHelper.HiddenContextMenuItem;
                OpenHyperlink.className = DocumentEditorThemeHelper.ContextMenuItem;
                CopyHyperlink.className = DocumentEditorThemeHelper.ContextMenuItem;
                EditHyperlink.className = DocumentEditorThemeHelper.ContextMenuItem;
                RemoveHyperlink.className = DocumentEditorThemeHelper.ContextMenuItem;
            }
            if (!this.OwnerControl.IsReadOnlyMode) {
                paste.className = DocumentEditorThemeHelper.ContextMenuItem;
                Font.className = DocumentEditorThemeHelper.ContextMenuItem;
                Paragraph.className = DocumentEditorThemeHelper.ContextMenuItem;
            }
            else {
                paste.className = DocumentEditorThemeHelper.HiddenContextMenuItem;
                Font.className = DocumentEditorThemeHelper.HiddenContextMenuItem;
                Paragraph.className = DocumentEditorThemeHelper.HiddenContextMenuItem;
            }
        };
        LayoutViewer.prototype._ShowContextMenu = function () {
            if (this.ContextMenu.style.display == "none") {
                this.ContextMenu.style.display = "block";
            }
        };
        LayoutViewer.prototype._HideContextMenu = function () {
            if (this.ContextMenu.style.display != "none") {
                this.ContextMenu.style.display = "none";
            }
        };
        LayoutViewer.prototype._PositionContextMenu = function (e) {
            var clickPoint = this._GetContextMenuPosition(e);
            var clickCoordsX = clickPoint.X;
            var clickCoordsY = clickPoint.Y;
            var menuWidth = this.ContextMenu.offsetWidth + 4;
            var menuHeight = this.ContextMenu.offsetHeight + 4;
            var windowWidth = window.innerWidth;
            var windowHeight = window.innerHeight;
            var browserZoom = window.outerWidth / window.innerWidth;
            if ((clickCoordsX * browserZoom) + menuWidth < screen.width - 40) {
                this.ContextMenu.style.left = clickCoordsX + "px";
            }
            else {
                this.ContextMenu.style.left = clickCoordsX - menuWidth + "px";
            }
            if ((clickCoordsY * browserZoom) + menuHeight < screen.height - 40) {
                this.ContextMenu.style.top = clickCoordsY + "px";
            }
            else {
                this.ContextMenu.style.top = (clickCoordsY - menuHeight) + "px";
            }
        };
        LayoutViewer.prototype._GetContextMenuPosition = function (e) {
            var posx = 0;
            var posy = 0;
            if (!e)
                e = window.event;
            if (e.pageX || e.pageY) {
                posx = e.pageX;
                posy = e.pageY;
            }
            else if (e.clientX || e.clientY) {
                posx = e.clientX + document.body.scrollLeft + document.documentElement.scrollLeft;
                posy = e.clientY + document.body.scrollTop + document.documentElement.scrollTop;
            }
            return new Point(posx, posy);
        };
        LayoutViewer.prototype._GetContextMenuItem = function (e, contextMenuItemClassName) {
            var el = e.srcElement || e.target;
            if (el.classList.contains(contextMenuItemClassName)) {
                return el;
            }
            else {
                while ((el = el.parentNode) != null) {
                    if (el.classList && el.classList.contains(contextMenuItemClassName)) {
                        return el;
                    }
                }
            }
            return null;
        };
        LayoutViewer.prototype._HandleContextMenuItem = function (item) {
            switch (item) {
                case DocumentEditorThemeHelper.ContextMenuCut:
                    this.OwnerControl.Selection._Cut();
                    break;
                case DocumentEditorThemeHelper.ContextMenuCopy:
                    this.OwnerControl.Selection._Copy();
                    break;
                case DocumentEditorThemeHelper.ContextMenuOpenHyperlink:
                    var hyperLinkFieldToOpen = this.OwnerControl.Selection._GetHyperlinkField();
                    this.OwnerControl._FireRequestNavigate(hyperLinkFieldToOpen);
                    break;
                case DocumentEditorThemeHelper.ContextMenuCopyHyperlink:
                    var hyperLinkField = this.OwnerControl.Selection._GetHyperlinkField();
                    var navigationLink = new HyperLink(hyperLinkField);
                    var selction = new SelectionAdv(null);
                    selction._CopyToClipboard(navigationLink.NavigationLink);
                    break;
                case DocumentEditorThemeHelper.ContextMenuEditHyperlink:
                    if (!this.OwnerControl.IsReadOnlyMode)
                        this._ShowHyperlinkDialog();
                    break;
                case DocumentEditorThemeHelper.ContextMenuHyperlink:
                    if (!this.OwnerControl.IsReadOnlyMode)
                        this._ShowHyperlinkDialog();
                    break;
                case DocumentEditorThemeHelper.ContextMenuRemoveHyperlink:
                    if (!this.OwnerControl.IsReadOnlyMode)
                        this.OwnerControl.Selection._RemoveHyperlink();
                    break;
                case DocumentEditorThemeHelper.ContextMenuFont:
                    this._ShowFontDialog();
                    break;
                case DocumentEditorThemeHelper.ContextMenuParagraph:
                    this._ShowParagraphDialog();
                    break;
                case DocumentEditorThemeHelper.ContextMenuPaste:
                    this._OnPasteMenuClick();
                    break;
                case DocumentEditorThemeHelper.ContextMenuTableProperties:
                    this._ShowTablePropertiesDialog();
                    break;
            }
        };
        LayoutViewer.prototype._GetPageCanvas = function (page) {
            var id = page.Id;
            return { "backgroundContainer": document.getElementById(id + "_background"), "foregroundContainer": document.getElementById(id + "_foreground"), "selectionContainer": document.getElementById(id + "_selection"), "ellipseContainer": document.getElementById(id + "_ellipse"), "resizeContainer": document.getElementById(id + "_resize") };
        };
        LayoutViewer.prototype._CloseAllEjDialog = function () {
            var dlgInstances = [this.HyperlinkDialog.InsertHyperlinkDialog.data("ejDialog"), this.InsertFindAndReplaceDialog.data("ejDialog"), this.InsertTableDialog.data("ejDialog"), this.InsertAlertDialog.data("ejDialog"), this.fontDialog.InsertFontDialog.data("ejDialog"), this.ParagraphDialog.InsertParagraphDialog.data("ejDialog")];
            for (var i = 0; i < dlgInstances.length; i++) {
                var dlgObj = dlgInstances[i];
                if (dlgObj && dlgObj.isOpen())
                    dlgObj.close();
            }
        };
        LayoutViewer.prototype._ShowHideComments = function () {
            var viewer = this;
            for (var i = 0; i < viewer.Pages.Count; i++) {
                var page = viewer.Pages[i];
                var canvasObj = viewer._GetPageCanvas(page);
                if (canvasObj.backgroundContainer == null || canvasObj.foregroundContainer == null || canvasObj.selectionContainer == null
                    || canvasObj.ellipseContainer == null || canvasObj.resizeContainer == null)
                    return;
                var backgroundContainer = canvasObj.backgroundContainer;
                var foregroundContainer = canvasObj.foregroundContainer;
                var selectionContainer = canvasObj.selectionContainer;
                var ellipseContainer = canvasObj.ellipseContainer;
                var resizeContainer = canvasObj.resizeContainer;
                page._ShowHideComments(backgroundContainer, foregroundContainer, selectionContainer, ellipseContainer, resizeContainer, viewer);
            }
        };
        LayoutViewer.prototype._ShowTableDialog = function () {
            this._CreateEjDialog(this.InsertTableDialog);
            this._CloseAllEjDialog();
            this.InsertTableDialog.ejDialog("open");
        };
        LayoutViewer.prototype._ShowHyperlinkDialog = function () {
            this._CreateEjDialog(this.HyperlinkDialog.InsertHyperlinkDialog);
            this._CloseAllEjDialog();
            this.HyperlinkDialog.InsertHyperlinkDialog.ejDialog("open");
            this.HyperlinkDialog._loadHyperlinkFieldOnDialog();
        };
        LayoutViewer.prototype._ShowAlertDialog = function (msg) {
            this.InsertAlertDialog[0].innerText = msg;
            this._CreateEjDialog(this.InsertAlertDialog);
            this._CloseAllEjDialog();
            this.InsertAlertDialog.ejDialog("open");
        };
        LayoutViewer.prototype._ShowCellMarginsDialog = function () {
            this._CreateEjDialog(this.InsertCellMarginsDialog);
            this._CloseAllEjDialog();
            this.InsertCellMarginsDialog.ejDialog("open");
        };
        LayoutViewer.prototype._ShowFontDialog = function () {
            this._CreateEjDialog(this.fontDialog.InsertFontDialog);
            this._CloseAllEjDialog();
            this.fontDialog.InsertFontDialog.ejDialog("open");
            this.fontDialog._loadFontDialog();
        };
        LayoutViewer.prototype._ShowListDialog = function () {
            this._CreateEjDialog(this.InsertListDialog);
            this._CloseAllEjDialog();
            this.InsertListDialog.ejDialog("open");
            this._InitBindingForListUI();
        };
        LayoutViewer.prototype._ShowParagraphDialog = function () {
            this._CreateEjDialog(this.ParagraphDialog.InsertParagraphDialog);
            this._CloseAllEjDialog();
            this.ParagraphDialog.InsertParagraphDialog.ejDialog("open");
            this.ParagraphDialog._LoadParagraphDialog();
        };
        LayoutViewer.prototype._ShowFindAndReplaceDialog = function (isReplace) {
            if (isReplace) {
                this._CreateEjDialog(this.InsertFindAndReplaceDialog);
                var replaceTab = this.InsertFindAndReplaceDialog.find("#" + this.InsertFindAndReplaceDialog[0].id + "_tab");
                replaceTab.ejTab({ selectedItemIndex: 1 });
                this._CloseAllEjDialog();
                var replacetext_1 = this.InsertFindAndReplaceDialog.find("#" + this.InsertFindAndReplaceDialog[0].id + "_replaceText");
                replacetext_1[0].value = "";
                this.InsertFindAndReplaceDialog.ejDialog("open");
                this._OnFindReplaceTabChange(1);
                this._loadFindAndReplaceDialog();
            }
            else {
                var findTab = this.InsertFindAndReplaceDialog.find("#" + this.InsertFindAndReplaceDialog[0].id + "_tab");
                findTab.ejTab({
                    selectedItemIndex: 0
                });
                this._CloseAllEjDialog();
                var replacetext = this.InsertFindAndReplaceDialog.find("#" + this.InsertFindAndReplaceDialog[0].id + "_replaceTextBox");
                replacetext[0].value = "";
                this.InsertFindAndReplaceDialog.ejDialog("open");
                this._OnFindReplaceTabChange(0);
                var findDiv = this.InsertFindAndReplaceDialog.find("#" + this.InsertFindAndReplaceDialog[0].id + "_find");
                findDiv[0].style.display = "block";
                this._loadFindAndReplaceDialog();
            }
        };
        LayoutViewer.prototype._ShowTablePropertiesDialog = function () {
            this._LoadTableProperties();
            this.TablePropertiesDialog.ejDialog('open');
        };
        LayoutViewer.prototype._ShowBordersShadingsPropertiesDialog = function () {
            var borderWidthText = this.TableBorderAndShadingDialog.find("#" + this.TableBorderAndShadingDialog[0].id + "_width");
            var borderColorPalette = this.TableBorderAndShadingDialog.find("#" + this.TableBorderAndShadingDialog[0].id + "_border_color");
            var borderStyle = this.TableBorderAndShadingDialog.find("#" + this.TableBorderAndShadingDialog[0].id + "_border_style_dropDown");
            var fillColorPalette = this.TableBorderAndShadingDialog.find("#" + this.TableBorderAndShadingDialog[0].id + "_shading_color");
            var customDiv = this.TableBorderAndShadingDialog.find("#" + this.TableBorderAndShadingDialog[0].id + "_Custom_Div_Transparent");
            var previewDiv = this.TableBorderAndShadingDialog.find("#" + this.TableBorderAndShadingDialog[0].id + "_Preview_Div");
            var previewDivRightDiagonal = this.TableBorderAndShadingDialog.find("#" + this.TableBorderAndShadingDialog[0].id + "_Preview_Div_Right_Diagonal");
            var previewDivLeftDiagonal = this.TableBorderAndShadingDialog.find("#" + this.TableBorderAndShadingDialog[0].id + "_Preview_Div_Left_Diagonal");
            var previewDivHorizontal = this.TableBorderAndShadingDialog.find("#" + this.TableBorderAndShadingDialog[0].id + "_Preview_Div_Horizontal");
            var previewDivVertical = this.TableBorderAndShadingDialog.find("#" + this.TableBorderAndShadingDialog[0].id + "_Preview_Div_Vertical");
            var previewTopTopDiv = this.TableBorderAndShadingDialog.find("#" + this.TableBorderAndShadingDialog[0].id + "_previewDivTopTopTransParent");
            var previewTopCenterDiv = this.TableBorderAndShadingDialog.find("#" + this.TableBorderAndShadingDialog[0].id + "_previewDivTopCenterTransParent");
            var previewTopBottomDiv = this.TableBorderAndShadingDialog.find("#" + this.TableBorderAndShadingDialog[0].id + "_previewDivTopBottomTransParent");
            var previewRightDiagonalDiv = this.TableBorderAndShadingDialog.find("#" + this.TableBorderAndShadingDialog[0].id + "_previewDivDiagonalRightTransparent");
            var previewBottomLeftDiv = this.TableBorderAndShadingDialog.find("#" + this.TableBorderAndShadingDialog[0].id + "_previewDivBottomLeftTransparent");
            var previewBottomCenterDiv = this.TableBorderAndShadingDialog.find("#" + this.TableBorderAndShadingDialog[0].id + "_previewDivBottomcenterTransparent");
            var previewBottomRightDiv = this.TableBorderAndShadingDialog.find("#" + this.TableBorderAndShadingDialog[0].id + "_previewDivBottomRightTransparent");
            var previewLeftDiagonalDiv = this.TableBorderAndShadingDialog.find("#" + this.TableBorderAndShadingDialog[0].id + "_previewDivLeftDiagonalTransParent");
            var tableFormat;
            var bordersAndShading = new BordersAndShadingsDialog(null);
            if (this.OwnerControl != null)
                tableFormat = this.OwnerControl.Selection.TableFormat.Table.TableFormat;
            var lineStyle;
            var borderColor;
            var fillColor;
            var borderWidth;
            if (tableFormat != null && tableFormat.Borders != null) {
                if (tableFormat.Borders == null || tableFormat.Borders.Top == null) {
                    lineStyle = 1;
                    borderColor = "black";
                    borderWidth = 0;
                    fillColor = "black";
                }
                else {
                    lineStyle = bordersAndShading._GetLineStyle(tableFormat.Borders.Top.LineStyle);
                    borderColor = tableFormat.Borders.Top.Color;
                    borderWidth = tableFormat.Borders.Top._GetLineWidth();
                    fillColor = tableFormat.Shading.BackgroundColor;
                }
            }
            previewTopTopDiv.addClass("e-de-table-border-preview-click");
            previewTopCenterDiv.addClass("e-de-table-border-preview-click");
            previewTopBottomDiv.addClass("e-de-table-border-preview-click");
            previewRightDiagonalDiv.addClass("e-de-table-border-preview-click");
            previewBottomLeftDiv.addClass("e-de-table-border-preview-click");
            previewBottomCenterDiv.addClass("e-de-table-border-preview-click");
            previewBottomRightDiv.addClass("e-de-table-border-preview-click");
            previewLeftDiagonalDiv.addClass("e-de-table-border-preview-click");
            customDiv.addClass("e-de-table-border-setting-click");
            previewDiv.css("border", "1px solid black");
            previewDivRightDiagonal.css("display", "block");
            previewDivLeftDiagonal.css("display", "block");
            previewDivVertical.css("display", "block");
            previewDivHorizontal.css("display", "block");
            borderColorPalette.ejColorPicker({ value: borderColor });
            fillColorPalette.ejColorPicker({ value: fillColor });
            borderWidthText.ejNumericTextbox({ value: borderWidth });
            borderStyle.ejDropDownList({ selectedIndex: lineStyle });
            this.TableBorderAndShadingDialog.ejDialog("open");
        };
        LayoutViewer.prototype._OnFindReplaceTabChange = function (index) {
            var finddiv = this.InsertFindAndReplaceDialog.find("#" + this.InsertFindAndReplaceDialog[0].id + "_find");
            var replaceBtn = this.InsertFindAndReplaceDialog.find("#" + this.InsertFindAndReplaceDialog[0].id + "_replaceAll");
            var replaceAllBtn = this.InsertFindAndReplaceDialog.find("#" + this.InsertFindAndReplaceDialog[0].id + "_replace");
            var replacetext = this.InsertFindAndReplaceDialog.find("#" + this.InsertFindAndReplaceDialog[0].id + "_replaceTextBox");
            if (index == 0) {
                replaceBtn[0].style.visibility = "hidden";
                replaceAllBtn[0].style.visibility = "hidden";
                replacetext[0].style.visibility = "hidden";
            }
            else if (!this.OwnerControl.IsReadOnlyMode) {
                replaceBtn[0].style.visibility = "visible";
                replaceAllBtn[0].style.visibility = "visible";
                replacetext[0].style.visibility = "visible";
            }
        };
        LayoutViewer.prototype._InitBindingForListUI = function () {
            if (this.OwnerControl == null)
                return;
            this.viewModel = new ListDialogVieModel();
            if (this.OwnerControl.Selection.ParagraphFormat.ListLevelNumber > 0)
                this.viewModel.LevelNumber = this.OwnerControl.Selection.ParagraphFormat.ListLevelNumber;
            this.viewModel.List = this.OwnerControl.Selection.ParagraphFormat._GetList();
            if (this.ListLevel == null)
                return;
            if (this.ListLevel.CharacterFormat == null)
                this.ListLevel.CharacterFormat = new CharacterFormat(this.viewModel.ListLevel);
            if (this.ListLevel.ParagraphFormat == null)
                this.ListLevel.ParagraphFormat = new ParagraphFormat(this.viewModel.ListLevel);
            var followCharacter = this.InsertListDialog.find("#" + this.InsertListDialog[0].id + "_followCharacter").data("ejDropDownList");
            var restartBy = this.InsertListDialog.find("#" + this.InsertListDialog[0].id + "_restartBy");
            var listLevel = this.InsertListDialog.find("#" + this.InsertListDialog[0].id + "_listlevel");
            var numberStyle = this.InsertListDialog.find("#" + this.InsertListDialog[0].id + "_numberStyle").data("ejDropDownList");
            var startAtTextBox = this.InsertListDialog.find("#" + this.InsertListDialog[0].id + "_startAt").data("ejNumericTextbox");
            var textIndentAtTextBox = this.InsertListDialog.find("#" + this.InsertListDialog[0].id + "_textIndent").data("ejNumericTextbox");
            var alignedAtTextBox = this.InsertListDialog.find("#" + this.InsertListDialog[0].id + "_alignedAt").data("ejNumericTextbox");
            var numberFormat = this.InsertListDialog.find("#" + this.InsertListDialog[0].id + "_numberFormat");
            startAtTextBox.setModel({
                value: this.viewModel.ListLevel.StartAt
            });
            textIndentAtTextBox.setModel({
                value: this.viewModel.ListLevel.ParagraphFormat.LeftIndent
            });
            alignedAtTextBox.setModel({
                value: this.viewModel.ListLevel.ParagraphFormat.FirstLineIndent
            });
            followCharacter.setModel({
                selectedItemIndex: this.viewModel.ListLevel.FollowCharacter
            });
            numberFormat[0].value = this.viewModel.ListLevel.NumberFormat;
            var m = this.viewModel.ListLevel.ListLevelPattern == 23 ? 7 : this.viewModel.ListLevel.ListLevelPattern;
            numberStyle.selectItemByIndex(m);
            listLevel.ejDropDownList({
                selectedItemIndex: this.viewModel.LevelNumber
            });
            this.viewModel.LevelNumber = this.viewModel.LevelNumber;
        };
        LayoutViewer.prototype._OnListLevelChanged = function () {
            this._UpdateRestartLevelBox();
        };
        LayoutViewer.prototype._UpdateRestartLevelBox = function () {
            var restartBy = this.InsertListDialog.find("#" + this.InsertListDialog[0].id + "_restartBy").data("ejDropDownList");
            var followCharacter = this.InsertListDialog.find("#" + this.InsertListDialog[0].id + "_followCharacter");
            var listLevel = this.InsertListDialog.find("#" + this.InsertListDialog[0].id + "_listlevel").data("ejDropDownList");
            var numberStyle = this.InsertListDialog.find("#" + this.InsertListDialog[0].id + "_numberStyle").data("ejDropDownList");
            var startAtTextBox = this.InsertListDialog.find("#" + this.InsertListDialog[0].id + "_startAt");
            var textIndentAtTextBox = this.InsertListDialog.find("#" + this.InsertListDialog[0].id + "_textIndent").data("ejNumericTextbox");
            var alignedAtTextBox = this.InsertListDialog.find("#" + this.InsertListDialog[0].id + "_alignedAt");
            var numberFormat = this.InsertListDialog.find("#" + this.InsertListDialog[0].id + "_numberFormat");
            numberFormat[0].value = this.viewModel.ListLevel.NumberFormat;
            textIndentAtTextBox._textBox.value = this.viewModel.ListLevel.ParagraphFormat.LeftIndent;
            var m = this.viewModel.ListLevel.ListLevelPattern == 23 ? 7 : this.viewModel.ListLevel.ListLevelPattern;
            numberStyle.selectItemByIndex(m);
            this.ListLevel.RestartLevel = listLevel.selectedIndexValue == 0 ? 0 : listLevel.selectedIndexValue + 1;
            if (listLevel.selectedIndexValue == 0) {
                restartBy.setModel({
                    dataSource: ["No Restart"],
                });
            }
            else if (listLevel.selectedIndexValue == 1) {
                restartBy.setModel({
                    dataSource: ["Level 1", "No Restart"]
                });
            }
            else if (listLevel.selectedIndexValue == 2) {
                restartBy.setModel({
                    dataSource: ["Level 2", "Level 1", "No Restart"]
                });
            }
            else if (listLevel.selectedIndexValue == 3) {
                restartBy.setModel({
                    dataSource: ["Level 3", "Level 2", "Level 1", "No Restart"]
                });
            }
            else if (listLevel.selectedIndexValue == 4) {
                restartBy.setModel({
                    dataSource: ["Level 4", "Level 3", "Level 2", "Level 1", "No Restart"]
                });
            }
            else if (listLevel.selectedIndexValue == 5) {
                restartBy.setModel({
                    dataSource: ["Level 5", "Level 4", "Level 3", "Level 2", "Level 1", "No Restart"]
                });
            }
            else if (listLevel.selectedIndexValue == 6) {
                restartBy.setModel({
                    dataSource: ["Level 6", "Level 5", "Level 4", "Level 3", "Level 2", "Level 1", "No Restart"]
                });
            }
            else if (listLevel.selectedIndexValue == 7) {
                restartBy.setModel({
                    dataSource: ["Level 7", "Level 6", "Level 5", "Level 4", "Level 3", "Level 2", "Level 1", "No Restart"],
                });
            }
            else if (listLevel.selectedIndexValue == 8) {
                restartBy.setModel({
                    dataSource: ["Level 8", "Level 7", "Level 6", "Level 5", "Level 4", "Level 3", "Level 2", "Level 1", "No Restart"],
                });
            }
            restartBy.selectItemByIndex(0);
        };
        LayoutViewer.prototype._DisposeBindingForListUI = function () {
            this.viewModel.List = this.OwnerControl.Selection.ParagraphFormat._GetList();
            var followCharacter = this.InsertListDialog.find("#" + this.InsertListDialog[0].id + "_followCharacter").data("ejDropDownList");
            var restartBy = this.InsertListDialog.find("#" + this.InsertListDialog[0].id + "_restartBy");
            var listLevel = this.InsertListDialog.find("#" + this.InsertListDialog[0].id + "_listlevel").data("ejDropDownList");
            var numberStyle = this.InsertListDialog.find("#" + this.InsertListDialog[0].id + "_numberStyle");
            var startAtTextBox = this.InsertListDialog.find("#" + this.InsertListDialog[0].id + "_startAt").data("ejNumericTextbox");
            var textIndentAtTextBox = this.InsertListDialog.find("#" + this.InsertListDialog[0].id + "_textIndent").data("ejNumericTextbox");
            var alignedAtTextBox = this.InsertListDialog.find("#" + this.InsertListDialog[0].id + "_alignedAt").data("ejNumericTextbox");
            var numberFormat = this.InsertListDialog.find("#" + this.InsertListDialog[0].id + "_numberFormat");
            var listLevelAdv = this.viewModel.ListLevel;
            this._OnFollowCharacterValueChanged(followCharacter._selectedValue);
            this._OnLevelPatternValueChanged(numberStyle[0]);
            numberFormat[0].value = this.viewModel.ListLevel.NumberFormat;
            startAtTextBox.setModel({
                value: this.viewModel.ListLevel.StartAt
            });
            textIndentAtTextBox.setModel({
                value: this.viewModel.ListLevel.ParagraphFormat.LeftIndent
            });
            alignedAtTextBox.setModel({
                value: this.viewModel.ListLevel.ParagraphFormat.FirstLineIndent
            });
            listLevel.setModel({
                selectedItemIndex: this.viewModel.ListLevel.LevelNumber
            });
            followCharacter.setModel({
                selectedItemIndex: this.viewModel.ListLevel.FollowCharacter
            });
            if (this.viewModel != null)
                this.viewModel._Dispose();
        };
        LayoutViewer.prototype._OnApplyListButton = function () {
            if (this.OwnerControl)
                this.OwnerControl.Selection.ParagraphFormat._SetList(this.List);
            this.InsertListDialog.ejDialog("close");
            this._DisposeBindingForListUI();
        };
        LayoutViewer.prototype._OnFollowCharacterValueChanged = function (args) {
            if (args == "Space")
                this.viewModel.ListLevel.FollowCharacter = FollowCharacterType.Space;
            else if (args == "Tab")
                this.viewModel.ListLevel.FollowCharacter = FollowCharacterType.Tab;
            else
                this.viewModel.ListLevel.FollowCharacter = FollowCharacterType.None;
        };
        LayoutViewer.prototype._OnLevelPatternValueChanged = function (args) {
            if (args.value == "UpRoman")
                this.viewModel.ListLevel.ListLevelPattern = ListLevelPattern.UpRoman;
            else if (args.value == "LowRoman")
                this.viewModel.ListLevel.ListLevelPattern = ListLevelPattern.LowRoman;
            else if (args.value == "Arabic")
                this.viewModel.ListLevel.ListLevelPattern = ListLevelPattern.Arabic;
            else if (args.value == "Up Letter")
                this.viewModel.ListLevel.ListLevelPattern = ListLevelPattern.UpLetter;
            else if (args.value == "Low Letter")
                this.viewModel.ListLevel.ListLevelPattern = ListLevelPattern.LowLetter;
            else if (args.value == "Bullet") {
                this.viewModel.ListLevel.ListLevelPattern = ListLevelPattern.Bullet;
            }
            else if (args.value == "Number")
                this.viewModel.ListLevel.ListLevelPattern = ListLevelPattern.Number;
            else if (args.value == "Leading Zero")
                this.viewModel.ListLevel.ListLevelPattern = ListLevelPattern.LeadingZero;
            else if (args.value == "Ordinal")
                this.viewModel.ListLevel.ListLevelPattern = ListLevelPattern.Ordinal;
            else if (args.value == "Ordinal Text")
                this.viewModel.ListLevel.ListLevelPattern = ListLevelPattern.OrdinalText;
            else if (args.value == "Special")
                this.viewModel.ListLevel.ListLevelPattern = ListLevelPattern.Special;
            else if (args.value == "Far East")
                this.viewModel.ListLevel.ListLevelPattern = ListLevelPattern.FarEast;
            else
                this.viewModel.ListLevel.ListLevelPattern = ListLevelPattern.None;
            var numberFormat = "%" + (this.ListLevel.LevelNumber + 1).toString();
            var numberFormatDialog = this.InsertListDialog.find("#" + this.InsertListDialog[0].id + "_numberFormat");
            if (this.ListLevel.ListLevelPattern == ListLevelPattern.Bullet) {
                this.ListLevel.NumberFormat = "\uf0d8";
                numberFormatDialog[0].value = this.ListLevel.NumberFormat;
                this.ListLevel.CharacterFormat.FontFamily = "Wingdings";
            }
            else {
                if (this.ListLevel.ListLevelPattern == ListLevelPattern.None)
                    this.ListLevel.NumberFormat = "";
                if (!this.ListLevel.NumberFormat.match(numberFormat) && this.ListLevel.ListLevelPattern != ListLevelPattern.None)
                    this.ListLevel.NumberFormat = numberFormat + ".";
                numberFormatDialog[0].value = this.ListLevel.NumberFormat;
                this.ListLevel.CharacterFormat.FontFamily = "Verdana";
            }
        };
        LayoutViewer.prototype._loadFindAndReplaceDialog = function () {
            var findText = this.InsertFindAndReplaceDialog.find("#" + this.InsertFindAndReplaceDialog[0].id + "_FindWhatText")[0];
            if (findText.value != null && this.OwnerControl.Selection != null) {
                var text = this.OwnerControl.Selection._GetText(true);
                text = text.replace("\v", " ");
                var index = text.indexOf("\r");
                if (text != null && text != undefined) {
                    findText.value = index < 0 ? text : text.substring(0, index);
                }
                else
                    findText.value = findText.value;
            }
        };
        LayoutViewer.prototype._LoadTableProperties = function () {
            this._SetTableProperties();
            this._SetTableRowProperties();
            this._SetTableCellProperties();
        };
        LayoutViewer.prototype._SetTableProperties = function () {
            var tablePropertyId = "#" + this.TablePropertiesDialog[0].id + "_TableProperties";
            var preferredWidthCheckBox = this.TablePropertiesDialog.find(tablePropertyId + "_Prefer_Width_CheckBox");
            var preferredWidth = this.TablePropertiesDialog.find(tablePropertyId + "preferred_Width");
            var widthTypeDropDown = this.TablePropertiesDialog.find(tablePropertyId + "_width_dropdownList");
            var leftAlign = this.TablePropertiesDialog.find(tablePropertyId + "_left_alignment");
            var centerAlign = this.TablePropertiesDialog.find(tablePropertyId + "_center_alignment");
            var rightAlign = this.TablePropertiesDialog.find(tablePropertyId + "_right_alignment");
            var leftIndent = this.TablePropertiesDialog.find(tablePropertyId + "_left_indent");
            var tableFormat = this.OwnerControl.Selection.TableFormat.Table.TableFormat;
            var preferredCheckBoxIns = preferredWidthCheckBox.data("ejCheckBox");
            preferredWidthCheckBox.ejCheckBox({ checked: false });
            var widthTypeIns = widthTypeDropDown.data("ejDropDownList");
            preferredWidth.ejNumericTextbox({ value: tableFormat.PreferredWidth });
            if (tableFormat.PreferredWidthType == WidthType.Auto || tableFormat.PreferredWidthType == WidthType.Pixel) {
                widthTypeIns.selectItemByIndex(0);
            }
            else if (tableFormat.PreferredWidthType == WidthType.Percent) {
                widthTypeIns.selectItemByIndex(1);
            }
            leftIndent.ejNumericTextbox({ value: tableFormat.LeftIndent });
            if (tableFormat.TableAlignment == TableAlignment.Left) {
                var className = leftAlign[0].className;
                className = className.replace('e-de-table-properties-alignment', 'e-de-table-alignment-active');
                leftAlign[0].className = className;
            }
            else if (tableFormat.TableAlignment == TableAlignment.Center) {
                var className = centerAlign[0].className;
                className = className.replace('e-de-table-properties-alignment', 'e-de-table-alignment-active');
                centerAlign[0].className = className;
            }
            else if (tableFormat.TableAlignment == TableAlignment.Right) {
                var className = rightAlign[0].className;
                className = className.replace('e-de-table-properties-alignment', 'e-de-table-alignment-active');
                rightAlign[0].className = className;
            }
            preferredWidth.ejNumericTextbox('disable');
            widthTypeDropDown.ejDropDownList('disable');
        };
        ;
        LayoutViewer.prototype._SetTableRowProperties = function () {
            var cell = this._GetCell();
            var rowFormat = cell.OwnerRow.RowFormat;
            var rowPropertyId = "#" + this.TablePropertiesDialog[0].id + "_TableRowProperties";
            var rowHeightCheckBox = this.TablePropertiesDialog.find(rowPropertyId + "_height_CheckBox");
            var tableRowHeight = this.TablePropertiesDialog.find(rowPropertyId + "_table_row_height");
            var rowHeighType = this.TablePropertiesDialog.find(rowPropertyId + "_height_type_dropdownlist");
            var rowAllowRowBreak = this.TablePropertiesDialog.find(rowPropertyId + "_allow_row_break");
            var rowRepeatHeader = this.TablePropertiesDialog.find(rowPropertyId + "_repeat_header");
            var rowHeightCheckBoxIns = rowHeightCheckBox.data("ejCheckBox");
            var tableRowHeightIns = tableRowHeight.data("ejNumericTextbox");
            var rowHeighTypeIns = rowHeighType.data("ejDropDownList");
            rowHeightCheckBox.ejCheckBox({ checked: false });
            tableRowHeight.ejNumericTextbox({ value: rowFormat.Height });
            rowRepeatHeader.ejCheckBox({ checked: rowFormat.IsHeader });
            rowAllowRowBreak.ejCheckBox({ checked: rowFormat.AllowBreakAcrossPages });
            if (rowFormat.HeightType == HeightType.Auto || rowFormat.HeightType == HeightType.Atleast) {
                rowHeighTypeIns.selectItemByIndex(0);
            }
            else if (rowFormat.HeightType == HeightType.Exactly) {
                rowHeighTypeIns.selectItemByIndex(1);
            }
            tableRowHeight.ejNumericTextbox('disable');
            rowHeighType.ejDropDownList('disable');
        };
        ;
        LayoutViewer.prototype._GetCell = function () {
            var start = this.OwnerControl.Selection.Start;
            if (!this.OwnerControl.Selection.IsForward)
                start = this.OwnerControl.Selection.End;
            var selectedCell = start.Paragraph.AssociatedCell;
            while (selectedCell.OwnerTable != this.OwnerControl.Selection.TableFormat.Table)
                selectedCell = selectedCell.OwnerTable.AssociatedCell;
            return selectedCell;
        };
        LayoutViewer.prototype._SetTableCellProperties = function () {
            var cell = this._GetCell();
            var cellFormat = cell.CellFormat;
            var cellPropertyId = "#" + this.TablePropertiesDialog[0].id + "_TableCellProperties";
            var cellPreferWidthCheckBox = this.TablePropertiesDialog.find(cellPropertyId + "_Prefer_Width_CheckBox_cell");
            var cellPreferedWidth = this.TablePropertiesDialog.find(cellPropertyId + "tablecell_Width_textBox");
            var cellMeasureDropDown = this.TablePropertiesDialog.find(cellPropertyId + "_measure_type_cell_dropdownlist");
            var cellTop = this.TablePropertiesDialog.find(cellPropertyId + "_cell_top-alignment");
            var cellCenter = this.TablePropertiesDialog.find(cellPropertyId + "_cell_center-alignment");
            var cellBottom = this.TablePropertiesDialog.find(cellPropertyId + "_cell_bottom-alignment");
            var cellPreferedWidthIns = cellPreferedWidth.data("ejNumericTextbox");
            var measureDropDownIns = cellMeasureDropDown.data("ejDropDownList");
            cellPreferedWidth.ejNumericTextbox({ value: cellFormat.PrefferedWidth });
            cellPreferWidthCheckBox.ejCheckBox({ checked: true });
            if (cellFormat.PrefferedWidthType == WidthType.Auto || cellFormat.PrefferedWidthType == WidthType.Pixel) {
                measureDropDownIns.selectItemByIndex(0);
            }
            else if (cellFormat.PrefferedWidthType == WidthType.Percent) {
                measureDropDownIns.selectItemByIndex(1);
            }
            var className;
            if (cellFormat.VerticalAlignment == CellVerticalAlignment.Top) {
                className = cellTop[0].className;
                className = className.replace('e-de-tablecell-alignment', 'e-de-table-alignment-active');
                cellTop[0].className = className;
            }
            else if (cellFormat.VerticalAlignment == CellVerticalAlignment.Center) {
                className = cellCenter[0].className;
                className = className.replace('e-de-tablecell-alignment', 'e-de-table-alignment-active');
                cellCenter[0].className = className;
            }
            else if (cellFormat.VerticalAlignment == CellVerticalAlignment.Bottom) {
                className = cellBottom[0].className;
                className = className.replace('e-de-tablecell-alignment', 'e-de-table-alignment-active');
                cellBottom[0].className = className;
            }
        };
        ;
        LayoutViewer.prototype._onFindNext = function () {
            if (this.OwnerControl == null)
                return;
            var findText = this.InsertFindAndReplaceDialog.find("#" + this.InsertFindAndReplaceDialog[0].id + "_FindWhatText")[0];
            if (findText != null && findText != undefined && findText != "") {
                this.OwnerControl._Find(findText.value, 0);
                if (this.OwnerControl.textSearchResults.Count == 0) {
                    this._ShowAlertDialog("We couldn't find what you were looking for");
                }
            }
        };
        LayoutViewer.prototype._UpdateViewerSizeOnWindowResize = function () {
            var viewer = this;
            var element = this.OwnerControl.DocumentEditorElement;
            viewer._UpdateViewerSize();
            viewer._UpdateScrollBars();
        };
        LayoutViewer.prototype._UpdateViewerSize = function () {
            var element = this.OwnerControl.DocumentEditorElement;
            var rect = element.getBoundingClientRect();
            var width = 0, height = 0;
            if (this.isOptionsPaneShow) {
                var optionsRect = this.OptionsPane.getBoundingClientRect();
                width = (rect.width - optionsRect.width) > 0 ? (rect.width - optionsRect.width) : 200;
            }
            else
                width = rect.width > 0 ? rect.width : 200;
            height = rect.height > 0 ? rect.height : 200;
            this.ViewerContatiner.style.height = height.toString() + "px";
            this.ViewerContatiner.style.width = width.toString() + "px";
            this.Container.style.height = height.toString() + "px";
            this.Container.style.width = width.toString() + "px";
            this.visibleBounds = new Rect(0, 0, width, height);
        };
        LayoutViewer.prototype._ValidateFocus = function () {
            var scrollX = window.pageXOffset;
            var scrollY = window.pageYOffset;
            this.ViewerContatiner.focus();
            window.scrollTo(scrollX, scrollY);
        };
        LayoutViewer.prototype._UpdatePageLeft = function () {
            var viewer = this;
            if (viewer instanceof PageLayoutViewer && viewer.IsFitMultiplePages) {
                var x = 0;
                var y = 0;
                var fitHeight = 20;
                var startIndex = 0;
                var endIndex = 0;
                var canArrange = false;
                var fitWidth = 0;
                for (var i = 0; i <= this.Pages.Count; i++) {
                    endIndex = i;
                    if (i != this.Pages.Count)
                        fitWidth = fitWidth + this.Pages[i].BoundingRectangle.Width * this.ZoomFactor;
                    if (this.Pages.Count != 1 && i != 0)
                        fitWidth += 20;
                    var isTrue = this.Pages.Count == 1 ? true : this.Pages.Count == i ? true : false;
                    canArrange = (this.VisibleBounds.Width - fitWidth) / 2 <= 30 ? true : isTrue;
                    if (this.Pages.Count != 1)
                        endIndex = i - 1;
                    if (this.Pages.Count == 1 && endIndex == this.Pages.Count)
                        canArrange = false;
                    if (canArrange) {
                        var maxHeight = 0;
                        var sumOfWidth = 0;
                        for (var j = startIndex; j <= endIndex; j++) {
                            maxHeight = Math.max(this.Pages[j].BoundingRectangle.Height * this.ZoomFactor, maxHeight);
                            sumOfWidth = sumOfWidth + this.Pages[j].BoundingRectangle.Width * this.ZoomFactor;
                        }
                        if (startIndex < endIndex)
                            sumOfWidth = sumOfWidth + ((endIndex - startIndex) * 20);
                        x = (this.VisibleBounds.Width - sumOfWidth) / 2;
                        if (x < 30)
                            x = 30;
                        y = 0;
                        sumOfWidth = sumOfWidth + (x * 2);
                        for (var k = startIndex; k <= endIndex; k++) {
                            y = fitHeight + (maxHeight - this.Pages[k].BoundingRectangle.Height * this.ZoomFactor) / 2;
                            if (k != startIndex)
                                x = x + (this.Pages[k - 1].BoundingRectangle.Width * this.ZoomFactor) + 20;
                            this.Pages[k].BoundingRectangle = new Rect(x, this.Pages[k].BoundingRectangle.Y, this.Pages[k].BoundingRectangle.Width, this.Pages[k].BoundingRectangle.Height);
                        }
                        fitHeight = fitHeight + maxHeight + 20;
                        startIndex = i;
                        canArrange = false;
                        if (i != this.Pages.Count)
                            fitWidth = this.Pages[i].BoundingRectangle.Width * this.ZoomFactor;
                    }
                }
            }
        };
        LayoutViewer.prototype._PositionImageResizer = function (elementBox) {
            this.ImageResizer.SelectedImageWidget._Clear();
            var ResizeDiv;
            if (this.CurrentPage != null)
                ResizeDiv = document.getElementById(this.CurrentPage.Id + "_resize");
            if (ResizeDiv != null && this.ImageResizerDiv == null)
                this.ImageResizerDiv = this.ImageResizer._InitResizeMarks(ResizeDiv);
            this.ImageResizerDiv.style.width = (elementBox.Width) + "px";
            this.ImageResizerDiv.style.height = (elementBox.Height) + "px";
            this.ImageResizer.CurrentImageElementBox = elementBox;
            var lineWidget = elementBox.CurrentLineWidget;
            var top = lineWidget._GetTop() + elementBox.Margin.Top;
            var left = lineWidget._GetLeftInternal(elementBox, 0);
            if (this.OwnerControl.Selection._IsInComment()) {
                var comment = this.OwnerControl.Selection.Start.Paragraph._GetOwnerComment();
                left += comment.LayoutedWidget.X;
                top += comment.LayoutedWidget.Y;
            }
            var page = (this instanceof FlowLayoutViewer) ? this.CurrentPage : lineWidget.CurrentParagraphWidget._GetPage();
            var x = 0, y = 0;
            var viewer = this;
            var horizontalWidth = 0;
            if (viewer instanceof PageLayoutViewer) {
                var pageWidth = page._GetPageWidth();
                var pagelayout = viewer;
                horizontalWidth = parseFloat(document.getElementById(this.CurrentPage.Id + "_resize").style.width);
                if (pagelayout.IsFitMultiplePages) {
                    var currentPage = null;
                    var fitHeight = 20;
                    var startIndex = 0;
                    var endIndex = 0;
                    var canArrange = false;
                    var fitWidth = 0;
                    for (var i = 0; i <= this.Pages.Count; i++) {
                        endIndex = i;
                        if (i != this.Pages.Count)
                            fitWidth = fitWidth + this.Pages[i]._GetPageWidth() * this.ZoomFactor;
                        if (this.Pages.Count != 1 && i != 0)
                            fitWidth += 20;
                        var isTrue = this.Pages.Count == 1 ? true : this.Pages.Count == i ? true : false;
                        canArrange = (this.VisibleBounds.Width - fitWidth) / 2 <= 30 ? true : isTrue;
                        if (this.Pages.Count != 1)
                            endIndex = i - 1;
                        if (this.Pages.Count == 1 && endIndex == this.Pages.Count)
                            canArrange = false;
                        if (canArrange) {
                            var maxHeight = 0;
                            var sumOfWidth = 0;
                            for (var j = startIndex; j <= endIndex; j++) {
                                maxHeight = Math.max(this.Pages[j].BoundingRectangle.Height * this.ZoomFactor, maxHeight);
                                sumOfWidth = sumOfWidth + this.Pages[j]._GetPageWidth() * this.ZoomFactor;
                            }
                            if (startIndex < endIndex)
                                sumOfWidth = sumOfWidth + ((endIndex - startIndex) * 20);
                            x = (this.VisibleBounds.Width - sumOfWidth) / 2;
                            if (x < 30)
                                x = 30;
                            y = 0;
                            sumOfWidth = sumOfWidth + (x * 2);
                            for (var k = startIndex; k <= endIndex; k++) {
                                y = fitHeight + (maxHeight - this.Pages[k].BoundingRectangle.Height * this.ZoomFactor) / 2;
                                if (k != startIndex)
                                    x = x + (this.Pages[k - 1]._GetPageWidth() * this.ZoomFactor) + 20;
                                if (this.Pages._IndexOf(this.Pages[k]) == this.Pages._IndexOf(page)) {
                                    currentPage = this.Pages[k];
                                    break;
                                }
                            }
                            fitHeight = fitHeight + maxHeight + 20;
                            startIndex = i;
                            canArrange = false;
                            if (i != this.Pages.Count)
                                fitWidth = this.Pages[i]._GetPageWidth() * this.ZoomFactor;
                        }
                        if (currentPage != null)
                            break;
                    }
                }
                else {
                    x = (this.VisibleBounds.Width - horizontalWidth * this.ZoomFactor) / 2;
                    if (x < 30)
                        x = 30;
                    if (pageWidth < horizontalWidth)
                        x += (horizontalWidth - pageWidth) * this.ZoomFactor / 2;
                    y = page.BoundingRectangle.Top * this.ZoomFactor + (this.Pages._IndexOf(page) + 1) * 20 * (1 - this.ZoomFactor);
                }
            }
            var CurrentPageDiv = document.getElementById(this.CurrentPage.Id + "_resize");
            if (CurrentPageDiv != null) {
                var CurrentPageDivWidth = parseFloat(CurrentPageDiv.style.width);
                var CurrentPageDivHeight = parseFloat(CurrentPageDiv.style.height);
                var ImageResizerDivWidth = parseFloat(this.ImageResizerDiv.style.width);
                var ImageResizerDivHeight = parseFloat(this.ImageResizerDiv.style.height);
                var margin = (this.ImageResizer.ResizeMarkSize - 1) / 2;
                var width = ImageResizerDivWidth + 2 * margin, height = ImageResizerDivHeight + 2 * margin;
                if (width > (CurrentPageDivWidth - left) * this.ZoomFactor + margin)
                    width = (CurrentPageDivWidth - left) * this.ZoomFactor;
                if (height > (CurrentPageDivHeight - top) * this.ZoomFactor + margin)
                    height = (CurrentPageDivHeight - top) * this.ZoomFactor;
                if (width < ImageResizerDivHeight + margin || height < ImageResizerDivHeight + margin) {
                }
            }
            this.ImageResizer._SetImageResizerPosition(left, top, elementBox.Width, elementBox.Height);
            if (!this.ImageResizer.SelectedImageWidget._ContainsKey(lineWidget)) {
                var selectedImageInfo = new SelectedImageInfo(elementBox.Height, elementBox.Width);
                this.ImageResizer.SelectedImageWidget._Add(lineWidget, selectedImageInfo);
            }
        };
        LayoutViewer.prototype._ShowImageResizer = function () {
            var imageResizer = this.ImageResizer;
            if (imageResizer != null) {
                if (imageResizer.resizeContainerDiv != null)
                    imageResizer.resizeContainerDiv.style.display = "";
                if (imageResizer.bottomLeftRect != null)
                    imageResizer.bottomLeftRect.style.display = "";
                if (imageResizer.bottomRightRect != null)
                    imageResizer.bottomRightRect.style.display = "";
                if (imageResizer.bottomMiddleRect != null)
                    imageResizer.bottomMiddleRect.style.display = "";
                if (imageResizer.rightMiddleRect != null)
                    imageResizer.rightMiddleRect.style.display = "";
                if (imageResizer.topRightRect != null)
                    imageResizer.topRightRect.style.display = "";
                if (imageResizer.topLeftRect != null)
                    imageResizer.topLeftRect.style.display = "";
                if (imageResizer.leftMiddleRect != null)
                    imageResizer.leftMiddleRect.style.display = "";
                if (imageResizer.topMiddleRect != null)
                    imageResizer.topMiddleRect.style.display = "";
                this.isImageResizerVisible = true;
            }
        };
        LayoutViewer.prototype._HideImageResizer = function () {
            var imageResizer = this.ImageResizer;
            if (imageResizer != null) {
                if (imageResizer.resizeContainerDiv != null)
                    imageResizer.resizeContainerDiv.style.display = "none";
                if (imageResizer.bottomLeftRect != null)
                    imageResizer.bottomLeftRect.style.display = "none";
                if (imageResizer.bottomRightRect != null)
                    imageResizer.bottomRightRect.style.display = "none";
                if (imageResizer.bottomMiddleRect != null)
                    imageResizer.bottomMiddleRect.style.display = "none";
                if (imageResizer.rightMiddleRect != null)
                    imageResizer.rightMiddleRect.style.display = "none";
                if (imageResizer.topRightRect != null)
                    imageResizer.topRightRect.style.display = "none";
                if (imageResizer.topLeftRect != null)
                    imageResizer.topLeftRect.style.display = "none";
                if (imageResizer.leftMiddleRect != null)
                    imageResizer.leftMiddleRect.style.display = "none";
                if (imageResizer.topMiddleRect != null)
                    imageResizer.topMiddleRect.style.display = "none";
                this.isImageResizerVisible = false;
            }
        };
        LayoutViewer.prototype._IsInRowResizerArea = function (touchPoint) {
            var position = this._GetRowReSizerPosition(null, touchPoint);
            if (position == -1)
                return false;
            else {
                this.OwnerControl.ResizeNode = 1;
                this.OwnerControl.ResizerPosition = position;
                return true;
            }
        };
        LayoutViewer.prototype._GetRowReSizerPosition = function (widget, touchPoint) {
            var tableWidget = null;
            var cellWidget = null;
            if (widget == null) {
                tableWidget = this.OwnerControl.Viewer._GetTableWidget(touchPoint);
                cellWidget = this.OwnerControl.Viewer._GetTableCellWidget(touchPoint);
            }
            else
                tableWidget = widget._GetTableWidget(touchPoint);
            var cellSpacing = tableWidget == null ? 0 : tableWidget.Table.TableFormat.CellSpacing;
            if (tableWidget != null && cellSpacing > 0) {
                this.OwnerControl.CurrentResizingTable = tableWidget.Table;
                if (this._IsInsideRect(tableWidget.X, tableWidget.Y + tableWidget.Height - cellSpacing, tableWidget.ChildWidgets[tableWidget.ChildWidgets.Count - 1]._GetActualWidth(), tableWidget.Table.TableWidgets[tableWidget.Table.TableWidgets.Count - 1] == tableWidget ? tableWidget.BottomBorderWidth + cellSpacing : 0, touchPoint))
                    return tableWidget.ChildWidgets[tableWidget.ChildWidgets.Count - 1].TableRow.RowIndex;
                for (var i = 0; i < tableWidget.Table.Rows.Count; i++) {
                    for (var i_5 = 0; i_5 < tableWidget.Table.Rows.Count; i_5++) {
                        var tableRowAdv = tableWidget.Table.Rows[i_5];
                        if (tableRowAdv.TableRowWidgets.Count > 0) {
                            var rowWidget = tableRowAdv.TableRowWidgets[tableRowAdv.TableRowWidgets.Count - 1];
                            if (tableWidget.ChildWidgets._Contains(rowWidget) && (this._IsInsideRect(rowWidget.X, rowWidget.Y + rowWidget.Height + cellSpacing / 2, rowWidget._GetActualWidth(), cellSpacing / 2, touchPoint)))
                                return tableRowAdv.RowIndex;
                        }
                    }
                }
            }
            else {
                if (tableWidget != null && cellWidget == null)
                    cellWidget = tableWidget._GetTableCellWidget(touchPoint, this instanceof PageLayoutViewer);
                if (cellWidget != null) {
                    var rowWidget = cellWidget.ContainerWidget;
                    var height = 0;
                    if (rowWidget.TableRow.RowIndex == rowWidget.TableRow.OwnerTable.Rows.Count - 1)
                        height = rowWidget.BottomBorderWidth;
                    else
                        height = rowWidget.TableRow.NextNode.TableRowWidgets[rowWidget.TableRow.NextNode.TableRowWidgets.Count - 1].TopBorderWidth;
                    if (this._IsInsideRect(rowWidget.X, rowWidget.Y + rowWidget.Height - height, rowWidget.Width, height * 2, touchPoint)) {
                        this.OwnerControl.CurrentResizingTable = rowWidget.TableRow.OwnerTable;
                        return rowWidget.TableRow.RowIndex;
                    }
                    else {
                        if (cellWidget.ChildWidgets.Count > 0) {
                            return this._GetRowReSizerPosition(cellWidget, touchPoint);
                        }
                    }
                }
            }
            return -1;
        };
        LayoutViewer.prototype._IsInsideRect = function (X, Y, width, height, touchPoint) {
            if ((touchPoint.X > X && touchPoint.X <= X + width) && (touchPoint.Y > Y && touchPoint.Y <= Y + height))
                return true;
            return false;
        };
        LayoutViewer.prototype._GetTableWidget = function (cursorPoint) {
            return this._GetTableWidgetInternal(cursorPoint, false);
        };
        LayoutViewer.prototype._GetTableWidgetInternal = function (cursorPoint, isMouseDragged) {
            var widget = null;
            if (this.CurrentPage != null) {
                var isPointerDraggedInsideComment = isMouseDragged && this.OwnerControl.Selection._IsInComment();
                if ((cursorPoint.X > this.CurrentPage.BoundingRectangle.Width && cursorPoint.X < this.CurrentPage._GetPageWidth()) || isPointerDraggedInsideComment) {
                    var commentWidget = this.CurrentPage._GetCommentWidget(cursorPoint);
                    if (isPointerDraggedInsideComment)
                        commentWidget = this.OwnerControl.Selection.Start.Paragraph._GetOwnerComment().LayoutedWidget;
                    if (commentWidget != null && commentWidget.RenderedElement != null) {
                        cursorPoint.X = cursorPoint.X - this.CurrentPage.BoundingRectangle.Width;
                        cursorPoint.Y = cursorPoint.Y - commentWidget.TopPosition;
                        if (cursorPoint.X > commentWidget.Width)
                            cursorPoint.X = commentWidget.Width;
                        if (cursorPoint.Y > commentWidget.Height)
                            cursorPoint.Y = commentWidget.Height;
                        widget = commentWidget.Comment.LayoutedWidget._GetTableWidget(cursorPoint, this instanceof PageLayoutViewer);
                        if (widget != null)
                            return widget;
                    }
                }
                for (var i = 0; i < this.CurrentPage.BodyWidgets.Count; i++) {
                    var bodyWidget = this.CurrentPage.BodyWidgets[i];
                    widget = bodyWidget._GetTableWidget(cursorPoint, this instanceof PageLayoutViewer);
                    if (widget != null)
                        break;
                }
            }
            return widget;
        };
        LayoutViewer.prototype._GetTableCellWidget = function (cursorPoint) {
            return this._GetTableCellWidgetInternal(cursorPoint, false);
        };
        LayoutViewer.prototype._GetTableCellWidgetInternal = function (cursorPoint, isMouseDragged) {
            var widget = null;
            if (this.CurrentPage != null) {
                var isPointerDraggedInsideComment = isMouseDragged && this.OwnerControl.Selection._IsInComment();
                if ((cursorPoint.X > this.CurrentPage.BoundingRectangle.Width && cursorPoint.X < this.CurrentPage._GetPageWidth()) || isPointerDraggedInsideComment) {
                    var commentWidget = this.CurrentPage._GetCommentWidget(cursorPoint);
                    if (isPointerDraggedInsideComment)
                        commentWidget = this.OwnerControl.Selection.Start.Paragraph._GetOwnerComment().LayoutedWidget;
                    if (commentWidget != null && commentWidget.RenderedElement != null) {
                        cursorPoint.X = cursorPoint.X - this.CurrentPage.BoundingRectangle.Width;
                        cursorPoint.Y = cursorPoint.Y - commentWidget.TopPosition;
                        if (cursorPoint.X > commentWidget.Width)
                            cursorPoint.X = commentWidget.Width;
                        if (cursorPoint.Y > commentWidget.Height)
                            cursorPoint.Y = commentWidget.Height;
                        widget = commentWidget.Comment.LayoutedWidget._GetTableCellWidget(cursorPoint, this instanceof PageLayoutViewer);
                        if (widget != null)
                            return widget;
                    }
                }
                for (var i = 0; i < this.CurrentPage.BodyWidgets.Count; i++) {
                    var bodyWidget = this.CurrentPage.BodyWidgets[i];
                    widget = bodyWidget._GetTableCellWidget(cursorPoint, this instanceof PageLayoutViewer);
                    if (widget != null)
                        break;
                }
            }
            return widget;
        };
        LayoutViewer.prototype._HandleResizing = function (touchPoint) {
            var dragValue = 0;
            if (this.OwnerControl.ResizeNode == 0) {
                dragValue = touchPoint.X - this.OwnerControl.StartingPoint.X;
                this._ResizeTableCell(dragValue);
            }
            else {
                dragValue = touchPoint.Y - this.OwnerControl.StartingPoint.Y;
                this._ResizeTableRow(dragValue);
            }
        };
        LayoutViewer.prototype._ResizeTableRow = function (dragValue) {
            var table = this.OwnerControl.CurrentResizingTable;
            if (table == null)
                return;
            var selection = this.OwnerControl.Selection.CurrentSelectionRange;
            if (table.IsInsideTable)
                this.OwnerControl.IsLayoutEnabled = false;
            if (this.OwnerControl.ResizerPosition > -1) {
                var row = table.Rows[this.OwnerControl.ResizerPosition];
                row._UpdateHeight(dragValue);
                this.OwnerControl.Selection._SelectPosition(selection.Start, selection.End);
            }
            if (table.IsInsideTable) {
                var parentTable = table._GetParentTable();
                this.OwnerControl.IsLayoutEnabled = true;
                parentTable._LayoutItem(true);
            }
            this.OwnerControl.StartingPoint.Y = this.OwnerControl.StartingPoint.Y + dragValue;
        };
        LayoutViewer.prototype._GetCellReSizerPosition = function (touchPoint) {
            var position = -1;
            var resizerBoundaryWidth = 2;
            var tableWidget = this.OwnerControl.Viewer._GetTableWidget(touchPoint);
            var cellWidget = this.OwnerControl.Viewer._GetTableCellWidget(touchPoint);
            if (tableWidget != null && tableWidget.Table.TableFormat.CellSpacing > 0) {
                this.OwnerControl.CurrentResizingTable = tableWidget.Table;
                if (this._IsInsideRect(tableWidget.X - tableWidget.LeftBorderWidth - 0.25, tableWidget.Y, tableWidget.LeftBorderWidth + 0.5, tableWidget.Height, touchPoint))
                    return position = 0;
                var startingPointX = tableWidget.X;
                for (var i = 0; i < tableWidget.Table.TableHolder.Columns.Count; i++) {
                    if ((this._IsInsideRect(startingPointX - 1, tableWidget.Y, tableWidget.LeftBorderWidth, tableWidget.Height, touchPoint)))
                        return position = i > 0 ? i : 0;
                    else if (i > 1 && (this._IsInsideRect(startingPointX + tableWidget.Table.TableHolder.Columns[i].PreferredWidth - resizerBoundaryWidth / 2, tableWidget.Y, resizerBoundaryWidth, tableWidget.Height, touchPoint))) {
                        return position = (i + 1);
                    }
                    startingPointX = startingPointX + tableWidget.Table.TableHolder.Columns[i].PreferredWidth;
                }
            }
            else {
                if (cellWidget != null) {
                    this.OwnerControl.CurrentResizingTable = cellWidget.TableCell.OwnerTable;
                    if (this._IsInsideRect(cellWidget.X - cellWidget.Margin.Left - resizerBoundaryWidth / 2, cellWidget.Y - cellWidget.Margin.Top, resizerBoundaryWidth, cellWidget.Height, touchPoint))
                        return position = cellWidget.TableCell.ColumnIndex;
                    else if (cellWidget.TableCell.NextNode == null && this._IsInsideRect(cellWidget.X + cellWidget.Margin.Right + cellWidget.Width - resizerBoundaryWidth / 2, cellWidget.Y - cellWidget.Margin.Top, resizerBoundaryWidth, cellWidget.Height, touchPoint))
                        return position = (cellWidget.TableCell.ColumnIndex + cellWidget.TableCell.CellFormat.ColumnSpan);
                    else if (cellWidget.ChildWidgets.Count > 0) {
                        return this._GetCellReSizerPositionInternal(cellWidget, touchPoint);
                    }
                }
            }
            return position;
        };
        LayoutViewer.prototype._GetCellReSizerPositionInternal = function (cellWidget, touchPoint) {
            var position = -1;
            var childTableWidget = cellWidget._GetTableWidget(touchPoint);
            var childCellWidget = null;
            if (childTableWidget != null && childTableWidget.Table.TableFormat.CellSpacing > 0) {
                this.OwnerControl.CurrentResizingTable = childTableWidget.Table;
                if (this._IsInsideRect(childTableWidget.X - childTableWidget.LeftBorderWidth - 0.25, childTableWidget.Y, childTableWidget.LeftBorderWidth + 0.5, childTableWidget.Height, touchPoint))
                    return position = 0;
                var startingPointX = childTableWidget.X;
                for (var i = 0; i < childTableWidget.Table.TableHolder.Columns.Count; i++) {
                    if ((this._IsInsideRect(startingPointX - 1, childTableWidget.Y, childTableWidget.LeftBorderWidth, childTableWidget.Height, touchPoint)))
                        return position = i > 0 ? i : 0;
                    else if (i > 1 && (this._IsInsideRect(startingPointX + childTableWidget.Table.TableHolder.Columns[i].PreferredWidth - 1, childTableWidget.Y, 2, childTableWidget.Height, touchPoint))) {
                        return position = (i + 1);
                    }
                    startingPointX = startingPointX + childTableWidget.Table.TableHolder.Columns[i].PreferredWidth;
                }
            }
            else {
                if (childTableWidget != null)
                    childCellWidget = childTableWidget._GetTableCellWidget(touchPoint, this instanceof PageLayoutViewer);
                if (childCellWidget != null) {
                    this.OwnerControl.CurrentResizingTable = childCellWidget.TableCell.OwnerTable;
                    if (this._IsInsideRect(childCellWidget.X - childCellWidget.Margin.Left - 1, childCellWidget.Y - childCellWidget.Margin.Top, 2, childCellWidget.Height, touchPoint))
                        return position = childCellWidget.TableCell.ColumnIndex;
                    else if (childCellWidget.TableCell.NextNode == null && this._IsInsideRect(childCellWidget.X + childCellWidget.Margin.Right + childCellWidget.Width - 1, childCellWidget.Y - childCellWidget.Margin.Top, 2, childCellWidget.Height, touchPoint))
                        return position = (childCellWidget.TableCell.ColumnIndex + childCellWidget.TableCell.CellFormat.ColumnSpan);
                    else if (childCellWidget.ChildWidgets.Count > 0) {
                        return this._GetCellReSizerPositionInternal(childCellWidget, touchPoint);
                    }
                }
            }
            return position;
        };
        LayoutViewer.prototype._IsInCellResizerArea = function (touchPoint) {
            var position = this._GetCellReSizerPosition(touchPoint);
            if (position == -1)
                return false;
            else {
                this.OwnerControl.ResizeNode = 0;
                this.OwnerControl.ResizerPosition = position;
                return true;
            }
        };
        LayoutViewer.prototype._ResizeTableCell = function (dragValue) {
            var table = this.OwnerControl.CurrentResizingTable;
            if (table == null || dragValue == 0)
                return;
            var selectionFlag = true;
            this.OwnerControl.IsLayoutEnabled = false;
            var selection = this.OwnerControl.Selection.CurrentSelectionRange;
            if (!this.OwnerControl.Selection.IsEmpty && this.OwnerControl.Selection.SelectionRanges.Count >= 1) {
                var cellwidget = this._GetTableCellWidget(this.OwnerControl.StartingPoint);
                if (cellwidget != null && (this.OwnerControl.Selection.SelectionRanges.Last.SelectedWidgets._ContainsKey(cellwidget) ||
                    (cellwidget.TableCell.PreviousNode != null &&
                        this.OwnerControl.Selection.SelectionRanges[0].SelectedWidgets.ContainsKey(cellwidget.TableCell.PreviousNode.TableCellWidgets[0])))) {
                    var selectedCells = this.OwnerControl.Selection._GetSelectedCells();
                    if (this.OwnerControl.ResizerPosition == 0) {
                        var RightColumnCollection = table._GetColumnCells(this.OwnerControl.ResizerPosition, false);
                        var offset = 0;
                        table.IsTableGridUpdated = false;
                        var row = selectedCells[0].OwnerRow;
                        if (row.GridBeforeWidth > 0) {
                            var newGridBefore = row.GridBeforeWidth + dragValue;
                            if (newGridBefore > 0) {
                                row._UpdateGridBefore(dragValue);
                            }
                            else {
                                var leastGridBefore = table._GetLeastGridBefore(row);
                                if (newGridBefore < leastGridBefore && offset != newGridBefore) {
                                    table.TableFormat.LeftIndent = table.LeftIndent + newGridBefore > -344.333333 ? table.LeftIndent + newGridBefore : -344.333333;
                                    for (var i = 0; i < table.Rows.length; i++) {
                                        var tableRow = table.Rows[i];
                                        if (row != tableRow)
                                            tableRow._UpdateGridBefore(-newGridBefore);
                                    }
                                }
                            }
                        }
                        else {
                            if (dragValue < 0) {
                                table.TableFormat.LeftIndent = table.LeftIndent + dragValue > -344.333333 ? table.LeftIndent + dragValue : -344.333333;
                                for (var i = 0; i < table.Rows.length; i++) {
                                    var tableRow = table.Rows[i];
                                    if (selectedCells._Contains(tableRow.Cells[0])) {
                                        table.IsTableGridUpdated = false;
                                        tableRow.Cells[0]._DecreaseWidth(dragValue);
                                    }
                                    else {
                                        tableRow._UpdateGridBefore(-dragValue);
                                    }
                                }
                            }
                            else {
                                var leastGridBefore = table._GetLeastGridBefore(row);
                                var currentTableIndent = table.TableFormat.LeftIndent;
                                if (currentTableIndent == 0) {
                                    for (var i = 0; i < table.Rows.length; i++) {
                                        var tableRow = table.Rows[i];
                                        if (selectedCells._Contains(tableRow.Cells[0])) {
                                            tableRow._UpdateGridBefore(dragValue);
                                            table.IsTableGridUpdated = false;
                                            tableRow.Cells[0]._DecreaseWidth(dragValue);
                                        }
                                    }
                                }
                                else {
                                    var difference = leastGridBefore - dragValue;
                                    if (difference > 0) {
                                        table.IsTableGridUpdated = false;
                                        table.TableFormat.LeftIndent = table.LeftIndent + dragValue > -344.333333 ? table.LeftIndent + dragValue : -344.333333;
                                        for (var i = 0; i < table.Rows.length; i++) {
                                            var tableRow = table.Rows[i];
                                            if (selectedCells._Contains(tableRow.Cells[0])) {
                                                table.IsTableGridUpdated = false;
                                                tableRow.Cells[0]._DecreaseWidth(dragValue);
                                            }
                                            else {
                                                tableRow._UpdateGridBefore(-dragValue);
                                            }
                                        }
                                    }
                                    else {
                                        table.IsTableGridUpdated = false;
                                        table.TableFormat.LeftIndent = table.LeftIndent + leastGridBefore > -344.333333 ? table.LeftIndent + leastGridBefore : -344.333333;
                                        for (var i = 0; i < table.Rows.length; i++) {
                                            var tableRow = table.Rows[i];
                                            if (selectedCells._Contains(tableRow.Cells[0])) {
                                                table.IsTableGridUpdated = false;
                                                tableRow.Cells[0]._DecreaseWidth(dragValue);
                                                tableRow._UpdateGridBefore(dragValue - leastGridBefore);
                                            }
                                            else {
                                                tableRow._UpdateGridBefore(-leastGridBefore);
                                            }
                                        }
                                    }
                                }
                            }
                        }
                        table._CalculateGridOnly();
                        table.IsTableGridUpdated = false;
                        table._CheckTableGrid();
                        this.OwnerControl.IsLayoutEnabled = true;
                        if (table.IsInsideTable) {
                            var parentTable = table._GetParentTable();
                            parentTable._LayoutItem(true);
                        }
                        else
                            table._LayoutItem(true);
                        this.OwnerControl.StartingPoint.X = this.OwnerControl.StartingPoint.X + dragValue;
                        this.OwnerControl.ResizerPosition = this._GetCellReSizerPosition(this.OwnerControl.StartingPoint);
                    }
                    else if (table != null && this.OwnerControl.ResizerPosition == table.TableHolder.Columns.Count) {
                        var LeftColumnCollection = table._GetColumnCells(this.OwnerControl.ResizerPosition, true);
                        for (var i = 0; i < LeftColumnCollection.length; i++) {
                            var cell = LeftColumnCollection[i];
                            if (selectedCells._Contains(cell)) {
                                cell.OwnerTable.IsTableGridUpdated = false;
                                cell._IncreaseWidth(dragValue);
                            }
                        }
                        table._UpdateRowsGridAfterWidth();
                        table.IsTableGridUpdated = false;
                        table._UpdateWidth(dragValue);
                        table._CalculateGridOnly();
                        table.IsTableGridUpdated = false;
                        table._CheckTableGrid();
                        this.OwnerControl.IsLayoutEnabled = true;
                        if (table.IsInsideTable)
                            table.AssociatedCell.OwnerTable._LayoutItem(true);
                        else
                            table._LayoutItem(true);
                        this.OwnerControl.StartingPoint.X = this.OwnerControl.StartingPoint.X + dragValue;
                        this.OwnerControl.ResizerPosition = this._GetCellReSizerPosition(this.OwnerControl.StartingPoint);
                    }
                    else {
                        if (this.OwnerControl.ResizerPosition == -1)
                            return;
                        var ColumnIndex = this.OwnerControl.ResizerPosition;
                        var LeftColumnCollection = table._GetColumnCells(ColumnIndex, true);
                        var RightColumnCollection = table._GetColumnCells(ColumnIndex, false);
                        var isColumnResizing = table._IsColumnSelected(ColumnIndex, this.OwnerControl.Selection);
                        if (LeftColumnCollection.Count > 0 && !isColumnResizing) {
                            for (var i = 0; i < LeftColumnCollection.Count; i++) {
                                if (!selectedCells._Contains(LeftColumnCollection[i])) {
                                    LeftColumnCollection._RemoveAt(i);
                                    i--;
                                }
                            }
                        }
                        if (RightColumnCollection.Count > 0 && !isColumnResizing) {
                            for (var i = 0; i < RightColumnCollection.Count; i++) {
                                if (!selectedCells._Contains(RightColumnCollection[i])) {
                                    RightColumnCollection._RemoveAt(i);
                                    i--;
                                }
                            }
                        }
                        if (LeftColumnCollection.Count == 0 && RightColumnCollection.Count > 0) {
                            for (var i = 0; i < RightColumnCollection.length; i++) {
                                var cell = RightColumnCollection[i];
                                if (cell.PreviousNode != null)
                                    LeftColumnCollection._Add(cell.PreviousNode);
                            }
                        }
                        else if (RightColumnCollection.Count == 0 && LeftColumnCollection.Count > 0) {
                            for (var i = 0; i < LeftColumnCollection.length; i++) {
                                var cell = LeftColumnCollection[i];
                                if (cell.NextNode != null)
                                    RightColumnCollection._Add(cell.NextNode);
                            }
                        }
                        this._ChangeWidthOfCells(table, LeftColumnCollection, RightColumnCollection, dragValue, true);
                        table._CalculateGridOnly();
                        table.IsTableGridUpdated = false;
                        table._CheckTableGrid();
                        this.OwnerControl.IsLayoutEnabled = true;
                        if (table.IsInsideTable) {
                            var parentTable = table._GetParentTable();
                            parentTable._LayoutItem(true);
                        }
                        else
                            table._LayoutItem(true);
                        this.OwnerControl.StartingPoint.X = this.OwnerControl.StartingPoint.X + dragValue;
                        this.OwnerControl.ResizerPosition = this._GetCellReSizerPosition(this.OwnerControl.StartingPoint);
                    }
                    selectionFlag = false;
                    this.OwnerControl.Selection._SelectPosition(selection.Start, selection.End);
                }
            }
            if (!selectionFlag)
                return;
            if (this.OwnerControl.ResizerPosition == 0) {
                var RightColumnCollection = table._GetColumnCells(this.OwnerControl.ResizerPosition, false);
                var offset = 0;
                table.IsTableGridUpdated = false;
                table.TableFormat.LeftIndent = table.LeftIndent + dragValue > -344.333333 ? table.LeftIndent + dragValue : -344.333333;
                for (var i = 0; i < table.Rows.length; i++) {
                    var row = table.Rows[i];
                    var difference = row.GridBeforeWidth - dragValue;
                    if (!RightColumnCollection._Contains(row.Cells[0])) {
                        if (difference >= 0) {
                            row._UpdateGridBefore(-dragValue);
                        }
                        else {
                            table.IsTableGridUpdated = false;
                            if (difference != offset) {
                                table.TableFormat.LeftIndent = table.LeftIndent + difference > -344.333333 ? table.LeftIndent + difference : -344.333333;
                                offset = difference;
                            }
                            row.GridBeforeWidth = 0;
                        }
                    }
                }
                for (var i = 0; i < RightColumnCollection.length; i++) {
                    var cell = RightColumnCollection[i];
                    cell.OwnerTable.IsTableGridUpdated = false;
                    cell._DecreaseWidth(dragValue);
                    cell.OwnerRow._UpdateGridBefore(offset);
                }
                table._CalculateGridOnly();
                table.IsTableGridUpdated = false;
                table._CheckTableGrid();
                this.OwnerControl.IsLayoutEnabled = true;
                if (table.IsInsideTable) {
                    var parentTable = table._GetParentTable();
                    parentTable._LayoutItem(true);
                }
                else
                    table._LayoutItem(true);
                this.OwnerControl.StartingPoint.X = this.OwnerControl.StartingPoint.X + dragValue;
                this.OwnerControl.ResizerPosition = this._GetCellReSizerPosition(this.OwnerControl.StartingPoint);
            }
            else if (table != null && this.OwnerControl.ResizerPosition == table.TableHolder.Columns.Count) {
                var LeftColumnCollection = table._GetColumnCells(this.OwnerControl.ResizerPosition, true);
                for (var i = 0; i < LeftColumnCollection.length; i++) {
                    var cell = LeftColumnCollection[i];
                    cell.OwnerTable.IsTableGridUpdated = false;
                    cell._IncreaseWidth(dragValue);
                }
                table._UpdateRowsGridAfterWidth();
                table._UpdateWidth(dragValue);
                table._CalculateGridOnly();
                table.IsTableGridUpdated = false;
                table._CheckTableGrid();
                this.OwnerControl.IsLayoutEnabled = true;
                if (table.IsInsideTable) {
                    var parentTable = table._GetParentTable();
                    parentTable._LayoutItem(true);
                }
                else
                    table._LayoutItem(true);
                this.OwnerControl.StartingPoint.X = this.OwnerControl.StartingPoint.X + dragValue;
                this.OwnerControl.ResizerPosition = this._GetCellReSizerPosition(this.OwnerControl.StartingPoint);
            }
            else {
                if (this.OwnerControl.ResizerPosition == -1)
                    return;
                var ColumnIndex = this.OwnerControl.ResizerPosition;
                var LeftColumnCollection = table._GetColumnCells(ColumnIndex, true);
                var RightColumnCollection = table._GetColumnCells(ColumnIndex, false);
                this._ChangeWidthOfCells(table, LeftColumnCollection, RightColumnCollection, dragValue, false);
                table._CalculateGridOnly();
                table.IsTableGridUpdated = false;
                table._CheckTableGrid();
                this.OwnerControl.IsLayoutEnabled = true;
                if (table.IsInsideTable) {
                    var parentTable = table._GetParentTable();
                    parentTable._LayoutItem(true);
                }
                else
                    table._LayoutItem(true);
                this.OwnerControl.StartingPoint.X = this.OwnerControl.StartingPoint.X + dragValue;
                this.OwnerControl.ResizerPosition = this._GetCellReSizerPosition(this.OwnerControl.StartingPoint);
            }
            this.OwnerControl.IsLayoutEnabled = true;
            this.OwnerControl.Selection._SelectPosition(selection.Start, selection.End);
        };
        LayoutViewer.prototype._ChangeWidthOfCells = function (table, LeftColumnCollection, RightColumnCollection, dragValue, isSelection) {
            if (LeftColumnCollection.Count > 0) {
                var flag = false;
                for (var i = 0; i < LeftColumnCollection.length; i++) {
                    var cell = LeftColumnCollection[i];
                    cell.OwnerTable.IsTableGridUpdated = false;
                    cell._IncreaseWidth(dragValue);
                    if (cell.CellIndex == cell.OwnerRow.Cells.Count - 1)
                        flag = true;
                }
                if (flag)
                    table._UpdateRowsGridAfterWidth();
            }
            if (RightColumnCollection.Count > 0) {
                var diff = 0;
                for (var i = 0; i < RightColumnCollection.length; i++) {
                    var cell = RightColumnCollection[i];
                    if (cell.CellIndex == 0) {
                        var newGridBefore = cell.OwnerRow.GridBeforeWidth + dragValue;
                        if (newGridBefore >= 0)
                            cell.OwnerRow._UpdateGridBefore(dragValue);
                        else {
                            if (diff != newGridBefore)
                                diff = newGridBefore;
                            cell.OwnerRow.GridBeforeWidth = 0;
                        }
                    }
                    cell.OwnerTable.IsTableGridUpdated = false;
                    cell._DecreaseWidth(dragValue);
                }
                if (diff != 0) {
                    table.IsTableGridUpdated = false;
                    table.TableFormat.LeftIndent = table.LeftIndent + diff > -344.333333 ? table.LeftIndent + diff : -344.333333;
                    for (var i = 0; i < table.Rows.length; i++) {
                        var row = table.Rows[i];
                        if (!RightColumnCollection._Contains(row.Cells[0]))
                            row._UpdateGridBefore(diff > 0 ? diff : -diff);
                    }
                }
            }
        };
        LayoutViewer.prototype._InitTouchEvents = function () {
            this._InitTouchEllipse();
            this._InitCaret();
            var viewer = this;
            if (navigator.userAgent.match("MSIE") || navigator.userAgent.match(".NET")) {
                this.ViewerContatiner.addEventListener("pointerdown", function (event) {
                    viewer._OnPointerDownInternal(event);
                });
                this.ViewerContatiner.addEventListener("pointermove", function (event) {
                    viewer._OnPointerMoveInternal(event);
                });
                this.ViewerContatiner.addEventListener("pointerup", function (event) {
                    viewer._OnPointerUpInternal(event);
                });
                this.ViewerContatiner.addEventListener("pointerleave", function (event) {
                    viewer._OnPointerUpInternal(event);
                });
            }
            else if (navigator.userAgent.match("Edge") || navigator.userAgent.match("Chrome") || navigator.userAgent.match("FireFox") || navigator.userAgent.match("Safari")) {
                this.ViewerContatiner.addEventListener("touchstart", function (event) {
                    viewer._OnTouchStartInternal(event);
                });
                this.ViewerContatiner.addEventListener("touchmove", function (event) {
                    viewer._OnTouchMoveInternal(event);
                });
                this.ViewerContatiner.addEventListener("touchend", function (event) {
                    viewer._OnTouchEndInternal(event);
                });
                this.ViewerContatiner.addEventListener("touchcancel", function (event) {
                    viewer._OnTouchEndInternal(event);
                });
            }
        };
        LayoutViewer.prototype._InitTouchEllipse = function () {
            this.touchStart = document.createElement("div");
            this.touchStart.style.backgroundColor = "white";
            this.touchStart.style.borderStyle = "solid";
            this.touchStart.style.borderColor = "black";
            this.touchStart.style.borderWidth = "2px";
            this.touchStart.style.borderRadius = "50%";
            this.touchStart.style.width = "14px";
            this.touchStart.style.height = "13px";
            this.touchStart.style.position = "absolute";
            this.touchStart.style.display = "none";
            this.Container.appendChild(this.touchStart);
            this.touchEnd = document.createElement("div");
            this.touchEnd.style.backgroundColor = "white";
            this.touchEnd.style.borderStyle = "solid";
            this.touchEnd.style.borderColor = "black";
            this.touchEnd.style.borderWidth = "2px";
            this.touchEnd.style.borderRadius = "50%";
            this.touchEnd.style.width = "14px";
            this.touchEnd.style.height = "13px";
            this.touchEnd.style.position = "absolute";
            this.touchEnd.style.display = "none";
            this.Container.appendChild(this.touchEnd);
        };
        LayoutViewer.prototype._InitCaret = function () {
            this.Caret = document.createElement("div");
            this.Caret.className = "e-de-blinkcursor";
            this.Caret.style.height = "12px";
            this.Caret.style.width = "1px";
            this.Caret.style.backgroundColor = "black";
            this.Caret.style.position = "absolute";
            this.Caret.style.display = "none";
            this.Caret.style.animation = "deblinkcursor 1s infinite";
            this.Caret.style.webkitAnimation = "deblinkcursor 1s infinite";
            this.Container.appendChild(this.Caret);
            var NewStyleTag = document.createElement("style");
            NewStyleTag.textContent = "@keyframes deblinkcursor {" +
                "0% { opacity: 0; }" +
                "50%{ opacity: 1; }" +
                "100%{ opacity: 0; }" +
                "}" +
                "@-webkit-keyframes deblinkcursor {" +
                "0% { opacity: 0; }" +
                "50%{ opacity: 1; }" +
                "100%{ opacity: 0; }" +
                "}" +
                "@-moz-keyframes deblinkcursor{" +
                "0% { opacity: 0; }" +
                "50%{ opacity: 1; }" +
                "100%{ opacity: 0; }" +
                "}" +
                "@-ms-keyframes deblinkcursor{" +
                "0% { opacity: 0; }" +
                "50%{ opacity: 1; }" +
                "100%{ opacity: 0; }" +
                "}";
            document.body.appendChild(NewStyleTag);
        };
        LayoutViewer.prototype._OnPointerDownInternal = function (event) {
            if (event.pointerType == 'touch')
                this._TouchDownInternal(event, true);
            if (event.pointerType == 'touch') {
                this.PointerCount = this.PointerCount + 1;
                if (this.PointerCount <= 2) {
                    event.preventDefault();
                    this.Pointers.push(event);
                    if (this.PointerCount == 2)
                        this.PointerCount = 0;
                    if (this.ScrollStartX == -1 && this.ScrollStartY == -1) {
                        if (navigator.userAgent.match("MSIE") || navigator.userAgent.match(".NET")) {
                            this.ScrollStartY = event.pageY;
                            this.ScrollStartX = event.pageX;
                        }
                    }
                }
                this.IsTouchInput = false;
            }
        };
        LayoutViewer.prototype._OnPointerMoveInternal = function (event) {
            var PageX;
            var PageX1;
            if (event.pointerType == 'touch')
                this._TouchMoveInternal(event, true);
            if (event.pointerType == 'touch') {
                if (this.PointerCount == 1) {
                    PageX = event.pageX - this.ViewerContatiner.offsetLeft;
                    var PageY = event.pageY - this.ViewerContatiner.offsetTop;
                    if (PageX < this.Container.clientWidth && PageY < this.Container.clientHeight) {
                        this._ScrollContainer(event);
                        this.isTouchScroll = true;
                    }
                }
                if (this.Pointers.length == 2) {
                    this.isMousedown = false;
                    PageX = this.Pointers[0].pageX - this.ViewerContatiner.offsetLeft;
                    PageX1 = this.Pointers[1].pageX - this.ViewerContatiner.offsetLeft;
                    if (PageX < this.Container.offsetWidth && PageX1 < this.Container.offsetWidth) {
                        for (var i = 0; i < this.Pointers.length; i++) {
                            if (event.pointerId == this.Pointers[i].pointerId) {
                                this.Pointers[i] = event;
                                break;
                            }
                        }
                        var currentDiff = Math.sqrt(Math.pow((this.Pointers[0].clientX - this.Pointers[1].clientX), 2) + Math.pow((this.Pointers[0].clientY - this.Pointers[1].clientY), 2));
                        if (this.preDifference > -1) {
                            if (currentDiff > this.preDifference) {
                                this._OnPinchOutInternal(event);
                            }
                            else if (currentDiff < this.preDifference) {
                                this._OnPinchInInternal(event);
                            }
                        }
                        var scroltop = this.VerticalScrollBar.value;
                        if (!(scroltop == 0)) {
                            if (currentDiff > this.preDifference) {
                                this._OnPinchOutInternal(event);
                            }
                            else if (currentDiff < this.preDifference) {
                                this._OnPinchInInternal(event);
                            }
                        }
                        this.preDifference = currentDiff;
                    }
                }
            }
        };
        LayoutViewer.prototype._OnPointerUpInternal = function (event) {
            this.EditableDiv.focus();
            if (event.pointerType == 'touch')
                this._TouchUpInternal(event, true);
            if (event.pointerType == 'touch') {
                this.Pointers = new Array();
                this.PointerCount = 0;
                this.preDifference = -1;
                this.IsTouchInput = false;
                this.ScrollStartX = -1;
                this.ScrollStartY = -1;
            }
        };
        LayoutViewer.prototype._OnTouchStartInternal = function (event) {
            this.IsTouchInput = true;
            var touch = event.touches;
            if (touch.length == 1) {
                this._TouchDownInternal(event, false);
            }
            if (this.ScrollStartX == -1 && this.ScrollStartY == -1) {
                this.ScrollStartY = touch[0].pageY;
                this.ScrollStartX = touch[0].pageX;
            }
            event.preventDefault();
        };
        LayoutViewer.prototype._OnTouchMoveInternal = function (event) {
            var touch = event.touches;
            this._TouchMoveInternal(event, false);
            if (touch.length == 1) {
                var PageX = touch[0].pageX - this.ViewerContatiner.offsetLeft;
                var PageY = touch[0].pageY - this.ViewerContatiner.offsetTop;
                if (PageX < this.Container.clientWidth && PageY < this.Container.clientHeight) {
                    this._ScrollContainer(event);
                    this.isTouchScroll = true;
                }
            }
            if (touch.length > 1) {
                this.isMousedown = false;
                var currentDiff = Math.sqrt(Math.pow((touch[0].clientX - touch[1].clientX), 2) + Math.pow((touch[0].clientY - touch[1].clientY), 2));
                if (this.preDifference > -1) {
                    if (currentDiff > this.preDifference)
                        this._OnPinchOutInternal(event);
                    else if (currentDiff < this.preDifference)
                        this._OnPinchInInternal(event);
                }
                else if (this.ZoomFactor < 2) {
                    if (this.preDifference != -1) {
                        if (currentDiff > this.preDifference)
                            this._OnPinchInInternal(event);
                    }
                }
                else if (this.preDifference == -1) {
                    if (this.ZoomFactor > 2) {
                        if (currentDiff > this.preDifference)
                            this._OnPinchInInternal(event);
                    }
                }
                this.preDifference = currentDiff;
            }
            event.preventDefault();
        };
        LayoutViewer.prototype._OnTouchEndInternal = function (event) {
            if (event.changedTouches.length == 1)
                this._TouchUpInternal(event, false);
            this.ScrollStartX = -1;
            this.ScrollStartY = -1;
            this.preDifference = -1;
            this.IsTouchInput = false;
            event.preventDefault();
        };
        LayoutViewer.prototype._OnPinchInInternal = function (event) {
            this.preZoomFactor = this.ZoomFactor;
            this.ZoomFactor = this.ZoomFactor - 0.01;
            if (this.ZoomFactor < 5 && this.ZoomFactor > 2) {
                this.ZoomFactor = this.ZoomFactor - 0.01;
            }
            if (this.ZoomFactor < 0.1) {
                this.ZoomFactor = 0.1;
            }
            if (this.ZoomFactor >= 0.10) {
                var scrollY_1 = this.VerticalScrollBar.model.value / this.preZoomFactor * this.ZoomFactor;
                this.VerticalScrollBar.scroll(scrollY_1);
            }
        };
        LayoutViewer.prototype._OnPinchOutInternal = function (event) {
            this.preZoomFactor = this.ZoomFactor;
            this.ZoomFactor = this.ZoomFactor + 0.01;
            if (this.ZoomFactor > 2) {
                this.ZoomFactor = this.ZoomFactor + 0.01;
            }
            if (this.ZoomFactor > 5) {
                this.ZoomFactor = 5;
            }
            if (this.ZoomFactor <= 5) {
                var scrollY_2 = this.VerticalScrollBar.model.value / this.preZoomFactor * this.ZoomFactor;
                this.VerticalScrollBar.scroll(scrollY_2);
            }
        };
        LayoutViewer.prototype._ScrollContainer = function (event) {
            var xDiff, yDiff;
            if (navigator.userAgent.match("MSIE") || navigator.userAgent.match(".NET")) {
                xDiff = this.ScrollStartX - event.pageX;
                yDiff = this.ScrollStartY - event.pageY;
            }
            else {
                xDiff = this.ScrollStartX - event.touches[0].pageX;
                yDiff = this.ScrollStartY - event.touches[0].pageY;
            }
            if (xDiff < 0)
                xDiff = -(xDiff);
            if (yDiff < 0)
                yDiff = -(yDiff);
            if (xDiff > yDiff)
                this._ScrollHorizontal(event);
            else
                this._ScrollVertical(event);
        };
        LayoutViewer.prototype._ScrollHorizontal = function (event) {
            var scrollX = this.HorizontalScrollBar.model.value;
            var xpos;
            if (navigator.userAgent.match("MSIE") || navigator.userAgent.match(".NET")) {
                event.preventDefault();
                xpos = event.pageX;
                if (this.preDifference != -1) {
                    if (this.preDifference > xpos) {
                        scrollX = scrollX + 10;
                    }
                    else {
                        scrollX = scrollX - 10;
                    }
                }
                this.preDifference = xpos;
            }
            else if (event instanceof TouchEvent) {
                event.preventDefault();
                xpos = event.touches[0].pageX;
                if (this.preDifference != -1) {
                    if (this.preDifference > xpos) {
                        scrollX = scrollX + 10;
                    }
                    else {
                        scrollX = scrollX - 10;
                    }
                }
                this.preDifference = xpos;
            }
            if (scrollX < 0)
                scrollX = 0;
            if (scrollX > this.HorizontalScrollBar.model.maximum)
                scrollX = this.HorizontalScrollBar.model.maximum;
            this.HorizontalScrollBar.scroll(scrollX);
        };
        LayoutViewer.prototype._ScrollVertical = function (event) {
            var scrollY = this.VerticalScrollBar.model.value;
            var yPos;
            if (navigator.userAgent.match("MSIE") || navigator.userAgent.match(".NET")) {
                event.preventDefault();
                yPos = event.pageY;
                if (this.preDifference != -1) {
                    if (this.preDifference > yPos) {
                        scrollY = scrollY + 10;
                    }
                    else {
                        scrollY = scrollY - 10;
                    }
                }
                this.preDifference = yPos;
            }
            else if (event instanceof TouchEvent) {
                event.preventDefault();
                yPos = event.touches[0].pageY;
                if (this.preDifference != -1) {
                    if (this.preDifference > yPos) {
                        scrollY = scrollY + 10;
                    }
                    else {
                        scrollY = scrollY - 10;
                    }
                }
                this.preDifference = yPos;
            }
            if (scrollY < 0)
                scrollY = 0;
            if (scrollY > this.VerticalScrollBar.model.maximum)
                scrollY = this.VerticalScrollBar.model.maximum;
            this.VerticalScrollBar.scroll(scrollY);
        };
        LayoutViewer.prototype._OnMouseDownInternal = function (event) {
            this._UpdateCursor(event);
            if (this._IsLeftButtonPressed(event) && this.OwnerControl.SelectedResizeElement != null) {
                this.IsImageResizing = true;
            }
            var cursorPoint = new Point(event.offsetX, event.offsetY);
            var touchPoint = this._FindFocusedPage(cursorPoint);
            if (!this.OwnerControl.IsReadOnlyMode && ((this._IsInRowResizerArea(touchPoint)) || this._IsInCellResizerArea(touchPoint))) {
                this._HideCaret(true);
                this.isMousedown = true;
                this.isSelectionChangedOnMouseMoved = false;
                if (this._IsLeftButtonPressed(event)) {
                    this.OwnerControl.IsRowOrCellResizing = true;
                    this.OwnerControl.StartingPoint = touchPoint;
                    this.OwnerControl.InitialPoint.X = touchPoint.X;
                    this.OwnerControl.InitialPoint.Y = touchPoint.Y;
                    this.OwnerControl.Selection._InitResizingHistory(this.OwnerControl.InitialPoint);
                }
                return;
            }
            var validateElem = this._ValidateClosestElement(event.target);
            var isClosestToContainer = validateElem.isClosestToContainer;
            var isVerticalScroller = validateElem.isVerticalScroller;
            var isHorizontalScroller = validateElem.isHorizontalScroller;
            event.preventDefault();
            if (this.IsTouchInput) {
                event.preventDefault();
                return;
            }
            if (event.target != this.ViewerContatiner && isClosestToContainer && (isVerticalScroller || isHorizontalScroller))
                return;
            this._ValidateFocus();
            var point = new Point(event.offsetX, event.offsetY);
            if (point.X > this.Container.clientWidth)
                return;
            if (point.Y > this.Container.clientHeight)
                return;
            var clickPoint = this._FindFocusedPage(point);
            if (event.which == 3 && !this.OwnerControl.Selection.IsEmpty && !this._UpdateCursorPosition(clickPoint)) {
                event.preventDefault();
                return;
            }
            if (this.OwnerControl.Selection.IsEmpty)
                this.useTouchSelectionMark = false;
            if (this.OwnerControl.Selection.SelectionRanges.Count > 0 && this.isControlPressed) {
                if (this.OwnerControl.Selection.SelectionRanges.Count == 1 && this.OwnerControl.Selection.IsEmpty && event.detail == 1)
                    this.OwnerControl.Selection.SelectionRanges._Clear();
                if (event.detail == 1)
                    this.OwnerControl.Selection.SelectionRanges._AddSelection(this.OwnerControl.Document._GetDocumentStart(), this.OwnerControl.Document._GetDocumentStart());
                else
                    this.OwnerControl.Selection.SelectionRanges._AddSelection(this.OwnerControl.Selection.Start, this.OwnerControl.Selection.End);
            }
            this.IsTouchInput = false;
            this.isMousedown = true;
            this.isSelectionChangedOnMouseMoved = false;
            event.preventDefault();
        };
        LayoutViewer.prototype._OnMouseMoveInternal = function (event) {
            if (this.IsImageResizing) {
                this._HandleImageResizing(event);
                return;
            }
            if (this.IsTouchInput) {
                event.preventDefault();
                return;
            }
            this.tapCount = 0;
            var cursorPoint = new Point(event.offsetX, event.offsetY);
            var touchPoint = this._FindFocusedPage(cursorPoint);
            if (!this.OwnerControl.IsReadOnlyMode && this.OwnerControl.IsRowOrCellResizing) {
                if (this.OwnerControl.Selection.IsEmpty)
                    this.Caret.style.display = "none";
                this._HandleResizing(touchPoint);
            }
            else if (this.isMousedown && !this.IsImageResizing) {
                if (this.CurrentPage != null) {
                    var xPosition = touchPoint.X;
                    var yPosition = touchPoint.Y;
                    if (!(this.IsTouchInput || this.isSelectionChangedOnMouseMoved || this.TouchDownOnSelectionMark > 0)) {
                        this._UpdateTextPositionforSelection(touchPoint, 1, !event.ctrlKey);
                    }
                    if (this._IsLeftButtonPressed(event)) {
                        event.preventDefault();
                        var touchY = yPosition;
                        var textposition = this.OwnerControl.Selection.End;
                        var touchPoint_1 = new Point(xPosition, touchY);
                        this.OwnerControl.Selection._MoveTextPosition(touchPoint_1, !event.ctrlKey, textposition, this);
                        this.isSelectionChangedOnMouseMoved = true;
                    }
                }
                this._CheckForCursorVisibility(false);
            }
            if (!this.IsImageResizing)
                this._UpdateCursor(event);
        };
        LayoutViewer.prototype._OnMouseUpInternal = function (event, tapCount) {
            if (this.IsTouchInput) {
                event.preventDefault();
                return;
            }
            if (navigator.userAgent.match("Chrome"))
                tapCount = event.detail;
            var cursorPoint = new Point(event.offsetX, event.offsetY);
            var touchPoint = this._FindFocusedPage(cursorPoint);
            if (this.isMousedown && !this.isSelectionChangedOnMouseMoved && this.CurrentPage != null && this.OwnerControl.Selection.Start != null && !this.IsImageResizing) {
                if (this.TouchDownOnSelectionMark == 0)
                    this._UpdateTextPositionforSelection(touchPoint, tapCount, !event.ctrlKey);
                this._CheckForCursorVisibility(false);
            }
            if (this.CurrentPage != null && this.OwnerControl.Selection.Start != null && (this.OwnerControl.Selection.IsEmpty)
                && (this.IsTouchInput || (event.ctrlKey == true && this._IsLeftButtonPressed(event) == true)))
                this._NavigateHyperlink(touchPoint);
            if (this.isControlPressed && this.isMousedown && this.CurrentPage != null && this.OwnerControl.Selection.Start != null)
                this.OwnerControl.Selection.SelectionRanges._UpdateSelectionRange();
            if (this.IsImageResizing) {
                this._ScrollToPosition(this.OwnerControl.Selection.Start, this.OwnerControl.Selection.End);
                this.IsImageResizing = false;
                this.ImageResizer._UpdateHistory();
            }
            if (this.OwnerControl.IsRowOrCellResizing) {
                this.OwnerControl.Selection._UpdateResizingHistory(touchPoint);
                this.OwnerControl.IsRowOrCellResizing = false;
                this.OwnerControl.ResizerPosition = -1;
            }
            if (this.isImageResizerVisible && this.Caret != null)
                this.Caret.style.display = "none";
            this.isMousedown = false;
            this.isSelectionChangedOnMouseMoved = false;
            this.IsTouchInput = false;
            this.useTouchSelectionMark = true;
            this.IsImageResizing = false;
            this.EditableDiv.focus();
            event.preventDefault();
        };
        LayoutViewer.prototype._OnMouseWheelInternal = function (event) {
            this.IsTouchInput = false;
            if (event.ctrlKey == true) {
                event.preventDefault();
                var PageX = event.pageX - this.ViewerContatiner.offsetLeft;
                if (PageX < this.Container.offsetWidth) {
                    this.preZoomFactor = this.ZoomFactor;
                    if (navigator.userAgent.match("Firefox")) {
                        if (event.detail < 0) {
                            if (this.ZoomFactor <= 4.90)
                                this.ZoomFactor = this.ZoomFactor + .10;
                        }
                        else if (this.ZoomFactor >= .20) {
                            this.ZoomFactor = this.ZoomFactor - .10;
                        }
                    }
                    else {
                        if (event.wheelDelta > 0) {
                            if (this.ZoomFactor <= 4.90)
                                this.ZoomFactor = this.ZoomFactor + .10;
                            else
                                this.ZoomFactor = 5.00;
                        }
                        else {
                            if (this.ZoomFactor >= .20)
                                this.ZoomFactor = this.ZoomFactor - .10;
                            else
                                this.ZoomFactor = 0.10;
                        }
                    }
                    var scrollY_3 = this.VerticalScrollBar.model.value / this.preZoomFactor * this.ZoomFactor;
                    this.VerticalScrollBar.scroll(scrollY_3);
                }
            }
            else {
                var scrollY_4;
                var wheelDelta = (navigator.userAgent.match("Edge") || navigator.userAgent.match("MSIE") || navigator.userAgent.match(".NET")) ? event.wheelDelta : event.wheelDeltaY;
                if (navigator.userAgent.match("Firefox")) {
                    scrollY_4 = this.VerticalScrollBar.model.value + (event.detail * 40);
                }
                else
                    scrollY_4 = this.VerticalScrollBar.model.value - wheelDelta;
                if (scrollY_4 >= 0 && scrollY_4 <= this.VerticalScrollBar.model.maximum) {
                    this.VerticalScrollBar.scroll(scrollY_4);
                    event.preventDefault();
                }
                else if (scrollY_4 > this.VerticalScrollBar.model.maximum) {
                    this.VerticalScrollBar.scroll(this.VerticalScrollBar.model.maximum);
                }
                else {
                    this.VerticalScrollBar.scroll(0);
                }
            }
        };
        LayoutViewer.prototype._IsLeftButtonPressed = function (event) {
            this.IsTouchInput = false;
            var button = event.which || event.button;
            return button == 1;
        };
        LayoutViewer.prototype._OnDoubleTap = function (e) {
            this.IsTouchInput = false;
            this._FindFocusedPage(e);
            var selectedText = this.OwnerControl.Selection._GetText(true);
            if (selectedText.length == 0 && this.CurrentPage != null && this.OwnerControl.Selection.Start != null) {
                this.OwnerControl.Selection._SelectCurrentWord(true);
                this._CheckForCursorVisibility(true);
                this.tapCount = 2;
            }
        };
        LayoutViewer.prototype._OnkeyDownInternal = function (event) {
            var key = event.which || event.keyCode;
            var ctrl = event.ctrlKey ? event.ctrlKey : ((key === 17) ? true : false);
            var shift = event.shiftKey ? event.shiftKey : ((key === 16) ? true : false);
            if (ctrl && !shift) {
                this.isControlPressed = true;
                switch (key) {
                    case 9:
                        this._HandleTabKey(this.OwnerControl.Selection, false);
                        event.preventDefault();
                        break;
                    case 35:
                        this._HandleControlEndKey();
                        break;
                    case 36:
                        this._HandleControlHomeKey();
                        break;
                    case 37:
                        this._HandleControlLeftKey();
                        break;
                    case 38:
                        this._HandleControlUpKey();
                        break;
                    case 39:
                        this._HandleControlRightKey();
                        break;
                    case 40:
                        this._HandleControlDownKey();
                        break;
                    case 65:
                        this.OwnerControl.Selection._SelectAll();
                        break;
                    case 66:
                        event.preventDefault();
                        this.OwnerControl.Selection._OnBold();
                        break;
                    case 67:
                        event.preventDefault();
                        this.OwnerControl.Selection._Copy();
                        break;
                    case 69:
                        event.preventDefault();
                        this.OwnerControl.Selection._ToggleTextAlignment(TextAlignment.Center);
                        break;
                    case 70:
                        this._ShowHideOptionsPane(true);
                        event.preventDefault();
                        break;
                    case 72:
                        event.preventDefault();
                        if (!this.OwnerControl.IsReadOnlyMode)
                            this.OwnerControl.Viewer._ShowFindAndReplaceDialog(true);
                        break;
                    case 73:
                        event.preventDefault();
                        this.OwnerControl.Selection._OnItalic();
                        break;
                    case 74:
                        event.preventDefault();
                        this.OwnerControl.Selection._ToggleTextAlignment(TextAlignment.Justify);
                        break;
                    case 75:
                        event.preventDefault();
                        this.OwnerControl.Viewer._ShowHyperlinkDialog();
                        break;
                    case 76:
                        event.preventDefault();
                        this.OwnerControl.Selection._ToggleTextAlignment(TextAlignment.Left);
                        break;
                    case 78:
                        event.preventDefault();
                        this.OwnerControl.DocumentEditor.newDocument();
                        break;
                    case 80:
                        event.preventDefault();
                        this.OwnerControl._Print();
                        break;
                    case 82:
                        event.preventDefault();
                        this.OwnerControl.Selection._ToggleTextAlignment(TextAlignment.Right);
                        break;
                    case 85:
                        event.preventDefault();
                        this.OwnerControl.Selection._ToggleUnderline(Underline.Single);
                        break;
                    case 86:
                        if (navigator.userAgent.match("Firefox"))
                            this.EditableDiv.blur();
                        break;
                    case 88:
                        event.preventDefault();
                        this.OwnerControl.Selection._Cut();
                        break;
                    case 89:
                        this.OwnerControl.History._Redo();
                        break;
                    case 90:
                        this.OwnerControl.History._Undo();
                        break;
                    case 187:
                        event.preventDefault();
                        this.OwnerControl.Selection._ToggleBaselineAlignment(BaselineAlignment.Subscript);
                        break;
                }
            }
            else if (shift && !ctrl) {
                switch (key) {
                    case 35:
                        this._HandleShiftEndKey();
                        event.preventDefault();
                        break;
                    case 36:
                        this._HandleShiftHomeKey();
                        event.preventDefault();
                        break;
                    case 37:
                        this._HandleShiftLeftKey();
                        event.preventDefault();
                        break;
                    case 38:
                        this._HandleShiftUpKey();
                        event.preventDefault();
                        break;
                    case 39:
                        this._HandleShiftRightKey();
                        event.preventDefault();
                        break;
                    case 40:
                        this._HandleShiftDownKey();
                        event.preventDefault();
                        break;
                    case 13:
                        this._HandleShiftEnter();
                        event.preventDefault();
                        break;
                    case 9:
                        this._HandleShiftTabKey(this.OwnerControl.Selection);
                        event.preventDefault();
                        break;
                }
            }
            else if (shift && ctrl) {
                switch (key) {
                    case 35:
                        this._HandleControlShiftEndKey();
                        break;
                    case 36:
                        this._HandleControlShiftHomeKey();
                        break;
                    case 37:
                        this._HandleControlShiftLeftKey();
                        break;
                    case 38:
                        this._HandleControlShiftUpKey();
                        break;
                    case 39:
                        this._HandleControlShiftRightKey();
                        break;
                    case 40:
                        this._HandleControlShiftDownKey();
                        break;
                    case 43:
                        this.OwnerControl.Selection._ToggleBaselineAlignment(BaselineAlignment.Superscript);
                        break;
                }
                event.preventDefault();
            }
            else {
                switch (key) {
                    case 35:
                        this._HandleEndKey();
                        event.preventDefault();
                        break;
                    case 36:
                        this._HandleHomeKey();
                        event.preventDefault();
                        break;
                    case 37:
                        this._HandleLeftKey();
                        event.preventDefault();
                        break;
                    case 38:
                        this._HandleUpKey();
                        event.preventDefault();
                        break;
                    case 39:
                        this._HandleRightKey();
                        event.preventDefault();
                        break;
                    case 40:
                        this._HandleDownKey();
                        event.preventDefault();
                        break;
                    case 46:
                        this._HandleDelete();
                        event.preventDefault();
                        break;
                    case 13:
                        this._HandleEnter();
                        event.preventDefault();
                        break;
                    case 9:
                        this._HandleTabKey(this.OwnerControl.Selection, true);
                        event.preventDefault();
                        break;
                    case 8:
                        this._HandleBackKey();
                        event.preventDefault();
                        break;
                }
            }
            if (this.SearchHighlighters != null && this.SearchHighlighters.Count > 0)
                this._ClearSearchHighlight();
            if (event.keyCode == 27 || event.which == 27) {
                this._ClearSearchHighlight();
                this._ShowHideOptionsPane(false);
            }
        };
        LayoutViewer.prototype.OnTextInputInternal = function (e) {
            if (navigator.userAgent.match('Safari') && navigator.vendor.match('Apple')) {
                this._HandleTextInput(String.fromCharCode(e.keyCode));
            }
            else if (e.key != "Spacebar") {
                if (e.key.length == 1 && e.key != "\r" && e.key != "\b" && e.key != "\u001B" && !this.OwnerControl.IsReadOnlyMode && this.OwnerControl.IsDocumentLoaded && e.ctrlKey == false) {
                    this._HandleTextInput(e.key);
                }
            }
            else
                this._HandleTextInput(" ");
        };
        LayoutViewer.prototype._HandleImageResizing = function (event) {
            if (this.OwnerControl.SelectedResizeElement != null) {
                var top_7 = parseFloat(this.OwnerControl.SelectedResizeElement.style.top);
                var left = parseFloat(this.OwnerControl.SelectedResizeElement.style.left);
                var cursorPoint = new Point(event.offsetX, event.offsetY);
                var touchPoint = this._FindFocusedPage(cursorPoint);
                var x = 0;
                ;
                var y = 0;
                x = touchPoint.X - left;
                y = touchPoint.Y - top_7;
                switch (this.OwnerControl.SelectedResizeElement.id.split("_")[1]) {
                    case "TopRightRect":
                        y *= -1;
                        break;
                    case "TopLeftRect":
                        x *= -1;
                        y *= -1;
                        break;
                    case "TopMiddleRect":
                        x = 0;
                        y *= -1;
                        break;
                    case "BottomRightRect":
                        break;
                    case "BottomLeftRect":
                        x *= -1;
                        break;
                    case "BottomMiddleRect":
                        x = 0;
                        break;
                    case "RightMiddleRect":
                        y = 0;
                        break;
                    case "LeftMiddleRect":
                        x *= -1;
                        y = 0;
                        break;
                    default:
                        break;
                }
                if (x != 0 || y != 0) {
                    this.ImageResizer._InitHistory(this.ImageResizer.CurrentImageElementBox.ImageContainer);
                    if (this.ImageResizer.CurrentImageElementBox.ImageContainer != null) {
                        this.ImageResizer.CurrentImageElementBox.ImageContainer.Width = this.ImageResizer.CurrentImageElementBox.ImageContainer.Width + x > 10 ? this.ImageResizer.CurrentImageElementBox.ImageContainer.Width + x : 10;
                        this.ImageResizer.CurrentImageElementBox.ImageContainer.Height = this.ImageResizer.CurrentImageElementBox.ImageContainer.Height + y > 10 ? this.ImageResizer.CurrentImageElementBox.ImageContainer.Height + y : 10;
                        var ownerParagraph = this.ImageResizer.CurrentImageElementBox.ImageContainer.OwnerParagraph;
                        this._PositionImageResizer(this.ImageResizer.CurrentImageElementBox);
                        if (ownerParagraph != null && ownerParagraph.BaseParent != null) {
                            ownerParagraph._RelayoutParagraph(ownerParagraph.Inlines._IndexOf(this.ImageResizer.CurrentImageElementBox.ImageContainer));
                            this._UpdateScrollBars();
                            this.OwnerControl.Selection._HighlightSelection(false);
                        }
                        if ((this.OwnerControl.Viewer instanceof PageLayoutViewer) && ownerParagraph.ParagraphWidgets != null && ownerParagraph.ParagraphWidgets.Count > 0 && ownerParagraph.ParagraphWidgets[0].ContainerWidget instanceof TableCellWidget) {
                            if (ownerParagraph.ParagraphWidgets[0].ContainerWidget.ContainerWidget instanceof TableRowWidget) {
                                var tablerowwidget = ownerParagraph.ParagraphWidgets[0].ContainerWidget.ContainerWidget;
                                if (tablerowwidget.Y == this.OwnerControl.Viewer.ClientArea.Y && y > 0)
                                    this._UpdateScrollBars();
                                else if (tablerowwidget.Y != this.OwnerControl.Viewer.ClientArea.Y && y < 0)
                                    this._UpdateScrollBars();
                            }
                        }
                        else if (this.OwnerControl.Viewer instanceof PageLayoutViewer && ownerParagraph.ParagraphWidgets != null && ownerParagraph.ParagraphWidgets.Count > 0 && ownerParagraph.ParagraphWidgets[0].ContainerWidget instanceof BodyWidget) {
                            var paragraphwidget = ownerParagraph.ParagraphWidgets[0];
                            if (paragraphwidget.Y == this.OwnerControl.Viewer.ClientArea.Y && y > 0)
                                this._UpdateScrollBars();
                            else if (paragraphwidget.Y != this.OwnerControl.Viewer.ClientArea.Y && y < 0)
                                this._UpdateScrollBars();
                        }
                    }
                    this.IsImageResizing = true;
                }
            }
        };
        LayoutViewer.prototype._GetCurrentPoint = function (x, y) {
            var point = new Point(0, 0);
            point.X = x - this.ViewerContatiner.offsetLeft;
            point.Y = y - this.ViewerContatiner.offsetTop;
            return point;
        };
        LayoutViewer.prototype._UpdateCursorPosition = function (clickPoint) {
            var lineWidget = this._GetLineWidget(clickPoint);
            var cellWidget = null;
            if (lineWidget != null && lineWidget.CurrentParagraphWidget != null
                && lineWidget.CurrentParagraphWidget.ContainerWidget instanceof TableCellWidget)
                cellWidget = lineWidget.CurrentParagraphWidget.ContainerWidget;
            var width = 0;
            var lastSelectionWidget = null;
            var lastSelectionWidgetInfo = null;
            if (this.OwnerControl.Selection.SelectionRanges.Count > 0) {
                for (var i = 0; i < this.OwnerControl.Selection.SelectionRanges.Count; i++) {
                    var selectionRange = this.OwnerControl.Selection.SelectionRanges._Get(i);
                    var startPosition = (selectionRange.IsForward) ? selectionRange.Start : selectionRange.End;
                    var endPosition = (selectionRange.IsForward) ? selectionRange.End : selectionRange.Start;
                    var start = startPosition.Location;
                    var end = endPosition.Location;
                    var keys = selectionRange.SelectedWidgets.Keys;
                    for (var j = 0; j < keys.Count; j++) {
                        var widget = keys[j];
                        var widgetInfo = selectionRange.SelectedWidgets._Get(widget);
                        if ((widget instanceof LineWidget) && widget == lineWidget) {
                            lastSelectionWidget = keys[keys.length - 1];
                            lastSelectionWidgetInfo = selectionRange.SelectedWidgets._Get(lastSelectionWidget);
                            if (clickPoint.X <= this.CurrentPage.Viewer.ClientArea.X) {
                                return keys[0] == lineWidget ? !startPosition.IsAtParagraphStart : false;
                            }
                            else {
                                if (keys[0] == lineWidget) {
                                    width = start.X + widgetInfo.Width;
                                    return startPosition.IsAtParagraphStart ? !(width > clickPoint.X) : !(width > clickPoint.X && start.X < clickPoint.X);
                                }
                                else if (lastSelectionWidget == lineWidget) {
                                    width = widgetInfo.Width;
                                    return !(end.X > clickPoint.X && this.CurrentPage.Viewer.ClientArea.X < clickPoint.X);
                                }
                                else
                                    return false;
                            }
                        }
                        else if (widget instanceof TableCellWidget) {
                            if (cellWidget != null && cellWidget == widget) {
                                var cellwidget = widget;
                                if (cellwidget.X + cellwidget.Width > clickPoint.X)
                                    return false;
                            }
                        }
                    }
                }
            }
            return true;
        };
        LayoutViewer.prototype._OnZoomFactorChanged = function () {
            if (this.zoomFactor > 5)
                this.zoomFactor = 5;
            else if (this.zoomFactor < 0.1)
                this.zoomFactor = 0.1;
            this._Zoom();
            this.OwnerControl._RaiseClientEvent(DocumentEditorEvents.ZoomFactorChange, null);
        };
        LayoutViewer.prototype._UpdateCommentClientArea = function () {
            var width = 280;
            this.ClientArea = new Rect(30, 0, width, 0);
            this.ClientActiveArea = this.ClientArea;
        };
        LayoutViewer.prototype._MoveCommentsToPage = function (page) {
            for (var i = 0; i < this.CommentWidgets.Count; i++) {
                var commentWidget = this.CommentWidgets[i];
                this.CommentWidgets._Remove(commentWidget);
                if (commentWidget.Comment != null && commentWidget.Comment.Elements.Count > 0) {
                    commentWidget.TopPosition = commentWidget.Comment.Elements[0].CurrentLineWidget._GetTop();
                }
                if (page != null && page.CommentWidgets != null && !page.CommentWidgets._Contains(commentWidget)) {
                    page.CommentWidgets._Add(commentWidget);
                    commentWidget.Page = page;
                    page._AdjustCommentWidgets();
                }
                i--;
            }
        };
        LayoutViewer.prototype._ResetClientArea = function (clientArea, clientActiveArea) {
            this.ClientArea = clientArea;
            this.ClientActiveArea = clientActiveArea;
        };
        LayoutViewer.prototype._TouchDownInternal = function (e, isIE) {
            this.IsTouchInput = true;
            if (this.OwnerControl.Selection.IsEmpty)
                this.useTouchSelectionMark = false;
            this.isMousedown = true;
            this.isSelectionChangedOnMouseMoved = false;
            this._ValidateFocus();
            var point;
            if (this.isMousedown && this.CurrentPage != null && this.OwnerControl.Selection.Start != null && !isIE) {
                var OffsetInfo = this._getTouchOffsetValue(e);
                point = new Point(OffsetInfo.offsetX, OffsetInfo.offsetY);
            }
            else if (this.isMousedown && this.CurrentPage != null && this.OwnerControl.Selection.Start != null && isIE)
                point = new Point(e.offsetX, e.offsetY);
            point = this._FindFocusedPage(point);
            if (this.isReviewPanelShow && point.X > this.CurrentPage.BoundingRectangle.Width - this.CurrentPage.ReviewPanelWidth && point.X < this.CurrentPage._GetPageWidth()) {
                var commentWidget = this.CurrentPage._GetCommentWidget(point);
                if (commentWidget != null && commentWidget.RenderedElement != null) {
                    point.X = point.X - (this.CurrentPage.BoundingRectangle.Width - this.CurrentPage.ReviewPanelWidth);
                    point.Y = point.Y - commentWidget.TopPosition;
                    if (point.X > commentWidget.ContentWidth)
                        point.X = commentWidget.ContentWidth;
                    if (point.Y > commentWidget.Height)
                        point.Y = commentWidget.Height;
                }
            }
            var x = this.OwnerControl.Selection.End.Location.X;
            var y = this._GetCaretBottom(this.OwnerControl.Selection.End, this.OwnerControl.Selection.IsEmpty) + 9;
            this.TouchDownOnSelectionMark = ((point.Y <= y && point.Y >= y - 20 || point.Y >= y && point.Y <= y + 20)
                && (point.X <= x && point.X >= x - 20 || point.X >= x && point.X <= x + 20)) ? 1 : 0;
            if (!this.OwnerControl.Selection.IsEmpty && this.TouchDownOnSelectionMark == 0) {
                x = this.OwnerControl.Selection.Start.Location.X;
                y = this._GetCaretBottom(this.OwnerControl.Selection.Start, false) + 9;
                this.TouchDownOnSelectionMark = ((point.Y <= y && point.Y >= y - 20 || point.Y >= y && point.Y <= y + 20)
                    && (point.X <= x && point.X >= x - 20 || point.X >= x && point.X <= x + 20)) ? 2 : 0;
            }
        };
        LayoutViewer.prototype._TouchUpInternal = function (event, isIE) {
            this.EditableDiv.focus();
            if (!this.isTouchScroll && this.isMousedown && !this.isSelectionChangedOnMouseMoved && this.CurrentPage != null && this.OwnerControl.Selection.Start != null) {
                var point = void 0;
                if (!isIE) {
                    var OffsetInfo = this._getTouchOffsetValue(event);
                    point = new Point(OffsetInfo.offsetX, OffsetInfo.offsetY);
                }
                if (isIE)
                    point = new Point(event.offsetX, event.offsetY);
                var touchPoint = this._FindFocusedPage(point);
                if (this.TouchDownOnSelectionMark == 0)
                    this._UpdateTextPositionInternal(new Point(touchPoint.X, touchPoint.Y), 1, true);
                if (this.OwnerControl.Selection.IsEmpty)
                    this._NavigateHyperlink(touchPoint);
                this._CheckForCursorVisibility(true);
            }
            this.isTouchScroll = false;
            this.isMousedown = false;
            this.TouchDownOnSelectionMark = 0;
            this.useTouchSelectionMark = true;
            this.isSelectionChangedOnMouseMoved = false;
        };
        LayoutViewer.prototype._TouchMoveInternal = function (event, isIE) {
            var cursorPoint;
            if (this.isMousedown) {
                if (!isIE) {
                    var OffsetInfo = this._getTouchOffsetValue(event);
                    cursorPoint = new Point(OffsetInfo.offsetX, OffsetInfo.offsetY);
                }
                if (isIE)
                    cursorPoint = new Point(event.offsetX, event.offsetY);
                var touchPoint = this._FindFocusedPage(cursorPoint);
                if (this.TouchDownOnSelectionMark > 0) {
                    var touchY = touchPoint.Y;
                    var textposition = this.OwnerControl.Selection.End;
                    if (this.TouchDownOnSelectionMark > 0) {
                        var touchPointer = void 0;
                        if (touchPoint.Y <= 26)
                            touchY -= touchPoint.Y < 0 ? 0 : touchPoint.Y + 0.5;
                        else
                            touchY -= 36.5;
                        textposition = this.TouchDownOnSelectionMark == 2 ? this.OwnerControl.Selection.Start : this.OwnerControl.Selection.End;
                    }
                    touchPoint = new Point(touchPoint.X, touchY);
                    this.OwnerControl.Selection._MoveTextPosition(touchPoint, true, textposition, this);
                    this.isSelectionChangedOnMouseMoved = true;
                }
                this._CheckForCursorVisibility(true);
            }
        };
        LayoutViewer.prototype._getTouchOffsetValue = function (event) {
            var targetElement = event.target;
            var offset = targetElement.getBoundingClientRect();
            var touchOffsetValues = event.touches[0];
            if (touchOffsetValues == null)
                touchOffsetValues = event.changedTouches[0];
            var OffsetX = touchOffsetValues.pageX - offset.left;
            var OffsetY = touchOffsetValues.pageY - offset.top;
            return { "offsetX": OffsetX, "offsetY": OffsetY };
        };
        LayoutViewer.prototype._UpdateHFClientArea = function (section, isHeader) {
            var width = section.SectionFormat.PageWidth - section.SectionFormat.LeftMargin - section.SectionFormat.RightMargin;
            if (width < 0) {
                width = 0;
            }
            if (isHeader)
                this.ClientArea = new Rect(section.SectionFormat.LeftMargin, section.SectionFormat.HeaderDistance, width, section.SectionFormat.PageHeight - section.SectionFormat.HeaderDistance);
            else
                this.ClientArea = new Rect(section.SectionFormat.LeftMargin, section.SectionFormat.PageHeight - section.SectionFormat.FooterDistance, width, section.SectionFormat.PageHeight - section.SectionFormat.FooterDistance);
            this.ClientActiveArea = new Rect(this.ClientArea.X, this.ClientArea.Y, this.ClientArea.Width, this.ClientArea.Height);
        };
        LayoutViewer.prototype._UpdateClientAreaInternal = function () {
            this.Padding = new Thickness(10, 10, 10, 10);
            var width = (this.VisibleBounds.Width - this.Padding.Left - this.Padding.Right) / this.zoomFactor;
            if (width < 0)
                width = 0;
            this.ClientArea = new Rect(this.Padding.Left / this.zoomFactor, this.Padding.Top / this.zoomFactor, width, 0);
            this.ClientActiveArea = this.ClientArea;
        };
        LayoutViewer.prototype._UpdateClientArea = function (sectionFormat) {
            if (this instanceof FlowLayoutViewer) {
                if (sectionFormat == null)
                    return;
                var section = sectionFormat.OwnerBase;
                if (this.CurrentPage != null && section != null && section.Owner instanceof DocumentAdv) {
                    var index = section._GetIndexInOwnerCollection();
                    if (index > 0 && index - 1 < this.CurrentPage.BodyWidgets.Count && this.CurrentPage.BodyWidgets[index - 1].CurrentNode == section.PreviousNode) {
                        var bodyWidget = this.CurrentPage.BodyWidgets[index - 1];
                        this.ClientActiveArea.X = bodyWidget.X;
                        this.ClientActiveArea.Y = bodyWidget.Y + bodyWidget.Height;
                        this.ClientActiveArea.Width = bodyWidget.Width;
                    }
                    else
                        this._UpdateClientAreaInternal();
                    if (index > this.CurrentPage.BodyWidgets.Count - 1 || this.CurrentPage.BodyWidgets[index].CurrentNode != sectionFormat.OwnerBase)
                        this.CurrentPage.BodyWidgets._Insert(index, section._AddBodyWidget(this.ClientActiveArea));
                }
                else
                    this._UpdateClientAreaInternal();
                return;
            }
            else if (this.CurrentComment != null) {
                return;
            }
            var top = 0;
            if (sectionFormat != null)
                top = sectionFormat.TopMargin;
            var headerDistance = 48;
            var footerDistance = 48;
            if (sectionFormat != null) {
                headerDistance = sectionFormat.HeaderDistance;
                footerDistance = sectionFormat.FooterDistance;
            }
            if (this.CurrentRenderingPage.HeaderWidget != null) {
                top = Math.max(headerDistance + this.CurrentRenderingPage.HeaderWidget.Height, top);
            }
            var bottom = 0.667 + sectionFormat.BottomMargin;
            if (this.CurrentRenderingPage.FooterWidget != null) {
                bottom = 0.667 + Math.max(footerDistance + this.CurrentRenderingPage.FooterWidget.Height, sectionFormat.BottomMargin);
            }
            var width = 0;
            var height = 0;
            if (sectionFormat != null) {
                width = sectionFormat.PageWidth - sectionFormat.LeftMargin - sectionFormat.RightMargin;
                height = sectionFormat.PageHeight - top - bottom;
            }
            if (width < 0)
                width = 0;
            this.ClientArea = new Rect(sectionFormat.LeftMargin, top, width, sectionFormat.PageHeight - top - bottom);
            this.ClientActiveArea = new Rect(this.ClientArea.X, this.ClientArea.Y, this.ClientArea.Width, this.ClientArea.Height);
        };
        LayoutViewer.prototype._UpdateClientAreaForBlock = function (block, beforeLayout) {
            var leftIndent;
            var rightIndent;
            var X = 0;
            if (beforeLayout) {
                if (block instanceof TableAdv && block.TableWidgets.length > 0) {
                    var tableWidget = block.TableWidgets[0];
                    this.ClientActiveArea.X = this.ClientArea.X = tableWidget.X;
                    this.ClientActiveArea.Width = this.ClientArea.Width = tableWidget.Width;
                    tableWidget = block.TableWidgets[block.TableWidgets.length - 1];
                    tableWidget.X = this.ClientActiveArea.X;
                    tableWidget.Y = this.ClientActiveArea.Y;
                    this.ClientArea = new Rect(this.ClientArea.X, this.ClientArea.Y, this.ClientArea.Width, this.ClientArea.Height);
                    this.ClientActiveArea = new Rect(this.ClientActiveArea.X, this.ClientActiveArea.Y, this.ClientActiveArea.Width, this.ClientActiveArea.Height);
                }
                else {
                    if (block instanceof TableAdv && block.TableFormat != null && block.TableFormat.TableAlignment != TableAlignment.Left) {
                        var tableWidth = block._GetTableWidth();
                        if (block.TableFormat.TableAlignment == TableAlignment.Center)
                            leftIndent = (this.ClientArea.Width - tableWidth) / 2;
                        else
                            leftIndent = this.ClientArea.Width - tableWidth;
                        if ((this.CurrentComment != null || this instanceof FlowLayoutViewer) && Math.round(this.ClientArea.Width) < Math.round(tableWidth))
                            leftIndent = 0;
                        this.tableLeft.push(leftIndent);
                    }
                    else
                        leftIndent = block.LeftIndent;
                    this.ClientActiveArea.X = this.ClientArea.X = this.ClientArea.X + leftIndent;
                    var width = this.ClientArea.Width - (leftIndent + block.RightIndent);
                    this.ClientActiveArea.Width = this.ClientArea.Width = width > 0 ? width : 0;
                    this.ClientArea = new Rect(this.ClientArea.X, this.ClientArea.Y, this.ClientArea.Width, this.ClientArea.Height);
                    this.ClientActiveArea = new Rect(this.ClientActiveArea.X, this.ClientActiveArea.Y, this.ClientActiveArea.Width, this.ClientActiveArea.Height);
                }
            }
            else {
                if (block instanceof TableAdv && block.TableFormat.TableAlignment != TableAlignment.Left && this.tableLeft.length > 0)
                    leftIndent = this.tableLeft.pop();
                else
                    leftIndent = block.LeftIndent;
                this.ClientActiveArea.X = this.ClientArea.X = this.ClientArea.X - leftIndent;
                var width = this.ClientArea.Width + leftIndent + block.RightIndent;
                this.ClientActiveArea.Width = this.ClientArea.Width = width > 0 ? width : 0;
                this.ClientArea = new Rect(this.ClientArea.X, this.ClientArea.Y, this.ClientArea.Width, this.ClientArea.Height);
                this.ClientActiveArea = new Rect(this.ClientActiveArea.X, this.ClientActiveArea.Y, this.ClientActiveArea.Width, this.ClientActiveArea.Height);
            }
        };
        LayoutViewer.prototype._UpdateClientAreaForRow = function (row, beforeLayout) {
            var tableWidget = row.OwnerTable.TableWidgets[row.OwnerTable.TableWidgets.length - 1];
            if (beforeLayout) {
            }
            else {
                this.ClientActiveArea.X = this.ClientArea.X = tableWidget.X;
                this.ClientActiveArea.Width = this.ClientArea.Width = tableWidget.Width;
                this.ClientArea = new Rect(this.ClientArea.X, this.ClientArea.Y, this.ClientArea.Width, this.ClientArea.Height);
                this.ClientActiveArea = new Rect(this.ClientActiveArea.X, this.ClientActiveArea.Y, this.ClientActiveArea.Width, this.ClientActiveArea.Height);
            }
        };
        LayoutViewer.prototype._UpdateClientAreaForCell = function (cell, beforeLayout) {
            var rowWidget = cell.OwnerRow.TableRowWidgets[cell.OwnerRow.TableRowWidgets.length - 1];
            var cellWidget = cell.TableCellWidgets[cell.TableCellWidgets.length - 1];
            if (beforeLayout) {
                this.TextWrap = true;
                this.ClientActiveArea.X = this.ClientArea.X = cellWidget.X;
                this.ClientActiveArea.Y = cellWidget.Y;
                this.ClientActiveArea.Width = this.ClientArea.Width = cellWidget.Width > 0 ? cellWidget.Width : 0;
                if (this instanceof PageLayoutViewer)
                    this.ClientActiveArea.Height = Number.POSITIVE_INFINITY;
                this.ClientArea = new Rect(this.ClientArea.X, this.ClientArea.Y, this.ClientArea.Width, this.ClientArea.Height);
                this.ClientActiveArea = new Rect(this.ClientActiveArea.X, this.ClientActiveArea.Y, this.ClientActiveArea.Width, this.ClientActiveArea.Height);
            }
            else {
                this.TextWrap = true;
                this.ClientActiveArea.X = this.ClientArea.X = cellWidget.X + cellWidget.Width + cellWidget.Margin.Right;
                if (rowWidget.X + rowWidget.Width - this.ClientArea.X < 0)
                    this.ClientActiveArea.Width = this.ClientArea.Width = 0;
                else
                    this.ClientActiveArea.Width = this.ClientArea.Width = rowWidget.X + rowWidget.Width - this.ClientArea.X;
                this.ClientActiveArea.Y = cellWidget.Y - cellWidget.Margin.Top - cell.OwnerTable.TableFormat.CellSpacing;
                if (!cell.OwnerTable.IsInsideTable)
                    this.ClientActiveArea.Height = this.ClientArea.Bottom - rowWidget.Y > 0 ? this.ClientArea.Bottom - rowWidget.Y : 0;
                this.ClientArea = new Rect(this.ClientArea.X, this.ClientArea.Y, this.ClientArea.Width, this.ClientArea.Height);
                this.ClientActiveArea = new Rect(this.ClientActiveArea.X, this.ClientActiveArea.Y, this.ClientActiveArea.Width, this.ClientActiveArea.Height);
            }
        };
        LayoutViewer.prototype._UpdateClientWidth = function (width) {
            this.ClientActiveArea.X -= width;
            if (this.ClientActiveArea.Width + width > 0)
                this.ClientActiveArea.Width += width;
            else
                this.ClientActiveArea.Width = 0;
        };
        LayoutViewer.prototype._CutFromLeft = function (x) {
            if (x < this.ClientActiveArea.Left)
                x = this.ClientActiveArea.Left;
            if (x > this.ClientActiveArea.Right && this.TextWrap)
                x = this.ClientActiveArea.Right;
            this.ClientActiveArea.Width = this.ClientActiveArea.Right > x ? this.ClientActiveArea.Right - x : 0;
            this.ClientActiveArea.X = x;
        };
        LayoutViewer.prototype._CutFromTop = function (y) {
            if (y < this.ClientActiveArea.Top)
                y = this.ClientActiveArea.Top;
            if (this instanceof PageLayoutViewer && y > this.ClientActiveArea.Bottom && this.CurrentComment == null)
                y = this.ClientActiveArea.Bottom;
            if (this instanceof PageLayoutViewer && this.CurrentComment == null)
                this.ClientActiveArea.Height = this.ClientActiveArea.Bottom - y;
            else {
                this.ClientActiveArea.Height = y;
                this.ClientArea.Height = this.ClientActiveArea.Height;
            }
            this.ClientActiveArea.X = this.ClientArea.X;
            this.ClientActiveArea.Width = this.ClientArea.Width;
            this.ClientActiveArea.Y = y;
        };
        LayoutViewer.prototype._ClearContainer = function () {
            this._RemoveRenderedPages();
            this.Pages._Clear();
            this.isReviewPanelShow = false;
            this.VerticalScrollBar.scroll(0);
            this.HorizontalScrollBar.scroll(0);
            this.HorizontalWidth = 0;
            this._HideImageResizer();
            if (this.LineElements.Count > 0)
                this.LineElements._Clear();
        };
        LayoutViewer.prototype._InsertPage = function (index, page) {
            this.Pages._Remove(page);
            this.Pages._Insert(index, page);
            var top = 20;
            if (index > 0)
                top += this.Pages[index - 1].BoundingRectangle.Bottom;
            for (var i = index; i < this.Pages.Count; i++) {
                page = this.Pages[i];
                page.BoundingRectangle = new Rect(page.BoundingRectangle.X, top, page.BoundingRectangle.Width, page.BoundingRectangle.Height);
                top = page.BoundingRectangle.Bottom + 20;
            }
        };
        LayoutViewer.prototype._UpdateClientAreaTopOrLeft = function (tableWidget, beforeLayout) {
            if (beforeLayout) {
                this.ClientActiveArea.Y = this.ClientActiveArea.Y + tableWidget.TopBorderWidth;
                this.ClientActiveArea.X = this.ClientActiveArea.X + tableWidget.LeftBorderWidth;
            }
        };
        LayoutViewer.prototype._UpdateClientAreaForTable = function (tableWidget) {
            this.ClientActiveArea.X = this.ClientArea.X = tableWidget.X;
            this.ClientActiveArea.Width = this.ClientArea.Width = tableWidget.Width;
        };
        LayoutViewer.prototype._UpdateTextPosition = function (cursorPoint, clearMultiSelection) {
            var widget = this._GetLineWidget(cursorPoint);
            if (widget != null) {
                widget._UpdateTextPosition(this.OwnerControl, cursorPoint, clearMultiSelection);
            }
        };
        LayoutViewer.prototype._UpdateTextPositionforSelection = function (cursorPoint, tapCount, clearMultiSelection) {
            var widget = this._GetLineWidget(cursorPoint);
            if (widget != null) {
                widget._UpdateTextPosition(this.OwnerControl, cursorPoint, clearMultiSelection);
            }
            if (tapCount > 1) {
                this.isMousedown = false;
                this.useTouchSelectionMark = false;
                if (this.Pages.Count == 0)
                    return;
                if (this.CurrentPage != null && this.OwnerControl.Selection.Start != null) {
                    if (tapCount % 2 == 0)
                        this.OwnerControl.Selection._SelectCurrentWord(clearMultiSelection);
                    else
                        this.OwnerControl.Selection._SelectCurrentParagraph(clearMultiSelection);
                }
            }
        };
        LayoutViewer.prototype._UpdateTextPositionInternal = function (cursorPoint, tapCount, clearMultiSelection) {
            this._UpdateTextPosition(cursorPoint, clearMultiSelection);
            if (tapCount > 1) {
                this.isMousedown = false;
                if (this.Pages.Count == 0)
                    return;
                this.CurrentPage = this.Pages[0];
                if (this.CurrentPage != null && this.OwnerControl.Selection.Start != null) {
                    if (tapCount == 2)
                        this.OwnerControl.Selection._SelectCurrentWord(clearMultiSelection);
                    else
                        this.OwnerControl.Selection._SelectCurrentParagraph(clearMultiSelection);
                    this._CheckForCursorVisibility(true);
                }
            }
        };
        LayoutViewer.prototype._GetLineWidget = function (cursorPoint) {
            return this._GetLineWidgetInternal(cursorPoint, false);
        };
        LayoutViewer.prototype._GetLineWidgetInternal = function (cursorPoint, isMouseDragged) {
            var widget = null;
            if (this.CurrentPage != null) {
                var isPointerDraggedInsideComment = isMouseDragged && this.OwnerControl.Selection._IsInComment();
                if (this.OwnerControl.ShowComments)
                    if ((cursorPoint.X > (this.CurrentPage.BoundingRectangle.Width - this.CurrentPage.ReviewPanelWidth) && cursorPoint.X < this.CurrentPage._GetPageWidth()) || isPointerDraggedInsideComment) {
                        var commentWidget = this.CurrentPage._GetCommentWidget(cursorPoint);
                        if (isPointerDraggedInsideComment)
                            commentWidget = this.OwnerControl.Selection.Start.Paragraph._GetOwnerComment().LayoutedWidget;
                        if (commentWidget != null) {
                            cursorPoint.X = cursorPoint.X - (this.CurrentPage.BoundingRectangle.Width - this.CurrentPage.ReviewPanelWidth);
                            cursorPoint.Y = cursorPoint.Y - commentWidget.TopPosition;
                            if (cursorPoint.X > commentWidget.ContentWidth)
                                cursorPoint.X = commentWidget.ContentWidth;
                            if (cursorPoint.Y > commentWidget.Height)
                                cursorPoint.Y = commentWidget.Height;
                            widget = commentWidget.Comment.LayoutedWidget._GetLineWidget(cursorPoint);
                            if (widget != null)
                                return widget;
                        }
                    }
                for (var i = 0; i < this.CurrentPage.BodyWidgets.length; i++) {
                    var bodyWidget = this.CurrentPage.BodyWidgets[i];
                    widget = bodyWidget._GetLineWidget(cursorPoint);
                    if (widget != null)
                        break;
                }
                return widget;
            }
        };
        LayoutViewer.prototype._ClearSelectionHighlight = function () {
            var canClear = true;
            canClear = (!this.isControlPressed || !this.isMousedown);
            if (this.OwnerControl.Selection.SelectionRanges.Count > 0 && (canClear || this.isImageResizerVisible)) {
                this.OwnerControl.Selection.SelectionRanges._ClearSelectionHighlight();
            }
            else if (this.OwnerControl.Selection.CurrentSelectionRange != null && this.isMousedown)
                this.OwnerControl.Selection.CurrentSelectionRange._ClearSelectionHighlight();
            this._RemoveCommentRangeWidget();
            this._RenderVisiblePages();
        };
        LayoutViewer.prototype._RemoveCommentRangeWidget = function () {
            if (this.CommentRangeWidget != null) {
                this.CommentRangeWidget._Dispose();
                this.CommentRangeWidget = null;
            }
            this.SelectedCommentRangeWidget = new Dictionary();
        };
        LayoutViewer.prototype._NavigateHyperlink = function (cursorPoint) {
            var widget = this._GetLineWidget(cursorPoint);
            if (widget != null) {
                var hyperlinkField = widget._GetHyperlinkField(this.OwnerControl, cursorPoint);
                if (hyperlinkField != null) {
                    this._UpdateTextPosition(cursorPoint, true);
                    this.OwnerControl._FireRequestNavigate(hyperlinkField);
                }
            }
        };
        LayoutViewer.prototype._ScrollToPosition = function (startPosition, endPosition) {
            var lineWidget = endPosition.Paragraph._GetLineWidgetInternal(endPosition.Offset, true);
            if (lineWidget == null)
                return;
            var top = lineWidget._GetTop();
            if (this.isMousedown) {
                var prevLineWidget = endPosition.Paragraph._GetLineWidgetInternal(endPosition.Offset, false);
                var prevTop = prevLineWidget._GetTop();
                if (prevLineWidget != lineWidget && endPosition.Location.Y >= prevTop)
                    lineWidget = prevLineWidget;
            }
            var commentTop = 0;
            var commentLeft = 0;
            if (this.OwnerControl.Selection._IsInComment()) {
                var comment = this.OwnerControl.Selection.Start.Paragraph._GetOwnerComment();
                commentTop = comment.LayoutedWidget.Y;
                commentLeft = comment.LayoutedWidget.X;
            }
            var height = lineWidget.Height;
            var endPage = (this instanceof FlowLayoutViewer) ? this.CurrentPage : lineWidget.CurrentParagraphWidget._GetPage();
            this.CurrentPage = endPage;
            var x = 0, y = 0;
            var viewer = this;
            var horizontalWidth = 0;
            if (viewer instanceof PageLayoutViewer) {
                horizontalWidth = parseFloat(viewer.PageContainer.style.width.replace("px", ""));
                var pagelayout = viewer;
                if (pagelayout.IsFitMultiplePages) {
                    var currentPage = null;
                    var fitHeight = 20;
                    var startIndex = 0;
                    var endIndex = 0;
                    var canArrange = false;
                    var fitWidth = 0;
                    for (var i = 0; i <= this.Pages.Count; i++) {
                        endIndex = i;
                        if (i != this.Pages.Count)
                            fitWidth = fitWidth + this.Pages[i].BoundingRectangle.Width * this.ZoomFactor;
                        if (this.Pages.Count != 1 && i != 0)
                            fitWidth += 20;
                        var isTrue = this.Pages.Count == 1 ? true : this.Pages.Count == i ? true : false;
                        canArrange = (this.VisibleBounds.Width - fitWidth) / 2 <= 30 ? true : isTrue;
                        if (this.Pages.Count != 1)
                            endIndex = i - 1;
                        if (this.Pages.Count == 1 && endIndex == this.Pages.Count)
                            canArrange = false;
                        if (canArrange) {
                            var maxHeight = 0;
                            var sumOfWidth = 0;
                            for (var j = startIndex; j <= endIndex; j++) {
                                maxHeight = Math.max(this.Pages[j].BoundingRectangle.Height * this.ZoomFactor, maxHeight);
                                sumOfWidth = sumOfWidth + this.Pages[j].BoundingRectangle.Width * this.ZoomFactor;
                            }
                            if (startIndex < endIndex)
                                sumOfWidth = sumOfWidth + ((endIndex - startIndex) * 20);
                            x = (this.VisibleBounds.Width - sumOfWidth) / 2;
                            if (x < 30)
                                x = 30;
                            y = 0;
                            sumOfWidth = sumOfWidth + (x * 2);
                            for (var k = startIndex; k <= endIndex; k++) {
                                y = fitHeight + (maxHeight - this.Pages[k].BoundingRectangle.Height * this.ZoomFactor) / 2;
                                if (k != startIndex)
                                    x = x + (this.Pages[k - 1].BoundingRectangle.Width * this.ZoomFactor) + 20;
                                if (this.Pages._IndexOf(this.Pages[k]) == this.Pages._IndexOf(endPage)) {
                                    currentPage = this.Pages[k];
                                    break;
                                }
                            }
                            fitHeight = fitHeight + maxHeight + 20;
                            startIndex = i;
                            canArrange = false;
                            if (i != this.Pages.Count)
                                fitWidth = this.Pages[i].BoundingRectangle.Width * this.ZoomFactor;
                        }
                        if (currentPage != null)
                            break;
                    }
                }
                else {
                    if (endPage == null)
                        return;
                    var pageWidth = endPage.BoundingRectangle.Width;
                    x = (this.VisibleBounds.Width - pageWidth * this.ZoomFactor) / 2;
                    if (x < 30)
                        x = 30;
                    y = endPage.BoundingRectangle.Top * this.ZoomFactor + (this.Pages._IndexOf(endPage) + 1) * viewer.PageGap * (1 - this.ZoomFactor);
                }
            }
            x += (endPosition.Location.X + commentLeft) * this.ZoomFactor;
            y += (endPosition.Location.Y + commentTop) * this.ZoomFactor;
            var scrollTop = 0;
            var scrollLeft = 0;
            var pageHeight = parseFloat(this.Container.style.height.replace("px", ""));
            if (viewer instanceof PageLayoutViewer) {
                if (viewer.PageContainer.style.left.indexOf("px") > -1)
                    scrollLeft = -parseFloat(viewer.PageContainer.style.left.replace("px", ""));
                if (viewer.PageContainer.style.top.indexOf("px") > -1)
                    scrollTop = -parseFloat(viewer.PageContainer.style.top.replace("px", ""));
            }
            if (scrollTop > y)
                this.VerticalScrollBar.scroll(y - 10);
            else if (scrollTop + pageHeight < y + height)
                this.VerticalScrollBar.scroll(y + height - pageHeight + 10);
            else
                this.UpdateCaretToPage(startPosition, endPage);
            this.UpdateCaretToPage(startPosition, endPage);
            if (scrollLeft > x)
                this.HorizontalScrollBar.scroll(x - 10);
            else if (scrollLeft + this.VisibleBounds.Width < x) {
                if (x >= horizontalWidth - this.VisibleBounds.Width)
                    this.HorizontalScrollBar.scroll(horizontalWidth - this.VisibleBounds.Width);
                else
                    this.HorizontalScrollBar.scroll(x);
            }
        };
        LayoutViewer.prototype._RemovePage = function (page) {
            if (this.CurrentPage == page)
                this.CurrentPage = null;
            if (this.SelectionStartPage == page)
                this.SelectionStartPage = null;
            if (this.SelectionEndPage == page)
                this.SelectionEndPage = null;
            var index = this.Pages._IndexOf(page);
            this.Pages._Remove(page);
            this._RemoveRenderedPages();
            if (this instanceof PageLayoutViewer) {
                var viewer = this;
                if (viewer.VisiblePages != null)
                    viewer.VisiblePages._Remove(page);
                var height = 0;
                for (var i = 0; i < this.Pages.length; i++) {
                    height = height + this.Pages[i].BoundingRectangle.Height;
                }
                height -= page.BoundingRectangle.Height + 20;
                var top_8 = 20;
                if (index > 0)
                    top_8 += this.Pages[index - 1].BoundingRectangle.Bottom;
                if (index != -1) {
                    for (var i = index; i < this.Pages.Count; i++) {
                        page = this.Pages[i];
                        page.BoundingRectangle = new Rect(page.BoundingRectangle.X, top_8, page.BoundingRectangle.Width, page.BoundingRectangle.Height);
                        top_8 = page.BoundingRectangle.Bottom + 20;
                        page.RepeatHeaderRowTableWidget = false;
                    }
                }
            }
            this._UpdateScrollBars();
        };
        LayoutViewer.prototype._AddSearchHighlightBorder = function (lineWidget) {
            var highlighters = null;
            if (this.SearchHighlighters._ContainsKey(lineWidget))
                highlighters = this.SearchHighlighters._Get(lineWidget);
            else {
                highlighters = new List();
                this.SearchHighlighters._Add(lineWidget, highlighters);
            }
            var searchHighlight = new SearchWidgetInfo(0, 0);
            highlighters._Add(searchHighlight);
            return searchHighlight;
        };
        LayoutViewer.prototype._ClearSearchHighlight = function () {
            if (this.SearchHighlighters != null) {
                this.SearchHighlighters._Clear();
                this.SearchHighlighters = null;
            }
            this._RenderVisiblePages();
        };
        LayoutViewer.prototype.UpdateCaretToPage = function (startPosition, endPage) {
            if (endPage != null) {
                this.SelectionEndPage = endPage;
                if (this.OwnerControl.Selection.IsEmpty)
                    this.SelectionStartPage = endPage;
                else {
                    var startLineWidget = startPosition.Paragraph._GetLineWidget(startPosition.Offset);
                    var startPage = startLineWidget.CurrentParagraphWidget._GetPage();
                    if (startPage != null)
                        this.SelectionStartPage = startPage;
                }
            }
            this._CheckForCursorVisibility(false);
        };
        LayoutViewer.prototype._CheckForCursorVisibility = function (isTouch) {
            this._ShowCaret(isTouch);
        };
        LayoutViewer.prototype._ShowCaret = function (isTouch) {
            if (!this.isImageResizerVisible) {
                var pageId = this.CurrentPage ? this.CurrentPage.Id : this.CurrentRenderingPage.Id;
                var selectionContainer = document.getElementById(pageId + "_ellipse");
                if (this.OwnerControl.Selection.IsEmpty && !this.OwnerControl.IsReadOnlyMode) {
                    this.Caret.style.display = "block";
                    selectionContainer.appendChild(this.Caret);
                }
                else {
                    if (this.Caret.style.display == "block")
                        this.Caret.style.display = "none";
                }
                if (this.IsTouchInput && !this.OwnerControl.IsReadOnlyMode) {
                    this.touchStart.style.display = "block";
                    this.touchEnd.style.display = "block";
                    selectionContainer.appendChild(this.touchStart);
                    selectionContainer.appendChild(this.touchEnd);
                }
                else {
                    this.touchStart.style.display = "none";
                    this.touchEnd.style.display = "none";
                }
            }
        };
        LayoutViewer.prototype._HideCaret = function (isTouch) {
            this.touchStart.style.display = "none";
            this.touchEnd.style.display = "none";
            this.isMousedown = false;
            this.TouchDownOnSelectionMark = 0;
            this.useTouchSelectionMark = true;
        };
        LayoutViewer.prototype._UpdateCaretPosition = function () {
            if (this.OwnerControl.Selection._IsInComment()) {
                var comment = this.OwnerControl.Selection.Start.Paragraph._GetOwnerComment();
                var caretPosition = this.OwnerControl.Selection.End.Location;
                this.Caret.style.left = Math.round(caretPosition.X + comment.LayoutedWidget.X) + "px";
                var CaretInfo = this._UpdateCaretSize(this.OwnerControl.Selection.End);
                var topMargin = CaretInfo.topMargin + comment.LayoutedWidget.Y;
                var CaretHeight = CaretInfo.caretHeight;
                this.Caret.style.top = Math.round(caretPosition.Y + topMargin) + "px";
                this.touchStart.style.left = Math.round(caretPosition.X + comment.LayoutedWidget.X - 14 / 2) + "px";
                this.touchStart.style.top = (caretPosition.Y + comment.LayoutedWidget.Y + CaretHeight) + "px";
                this.touchEnd.style.left = Math.round(caretPosition.X + comment.LayoutedWidget.X - 14 / 2) + "px";
                this.touchEnd.style.top = (caretPosition.Y + comment.LayoutedWidget.Y + CaretHeight) + "px";
                return;
            }
            else if (this.OwnerControl.Selection.End != null) {
                var caretPosition = this.OwnerControl.Selection.End.Location;
                this.Caret.style.left = Math.round(caretPosition.X) + "px";
                var CaretInfo = this._UpdateCaretSize(this.OwnerControl.Selection.End);
                var topMargin = CaretInfo.topMargin;
                var CaretHeight = CaretInfo.caretHeight;
                this.Caret.style.top = Math.round(caretPosition.Y + topMargin) + "px";
                if (this.OwnerControl.Selection.CharacterFormat.BaselineAlignment == 2)
                    this.Caret.style.top = parseFloat(this.Caret.style.top) + (parseFloat(this.Caret.style.height) / 2) + "px";
                this.touchStart.style.left = Math.round(caretPosition.X - 14 / 2) + "px";
                this.touchStart.style.top = (caretPosition.Y + CaretHeight) + "px";
                this.touchEnd.style.left = Math.round(caretPosition.X - 14 / 2) + "px";
                this.touchEnd.style.top = (caretPosition.Y + CaretHeight) + "px";
            }
        };
        LayoutViewer.prototype._UpdateCaretSize = function (textPosition) {
            var topMargin = 0;
            var isItalic = false;
            var CaretHeight = 0;
            if (textPosition.OwnerControl.Selection.CharacterFormat.Italic)
                isItalic = textPosition.OwnerControl.Selection.CharacterFormat.Italic;
            if (textPosition.Paragraph._IsEmpty()) {
                var paragraph = textPosition.Paragraph;
                var bottomMargin = 0;
                var paragraphInfo = paragraph._GetParagraphMarkSize(topMargin, bottomMargin);
                topMargin = paragraphInfo.TopMargin;
                bottomMargin = paragraphInfo.BottomMargin;
                var height = paragraphInfo.Height;
                CaretHeight = topMargin < 0 ? topMargin + height : height;
                this.Caret.style.height = CaretHeight + "px";
                topMargin = 0;
            }
            else {
                var index = 0;
                var inlineInfo = textPosition.Paragraph._GetInline(textPosition.Offset, index);
                index = inlineInfo.index;
                var inline = inlineInfo.inline;
                CaretHeight = inline._GetCaretHeight(index, inline.CharacterFormat, true, topMargin, isItalic).Height;
                this.Caret.style.height = CaretHeight + "px";
            }
            if (isItalic)
                this.Caret.style.transform = "rotate(13deg)";
            else
                this.Caret.style.transform = "";
            return {
                "topMargin": topMargin,
                "caretHeight": CaretHeight
            };
        };
        LayoutViewer.prototype._UpdateTouchMarkPosition = function () {
            if (this.OwnerControl.Selection._IsInComment()) {
                var comment = this.OwnerControl.Selection.Start.Paragraph._GetOwnerComment();
                var yPosition = this._GetCaretBottom(this.OwnerControl.Selection.Start, false) + comment.LayoutedWidget.Y;
                this.touchStart.style.left = Math.round(this.OwnerControl.Selection.Start.Location.X + comment.LayoutedWidget.X - 14 / 2) + "px";
                this.touchStart.style.top = yPosition + "px";
                yPosition = this._GetCaretBottom(this.OwnerControl.Selection.End, false) + comment.LayoutedWidget.Y;
                this.touchEnd.style.left = Math.round(this.OwnerControl.Selection.End.Location.X + comment.LayoutedWidget.X - 14 / 2) + "px";
                this.touchEnd.style.top = yPosition + "px";
                return;
            }
            var y = this._GetCaretBottom(this.OwnerControl.Selection.Start, false);
            this.touchStart.style.left = Math.round(this.OwnerControl.Selection.Start.Location.X - 14 / 2) + "px";
            this.touchStart.style.top = y + "px";
            y = this._GetCaretBottom(this.OwnerControl.Selection.End, false);
            this.touchEnd.style.left = Math.round(this.OwnerControl.Selection.End.Location.X - 14 / 2) + "px";
            this.touchEnd.style.top = y + "px";
        };
        LayoutViewer.prototype._GetCaretBottom = function (textPosition, isEmptySelection) {
            var bottom = textPosition.Location.Y;
            if (textPosition.Paragraph._IsEmpty()) {
                var paragraph = textPosition.Paragraph;
                var topMargin = 0, bottomMargin = 0;
                var sizeInfo = paragraph._GetParagraphMarkSize(topMargin, bottomMargin);
                topMargin = sizeInfo.TopMargin;
                bottomMargin = sizeInfo.BottomMargin;
                bottom += sizeInfo.Height;
                bottom += topMargin;
                if (!isEmptySelection)
                    bottom += bottomMargin;
            }
            else {
                var index = 0;
                var inlineInfo = textPosition.Paragraph._GetInline(textPosition.Offset, index);
                var inline = inlineInfo.inline;
                index = inlineInfo.index;
                var topMargin = 0;
                var isItalic = false;
                var caretHeightInfo = inline._GetCaretHeight(index, inline.CharacterFormat, false, topMargin, isItalic);
                topMargin = caretHeightInfo.TopMargin;
                isItalic = caretHeightInfo.IsItalic;
                bottom += caretHeightInfo.Height;
                if (isEmptySelection)
                    bottom -= textPosition.Paragraph.ParagraphFormat.AfterSpacing;
            }
            return bottom;
        };
        LayoutViewer.prototype._HandleTextInput = function (text) {
            if (!this.OwnerControl.IsReadOnlyMode)
                this.OwnerControl.Selection._InsertText(text, false);
            this._CheckForCursorVisibility(false);
        };
        LayoutViewer.prototype._HandleShiftLeftKey = function () {
            this.OwnerControl.Selection._ExtendBackward(true);
            this._CheckForCursorVisibility(false);
        };
        LayoutViewer.prototype._HandleShiftRightKey = function () {
            this.OwnerControl.Selection._ExtendForward(true);
            this._CheckForCursorVisibility(false);
        };
        LayoutViewer.prototype._HandleShiftUpKey = function () {
            this.OwnerControl.Selection._ExtendToPreviousLine(true);
            this._CheckForCursorVisibility(false);
        };
        LayoutViewer.prototype._HandleShiftDownKey = function () {
            this.OwnerControl.Selection._ExtendToNextLine(true);
            this._CheckForCursorVisibility(false);
        };
        LayoutViewer.prototype._HandleShiftHomeKey = function () {
            this.OwnerControl.Selection._ExtendToLineStart(true);
            this._CheckForCursorVisibility(false);
        };
        LayoutViewer.prototype._HandleShiftEndKey = function () {
            this.OwnerControl.Selection._ExtendToLineEnd(true);
            this._CheckForCursorVisibility(false);
        };
        LayoutViewer.prototype._HandleControlShiftHomeKey = function () {
            if (this.OwnerControl.Selection._IsInComment()) {
                var comment = this.OwnerControl.Selection.Start.Paragraph._GetOwnerComment();
                var firstParagraph = comment._GetFirstParagraph();
                this.OwnerControl.Selection.End._SetPositionParagraph(firstParagraph, firstParagraph._GetStartOffset());
                this.OwnerControl.Selection._FireSelectionChanged(true);
                this._CheckForCursorVisibility(false);
                return;
            }
            var documentStart = null;
            if (this.OwnerControl.Document != null)
                documentStart = this.OwnerControl.Document.DocumentStart;
            if (documentStart != null) {
                this.OwnerControl.Selection.End._SetPositionInternal(documentStart);
                this.OwnerControl.Selection._FireSelectionChanged(true);
            }
            this._CheckForCursorVisibility(false);
        };
        LayoutViewer.prototype._HandleControlShiftEndKey = function () {
            if (this.OwnerControl.Selection._IsInComment()) {
                var comment = this.OwnerControl.Selection.Start.Paragraph._GetOwnerComment();
                var lastParagraph = null;
                if (comment.Blocks.Count == 0)
                    lastParagraph = comment._GetFirstParagraph();
                else
                    lastParagraph = comment.Blocks[comment.Blocks.Count - 1]._GetLastParagraph();
                this.OwnerControl.Selection.End._SetPositionParagraph(lastParagraph, lastParagraph._GetEndOffset() + 1);
                this.OwnerControl.Selection._FireSelectionChanged(true);
                this._CheckForCursorVisibility(false);
                return;
            }
            var documentEnd = null;
            if (this.OwnerControl.Document != null)
                documentEnd = this.OwnerControl.Document.DocumentEnd;
            if (documentEnd != null) {
                this.OwnerControl.Selection.End._SetPosition(documentEnd.Paragraph, false);
                this.OwnerControl.Selection._FireSelectionChanged(true);
            }
            this._CheckForCursorVisibility(false);
        };
        LayoutViewer.prototype._HandleControlShiftDownKey = function () {
            this.OwnerControl.Selection._ExtendToParagraphEnd(true);
            this._CheckForCursorVisibility(false);
        };
        LayoutViewer.prototype._HandleControlShiftLeftKey = function () {
            this.OwnerControl.Selection._ExtendToWordStart(false, true);
            this._CheckForCursorVisibility(false);
        };
        LayoutViewer.prototype._HandleControlShiftUpKey = function () {
            this.OwnerControl.Selection._ExtendToParagraphStart(true);
            this._CheckForCursorVisibility(false);
        };
        LayoutViewer.prototype._HandleControlShiftRightKey = function () {
            this.OwnerControl.Selection._ExtendToWordEnd(false, true);
            this._CheckForCursorVisibility(false);
        };
        LayoutViewer.prototype._HandleControlHomeKey = function () {
            var documentStart = null;
            if (this.OwnerControl.Document != null)
                documentStart = this.OwnerControl.Document.DocumentStart;
            if (documentStart != null)
                this.OwnerControl.Selection._SelectContent(documentStart, true);
            this._CheckForCursorVisibility(false);
        };
        LayoutViewer.prototype._HandleControlEndKey = function () {
            var documentEnd = null;
            if (this.OwnerControl.Document != null)
                documentEnd = this.OwnerControl.Document.DocumentEnd;
            if (documentEnd != null)
                this.OwnerControl.Selection._SelectContent(documentEnd, true);
            this._CheckForCursorVisibility(false);
        };
        LayoutViewer.prototype._HandleControlLeftKey = function () {
            this.OwnerControl.Selection._ExtendToWordStart(true, true);
            this._CheckForCursorVisibility(false);
        };
        LayoutViewer.prototype._HandleControlRightKey = function () {
            this.OwnerControl.Selection._ExtendToWordEnd(true, true);
            this._CheckForCursorVisibility(false);
        };
        LayoutViewer.prototype._HandleControlUpKey = function () {
            this.OwnerControl.Selection._MoveToPreviousParagraph(true);
            this._CheckForCursorVisibility(false);
        };
        LayoutViewer.prototype._HandleControlDownKey = function () {
            this.OwnerControl.Selection._MoveToNextParagraph(true);
            this._CheckForCursorVisibility(false);
        };
        LayoutViewer.prototype._HandleUpKey = function () {
            this.OwnerControl.Selection._MoveUp(true);
            this._CheckForCursorVisibility(false);
        };
        LayoutViewer.prototype._HandleDownKey = function () {
            this.OwnerControl.Selection._MoveDown(true);
            this._CheckForCursorVisibility(false);
        };
        LayoutViewer.prototype._HandleRightKey = function () {
            this.OwnerControl.Selection._MoveNextPosition(true);
            this._CheckForCursorVisibility(false);
        };
        LayoutViewer.prototype._HandleLeftKey = function () {
            this.OwnerControl.Selection._MovePreviousPosition(true);
            this._CheckForCursorVisibility(false);
        };
        LayoutViewer.prototype._HandleHomeKey = function () {
            this.OwnerControl.Selection._MoveToLineStart(true);
            this._CheckForCursorVisibility(false);
        };
        LayoutViewer.prototype._HandleEndKey = function () {
            this.OwnerControl.Selection._MoveToLineEnd(true);
            this._CheckForCursorVisibility(false);
        };
        LayoutViewer.prototype._HandleEnter = function () {
            if (!this.OwnerControl.IsReadOnlyMode)
                this.OwnerControl.Selection._OnEnter();
            this._CheckForCursorVisibility(false);
        };
        LayoutViewer.prototype._HandleDelete = function () {
            if (!this.OwnerControl.IsReadOnlyMode)
                this.OwnerControl.Selection._OnDelete();
            this._CheckForCursorVisibility(false);
        };
        LayoutViewer.prototype._HandleTabKey = function (selection, isNavigateInCell) {
            var start = selection.Start;
            if (start == null)
                return;
            if (start.Paragraph.IsInsideTable && selection.End.Paragraph.IsInsideTable && isNavigateInCell) {
                var tablecell = start.Paragraph.AssociatedCell;
                var tableRow = tablecell.OwnerRow;
                var tableAdv = tableRow.OwnerTable;
                if (tablecell.NextNode == null) {
                    if (tableRow.NextNode == null && !this.OwnerControl.IsReadOnlyMode)
                        selection._InsertRow(RowPlacement.Below);
                    else {
                        var nextRow = null;
                        if (tableRow.NextNode instanceof TableRowAdv)
                            nextRow = tableRow.NextNode;
                        selection._SelectTableCell(nextRow.Cells[0], true);
                    }
                }
                else {
                    var nextCell = null;
                    if (tablecell.NextNode instanceof TableCellAdv)
                        nextCell = tablecell.NextNode;
                    selection._SelectTableCell(nextCell, true);
                }
            }
            else if (isNavigateInCell && start != null && start.Offset == start.Paragraph._GetStartOffset() && start.Paragraph.ParagraphFormat != null && start.Paragraph.ParagraphFormat.ListFormat != null
                && start.Paragraph.ParagraphFormat.ListFormat.List != null) {
                var listFormat = start.Paragraph.ParagraphFormat.ListFormat;
                if (listFormat.OwnerBase instanceof ParagraphFormat && listFormat.Document != null) {
                    var paragraphFormat = listFormat.OwnerBase;
                    var listLevel = paragraphFormat.ListFormat.ListLevel;
                    var nextListLevel = paragraphFormat.ListFormat.List._GetListLevel(paragraphFormat.ListFormat.ListLevelNumber + 1);
                    if (nextListLevel != null && this.OwnerControl.Document != null) {
                        selection._OnApplyList(paragraphFormat.ListFormat.List, paragraphFormat.ListFormat.ListLevelNumber + 1);
                        start._UpdatePhysicalPosition();
                        selection.End._UpdatePhysicalPosition();
                        this._UpdateCaretPosition();
                    }
                }
            }
            else
                this._HandleTextInput("\t");
            this._CheckForCursorVisibility(false);
        };
        LayoutViewer.prototype._HandleShiftTabKey = function (selection) {
            var start = selection.Start;
            if (start == null)
                return;
            if (start.Paragraph.IsInsideTable && selection.End.Paragraph.IsInsideTable) {
                var tablecell = start.Paragraph.AssociatedCell;
                var tableRow = tablecell.OwnerRow;
                if (tablecell.PreviousNode == null) {
                    if (tableRow.PreviousNode != null) {
                        var prevRow = null;
                        if (tableRow.PreviousNode instanceof TableRowAdv)
                            prevRow = tableRow.PreviousNode;
                        selection._SelectTableCell(prevRow.Cells[prevRow.Cells.Count - 1], true);
                    }
                }
                else {
                    var prevCell = null;
                    if (tablecell.PreviousNode instanceof TableCellAdv)
                        prevCell = tablecell.PreviousNode;
                    selection._SelectTableCell(prevCell, true);
                }
            }
            else if (start.Offset == start.Paragraph._GetStartOffset() && start.Paragraph.ParagraphFormat != null && start.Paragraph.ParagraphFormat.ListFormat != null
                && start.Paragraph.ParagraphFormat.ListFormat.List != null) {
                var listFormat = start.Paragraph.ParagraphFormat.ListFormat;
                if (listFormat.OwnerBase instanceof ParagraphFormat && listFormat.Document != null) {
                    var paragraphFormat = listFormat.OwnerBase;
                    var listLevel = paragraphFormat.ListFormat.ListLevel;
                    var previousListLevel = paragraphFormat.ListFormat.List._GetListLevel(paragraphFormat.ListFormat.ListLevelNumber - 1);
                    if (previousListLevel != null && this.OwnerControl.Document != null) {
                        selection._OnApplyList(paragraphFormat.ListFormat.List, paragraphFormat.ListFormat.ListLevelNumber - 1);
                        start._UpdatePhysicalPosition();
                        selection.End._UpdatePhysicalPosition();
                        this._UpdateCaretPosition();
                    }
                }
            }
            else
                this._HandleTextInput("\t");
            this._CheckForCursorVisibility(false);
        };
        LayoutViewer.prototype._HandleShiftEnter = function () {
            if (!this.OwnerControl.IsReadOnlyMode)
                this._HandleTextInput("\v");
            this._CheckForCursorVisibility(false);
        };
        LayoutViewer.prototype._HandleBackKey = function () {
            if (!this.OwnerControl.IsReadOnlyMode)
                this.OwnerControl.Selection._OnBackspace();
            this._CheckForCursorVisibility(false);
        };
        LayoutViewer.prototype._ShiftLayoutedItems = function () {
            if (this.BlockToShift == null || this.BlockToShift.BaseParent == null) {
                this.BlockToShift = null;
                return;
            }
            var block = this.BlockToShift;
            block._RelayoutOrShiftWidgets(this);
            var updateNextBlockList = true;
            while (block.NextNode instanceof BlockAdv) {
                var currentWidget = null;
                if (block instanceof ParagraphAdv)
                    currentWidget = block.ParagraphWidgets[block.ParagraphWidgets.Count - 1];
                else {
                    var tableBlock = null;
                    if (block instanceof TableAdv)
                        tableBlock = block;
                    currentWidget = tableBlock.TableWidgets[tableBlock.TableWidgets.Count - 1];
                }
                block = block.NextNode;
                updateNextBlockList = false;
                var nextWidget = null;
                if (block instanceof ParagraphAdv) {
                    if (block.ParagraphWidgets.Count > 0)
                        nextWidget = block.ParagraphWidgets[0];
                }
                else {
                    var nextBlock = null;
                    if (block instanceof TableAdv)
                        nextBlock = block;
                    nextWidget = nextBlock.TableWidgets[0];
                }
                if (currentWidget != null && nextWidget != null && currentWidget.ContainerWidget == nextWidget.ContainerWidget
                    && (MathHelper._Round(nextWidget.Y, 2) == MathHelper._Round(this.ClientActiveArea.Y, 2)))
                    break;
                updateNextBlockList = true;
                block._RelayoutOrShiftWidgets(this);
            }
            block._UpdateListItemsTillEnd(updateNextBlockList);
            this.BlockToShift = null;
            this._UpdateScrollBars();
            var viewer = this;
            if (viewer instanceof PageLayoutViewer)
                viewer._UpdateVisiblePages(true);
            else {
                this.CurrentPage._RemoveWidgets(viewer);
                this.CurrentPage._RenderWidget(viewer);
            }
        };
        LayoutViewer.prototype._Replace = function () {
            if (this.OwnerControl == null)
                return;
            var findText = this.InsertFindAndReplaceDialog.find("#" + this.InsertFindAndReplaceDialog[0].id + "_FindWhatText")[0].value;
            var replaceText = this.InsertFindAndReplaceDialog.find("#" + this.InsertFindAndReplaceDialog[0].id + "_replaceText")[0].value;
            if (this.OwnerControl == null)
                return;
            this.OwnerControl.textSearchResults._ClearResults();
            if (findText != "" && findText != null && findText != undefined) {
                var findOption = 0;
                if (this.OwnerControl.Selection != null) {
                    var selectionText = this.OwnerControl.Selection.Text;
                    if (!this.OwnerControl.Selection.IsEmpty) {
                        if (this.OwnerControl.Selection.IsForward)
                            this.OwnerControl.Selection._SelectContent(this.OwnerControl.Selection.Start, true);
                        else
                            this.OwnerControl.Selection._SelectContent(this.OwnerControl.Selection.End, true);
                    }
                    this.OwnerControl._Find(findText, findOption);
                    if (this.OwnerControl.textSearchResults.CurrentSearchResult != null) {
                        if (this.OwnerControl.textSearchResults.CurrentSearchResult.Text == selectionText) {
                            var replace = replaceText == null || replaceText == undefined ? "" : replaceText;
                            this.OwnerControl.textSearchResults.CurrentSearchResult._Replace(replace);
                            this.OwnerControl._Find(findText, findOption);
                        }
                    }
                }
            }
            else
                this._ShowAlertDialog("We couldn't find what you were looking for");
        };
        LayoutViewer.prototype._ReplaceAll = function () {
            if (this.OwnerControl == null)
                return;
            var findText = this.InsertFindAndReplaceDialog.find("#" + this.InsertFindAndReplaceDialog[0].id + "_FindWhatText")[0].value;
            var replaceText = this.InsertFindAndReplaceDialog.find("#" + this.InsertFindAndReplaceDialog[0].id + "_replaceText")[0].value;
            if (this.OwnerControl == null)
                return;
            if (findText != "" && findText != null && findText != undefined) {
                var findOption = 0;
                this.OwnerControl._FindAll(findText, findOption);
            }
            var replace = replaceText == null || replaceText == undefined ? "" : replaceText;
            var occurence = this.OwnerControl.textSearchResults._ReplaceAll(replace);
            this.InsertFindAndReplaceDialog.ejDialog("close");
            this._ShowAlertDialog("All done.We made " + occurence + " replacemant");
        };
        return LayoutViewer;
    }());
    DocumentEditorFeatures.LayoutViewer = LayoutViewer;
    var PageLayoutViewer = (function (_super) {
        __extends(PageLayoutViewer, _super);
        function PageLayoutViewer(owner) {
            _super.call(this, owner);
            this.PageGap = 20;
            this.PageLeft = 30;
            this._GetCurrentPageHeaderFooter = function (section, isHeader) {
                var type;
                type = isHeader ? HeaderFooterType.OddHeader : HeaderFooterType.OddFooter;
                if (section.SectionFormat.DifferentFirstPage && (this.Pages.length == 1 || this.Pages[this.Pages.length - 1].Section != section)) {
                    type = isHeader ? HeaderFooterType.FirstPageHeader : HeaderFooterType.FirstPageFooter;
                }
                else if (section.SectionFormat.DifferentOddAndEvenPages && this.Pages.length % 2 == 0) {
                    type = isHeader ? HeaderFooterType.EvenHeader : HeaderFooterType.EvenFooter;
                }
                return section._GetCurrentHeaderFooter(type);
            };
            this.PageContainer = document.createElement("div");
            this.PageContainer.setAttribute("id", this.OwnerControl.ContainerId + "_pageContainer");
            this.PageContainer.style.position = "relative";
            this.Container.appendChild(this.PageContainer);
            this.VisiblePages = new List();
        }
        Object.defineProperty(PageLayoutViewer.prototype, "IsFitMultiplePages", {
            get: function () {
                return this.PageFitType == PageFitType.FitMultiplePages;
            },
            enumerable: true,
            configurable: true
        });
        PageLayoutViewer.prototype._FindFocusedPage = function (currentPoint) {
            var point = new Point(currentPoint.X, currentPoint.Y);
            if (this.PageContainer.style.left.indexOf("px") > -1)
                point.X -= parseFloat(this.PageContainer.style.left.replace("px", ""));
            if (this.PageContainer.style.top.indexOf("px") > -1)
                point.Y -= parseFloat(this.PageContainer.style.top.replace("px", ""));
            if (this.IsFitMultiplePages) {
                var x = 0;
                var y = 0;
                var fitHeight = 20;
                var startIndex = 0;
                var endIndex = 0;
                var canArrange = false;
                var fitWidth = 0;
                for (var i = 0; i <= this.Pages.Count; i++) {
                    endIndex = i;
                    if (i != this.Pages.Count)
                        fitWidth = fitWidth + this.Pages[i]._GetPageWidth() * this.ZoomFactor;
                    if (this.Pages.Count != 1 && i != 0)
                        fitWidth += 20;
                    var isTrue = this.Pages.Count == 1 ? true : this.Pages.Count == i ? true : false;
                    canArrange = (this.VisibleBounds.Width - fitWidth) / 2 <= 30 ? true : isTrue;
                    if (this.Pages.Count != 1)
                        endIndex = i - 1;
                    if (this.Pages.Count == 1 && endIndex == this.Pages.Count)
                        canArrange = false;
                    if (canArrange) {
                        var maxHeight = 0;
                        var sumOfWidth = 0;
                        for (var j = startIndex; j <= endIndex; j++) {
                            maxHeight = Math.max(this.Pages[j].BoundingRectangle.Height * this.ZoomFactor, maxHeight);
                            sumOfWidth = sumOfWidth + this.Pages[j]._GetPageWidth() * this.ZoomFactor;
                        }
                        if (startIndex < endIndex)
                            sumOfWidth = sumOfWidth + ((endIndex - startIndex) * 20);
                        x = (this.VisibleBounds.Width - sumOfWidth) / 2;
                        if (x < 30)
                            x = 30;
                        y = 0;
                        sumOfWidth = sumOfWidth + (x * 2);
                        for (var k = startIndex; k <= endIndex; k++) {
                            y = fitHeight + (maxHeight - this.Pages[k].BoundingRectangle.Height * this.ZoomFactor) / 2;
                            if (k != startIndex)
                                x = x + (this.Pages[k - 1]._GetPageWidth() * this.ZoomFactor) + 20;
                            var pageRect = new Rect(x, y, this.Pages[k]._GetPageWidth() * this.ZoomFactor, this.Pages[k].BoundingRectangle.Height * this.ZoomFactor);
                            if (pageRect.Bottom >= point.Y && (pageRect.Left + this.Pages[k]._GetPageWidth() * this.ZoomFactor) >= point.X || k == this.Pages.Count - 1) {
                                this.CurrentPage = this.Pages[k];
                                point.Y = (point.Y - y) / this.ZoomFactor;
                                if (point.X > pageRect.Right)
                                    point.X = pageRect.Right;
                                else if (point.X < pageRect.Left)
                                    point.X = 0;
                                else
                                    point.X = (point.X - pageRect.Left) / this.ZoomFactor;
                                return point;
                            }
                        }
                        fitHeight = fitHeight + maxHeight + 20;
                        startIndex = i;
                        canArrange = false;
                        if (i != this.Pages.Count)
                            fitWidth = this.Pages[i]._GetPageWidth() * this.ZoomFactor;
                    }
                }
            }
            else {
                for (var i = 0; i < this.Pages.length; i++) {
                    var page = this.Pages[i];
                    var pageTop = (page.BoundingRectangle.Top - this.PageGap * (i + 1)) * this.ZoomFactor + this.PageGap * (i + 1);
                    var pageHeight = page.BoundingRectangle.Height * this.ZoomFactor;
                    var pageLeft = page.BoundingRectangle.Left;
                    var pageRight = ((page.BoundingRectangle.Right - pageLeft) * this.ZoomFactor) + pageLeft;
                    if (pageTop <= point.Y && pageTop + pageHeight >= point.Y) {
                        this.CurrentPage = page;
                        point.Y = (point.Y - pageTop) / this.ZoomFactor;
                        if (this.IsImageResizing && point.X > page.BoundingRectangle.Width)
                            point.X = point.X - pageLeft;
                        else if (point.X > pageRight)
                            point.X = page.BoundingRectangle.Right;
                        else if (point.X < pageLeft)
                            point.X = page.BoundingRectangle.Left;
                        else
                            point.X = (point.X - pageLeft) / this.ZoomFactor;
                        return point;
                    }
                }
            }
            return point;
        };
        PageLayoutViewer.prototype._UpdateCursor = function (event) {
            var hyperlinkField = null;
            var div = this.ViewerContatiner;
            var point = new Point(event.offsetX, event.offsetY);
            var touchPoint = this._FindFocusedPage(point);
            var isRowResize = !this.OwnerControl.IsReadOnlyMode && this._IsInRowResizerArea(touchPoint);
            var isCellResize = !this.OwnerControl.IsReadOnlyMode && this._IsInCellResizerArea(touchPoint);
            var ResizeObj = this._getImagePoint(touchPoint);
            this.OwnerControl.SelectedResizeElement = ResizeObj.SelectedElement;
            var ResizePosition = ResizeObj.ResizePosition;
            var widget = this._GetLineWidget(touchPoint);
            if (widget != null)
                hyperlinkField = widget._GetHyperlinkField(this.OwnerControl, touchPoint);
            if (hyperlinkField != null && event.ctrlKey == true)
                div.style.cursor = "pointer";
            else if (ResizePosition != null)
                div.style.cursor = ResizePosition;
            else
                div.style.cursor = "default";
            if (isRowResize)
                div.style.cursor = "row-resize";
            else if (isCellResize)
                div.style.cursor = "col-resize";
        };
        PageLayoutViewer.prototype._getImagePoint = function (touchPoint) {
            var imageResizingPoints = this.OwnerControl.ImageResizerPoints;
            var imageResizer = this.ImageResizer;
            var resizePosition = "";
            var selectedElement = null;
            var bottomMiddle = imageResizingPoints.bottomMiddleRect;
            var bottomRight = imageResizingPoints.bottomRightRect;
            var bottomLeft = imageResizingPoints.bottomLeftRect;
            var topMiddle = imageResizingPoints.topMiddleRect;
            var topRight = imageResizingPoints.topRightRect;
            var topLeft = imageResizingPoints.topLeftRect;
            var rightMiddle = imageResizingPoints.rightMiddleRect;
            var leftMiddle = imageResizingPoints.leftMiddleRect;
            if (imageResizer.bottomMiddleRect != null && imageResizer.bottomMiddleRect.style.display != "none") {
                if ((touchPoint.X > bottomMiddle.X && touchPoint.X <= bottomMiddle.X + 7) && (touchPoint.Y > bottomMiddle.Y && touchPoint.Y <= bottomMiddle.Y + 7)) {
                    selectedElement = imageResizer.bottomMiddleRect;
                    resizePosition = "s-resize";
                }
                else if ((touchPoint.X > bottomRight.X && touchPoint.X <= bottomRight.X + 7) && (touchPoint.Y > bottomRight.Y && touchPoint.Y <= bottomRight.Y + 7)) {
                    selectedElement = imageResizer.bottomRightRect;
                    resizePosition = "se-resize";
                }
                else if ((touchPoint.X > bottomLeft.X && touchPoint.X <= bottomLeft.X + 7) && (touchPoint.Y > bottomLeft.Y && touchPoint.Y <= bottomLeft.Y + 7)) {
                    selectedElement = imageResizer.bottomLeftRect;
                    resizePosition = "sw-resize";
                }
                else if ((touchPoint.X > topMiddle.X && touchPoint.X <= topMiddle.X + 7) && (touchPoint.Y > topMiddle.Y && touchPoint.Y <= topMiddle.Y + 7)) {
                    selectedElement = imageResizer.topMiddleRect;
                    resizePosition = "n-resize";
                }
                else if ((touchPoint.X > topRight.X && touchPoint.X <= topRight.X + 7) && (touchPoint.Y > topRight.Y && touchPoint.Y <= topRight.Y + 7)) {
                    selectedElement = imageResizer.topRightRect;
                    resizePosition = "ne-resize";
                }
                else if ((touchPoint.X > topLeft.X && touchPoint.X <= topLeft.X + 7) && (touchPoint.Y > topLeft.Y && touchPoint.Y <= topLeft.Y + 7)) {
                    selectedElement = imageResizer.topLeftRect;
                    resizePosition = "nw-resize";
                }
                else if ((touchPoint.X > leftMiddle.X && touchPoint.X <= leftMiddle.X + 7) && (touchPoint.Y > leftMiddle.Y && touchPoint.Y <= leftMiddle.Y + 7)) {
                    selectedElement = imageResizer.leftMiddleRect;
                    resizePosition = "w-resize";
                }
                else if ((touchPoint.X > rightMiddle.X && touchPoint.X <= rightMiddle.X + 7) && (touchPoint.Y > rightMiddle.Y && touchPoint.Y <= rightMiddle.Y + 7)) {
                    selectedElement = imageResizer.rightMiddleRect;
                    resizePosition = "e-resize";
                }
                else if (this.ImageResizer.resizeContainerDiv != null && (touchPoint.X > parseFloat(this.ImageResizer.resizeContainerDiv.style.left)
                    && touchPoint.X <= (parseFloat(this.ImageResizer.resizeContainerDiv.style.left) + parseFloat(this.ImageResizer.resizeContainerDiv.style.width)))
                    && (touchPoint.Y > parseFloat(this.ImageResizer.resizeContainerDiv.style.top)
                        && touchPoint.Y <= (parseFloat(this.ImageResizer.resizeContainerDiv.style.top) + parseFloat(this.ImageResizer.resizeContainerDiv.style.height)))) {
                    resizePosition = "move";
                }
            }
            return { "SelectedElement": selectedElement, "ResizePosition": resizePosition };
        };
        PageLayoutViewer.prototype._OnPageFitTypeChanged = function (pageFitType) {
            var width = this.VisibleBounds.Width;
            var height = this.VisibleBounds.Height;
            var section = this.OwnerControl.Document.Sections[0];
            var pageWidth = section.SectionFormat.PageWidth;
            var pageHeight = section.SectionFormat.PageHeight;
            switch (pageFitType) {
                case PageFitType.FitFullPage:
                    if (height > 0 && pageHeight > 0) {
                        var zoomFactor = (this.VisibleBounds.Height - 2 * this.PageGap - this.HorizontalScrollBar.model.height) / pageHeight;
                        if (zoomFactor == this.ZoomFactor)
                            this._Zoom();
                        else
                            this.ZoomFactor = zoomFactor;
                    }
                    break;
                case PageFitType.FitPageWidth:
                    if (width > 0 && pageWidth > 0)
                        this.ZoomFactor = (this.VisibleBounds.Width - 60) / pageWidth;
                    break;
                case PageFitType.FitMultiplePages:
                    if (height > 0 && pageHeight > 0) {
                        var zoomFactor = (this.VisibleBounds.Height - 2 * this.PageGap - this.HorizontalScrollBar.model.height) / pageHeight;
                        if (zoomFactor == this.ZoomFactor)
                            this._Zoom();
                        else
                            this.ZoomFactor = zoomFactor;
                    }
                    break;
                default:
                    this.ZoomFactor = this.ZoomFactor / 100;
                    break;
            }
        };
        PageLayoutViewer.prototype._CreateNewPage = function (section) {
            var yPos = this.PageGap;
            if (this.Pages.length > 0)
                yPos = this.Pages[this.Pages.length - 1].BoundingRectangle.Bottom + this.PageGap;
            var page = new Page();
            page.Viewer = this;
            page.Section = section;
            var pageWidth = section.SectionFormat != null ? section.SectionFormat.PageWidth : 816;
            var pageHeight = section.SectionFormat != null ? section.SectionFormat.PageHeight : 1056;
            if (this.isReviewPanelShow)
                pageWidth = pageWidth + page.ReviewPanelWidth;
            var xPos = (this.VisibleBounds.Width - pageWidth * this.ZoomFactor) / 2;
            if (xPos < this.PageLeft)
                xPos = this.PageLeft;
            page.BoundingRectangle = new Rect(xPos, yPos, pageWidth, pageHeight);
            this.Pages._Add(page);
            this._LayoutHeaderFooter(section);
            this._UpdateClientArea(section.SectionFormat);
            page.BodyWidgets._Add(section._AddBodyWidget(this.ClientActiveArea));
            page.BodyWidgets[page.BodyWidgets.length - 1].Page = page;
            return page;
        };
        PageLayoutViewer.prototype._LayoutHeaderFooter = function (section) {
            this.CurrentHeaderFooter = this._GetCurrentPageHeaderFooter(section, true);
            if (this.CurrentHeaderFooter.Blocks.length > 0) {
                this._UpdateHFClientArea(section, true);
                this.CurrentRenderingPage.HeaderWidget = this.CurrentHeaderFooter._LayoutItems(this);
            }
            this.CurrentHeaderFooter = this._GetCurrentPageHeaderFooter(section, false);
            if (this.CurrentHeaderFooter.Blocks.length > 0) {
                this._UpdateHFClientArea(section, false);
                this.CurrentRenderingPage.FooterWidget = this.CurrentHeaderFooter._LayoutItems(this);
            }
            this.CurrentHeaderFooter = null;
        };
        PageLayoutViewer.prototype._Zoom = function () {
            this._UpdatePageLeft();
            this._UpdateScrollBars();
            if (this.OwnerControl.Selection != null && this.OwnerControl.Selection.Start != null && this.OwnerControl.Selection.End != null) {
                this._ScrollToPosition(this.OwnerControl.Selection.Start, this.OwnerControl.Selection.End);
            }
        };
        PageLayoutViewer.prototype._UpdateContainerPosition = function () {
            var height = 0;
            for (var i = 0; i < this.Pages.length; i++) {
                height = height + this.Pages[i].BoundingRectangle.Height;
            }
            var width = 0;
            for (var i = 0; i < this.Pages.length; i++) {
                if (width < this.Pages[i].BoundingRectangle.Width) {
                    width = this.Pages[i].BoundingRectangle.Width;
                }
            }
            var containerWidth = width * this.ZoomFactor + this.PageLeft * 2;
            var containerHeight = height * this.ZoomFactor + (this.Pages.length + 1) * this.PageGap;
            var viewerWidth = this.VisibleBounds.Width;
            var viewerHeight = this.VisibleBounds.Height;
            if (containerHeight > viewerHeight) {
                viewerWidth -= this.VerticalScrollBar.model.width;
            }
            if (containerWidth > viewerWidth) {
                viewerHeight -= this.HorizontalScrollBar.model.height;
            }
            width = containerWidth > viewerWidth ? containerWidth : viewerWidth;
            height = containerHeight > viewerHeight ? containerHeight : viewerHeight;
            if (this.IsFitMultiplePages) {
                height = this.PageGap;
                var startIndex = 0;
                var endIndex = 0;
                var canArrange = false;
                var width_1 = 0;
                var HorizontalWidth = 0;
                for (var i = 0; i <= this.Pages.Count; i++) {
                    endIndex = i;
                    if (i != this.Pages.Count)
                        width_1 = width_1 + this.Pages[i].BoundingRectangle.Width * this.ZoomFactor;
                    if (this.Pages.Count != 1 && i != 0)
                        width_1 += this.PageGap;
                    var isTrue = this.Pages.Count == 1 ? true : this.Pages.Count == i ? true : false;
                    canArrange = (this.VisibleBounds.Width - width_1) / 2 <= 30 ? true : isTrue;
                    if (this.Pages.Count != 1)
                        endIndex = i - 1;
                    if (this.Pages.Count == 1 && endIndex == this.Pages.Count)
                        canArrange = false;
                    if (canArrange) {
                        var maxHeight = 0;
                        var sumOfWidth = 0;
                        for (var j = startIndex; j <= endIndex; j++) {
                            maxHeight = Math.max(this.Pages[j].BoundingRectangle.Height, maxHeight);
                            sumOfWidth = sumOfWidth + this.Pages[j].BoundingRectangle.Width * this.ZoomFactor;
                        }
                        if (startIndex < endIndex)
                            sumOfWidth = sumOfWidth + ((endIndex - startIndex) * this.PageGap);
                        var xPos = (this.VisibleBounds.Width - sumOfWidth) / 2 >= 30 ? (this.VisibleBounds.Width - sumOfWidth) / 2 : 30;
                        sumOfWidth = sumOfWidth + (xPos * 2);
                        height += maxHeight * this.ZoomFactor + this.PageGap;
                        HorizontalWidth = Math.max(HorizontalWidth, sumOfWidth);
                        startIndex = i;
                        canArrange = false;
                        if (i != this.Pages.Count)
                            width_1 = this.Pages[i].BoundingRectangle.Width * this.ZoomFactor;
                    }
                }
                containerWidth = HorizontalWidth - this.VisibleBounds.Width;
            }
            this.Container.style.width = viewerWidth.toString() + "px";
            this.Container.style.height = viewerHeight.toString() + "px";
            this.PageContainer.style.width = width.toString() + "px";
            this.PageContainer.style.height = height.toString() + "px";
            for (var i = 0; i < this.Pages.length; i++) {
                var left = (width - this.Pages[i].BoundingRectangle.Width * this.ZoomFactor) / 2;
                if (left > this.PageLeft)
                    this.Pages[i].BoundingRectangle = new Rect(left, this.Pages[i].BoundingRectangle.Top, this.Pages[i].BoundingRectangle.Width, this.Pages[i].BoundingRectangle.Height);
                else
                    this.Pages[i].BoundingRectangle = new Rect(this.PageLeft, this.Pages[i].BoundingRectangle.Top, this.Pages[i].BoundingRectangle.Width, this.Pages[i].BoundingRectangle.Height);
            }
            return { "containerWidth": containerWidth, "containerHeight": containerHeight, "width": width, "height": height, "viewerWidth": viewerWidth, "viewerHeight": viewerHeight };
        };
        PageLayoutViewer.prototype._UpdateScrollBars = function () {
            var updatedPos = this._UpdateContainerPosition();
            var containerWidth = updatedPos.containerWidth;
            var containerHeight = updatedPos.containerHeight;
            var viewerWidth = updatedPos.viewerWidth;
            var viewerHeight = updatedPos.viewerHeight;
            var width = updatedPos.width;
            var height = updatedPos.containerHeight;
            var vScrollBar = this.VerticalScrollBar.element[0];
            if (containerHeight > viewerHeight) {
                var scrollValue = this.VerticalScrollBar.model.value;
                vScrollBar.style.display = "block";
                this.VerticalScrollBar.option("maximum", height - viewerHeight);
                this.VerticalScrollBar.option("viewportsize", viewerHeight);
                this.VerticalScrollBar.option("height", viewerHeight);
                this.VerticalScrollBar._scrollData.handleSpace = viewerHeight - (2 * this.VerticalScrollBar.model.buttonSize);
                this.VerticalScrollBar._scrollData.handle = Math.floor((viewerHeight - 18) / height * this.VerticalScrollBar._scrollData.handleSpace);
                if (this.VerticalScrollBar._scrollData.handle < 15)
                    this.VerticalScrollBar._scrollData.handle = 15;
                this.VerticalScrollBar._scrollData.scrollable = this.VerticalScrollBar.model.maximum;
                this.VerticalScrollBar._scrollData.onePx = this.VerticalScrollBar._scrollData.scrollable / (this.VerticalScrollBar._scrollData.handleSpace - this.VerticalScrollBar._scrollData.handle);
                this.VerticalScrollBar["e-vhandle"].height(this.VerticalScrollBar._scrollData.handle);
                this.VerticalScrollBar.scroll(scrollValue);
            }
            else {
                vScrollBar.style.display = "none";
                this.VerticalScrollBar.scroll(0);
            }
            var hScrollBar = this.HorizontalScrollBar.element[0];
            if (containerWidth > viewerWidth) {
                var scrollValue = this.HorizontalScrollBar.model.value;
                hScrollBar.style.display = "block";
                this.HorizontalScrollBar.option("maximum", width - viewerWidth);
                this.HorizontalScrollBar.option("viewportsize", viewerWidth);
                this.HorizontalScrollBar.option("width", viewerWidth);
                this.HorizontalScrollBar._scrollData.handleSpace = viewerWidth - (2 * this.HorizontalScrollBar.model.buttonSize);
                this.HorizontalScrollBar._scrollData.handle = Math.floor((viewerWidth - 18) / width * this.HorizontalScrollBar._scrollData.handleSpace);
                if (this.HorizontalScrollBar._scrollData.handle < 15)
                    this.HorizontalScrollBar._scrollData.handle = 15;
                this.HorizontalScrollBar._scrollData.scrollable = this.HorizontalScrollBar.model.maximum;
                this.HorizontalScrollBar._scrollData.onePx = this.HorizontalScrollBar._scrollData.scrollable / (this.HorizontalScrollBar._scrollData.handleSpace - this.HorizontalScrollBar._scrollData.handle);
                this.HorizontalScrollBar["e-hhandle"].width(this.HorizontalScrollBar._scrollData.handle);
                this.HorizontalScrollBar.scroll(scrollValue);
            }
            else {
                hScrollBar.style.display = "none";
                this.HorizontalScrollBar.scroll(0);
            }
        };
        PageLayoutViewer.prototype._VerticalScrollBar_ValueChanged = function (eventArgs) {
            var top = eventArgs.scrollTop;
            var viewerHeight = parseFloat(this.Container.style.height);
            var containerHeight = parseFloat(this.PageContainer.style.height);
            if (top > containerHeight - viewerHeight)
                top = containerHeight - viewerHeight;
            this.PageContainer.style.top = (-top).toString() + "px";
            if (!this.OwnerControl.isReviewPanelShown)
                this._UpdateVisiblePages(true);
        };
        PageLayoutViewer.prototype._HorizontalScrollBar_ValueChanged = function (eventArgs) {
            var left = eventArgs.scrollLeft;
            var viewerWidth = parseFloat(this.Container.style.width);
            var containerWidth = parseFloat(this.PageContainer.style.width);
            if (left > containerWidth - viewerWidth)
                left = containerWidth - viewerWidth;
            this.PageContainer.style.left = (-left).toString() + "px";
        };
        PageLayoutViewer.prototype._UpdateVisiblePages = function (addToTop) {
            if (addToTop) {
                for (var i = 0; i < this.PageContainer.childNodes.length; i++) {
                    this.PageContainer.removeChild(this.PageContainer.childNodes[i]);
                    i--;
                }
                this._ClearVisiblePages();
                if (this.IsFitMultiplePages) {
                    this._ArrangePages(false);
                }
                else {
                    var top_9 = this.PageGap;
                    var height = this.VisibleBounds.Height;
                    var vertical = -parseFloat(this.PageContainer.style.top);
                    var isFirstVisiblePage = true;
                    for (var i = 0; i < this.Pages.length; i++) {
                        var page = this.Pages[i];
                        var y = (page.BoundingRectangle.Top - this.PageGap * (i + 1)) * this.ZoomFactor + this.PageGap * (i + 1);
                        var pageH = page.BoundingRectangle.Height * this.ZoomFactor;
                        var left = page.BoundingRectangle.Left;
                        if ((y >= vertical && y <= vertical + height)
                            || (y <= vertical && y + pageH >= vertical + height)
                            || (y + pageH >= vertical && y + pageH <= vertical + height)) {
                            this._AddVisiblePage(page, left, top_9, false);
                            isFirstVisiblePage = false;
                        }
                        top_9 += this.PageGap + page.BoundingRectangle.Height * this.ZoomFactor;
                    }
                }
            }
            else {
                if (this.IsFitMultiplePages)
                    this._ArrangePages(true);
            }
        };
        PageLayoutViewer.prototype._ArrangePages = function (addAsInitial) {
            var height = this.PageGap;
            var startIndex = 0;
            var endIndex = 0;
            var canArrange = false;
            var width = 0;
            for (var i = 0; i <= this.Pages.Count; i++) {
                endIndex = i;
                if (i != this.Pages.Count)
                    width = width + this.Pages[i].BoundingRectangle.Width * this.ZoomFactor;
                if (this.Pages.Count != 1 && i != 0)
                    width += this.PageGap;
                var isTrue = this.Pages.Count == 1 ? true : this.Pages.Count == i ? true : false;
                canArrange = (this.VisibleBounds.Width - width) / 2 <= 30 ? true : isTrue;
                if (this.Pages.Count != 1)
                    endIndex = i - 1;
                if (this.Pages.Count == 1 && endIndex == this.Pages.Count)
                    canArrange = false;
                if (canArrange) {
                    height = this._PositionPages(startIndex, endIndex, height, addAsInitial);
                    startIndex = i;
                    canArrange = false;
                    if (i != this.Pages.Count)
                        width = this.Pages[i].BoundingRectangle.Width * this.ZoomFactor;
                }
            }
        };
        PageLayoutViewer.prototype._PositionPages = function (startIndex, endIndex, top, addAsInitial) {
            var maxHeight = 0;
            var sumOfWidth = 0;
            for (var i = startIndex; i <= endIndex; i++) {
                maxHeight = Math.max(this.Pages[i].BoundingRectangle.Height * this.ZoomFactor, maxHeight);
                sumOfWidth = sumOfWidth + this.Pages[i].BoundingRectangle.Width * this.ZoomFactor;
            }
            if (startIndex < endIndex)
                sumOfWidth = sumOfWidth + ((endIndex - startIndex) * this.PageGap);
            var xPos = (this.VisibleBounds.Width - sumOfWidth) / 2 >= 30 ? (this.VisibleBounds.Width - sumOfWidth) / 2 : 30;
            var yPos = 0;
            sumOfWidth = sumOfWidth + (xPos * 2);
            for (var i = startIndex; i <= endIndex; i++) {
                yPos = top + (maxHeight - this.Pages[i].BoundingRectangle.Height * this.ZoomFactor) / 2;
                if (i != startIndex)
                    xPos = xPos + (this.Pages[i - 1].BoundingRectangle.Width * this.ZoomFactor) + this.PageGap;
                this._AddVisiblePage(this.Pages[i], xPos, yPos, addAsInitial);
            }
            top = top + maxHeight + this.PageGap;
            return top;
        };
        PageLayoutViewer.prototype._AddVisiblePage = function (page, x, y, addAsInitial) {
            var height = page.BoundingRectangle.Height * this.ZoomFactor;
            var width = page.BoundingRectangle.Width * this.ZoomFactor;
            page.Id = this.OwnerControl.ContainerId + "_page_" + Math.random().toString();
            ;
            var backgroundContainer = document.createElement("canvas");
            backgroundContainer.style.position = "absolute";
            backgroundContainer.style.top = y.toString() + "px";
            backgroundContainer.style.left = x.toString() + "px";
            backgroundContainer.style.borderWidth = "1px";
            backgroundContainer.style.borderColor = "#D9DCDD";
            backgroundContainer.style.borderStyle = "solid";
            backgroundContainer.style.backgroundColor = this.OwnerControl.Document.BackgroundColor;
            backgroundContainer.height = height * 2;
            backgroundContainer.width = width * 2;
            backgroundContainer.style.height = height + "px";
            backgroundContainer.style.width = width + "px";
            backgroundContainer.style.zIndex = "0";
            backgroundContainer.id = page.Id + "_background";
            this.PageContainer.appendChild(backgroundContainer);
            var foregroundContainer = document.createElement("canvas");
            foregroundContainer.style.position = "absolute";
            foregroundContainer.style.top = y.toString() + "px";
            foregroundContainer.style.left = x.toString() + "px";
            foregroundContainer.style.borderWidth = "0px";
            foregroundContainer.height = height * 2;
            foregroundContainer.width = width * 2;
            foregroundContainer.style.height = height + "px";
            foregroundContainer.style.width = width + "px";
            foregroundContainer.style.zIndex = "1";
            foregroundContainer.id = page.Id + "_foreground";
            this.PageContainer.appendChild(foregroundContainer);
            var selectionContainer = document.createElement("canvas");
            selectionContainer.style.position = "absolute";
            selectionContainer.style.top = y.toString() + "px";
            selectionContainer.style.left = x.toString() + "px";
            selectionContainer.style.borderWidth = "0px";
            selectionContainer.height = height * 2;
            selectionContainer.width = width * 2;
            selectionContainer.style.height = height + "px";
            selectionContainer.style.width = width + "px";
            selectionContainer.style.zIndex = "2";
            selectionContainer.id = page.Id + "_selection";
            this.PageContainer.appendChild(selectionContainer);
            var touchEllipseDiv = document.createElement("div");
            touchEllipseDiv.style.position = "absolute";
            touchEllipseDiv.style.top = y.toString() + "px";
            touchEllipseDiv.style.left = x.toString() + "px";
            touchEllipseDiv.style.borderWidth = "0px";
            touchEllipseDiv.style.height = height + "px";
            touchEllipseDiv.style.width = width + "px";
            touchEllipseDiv.style.zIndex = "2";
            touchEllipseDiv.id = page.Id + "_ellipse";
            this.PageContainer.appendChild(touchEllipseDiv);
            var imageResizerDiv = document.createElement("div");
            imageResizerDiv.style.position = "absolute";
            imageResizerDiv.style.top = y.toString() + "px";
            imageResizerDiv.style.left = x.toString() + "px";
            imageResizerDiv.style.borderWidth = "0px";
            imageResizerDiv.style.height = height + "px";
            imageResizerDiv.style.width = width + "px";
            imageResizerDiv.style.backgroundColor = "transparent";
            imageResizerDiv.style.overflow = "hidden";
            imageResizerDiv.id = page.Id + "_resize";
            this.PageContainer.appendChild(imageResizerDiv);
            page._ShowHideComments(foregroundContainer, backgroundContainer, selectionContainer, touchEllipseDiv, imageResizerDiv, this);
            this.VisiblePages._Add(page);
            page._RenderWidgets();
        };
        PageLayoutViewer.prototype._ClearVisiblePages = function () {
            for (var i = 0; i < this.VisiblePages.length; i++) {
                var page = this.VisiblePages[i];
                var element = document.getElementById(page.Id);
                if (element != null)
                    element.parentElement.removeChild(element);
                page._RemoveWidgets(this);
            }
            this.VisiblePages._Clear();
        };
        PageLayoutViewer.prototype._Print = function () {
            var height = 0;
            for (var i = 0; i < this.Pages.length; i++) {
                if (height < this.Pages[i].BoundingRectangle.Height)
                    height = this.Pages[i].BoundingRectangle.Height;
            }
            var width = 0;
            for (var i = 0; i < this.Pages.length; i++) {
                if (width < this.Pages[i].BoundingRectangle.Width) {
                    width = this.Pages[i].BoundingRectangle.Width;
                }
            }
            var browserUserAgent = navigator.userAgent;
            var iframe = document.createElement("iframe");
            iframe.style.position = "absolute";
            iframe.style.left = "-100em";
            document.body.appendChild(iframe);
            iframe.contentDocument.open();
            if ((browserUserAgent.indexOf('Chrome') != -1) || (browserUserAgent.indexOf('Safari') != -1) || (browserUserAgent.indexOf("Firefox")) != -1) {
                iframe.contentDocument.write('<!DOCTYPE html>');
                iframe.contentDocument.write('<html moznomarginboxes mozdisallowselectionprint><head><style>html, body { height: 100 %; } img { height: 100 %; width: 100 %; display: block;}img { box-sizing: border-box; }br, button { display: none; }@page{ margin: 0cm; size:' + width.toString() + 'px ' + height.toString() + 'px; }@media print{ body { margin: 0cm; }</style></head> <body><center>');
            }
            else {
                iframe.contentDocument.write('<html><head><style>@page{margin:0;size:' + width.toString() + 'px ' + height.toString() + 'px;}</style></head><body><center>');
            }
            for (var i = 0; i < this.Pages.length; i++) {
                var page = this.Pages[i];
                var pageHeight = page.BoundingRectangle.Height;
                var pageWidth = page.BoundingRectangle.Width;
                var canvasURL = page._RenderCanvas().toDataURL();
                if ((browserUserAgent.indexOf('Chrome') != -1) || (browserUserAgent.indexOf('Safari') != -1) || (browserUserAgent.indexOf("Firefox")) != -1) {
                    iframe.contentDocument.write('<div><img src="' + canvasURL + '" style="margin:0px;display:block;width:' + pageWidth.toString() + 'px;height:' + pageHeight.toString() + 'px; "/></div><br/>');
                }
                else {
                    iframe.contentDocument.write('<img src="' + canvasURL + '" style="width:' + pageWidth.toString() + 'px;height:' + pageHeight.toString() + ';margin:0px;"/><br />');
                }
            }
            iframe.contentDocument.write('</center></body></html>');
            iframe.contentDocument.write('</body></html>');
            if (navigator.userAgent.match("Firefox")) {
                iframe.contentWindow.close();
            }
            else {
                iframe.contentDocument.close();
            }
            if ((browserUserAgent.indexOf('Chrome') != -1) || (browserUserAgent.indexOf('Safari') != -1) || (browserUserAgent.indexOf("Firefox")) != -1) {
                iframe.contentWindow.focus();
                iframe.contentWindow.print();
                setTimeout(function () {
                    document.body.removeChild(iframe);
                }, 500);
            }
            else {
                iframe.contentWindow.document.execCommand('print', false, null);
            }
        };
        PageLayoutViewer.prototype._RenderVisiblePages = function () {
            if (this.VisiblePages == undefined || this.VisiblePages == null || this.VisiblePages.Count < 1)
                return;
            for (var i = 0; i < this.VisiblePages.Count; i++) {
                var page = this.VisiblePages[i];
                var bgContainer = document.getElementById(page.Id + "_background");
                page._RemoveWidgets(this);
                page._RenderWidgets();
            }
        };
        PageLayoutViewer.prototype._RemoveRenderedPages = function () {
            for (var i = 0; i < this.Pages.length; i++) {
                var page = this.Pages[i];
                var element = document.getElementById(page.Id);
                if (element != null)
                    element.remove();
                page._RemoveWidgets(this);
            }
        };
        PageLayoutViewer.prototype._SetPageCount = function () {
            this.OwnerControl.PageCount = this.Pages.Count > 0 ? this.Pages.Count : 1;
        };
        return PageLayoutViewer;
    }(LayoutViewer));
    DocumentEditorFeatures.PageLayoutViewer = PageLayoutViewer;
    var FlowLayoutViewer = (function (_super) {
        __extends(FlowLayoutViewer, _super);
        function FlowLayoutViewer(owner) {
            _super.call(this, owner);
            this.PageContainer = document.createElement("div");
            this.PageContainer.setAttribute("id", this.OwnerControl.ContainerId + "_pageContainer");
            this.PageContainer.style.position = "relative";
            this.Container.appendChild(this.PageContainer);
            this.VisiblePages = new List();
        }
        FlowLayoutViewer.prototype._GetContentHeight = function () {
            var height = 0;
            if (this.CurrentPage != null && this.CurrentPage.BodyWidgets.Count > 0) {
                for (var i = 0; i < this.CurrentPage.BodyWidgets.Count; i++) {
                    var bodyWidget = this.CurrentPage.BodyWidgets[i];
                    height += bodyWidget.Height;
                }
                return height;
            }
        };
        FlowLayoutViewer.prototype._CreateNewPage = function (section) {
            if (this.Pages.Count == 0)
                this._InitPage();
            this._UpdateClientAreaInternal();
            if (this.CurrentPage.BodyWidgets.Count == 0) {
                this.CurrentPage.BodyWidgets._Add(section._AddBodyWidget(this.ClientActiveArea));
                this.CurrentPage.BodyWidgets[this.CurrentPage.BodyWidgets.length - 1].Page = this.CurrentPage;
            }
            return this.CurrentPage;
        };
        FlowLayoutViewer.prototype._Zoom = function () {
            this.OwnerControl.Document._LayoutItems(this);
            if (this.OwnerControl.Selection != null && this.OwnerControl.Selection.Start != null && this.OwnerControl.Selection.End != null) {
                this._ScrollToPosition(this.OwnerControl.Selection.Start, this.OwnerControl.Selection.End);
            }
        };
        FlowLayoutViewer.prototype._VerticalScrollBar_ValueChanged = function (eventArgs) {
            var top = eventArgs.scrollTop;
            var viewerHeight = parseFloat(this.Container.style.height);
            var containerHeight = parseFloat(this.PageContainer.style.height);
            if (top > containerHeight - viewerHeight)
                top = containerHeight - viewerHeight;
            this.PageContainer.style.top = (-top).toString() + "px";
            this._RenderVisiblePages();
        };
        FlowLayoutViewer.prototype._HorizontalScrollBar_ValueChanged = function (eventArgs) {
            var left = eventArgs.scrollLeft;
            var viewerWidth = parseFloat(this.Container.style.width);
            var containerWidth = parseFloat(this.PageContainer.style.width);
            if (left > containerWidth - viewerWidth)
                left = containerWidth - viewerWidth;
            this.PageContainer.style.left = (-left).toString() + "px";
        };
        FlowLayoutViewer.prototype._UpdateCursor = function (event) {
            var hyperlinkField = null;
            var point = new Point(event.offsetX, event.offsetY);
            var touchPoint = this._FindFocusedPage(point);
            var widget = this._GetLineWidget(touchPoint);
            if (widget != null)
                hyperlinkField = widget._GetHyperlinkField(this.OwnerControl, touchPoint);
            var div = this.ViewerContatiner;
            if (hyperlinkField != null && event.ctrlKey == true)
                div.style.cursor = "pointer";
            else
                div.style.cursor = "default";
        };
        FlowLayoutViewer.prototype._Print = function () {
        };
        FlowLayoutViewer.prototype._FindFocusedPage = function (currentPoint) {
            var point = new Point(currentPoint.X, currentPoint.Y);
            if (this.PageContainer.style.left.indexOf("px") > -1)
                point.X -= parseFloat(this.PageContainer.style.left.replace("px", ""));
            if (this.PageContainer.style.top.indexOf("px") > -1)
                point.Y -= parseFloat(this.PageContainer.style.top.replace("px", ""));
            var page = this.CurrentPage;
            var pageTop = (page.BoundingRectangle.Top - 20) * this.ZoomFactor + 20;
            var pageHeight = page.BoundingRectangle.Height * this.ZoomFactor;
            var pageLeft = page.BoundingRectangle.Left;
            var pageRight = page.BoundingRectangle.Right;
            if (pageTop <= point.Y && pageTop + pageHeight >= point.Y) {
                this.CurrentPage = page;
                point.Y = (point.Y - pageTop) / this.ZoomFactor;
                if (point.X > pageRight)
                    point.X = page.BoundingRectangle.Right;
                else if (point.X < pageLeft)
                    point.X = page.BoundingRectangle.Left;
                else
                    point.X = (point.X - pageLeft) / this.ZoomFactor;
                return point;
            }
            return point;
        };
        FlowLayoutViewer.prototype._OnPageFitTypeChanged = function (pageFitType) {
            this.ZoomFactor = 1;
        };
        FlowLayoutViewer.prototype._RemoveRenderedPages = function () {
            this._ClearVisiblePages();
        };
        FlowLayoutViewer.prototype._UpdateContainerPosition = function () {
            this.Padding = new Thickness(10, 10, 10, 10);
            var height = 0;
            var width = 0;
            if (!this.TextWrap)
                this._UpdateHorizontalWidth();
            var containerWidth = (this.HorizontalWidth * this.ZoomFactor > this.VisibleBounds.Width) ? this.HorizontalWidth * this.ZoomFactor : this.VisibleBounds.Width;
            var containerHeight = this._GetContentHeight() * this.ZoomFactor + this.Padding.Top + this.Padding.Bottom;
            var viewerWidth = this.VisibleBounds.Width;
            var viewerHeight = this.VisibleBounds.Height;
            if (containerHeight > viewerHeight) {
                viewerWidth -= this.VerticalScrollBar.model.width;
            }
            if (containerWidth > viewerWidth) {
                viewerHeight -= this.HorizontalScrollBar.model.height;
            }
            width = containerWidth > viewerWidth ? containerWidth : viewerWidth;
            height = containerHeight > viewerHeight ? containerHeight : viewerHeight;
            var pageWidth = width;
            if (this.VerticalScrollBar != null)
                pageWidth = pageWidth + Math.max(this.VerticalScrollBar.model.width, this.VerticalScrollBar.model.minimum);
            this.Container.style.width = viewerWidth.toString() + "px";
            this.Container.style.height = viewerHeight.toString() + "px";
            this.PageContainer.style.width = pageWidth.toString() + "px";
            this.PageContainer.style.height = height.toString() + "px";
            if (this.CurrentPage != null) {
                for (var i = 0; i < this.PageContainer.childNodes.length; i++) {
                    this.PageContainer.removeChild(this.PageContainer.childNodes[i]);
                    i--;
                }
                this._ClearVisiblePages();
                this._AddvisiblePage(this.CurrentPage, pageWidth, height, true);
                this.CurrentPage.BoundingRectangle = new Rect(0, 0, pageWidth, height);
            }
            return { "containerWidth": containerWidth, "containerHeight": containerHeight, "width": width, "height": height, "viewerWidth": viewerWidth, "viewerHeight": viewerHeight };
        };
        FlowLayoutViewer.prototype._UpdateScrollBars = function () {
            var updatedPos = this._UpdateContainerPosition();
            var containerWidth = updatedPos.containerWidth;
            var containerHeight = updatedPos.containerHeight;
            var viewerWidth = updatedPos.viewerWidth;
            var viewerHeight = updatedPos.viewerHeight;
            var width = updatedPos.width;
            var height = updatedPos.containerHeight;
            var vScrollBar = this.VerticalScrollBar.element[0];
            if (containerHeight > viewerHeight && this.OwnerControl.LayoutType == LayoutType.Continuous) {
                var scrollValue = this.VerticalScrollBar.model.value;
                vScrollBar.style.display = "block";
                this.VerticalScrollBar.option("maximum", height - viewerHeight);
                this.VerticalScrollBar.option("viewportsize", viewerHeight);
                this.VerticalScrollBar.option("height", viewerHeight);
                this.VerticalScrollBar._scrollData.handleSpace = viewerHeight - (2 * this.VerticalScrollBar.model.buttonSize);
                this.VerticalScrollBar._scrollData.handle = Math.floor((viewerHeight - 18) / height * this.VerticalScrollBar._scrollData.handleSpace);
                if (this.VerticalScrollBar._scrollData.handle < 15)
                    this.VerticalScrollBar._scrollData.handle = 15;
                this.VerticalScrollBar._scrollData.scrollable = this.VerticalScrollBar.model.maximum;
                this.VerticalScrollBar._scrollData.onePx = this.VerticalScrollBar._scrollData.scrollable / (this.VerticalScrollBar._scrollData.handleSpace - this.VerticalScrollBar._scrollData.handle);
                this.VerticalScrollBar["e-vhandle"].height(this.VerticalScrollBar._scrollData.handle);
                this.VerticalScrollBar.scroll(scrollValue);
            }
            else {
                vScrollBar.style.display = "none";
                this.VerticalScrollBar.scroll(0);
            }
            var hScrollBar = this.HorizontalScrollBar.element[0];
            if (containerWidth > viewerWidth && this.OwnerControl.LayoutType == LayoutType.Continuous) {
                var scrollValue = this.HorizontalScrollBar.model.value;
                hScrollBar.style.display = "block";
                this.HorizontalScrollBar.option("maximum", width - viewerWidth);
                this.HorizontalScrollBar.option("viewportsize", viewerWidth);
                this.HorizontalScrollBar.option("width", viewerWidth);
                this.HorizontalScrollBar._scrollData.handleSpace = viewerWidth - (2 * this.HorizontalScrollBar.model.buttonSize);
                this.HorizontalScrollBar._scrollData.handle = Math.floor((viewerWidth - 18) / width * this.HorizontalScrollBar._scrollData.handleSpace);
                if (this.HorizontalScrollBar._scrollData.handle < 15)
                    this.HorizontalScrollBar._scrollData.handle = 15;
                this.HorizontalScrollBar._scrollData.scrollable = this.HorizontalScrollBar.model.maximum;
                this.HorizontalScrollBar._scrollData.onePx = this.HorizontalScrollBar._scrollData.scrollable / (this.HorizontalScrollBar._scrollData.handleSpace - this.HorizontalScrollBar._scrollData.handle);
                this.HorizontalScrollBar["e-hhandle"].width(this.HorizontalScrollBar._scrollData.handle);
                this.HorizontalScrollBar.scroll(scrollValue);
            }
            else {
                hScrollBar.style.display = "none";
                this.HorizontalScrollBar.scroll(0);
            }
        };
        FlowLayoutViewer.prototype._AddvisiblePage = function (page, width, height, isAddintial) {
            var backgroundContainer = document.createElement("canvas");
            backgroundContainer.style.position = "absolute";
            backgroundContainer.style.borderWidth = "1px";
            backgroundContainer.style.borderColor = "#D9DCDD";
            backgroundContainer.style.borderStyle = "solid";
            backgroundContainer.style.backgroundColor = this.OwnerControl.Document.BackgroundColor;
            backgroundContainer.height = height * 2;
            backgroundContainer.width = width * 2;
            backgroundContainer.style.height = height + "px";
            backgroundContainer.style.width = width + "px";
            backgroundContainer.style.zIndex = "0";
            backgroundContainer.id = page.Id + "_background";
            this.PageContainer.appendChild(backgroundContainer);
            this.Container.appendChild(this.PageContainer);
            var foregroundContainer = document.createElement("canvas");
            foregroundContainer.style.position = "absolute";
            foregroundContainer.style.borderWidth = "0px";
            foregroundContainer.height = height * 2;
            foregroundContainer.width = width * 2;
            foregroundContainer.style.height = height + "px";
            foregroundContainer.style.width = width + "px";
            foregroundContainer.style.zIndex = "1";
            foregroundContainer.id = page.Id + "_foreground";
            this.PageContainer.appendChild(foregroundContainer);
            var selectionContainer = document.createElement("canvas");
            selectionContainer.style.position = "absolute";
            selectionContainer.style.borderWidth = "0px";
            selectionContainer.height = height * 2;
            selectionContainer.width = width * 2;
            selectionContainer.style.height = height + "px";
            selectionContainer.style.width = width + "px";
            selectionContainer.style.zIndex = "2";
            selectionContainer.id = page.Id + "_selection";
            this.PageContainer.appendChild(selectionContainer);
            var touchEllipseDiv = document.createElement("div");
            touchEllipseDiv.style.position = "absolute";
            touchEllipseDiv.style.top = top.toString() + "px";
            touchEllipseDiv.style.left = top.toString() + "px";
            touchEllipseDiv.style.borderWidth = "0px";
            touchEllipseDiv.style.height = height + "px";
            touchEllipseDiv.style.width = width + "px";
            touchEllipseDiv.style.zIndex = "2";
            touchEllipseDiv.id = page.Id + "_ellipse";
            this.PageContainer.appendChild(touchEllipseDiv);
            this.VisiblePages._Add(page);
        };
        FlowLayoutViewer.prototype._UpdateHorizontalWidth = function () {
            if (this.CurrentPage == null)
                return;
            this.HorizontalWidth = 0;
            var paraWidgets = new List();
            for (var i = 0; i < this.CurrentPage.BodyWidgets.Count; i++) {
                this.CurrentPage.BodyWidgets[i]._UpdateHorizontalWidth(paraWidgets, this);
            }
            if (this.HorizontalWidth > 0)
                this.HorizontalWidth += this.Padding.Right;
            for (var i = 0; i < paraWidgets.Count; i++) {
                var parawidget = paraWidgets[i];
                for (var j = 0; j < parawidget.ChildWidgets.Count; j++) {
                    var lineWidget = parawidget.ChildWidgets[j];
                    lineWidget._UpdateSubWidth(this);
                }
            }
            if (paraWidgets.Count > 0)
                this._RenderVisiblePages();
        };
        FlowLayoutViewer.prototype._InitPage = function () {
            var page = new Page();
            page.Id = this.OwnerControl.ContainerId + "_page_" + Math.random().toString();
            page.Viewer = this;
            page.BoundingRectangle = new Rect(0, 0, this.VisibleBounds.Width, this.VisibleBounds.Height);
            this.CurrentPage = page;
            var top = 10;
            this.Pages._Add(page);
        };
        FlowLayoutViewer.prototype._RenderVisiblePages = function () {
            if (this.CurrentPage != null) {
                this.CurrentPage._RemoveWidgets(this);
                this.CurrentPage._RenderWidget(this);
            }
        };
        FlowLayoutViewer.prototype._ClearVisiblePages = function () {
            if (this.VisiblePages != undefined) {
                for (var i = 0; i < this.VisiblePages.length; i++) {
                    var page = this.VisiblePages[i];
                    var element = document.getElementById(page.Id);
                    if (element != null)
                        element.parentElement.removeChild(element);
                    page._RemoveWidgets(this);
                }
                this.VisiblePages._Clear();
            }
        };
        return FlowLayoutViewer;
    }(LayoutViewer));
    DocumentEditorFeatures.FlowLayoutViewer = FlowLayoutViewer;
    var FontDialog = (function () {
        function FontDialog(layoutViewer) {
            this.characterFormat = null;
            this.fontStyle = null;
            this.InsertFontDialog = null;
            this.fontNameList = null;
            this.fontNameText = null;
            this.fontStyleList = null;
            this.fontStyleText = null;
            this.fontSizeList = null;
            this.fontSizeText = null;
            this.fontColor = null;
            this.underline = null;
            this.strikethrough = null;
            this.doublestrikethrough = null;
            this.superscript = null;
            this.subscript = null;
            this.viewer = layoutViewer;
            this.characterFormat = new SelectionCharacterFormat(null);
            this._InitFontDialog();
        }
        Object.defineProperty(FontDialog.prototype, "CharacterFormat", {
            get: function () {
                return this.characterFormat;
            },
            set: function (value) {
                this.characterFormat = value;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(FontDialog.prototype, "FontStyle", {
            get: function () {
                return this.fontStyle;
            },
            set: function (value) {
                this.fontStyle = value;
                switch (this.fontStyle) {
                    case "Bold":
                        this.characterFormat.Bold = true;
                        this.characterFormat.Italic = false;
                        break;
                    case "Italic":
                        this.characterFormat.Bold = false;
                        this.characterFormat.Italic = true;
                        break;
                    case "BoldItalic":
                        this.characterFormat.Bold = true;
                        this.characterFormat.Italic = true;
                        break;
                    case "Regular":
                        this.characterFormat.Bold = false;
                        this.characterFormat.Italic = false;
                        break;
                }
            },
            enumerable: true,
            configurable: true
        });
        FontDialog.prototype._InitFontDialog = function () {
            var instance = this.viewer;
            this.InsertFontDialog = this.viewer.OwnerControl.ej.buildTag("div", "", { "display": "none" }, {
                "id": "documentEditor_" + this.viewer.OwnerControl.ContainerId + "_insertFontDialog", "title": "Font"
            });
            instance.OwnerControl.DocumentEditorElement.appendChild(this.InsertFontDialog[0]);
            var innerDiv = document.createElement("div");
            innerDiv.style.width = "500px";
            innerDiv.style.height = "420px";
            var table = document.createElement("TABLE");
            table.style.width = "500px";
            table.style.height = "auto";
            table.style.padding = "20px";
            table.style.margin = "10px";
            table.innerHTML += "<tr><td><label>Font</label></br><input type='text' id='" + this.InsertFontDialog[0].id + "_fontName' style='width:150px;height:15px;font-size:11px;'value=''><ul id='" + this.InsertFontDialog[0].id + "_fontNames' style='font-size:11px;'></td><td><label>Font Style</label></br><input type='text' id='" + this.InsertFontDialog[0].id + "_fontStyle' style='width:100px;height:15px;font-size:11px;' value=''><ul id='" + this.InsertFontDialog[0].id + "_fontStyles' style='font-size:12px;'><li>Regular</li><li>Bold</li><li>Italic</li><li>BoldItalic</li></td><td><label>Size</label></br><input type='text' id='" + this.InsertFontDialog[0].id + "_fontSize' style='width:100px;height:15px;font-size:11px;' value=''><ul id='" + this.InsertFontDialog[0].id + "_fontSizes' style='font-size:12px;'><li>8</li><li>9</li><li>10</li><li>11</li><li>12</li><li>14</li><li>16</li><li>18</li><li>20</li><li>24</li><li>26</li><li>28</li><li>36</li><li>48</li><li>72</li><li>96</li></td></tr><tr><td><label>Font Color</label><input type='text' id='" + this.InsertFontDialog[0].id + "_fontColor'/></td><td><label>Underline</label><input type='text' id='" + this.InsertFontDialog[0].id + "_underLine'/></td> </tr><tr><td><label>Effects</label></td></tr><tr><td><input type='checkbox' id='" + this.InsertFontDialog[0].id + "_strikeThrough' class='nodetext'><label style='padding:5px;'>StrikeThrough</label></br><input type='checkbox' id='" + this.InsertFontDialog[0].id + "_doubleStrikeThrough' class='nodetext'><label style='padding:5px;'>Double StrikeThrough</label></td><td><input type='checkbox' id='" + this.InsertFontDialog[0].id + "_superScript' class='nodetext'><label style='padding:5px;'>Superscript</label></br><input type='checkbox' id='" + this.InsertFontDialog[0].id + "_subScript' class='nodetext'><label style='padding:5px;'>Subscript</label></td></tr>";
            innerDiv.appendChild(table);
            var currentIns = this;
            var okBtn = this.viewer.OwnerControl.ej.buildTag("input", "", { "margin-left": "0px", "left": "280px", "position": "relative" }, {
                "type": "button", "id": this.InsertFontDialog[0].id + "_ok", "value": "Ok"
            });
            var cancelBtn = this.viewer.OwnerControl.ej.buildTag("input", "", { "margin-left": "0px", "left": "310px", "position": "relative" }, {
                "type": "button", "id": this.InsertFontDialog[0].id + "_cancel", "value": "Cancel"
            });
            cancelBtn.ejButton({
                width: "90px",
                height: "23px",
                click: function (args) {
                    if (!args.cancel)
                        currentIns.InsertFontDialog.ejDialog("close");
                }
            });
            okBtn.ejButton({
                width: "90px",
                height: "23px",
                click: instance.OwnerControl.ej.proxy(this._OnInsertFontFormat, this)
            });
            innerDiv.appendChild(okBtn[0]);
            innerDiv.appendChild(cancelBtn[0]);
            this.InsertFontDialog[0].appendChild(innerDiv);
            this.fontNameList = this.InsertFontDialog.find("#" + this.InsertFontDialog[0].id + "_fontNames");
            this.fontStyleList = this.InsertFontDialog.find("#" + this.InsertFontDialog[0].id + "_fontStyles");
            this.fontSizeList = this.InsertFontDialog.find("#" + this.InsertFontDialog[0].id + "_fontSizes");
            this.fontNameText = this.InsertFontDialog.find("#" + this.InsertFontDialog[0].id + "_fontName");
            this.fontStyleText = this.InsertFontDialog.find("#" + this.InsertFontDialog[0].id + "_fontStyle");
            this.fontSizeText = this.InsertFontDialog.find("#" + this.InsertFontDialog[0].id + "_fontSize");
            this.fontColor = this.InsertFontDialog.find("#" + this.InsertFontDialog[0].id + "_fontColor");
            this.underline = this.InsertFontDialog.find("#" + this.InsertFontDialog[0].id + "_underLine");
            this.strikethrough = this.InsertFontDialog.find("#" + this.InsertFontDialog[0].id + "_strikeThrough");
            this.doublestrikethrough = this.InsertFontDialog.find("#" + this.InsertFontDialog[0].id + "_doubleStrikeThrough");
            this.superscript = this.InsertFontDialog.find("#" + this.InsertFontDialog[0].id + "_superScript");
            this.subscript = this.InsertFontDialog.find("#" + this.InsertFontDialog[0].id + "_subScript");
            instance._CreateEjListBox(this.fontNameList);
            instance._CreateEjListBox(this.fontStyleList);
            instance._CreateEjListBox(this.fontSizeList);
            instance._CreateEjColorPicker(this.fontColor);
            instance._CreateEjDropDownList(this.underline);
            instance._CreateEjCheckBox(this.strikethrough);
            instance._CreateEjCheckBox(this.doublestrikethrough);
            instance._CreateEjCheckBox(this.superscript);
            instance._CreateEjCheckBox(this.subscript);
            var fontNames = [{ fontName: "Arial" }, { fontName: "Calibri" }, { fontName: "Cambria" }, { fontName: "Cambria Math" }, { fontName: "Candara" }, { fontName: "Comic Sans MS" }, { fontName: "Consolas" },
                { fontName: "Constantia" }, { fontName: "Corbel" }, { fontName: "Courier New" }, { fontName: "Ebrima" }, { fontName: "Franklin Gothic" }, { fontName: "Gabriola" }, { fontName: "Gadugi" }, { fontName: "Georgia" },
                { fontName: "Impact" }, { fontName: "Javanese Text" }, { fontName: "Leelawadee UI" }, { fontName: "Lucida Console" }, { fontName: "Lucida Sans Unicode" }, { fontName: "Malgun Gothic" }, { fontName: "Microsoft Himalaya" },
                { fontName: "Microsoft JhengHei" }, { fontName: "Microsoft JhengHei UI" }, { fontName: "Microsoft New Tai Lue" }, { fontName: "Microsoft PhagsPa" }, { fontName: "Microsoft Sans Serif" }, { fontName: "Microsoft Tai Le" },
                { fontName: "Microsoft YaHei" }, { fontName: "Microsoft YaHei UI" }, { fontName: "Microsoft Yi Baiti" }, { fontName: "MingLiU-ExtB" }, { fontName: "PMingLiU-ExtB" }, { fontName: "MingLiU_HKSCS-ExtB" }, { fontName: "Mongolian Baiti" },
                { fontName: "MS Gothic" }, { fontName: "MS UI Gothic" }, { fontName: "MS PGothic" }, { fontName: "MV Boli" }, { fontName: "Myanmar Text" }, { fontName: "Nirmala UI" }, { fontName: "Palatino Linotype" }, { fontName: "Segoe MDL2 Assets" },
                { fontName: "Segoe Print" }, { fontName: "Segoe Script" }, { fontName: "Segoe UI" }, { fontName: "Segoe UI Emoji" }, { fontName: "Segoe UI Historic" }, { fontName: "Segoe UI Symbol" }, { fontName: "SimSun" }
            ];
            this.fontNameList.ejListBox({
                width: "154px",
                height: "135px",
                dataSource: fontNames,
                fields: { text: "fontName" },
            });
            this.fontStyleList.ejListBox({
                width: "104px",
                height: "135px",
            });
            this.fontSizeList.ejListBox({
                width: "104px",
                height: "135px"
            });
            this.underline.ejDropDownList({
                dataSource: ["(none)", "_________"],
                width: "134px",
                height: "22px"
            });
            this.strikethrough.ejCheckBox({
                checked: false,
            });
            this.doublestrikethrough.ejCheckBox({
                checked: false,
            });
            this.superscript.ejCheckBox({
                checked: false,
            });
            this.subscript.ejCheckBox({
                checked: false,
            });
            this.InsertFontDialog.find("#" + this.InsertFontDialog[0].id + "_fontColorWrapper").css("width", "134px");
            this.InsertFontDialog.find("#" + this.InsertFontDialog[0].id + "_fontColorWrapper").css("height", "22px");
            this.InsertFontDialog.find("#" + this.InsertFontDialog[0].id + "_fontColorWrapper").css("border-radius", "0px");
            this.InsertFontDialog.find(".e-selected-color").css("width", "85px");
            this.InsertFontDialog.find(".e-selected-color").css("height", "12px");
        };
        FontDialog.prototype._WireUpEventsAndBindings = function () {
            var obj = this;
            this.fontNameList.ejListBox({
                select: function (args) {
                    var fontName = obj.fontNameText[0];
                    obj.CharacterFormat.FontFamily = args.value;
                    fontName.value = args.value;
                }
            });
            this.fontStyleList.ejListBox({
                select: function (args) {
                    var fontStyle = obj.fontStyleText[0];
                    obj.FontStyle = args.value;
                    fontStyle.value = args.value;
                }
            });
            this.fontSizeList.ejListBox({
                select: function (args) {
                    var fontSize = obj.fontSizeText[0];
                    obj.CharacterFormat.FontSize = args.value;
                    fontSize.value = args.value;
                }
            });
            this.fontColor.ejColorPicker({
                select: function (args) {
                    obj.CharacterFormat.FontColor = args.value;
                }
            });
            this.underline.ejDropDownList({
                change: function (args) {
                    obj.CharacterFormat.Underline = args.itemId;
                }
            });
            this.strikethrough.ejCheckBox({
                change: function (args) {
                    obj._EnableCheckBoxproperty(args);
                    if (args.isChecked)
                        obj.CharacterFormat.StrikeThrough = 1;
                    else
                        obj.CharacterFormat.StrikeThrough = 0;
                }
            });
            this.doublestrikethrough.ejCheckBox({
                change: function (args) {
                    obj._EnableCheckBoxproperty(args);
                    if (args.isChecked)
                        obj.CharacterFormat.StrikeThrough = 2;
                    else
                        obj.CharacterFormat.StrikeThrough = 0;
                }
            });
            this.superscript.ejCheckBox({
                change: function (args) {
                    obj._EnableCheckBoxproperty(args);
                    if (args.isChecked)
                        obj.CharacterFormat.BaselineAlignment = 1;
                    else
                        obj.CharacterFormat.BaselineAlignment = 0;
                }
            });
            this.subscript.ejCheckBox({
                change: function (args) {
                    obj._EnableCheckBoxproperty(args);
                    if (args.isChecked)
                        obj.CharacterFormat.BaselineAlignment = 2;
                    else
                        obj.CharacterFormat.BaselineAlignment = 0;
                }
            });
        };
        FontDialog.prototype._EnableCheckBoxproperty = function (args) {
            var strikeThrough = this.strikethrough.data("ejCheckBox");
            var doubleStrikeThrough = this.doublestrikethrough.data("ejCheckBox");
            var superScript = this.superscript.data("ejCheckBox");
            var subScript = this.subscript.data("ejCheckBox");
            if (strikeThrough._isChecked && doubleStrikeThrough._isChecked) {
                strikeThrough.setModel({ checked: false });
                doubleStrikeThrough.setModel({ checked: false });
                $("#" + args.model.id).data("ejCheckBox").setModel({ checked: true });
            }
            if (superScript._isChecked && subScript._isChecked) {
                superScript.setModel({ checked: false });
                subScript.setModel({ checked: false });
                $("#" + args.model.id).data("ejCheckBox").setModel({ checked: true });
            }
        };
        FontDialog.prototype._loadFontDialog = function () {
            this._WireUpEventsAndBindings();
            var fontStyleList = this.fontStyleList.data("ejListBox");
            var fontSizeList = this.fontSizeList.data("ejListBox");
            var underline = this.underline.data("ejDropDownList");
            var strikeThrough = this.strikethrough.data("ejCheckBox");
            var doubleStrikeThrough = this.doublestrikethrough.data("ejCheckBox");
            var superScript = this.superscript.data("ejCheckBox");
            var subScript = this.subscript.data("ejCheckBox");
            this.CharacterFormat._CloneFormat(this.viewer.OwnerControl.Selection.CharacterFormat);
            var characterFormat = this.CharacterFormat;
            this.fontNameText[0].value = characterFormat.FontFamily;
            if (!characterFormat.Bold && !characterFormat.Italic) {
                this.fontStyleText[0].value = fontStyleList.getItemByIndex(0).value;
                fontStyleList.selectItemByIndex(0);
            }
            else if (characterFormat.Bold && !characterFormat.Italic) {
                this.fontStyleText[0].value = fontStyleList.getItemByIndex(1).value;
                fontStyleList.selectItemByIndex(1);
            }
            else if (!characterFormat.Bold && characterFormat.Italic) {
                this.fontStyleText[0].value = fontStyleList.getItemByIndex(2).value;
                fontStyleList.selectItemByIndex(2);
            }
            else if (characterFormat.Bold && characterFormat.Italic) {
                this.fontStyleText[0].value = fontStyleList.getItemByIndex(3).value;
                fontStyleList.selectItemByIndex(3);
            }
            if (characterFormat.FontSize != null) {
                for (var i = 0; i <= 15; i++) {
                    if (characterFormat.FontSize == fontSizeList.getItemByIndex(i).value) {
                        this.fontSizeText[0].value = characterFormat.FontSize;
                        fontSizeList.selectItemByIndex(i);
                        break;
                    }
                }
            }
            if (characterFormat.FontColor != null)
                this.InsertFontDialog.find("span.e-selected-color").css("background-color", characterFormat.FontColor);
            else
                this.InsertFontDialog.find("span.e-selected-color").css("background-color", "#000000");
            if (characterFormat.Underline == 0)
                this.underline[0].value = underline.selectItemByIndex(0);
            else if (characterFormat.Underline == 1)
                this.underline[0].value = underline.selectItemByIndex(1);
            if (characterFormat.StrikeThrough == StrikeThrough.SingleStrike) {
                strikeThrough.setModel({ checked: true });
            }
            else if (characterFormat.StrikeThrough == StrikeThrough.DoubleStrike) {
                doubleStrikeThrough.setModel({ checked: true });
            }
            else {
                strikeThrough.setModel({ checked: false });
                doubleStrikeThrough.setModel({ checked: false });
            }
            if (characterFormat.BaselineAlignment == BaselineAlignment.Superscript) {
                superScript.setModel({ checked: true });
            }
            else if (characterFormat.BaselineAlignment == BaselineAlignment.Subscript) {
                subScript.setModel({ checked: true });
            }
            else {
                superScript.setModel({ checked: false });
                subScript.setModel({ checked: false });
            }
        };
        FontDialog.prototype._OnInsertFontFormat = function () {
            var characterFormat = this.CharacterFormat;
            if (characterFormat != null) {
                if (this.viewer.OwnerControl.Selection != null && !this.viewer.OwnerControl.Selection.CharacterFormat._IsEqualFormat(characterFormat)) {
                    var format = new CharacterFormat(null);
                    characterFormat._CopyToFormat(format);
                    this.viewer.OwnerControl.Selection._OnCharacterFormat(format);
                }
            }
            this.InsertFontDialog.ejDialog("close");
        };
        FontDialog.prototype._UnWireEventsAndBindings = function () {
            this.fontNameList.ejListBox({ change: "" });
            this.fontStyleList.ejListBox({ change: "" });
            this.fontSizeList.ejListBox({ change: "" });
            this.fontColor.ejColorPicker({ change: "" });
            this.underline.ejDropDownList({ change: "" });
            this.strikethrough.ejCheckBox({ change: "" });
            this.doublestrikethrough.ejCheckBox({ change: "" });
            this.superscript.ejCheckBox({ change: "" });
            this.subscript.ejCheckBox({ change: "" });
        };
        return FontDialog;
    }());
    DocumentEditorFeatures.FontDialog = FontDialog;
    var Page = (function () {
        function Page() {
            this.RepeatHeaderRowTableWidget = false;
            this.HeaderWidget = null;
            this.FooterWidget = null;
            this.ReviewPanelWidth = 316;
            this.BodyWidgets = new List();
            this.CommentWidgets = new List();
        }
        Page.prototype._GetPageWidth = function () {
            var width = this.BoundingRectangle.Width;
            return width;
        };
        Page.prototype._IsHideComments = function () {
            return this.Viewer == null || this.Viewer.OwnerControl == null
                || this.Viewer.OwnerControl.Document == null || this.Viewer.OwnerControl.Document.Comments.Count == 0
                || !this.Viewer.OwnerControl.ShowComments;
        };
        Page.prototype._ShowHideComments = function (backgroundContainer, foregroundContainer, selectionContainer, touchEllipseDiv, imageResizerDiv, pageLayout) {
            if (this._IsHideComments()) {
                this.Viewer.isReviewPanelShow = false;
                this._RemoveReviewPanel(backgroundContainer, foregroundContainer, selectionContainer, touchEllipseDiv, imageResizerDiv);
            }
            else {
                this.Viewer.isReviewPanelShow = true;
                this._ShowReviewPanel(backgroundContainer, foregroundContainer, selectionContainer, touchEllipseDiv, imageResizerDiv, pageLayout);
            }
        };
        Page.prototype._AdjustCommentWidgets = function () {
            for (var i = this.CommentWidgets.length - 1; i >= 1; i--) {
                for (var j = 0; j < i; j++) {
                    if (this.CommentWidgets[j].TopPosition > this.CommentWidgets[j + 1].TopPosition) {
                        var temp = this.CommentWidgets[j];
                        this.CommentWidgets[j] = this.CommentWidgets[j + 1];
                        this.CommentWidgets[j + 1] = temp;
                    }
                }
            }
            var comments = this.CommentWidgets;
            var totalHeight = 0;
            for (var i = 0; i < comments.Count; i++) {
                totalHeight += comments[i].Height;
            }
            if (this.BoundingRectangle.Height - 40 < totalHeight) {
                var minHeight = 30;
                if ((this.BoundingRectangle.Height - 40) / comments.Count > 30)
                    minHeight = (this.BoundingRectangle.Height - 40) / comments.Count;
                var ReviewPanelContentHeight = minHeight * comments.Count;
                var ReviewPanelMinimumHeight = minHeight;
                var top_10 = 20;
                for (var i = 0; i < comments.Count; i++) {
                    comments[i].X = comments[i].X;
                    comments[i].Y = top_10;
                    comments[i].VisibleHeight = minHeight;
                    top_10 += minHeight;
                }
            }
            else {
                var top_11 = 20;
                for (var i = 0; i < comments.Count; i++) {
                    if (top_11 < comments[i].TopPosition && this.BoundingRectangle.Height - 20 - comments[i].TopPosition < totalHeight)
                        top_11 = this.BoundingRectangle.Height - 20 - totalHeight;
                    else if (top_11 < comments[i].TopPosition)
                        top_11 = comments[i].TopPosition;
                    comments[i].X = comments[i].X;
                    comments[i].Y = top_11;
                    comments[i].VisibleHeight = comments[i].Height;
                    top_11 += comments[i].Height;
                    totalHeight -= comments[i].Height;
                }
            }
        };
        Page.prototype._UpdateContainer = function (backgroundContainer, foregroundContainer, selectionContainer, touchEllipseDiv, imageResizerDiv, pageWidth) {
            var viewer = null;
            if (this.Viewer instanceof PageLayoutViewer)
                viewer = this.Viewer;
            backgroundContainer.width = pageWidth * viewer.ZoomFactor;
            foregroundContainer.width = pageWidth * viewer.ZoomFactor;
            selectionContainer.width = pageWidth * viewer.ZoomFactor;
            touchEllipseDiv.style.width = pageWidth * viewer.ZoomFactor + "px";
            imageResizerDiv.style.width = pageWidth * viewer.ZoomFactor + "px";
            for (var i = 0; i < this.Viewer.Pages.length; i++) {
                var page = this.Viewer.Pages[i];
                page.BoundingRectangle = new Rect(page.BoundingRectangle.X, page.BoundingRectangle.Y, pageWidth, page.BoundingRectangle.Height);
            }
            if (this.BoundingRectangle.Width == this.Section.SectionFormat.PageWidth + this.ReviewPanelWidth) {
                var updatedPos = viewer._UpdateContainerPosition();
                backgroundContainer.style.left = this.BoundingRectangle.Left + "px";
                foregroundContainer.style.left = this.BoundingRectangle.Left + "px";
                selectionContainer.style.left = this.BoundingRectangle.Left + "px";
                touchEllipseDiv.style.left = this.BoundingRectangle.Left + "px";
                imageResizerDiv.style.left = this.BoundingRectangle.Left + "px";
            }
            viewer._UpdateScrollBars();
        };
        Page.prototype._GetCommentWidget = function (point) {
            if (this.CommentWidgets.Count > 0) {
                for (var i = 0; i < this.CommentWidgets.Count; i++) {
                    var commentWidget = this.CommentWidgets[i];
                    if (point.Y > commentWidget.Y && point.Y < commentWidget.Y + commentWidget.VisibleHeight)
                        return commentWidget;
                }
            }
            return null;
        };
        Page.prototype._RemoveReviewPanel = function (backgroundContainer, foregroundContainer, selectionContainer, touchEllipseDiv, imageResizerDiv) {
            var pageWidth = this.Section.SectionFormat.PageWidth;
            if (this.BoundingRectangle.Width > pageWidth)
                this._UpdateContainer(backgroundContainer, foregroundContainer, selectionContainer, touchEllipseDiv, imageResizerDiv, pageWidth);
        };
        Page.prototype._ShowReviewPanel = function (backgroundContainer, foregroundContainer, selectionContainer, touchEllipseDiv, imageResizerDiv, pageLayout) {
            var pageWidth = this.BoundingRectangle.Width + this.ReviewPanelWidth;
            this.Viewer.OwnerControl.isReviewPanelShown = true;
            if (this.BoundingRectangle.Width < this.Section.SectionFormat.PageWidth + this.ReviewPanelWidth)
                this._UpdateContainer(backgroundContainer, foregroundContainer, selectionContainer, touchEllipseDiv, imageResizerDiv, pageWidth);
            this.Viewer.OwnerControl.isReviewPanelShown = false;
        };
        Page.prototype._ShowBorder = function (backgroundContainer, pageLayout, isPrint) {
            if (backgroundContainer != null || backgroundContainer != undefined) {
                var ctx = backgroundContainer.getContext("2d");
                var zoomVal = pageLayout.ZoomFactor;
                ctx.beginPath();
                if (isPrint)
                    zoomVal = 1;
                ctx.moveTo(this.BoundingRectangle.Width - this.ReviewPanelWidth, 0);
                ctx.lineTo(this.BoundingRectangle.Width - this.ReviewPanelWidth, this.BoundingRectangle.Height);
                ctx.strokeStyle = "rgb(217, 220, 221)";
                ctx.stroke();
                ctx.closePath();
            }
        };
        Page.prototype._RenderWidgets = function () {
            var backgroundContext = document.getElementById(this.Id + "_background").getContext("2d");
            var selectionContext = document.getElementById(this.Id + "_selection").getContext("2d");
            var foregroundContext = document.getElementById(this.Id + "_foreground").getContext("2d");
            var resizerDivContext = document.getElementById(this.Id + "_resize");
            this._SetZoomTransform(backgroundContext, foregroundContext, selectionContext, resizerDivContext, this);
            if (this.Section.SectionFormat.PageWidth < this.BoundingRectangle.Width)
                this._ShowBorder(document.getElementById(this.Id + "_background"), this.Viewer, true);
            if (this.HeaderWidget != null) {
                this.HeaderWidget._render(this);
            }
            if (this.FooterWidget != null) {
                this.FooterWidget._render(this);
            }
            for (var i = 0; i < this.BodyWidgets.length; i++) {
                this.BodyWidgets[i]._render(this);
            }
            if (resizerDivContext != null && this.Viewer.IsImageResizing)
                this.Viewer.ImageResizer._RenderImageResizer(this);
        };
        Page.prototype._RemoveWidgets = function (viewer) {
            var backgroundContainer = document.getElementById(this.Id + "_background");
            if (backgroundContainer != null) {
                var backgroundContext = backgroundContainer.getContext("2d");
                backgroundContext.beginPath();
                backgroundContext.save();
                backgroundContext.setTransform(1, 0, 0, 1, 0, 0);
                backgroundContext.scale(2, 2);
                backgroundContext.clearRect(0, 0, backgroundContainer.width, backgroundContainer.height);
                backgroundContext.restore();
            }
            var selectionContainer = document.getElementById(this.Id + "_selection");
            if (selectionContainer != null) {
                var selectionContext = selectionContainer.getContext("2d");
                selectionContext.beginPath();
                selectionContext.save();
                selectionContext.setTransform(1, 0, 0, 1, 0, 0);
                selectionContext.scale(2, 2);
                selectionContext.clearRect(0, 0, selectionContainer.width, selectionContainer.height);
                selectionContext.restore();
            }
            var foregroundContainer = document.getElementById(this.Id + "_foreground");
            if (foregroundContainer != null) {
                var foregroundContext = foregroundContainer.getContext("2d");
                foregroundContext.beginPath();
                foregroundContext.save();
                foregroundContext.setTransform(1, 0, 0, 1, 0, 0);
                foregroundContext.scale(2, 2);
                foregroundContext.clearRect(0, 0, foregroundContainer.width, foregroundContainer.height);
                foregroundContext.restore();
            }
        };
        Page.prototype._RenderWidget = function (viewer) {
            var backgroundContext = document.getElementById(this.Id + "_background").getContext("2d");
            var selectionContext = document.getElementById(this.Id + "_selection").getContext("2d");
            var foregroundContext = document.getElementById(this.Id + "_foreground").getContext("2d");
            var resizeDivElement = document.getElementById(this.Id + "_resize");
            this._SetZoomTransform(backgroundContext, foregroundContext, selectionContext, resizeDivElement, this);
            for (var i = 0; i < this.BodyWidgets.Count; i++) {
                if (this.BodyWidgets[i]._Render(viewer))
                    break;
            }
        };
        Page.prototype._RenderCanvas = function () {
            var canvas = document.createElement("canvas");
            canvas.style.position = "absolute";
            canvas.style.borderStyle = "solid";
            canvas.style.borderWidth = "1px";
            canvas.setAttribute("width", this.BoundingRectangle.Width.toString());
            canvas.setAttribute("height", this.BoundingRectangle.Height.toString());
            var viewer = null;
            if (this.Viewer instanceof PageLayoutViewer)
                viewer = this.Viewer;
            if (this.Section.SectionFormat.PageWidth < this.BoundingRectangle.Width)
                this._ShowBorder(canvas, viewer, true);
            if (this.HeaderWidget != null) {
                this.HeaderWidget._renderCanvas(canvas);
            }
            if (this.FooterWidget != null) {
                this.FooterWidget._renderCanvas(canvas);
            }
            for (var i = 0; i < this.BodyWidgets.length; i++) {
                this.BodyWidgets[i]._renderCanvas(canvas);
            }
            return canvas;
        };
        Page.prototype._SetZoomTransform = function (backgroundContext, selectionContext, foregroundContext, resizeDivElement, page) {
            backgroundContext.setTransform(page.Viewer.ZoomFactor, 0, 0, page.Viewer.ZoomFactor, 1, 1);
            selectionContext.setTransform(page.Viewer.ZoomFactor, 0, 0, page.Viewer.ZoomFactor, 1, 1);
            foregroundContext.setTransform(page.Viewer.ZoomFactor, 0, 0, page.Viewer.ZoomFactor, 1, 1);
            backgroundContext.scale(2, 2);
            selectionContext.scale(2, 2);
            foregroundContext.scale(2, 2);
            page.Viewer.TouchStart.style.zoom = (page.Viewer.ZoomFactor * 100) + "%";
            page.Viewer.TouchEnd.style.zoom = (page.Viewer.ZoomFactor * 100) + "%";
            page.Viewer.caret.style.zoom = (page.Viewer.ZoomFactor * 100) + "%";
            this._SetResizerZoomTransform(page);
        };
        Page.prototype._SetResizerZoomTransform = function (page) {
            if (page != null) {
                var ImageResizer_1 = this.Viewer.ImageResizer;
                var ZoomFactor = page.Viewer.ZoomFactor;
                if (ImageResizer_1.resizeContainerDiv != null)
                    ImageResizer_1.resizeContainerDiv.style.zoom = (ZoomFactor * 100) + "%";
                if (ImageResizer_1.bottomLeftRect != null)
                    ImageResizer_1.bottomLeftRect.style.zoom = (ZoomFactor * 100) + "%";
                if (ImageResizer_1.bottomRightRect != null)
                    ImageResizer_1.bottomRightRect.style.zoom = (ZoomFactor * 100) + "%";
                if (ImageResizer_1.bottomMiddleRect != null)
                    ImageResizer_1.bottomMiddleRect.style.zoom = (ZoomFactor * 100) + "%";
                if (ImageResizer_1.topRightRect != null)
                    ImageResizer_1.topRightRect.style.zoom = (ZoomFactor * 100) + "%";
                if (ImageResizer_1.topMiddleRect != null)
                    ImageResizer_1.topMiddleRect.style.zoom = (ZoomFactor * 100) + "%";
                if (ImageResizer_1.topLeftRect != null)
                    ImageResizer_1.topLeftRect.style.zoom = (ZoomFactor * 100) + "%";
                if (ImageResizer_1.leftMiddleRect != null)
                    ImageResizer_1.leftMiddleRect.style.zoom = (ZoomFactor * 100) + "%";
                if (ImageResizer_1.rightMiddleRect != null)
                    ImageResizer_1.rightMiddleRect.style.zoom = (ZoomFactor * 100) + "%";
            }
        };
        Page.prototype._ClearTransform = function (backgroundContext, selectionContext, foregroundContext) {
            backgroundContext.setTransform(1, 0, 0, 1, 0, 0);
            selectionContext.setTransform(1, 0, 0, 1, 0, 0);
            foregroundContext.setTransform(1, 0, 0, 1, 0, 0);
            backgroundContext.scale(2, 2);
            selectionContext.scale(2, 2);
            foregroundContext.scale(2, 2);
        };
        Page.prototype._Dispose = function () {
            this.HeaderWidget = null;
            this.FooterWidget = null;
            this.Section = null;
            this._RemoveWidgets(this.Viewer);
            if (this.BodyWidgets != null) {
                this.BodyWidgets._Clear();
                this.BodyWidgets = null;
            }
            if (this.Viewer != null) {
                if (this.Viewer.Pages != null)
                    this.Viewer._RemovePage(this);
                this.Viewer = null;
            }
        };
        return Page;
    }());
    DocumentEditorFeatures.Page = Page;
    var Widget = (function () {
        function Widget() {
            this.X = 0;
            this.Y = 0;
            this.Width = 0;
            this.Height = 0;
            this.ChildWidgets = new List();
        }
        Widget.prototype._UpdateClientAreaLocation = function (area) {
            this.X = area.X;
            this.Y = area.Y;
            this.Width = area.Width;
        };
        Widget.prototype._UpdateWidgetLocation = function (widget) {
            this.X = widget.X;
            this.Y = widget.Y;
            this.Width = widget.Width;
        };
        Widget.prototype._GetPage = function () {
            var page = null;
            if (this.ContainerWidget instanceof BodyWidget) {
                var bodyWidget = this.ContainerWidget;
                page = this.ContainerWidget.Page;
            }
            else if (this.ContainerWidget != null)
                page = this.ContainerWidget._GetPage();
            return page;
        };
        Widget.prototype._RenderSingleBorder = function (context, border, startX, startY, endX, endY, lineWidth) {
            context.beginPath();
            context.moveTo(startX, startY);
            context.lineTo(endX, endY);
            context.lineWidth = lineWidth;
            context.strokeStyle = border.Color ? border.Color : "#000000";
            if (lineWidth >= 0)
                context.stroke();
            context.closePath();
        };
        Widget.prototype._ClearChildSelectionHighlight = function (viewer) {
            for (var i = 0; i < this.ChildWidgets.Count; i++) {
                if (this.ChildWidgets[i] instanceof LineWidget)
                    this.ChildWidgets[i]._ClearSelectionHighlight(viewer);
                else if (this.ChildWidgets[i] instanceof TableCellWidget)
                    this.ChildWidgets[i]._ClearSelectionHighlight(viewer);
                else if (this.ChildWidgets[i] instanceof Widget)
                    this.ChildWidgets[i]._ClearChildSelectionHighlight(viewer);
            }
        };
        Widget.prototype._UpdateContainerWidget = function (bodyWidget, index) {
            if (this.ContainerWidget != null) {
                this.ContainerWidget.ChildWidgets._Remove(this);
                this.ContainerWidget.Height -= this.Height;
                if ((this.ContainerWidget.ChildWidgets == null || this.ContainerWidget.ChildWidgets.Count == 0)
                    && this.ContainerWidget instanceof BodyWidget)
                    this.ContainerWidget._Dispose();
            }
            bodyWidget.ChildWidgets._Insert(index, this);
            bodyWidget.Height += this.Height;
            this.ContainerWidget = bodyWidget;
        };
        Widget.prototype._UpdateContainerWidgetForCell = function (cellWidget) {
            var widget = this;
            if (this.ContainerWidget != null) {
                this.ContainerWidget.ChildWidgets._Remove(this);
                this.ContainerWidget.Height -= this.Height;
                if ((this.ContainerWidget.ChildWidgets == null || this.ContainerWidget.ChildWidgets.Count == 0)
                    && this.ContainerWidget instanceof TableCellWidget)
                    this.ContainerWidget._Dispose();
            }
            cellWidget.ChildWidgets._Add(this);
            this.ContainerWidget = cellWidget;
            var top = cellWidget.Y;
            if (cellWidget.ChildWidgets.Count > 1) {
                var prevWidget = cellWidget.ChildWidgets[cellWidget.ChildWidgets.Count - 2];
                var point = new Point(this.X, prevWidget.Y + prevWidget.Height);
                cellWidget.Height = point.Y + this.Height - top;
                this.X = point.X;
                this.Y = point.Y;
                top = point.Y;
            }
            else {
                var point = new Point(this.X, top);
                cellWidget.Height = point.Y + this.Height - top;
            }
            if (widget instanceof TableWidget)
                widget._UpdateChildLocation(top);
        };
        return Widget;
    }());
    DocumentEditorFeatures.Widget = Widget;
    var BodyWidget = (function (_super) {
        __extends(BodyWidget, _super);
        function BodyWidget(node) {
            _super.call(this);
            this.CurrentNode = node;
        }
        BodyWidget.prototype._renderComment = function () { };
        BodyWidget.prototype._renderCommentCanvas = function (canvas, page, left) { };
        BodyWidget.prototype._render = function (page) {
            var canvas = document.getElementById(page.Id + "_foreground");
            var inline, paraFormat;
            if (canvas == null) {
                return;
            }
            var context = canvas.getContext("2d");
            context.globalAlpha = 1;
            for (var i = 0; i < this.ChildWidgets.length; i++) {
                var widget = this.ChildWidgets[i];
                widget._render(page);
            }
        };
        BodyWidget.prototype._renderCanvas = function (canvas) {
            if (this.ChildWidgets == null)
                return;
            for (var i = 0; i < this.ChildWidgets.length; i++) {
                var widget = this.ChildWidgets[i];
                widget._renderCanvas(canvas);
            }
        };
        BodyWidget.prototype._Render = function (viewer) {
            var layoutType = LayoutType.Continuous;
            layoutType = viewer.OwnerControl.LayoutType;
            var top = this.Y;
            if (layoutType == LayoutType.Continuous
                && (viewer.CurrentPage.BoundingRectangle.Top > (top + this.Height) * viewer.ZoomFactor
                    || viewer.CurrentPage.BoundingRectangle.Bottom < top * viewer.ZoomFactor))
                return viewer.VisibleBounds.Bottom < top * viewer.ZoomFactor;
            var isVisiblePageRendered = false;
            for (var i = 0; i < this.ChildWidgets.Count; i++) {
                if (this.ChildWidgets[i] instanceof ParagraphWidget)
                    isVisiblePageRendered = this.ChildWidgets[i]._Render(viewer);
                else
                    isVisiblePageRendered = this.ChildWidgets[i]._Render(viewer);
                if (isVisiblePageRendered)
                    return true;
            }
            return false;
        };
        BodyWidget.prototype._ShiftChildLocation = function (shiftTop) {
            this.Y += shiftTop;
            for (var i = 0; i < this.ChildWidgets.length; i++) {
                var childWidget = this.ChildWidgets[i];
                if (childWidget instanceof ParagraphWidget) {
                    childWidget.X = childWidget.X;
                    childWidget.Y = childWidget.Y + shiftTop;
                }
                else {
                    var tableWidget = null;
                    if (childWidget instanceof TableWidget)
                        tableWidget = childWidget;
                    if (tableWidget != null)
                        tableWidget._ShiftChildLocation(shiftTop);
                }
            }
        };
        BodyWidget.prototype._GetLineWidget = function (point) {
            for (var i = 0; i < this.ChildWidgets.length; i++) {
                var childWidget = this.ChildWidgets[i];
                if (childWidget instanceof Widget && childWidget.Y <= point.Y
                    && (childWidget.Y + childWidget.Height) >= point.Y)
                    return childWidget._GetLineWidget(point);
            }
            var lineWidget = null;
            if (this.ChildWidgets.length > 0) {
                var firstChildWidget = this.ChildWidgets[0];
                if (firstChildWidget instanceof Widget && firstChildWidget.Y <= point.Y)
                    lineWidget = this.ChildWidgets[this.ChildWidgets.length - 1]._GetLineWidget(point);
                else {
                    var childWidget = null;
                    if (firstChildWidget instanceof Widget)
                        childWidget = firstChildWidget;
                    if (childWidget != null)
                        lineWidget = firstChildWidget._GetLineWidget(point);
                }
            }
            return lineWidget;
        };
        BodyWidget.prototype._CreateOrGetNextBodyWiget = function (viewer) {
            var nextBodyWidget = null;
            if (viewer instanceof FlowLayoutViewer) {
                var page_1 = viewer.CurrentPage;
                var index = page_1.BodyWidgets._IndexOf(this) + 1;
                if (index < page_1.BodyWidgets.Count)
                    return page_1.BodyWidgets[index];
                return null;
            }
            var pageIndex = 0;
            pageIndex = viewer.Pages._IndexOf(this.Page);
            var page = null;
            var currentNode = null;
            if (this.CurrentNode instanceof SectionAdv)
                currentNode = this.CurrentNode;
            if (pageIndex == viewer.Pages.Count - 1
                || viewer.Pages[pageIndex + 1].Section != currentNode) {
                page = viewer._CreateNewPage(currentNode);
                if (viewer.Pages[pageIndex + 1].Section != currentNode)
                    viewer._InsertPage(pageIndex + 1, page);
                nextBodyWidget = page.BodyWidgets[0];
            }
            else {
                page = viewer.Pages[pageIndex + 1];
                nextBodyWidget = page.BodyWidgets[0];
            }
            return nextBodyWidget;
        };
        BodyWidget.prototype._UpdateHorizontalWidth = function (parawidgets, viewer) {
            for (var i = 0; i < this.ChildWidgets.Count; i++) {
                var widget = this.ChildWidgets[i];
                if (widget instanceof ParagraphWidget) {
                    var parawidget = widget;
                    var textAlignment = widget.CurrentNode.ParagraphFormat.TextAlignment;
                    if (textAlignment == TextAlignment.Right || (textAlignment == TextAlignment.Center))
                        parawidgets._Add(widget);
                    for (var j = 0; j < parawidget.ChildWidgets.Count; j++) {
                        var lineWidget = parawidget.ChildWidgets[j];
                        if (lineWidget.Children.Count > 0) {
                            var element = lineWidget.Children[0];
                            element.Margin.Left = 0;
                        }
                        var x = widget.X + lineWidget._GetWidth(true);
                        if (x > viewer.VisibleBounds.Width && x > viewer.HorizontalWidth)
                            viewer.HorizontalWidth = x;
                    }
                }
                else {
                    var tableWidget = widget;
                    var x = widget.X + tableWidget.Table._GetTableWidth();
                    if (x > viewer.VisibleBounds.Width && x > viewer.HorizontalWidth)
                        viewer.HorizontalWidth = x;
                }
            }
        };
        BodyWidget.prototype._GetTableCellWidget = function (point, pageLayout) {
            for (var i = 0; i < this.ChildWidgets.Count; i++) {
                if (this.ChildWidgets[i].Y <= point.Y
                    && (this.ChildWidgets[i].Y + this.ChildWidgets[i].Height) >= point.Y)
                    return this.ChildWidgets[i]._GetTableCellWidget(point, pageLayout);
            }
            var tableCellWidget = null;
            if (this.ChildWidgets.Count > 0 && pageLayout) {
                if (this.ChildWidgets[0].Y <= point.Y)
                    tableCellWidget = this.ChildWidgets[this.ChildWidgets.Count - 1]._GetTableCellWidget(point, pageLayout);
                else
                    tableCellWidget = this.ChildWidgets[0]._GetTableCellWidget(point, pageLayout);
            }
            return tableCellWidget;
        };
        BodyWidget.prototype._GetTableWidget = function (point, pageLayout) {
            for (var i = 0; i < this.ChildWidgets.Count; i++) {
                if ((this.ChildWidgets[i] instanceof TableWidget) && this.ChildWidgets[i].Y <= point.Y
                    && (this.ChildWidgets[i].Y + this.ChildWidgets[i].Height) >= point.Y)
                    return this.ChildWidgets[i];
            }
            return null;
        };
        BodyWidget.prototype._Dispose = function () {
            var height = this.Height;
            if (this.ChildWidgets != null) {
                for (var i = 0; i < this.ChildWidgets.Count; i++) {
                    var widget = this.ChildWidgets[i];
                    if (widget instanceof ParagraphWidget)
                        widget._Dispose();
                    else if (widget instanceof TableRowWidget)
                        widget._Dispose();
                    else
                        widget._Dispose();
                    if (this.ChildWidgets == null)
                        break;
                    this.ChildWidgets._Remove(widget);
                    i--;
                }
                this.ChildWidgets = null;
            }
            if (this.ContainerWidget != null) {
                if (this.ContainerWidget.ChildWidgets != null) {
                    this.ContainerWidget.ChildWidgets._Remove(this);
                    this.ContainerWidget.Height -= height;
                }
                this.ContainerWidget = null;
            }
            if (this instanceof HeaderFooterWidget && (this.CurrentNode != null)) {
                if (this.CurrentNode.LayoutedWidgets != null)
                    (this.CurrentNode.LayoutedWidgets._Remove(this));
                this.CurrentNode = null;
            }
            else if (this instanceof CommentWidget) {
                var widget = this;
                if (widget.Comment != null) {
                    if (widget.Comment.LayoutedWidget != null)
                        widget.Comment.LayoutedWidget = null;
                    this.CurrentNode = null;
                }
            }
            else if (this.CurrentNode instanceof SectionAdv) {
                if (this.CurrentNode.BodyWidgets != null)
                    this.CurrentNode.BodyWidgets._Remove(this);
                this.CurrentNode = null;
            }
            if (this.Page != null) {
                if (this.Page.BodyWidgets != null && this.Page.BodyWidgets._Contains(this)) {
                    this.Page.BodyWidgets._Remove(this);
                    if (this.Page.BodyWidgets.Count == 0)
                        this.Page._Dispose();
                }
                else if (this.Page.HeaderWidget == this)
                    this.Page.HeaderWidget = null;
                else if (this.Page.FooterWidget == this)
                    this.Page.FooterWidget = null;
                else if (this.Page.CommentWidgets != null && this instanceof CommentWidget && this.Page.CommentWidgets._Contains(this)) {
                    this.Page.CommentWidgets._Remove(this);
                    this.Page._AdjustCommentWidgets();
                }
                this.Page = null;
            }
        };
        return BodyWidget;
    }(Widget));
    DocumentEditorFeatures.BodyWidget = BodyWidget;
    var HeaderFooterWidget = (function (_super) {
        __extends(HeaderFooterWidget, _super);
        function HeaderFooterWidget(node) {
            _super.call(this, node);
        }
        HeaderFooterWidget.prototype._render = function (page) {
            var canvas = document.getElementById(page.Id + "_foreground");
            var inline, paraFormat;
            if (canvas == null) {
                return;
            }
            var context = canvas.getContext("2d");
            context.globalAlpha = 0.75;
            for (var i = 0; i < this.ChildWidgets.length; i++) {
                var widget = this.ChildWidgets[i];
                widget._render(page);
            }
        };
        HeaderFooterWidget.prototype._renderCommentCanvas = function (canvas, page, left) { };
        HeaderFooterWidget.prototype._renderCanvas = function (canvas) {
            if (canvas == null) {
                return;
            }
            var context = canvas.getContext("2d");
            context.globalAlpha = 0.75;
            for (var i = 0; i < this.ChildWidgets.length; i++) {
                var widget = this.ChildWidgets[i];
                widget._renderCanvas(canvas);
            }
        };
        HeaderFooterWidget.prototype._GetLineWidget = function (point) {
            for (var i = 0; i < this.ChildWidgets.length; i++) {
                if (this.ChildWidgets[i] instanceof Widget && this.ChildWidgets[i].Y <= point.Y
                    && (this.ChildWidgets[i].Y + this.ChildWidgets[i].Height) >= point.Y)
                    return this.ChildWidgets[i]._GetLineWidget(point);
            }
            var lineWidget = null;
            if (this.ChildWidgets.length > 0) {
                if (this.ChildWidgets[0] instanceof Widget && this.ChildWidgets[0].Y <= point.Y)
                    lineWidget = this.ChildWidgets[this.ChildWidgets.length - 1]._GetLineWidget(point);
                else
                    lineWidget = this.ChildWidgets[0]._GetLineWidget(point);
            }
            return lineWidget;
        };
        return HeaderFooterWidget;
    }(BodyWidget));
    DocumentEditorFeatures.HeaderFooterWidget = HeaderFooterWidget;
    var TableWidget = (function (_super) {
        __extends(TableWidget, _super);
        function TableWidget(node) {
            _super.call(this);
            this.leftMargin = 0;
            this.topMargin = 0;
            this.rightMargin = 0;
            this.bottomMargin = 0;
            this.CurrentNode = node;
            if (node instanceof TableAdv)
                this.Table = node;
            this.Margin = new Margin(this.leftMargin, this.topMargin, this.rightMargin, this.bottomMargin);
            this.LeftBorderWidth = 0;
            this.RightBorderWidth = 0;
            this.TopBorderWidth = 0;
            this.BottomBorderWidth = 0;
        }
        TableWidget.prototype._renderCommentCanvas = function (canvas, left, top) {
            var prevLeft = this.X;
            var prevTop = this.Y;
            if (this.ContainerWidget instanceof CommentWidget) {
                var sectionFormat = this.CurrentNode.OwnerBase.OwnerBase.OwnerBase.SectionFormat;
                this.Y = top += this.Y;
                this.X = left = this.X + sectionFormat.PageWidth;
            }
            if (this.CurrentNode.TableFormat.CellSpacing > 0) {
                var context = canvas.getContext("2d");
                this._RenderTableOutline(context);
            }
            for (var i = 0; i < this.ChildWidgets.length; i++) {
                var widget = this.ChildWidgets[i];
                widget._renderCommentCanvas(canvas, left, top);
            }
            this.X = prevLeft;
            this.Y = prevTop;
        };
        TableWidget.prototype._renderComment = function (page, left, top) {
            var prevLeft = this.X;
            var prevTop = this.Y;
            if (this.ContainerWidget instanceof CommentWidget) {
                var sectionFormat = this.CurrentNode.OwnerBase.OwnerBase.OwnerBase.SectionFormat;
                this.Y = top += this.Y;
                this.X = left = this.X + sectionFormat.PageWidth;
            }
            var backgroundContainer = document.getElementById(page.Id + "_background");
            if (this.CurrentNode.TableFormat.CellSpacing > 0) {
                var context = backgroundContainer.getContext("2d");
                this._RenderTableOutline(context);
            }
            for (var i = 0; i < this.ChildWidgets.length; i++) {
                var widget = this.ChildWidgets[i];
                widget._renderComment(page, left, top);
            }
            this.X = prevLeft;
            this.Y = prevTop;
        };
        TableWidget.prototype._render = function (page) {
            var backgroundContainer = document.getElementById(page.Id + "_background");
            if (this.CurrentNode.TableFormat.CellSpacing > 0) {
                var context = backgroundContainer.getContext("2d");
                this._RenderTableOutline(context);
            }
            for (var i = 0; i < this.ChildWidgets.length; i++) {
                var widget = this.ChildWidgets[i];
                widget._render(page);
            }
        };
        TableWidget.prototype._renderCanvas = function (canvas) {
            if (this.CurrentNode.TableFormat.CellSpacing > 0) {
                var context = canvas.getContext("2d");
                this._RenderTableOutline(context);
            }
            for (var i = 0; i < this.ChildWidgets.length; i++) {
                var widget = this.ChildWidgets[i];
                widget._renderCanvas(canvas);
            }
        };
        TableWidget.prototype._Render = function (viewer) {
            var layoutType = LayoutType.Continuous;
            layoutType = viewer.OwnerControl.LayoutType;
            var cellspacing = this.Table.TableFormat.CellSpacing;
            if (layoutType == LayoutType.Continuous
                && (viewer.CurrentPage.BoundingRectangle.Top > (this.Y + this.Height) * viewer.ZoomFactor
                    || viewer.CurrentPage.BoundingRectangle.Bottom < this.Y * viewer.ZoomFactor))
                return viewer.VisibleBounds.Bottom < this.Y * viewer.ZoomFactor;
            var page = viewer.CurrentPage;
            if (cellspacing > 0) {
                var backgroundCanvas = document.getElementById(page.Id + "_background");
                var backgroundContext = backgroundCanvas.getContext("2d");
            }
            for (var i = 0; i < this.ChildWidgets.Count; i++) {
                var rowWidget = this.ChildWidgets[i];
                for (var j = 0; j < rowWidget.ChildWidgets.Count; j++) {
                    if (rowWidget.ChildWidgets[j]._Render(viewer))
                        return true;
                }
            }
            return false;
        };
        TableWidget.prototype._UpdateHeight = function (viewer) {
            for (var i = 0; i < this.ChildWidgets.length; i++) {
                var rowWidget = null;
                var childWidget = this.ChildWidgets[i];
                if (childWidget instanceof TableRowWidget)
                    rowWidget = childWidget;
                if (rowWidget != null)
                    rowWidget._UpdateHeight(viewer, true);
            }
        };
        TableWidget.prototype._ShiftChildLocation = function (shiftTop) {
            this.Y = this.Y + shiftTop;
            for (var i = 0; i < this.ChildWidgets.Count; i++) {
                var rowWidget = null;
                var childWidget = this.ChildWidgets[i];
                if (childWidget instanceof TableRowWidget)
                    rowWidget = childWidget;
                if (rowWidget != null)
                    rowWidget._ShiftChildLocation(shiftTop);
            }
        };
        TableWidget.prototype._GetSplittedWidget = function (bottom) {
            var rowBottom = this.Y;
            var splittedWidget = null;
            for (var i = 0; i < this.ChildWidgets.length; i++) {
                var rowWidget = null;
                var childWidget = this.ChildWidgets[i];
                if (childWidget instanceof TableRowWidget)
                    rowWidget = childWidget;
                var rowHeight = rowWidget.Height;
                if (bottom < rowBottom + rowHeight || splittedWidget != null) {
                    var splittedRow = (splittedWidget == null && rowWidget._IsFirstLineFit(bottom)) ? rowWidget._GetSplittedWidget(bottom) : rowWidget;
                    if (splittedRow != null) {
                        if (i == 0 && splittedRow == rowWidget)
                            return this;
                        if (this.ChildWidgets._Contains(splittedRow)) {
                            this.ChildWidgets._RemoveAt(this.ChildWidgets.indexOf(splittedRow));
                            i--;
                            this.Height -= splittedRow.Height;
                        }
                        else
                            this.Height -= rowHeight - rowWidget.Height;
                        if (splittedWidget == null) {
                            splittedWidget = new TableWidget(this.Table);
                            splittedWidget._UpdateWidgetLocation(this);
                            this.Table.TableWidgets._Add(splittedWidget);
                            splittedWidget.Height = splittedRow.Height;
                        }
                        else
                            splittedWidget.Height += splittedRow.Height;
                        splittedWidget.ChildWidgets._Add(splittedRow);
                        splittedRow.ContainerWidget = splittedWidget;
                    }
                }
                rowBottom += rowWidget.Height;
            }
            return splittedWidget;
        };
        TableWidget.prototype._IsFirstLineFit = function (bottom) {
            var rowWidget = null;
            var childWidget = this.ChildWidgets[0];
            if (childWidget instanceof TableRowWidget)
                rowWidget = childWidget;
            if (rowWidget != null)
                return rowWidget._IsFirstLineFit(bottom);
        };
        TableWidget.prototype._UpdateChildLocation = function (top) {
            for (var i = 0; i < this.ChildWidgets.length; i++) {
                var rowWidget = this.ChildWidgets[i];
                rowWidget.X = rowWidget.X;
                rowWidget.Y = top;
                rowWidget._UpdateChildLocation(top);
                top += rowWidget.Height;
            }
        };
        TableWidget.prototype._GetLineWidget = function (point) {
            var lineWidget = null;
            for (var i = 0; i < this.ChildWidgets.Count; i++) {
                var childWidget = this.ChildWidgets[i];
                if (childWidget instanceof TableRowWidget && childWidget.Y <= point.Y) {
                    lineWidget = childWidget._GetLineWidget(point);
                    var cellWidget = null;
                    if (lineWidget != null && lineWidget.CurrentParagraphWidget.ContainerWidget instanceof TableCellWidget)
                        cellWidget = lineWidget.CurrentParagraphWidget.ContainerWidget;
                    var cellSpacing = 0;
                    var rowSpan = 0;
                    if (cellWidget != null) {
                        cellSpacing = cellWidget.TableCell.OwnerTable.TableFormat.CellSpacing;
                        rowSpan = cellWidget.TableCell.CellFormat.RowSpan;
                    }
                    var leftCellSpacing = 0;
                    var rightCellSpacing = 0;
                    var topCellSpacing = 0;
                    var bottomCellSpacing = 0;
                    if (cellSpacing > 0) {
                        leftCellSpacing = cellWidget.TableCell.CellIndex == 0 ? cellSpacing : cellSpacing / 2;
                        rightCellSpacing = cellWidget.TableCell.CellIndex == cellWidget.TableCell.OwnerRow.Cells.Count - 1 ? cellSpacing : cellSpacing / 2;
                        var rowWidget = null;
                        if (cellWidget.ContainerWidget instanceof TableRowWidget)
                            rowWidget = cellWidget.ContainerWidget;
                        var tableWidget = null;
                        if (cellWidget.ContainerWidget.ContainerWidget instanceof TableWidget)
                            tableWidget = cellWidget.ContainerWidget.ContainerWidget;
                        if (rowWidget != null && tableWidget != null && tableWidget.Table.TableWidgets.Count > 0) {
                            topCellSpacing = cellWidget.TableCell.OwnerRow.RowIndex == 0 ? cellSpacing : cellSpacing / 2;
                            if (cellWidget.TableCell.OwnerRow.RowIndex + rowSpan == cellWidget.TableCell.OwnerTable.Rows.Count)
                                bottomCellSpacing = cellSpacing;
                            else
                                bottomCellSpacing = cellSpacing / 2;
                        }
                    }
                    if ((lineWidget != null && lineWidget.CurrentParagraphWidget.X <= point.X && lineWidget.CurrentParagraphWidget.X + lineWidget.Width >= point.X
                        && lineWidget.CurrentParagraphWidget.Y <= point.Y && lineWidget._GetTop() + lineWidget.Height >= point.Y)
                        || (cellWidget != null && cellWidget.X - cellWidget.Margin.Left - leftCellSpacing <= point.X && cellWidget.X + cellWidget.Width + cellWidget.Margin.Right + rightCellSpacing >= point.X
                            && cellWidget.Y - cellWidget.Margin.Top - topCellSpacing <= point.Y && cellWidget.Y + cellWidget.Height + cellWidget.Margin.Bottom + bottomCellSpacing >= point.Y))
                        break;
                }
            }
            return lineWidget;
        };
        TableWidget.prototype._RenderTableOutlines = function (viewer) {
            if (this.ContainerWidget != null) {
                var widget = this.ContainerWidget;
                while (widget.ContainerWidget instanceof Widget) {
                    widget = widget.ContainerWidget;
                }
                var page = null;
                if (widget instanceof BodyWidget)
                    page = widget.Page;
                var backgroundContainer = document.getElementById(page.Id + "_background");
                var context = backgroundContainer.getContext("2d");
                if ((viewer instanceof PageLayoutViewer && viewer.VisiblePages._Contains(page))
                    || (viewer instanceof FlowLayoutViewer && viewer.CurrentPage == page))
                    this._RenderTableOutline(context);
            }
        };
        TableWidget.prototype._RenderTableOutline = function (context) {
            var table = this.CurrentNode;
            var border = table.TableFormat.Borders._GetTableTopBorder();
            var lineWidth = 0;
            if (border != null) {
                lineWidth = border._GetLineWidth();
                this._RenderSingleBorder(context, border, this.X - this.Margin.Left - lineWidth / 2, this.Y, this.X - this.Margin.Left - lineWidth / 2, this.Y + this.Height, lineWidth);
            }
            border = table.TableFormat.Borders._GetTableTopBorder();
            lineWidth = 0;
            if (border != null) {
                lineWidth = border._GetLineWidth();
                this._RenderSingleBorder(context, border, this.X - this.Margin.Left - lineWidth, this.Y - lineWidth / 2, this.X + this.Width + lineWidth + this.Margin.Right, this.Y - lineWidth / 2, lineWidth);
            }
            border = table.TableFormat.Borders._GetTableRightBorder();
            lineWidth = 0;
            if (border != null) {
                lineWidth = border._GetLineWidth();
                this._RenderSingleBorder(context, border, this.X + this.Width + this.Margin.Right + lineWidth / 2, this.Y, this.X + this.Width + this.Margin.Right + lineWidth / 2, this.Y + this.Height, lineWidth);
            }
            border = table.TableFormat.Borders._GetTableBottomBorder();
            lineWidth = 0;
            if (border != null) {
                lineWidth = border._GetLineWidth();
                this._RenderSingleBorder(context, border, this.X - this.Margin.Left - lineWidth, this.Y + this.Height - lineWidth / 2, this.X + this.Width + lineWidth + this.Margin.Right, this.Y + this.Height - lineWidth / 2, lineWidth);
            }
        };
        TableWidget.prototype._GetTableCellWidget = function (point, pageLayout) {
            var tableCellWidget = null;
            for (var i = 0; i < this.ChildWidgets.Count; i++) {
                if (this.ChildWidgets[i].Y <= point.Y
                    && (this.ChildWidgets[i].Y + this.ChildWidgets[i].Height) >= point.Y) {
                    tableCellWidget = this.ChildWidgets[i]._GetTableCellWidget(point, pageLayout);
                    break;
                }
            }
            return tableCellWidget;
        };
        TableWidget.prototype._Dispose = function () {
            var height = this.Height;
            if (this.ChildWidgets != null) {
                for (var i = 0; i < this.ChildWidgets.Count; i++) {
                    var widget = null;
                    var childWidget = this.ChildWidgets[i];
                    if (childWidget instanceof TableRowWidget)
                        widget = childWidget;
                    if (widget != null)
                        widget._Dispose();
                    if (this.ChildWidgets == null)
                        break;
                    this.ChildWidgets._Remove(widget);
                    i--;
                }
                this.ChildWidgets = null;
            }
            if (this.Table != null) {
                if (this.Table.TableWidgets != null) {
                    this.Table.TableWidgets._Remove(this);
                }
                this.Table = null;
            }
            if (this.ContainerWidget != null) {
                if (this.ContainerWidget.ChildWidgets != null) {
                    this.ContainerWidget.ChildWidgets._Remove(this);
                    this.ContainerWidget.Height -= height;
                    if ((this.ContainerWidget.ChildWidgets == null || this.ContainerWidget.ChildWidgets.Count == 0)
                        && this.ContainerWidget instanceof BodyWidget)
                        this.ContainerWidget._Dispose();
                }
                this.ContainerWidget = null;
            }
        };
        return TableWidget;
    }(Widget));
    DocumentEditorFeatures.TableWidget = TableWidget;
    var TableRowWidget = (function (_super) {
        __extends(TableRowWidget, _super);
        function TableRowWidget(node) {
            _super.call(this);
            this.TableRow = null;
            this.CurrentNode = node;
            if (node instanceof TableRowAdv)
                this.TableRow = node;
            this.TopBorderWidth = 0;
            this.BottomBorderWidth = 0;
        }
        TableRowWidget.prototype._renderCommentCanvas = function (canvas, left, top) {
            var prevLeft = this.X;
            var prevTop = this.Y;
            this.X = left;
            this.Y = top;
            for (var i = 0; i < this.ChildWidgets.length; i++) {
                var widget = this.ChildWidgets[i];
                widget._renderCommentCanvas(canvas, left, top);
            }
            this.X = prevLeft;
            this.Y = prevTop;
        };
        TableRowWidget.prototype._renderComment = function (page, left, top) {
            var prevLeft = this.X;
            var prevTop = this.Y;
            this.X = left;
            this.Y = top;
            for (var i = 0; i < this.ChildWidgets.length; i++) {
                var widget = this.ChildWidgets[i];
                widget._renderComment(page, left, top);
            }
            this.X = prevLeft;
            this.Y = prevTop;
        };
        TableRowWidget.prototype._render = function (page) {
            for (var i = 0; i < this.ChildWidgets.length; i++) {
                var widget = this.ChildWidgets[i];
                widget._render(page);
            }
        };
        TableRowWidget.prototype._renderCanvas = function (canvas) {
            for (var i = 0; i < this.ChildWidgets.length; i++) {
                var widget = this.ChildWidgets[i];
                widget._renderCanvas(canvas);
            }
        };
        TableRowWidget.prototype._splitSpannedCellWidget = function (cellWidget, viewer) {
            var splittedCell = cellWidget._GetSplittedWidget(viewer.ClientArea.Bottom, false);
            if (splittedCell != null)
                viewer.SplittedCellWidgets._Add(splittedCell);
        };
        TableRowWidget.prototype._UpdateHeight = function (viewer, isUpdateVerticalPosition) {
            for (var i = 0; i < this.ChildWidgets.length; i++) {
                var cellspacing = 0;
                var cellWidget = null;
                var childWidget = this.ChildWidgets[i];
                if (childWidget instanceof TableCellWidget)
                    cellWidget = childWidget;
                var rowSpan = 1;
                rowSpan = cellWidget.TableCell.CellFormat.RowSpan;
                cellspacing = cellWidget.TableCell.OwnerTable.TableFormat.CellSpacing;
                if (rowSpan > 1) {
                    var currentRowWidgetIndex = this.ContainerWidget.ChildWidgets.indexOf(this);
                    var rowSpanWidgetEndIndex = currentRowWidgetIndex + rowSpan - 1 - (this.TableRow.RowIndex - cellWidget.TableCell.OwnerRow.RowIndex);
                    if (viewer.ClientArea.Bottom < cellWidget.Y + cellWidget.Height + cellWidget.Margin.Bottom
                        || rowSpanWidgetEndIndex >= currentRowWidgetIndex + 1)
                        this._splitSpannedCellWidget(cellWidget, viewer);
                    var spanEndRowWidget = this;
                    if (rowSpanWidgetEndIndex > 0) {
                        if (rowSpanWidgetEndIndex < this.ContainerWidget.ChildWidgets.length) {
                            var rowWidget = null;
                            var childWidget_1 = this.ContainerWidget.ChildWidgets[rowSpanWidgetEndIndex];
                            if (childWidget_1 instanceof TableRowWidget)
                                spanEndRowWidget = childWidget_1;
                        }
                        else
                            spanEndRowWidget = this.ContainerWidget.ChildWidgets[this.ContainerWidget.ChildWidgets.length - 1];
                    }
                    if (cellWidget.Y + cellWidget.Height + cellWidget.Margin.Bottom < spanEndRowWidget.Y + spanEndRowWidget.Height)
                        cellWidget.Height = spanEndRowWidget.Y + spanEndRowWidget.Height - cellWidget.Y - cellWidget.Margin.Bottom;
                    else if (this.ContainerWidget.ContainerWidget != null && cellWidget.Y + cellWidget.Height + cellWidget.Margin.Bottom > spanEndRowWidget.Y + spanEndRowWidget.Height) {
                        spanEndRowWidget.Height = cellWidget.Y + cellWidget.Height + cellWidget.Margin.Bottom - spanEndRowWidget.Y;
                        if (this == spanEndRowWidget && this.TableRow.NextNode instanceof TableRowAdv) {
                            var nextrow = this.TableRow.NextNode;
                            if (nextrow.TableRowWidgets.length > 0) {
                                nextrow.TableRowWidgets[0].X = nextrow.TableRowWidgets[0].X;
                                nextrow.TableRowWidgets[0].Y = this.Y + this.Height;
                            }
                        }
                    }
                }
                else {
                    if (cellspacing > 0) {
                        if (this.TableRow.OwnerTable.TableWidgets.Count > 1 && this.Y == this.TableRow.OwnerTable.Document.OwnerControl.Viewer.ClientArea.Y && viewer instanceof PageLayoutViewer)
                            cellspacing = cellspacing / 2;
                    }
                    cellWidget.Height = this.Height - cellWidget.Margin.Top - cellWidget.Margin.Bottom - cellspacing;
                }
                cellWidget._UpdateHeight(viewer);
                var widget = this.ContainerWidget;
                while (widget.ContainerWidget instanceof Widget) {
                    widget = widget.ContainerWidget;
                }
                var page = null;
                if (widget instanceof BodyWidget)
                    page = widget.Page;
                if (((viewer instanceof PageLayoutViewer && viewer.VisiblePages._Contains(page)) || (viewer instanceof FlowLayoutViewer && viewer.CurrentPage == page)) || isUpdateVerticalPosition) {
                    cellWidget._UpdateCellVerticalPosition(false, false);
                }
                if (viewer instanceof PageLayoutViewer && viewer.VisiblePages._Contains(page)) {
                    if (viewer.CommentWidgets.Count > 0)
                        viewer._MoveCommentsToPage(page);
                    if (this.TableRow != null && this.TableRow.RowFormat != null)
                        cellWidget._render(page);
                }
                else if (viewer instanceof FlowLayoutViewer && viewer.CurrentPage == page)
                    cellWidget._Render(viewer);
            }
        };
        TableRowWidget.prototype._GetSplittedWidget = function (bottom) {
            var splittedWidget = null;
            var rowIndex = this.TableRow.RowIndex;
            for (var i = 0; i < this.ChildWidgets.length; i++) {
                var cellWidget = this.ChildWidgets[i];
                var splittedCell = cellWidget._GetSplittedWidget(bottom, true);
                if (splittedCell != null) {
                    if (splittedCell == cellWidget)
                        return this;
                    if (this.ChildWidgets._Contains(splittedCell))
                        this.ChildWidgets._Remove(splittedCell);
                    if (i == 0 || this.Height < cellWidget.Height + cellWidget.Margin.Top + cellWidget.Margin.Bottom)
                        this.Height = cellWidget.Height + cellWidget.Margin.Top + cellWidget.Margin.Bottom;
                    if (splittedWidget == null) {
                        splittedWidget = new TableRowWidget(this.TableRow);
                        splittedWidget._UpdateWidgetLocation(this);
                        this.TableRow.TableRowWidgets._Add(splittedWidget);
                        splittedWidget.Height = 0;
                    }
                    var rowSpan = 1;
                    rowSpan = (splittedCell == null || splittedCell.TableCell == null || splittedCell.TableCell.CellFormat == null) ? rowSpan : splittedCell.TableCell.CellFormat.RowSpan;
                    if (rowIndex - splittedCell.TableCell.OwnerRow.RowIndex == rowSpan - 1
                        && splittedWidget.Height < splittedCell.Height + splittedCell.Margin.Top + splittedCell.Margin.Bottom)
                        splittedWidget.Height = splittedCell.Height + splittedCell.Margin.Top + splittedCell.Margin.Bottom;
                    splittedWidget.ChildWidgets._Add(splittedCell);
                    splittedCell.ContainerWidget = splittedWidget;
                }
            }
            return splittedWidget;
        };
        TableRowWidget.prototype._IsFirstLineFit = function (bottom) {
            for (var i = 0; i < this.ChildWidgets.length; i++) {
                var cellWidget = this.ChildWidgets[i];
                if (!cellWidget._IsFirstLineFit(bottom))
                    return false;
            }
            return true;
        };
        TableRowWidget.prototype._InsertSplittedCellWidgets = function (viewer) {
            var left = this.X;
            var tableWidth = 0;
            tableWidth = this.TableRow.OwnerTable.TableWidth;
            for (var i = 0; i < this.ChildWidgets.length; i++) {
                var cellWidget = this.ChildWidgets[i];
                if (Math.round(left) < Math.round(cellWidget.X - cellWidget.Margin.Left)) {
                    if (this._InsertRowSpannedWidget(viewer, left, i)) {
                        i--;
                        continue;
                    }
                    var count = this.ChildWidgets.length;
                    this._InsertEmptySplittedCellWidget(left, i);
                    if (count < this.ChildWidgets.length) {
                        i--;
                        continue;
                    }
                }
                left += cellWidget.Margin.Left + cellWidget.Width + cellWidget.Margin.Right;
                if (i == this.ChildWidgets.length - 1 && Math.round(left) < Math.round(this.X + tableWidth)) {
                    if (this._InsertRowSpannedWidget(viewer, left, i + 1))
                        continue;
                    this._InsertEmptySplittedCellWidget(left, i + 1);
                    continue;
                }
                if ((this.ChildWidgets == null || this.ChildWidgets.Count == 0) && viewer.SplittedCellWidgets.Count > 0) {
                    for (var i_6 = 0; i_6 < viewer.SplittedCellWidgets.Count; i_6++) {
                        var cellWidget_1 = viewer.SplittedCellWidgets[i_6];
                        if (Math.round(left) <= Math.round(cellWidget_1.X - cellWidget_1.Margin.Left)) {
                            if (this._InsertRowSpannedWidget(viewer, left, i_6)) {
                                i_6--;
                                continue;
                            }
                            var count = this.ChildWidgets.Count;
                            this._InsertEmptySplittedCellWidget(left, i_6);
                            if (count < this.ChildWidgets.Count) {
                                i_6--;
                                continue;
                            }
                        }
                        left += cellWidget_1.Margin.Left + cellWidget_1.Width + cellWidget_1.Margin.Right;
                        if (i_6 == this.ChildWidgets.Count - 1 && Math.round(left) < Math.round(this.X + tableWidth)) {
                            if (this._InsertRowSpannedWidget(viewer, left, i_6 + 1))
                                continue;
                            this._InsertEmptySplittedCellWidget(left, i_6 + 1);
                            continue;
                        }
                    }
                }
                if (viewer.SplittedCellWidgets.Count > 0)
                    viewer.SplittedCellWidgets._Clear();
            }
        };
        TableRowWidget.prototype._InsertRowSpannedWidget = function (viewer, left, index) {
            var cellSpacing = 0;
            if (this.TableRow.OwnerTable.TableFormat.CellSpacing > 0)
                cellSpacing = this.TableRow.OwnerTable.TableFormat.CellSpacing;
            for (var i = 0; i < viewer.SplittedCellWidgets.length; i++) {
                var splittedCell = viewer.SplittedCellWidgets[i];
                if (Math.round(left) == Math.round(splittedCell.X - splittedCell.Margin.Left)) {
                    this.ChildWidgets._Insert(index, splittedCell);
                    splittedCell.ContainerWidget = this;
                    if (splittedCell.Y != this.Y + splittedCell.Margin.Top + cellSpacing)
                        this._UpdateChildLocation(this.Y);
                    viewer.SplittedCellWidgets._Remove(splittedCell);
                    return true;
                }
            }
            return false;
        };
        TableRowWidget.prototype._InsertEmptySplittedCellWidget = function (left, index) {
            var tableWidget = this.TableRow.OwnerTable.TableWidgets[this.TableRow.OwnerTable.TableWidgets.length - 1];
            for (var i = tableWidget.ChildWidgets.length - 1; i >= 0; i--) {
                var rowWidget = tableWidget.ChildWidgets[i];
                var previousLeft = rowWidget.X;
                for (var j = 0; j < rowWidget.ChildWidgets.length; j++) {
                    var rowSpan = 1;
                    var cellWidget = rowWidget.ChildWidgets[j];
                    if (Math.round(left) == Math.round(previousLeft)) {
                        rowSpan = (cellWidget == null || cellWidget.TableCell == null || cellWidget.TableCell.CellFormat == null) ? rowSpan : cellWidget.TableCell.CellFormat.RowSpan;
                        if (rowSpan > 1) {
                            var emptyCellWidget = cellWidget._CreateCellWidget();
                            this.ChildWidgets._Insert(index, emptyCellWidget);
                            emptyCellWidget.ContainerWidget = this;
                        }
                        return;
                    }
                    previousLeft += cellWidget.Margin.Left + cellWidget.Width + cellWidget.Margin.Right;
                }
            }
        };
        TableRowWidget.prototype._UpdateChildLocation = function (top) {
            var spacing = 0;
            if (this.TableRow.OwnerTable.TableFormat.CellSpacing > 0)
                spacing = this.TableRow.OwnerTable.TableFormat.CellSpacing;
            for (var i = 0; i < this.ChildWidgets.length; i++) {
                var cellWidget = this.ChildWidgets[i];
                cellWidget.X = cellWidget.X;
                cellWidget.Y = top + cellWidget.Margin.Top + spacing;
                cellWidget._UpdateChildLocation(cellWidget.Y);
            }
        };
        TableRowWidget.prototype._ShiftChildLocation = function (shiftTop) {
            this.Y = this.Y + shiftTop;
            for (var i = 0; i < this.ChildWidgets.Count; i++) {
                this.ChildWidgets[i]._ShiftChildLocation(shiftTop);
            }
        };
        TableRowWidget.prototype._GetLineWidget = function (point) {
            for (var i = 0; i < this.ChildWidgets.length; i++) {
                var cellSpacing = 0;
                cellSpacing = this.TableRow.OwnerTable.TableFormat.CellSpacing;
                var leftCellSpacing = 0;
                var rightCellSpacing = 0;
                if (cellSpacing > 0) {
                    leftCellSpacing = this.ChildWidgets[i].TableCell.ColumnIndex == 0 ? cellSpacing : cellSpacing / 2;
                    rightCellSpacing = this.ChildWidgets[i].TableCell.CellIndex == this.ChildWidgets[i].TableCell.OwnerRow.Cells.Count - 1 ? cellSpacing : cellSpacing / 2;
                }
                if (this.ChildWidgets[i].X - this.ChildWidgets[i].Margin.Left - leftCellSpacing <= point.X
                    && (this.ChildWidgets[i].X + this.ChildWidgets[i].Width) + this.ChildWidgets[i].Margin.Right + rightCellSpacing >= point.X)
                    return this.ChildWidgets[i]._GetLineWidget(point);
            }
            var lineWidget = null;
            if (this.ChildWidgets.length > 0) {
                if (this.ChildWidgets[0].X <= point.X)
                    lineWidget = this.ChildWidgets[this.ChildWidgets.length - 1]._GetLineWidget(point);
                else
                    lineWidget = this.ChildWidgets[0]._GetLineWidget(point);
            }
            return lineWidget;
        };
        TableRowWidget.prototype._UpdateTableWidget = function (tableWidget, index) {
            if (this.ContainerWidget != null) {
                this.ContainerWidget.ChildWidgets._Remove(this);
                if ((this.ContainerWidget.ChildWidgets == null || this.ContainerWidget.ChildWidgets.Count == 0)
                    && this.ContainerWidget instanceof TableWidget)
                    this.ContainerWidget._Dispose();
                else if (this.ContainerWidget.ContainerWidget instanceof BodyWidget)
                    this.ContainerWidget.ContainerWidget.Height -= this.Height;
                this.ContainerWidget.Height -= this.Height;
            }
            tableWidget.ChildWidgets._Insert(index, this);
            tableWidget.Height += this.Height;
            this.ContainerWidget = tableWidget;
        };
        TableRowWidget.prototype._GetTableCellWidget = function (point, pageLayout) {
            for (var i = 0; i < this.ChildWidgets.Count; i++) {
                if (this.ChildWidgets[i].X - this.ChildWidgets[i].Margin.Left - 1 <= point.X
                    && (this.ChildWidgets[i].X + this.ChildWidgets[i].Width) >= point.X)
                    return this.ChildWidgets[i];
                else if (i == this.ChildWidgets.Count - 1 && (this.ChildWidgets[i].X + this.ChildWidgets[i].Width) + 1 <= point.X)
                    return this.ChildWidgets[i];
            }
            var tableCellWidget = null;
            if (this.ChildWidgets.Count > 0 && pageLayout) {
                if (this.ChildWidgets[0].X <= point.X)
                    tableCellWidget = this.ChildWidgets[this.ChildWidgets.Count - 1]._GetTableCellWidget(point, pageLayout);
                else
                    tableCellWidget = this.ChildWidgets[0]._GetTableCellWidget(point, pageLayout);
            }
            return tableCellWidget;
        };
        TableRowWidget.prototype._GetActualWidth = function () {
            var width = 0;
            if (this.ChildWidgets.Count > 0) {
                for (var i = 0; i < this.ChildWidgets.Count; i++) {
                    width += this.ChildWidgets[i].TableCell.CellFormat.CellWidth;
                }
            }
            return width;
        };
        TableRowWidget.prototype._Dispose = function () {
            var height = this.Height;
            if (this.ChildWidgets != null) {
                for (var i = 0; i < this.ChildWidgets.Count; i++) {
                    var widget = this.ChildWidgets[i];
                    widget._Dispose();
                    if (this.ChildWidgets == null)
                        break;
                    this.ChildWidgets._Remove(widget);
                    i--;
                }
                this.ChildWidgets = null;
            }
            if (this.TableRow != null) {
                if (this.TableRow.TableRowWidgets != null)
                    this.TableRow.TableRowWidgets._Remove(this);
                this.TableRow = null;
            }
            if (this.ContainerWidget != null) {
                if (this.ContainerWidget.ChildWidgets != null) {
                    this.ContainerWidget.ChildWidgets._Remove(this);
                    if ((this.ContainerWidget.ChildWidgets == null || this.ContainerWidget.ChildWidgets.Count == 0)
                        && this.ContainerWidget instanceof TableWidget)
                        this.ContainerWidget._Dispose();
                    else if (this.ContainerWidget.ContainerWidget instanceof BodyWidget)
                        this.ContainerWidget.ContainerWidget.Height -= height;
                    this.ContainerWidget.Height -= height;
                }
                this.ContainerWidget = null;
            }
        };
        return TableRowWidget;
    }(Widget));
    DocumentEditorFeatures.TableRowWidget = TableRowWidget;
    var TableCellWidget = (function (_super) {
        __extends(TableCellWidget, _super);
        function TableCellWidget(node) {
            _super.call(this);
            this.leftMargin = 0;
            this.topMargin = 0;
            this.rightMargin = 0;
            this.bottomMargin = 0;
            this.TableCell = node;
            this.CurrentNode = node;
            this.Margin = new Margin(this.leftMargin, this.topMargin, this.rightMargin, this.bottomMargin);
            this.LeftBorderWidth = 0;
            this.RightBorderWidth = 0;
        }
        TableCellWidget.prototype._renderCommentCanvas = function (canvas, left, top) {
            var prevLeft = this.X;
            var prevTop = this.Y;
            this.X = left;
            this.Y = top;
            var context = canvas.getContext("2d");
            this._RenderTableCellOutline(context);
            for (var i = 0; i < this.ChildWidgets.length; i++) {
                var widget = this.ChildWidgets[i];
                widget._renderCommentCanvas(canvas, left, top);
            }
            this.X = prevLeft;
            this.Y = prevTop;
        };
        TableCellWidget.prototype._renderComment = function (page, left, top) {
            var prevLeft = this.X;
            var prevTop = this.Y;
            this.X = left;
            this.Y = top;
            var widgetHeight = 0;
            var backgroundCanvas = document.getElementById(page.Id + "_background");
            var backgroundContext = backgroundCanvas.getContext("2d");
            this._RenderTableCellOutline(backgroundContext);
            var selectionCanvas = document.getElementById(page.Id + "_selection");
            var selectionContext = selectionCanvas.getContext("2d");
            if (page.Viewer.OwnerControl.Selection.SelectionRanges.Count > 0)
                page.Viewer.OwnerControl.Selection.SelectionRanges._AddSelectionHighlightTable(selectionContext, this);
            for (var i = 0; i < this.ChildWidgets.length; i++) {
                var widget = this.ChildWidgets[i];
                widget._renderComment(page, this.X - prevLeft + widget.X, this.Y - prevTop + widget.Y);
            }
            this.X = prevLeft;
            this.Y = prevTop;
        };
        TableCellWidget.prototype._render = function (page) {
            var widgetHeight = 0;
            var backgroundCanvas = document.getElementById(page.Id + "_background");
            var backgroundContext = backgroundCanvas.getContext("2d");
            this._RenderTableCellOutline(backgroundContext);
            var selectionCanvas = document.getElementById(page.Id + "_selection");
            var selectionContext = selectionCanvas.getContext("2d");
            if (page.Viewer.OwnerControl.Selection.SelectionRanges.Count > 0)
                page.Viewer.OwnerControl.Selection.SelectionRanges._AddSelectionHighlightTable(selectionContext, this);
            for (var i = 0; i < this.ChildWidgets.length; i++) {
                var widget = this.ChildWidgets[i];
                widget._render(page);
            }
        };
        TableCellWidget.prototype._renderCanvas = function (canvas) {
            var context = canvas.getContext("2d");
            this._RenderTableCellOutline(context);
            for (var i = 0; i < this.ChildWidgets.length; i++) {
                var widget = this.ChildWidgets[i];
                widget._renderCanvas(canvas);
            }
        };
        TableCellWidget.prototype._Render = function (viewer) {
            var layoutType = LayoutType.Continuous;
            layoutType = viewer.OwnerControl.LayoutType;
            if (layoutType == LayoutType.Continuous
                && (viewer.CurrentPage.BoundingRectangle.Top > (this.Y + this.Height) * viewer.ZoomFactor
                    || viewer.CurrentPage.BoundingRectangle.Bottom < this.Y * viewer.ZoomFactor))
                return viewer.VisibleBounds.Bottom < this.Y * viewer.ZoomFactor;
            var isVisiblePageRendered = false;
            for (var i = 0; i < this.ChildWidgets.Count; i++) {
                if (this.ChildWidgets[i] instanceof ParagraphWidget)
                    isVisiblePageRendered = this.ChildWidgets[i]._Render(viewer);
                else
                    isVisiblePageRendered = this.ChildWidgets[i]._Render(viewer);
            }
            var page = viewer.CurrentPage;
            var selectionCanvas = document.getElementById(page.Id + "_selection");
            var selectionContext = selectionCanvas.getContext("2d");
            if (viewer.OwnerControl.Selection.SelectionRanges.Count > 0)
                viewer.OwnerControl.Selection.SelectionRanges._AddSelectionHighlightTable(selectionContext, this);
            if (this.TableCell.CellFormat.RowSpan > 0 && this.TableCell.CellFormat.ColumnSpan > 0) {
                var backgroundCanvas = document.getElementById(page.Id + "_background");
                var backgroundContext = backgroundCanvas.getContext("2d");
                this._RenderTableCellOutline(backgroundContext);
            }
            return isVisiblePageRendered;
        };
        TableCellWidget.prototype._ShiftChildLocation = function (shiftTop) {
            this.Y = this.Y + shiftTop;
            for (var i = 0; i < this.ChildWidgets.Count; i++) {
                if (this.ChildWidgets[i] instanceof ParagraphWidget) {
                    this.ChildWidgets[i].X = this.ChildWidgets[i].X;
                    this.ChildWidgets[i].Y = this.ChildWidgets[i].Y + shiftTop;
                }
                else {
                    this.ChildWidgets[i]._ShiftChildLocation(shiftTop);
                }
            }
        };
        TableCellWidget.prototype._GetSplittedWidget = function (bottom, splitMinimalWidget) {
            var splittedWidget = null;
            if (this.Y + this.Height > bottom - this.Margin.Bottom) {
                for (var i = 0; i < this.ChildWidgets.length; i++) {
                    if (this.ChildWidgets[i] instanceof ParagraphWidget) {
                        var paragraphWidget = this.ChildWidgets[i];
                        var splittedPara = paragraphWidget._GetSplittedWidget(bottom - this.Margin.Bottom);
                        if (splittedPara != null) {
                            if (i == 0 && splittedPara == paragraphWidget)
                                return this;
                            if (this.ChildWidgets._Contains(splittedPara)) {
                                this.ChildWidgets._Remove(splittedPara);
                                i--;
                            }
                            this.Height -= splittedPara.Height;
                            if (splittedWidget == null) {
                                splittedWidget = this._CreateCellWidget();
                            }
                            splittedWidget.Height += splittedPara.Height;
                            splittedWidget.ChildWidgets._Add(splittedPara);
                            splittedPara.ContainerWidget = splittedWidget;
                        }
                    }
                    else {
                        var tableWidget = this.ChildWidgets[i];
                        if (bottom - this.Margin.Bottom < tableWidget.Y + tableWidget.Height) {
                            var tableHeight = tableWidget.Height;
                            var splittedTable = tableWidget._GetSplittedWidget(bottom - this.Margin.Bottom);
                            if (splittedTable != null) {
                                if (i == 0 && splittedTable == tableWidget)
                                    return this;
                                if (this.ChildWidgets._Contains(splittedTable)) {
                                    this.ChildWidgets._Remove(splittedTable);
                                    i--;
                                    this.Height -= splittedTable.Height;
                                }
                                else
                                    this.Height -= tableHeight - tableWidget.Height;
                                if (splittedWidget == null) {
                                    splittedWidget = this._CreateCellWidget();
                                }
                                splittedWidget.Height += splittedTable.Height;
                                splittedWidget.ChildWidgets._Add(splittedTable);
                                splittedTable.ContainerWidget = splittedWidget;
                            }
                        }
                    }
                }
            }
            if (splittedWidget == null && splitMinimalWidget) {
                if (this.ChildWidgets.length == 0)
                    this.Height = 0;
                splittedWidget = this._CreateCellWidget();
            }
            return splittedWidget;
        };
        TableCellWidget.prototype._CreateCellWidget = function () {
            var cellWidget = new TableCellWidget(this.TableCell);
            cellWidget._UpdateWidgetLocation(this);
            this.TableCell.TableCellWidgets._Add(cellWidget);
            cellWidget.Margin = this.Margin;
            cellWidget.LeftBorderWidth = this.LeftBorderWidth;
            cellWidget.RightBorderWidth = this.RightBorderWidth;
            return cellWidget;
        };
        TableCellWidget.prototype._IsFirstLineFit = function (bottom) {
            if (this.ChildWidgets.length == 0)
                return true;
            if (this.ChildWidgets[0] instanceof ParagraphWidget) {
                var paraWidget = this.ChildWidgets[0];
                return paraWidget._IsFirstLineFit(bottom - this.Margin.Bottom);
            }
            else {
                var tableWidget = this.ChildWidgets[0];
                return tableWidget._IsFirstLineFit(bottom - this.Margin.Bottom);
            }
        };
        TableCellWidget.prototype._UpdateHeight = function (viewer) {
            for (var i = 0; i < this.ChildWidgets.length; i++) {
                if (this.ChildWidgets[i] instanceof TableWidget)
                    this.ChildWidgets[i]._UpdateHeight(viewer);
            }
        };
        TableCellWidget.prototype._UpdateChildLocation = function (top) {
            for (var i = 0; i < this.ChildWidgets.length; i++) {
                this.ChildWidgets[i].X = this.ChildWidgets[i].X;
                this.ChildWidgets[i].Y = top;
                if (this.ChildWidgets[i] instanceof TableWidget)
                    this.ChildWidgets[i]._UpdateChildLocation(top);
                top += this.ChildWidgets[i].Height;
            }
        };
        TableCellWidget.prototype._GetLineWidget = function (point) {
            for (var i = 0; i < this.ChildWidgets.length; i++) {
                if (this.ChildWidgets[i].Y <= point.Y
                    && (this.ChildWidgets[i].Y + this.ChildWidgets[i].Height) >= point.Y)
                    return this.ChildWidgets[i]._GetLineWidget(point);
            }
            var lineWidget = null;
            if (this.ChildWidgets.length > 0) {
                if (this.ChildWidgets[0].Y <= point.Y)
                    lineWidget = this.ChildWidgets[this.ChildWidgets.length - 1]._GetLineWidget(point);
                else
                    lineWidget = this.ChildWidgets[0]._GetLineWidget(point);
            }
            return lineWidget;
        };
        TableCellWidget.prototype._UpdateCellVerticalPosition = function (isUpdateToTop, isInsideTable) {
            if (this.TableCell.OwnerTable.Owner instanceof SectionAdv || isInsideTable) {
                var displacement = this._GetDisplacement(isUpdateToTop);
                this._UpdateCellContentVerticalPosition(displacement, isUpdateToTop);
            }
        };
        TableCellWidget.prototype._GetDisplacement = function (isUpdateToTop) {
            var rowHeight = 0;
            var rowWidget = this.ContainerWidget;
            var padding = this.Margin.Top + this.Margin.Bottom;
            if (this.TableCell != null && this.TableCell.CellFormat != null && this.TableCell.CellFormat.RowSpan > 1)
                rowHeight = this.Height;
            else
                rowHeight = ((rowWidget != null ? rowWidget.Height : 0) - padding);
            var cellContentHeight = this._GetCellContentHeight();
            var displacement = 0;
            if (rowHeight > cellContentHeight) {
                displacement = rowHeight - cellContentHeight;
                if (this.TableCell.CellFormat.VerticalAlignment == CellVerticalAlignment.Center)
                    displacement = displacement / 2;
                else if ((this.TableCell.CellFormat.VerticalAlignment == CellVerticalAlignment.Top || isUpdateToTop))
                    displacement = 0;
            }
            return displacement;
        };
        TableCellWidget.prototype._GetCellContentHeight = function () {
            if (this.ChildWidgets == null)
                return 0;
            var contentHeight = 0;
            for (var i = 0; i < this.ChildWidgets.Count; i++) {
                if (this.ChildWidgets[i] instanceof ParagraphWidget)
                    contentHeight += this.ChildWidgets[i].Height;
                else if (this.ChildWidgets[i] instanceof TableWidget)
                    contentHeight += this.ChildWidgets[i].Height;
            }
            return contentHeight;
        };
        TableCellWidget.prototype._UpdateCellContentVerticalPosition = function (displacement, isUpdateToTop) {
            if (displacement == 0)
                return;
            var location = this.Y + displacement;
            for (var i = 0; i < this.ChildWidgets.Count; i++) {
                if (this.ChildWidgets[i] instanceof ParagraphWidget)
                    this.ChildWidgets[i].Y = location;
                else if (this.ChildWidgets[i] instanceof TableWidget)
                    location = this._UpdateTableWidgetLocation(this.ChildWidgets[i], location, isUpdateToTop);
                location = location + this.ChildWidgets[i].Height;
            }
        };
        TableCellWidget.prototype._UpdateTableWidgetLocation = function (tableWidget, location, isUpdateToTop) {
            tableWidget.Y = location = location + tableWidget.TopBorderWidth;
            var cellSpacing = 0;
            for (var i = 0; i < tableWidget.ChildWidgets.Count; i++) {
                var rowWidget = tableWidget.ChildWidgets[i];
                rowWidget.Y = location;
                for (var j = 0; j < rowWidget.ChildWidgets.Count; j++) {
                    var cellWidget = rowWidget.ChildWidgets[j];
                    cellWidget.Y = location + cellWidget.Margin.Top + cellSpacing;
                    ;
                    cellWidget._UpdateCellVerticalPosition(isUpdateToTop, true);
                }
                location = location + rowWidget.Height;
            }
            return location;
        };
        TableCellWidget.prototype._UpdateWidgetHeight = function () {
            if (this.ChildWidgets.Count > 0) {
                var lastWidget = this.ChildWidgets[this.ChildWidgets.Count - 1];
                this.Height = lastWidget.Y + lastWidget.Height - this.Y;
            }
        };
        TableCellWidget.prototype._RenderTableCellOutline = function (context) {
            var borders = null;
            var TableCell = this.TableCell;
            var cellTopMargin = 0;
            var cellBottomMargin = 0;
            var cellLeftMargin = 0, cellRightMargin = 0, height = 0;
            borders = TableCell.CellFormat.Borders;
            cellBottomMargin = TableCell.BottomMargin;
            cellTopMargin = TableCell.TopMargin;
            cellLeftMargin = TableCell.LeftMargin;
            cellRightMargin = TableCell.RightMargin;
            if (TableCell.OwnerRow != null && TableCell.OwnerRow.RowFormat.HeightType == HeightType.Exactly)
                height = TableCell.OwnerRow.RowFormat.Height + cellTopMargin + cellBottomMargin;
            else {
                if (TableCell.OwnerRow != null && TableCell.OwnerRow.TableRowWidgets.Count <= 1) {
                    height = Math.max(TableCell.OwnerRow.RowFormat.Height, this.Height) + cellTopMargin + cellBottomMargin;
                }
                else
                    height = this.Height + cellTopMargin + cellBottomMargin;
            }
            var border = borders._GetCellLeftBorder(TableCell);
            var lineWidth = 0;
            if (border != null) {
                lineWidth = border._GetLineWidth();
                this._RenderSingleBorder(context, border, this.X - cellLeftMargin - lineWidth / 2, this.Y - cellTopMargin, this.X - cellLeftMargin - lineWidth / 2, this.Y + this.Height + cellBottomMargin, lineWidth);
            }
            border = borders._GetCellTopBorder(TableCell);
            if (border != null) {
                lineWidth = border._GetLineWidth();
                this._RenderSingleBorder(context, border, this.X - this.Margin.Left, this.Y - this.Margin.Top + lineWidth / 2, this.X + this.Width + this.Margin.Right, this.Y - this.Margin.Top + lineWidth / 2, lineWidth);
            }
            if (TableCell.OwnerTable.TableFormat.CellSpacing > 0 || TableCell.CellIndex == TableCell.OwnerRow.Cells.Count - 1) {
                border = borders._GetCellRightBorder(TableCell);
                if (border != null) {
                    lineWidth = border._GetLineWidth();
                    this._RenderSingleBorder(context, border, this.X + this.Width + this.Margin.Right - lineWidth / 2, this.Y - cellTopMargin, this.X + this.Width + this.Margin.Right - lineWidth / 2, this.Y + this.Height + cellBottomMargin, lineWidth);
                }
            }
            var nextRow = TableCell.OwnerRow.NextNode;
            var nextRowIsInCurrentTableWidget = false;
            if (nextRow != null) {
                var nextRowWidget = null;
                if (nextRow.TableRowWidgets != null && nextRow.TableRowWidgets.Count > 0)
                    nextRowWidget = nextRow.TableRowWidgets[0];
                if (nextRowWidget instanceof TableRowWidget) {
                    if (this.ContainerWidget instanceof TableRowWidget && this.ContainerWidget instanceof TableWidget)
                        nextRowIsInCurrentTableWidget = this.ContainerWidget.ChildWidgets._Contains(nextRowWidget);
                }
            }
            if (TableCell.OwnerTable.TableFormat.CellSpacing > 0 || TableCell.OwnerRow.RowIndex == TableCell.OwnerTable.Rows.Count - 1 ||
                (TableCell.CellFormat.RowSpan > 1 && TableCell.OwnerRow.RowIndex + TableCell.CellFormat.RowSpan == TableCell.OwnerTable.Rows.Count) ||
                !nextRowIsInCurrentTableWidget) {
                border = (TableCell.CellFormat.RowSpan > 1 && TableCell.OwnerRow.RowIndex + TableCell.CellFormat.RowSpan == TableCell.OwnerTable.Rows.Count) ?
                    borders._GetBorderBasedOnPriority(TableCell.CellFormat.Borders.Bottom, TableCell.OwnerTable.TableFormat.Borders._GetCellBottomBorder(TableCell))
                    : borders._GetCellBottomBorder(TableCell);
                if (border != null) {
                    lineWidth = border._GetLineWidth();
                    this._RenderSingleBorder(context, border, this.X - this.Margin.Left, this.Y + this.Height + cellBottomMargin + lineWidth / 2, this.X + this.Width + this.Margin.Right, this.Y + this.Height + cellBottomMargin + lineWidth / 2, lineWidth);
                }
            }
            border = borders._GetCellDiagonalUpBorder(TableCell);
            if (border != null) {
                lineWidth = border._GetLineWidth();
                if (lineWidth > 0)
                    this._RenderSingleBorder(context, border, this.X - cellLeftMargin, this.Y + this.Height + cellBottomMargin, this.X + this.Width + cellRightMargin, this.Y - cellTopMargin, lineWidth);
            }
            border = borders._GetCellDiagonalDownBorder(TableCell);
            if (border != null) {
                lineWidth = border._GetLineWidth();
                if (lineWidth > 0)
                    this._RenderSingleBorder(context, border, this.X - cellLeftMargin, this.Y - cellTopMargin, this.X + this.Width + cellRightMargin, this.Y + this.Height + cellBottomMargin, lineWidth);
            }
            this._RenderCellBackground(context, height);
        };
        TableCellWidget.prototype._RenderCellBackground = function (context, height) {
            var cellFormat = this.CurrentNode.CellFormat;
            var bgColor = cellFormat.Shading.BackgroundColor;
            if (bgColor != "empty") {
                context.fillStyle = bgColor;
                context.fillRect(this.X - this.Margin.Left + this.LeftBorderWidth, this.Y - this.TableCell.TopMargin, this.Width + this.Margin.Left + this.Margin.Right - this.LeftBorderWidth - this.RightBorderWidth, height);
                context.fill();
            }
        };
        TableCellWidget.prototype._UpdateTableRowWidget = function (rowWidget, index) {
            if (this.ContainerWidget != null) {
                this.ContainerWidget.ChildWidgets._Remove(this);
                if ((this.ContainerWidget.ChildWidgets == null || this.ContainerWidget.ChildWidgets.Count == 0)
                    && this.ContainerWidget instanceof TableRowWidget)
                    this.ContainerWidget._Dispose();
            }
            rowWidget.ChildWidgets._Insert(index, this);
            this.ContainerWidget = rowWidget;
        };
        TableCellWidget.prototype._Highlight = function (selection, selectionRange) {
            this._ClearChildSelectionHighlight(selection.OwnerControl.Viewer);
            selection._CreateHighlightBorderInsideTable(this, selection, selectionRange);
        };
        TableCellWidget.prototype._ClearSelectionHighlight = function (viewer) {
            if (viewer == null)
                return;
            if (viewer.OwnerControl != null && viewer.OwnerControl.Selection.SelectionRanges.Count > 0) {
                viewer.OwnerControl.Selection.SelectionRanges._ClearSelectionHighlightInternal(this);
            }
        };
        TableCellWidget.prototype._GetTableWidget = function (point) {
            for (var i = 0; i < this.ChildWidgets.Count; i++) {
                if ((this.ChildWidgets[i] instanceof TableWidget) && this.ChildWidgets[i].Y <= point.Y
                    && (this.ChildWidgets[i].Y + this.ChildWidgets[i].Height) >= point.Y)
                    return this.ChildWidgets[i];
            }
            return null;
        };
        TableCellWidget.prototype._GetTableCellWidget = function (point, pageLayout) {
            for (var i = 0; i < this.ChildWidgets.Count; i++) {
                if (this.ChildWidgets[i].Y <= point.Y
                    && (this.ChildWidgets[i].Y + this.ChildWidgets[i].Height) >= point.Y)
                    return this.ChildWidgets[i]._GetTableCellWidget(point, pageLayout);
            }
            var tableCellWidget = null;
            if (this.ChildWidgets.Count > 0 && pageLayout) {
                if (this.ChildWidgets[0].Y <= point.Y)
                    tableCellWidget = this.ChildWidgets[this.ChildWidgets.Count - 1]._GetTableCellWidget(point, pageLayout);
                else
                    tableCellWidget = this.ChildWidgets[0]._GetTableCellWidget(point, pageLayout);
            }
            return tableCellWidget;
        };
        TableCellWidget.prototype._Dispose = function () {
            var viewer = null;
            var page = this._GetPage();
            if (page != null)
                viewer = page.Viewer;
            if (this.ChildWidgets != null) {
                for (var i = 0; i < this.ChildWidgets.Count; i++) {
                    var widget = this.ChildWidgets[i];
                    if (widget instanceof ParagraphWidget)
                        widget._Dispose();
                    else
                        widget._Dispose();
                    if (this.ChildWidgets == null)
                        break;
                    this.ChildWidgets._Remove(widget);
                    i--;
                }
                this.ChildWidgets = null;
            }
            this._ClearSelectionHighlight(viewer);
            if (this.ContainerWidget != null) {
                if (this.ContainerWidget.ChildWidgets != null)
                    this.ContainerWidget.ChildWidgets._Remove(this);
                this.ContainerWidget = null;
            }
            if (this.TableCell != null) {
                if (this.TableCell.TableCellWidgets != null)
                    this.TableCell.TableCellWidgets._Remove(this);
                this.TableCell = null;
            }
        };
        return TableCellWidget;
    }(Widget));
    DocumentEditorFeatures.TableCellWidget = TableCellWidget;
    var ParagraphWidget = (function (_super) {
        __extends(ParagraphWidget, _super);
        function ParagraphWidget(node) {
            _super.call(this);
            this.CurrentNode = node;
        }
        ParagraphWidget.prototype._renderComment = function (page, left, top) {
            if (this.ContainerWidget instanceof CommentWidget) {
                var sectionFormat = this.CurrentNode.Section.SectionFormat;
                top = top + this.Y;
                left = this.X + sectionFormat.PageWidth;
            }
            for (var i = 0; i < this.ChildWidgets.length; i++) {
                var widget = this.ChildWidgets[i];
                widget._render(page, left, top);
                top += widget.Height;
            }
        };
        ParagraphWidget.prototype._renderCommentCanvas = function (canvas, left, top) {
            if (this.ContainerWidget instanceof CommentWidget) {
                var sectionFormat = this.CurrentNode.Section.SectionFormat;
                top = top + this.Y;
                left = this.X + sectionFormat.PageWidth;
            }
            for (var i = 0; i < this.ChildWidgets.length; i++) {
                var widget = this.ChildWidgets[i];
                widget._renderCanvas(canvas, left, top);
                top += widget.Height;
            }
        };
        ParagraphWidget.prototype._render = function (page) {
            var top = this.Y;
            var left = this.X;
            for (var i = 0; i < this.ChildWidgets.length; i++) {
                var widget = this.ChildWidgets[i];
                widget._render(page, left, top);
                top += widget.Height;
            }
        };
        ParagraphWidget.prototype._renderCanvas = function (canvas) {
            var top = this.Y;
            var left = this.X;
            for (var i = 0; i < this.ChildWidgets.length; i++) {
                var widget = this.ChildWidgets[i];
                widget._renderCanvas(canvas, left, top);
                top += widget.Height;
            }
        };
        ParagraphWidget.prototype._Render = function (viewer) {
            var layoutType = LayoutType.Continuous;
            layoutType = viewer.OwnerControl.LayoutType;
            var top = this.Y;
            if (layoutType == LayoutType.Continuous
                && (viewer.CurrentPage.BoundingRectangle.Top > (top + this.Height) * viewer.ZoomFactor
                    || viewer.CurrentPage.BoundingRectangle.Bottom < top * viewer.ZoomFactor))
                return viewer.VisibleBounds.Bottom < top * viewer.ZoomFactor;
            var page = viewer.CurrentPage;
            for (var i = 0; i < this.ChildWidgets.Count; i++) {
                if (!(viewer.CurrentPage.BoundingRectangle.Top > (top + this.ChildWidgets[i].Height) * viewer.ZoomFactor
                    || viewer.CurrentPage.BoundingRectangle.Bottom < top * viewer.ZoomFactor))
                    this.ChildWidgets[i]._render(page, this.X, top);
                top += this.ChildWidgets[i].Height;
            }
        };
        ParagraphWidget.prototype._IsFirstLineFit = function (bottom) {
            var lineWidget = this.ChildWidgets[0];
            if (lineWidget.CurrentParagraphWidget.ContainerWidget instanceof TableCellWidget) {
                var cellwidget = lineWidget.CurrentParagraphWidget.ContainerWidget;
                var document_10 = null;
                if (lineWidget.CurrentParagraphWidget.CurrentNode != null && cellwidget.ContainerWidget != null)
                    document_10 = lineWidget.CurrentParagraphWidget.CurrentNode._GetOwnerDocument();
                if (document_10 != null && document_10.OwnerControl != null && cellwidget.ContainerWidget.Y == document_10.OwnerControl.Viewer.ClientArea.Y && this.Y + lineWidget.Height >= bottom)
                    return true;
            }
            return (this.Y + lineWidget.Height <= bottom);
        };
        ParagraphWidget.prototype._GetSplittedWidget = function (bottom) {
            var lineBottom = this.Y;
            var splittedWidget = null;
            for (var i = 0; i < this.ChildWidgets.length; i++) {
                var lineWidget = this.ChildWidgets[i];
                if (bottom < lineBottom + lineWidget.Height) {
                    if (i == 0) {
                        if (lineWidget.CurrentParagraphWidget.ContainerWidget instanceof TableCellWidget) {
                            if (lineWidget.CurrentParagraphWidget.ContainerWidget.Y == this.Y) {
                                lineBottom += lineWidget.Height;
                                continue;
                            }
                        }
                        splittedWidget = this;
                        break;
                    }
                    if (this.ChildWidgets._Contains(lineWidget)) {
                        this.ChildWidgets._Remove(lineWidget);
                        i--;
                    }
                    this.Height -= lineWidget.Height;
                    if (splittedWidget == null) {
                        splittedWidget = new ParagraphWidget(this.CurrentNode);
                        splittedWidget._UpdateWidgetLocation(this);
                        var paragraph = this.CurrentNode;
                        paragraph.ParagraphWidgets._Add(splittedWidget);
                        splittedWidget.Height = lineWidget.Height;
                    }
                    else
                        splittedWidget.Height += lineWidget.Height;
                    splittedWidget.ChildWidgets._Add(lineWidget);
                    lineWidget.CurrentParagraphWidget = splittedWidget;
                }
                lineBottom += lineWidget.Height;
            }
            return splittedWidget;
        };
        ParagraphWidget.prototype._GetLineWidget = function (point) {
            var top = this.Y;
            for (var i = 0; i < this.ChildWidgets.length; i++) {
                if (top <= point.Y
                    && (top + this.ChildWidgets[i].Height) >= point.Y) {
                    return this.ChildWidgets[i];
                }
                top += this.ChildWidgets[i].Height;
            }
            var lineWidget = null;
            if (this.ChildWidgets.length > 0) {
                if (this.Y <= point.Y)
                    lineWidget = this.ChildWidgets[this.ChildWidgets.length - 1];
                else
                    lineWidget = this.ChildWidgets[0];
            }
            return lineWidget;
        };
        ParagraphWidget.prototype._IsFitInClientArea = function (viewer) {
            var lastLine = this.ChildWidgets[this.ChildWidgets.Count - 1];
            var height = this.Height;
            var maxElementHeight = lastLine._GetMaxElementHeight();
            if (lastLine.Height > maxElementHeight)
                height -= lastLine.Height - maxElementHeight;
            return viewer.ClientActiveArea.Height >= height;
        };
        ParagraphWidget.prototype._SplitWidget = function (viewer, prevBodyWidget, index) {
            var firstLine = this.ChildWidgets[0];
            var maxElementHeight = firstLine._GetMaxElementHeight();
            var nextBodyWidget = this.ContainerWidget;
            if (viewer.ClientActiveArea.Height >= maxElementHeight) {
                var splittedWidget = null;
                var widgetIndex = this.CurrentNode.ParagraphWidgets._IndexOf(this);
                if (widgetIndex < (this.CurrentNode.ParagraphWidgets.Count - 1)) {
                    splittedWidget = this.CurrentNode.ParagraphWidgets[widgetIndex + 1];
                    nextBodyWidget = splittedWidget.ContainerWidget;
                }
                else {
                    splittedWidget = new ParagraphWidget(this.CurrentNode);
                    splittedWidget.Width = this.Width;
                    splittedWidget.X = this.X;
                    splittedWidget.Y = this.Y;
                    this.CurrentNode.ParagraphWidgets._Add(splittedWidget);
                }
                if (prevBodyWidget != this.ContainerWidget)
                    this._UpdateContainerWidget(prevBodyWidget, index);
                for (var i = this.ChildWidgets.Count - 1; i > 0; i--) {
                    if (this._IsFitInClientArea(viewer))
                        break;
                    else {
                        var line = this.ChildWidgets[i];
                        line._UpdateParagraphWidget(splittedWidget, 0);
                    }
                }
                if (splittedWidget.ContainerWidget == null) {
                    var y = viewer.ClientActiveArea.Y;
                    nextBodyWidget = prevBodyWidget._CreateOrGetNextBodyWiget(viewer);
                    nextBodyWidget.ChildWidgets._Insert(0, splittedWidget);
                    nextBodyWidget.Height += splittedWidget.Height;
                    splittedWidget.ContainerWidget = nextBodyWidget;
                    if (nextBodyWidget.ChildWidgets.Count == 1) {
                        this.X = this.X;
                        this.Y = y;
                        return true;
                    }
                }
            }
            else {
                nextBodyWidget = prevBodyWidget._CreateOrGetNextBodyWiget(viewer);
                if (this.ContainerWidget != nextBodyWidget)
                    this._UpdateContainerWidget(nextBodyWidget, 0);
            }
            if (prevBodyWidget == this.ContainerWidget) {
                this.Y = viewer.ClientActiveArea.Y;
                viewer._CutFromTop(viewer.ClientActiveArea.Y + this.Height);
            }
            else
                viewer._UpdateClientArea(nextBodyWidget.CurrentNode.SectionFormat);
            return false;
        };
        ParagraphWidget.prototype._ShiftToPreviousWidget = function (viewer, prevWidget) {
            for (var i = 0; i < this.ChildWidgets.Count; i++) {
                var line = this.ChildWidgets[i];
                var maxElementHeight = line._GetMaxElementHeight();
                if (viewer.ClientActiveArea.Height >= maxElementHeight) {
                    line._UpdateParagraphWidget(prevWidget, prevWidget.ChildWidgets.Count);
                    if (this.ChildWidgets == null)
                        break;
                    i--;
                    viewer._CutFromTop(viewer.ClientActiveArea.Y + line.Height);
                }
                else {
                    var bodyWidget = prevWidget.ContainerWidget;
                    var nextBodyWidget = bodyWidget._CreateOrGetNextBodyWiget(viewer);
                    if (bodyWidget != nextBodyWidget)
                        this._UpdateContainerWidget(nextBodyWidget, 0);
                    viewer._UpdateClientArea(nextBodyWidget.CurrentNode.SectionFormat);
                    break;
                }
            }
        };
        ParagraphWidget.prototype._ShiftChildsToWidget = function (destinationWidget) {
            for (var i = 0; i < this.ChildWidgets.Count; i++) {
                var line = this.ChildWidgets[i];
                line._UpdateParagraphWidget(destinationWidget, destinationWidget.ChildWidgets.Count);
                if (this.ChildWidgets == null)
                    break;
                i--;
            }
        };
        ParagraphWidget.prototype._Highlight = function (selection, selectionRange, startIndex, endLine, endElement, endIndex) {
            var top = 0;
            for (var i = startIndex; i < this.ChildWidgets.length; i++) {
                var line = this.ChildWidgets[i];
                if (i == startIndex)
                    top = line._GetTop();
                var left = line._GetLeft();
                if (line == endLine) {
                    var right = endLine._GetLeftInternal(endElement, endIndex);
                    selection._CreateHighlightBorder(selectionRange, line, right - left, left, top);
                    return;
                }
                selection._CreateHighlightBorder(selectionRange, line, line._GetWidth(true) - (left - this.X), left, top);
                top += line.Height;
            }
        };
        ParagraphWidget.prototype._HighlightSearchResult = function (searchResult, startIndex, endLine, endElement, endIndex) {
            var top = 0;
            for (var i = startIndex; i < this.ChildWidgets.Count; i++) {
                var line = this.ChildWidgets[i];
                if (i == startIndex)
                    top = line._GetTop();
                var left = line._GetLeft();
                if (line == endLine) {
                    var right = endLine._GetLeftInternal(endElement, endIndex);
                    searchResult._CreateHighlightBorder(line, right - left, left, top);
                    return;
                }
                searchResult._CreateHighlightBorder(line, line._GetWidth(true) - (left - this.X), left, top);
                top += line.Height;
            }
        };
        ParagraphWidget.prototype._GetTableCellWidget = function (point, pageLayout) {
            return null;
        };
        ParagraphWidget.prototype._Dispose = function () {
            var height = this.Height;
            if (this.ChildWidgets != null) {
                for (var i = 0; i < this.ChildWidgets.Count; i++) {
                    var widget = this.ChildWidgets[i];
                    widget._Dispose();
                    if (this.ChildWidgets == null)
                        break;
                    this.ChildWidgets._Remove(widget);
                    i--;
                }
                this.ChildWidgets = null;
            }
            if (this.CurrentNode != null) {
                if (this.CurrentNode.ParagraphWidgets != null)
                    this.CurrentNode.ParagraphWidgets._Remove(this);
                this.CurrentNode = null;
            }
            if (this.ContainerWidget != null) {
                this.ContainerWidget.ChildWidgets._Remove(this);
                this.ContainerWidget.Height -= height;
                if ((this.ContainerWidget.ChildWidgets == null || this.ContainerWidget.ChildWidgets.Count == 0)
                    && this.ContainerWidget instanceof BodyWidget)
                    this.ContainerWidget._Dispose();
                this.ContainerWidget = null;
            }
        };
        return ParagraphWidget;
    }(Widget));
    DocumentEditorFeatures.ParagraphWidget = ParagraphWidget;
    var LineWidget = (function () {
        function LineWidget(paragraphWidget) {
            this.X = 0;
            this.Y = 0;
            this.Width = 0;
            this.Height = 0;
            this.Children = null;
            this.CurrentParagraphWidget = paragraphWidget;
            this.Children = new List();
        }
        LineWidget.prototype._IsParagraphFirstLine = function () {
            if (this == this.CurrentParagraphWidget.ChildWidgets[0])
                return true;
            return false;
        };
        LineWidget.prototype._render = function (page, left, top) {
            if (page == null || page.Viewer == null)
                return;
            var backgroundContainer = document.getElementById(page.Id + "_background");
            var foregroundContainer = document.getElementById(page.Id + "_foreground");
            var selectionContainer = document.getElementById(page.Id + "_selection");
            var inline, paraFormat;
            if (backgroundContainer == null) {
                return;
            }
            var backgroundContext = backgroundContainer.getContext("2d");
            var foregroundContext = foregroundContainer.getContext("2d");
            var selectionContext = selectionContainer.getContext("2d");
            if (page.Viewer.OwnerControl.Selection.SelectionRanges.Count > 0)
                page.Viewer.OwnerControl.Selection.SelectionRanges._AddSelectionHighlight(selectionContext, this, top);
            if (page.Viewer.ImageResizer.SelectedImageWidget.Count > 0)
                page.Viewer.ImageResizer._ReDrawImageResizer(this, page);
            if (page.Viewer.SearchHighlighters != null && page.Viewer.SearchHighlighters._ContainsKey(this)) {
                var widget = this;
                var widgetInfo = page.Viewer.SearchHighlighters._Get(widget);
                for (var i = 0; i < widgetInfo.Count; i++) {
                    backgroundContext.fillStyle = "#ffe97f";
                    backgroundContext.fillRect(widgetInfo[i].Left, top, widgetInfo[i].Width, widget.Height);
                }
            }
            if (page != null && page.Viewer != null && page.Viewer instanceof PageLayoutViewer) {
                if (page.Viewer.CommentRangeWidget != null && page.Viewer.CommentRangeWidget.CurrentWidget == this) {
                    if (page.Viewer.CommentRangeWidget.CommentRangeMarker != null && page.Viewer.CommentRangeWidget.CommentRangeLinker != null) {
                        selectionContext.beginPath();
                        selectionContext.moveTo(page.Viewer.CommentRangeWidget.CommentRangeMarker.X1, page.Viewer.CommentRangeWidget.CommentRangeMarker.Y1 + 0.5);
                        selectionContext.lineTo(page.Viewer.CommentRangeWidget.CommentRangeMarker.X2, page.Viewer.CommentRangeWidget.CommentRangeMarker.Y2 + 0.5);
                        selectionContext.moveTo(page.Viewer.CommentRangeWidget.CommentRangeLinker.X1, page.Viewer.CommentRangeWidget.CommentRangeLinker.Y1 + 0.5);
                        selectionContext.lineTo(page.Viewer.CommentRangeWidget.CommentRangeLinker.X2, page.Viewer.CommentRangeWidget.CommentRangeLinker.Y2 + 0.5);
                        selectionContext.strokeStyle = "#19c7ff";
                        selectionContext.lineWidth = 0.5;
                        selectionContext.globalAlpha = 1;
                        selectionContext.stroke();
                        selectionContext.closePath();
                    }
                }
            }
            if (page.Viewer.SelectedCommentRangeWidget != null && page.Viewer.SelectedCommentRangeWidget._ContainsKey(this)) {
                var selectionWidget = page.Viewer.SelectedCommentRangeWidget._Get(this);
                var _left = selectionWidget.Left;
                var _width = selectionWidget.Width;
                selectionContext.fillStyle = "#67CCEC";
                selectionContext.globalAlpha = 0.4;
                selectionContext.fillRect(_left, top, _width, this.Height);
            }
            if (this._IsParagraphFirstLine())
                left += this.CurrentParagraphWidget.CurrentNode.ParagraphFormat.FirstLineIndent;
            for (var i = 0; i < this.Children.Count; i++) {
                var elementBox = this.Children[i];
                var underlineY = this._getUnderlineYposition();
                if (elementBox instanceof CommentElementBox) {
                    elementBox._renderComment(page);
                }
                else
                    elementBox._render(foregroundContext, backgroundContext, left, top, underlineY);
                left += elementBox.Width + elementBox.Margin.Left;
                if (page.Viewer instanceof FlowLayoutViewer && page.Viewer.OwnerControl.Selection.IsCleared && page.Viewer.OwnerControl.Selection.Start != null)
                    page.Viewer.OwnerControl.Selection._FireSelectionChanged(true);
            }
        };
        LineWidget.prototype._renderCanvas = function (canvas, left, top) {
            if (canvas == null) {
                return;
            }
            if (this._IsParagraphFirstLine())
                left += this.CurrentParagraphWidget.CurrentNode.ParagraphFormat.FirstLineIndent;
            var context = canvas.getContext("2d");
            for (var i = 0; i < this.Children.Count; i++) {
                var elementBox = this.Children[i];
                var underlineY = this._getUnderlineYposition();
                if (elementBox instanceof CommentElementBox) {
                    elementBox._renderCanvas(canvas);
                }
                else if (elementBox instanceof ImageElementBox) {
                    elementBox._renderCanvas(context, context, left, top, underlineY);
                }
                else
                    elementBox._render(context, context, left, top, underlineY);
                left += elementBox.Width + elementBox.Margin.Left;
            }
        };
        LineWidget.prototype._getUnderlineYposition = function () {
            var height = 0;
            var lineHeight = 0;
            if (this.Children.Count == 0 || ((this.Children.Count == 1 && this.Children[0] instanceof ListTextElementBox) || (this.Children.Count == 2 && this.Children[0] instanceof ListTextElementBox && this.Children[1] instanceof ListTextElementBox)))
                return 0;
            else {
                for (var i = 0; i < this.Children.Count; i++) {
                    if (height < this.Children[i].Height) {
                        height = this.Children[0].Margin.Top + this.Children[0].Height;
                        lineHeight = this.Children[0].Height / 20;
                    }
                }
            }
            return height - 2 * lineHeight;
        };
        LineWidget.prototype._GetLeft = function () {
            var left = this.CurrentParagraphWidget.X;
            var paragraphFormat = this.CurrentParagraphWidget.CurrentNode.ParagraphFormat;
            if (this._IsParagraphFirstLine() && !(paragraphFormat.TextAlignment == TextAlignment.Right))
                left += paragraphFormat.FirstLineIndent;
            if (paragraphFormat.TextAlignment == TextAlignment.Center)
                left -= (paragraphFormat.FirstLineIndent / 2);
            for (var i = 0; i < this.Children.Count; i++) {
                var element = this.Children[i];
                if (element instanceof ListTextElementBox) {
                    if (i == 0)
                        left += element.Margin.Left + element.Width;
                    else
                        left += element.Width;
                }
                else {
                    left += element.Margin.Left;
                    break;
                }
            }
            return left;
        };
        LineWidget.prototype._GetLeftInternal = function (elementBox, index) {
            var left = this.CurrentParagraphWidget.X;
            if (this._IsParagraphFirstLine())
                left += this.CurrentParagraphWidget.CurrentNode.ParagraphFormat.FirstLineIndent;
            var count = this.Children._IndexOf(elementBox);
            for (var i = 0; i < count; i++) {
                left += this.Children[i].Margin.Left + this.Children[i].Width;
            }
            if (elementBox != null)
                left += elementBox.Margin.Left;
            if (elementBox instanceof TextElementBox) {
                if (index == elementBox.Length)
                    left += elementBox.Width;
                else if (index > elementBox.Length)
                    left += elementBox.Width + TextHelper._GetParagraphMarkSize(elementBox.Inline.OwnerParagraph.CharacterFormat).Width;
                else
                    left += TextHelper._GetWidth(elementBox.Text.substr(0, index), elementBox.Inline.CharacterFormat);
            }
            else if (index > 0) {
                if (elementBox != null) {
                    left += elementBox.Width;
                    if (index == 2)
                        left += TextHelper._GetParagraphMarkSize(elementBox.Inline.OwnerParagraph.CharacterFormat).Width;
                }
                else
                    left += TextHelper._GetParagraphMarkSize(this.CurrentParagraphWidget.CurrentNode.CharacterFormat).Width;
            }
            return left;
        };
        LineWidget.prototype._GetLineStartLeft = function () {
            var left = this.CurrentParagraphWidget.X;
            if (this._IsParagraphFirstLine())
                left += this.CurrentParagraphWidget.CurrentNode.ParagraphFormat.FirstLineIndent;
            if (this.Children.Count > 0)
                left += this.Children[0].Margin.Left;
            return left;
        };
        LineWidget.prototype._GetTop = function () {
            var top = this.CurrentParagraphWidget.Y;
            var count = this.CurrentParagraphWidget.ChildWidgets._IndexOf(this);
            for (var i = 0; i < count; i++) {
                top += this.CurrentParagraphWidget.ChildWidgets[i].Height;
            }
            return top;
        };
        LineWidget.prototype._UpdateTextPosition = function (rte, point, clearMultiSelection) {
            var caretPosition = point;
            var inline = null;
            var index = 0;
            var isImageSelected = false;
            var isImageSelectedObj = this._UpdateTextPositionInternal(rte, inline, index, caretPosition, false);
            if (isImageSelectedObj != null) {
                inline = isImageSelectedObj.inline;
                index = isImageSelectedObj.index;
                caretPosition = isImageSelectedObj.caretPosition;
                isImageSelected = isImageSelectedObj.isImageSelected;
            }
            if (isImageSelected) {
                rte.Selection._Select(this.CurrentParagraphWidget.CurrentNode, inline, index, caretPosition, true);
                if (index == 0)
                    rte.Selection._ExtendForward(false);
                else
                    rte.Selection._ExtendBackward(false);
            }
            else
                rte.Selection._Select(this.CurrentParagraphWidget.CurrentNode, inline, index, caretPosition, clearMultiSelection);
        };
        LineWidget.prototype._UpdateTextPositionInternal = function (rte, inline, index, caretPosition, includeParagraphMark) {
            var isImageSelected = false;
            var top = this._GetTop();
            var left = this.CurrentParagraphWidget.X;
            var elementValues = this._GetFirstElement(left);
            var element = elementValues.element;
            left = elementValues.left;
            if (element == null) {
                var topMargin = 0;
                var bottomMargin = 0;
                var size = this.CurrentParagraphWidget.CurrentNode._GetParagraphMarkSize(topMargin, bottomMargin);
                topMargin = size.TopMargin;
                bottomMargin = size.BottomMargin;
                if (includeParagraphMark && caretPosition.X > left + size.Width / 2) {
                    left += size.Width;
                    if (this.CurrentParagraphWidget.CurrentNode.Inlines.Count > 0) {
                        inline = this.CurrentParagraphWidget.CurrentNode.Inlines[this.CurrentParagraphWidget.CurrentNode.Inlines.Count - 1];
                        index = inline.Length;
                    }
                    index++;
                }
                caretPosition = new Point(left, topMargin > 0 ? top + topMargin : top);
            }
            else {
                if (element != null) {
                    if (caretPosition.X > left + element.Margin.Left) {
                        for (var i = this.Children._IndexOf(element); i < this.Children.Count; i++) {
                            element = this.Children[i];
                            if (caretPosition.X < left + element.Margin.Left + element.Width || i == this.Children.Count - 1)
                                break;
                            left += element.Margin.Left + element.Width;
                        }
                        if (caretPosition.X > left + element.Margin.Left + element.Width) {
                            index = element instanceof TextElementBox ? this._GetTextLength(element) + element.Length : 1;
                            left += element.Margin.Left + element.Width;
                        }
                        else if (element instanceof TextElementBox) {
                            var x = caretPosition.X - left - element.Margin.Left;
                            left += element.Margin.Left;
                            var prevWidth = 0;
                            var charIndex = 0;
                            for (var i = 1; i <= element.Length; i++) {
                                var width = 0;
                                if (i == element.Length)
                                    width = element.Width;
                                else
                                    width = TextHelper._GetWidth(element.Text.substr(0, i), element.Inline.CharacterFormat);
                                if (x < width || i == element.Length) {
                                    var charWidth = width - prevWidth;
                                    if (x - prevWidth > charWidth / 2) {
                                        left += width;
                                        charIndex = i;
                                    }
                                    else {
                                        left += prevWidth;
                                        charIndex = i - 1;
                                        if (i == 1 && element != this.Children[0]) {
                                            var curIndex = this.Children._IndexOf(element);
                                            if (!(this.Children[curIndex - 1] instanceof ListTextElementBox)) {
                                                element = this.Children[curIndex - 1];
                                                charIndex = element instanceof TextElementBox ? element.Length : 1;
                                            }
                                        }
                                    }
                                    break;
                                }
                                prevWidth = width;
                            }
                            index = this._GetTextLength(element) + charIndex;
                        }
                        else {
                            isImageSelected = element instanceof ImageElementBox;
                            if (caretPosition.X - left - element.Margin.Left > element.Width / 2) {
                                index = 1;
                                left += element.Margin.Left + element.Width;
                            }
                            else if (element != this.Children[0] && !isImageSelected) {
                                var curIndex = this.Children._IndexOf(element);
                                if (!(this.Children[curIndex - 1] instanceof ListTextElementBox)) {
                                    element = this.Children[curIndex - 1];
                                    index = element instanceof TextElementBox ? this._GetTextLength(element) + element.Length : 1;
                                }
                            }
                        }
                    }
                    else {
                        left += element.Margin.Left;
                        index = this._GetTextLength(element);
                    }
                    if (element instanceof TextElementBox)
                        top += element.Margin.Top > 0 ? element.Margin.Top : 0;
                    else {
                        var textMetrics = TextHelper._MeasureText("a", element.Inline.CharacterFormat);
                        var height = textMetrics.Height;
                        var baselineOffset = textMetrics.BaselineOffset;
                        top += element.Margin.Top + element.Height - baselineOffset;
                    }
                    inline = element.Inline;
                    var inlineObj = inline._ValidateTextPosition(index);
                    inline = inlineObj.inline;
                    index = inlineObj.index;
                    var isParagraphEnd = inline.NextNode == null && index == inline.Length;
                    if (includeParagraphMark && inline.NextNode instanceof FieldCharacterAdv && index == inline.Length)
                        isParagraphEnd = inline._IsLastRenderedInline(index);
                    if (includeParagraphMark && isParagraphEnd) {
                        var width = TextHelper._GetParagraphMarkSize(inline.OwnerParagraph.CharacterFormat).Width;
                        if (caretPosition.X > left + width / 2) {
                            left += width;
                            index = inline.Length + 1;
                        }
                    }
                    caretPosition = new Point(left, top);
                }
            }
            return {
                "inline": inline,
                "index": index,
                "caretPosition": caretPosition,
                "isImageSelected": isImageSelected
            };
        };
        LineWidget.prototype._GetTextLength = function (element) {
            var length = 0;
            var count = element.Inline.Elements._IndexOf(element);
            for (var i = 0; i < count; i++) {
                length += element.Inline.Elements[i].Length;
            }
            return length;
        };
        LineWidget.prototype._GetFirstElementInternal = function () {
            var element = null;
            for (var i = 0; i < this.Children.Count; i++) {
                element = this.Children[i];
                if (element instanceof ListTextElementBox)
                    element = null;
                else
                    break;
            }
            return element;
        };
        LineWidget.prototype._GetFirstElement = function (left) {
            var firstLineIndent = 0;
            if (this._IsParagraphFirstLine())
                firstLineIndent = this.CurrentParagraphWidget.CurrentNode.ParagraphFormat.FirstLineIndent;
            left += firstLineIndent;
            var element = null;
            for (var i = 0; i < this.Children.Count; i++) {
                element = this.Children[i];
                if (element instanceof ListTextElementBox || element instanceof CommentElementBox) {
                    left += element.Margin.Left + element.Width;
                    element = null;
                }
                else
                    break;
            }
            return {
                "element": element, "left": left
            };
        };
        LineWidget.prototype._GetWidth = function (includeParagraphMark) {
            var width = 0;
            if (this._IsParagraphFirstLine())
                width += this.CurrentParagraphWidget.CurrentNode.ParagraphFormat.FirstLineIndent;
            for (var i = 0; i < this.Children.Count; i++) {
                width += this.Children[i].Margin.Left + this.Children[i].Width;
            }
            if (includeParagraphMark && this.CurrentParagraphWidget.CurrentNode.ParagraphWidgets.indexOf(this.CurrentParagraphWidget) == this.CurrentParagraphWidget.CurrentNode.ParagraphWidgets.Count - 1
                && this.CurrentParagraphWidget.ChildWidgets._IndexOf(this) == this.CurrentParagraphWidget.ChildWidgets.Count - 1)
                width += TextHelper._GetParagraphMarkSize(this.CurrentParagraphWidget.CurrentNode.CharacterFormat).Width;
            return width;
        };
        LineWidget.prototype._UpdateTextPositionWidget = function (rte, point, textPosition, includeParagraphMark) {
            var caretPosition = point;
            var inline = null;
            var index = 0;
            var updatePositionObj = this._UpdateTextPositionInternal(rte, inline, index, caretPosition, includeParagraphMark);
            if (updatePositionObj != null) {
                inline = updatePositionObj.inline;
                index = updatePositionObj.index;
                caretPosition = updatePositionObj.caretPosition;
            }
            textPosition._SetPositionForSelection(this.CurrentParagraphWidget.CurrentNode, inline, index, caretPosition);
        };
        LineWidget.prototype._GetHyperlinkField = function (rte, cursorPosition) {
            var inline = null;
            var top = this._GetTop();
            var lineStartLeft = this._GetLineStartLeft();
            if (cursorPosition.Y < top || cursorPosition.Y > top + this.Height
                || cursorPosition.X < lineStartLeft || cursorPosition.X > lineStartLeft + this.Width)
                return null;
            var left = this.CurrentParagraphWidget.X;
            var elementValues = this._GetFirstElement(left);
            left = elementValues.left;
            var element = elementValues.element;
            if (element == null) {
                var width = TextHelper._GetParagraphMarkSize(this.CurrentParagraphWidget.CurrentNode.CharacterFormat).Width;
                if (cursorPosition.X <= lineStartLeft + width || cursorPosition.X >= lineStartLeft + width) {
                    var CheckedFields = new List();
                    var field = this.CurrentParagraphWidget.CurrentNode._GetHyperlinkFields(this.CurrentParagraphWidget.CurrentNode, CheckedFields);
                    CheckedFields._Clear();
                    CheckedFields = null;
                    return field;
                }
            }
            else {
                if (cursorPosition.X > left + element.Margin.Left) {
                    for (var i = this.Children._IndexOf(element); i < this.Children.Count; i++) {
                        element = this.Children[i];
                        if (cursorPosition.X < left + element.Margin.Left + element.Width || i == this.Children.Count - 1)
                            break;
                        left += element.Margin.Left + element.Width;
                    }
                }
                inline = element.Inline;
                var width = element.Margin.Left + element.Width;
                if (inline.NextNode == null && element == inline.Elements[inline.Elements.Count - 1])
                    width += TextHelper._GetParagraphMarkSize(inline.OwnerParagraph.CharacterFormat).Width;
                if (cursorPosition.X <= left + width) {
                    var CheckedFields = new List();
                    var field = inline.OwnerParagraph._GetHyperlinkField(inline, CheckedFields);
                    CheckedFields._Clear();
                    CheckedFields = null;
                    return field;
                }
            }
            return null;
        };
        LineWidget.prototype._GetMaxElementHeight = function () {
            var height = 0;
            if (this.Children.Count == 0 || ((this.Children.Count == 1 && this.Children[0] instanceof ListTextElementBox) || (this.Children.Count == 2 && this.Children[0] instanceof ListTextElementBox && this.Children[1] instanceof ListTextElementBox))) {
                var topMargin = 0;
                var bottomMargin = 0;
                height = this.CurrentParagraphWidget.CurrentNode._GetParagraphMarkSize(topMargin, bottomMargin).Height;
                height += topMargin;
                if (this.Children.Count > 0) {
                    var element = this.Children[0];
                    if (height < element.Margin.Top + element.Height)
                        height = element.Margin.Top + element.Height;
                }
            }
            else {
                for (var i = 0; i < this.Children.Count; i++) {
                    var element = this.Children[i];
                    if (element instanceof CommentElementBox)
                        continue;
                    if (height < element.Margin.Top + element.Height)
                        height = element.Margin.Top + element.Height;
                }
            }
            return height;
        };
        LineWidget.prototype._PreservePreviousElements = function (viewer) {
            var left = 0;
            if (this._IsParagraphFirstLine())
                left += this.CurrentParagraphWidget.CurrentNode.ParagraphFormat.FirstLineIndent;
            for (var i = 0; i < this.Children.Count; i++) {
                var element = this.Children[i];
                element.CurrentLineWidget = null;
                var paragraph = element.BaseNode instanceof Inline ? element.BaseNode.OwnerParagraph : element.BaseNode;
                if (paragraph == null || paragraph == this.CurrentParagraphWidget.CurrentNode)
                    break;
                else {
                    viewer.LineElements._Add(element);
                    left += element.Margin.Left + element.Width;
                }
                this.Children._Remove(element);
                i--;
            }
            return left;
        };
        LineWidget.prototype._UpdateParagraphWidget = function (newParagraphWidget, index) {
            if (this.CurrentParagraphWidget != null) {
                this.CurrentParagraphWidget.ChildWidgets._Remove(this);
                this.CurrentParagraphWidget.Height -= this.Height;
                if (this.CurrentParagraphWidget.ContainerWidget != null)
                    this.CurrentParagraphWidget.ContainerWidget.Height -= this.Height;
                if (this.CurrentParagraphWidget.ChildWidgets == null || this.CurrentParagraphWidget.ChildWidgets.Count == 0)
                    this.CurrentParagraphWidget._Dispose();
            }
            newParagraphWidget.ChildWidgets._Insert(index, this);
            this.CurrentParagraphWidget = newParagraphWidget;
            newParagraphWidget.Height += this.Height;
            if (newParagraphWidget.ContainerWidget != null)
                newParagraphWidget.ContainerWidget.Height += this.Height;
        };
        LineWidget.prototype._ClearChildWidgets = function (viewer, prevElement) {
            var startClear = false;
            var left = 0;
            if (this._IsParagraphFirstLine())
                left += this.CurrentParagraphWidget.CurrentNode.ParagraphFormat.FirstLineIndent;
            for (var i = 0; i < this.Children.Count; i++) {
                var element = this.Children[i];
                element.CurrentLineWidget = null;
                if (startClear || prevElement == null)
                    element._Dispose(viewer);
                else {
                    var width = element.Width;
                    if (element instanceof TextElementBox && this.CurrentParagraphWidget.CurrentNode.ParagraphFormat.TextAlignment == TextAlignment.Justify) {
                        var format = element.Inline.CharacterFormat;
                        TextHelper._GetTextSize(element, format);
                        width = element.Width;
                    }
                    viewer.LineElements._Add(element);
                    left += element.Margin.Left + width;
                }
                if (prevElement == element)
                    startClear = true;
                this.Children._Remove(element);
                i--;
            }
            this.CurrentParagraphWidget = null;
            this._ClearSelectionHighlight(viewer);
            return left;
        };
        LineWidget.prototype._UpdateSubWidth = function (viewer) {
            var width = 0;
            var totalwidth = 0;
            if (viewer.VisibleBounds.Width > viewer.HorizontalWidth)
                totalwidth = viewer.VisibleBounds.Width;
            else
                totalwidth = viewer.HorizontalWidth - viewer.Padding.Left - (2 * viewer.Padding.Right);
            var firstLineIndent = this.CurrentParagraphWidget.CurrentNode.ParagraphFormat.FirstLineIndent;
            var lineText = "";
            for (var i = this.Children.Count - 1; i >= 0; i--) {
                var element = this.Children[i];
                if (element instanceof CommentElementBox)
                    continue;
                else
                    width += element.Width;
            }
            var subwidth = (totalwidth - firstLineIndent - width);
            if (this.Children.Count > 0) {
                var element = this.Children[0];
                var textAlignment = this.CurrentParagraphWidget.CurrentNode.ParagraphFormat.TextAlignment;
                if (textAlignment == TextAlignment.Right)
                    element.Margin.Left += subwidth;
                else
                    element.Margin.Left += subwidth / 2;
            }
        };
        LineWidget.prototype._ClearSelectionHighlight = function (viewer) {
            if (viewer == null)
                return;
            if (viewer.OwnerControl != null && viewer.OwnerControl.Selection.SelectionRanges.Count > 0) {
                viewer.OwnerControl.Selection.SelectionRanges._ClearSelectionHighlightInternal(this);
            }
        };
        LineWidget.prototype._Dispose = function () {
            var viewer = null;
            if (this.CurrentParagraphWidget != null && this.CurrentParagraphWidget._GetPage() != null)
                viewer = this.CurrentParagraphWidget._GetPage().Viewer;
            this._DisposeInternal(viewer);
        };
        LineWidget.prototype._DisposeInternal = function (viewer) {
            this._ClearSelectionHighlight(viewer);
            if (this.Children != null) {
                for (var i = 0; i < this.Children.Count; i++) {
                    var element = this.Children[i];
                    element._Dispose(viewer);
                    this.Children._Remove(element);
                    i--;
                }
                this.Children = null;
            }
            if (this.CurrentParagraphWidget != null) {
                if (this.CurrentParagraphWidget.ChildWidgets != null) {
                    this.CurrentParagraphWidget.ChildWidgets._Remove(this);
                    this.CurrentParagraphWidget.Height -= this.Height;
                }
                this.CurrentParagraphWidget = null;
            }
        };
        return LineWidget;
    }());
    DocumentEditorFeatures.LineWidget = LineWidget;
    var CommentWidget = (function (_super) {
        __extends(CommentWidget, _super);
        function CommentWidget(owner) {
            _super.call(this, owner);
            this.ContentWidth = 316;
            this.visibleHeight = 0;
            this.TopPosition = 0;
            this.RenderedElement = null;
            this.currentNode = owner;
        }
        Object.defineProperty(CommentWidget.prototype, "VisibleHeight", {
            get: function () {
                return this.visibleHeight;
            },
            set: function (value) {
                this.visibleHeight = value;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(CommentWidget.prototype, "Comment", {
            get: function () {
                return this.currentNode;
            },
            enumerable: true,
            configurable: true
        });
        CommentWidget.prototype._render = function (page) {
            if (this.RenderedElement != null) {
                this.RenderedElement._Dispose();
                this.RenderedElement = null;
            }
            this.RenderedElement = new TextBoxContainerAdv(this);
            if (page.Viewer.OwnerControl.Selection != null && page.Viewer.OwnerControl.Selection.Start.Paragraph._GetOwnerComment() == this.Comment)
                this.RenderedElement._ShowBorder();
            for (var i = 0; i < this.ChildWidgets.Count; i++) {
                if (this.ChildWidgets[i] instanceof ParagraphWidget) {
                    this.ChildWidgets[i]._renderComment(page, this.X, this.Y);
                }
                else
                    this.ChildWidgets[i]._renderComment(page, this.X, this.Y);
            }
        };
        CommentWidget.prototype._renderCanvas = function (canvas) {
            for (var i = 0; i < this.ChildWidgets.Count; i++) {
                if (this.ChildWidgets[i] instanceof ParagraphWidget) {
                    this.ChildWidgets[i]._renderCommentCanvas(canvas, this.X, this.Y);
                }
                else
                    this.ChildWidgets[i]._renderCommentCanvas(canvas, this.X, this.Y);
            }
        };
        return CommentWidget;
    }(BodyWidget));
    DocumentEditorFeatures.CommentWidget = CommentWidget;
    var CommentRangeWidget = (function () {
        function CommentRangeWidget(widget) {
            this.CurrentWidget = null;
            this.CommentRangeMarker = null;
            this.CommentRangeLinker = null;
            this.CurrentWidget = widget;
        }
        CommentRangeWidget.prototype._Dispose = function () {
            this.CurrentWidget = null;
            this.CommentRangeMarker = null;
            this.CommentRangeLinker = null;
        };
        return CommentRangeWidget;
    }());
    DocumentEditorFeatures.CommentRangeWidget = CommentRangeWidget;
    var TextBoxContainerAdv = (function () {
        function TextBoxContainerAdv(commentWidget) {
            this.Layoutedwidget = commentWidget;
            this._InitBorder();
        }
        TextBoxContainerAdv.prototype._InitBorder = function () {
            if (this.Layoutedwidget == null && this.Layoutedwidget.Comment == null)
                return;
            this.Left = new Line(0 + this.Layoutedwidget.X, 0 + this.Layoutedwidget.Y, 0 + this.Layoutedwidget.X, 0 + this.Layoutedwidget.Height + this.Layoutedwidget.Y);
            this.Top = new Line(0 + this.Layoutedwidget.X, 0 + this.Layoutedwidget.Y, 316 + this.Layoutedwidget.X, 0 + this.Layoutedwidget.Y);
            this.Bottom = new Line(0 + this.Layoutedwidget.X, 0 + this.Layoutedwidget.Y + this.Layoutedwidget.Height, 316 + this.Layoutedwidget.X, 0 + this.Layoutedwidget.Y + this.Layoutedwidget.Height);
            var page = this.Layoutedwidget.Page;
            this.canvas = document.getElementById(page.Id + "_selection");
            var context = this.canvas.getContext("2d");
            context.beginPath();
            context.moveTo(this.Left.X1, this.Left.Y1);
            context.lineTo(this.Left.X2, this.Left.Y2);
            context.strokeStyle = "#19c7ff";
            context.globalAlpha = 1;
            context.stroke();
        };
        TextBoxContainerAdv.prototype._ShowBorder = function () {
            var context = this.canvas.getContext("2d");
            context.beginPath();
            context.moveTo(this.Top.X1, this.Top.Y1 + 0.5);
            context.lineTo(this.Top.X2, this.Top.Y2 + 0.5);
            context.moveTo(this.Bottom.X1, this.Bottom.Y1 + 0.5);
            context.lineTo(this.Bottom.X2, this.Bottom.Y2 + 0.5);
            context.strokeStyle = "#19c7ff";
            context.globalAlpha = 1;
            context.stroke();
            var page = this.Layoutedwidget.Page;
            var backgroundCanvas = document.getElementById(page.Id + "_background");
            var backContext = backgroundCanvas.getContext("2d");
            backContext.fillStyle = "#F1F2F2";
            backContext.fillRect(this.Top.X1, this.Top.Y1, this.Top.X2, this.Layoutedwidget.Height);
        };
        TextBoxContainerAdv.prototype._Dispose = function () {
            this.Layoutedwidget = null;
            this.Left = null;
            this.Bottom = null;
            this.Top = null;
        };
        return TextBoxContainerAdv;
    }());
    DocumentEditorFeatures.TextBoxContainerAdv = TextBoxContainerAdv;
    var ElementBox = (function () {
        function ElementBox(baseNode) {
            this.X = 0;
            this.Y = 0;
            this.Width = 0;
            this.Height = 0;
            this.BaseNode = baseNode;
        }
        Object.defineProperty(ElementBox.prototype, "Inline", {
            get: function () {
                return this.BaseNode;
            },
            enumerable: true,
            configurable: true
        });
        ElementBox.prototype._GetIndexInInline = function () {
            var indexInInline = 0;
            if (Inline != null && this instanceof TextElementBox) {
                var count = this.Inline.Elements._IndexOf(this);
                for (var i = 0; i < count; i++) {
                    indexInInline += this.Inline.Elements[i].Length;
                }
            }
            return indexInInline;
        };
        ElementBox.prototype._renderUnderline = function (context, left, top, underlineY, color, underline, baselineAlignment) {
            var renderedHeight = this.Height / (baselineAlignment == BaselineAlignment.Normal ? 1 : 1.5);
            var topMargin = this.Margin.Top;
            var underlineHeight = renderedHeight / 20;
            var y = 0;
            if (baselineAlignment == BaselineAlignment.Subscript || this instanceof ListTextElementBox) {
                y = (renderedHeight - 2 * underlineHeight) + top;
                topMargin += this.Height - renderedHeight;
                y += topMargin > 0 ? topMargin : 0;
            }
            else
                y = underlineY + top;
            context.fillRect(left + this.Margin.Left, y, this.Width, underlineHeight);
        };
        ElementBox.prototype._renderStrikeThrough = function (context, left, top, strikethrough, color, baselineAlignment) {
            var renderedHeight = this.Height / (baselineAlignment == BaselineAlignment.Normal ? 1 : 1.5);
            var topMargin = this.Margin.Top;
            if (baselineAlignment == BaselineAlignment.Subscript)
                topMargin += this.Height - renderedHeight;
            top += topMargin > 0 ? topMargin : 0;
            var lineHeight = renderedHeight / 20;
            var y = (renderedHeight / 2) + (0.5 * lineHeight);
            var linecount = 0;
            if (strikethrough == StrikeThrough.DoubleStrike)
                y -= lineHeight;
            while (linecount < (strikethrough == StrikeThrough.DoubleStrike ? 2 : 1)) {
                linecount++;
                context.fillRect(left + this.Margin.Left, y + top, this.Width, lineHeight);
                y += 2 * lineHeight;
            }
        };
        ElementBox.prototype._ClipRect = function (context, xPos, yPos, width, height) {
            context.beginPath();
            context.save();
            context.rect(xPos, yPos, width, height);
            context.clip();
        };
        return ElementBox;
    }());
    DocumentEditorFeatures.ElementBox = ElementBox;
    var TextElementBox = (function (_super) {
        __extends(TextElementBox, _super);
        function TextElementBox(inline) {
            _super.call(this, inline);
            this.BaselineOffset = 0;
            this.Index = 0;
            this.Length = 0;
        }
        Object.defineProperty(TextElementBox.prototype, "Text", {
            get: function () {
                if (this.Inline instanceof SpanAdv)
                    return this.Inline.Text.substr(this.Index, this.Length);
                return "";
            },
            enumerable: true,
            configurable: true
        });
        TextElementBox.prototype._render = function (foregroundContext, backgroundContext, left, top, underlineY) {
            var isHeightType = false;
            var containerWidget = this.CurrentLineWidget.CurrentParagraphWidget.ContainerWidget;
            if (containerWidget instanceof TableCellWidget)
                isHeightType = (containerWidget.CurrentNode.OwnerRow.RowFormat.HeightType == HeightType.Exactly);
            var topMargin = this.Margin.Top;
            var leftMargin = this.Margin.Left;
            if (isHeightType) {
                this._ClipRect(foregroundContext, containerWidget.X, containerWidget.Y, containerWidget.Width, containerWidget.Height);
            }
            var format = this.Inline.CharacterFormat;
            var color = format.FontColor;
            foregroundContext.textBaseline = "top";
            var bold = "";
            var italic = "";
            var fontSize = 11;
            bold = format.Bold ? "bold" : "";
            italic = format.Italic ? "italic" : "";
            fontSize = format.FontSize == 0 ? 0.5 : format.FontSize / (format.BaselineAlignment == BaselineAlignment.Normal ? 1 : 1.5);
            foregroundContext.font = bold + " " + italic + " " + fontSize + "px" + " " + format.FontFamily;
            if (format.BaselineAlignment == BaselineAlignment.Subscript)
                topMargin += this.Height - this.Height / 1.5;
            if (format.HighlightColor != HighlightColor.NoColor) {
                backgroundContext.fillStyle = HelperMethods._GetHighlightColorCode(format.HighlightColor);
                backgroundContext.fillRect(left + leftMargin, top + topMargin, this.Width, this.Height);
            }
            if (color == "empty") {
                var document_11 = this.Inline.OwnerParagraph.Document;
                color = this.Inline.CharacterFormat._GetDefaultFontColor(document_11);
            }
            foregroundContext.fillStyle = color;
            foregroundContext.fillText(this.Text, left + leftMargin, top + topMargin, this.Width);
            foregroundContext.restore();
            if (format.Underline != Underline.None)
                this._renderUnderline(foregroundContext, left, top, underlineY, color, format.Underline, format.BaselineAlignment);
            if (format.StrikeThrough != StrikeThrough.None)
                this._renderStrikeThrough(foregroundContext, left, top, format.StrikeThrough, color, format.BaselineAlignment);
        };
        TextElementBox.prototype._Dispose = function () {
            var viewer = null;
            if (this.CurrentLineWidget != null && this.CurrentLineWidget.CurrentParagraphWidget != null && this.CurrentLineWidget.CurrentParagraphWidget._GetPage() != null)
                viewer = this.CurrentLineWidget.CurrentParagraphWidget._GetPage().Viewer;
            this._DisposeInternal(viewer);
        };
        TextElementBox.prototype._DisposeInternal = function (viewer) {
            var StartIndex = 0;
            var Length = 0;
            if (this.CurrentLineWidget != null) {
                if (this.CurrentLineWidget.Children._Contains(this))
                    this.CurrentLineWidget.Children._Remove(this);
                this.CurrentLineWidget = null;
            }
            if (this.Inline != null) {
                if (this.Inline.Elements != null && this.Inline.Elements._Contains(this))
                    this.Inline.Elements._Remove(this);
                this.BaseNode = null;
            }
        };
        return TextElementBox;
    }(ElementBox));
    DocumentEditorFeatures.TextElementBox = TextElementBox;
    var ListTextElementBox = (function (_super) {
        __extends(ListTextElementBox, _super);
        function ListTextElementBox(paragraphAdv, listLevel, isListFollowCharacter) {
            _super.call(this, paragraphAdv);
            this.BaselineOffset = 0;
            this.index = 0;
            this.isFollowCharacter = false;
            this.ListLevel = listLevel;
            this.isFollowCharacter = isListFollowCharacter;
        }
        Object.defineProperty(ListTextElementBox.prototype, "Paragraph", {
            get: function () {
                return this.BaseNode;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(ListTextElementBox.prototype, "Text", {
            get: function () {
                return this.text;
            },
            set: function (value) {
                this.text = value;
            },
            enumerable: true,
            configurable: true
        });
        ListTextElementBox.prototype._render = function (foregroundContext, backgroundContext, left, top, underlineY) {
            var topMargin = this.Margin.Top;
            var leftMargin = this.Margin.Left;
            var format = this.ListLevel.CharacterFormat;
            var breakCharacterFormat = this.Paragraph.CharacterFormat;
            var color = format.FontColor;
            foregroundContext.textBaseline = "top";
            var bold = "";
            var italic = "";
            var fontFamily = format.FontFamily == "verdana" ? breakCharacterFormat.FontFamily : format.FontFamily;
            var fontSize = format.FontSize == 11 ? breakCharacterFormat.FontSize : format.FontSize;
            var baselineAlignment = format.BaselineAlignment == 0 ? breakCharacterFormat.BaselineAlignment : format.BaselineAlignment;
            bold = format.Bold ? "bold" : "";
            italic = format.Italic ? "italic" : "";
            fontSize = fontSize == 0 ? 0.5 : fontSize / (baselineAlignment == BaselineAlignment.Normal ? 1 : 1.5);
            foregroundContext.font = bold + " " + italic + " " + fontSize + "px" + " " + fontFamily;
            if (baselineAlignment == BaselineAlignment.Subscript)
                topMargin += this.Height - this.Height / 1.5;
            if (format.HighlightColor != HighlightColor.NoColor) {
                backgroundContext.fillStyle = HelperMethods._GetHighlightColorCode(format.HighlightColor);
                backgroundContext.fillRect(left + leftMargin, top + topMargin, this.Width, this.Height);
            }
            if (color == "empty") {
                var document_12 = this.Paragraph.Document;
                color = this.ListLevel.CharacterFormat._GetDefaultFontColor(document_12);
            }
            foregroundContext.fillStyle = color;
            foregroundContext.fillText(this.Text, left + leftMargin, top + topMargin);
            if (format.Underline != Underline.None)
                this._renderUnderline(foregroundContext, left, top, underlineY, color, format.Underline, baselineAlignment);
            if (format.StrikeThrough != StrikeThrough.None)
                this._renderStrikeThrough(foregroundContext, left, top, format.StrikeThrough, color, baselineAlignment);
        };
        ListTextElementBox.prototype._Dispose = function () {
            var viewer = null;
            if (this.CurrentLineWidget != null && this.CurrentLineWidget.CurrentParagraphWidget != null && this.CurrentLineWidget.CurrentParagraphWidget._GetPage() != null)
                viewer = this.CurrentLineWidget.CurrentParagraphWidget._GetPage().Viewer;
            this._DisposeInternal(viewer);
        };
        ListTextElementBox.prototype._DisposeInternal = function (viewer) {
            if (this.CurrentLineWidget != null) {
                if (this.CurrentLineWidget.Children._Contains(this))
                    this.CurrentLineWidget.Children._Remove(this);
                this.CurrentLineWidget = null;
            }
            this.BaseNode = null;
            this.ListLevel = null;
        };
        return ListTextElementBox;
    }(ElementBox));
    DocumentEditorFeatures.ListTextElementBox = ListTextElementBox;
    var CommentElementBox = (function (_super) {
        __extends(CommentElementBox, _super);
        function CommentElementBox(inline) {
            _super.call(this, inline);
        }
        CommentElementBox.prototype._Dispose = function () {
            var viewer = null;
            if (this.CurrentLineWidget != null && this.CurrentLineWidget.CurrentParagraphWidget != null && this.CurrentLineWidget.CurrentParagraphWidget._GetPage() != null)
                viewer = this.CurrentLineWidget.CurrentParagraphWidget._GetPage().Viewer;
            this._DisposeInternal(viewer);
        };
        CommentElementBox.prototype._DisposeInternal = function (viewer) {
            if (this.Inline instanceof CommentAdv && this.Inline.LayoutedWidget != null)
                this.Inline.LayoutedWidget._Dispose();
            if (this.CurrentLineWidget != null) {
                if (this.CurrentLineWidget.Children._Contains(this))
                    this.CurrentLineWidget.Children._Remove(this);
                this.CurrentLineWidget = null;
            }
            this.BaseNode = null;
        };
        CommentElementBox.prototype._render = function () { };
        CommentElementBox.prototype._renderComment = function (page) {
            if (this.BaseNode instanceof CommentAdv && this.BaseNode.LayoutedWidget != null)
                this.BaseNode.LayoutedWidget._render(page);
        };
        CommentElementBox.prototype._renderCanvas = function (canvas) {
            if (this.BaseNode instanceof CommentAdv && this.BaseNode.LayoutedWidget != null)
                this.BaseNode.LayoutedWidget._renderCanvas(canvas);
        };
        return CommentElementBox;
    }(ElementBox));
    DocumentEditorFeatures.CommentElementBox = CommentElementBox;
    var ImageElementBox = (function (_super) {
        __extends(ImageElementBox, _super);
        function ImageElementBox(inline) {
            _super.call(this, inline);
        }
        Object.defineProperty(ImageElementBox.prototype, "ImageContainer", {
            get: function () {
                return this.Inline;
            },
            enumerable: true,
            configurable: true
        });
        ImageElementBox.prototype._DrawImageonCanvas = function (left, top, width, height, foregroundContext, image) {
            image.addEventListener("load", function () {
                foregroundContext.drawImage(image, left, top, width, height);
                foregroundContext.restore();
            }, false);
        };
        ImageElementBox.prototype._render = function (foregroundContext, backgroundContext, left, top, underlineY) {
            var topMargin = this.Margin.Top;
            var leftMargin = this.Margin.Left;
            var widgetWidth = 0;
            var format = this.Inline.CharacterFormat;
            var color = "black";
            foregroundContext.textBaseline = "top";
            var image = document.createElement("img");
            image.src = this.Inline.ImageString;
            foregroundContext.save();
            if (topMargin < 0 || this.CurrentLineWidget.Width < this.Width) {
                var containerWid = this.CurrentLineWidget.CurrentParagraphWidget.ContainerWidget;
                if (containerWid instanceof BodyWidget)
                    widgetWidth = containerWid.Width + containerWid.X;
                else if (containerWid instanceof TableCellWidget) {
                    var leftIndent = 0;
                    if (containerWid.ChildWidgets[0] instanceof ParagraphWidget) {
                        var paraAdv = containerWid.ChildWidgets[0].CurrentNode;
                        leftIndent = paraAdv.ParagraphFormat.LeftIndent;
                    }
                    widgetWidth = containerWid.Width + containerWid.Margin.Left - containerWid.LeftBorderWidth - leftIndent;
                }
                this._ClipRect(foregroundContext, left + leftMargin, top + topMargin, widgetWidth, containerWid.Height);
            }
            if (this.Inline.IsMetaFile) {
            }
            else {
                if (navigator.userAgent.match("Firefox"))
                    this._DrawImageonCanvas(left + leftMargin, top + topMargin, this.Width, this.Height, foregroundContext, image);
                else {
                    foregroundContext.drawImage(image, left + leftMargin, top + topMargin, this.Width, this.Height);
                    foregroundContext.restore();
                }
            }
        };
        ImageElementBox.prototype._renderCanvas = function (foregroundContext, backgroundContext, left, top, underlineY) {
            var topMargin = this.Margin.Top;
            var leftMargin = this.Margin.Left;
            var widgetWidth = 0;
            var format = this.Inline.CharacterFormat;
            var color = "black";
            foregroundContext.textBaseline = "top";
            var image = document.createElement("img");
            image.src = this.Inline.ImageString;
            foregroundContext.save();
            if (topMargin < 0 || this.CurrentLineWidget.Width < this.Width) {
                var containerWid = this.CurrentLineWidget.CurrentParagraphWidget.ContainerWidget;
                if (containerWid instanceof BodyWidget)
                    widgetWidth = containerWid.Width + containerWid.X;
                else if (containerWid instanceof TableCellWidget) {
                    var leftIndent = 0;
                    if (containerWid.ChildWidgets[0] instanceof ParagraphWidget) {
                        var paraAdv = containerWid.ChildWidgets[0].CurrentNode;
                        leftIndent = paraAdv.ParagraphFormat.LeftIndent;
                    }
                    widgetWidth = containerWid.Width + containerWid.Margin.Left - containerWid.LeftBorderWidth - leftIndent;
                }
                this._ClipRect(foregroundContext, left + leftMargin, top + topMargin, widgetWidth, containerWid.Height);
            }
            if (this.Inline.IsMetaFile) {
            }
            else {
                foregroundContext.drawImage(image, left + leftMargin, top + topMargin, this.Width, this.Height);
                foregroundContext.restore();
            }
        };
        ImageElementBox.prototype._Dispose = function () {
            var viewer = null;
            if (this.CurrentLineWidget != null && this.CurrentLineWidget.CurrentParagraphWidget != null && this.CurrentLineWidget.CurrentParagraphWidget._GetPage() != null)
                viewer = this.CurrentLineWidget.CurrentParagraphWidget._GetPage().Viewer;
            this._DisposeInternal(viewer);
        };
        ImageElementBox.prototype._DisposeInternal = function (viewer) {
            if (this.CurrentLineWidget != null) {
                if (this.CurrentLineWidget.Children._Contains(this))
                    this.CurrentLineWidget.Children._Remove(this);
                this.CurrentLineWidget = null;
            }
            if (this.Inline != null) {
                if (this.Inline.Elements != null && this.Inline.Elements._Contains(this))
                    this.Inline.Elements._Remove(this);
                this.BaseNode = null;
            }
        };
        return ImageElementBox;
    }(ElementBox));
    DocumentEditorFeatures.ImageElementBox = ImageElementBox;
    var ListAdv = (function (_super) {
        __extends(ListAdv, _super);
        function ListAdv(node) {
            _super.call(this, node);
            this.listId = -1;
            this.SourceListId = -1;
            this.abstractListId = -1;
            this.levelOverrides = new LevelOverrideAdvCollection(this);
        }
        Object.defineProperty(ListAdv.prototype, "OwnerDocument", {
            get: function () {
                return this.OwnerBase;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(ListAdv.prototype, "AbstractList", {
            get: function () {
                var abstractList = null;
                if (this.OwnerDocument != null)
                    abstractList = this.OwnerDocument._GetAbstractListAdvByID(this.AbstractListId);
                if (abstractList != null)
                    return abstractList;
                return this.abstractList;
            },
            set: function (abstractList) {
                this.abstractList = abstractList;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(ListAdv.prototype, "ListId", {
            get: function () {
                return this.listId;
            },
            set: function (listId) {
                this.listId = listId;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(ListAdv.prototype, "AbstractListId", {
            get: function () {
                return this.abstractListId;
            },
            set: function (abstractListId) {
                this.abstractListId = abstractListId;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(ListAdv.prototype, "LevelOverrides", {
            get: function () {
                return this.levelOverrides;
            },
            set: function (levelOverrides) {
                this.levelOverrides = levelOverrides;
            },
            enumerable: true,
            configurable: true
        });
        ListAdv.prototype._GetListLevel = function (listLevelNumber) {
            if (this.AbstractList != null && this.AbstractList.Levels.Count <= listLevelNumber && listLevelNumber >= 0 && listLevelNumber < 9)
                this.OwnerDocument._AddListLevel(this.AbstractList);
            var levelOverrideAdv = null;
            if (this.LevelOverrides != null && (levelOverrideAdv = this.LevelOverrides._Get(listLevelNumber)) != null && levelOverrideAdv.OverrideListLevel != null)
                return levelOverrideAdv.OverrideListLevel;
            else if (this.AbstractList != null && listLevelNumber >= 0 && listLevelNumber < this.AbstractList.Levels.Count)
                return this.AbstractList.Levels[listLevelNumber];
            return null;
        };
        ListAdv.prototype._GetListStartValue = function (listLevelNumber) {
            var levelOverride = this.LevelOverrides != null ? this.LevelOverrides._Get(listLevelNumber) : null;
            if (levelOverride != null && levelOverride.OverrideListLevel == null)
                return levelOverride.StartAt;
            var listLevel = this._GetListLevel(listLevelNumber);
            if (listLevel == null)
                return 0;
            else
                return listLevel.StartAt;
        };
        ListAdv.prototype._Dispose = function () {
            this._SetOwner(null);
            if (this.LevelOverrides != null)
                this.LevelOverrides._Dispose();
            this.levelOverrides = null;
        };
        ListAdv.prototype._SerializeLevelOverrides = function () {
            var LevelOverrides = { "LevelOverrides": [] };
            for (var i = 0; i < this.LevelOverrides.Count; i++) {
                LevelOverrides.LevelOverrides[i] = this.LevelOverrides[i]._SerializeLevelOverRides();
            }
            return LevelOverrides.LevelOverrides;
        };
        return ListAdv;
    }(BaseNode));
    DocumentEditorFeatures.ListAdv = ListAdv;
    var AbstractListAdv = (function (_super) {
        __extends(AbstractListAdv, _super);
        function AbstractListAdv(node) {
            _super.call(this, node);
            this.abstractListId = -1;
            this.name = "";
            this.levels = new ListLevelAdvCollection(this);
        }
        Object.defineProperty(AbstractListAdv.prototype, "OwnerDocument", {
            get: function () {
                return this.OwnerBase;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(AbstractListAdv.prototype, "AbstractListId", {
            get: function () {
                return this.abstractListId;
            },
            set: function (abstractListId) {
                this.abstractListId = abstractListId;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(AbstractListAdv.prototype, "Levels", {
            get: function () {
                return this.levels;
            },
            set: function (levels) {
                this.levels = levels;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(AbstractListAdv.prototype, "Name", {
            get: function () {
                return this.name;
            },
            set: function (value) {
                this.name = value;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(AbstractListAdv.prototype, "ListType", {
            get: function () {
                return this.listType;
            },
            set: function (value) {
                this.listType = value;
            },
            enumerable: true,
            configurable: true
        });
        AbstractListAdv.prototype.AddListLevel = function () {
            var listLevelAdv = new ListLevelAdv(this);
            this.Levels._Add(listLevelAdv);
            return listLevelAdv;
        };
        AbstractListAdv.prototype._Dispose = function () {
            this._SetOwner(null);
            if (this.levels != null) {
                for (var i = 0; i < this.levels.length; i++) {
                    var listlevel = this.levels[i];
                    this.levels._Dispose;
                    this.levels._Remove(listlevel);
                    i--;
                }
            }
        };
        AbstractListAdv.prototype._SerializeListLevelAdvCollection = function () {
            var Levels = { "Levels": [], "AbstractListId": [], "Name": [], "ListType": [] };
            var InLevels = this.Levels;
            for (var i = 0; i < InLevels.Count; i++) {
                var Level = InLevels[i];
                Levels.Levels[i] = Level._SerializeListLevelAdv();
            }
            Levels.AbstractListId = this.AbstractListId;
            Levels.Name = this.Name;
            Levels.ListType = this.ListType;
            return Levels;
        };
        return AbstractListAdv;
    }(BaseNode));
    DocumentEditorFeatures.AbstractListAdv = AbstractListAdv;
    var ListLevelAdv = (function (_super) {
        __extends(ListLevelAdv, _super);
        function ListLevelAdv(node) {
            _super.call(this, node);
            this.listLevelPattern = ListLevelPattern.Arabic;
            this.startAt = 0;
            this.numberFormat = "";
            this.followCharacter = FollowCharacterType.Tab;
            this.levelNumber = 0;
            this.paragraphFormat = null;
            this.characterFormat = null;
            this.restartLevel = 0;
            this.CharacterFormat = new CharacterFormat(this);
            this.ParagraphFormat = new ParagraphFormat(this);
        }
        Object.defineProperty(ListLevelAdv.prototype, "OwnerDocument", {
            get: function () {
                if (this.OwnerBase != null)
                    return this.OwnerBase.OwnerDocument;
                else if (this.OwnerBase != null)
                    return this.OwnerBase.OwnerList.OwnerDocument;
                return null;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(ListLevelAdv.prototype, "ListLevelPattern", {
            get: function () {
                return this.listLevelPattern;
            },
            set: function (listLevelPattern) {
                this.listLevelPattern = listLevelPattern;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(ListLevelAdv.prototype, "FollowCharacter", {
            get: function () {
                return this.followCharacter;
            },
            set: function (followCharacter) {
                this.followCharacter = followCharacter;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(ListLevelAdv.prototype, "StartAt", {
            get: function () {
                return this.startAt;
            },
            set: function (startAt) {
                this.startAt = startAt;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(ListLevelAdv.prototype, "NumberFormat", {
            get: function () {
                return this.numberFormat;
            },
            set: function (numberFormat) {
                this.numberFormat = numberFormat;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(ListLevelAdv.prototype, "RestartLevel", {
            get: function () {
                return this.restartLevel;
            },
            set: function (restartLevel) {
                this.restartLevel = restartLevel;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(ListLevelAdv.prototype, "LevelNumber", {
            get: function () {
                if (this.OwnerBase instanceof LevelOverrideAdv)
                    return this.OwnerBase.LevelNumber;
                else if (this.OwnerBase instanceof AbstractListAdv && this.OwnerBase.Levels != null)
                    return this.OwnerBase.Levels._IndexOf(this);
                else
                    return -1;
            },
            set: function (levelNumber) {
                this.levelNumber = levelNumber;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(ListLevelAdv.prototype, "CharacterFormat", {
            get: function () {
                return this.characterFormat;
            },
            set: function (characterFormat) {
                this.characterFormat = characterFormat;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(ListLevelAdv.prototype, "ParagraphFormat", {
            get: function () {
                return this.paragraphFormat;
            },
            set: function (paragraphFormat) {
                this.paragraphFormat = paragraphFormat;
            },
            enumerable: true,
            configurable: true
        });
        ListLevelAdv.prototype._GetListText = function (listValue) {
            switch (this.ListLevelPattern) {
                case ListLevelPattern.UpRoman:
                    return this._GetAsRoman(listValue).toUpperCase();
                case ListLevelPattern.LowRoman:
                    return this._GetAsRoman(listValue).toLowerCase();
                case ListLevelPattern.UpLetter:
                    return this._GetAsLetter(listValue).toUpperCase();
                case ListLevelPattern.LowLetter:
                    return this._GetAsLetter(listValue).toLowerCase();
                case ListLevelPattern.Arabic:
                    return (listValue).toString();
                case ListLevelPattern.LeadingZero:
                    if (listValue < 10)
                        return "0" + listValue.toString();
                    else
                        return listValue.toString();
                case ListLevelPattern.Number:
                    return (listValue).toString();
                case ListLevelPattern.OrdinalText:
                    return (listValue).toString();
                case ListLevelPattern.Ordinal:
                    return (listValue).toString();
                case ListLevelPattern.FarEast:
                    return (listValue).toString();
                case ListLevelPattern.Special:
                    return (listValue).toString();
                default:
                    return "";
            }
        };
        ListLevelAdv.prototype._GetAsRoman = function (number) {
            var retval = "";
            var Number = {
                "number": number
            };
            retval += this._GenerateNumber(Number, 1000, "M");
            retval += this._GenerateNumber(Number, 900, "CM");
            retval += this._GenerateNumber(Number, 500, "D");
            retval += this._GenerateNumber(Number, 400, "CD");
            retval += this._GenerateNumber(Number, 100, "C");
            retval += this._GenerateNumber(Number, 90, "XC");
            retval += this._GenerateNumber(Number, 50, "L");
            retval += this._GenerateNumber(Number, 40, "XL");
            retval += this._GenerateNumber(Number, 10, "X");
            retval += this._GenerateNumber(Number, 9, "IX");
            retval += this._GenerateNumber(Number, 5, "V");
            retval += this._GenerateNumber(Number, 4, "IV");
            retval += this._GenerateNumber(Number, 1, "I");
            return retval.toString();
        };
        ListLevelAdv.prototype._GenerateNumber = function (value, magnitude, letter) {
            var numberstring = "";
            while (value.number >= magnitude) {
                value.number -= magnitude;
                numberstring += letter;
            }
            return numberstring.toString();
        };
        ListLevelAdv.prototype._GetAsLetter = function (number) {
            if (number <= 0)
                return "";
            var quotient = number / 26;
            var remainder = number % 26;
            if (remainder == 0) {
                remainder = 26;
                quotient--;
            }
            var letter = String.fromCharCode(65 - 1 + remainder);
            var listValue = letter.toString();
            while (quotient > 0) {
                listValue = letter.toString();
                quotient--;
            }
            return listValue;
        };
        ListLevelAdv.prototype._SerializeListLevelAdv = function () {
            var Levels = {
                "CharacterFormat": [], "ParagraphFormat": [], "RestartLevel": [], "StartAt": [],
                "FollowCharacter": [], "LevelNumber": [], "ListLevelPattern": [], "NumberFormat": []
            };
            Levels.CharacterFormat = this.CharacterFormat._SerializeCharacterFormat();
            Levels.ParagraphFormat = this.ParagraphFormat._SerializeParagraphFormat();
            Levels.RestartLevel = this.RestartLevel;
            Levels.StartAt = this.StartAt;
            Levels.FollowCharacter = this.FollowCharacter;
            Levels.LevelNumber = this.LevelNumber;
            Levels.ListLevelPattern = this.ListLevelPattern;
            Levels.NumberFormat = this.NumberFormat;
            return Levels;
        };
        ListLevelAdv.prototype._Clone = function () {
            var listLevel = new ListLevelAdv(null);
            listLevel._CopyLevel(this);
            return listLevel;
        };
        ListLevelAdv.prototype._CopyLevel = function (listLevel) {
            if (listLevel.ParagraphFormat != null && listLevel.ParagraphFormat != undefined) {
                this.ParagraphFormat = new ParagraphFormat(this);
                this.ParagraphFormat._CopyFormat(listLevel.ParagraphFormat);
            }
            if (listLevel.CharacterFormat != null && listLevel.CharacterFormat != undefined) {
                this.CharacterFormat = new CharacterFormat(this);
                this.CharacterFormat._CopyFormat(listLevel.CharacterFormat);
            }
            if (listLevel.FollowCharacter != null && listLevel.FollowCharacter != undefined)
                this.FollowCharacter = listLevel.FollowCharacter;
            if (listLevel.ListLevelPattern != null && listLevel.ListLevelPattern != undefined)
                this.ListLevelPattern = listLevel.ListLevelPattern;
            if (listLevel.NumberFormat != null && listLevel.NumberFormat != undefined)
                this.NumberFormat = listLevel.NumberFormat;
            if (listLevel.RestartLevel != null && listLevel.RestartLevel != undefined)
                this.RestartLevel = listLevel.RestartLevel;
            if (listLevel.StartAt != null && listLevel.StartAt != undefined)
                this.StartAt = listLevel.StartAt;
        };
        ListLevelAdv.prototype._Dispose = function () {
            this._SetOwner(null);
            this.CharacterFormat._Dispose();
            this.ParagraphFormat._Dispose();
        };
        ListLevelAdv.DOTBULLET = "\uf0b7";
        ListLevelAdv.SQUAREBULLET = "\uf0a7";
        ListLevelAdv.ARROWBULLET = "\u27a4";
        ListLevelAdv.CIRCLEBULLET = "\uf06f" + "\u0020";
        return ListLevelAdv;
    }(BaseNode));
    DocumentEditorFeatures.ListLevelAdv = ListLevelAdv;
    var LevelOverrideAdv = (function (_super) {
        __extends(LevelOverrideAdv, _super);
        function LevelOverrideAdv(node) {
            _super.call(this, node);
        }
        Object.defineProperty(LevelOverrideAdv.prototype, "OwnerList", {
            get: function () {
                return this.OwnerBase;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(LevelOverrideAdv.prototype, "StartAt", {
            get: function () {
                return this.startAt;
            },
            set: function (value) {
                this.startAt = value;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(LevelOverrideAdv.prototype, "LevelNumber", {
            get: function () {
                return this.levelNumber;
            },
            set: function (value) {
                this.levelNumber = value;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(LevelOverrideAdv.prototype, "OverrideListLevel", {
            get: function () {
                return this.overrideListLevel;
            },
            set: function (value) {
                this.overrideListLevel = value;
            },
            enumerable: true,
            configurable: true
        });
        LevelOverrideAdv.prototype._Clone = function () {
            var levelOverride = new LevelOverrideAdv(null);
            if (levelOverride.StartAt != null && levelOverride.StartAt != undefined)
                levelOverride.StartAt = this.StartAt;
            if (levelOverride.OverrideListLevel != null && levelOverride.OverrideListLevel != undefined)
                levelOverride.OverrideListLevel = this.OverrideListLevel;
            if (levelOverride.LevelNumber != null && levelOverride.LevelNumber != undefined)
                levelOverride.LevelNumber = this.LevelNumber;
            return levelOverride;
        };
        LevelOverrideAdv.prototype._SerializeLevelOverRides = function () {
            var Level = { "LevelNumber": [], "OverrideListLevel": [], "StartAt": [] };
            Level.LevelNumber = this.LevelNumber;
            if (this.OverrideListLevel != null)
                Level.OverrideListLevel = this.OverrideListLevel._SerializeListLevelAdv();
            Level.StartAt = this.StartAt;
            return Level;
        };
        return LevelOverrideAdv;
    }(BaseNode));
    DocumentEditorFeatures.LevelOverrideAdv = LevelOverrideAdv;
    var ListDialogVieModel = (function () {
        function ListDialogVieModel() {
            this.levelNumber = 0;
        }
        Object.defineProperty(ListDialogVieModel.prototype, "LevelNumber", {
            get: function () {
                return this.levelNumber;
            },
            set: function (value) {
                this.levelNumber = value;
                this._NotifyPropertyChanged("ListLevel");
                this._NotifyPropertyChanged("LevelNumber");
                this._NotifyPropertyChanged("ListLevelPattern");
                this._NotifyPropertyChanged("FollowCharacter");
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(ListDialogVieModel.prototype, "List", {
            get: function () {
                return this.list;
            },
            set: function (value) {
                if (value == null)
                    this._CreateList();
                else
                    this.list = value;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(ListDialogVieModel.prototype, "ListLevel", {
            get: function () {
                if (this.list != null && this.levelNumber >= 0 && this.levelNumber < 9) {
                    if (this.list.AbstractList.Levels.Count <= this.levelNumber)
                        this._AddListLevels();
                    return this.list.AbstractList.Levels[this.levelNumber];
                }
                return null;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(ListDialogVieModel.prototype, "ListLevelPattern", {
            get: function () {
                if (this.ListLevel != null)
                    return this.ListLevel.ListLevelPattern;
                return ListLevelPattern.Arabic;
            },
            set: function (value) {
                if (this.ListLevel != null)
                    this.ListLevel.ListLevelPattern = value;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(ListDialogVieModel.prototype, "FollowCharacter", {
            get: function () {
                if (this.ListLevel != null)
                    return this.ListLevel.FollowCharacter;
                return FollowCharacterType.None;
            },
            set: function (value) {
                if (this.ListLevel != null)
                    this.ListLevel.FollowCharacter = value;
            },
            enumerable: true,
            configurable: true
        });
        ListDialogVieModel.prototype._CreateList = function () {
            this.list = new ListAdv(null);
            this.list.AbstractList = new AbstractListAdv(null);
            var listLevel = new ListLevelAdv(this.list.AbstractList);
            listLevel.ParagraphFormat = new ParagraphFormat(listLevel);
            listLevel.ParagraphFormat.LeftIndent = 48;
            listLevel.ParagraphFormat.FirstLineIndent = -24;
            listLevel.CharacterFormat = new CharacterFormat(listLevel);
            listLevel.NumberFormat = "%1.";
            listLevel.StartAt = 1;
            this.list.AbstractList.Levels._Add(listLevel);
        };
        ListDialogVieModel.prototype._AddListLevels = function () {
            if (this.list != null && this.list.AbstractList != null) {
                for (var i = this.list.AbstractList.Levels.Count; i < 9; i++) {
                    var listLevelAdv = new ListLevelAdv(this.list.AbstractList);
                    listLevelAdv.CharacterFormat = new CharacterFormat(listLevelAdv);
                    listLevelAdv.ParagraphFormat = new ParagraphFormat(listLevelAdv);
                    listLevelAdv.ParagraphFormat.LeftIndent = (i + 1) * 48;
                    listLevelAdv.ParagraphFormat.FirstLineIndent = -24;
                    listLevelAdv.NumberFormat = "%" + (i + 1).toString() + ".";
                    listLevelAdv.ListLevelPattern = i % 3;
                    listLevelAdv.FollowCharacter = FollowCharacterType.Tab;
                    listLevelAdv.StartAt = 1;
                    listLevelAdv.RestartLevel = i;
                    this.list.AbstractList.Levels._Add(listLevelAdv);
                }
            }
        };
        ListDialogVieModel.prototype._NotifyPropertyChanged = function (property) {
            switch (property) {
                case "ListLevel":
                    return this.ListLevel;
            }
        };
        ListDialogVieModel.prototype._Dispose = function () {
            this.list = null;
        };
        return ListDialogVieModel;
    }());
    DocumentEditorFeatures.ListDialogVieModel = ListDialogVieModel;
    var SectionFormat = (function (_super) {
        __extends(SectionFormat, _super);
        function SectionFormat(node) {
            _super.call(this, node);
            this.propertyFlag = 0;
        }
        Object.defineProperty(SectionFormat.prototype, "HeaderDistance", {
            get: function () {
                return this._GetValue(SectionFormat.HeaderDistanceProperty);
            },
            set: function (value) {
                this._SetValue(SectionFormat.HeaderDistanceProperty, value);
                this._RelayoutForSectionFormat();
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(SectionFormat.prototype, "FooterDistance", {
            get: function () {
                return this._GetValue(SectionFormat.FooterDistanceProperty);
            },
            set: function (value) {
                this._SetValue(SectionFormat.FooterDistanceProperty, value);
                this._RelayoutForSectionFormat();
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(SectionFormat.prototype, "DifferentFirstPage", {
            get: function () {
                return this._GetValue(SectionFormat.DifferentFirstPageProperty);
            },
            set: function (value) {
                this._SetValue(SectionFormat.DifferentFirstPageProperty, value);
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(SectionFormat.prototype, "DifferentOddAndEvenPages", {
            get: function () {
                return this._GetValue(SectionFormat.DifferentOddAndEvenPagesProperty);
            },
            set: function (value) {
                this._SetValue(SectionFormat.DifferentOddAndEvenPagesProperty, value);
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(SectionFormat.prototype, "PageWidth", {
            get: function () {
                return this._GetValue(SectionFormat.PageWidthProperty);
            },
            set: function (value) {
                this._SetValue(SectionFormat.PageWidthProperty, value);
                this._RelayoutForSectionFormat();
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(SectionFormat.prototype, "PageHeight", {
            get: function () {
                return this._GetValue(SectionFormat.PageHeightProperty);
            },
            set: function (value) {
                this._SetValue(SectionFormat.PageHeightProperty, value);
                this._RelayoutForSectionFormat();
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(SectionFormat.prototype, "LeftMargin", {
            get: function () {
                return this._GetValue(SectionFormat.LeftMarginProperty);
            },
            set: function (value) {
                this._SetValue(SectionFormat.LeftMarginProperty, value);
                this._RelayoutForSectionFormat();
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(SectionFormat.prototype, "TopMargin", {
            get: function () {
                return this._GetValue(SectionFormat.TopMarginProperty);
            },
            set: function (value) {
                this._SetValue(SectionFormat.TopMarginProperty, value);
                this._RelayoutForSectionFormat();
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(SectionFormat.prototype, "RightMargin", {
            get: function () {
                return this._GetValue(SectionFormat.RightMarginProperty);
            },
            set: function (value) {
                this._SetValue(SectionFormat.RightMarginProperty, value);
                this._RelayoutForSectionFormat();
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(SectionFormat.prototype, "BottomMargin", {
            get: function () {
                return this._GetValue(SectionFormat.BottomMarginProperty);
            },
            set: function (value) {
                this._SetValue(SectionFormat.BottomMarginProperty, value);
                this._RelayoutForSectionFormat();
            },
            enumerable: true,
            configurable: true
        });
        SectionFormat.prototype._HasValue = function (property) {
            switch (property) {
                case SectionFormat.HeaderDistanceProperty:
                    return (this.propertyFlag & 1) == 1;
                case SectionFormat.FooterDistanceProperty:
                    return (this.propertyFlag & 2) == 2;
                case SectionFormat.BottomMarginProperty:
                    return (this.propertyFlag & 4) == 4;
                case SectionFormat.TopMarginProperty:
                    return (this.propertyFlag & 8) == 8;
                case SectionFormat.DifferentFirstPageProperty:
                    return (this.propertyFlag & 16) == 16;
                case SectionFormat.DifferentOddAndEvenPagesProperty:
                    return (this.propertyFlag & 32) == 32;
                case SectionFormat.PageHeightProperty:
                    return (this.propertyFlag & 64) == 64;
                case SectionFormat.PageWidthProperty:
                    return (this.propertyFlag & 128) == 128;
                case SectionFormat.LeftMarginProperty:
                    return (this.propertyFlag & 256) == 256;
                case SectionFormat.RightMarginProperty:
                    return (this.propertyFlag & 512) == 512;
                default:
                    return false;
            }
        };
        SectionFormat.prototype._SetValue = function (property, value) {
            if (value == undefined) {
                return;
            }
            var hasValue = this._HasValue(property);
            var flag = 0;
            switch (property) {
                case SectionFormat.HeaderDistanceProperty:
                    flag |= 1;
                    this.headerDistance = value;
                    break;
                case SectionFormat.FooterDistanceProperty:
                    flag |= 2;
                    this.footerDistance = value;
                    break;
                case SectionFormat.BottomMarginProperty:
                    flag |= 4;
                    this.bottomMargin = value;
                    break;
                case SectionFormat.TopMarginProperty:
                    flag |= 8;
                    this.topMargin = value;
                    break;
                case SectionFormat.DifferentFirstPageProperty:
                    flag |= 16;
                    this.differentFirstPage = value;
                    break;
                case SectionFormat.DifferentOddAndEvenPagesProperty:
                    flag |= 32;
                    this.differentOddAndEvenPages = value;
                    break;
                case SectionFormat.PageHeightProperty:
                    flag |= 64;
                    this.pageHeight = value;
                    break;
                case SectionFormat.PageWidthProperty:
                    flag |= 128;
                    this.pageWidth = value;
                    break;
                case SectionFormat.LeftMarginProperty:
                    flag |= 256;
                    this.leftMargin = value;
                    break;
                case SectionFormat.RightMarginProperty:
                    flag |= 512;
                    this.rightMargin = value;
            }
            if (!hasValue) {
                this.propertyFlag |= flag;
            }
        };
        SectionFormat.prototype._GetValue = function (property) {
            var hasValue = this._HasValue(property);
            var isDefault = !hasValue;
            var value;
            switch (property) {
                case SectionFormat.HeaderDistanceProperty:
                    if (isDefault)
                        value = 48;
                    else
                        value = this.headerDistance;
                    break;
                case SectionFormat.FooterDistanceProperty:
                    if (isDefault)
                        value = 48;
                    else
                        value = this.footerDistance;
                    break;
                case SectionFormat.BottomMarginProperty:
                    if (isDefault)
                        value = 96;
                    else
                        value = this.bottomMargin;
                    break;
                case SectionFormat.TopMarginProperty:
                    if (isDefault)
                        value = 96;
                    else
                        value = this.topMargin;
                    break;
                case SectionFormat.DifferentFirstPageProperty:
                    if (isDefault)
                        value = false;
                    else
                        value = this.differentFirstPage;
                    break;
                case SectionFormat.DifferentOddAndEvenPagesProperty:
                    if (isDefault)
                        value = false;
                    else
                        value = this.differentOddAndEvenPages;
                    break;
                case SectionFormat.PageHeightProperty:
                    if (isDefault)
                        value = 1056;
                    else
                        value = this.pageHeight;
                    break;
                case SectionFormat.PageWidthProperty:
                    if (isDefault)
                        value = 816;
                    else
                        value = this.pageWidth;
                    break;
                case SectionFormat.LeftMarginProperty:
                    if (isDefault)
                        value = 96;
                    else
                        value = this.leftMargin;
                    break;
                case SectionFormat.RightMarginProperty:
                    if (isDefault)
                        value = 96;
                    else
                        value = this.rightMargin;
                    break;
            }
            return value;
        };
        SectionFormat.prototype._ClearValue = function (property) {
            switch (property) {
                case SectionFormat.HeaderDistanceProperty:
                    this.propertyFlag = this.propertyFlag ^ 1;
                case SectionFormat.FooterDistanceProperty:
                    this.propertyFlag = this.propertyFlag ^ 2;
                case SectionFormat.BottomMarginProperty:
                    this.propertyFlag = this.propertyFlag ^ 4;
                case SectionFormat.TopMarginProperty:
                    this.propertyFlag = this.propertyFlag ^ 8;
                case SectionFormat.DifferentFirstPageProperty:
                    this.propertyFlag = this.propertyFlag ^ 16;
                case SectionFormat.DifferentOddAndEvenPagesProperty:
                    this.propertyFlag = this.propertyFlag ^ 32;
                case SectionFormat.PageHeightProperty:
                    this.propertyFlag = this.propertyFlag ^ 64;
                case SectionFormat.PageWidthProperty:
                    this.propertyFlag = this.propertyFlag ^ 128;
                case SectionFormat.LeftMarginProperty:
                    this.propertyFlag = this.propertyFlag ^ 256;
                case SectionFormat.RightMarginProperty:
                    this.propertyFlag = this.propertyFlag ^ 512;
            }
        };
        SectionFormat.prototype._RelayoutForSectionFormat = function () {
            if (this.OwnerBase instanceof SectionAdv && this.OwnerBase.BaseParent != null) {
                var verticalScrolValue = 0;
                var horizontalScrolValue = 0;
                if (this.OwnerBase.BaseParent != null
                    && this.OwnerBase.BaseParent.IsDocumentLoaded
                    && this.OwnerBase.BaseParent.IsLayoutEnabled) {
                    if (this.OwnerBase.BaseParent.Viewer.VerticalScrollBar != null)
                        verticalScrolValue = this.OwnerBase.BaseParent.Viewer.VerticalScrollBar.model.value;
                    if (this.OwnerBase.BaseParent.Viewer.HorizontalScrollBar != null)
                        horizontalScrolValue = this.OwnerBase.BaseParent.Viewer.HorizontalScrollBar.model.value;
                }
                var viewer = void 0;
                this.OwnerBase.Document._LayoutItems(viewer);
                if (this.OwnerBase.BaseParent != null
                    && this.OwnerBase.BaseParent.IsDocumentLoaded
                    && this.OwnerBase.BaseParent.IsLayoutEnabled) {
                    if (this.OwnerBase.BaseParent.Viewer.VerticalScrollBar != null)
                        this.OwnerBase.BaseParent.Viewer.VerticalScrollBar.model.value = verticalScrolValue;
                    if (this.OwnerBase.BaseParent.Viewer.HorizontalScrollBar != null)
                        this.OwnerBase.BaseParent.Viewer.HorizontalScrollBar.model.value = horizontalScrolValue;
                }
            }
        };
        SectionFormat.prototype._ApplyPropertyValue = function (baseHistoryInfo, property, value) {
            if (baseHistoryInfo != null)
                value = baseHistoryInfo._AddModifiedPropertiesForSectionFormat(this, property, value);
            if (property == "PageSizeProperty") {
                this.PageWidth = value.Width;
                this.PageHeight = value.Height;
            }
            else if (property == "PageMarginProperty") {
                this.LeftMargin = value.Left;
                this.RightMargin = value.Right;
                this.TopMargin = value.Top;
                this.BottomMargin = value.Bottom;
            }
        };
        SectionFormat.prototype._CopyFormat = function (format) {
            if (format.PageHeight != null && format.PageWidth != undefined)
                this.PageHeight = format.PageHeight;
            if (format.PageWidth != null && format.PageWidth != undefined)
                this.PageWidth = format.PageWidth;
            if (format.LeftMargin != null && format.LeftMargin != undefined)
                this.LeftMargin = format.LeftMargin;
            if (format.RightMargin != null && format.RightMargin != undefined)
                this.RightMargin = format.RightMargin;
            if (format.TopMargin != null && format.TopMargin != undefined)
                this.TopMargin = format.TopMargin;
            if (format.BottomMargin != null && format.BottomMargin != undefined)
                this.BottomMargin = format.BottomMargin;
            if (format.HeaderDistance != null && format.HeaderDistance != undefined)
                this.HeaderDistance = format.HeaderDistance;
            if (format.FooterDistance != null && format.FooterDistance != undefined)
                this.FooterDistance = format.FooterDistance;
        };
        SectionFormat.prototype._GetSectionPropertyValue = function (property, modifiedProperty) {
            var value;
            if (property == "PageSizeProperty") {
                value = new Size(null, null);
                value.Height = modifiedProperty.PageHeight;
                value.Width = modifiedProperty.PageWidth;
            }
            else if (property == "PageMarginProperty") {
                value = new Thickness(null, null, null, null);
                value.Left = modifiedProperty.LeftMargin;
                value.Right = modifiedProperty.RightMargin;
                value.Top = modifiedProperty.TopMargin;
                value.Bottom = modifiedProperty.BottomMargin;
            }
            return value;
        };
        SectionFormat.prototype._SerializeSectionFormat = function () {
            var sFormat = {
                "BottomMargin": [], "DifferentFirstPage": [], "DifferentOddAndEvenPages": [], "FooterDistance": [],
                "HeaderDistance": [], "LeftMargin": [], "PageHeight": [], "PageWidth": [], "RightMargin": [],
                "TopMargin": []
            };
            if (this._HasValue(SectionFormat.BottomMarginProperty))
                sFormat.BottomMargin = this.BottomMargin;
            else
                sFormat.BottomMargin = null;
            if (this._HasValue(SectionFormat.DifferentFirstPageProperty))
                sFormat.DifferentFirstPage = this.DifferentFirstPage;
            else
                sFormat.DifferentFirstPage = null;
            if (this._HasValue(SectionFormat.DifferentOddAndEvenPagesProperty))
                sFormat.DifferentOddAndEvenPages = this.DifferentOddAndEvenPages;
            else
                sFormat.DifferentOddAndEvenPages = null;
            if (this._HasValue(SectionFormat.FooterDistanceProperty))
                sFormat.FooterDistance = this.FooterDistance;
            else
                sFormat.FooterDistance = null;
            if (this._HasValue(SectionFormat.HeaderDistanceProperty))
                sFormat.HeaderDistance = this.HeaderDistance;
            else
                sFormat.HeaderDistance = null;
            if (this._HasValue(SectionFormat.LeftMarginProperty))
                sFormat.LeftMargin = this.LeftMargin;
            else
                sFormat.LeftMargin = null;
            if (this._HasValue(SectionFormat.PageHeightProperty))
                sFormat.PageHeight = this.PageHeight;
            else
                sFormat.PageHeight = null;
            if (this._HasValue(SectionFormat.PageWidthProperty))
                sFormat.PageWidth = this.PageWidth;
            else
                sFormat.PageWidth = null;
            if (this._HasValue(SectionFormat.RightMarginProperty))
                sFormat.RightMargin = this.RightMargin;
            else
                sFormat.RightMargin = null;
            if (this._HasValue(SectionFormat.TopMarginProperty))
                sFormat.TopMargin = this.TopMargin;
            else
                sFormat.TopMargin = null;
            return sFormat;
        };
        SectionFormat.prototype._Dispose = function () {
            this._SetOwner(null);
        };
        SectionFormat.HeaderDistanceProperty = "HeaderDistance";
        SectionFormat.FooterDistanceProperty = "FooterDistance";
        SectionFormat.DifferentFirstPageProperty = "DifferentFirstPage";
        SectionFormat.DifferentOddAndEvenPagesProperty = "DifferentOddAndEvenPages";
        SectionFormat.PageWidthProperty = "PageWidth";
        SectionFormat.PageHeightProperty = "PageHeight";
        SectionFormat.LeftMarginProperty = "LeftMargin";
        SectionFormat.TopMarginProperty = "TopMargin";
        SectionFormat.RightMarginProperty = "RightMargin";
        SectionFormat.BottomMarginProperty = "BottomMargin";
        return SectionFormat;
    }(CompositeNode));
    DocumentEditorFeatures.SectionFormat = SectionFormat;
    var CharacterFormat = (function (_super) {
        __extends(CharacterFormat, _super);
        function CharacterFormat(node) {
            _super.call(this, node);
            this.propertyFlag = 0;
        }
        Object.defineProperty(CharacterFormat.prototype, "Bold", {
            get: function () {
                return this._GetPropertyValue(CharacterFormat.BoldProperty);
            },
            set: function (value) {
                this._SetValue(CharacterFormat.BoldProperty, value);
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(CharacterFormat.prototype, "Italic", {
            get: function () {
                return this._GetPropertyValue(CharacterFormat.ItalicProperty);
            },
            set: function (value) {
                this._SetValue(CharacterFormat.ItalicProperty, value);
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(CharacterFormat.prototype, "FontSize", {
            get: function () {
                return this._GetPropertyValue(CharacterFormat.FontSizeProperty);
            },
            set: function (value) {
                this._SetValue(CharacterFormat.FontSizeProperty, value);
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(CharacterFormat.prototype, "FontFamily", {
            get: function () {
                return this._GetPropertyValue(CharacterFormat.FontFamilyProperty);
            },
            set: function (value) {
                this._SetValue(CharacterFormat.FontFamilyProperty, value);
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(CharacterFormat.prototype, "Underline", {
            get: function () {
                return this._GetPropertyValue(CharacterFormat.UnderlineProperty);
            },
            set: function (value) {
                this._SetValue(CharacterFormat.UnderlineProperty, value);
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(CharacterFormat.prototype, "StrikeThrough", {
            get: function () {
                return this._GetPropertyValue(CharacterFormat.StrikeThroughProperty);
            },
            set: function (value) {
                this._SetValue(CharacterFormat.StrikeThroughProperty, value);
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(CharacterFormat.prototype, "BaselineAlignment", {
            get: function () {
                return this._GetPropertyValue(CharacterFormat.BaselineAlignmentProperty);
            },
            set: function (value) {
                this._SetValue(CharacterFormat.BaselineAlignmentProperty, value);
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(CharacterFormat.prototype, "HighlightColor", {
            get: function () {
                return this._GetPropertyValue(CharacterFormat.HighlightColorProperty);
            },
            set: function (value) {
                this._SetValue(CharacterFormat.HighlightColorProperty, value);
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(CharacterFormat.prototype, "FontColor", {
            get: function () {
                return this._GetPropertyValue(CharacterFormat.FontColorProperty);
            },
            set: function (value) {
                this._SetValue(CharacterFormat.FontColorProperty, value);
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(CharacterFormat.prototype, "OwnerDocument", {
            get: function () {
                if (this.OwnerBase instanceof Inline
                    && this.OwnerBase.OwnerParagraph != null
                    && this.OwnerBase.OwnerParagraph.Document != null)
                    return this.OwnerBase.OwnerParagraph.Document;
                else if (this.OwnerBase instanceof ParagraphAdv
                    && this.OwnerBase.Document != null)
                    return this.OwnerBase.Document;
                else if (this.OwnerBase instanceof ListLevelAdv)
                    return this.OwnerBase.OwnerDocument;
                else if (this.OwnerBase instanceof DocumentAdv)
                    return this.OwnerBase;
                return null;
            },
            enumerable: true,
            configurable: true
        });
        CharacterFormat.prototype._HasValue = function (property) {
            switch (property) {
                case CharacterFormat.BoldProperty:
                    return (this.propertyFlag & 1) == 1;
                case CharacterFormat.ItalicProperty:
                    return (this.propertyFlag & 2) == 2;
                case CharacterFormat.FontSizeProperty:
                    return (this.propertyFlag & 4) == 4;
                case CharacterFormat.FontFamilyProperty:
                    return (this.propertyFlag & 8) == 8;
                case CharacterFormat.UnderlineProperty:
                    return (this.propertyFlag & 16) == 16;
                case CharacterFormat.StrikeThroughProperty:
                    return (this.propertyFlag & 32) == 32;
                case CharacterFormat.BaselineAlignmentProperty:
                    return (this.propertyFlag & 64) == 64;
                case CharacterFormat.HighlightColorProperty:
                    return (this.propertyFlag & 128) == 128;
                case CharacterFormat.FontColorProperty:
                    return (this.propertyFlag & 256) == 256;
                default:
                    return false;
            }
        };
        CharacterFormat.prototype._ClearValue = function (property) {
            switch (property) {
                case CharacterFormat.BoldProperty:
                    this.propertyFlag = this.propertyFlag ^ 1;
                case CharacterFormat.ItalicProperty:
                    this.propertyFlag = this.propertyFlag ^ 2;
                case CharacterFormat.FontSizeProperty:
                    this.propertyFlag = this.propertyFlag ^ 4;
                case CharacterFormat.FontFamilyProperty:
                    this.propertyFlag = this.propertyFlag ^ 8;
                case CharacterFormat.UnderlineProperty:
                    this.propertyFlag = this.propertyFlag ^ 16;
                case CharacterFormat.StrikeThroughProperty:
                    this.propertyFlag = this.propertyFlag ^ 32;
                case CharacterFormat.BaselineAlignmentProperty:
                    this.propertyFlag = this.propertyFlag ^ 64;
                case CharacterFormat.HighlightColorProperty:
                    this.propertyFlag = this.propertyFlag ^ 128;
                case CharacterFormat.FontColorProperty:
                    this.propertyFlag = this.propertyFlag ^ 256;
            }
        };
        CharacterFormat.prototype._SetValue = function (property, value) {
            if (value == undefined) {
                return;
            }
            var hasValue = this._HasValue(property);
            var flag = 0;
            switch (property) {
                case CharacterFormat.BoldProperty:
                    flag |= 1;
                    this.bold = value;
                    break;
                case CharacterFormat.ItalicProperty:
                    flag |= 2;
                    this.italic = value;
                    break;
                case CharacterFormat.FontSizeProperty:
                    flag |= 4;
                    this.fontSize = value;
                    break;
                case CharacterFormat.FontFamilyProperty:
                    flag |= 8;
                    this.fontFamily = value;
                    break;
                case CharacterFormat.UnderlineProperty:
                    flag |= 16;
                    this.underline = value;
                    break;
                case CharacterFormat.StrikeThroughProperty:
                    flag |= 32;
                    this.strikeThrough = value;
                    break;
                case CharacterFormat.BaselineAlignmentProperty:
                    flag |= 64;
                    this.baselineAlignment = value;
                    break;
                case CharacterFormat.HighlightColorProperty:
                    flag |= 128;
                    this.highlightColor = value;
                    break;
                case CharacterFormat.FontColorProperty:
                    flag |= 256;
                    this.fontColor = value;
                    break;
            }
            if (!hasValue) {
                this.propertyFlag |= flag;
            }
        };
        CharacterFormat.prototype._GetValue = function (property, isDefault) {
            var value;
            switch (property) {
                case CharacterFormat.BoldProperty:
                    if (isDefault)
                        value = false;
                    else
                        value = this.bold;
                    break;
                case CharacterFormat.ItalicProperty:
                    if (isDefault)
                        value = false;
                    else
                        value = this.italic;
                    break;
                case CharacterFormat.FontSizeProperty:
                    if (isDefault)
                        value = 11;
                    else
                        value = this.fontSize;
                    break;
                case CharacterFormat.FontFamilyProperty:
                    if (isDefault)
                        value = "verdana";
                    else
                        value = this.fontFamily;
                    break;
                case CharacterFormat.UnderlineProperty:
                    if (isDefault)
                        value = Underline.None;
                    else
                        value = this.underline;
                    break;
                case CharacterFormat.StrikeThroughProperty:
                    if (isDefault)
                        value = StrikeThrough.None;
                    else
                        value = this.strikeThrough;
                    break;
                case CharacterFormat.BaselineAlignmentProperty:
                    if (isDefault)
                        value = BaselineAlignment.Normal;
                    else
                        value = this.baselineAlignment;
                    break;
                case CharacterFormat.HighlightColorProperty:
                    if (isDefault)
                        value = HighlightColor.NoColor;
                    else
                        value = this.highlightColor;
                    break;
                case CharacterFormat.FontColorProperty:
                    if (isDefault)
                        value = "empty";
                    else
                        value = this.fontColor;
                    break;
            }
            return value;
        };
        CharacterFormat.prototype._GetPropertyValue = function (property) {
            var hasValue = this._HasValue(property);
            if (hasValue) {
                return this._GetValue(property, false);
            }
            else {
                if (this.OwnerBase instanceof Inline || this.OwnerBase instanceof ParagraphAdv) {
                    var doc = this.OwnerDocument;
                    if (doc != null)
                        return doc.CharacterFormat._GetPropertyValue(property);
                }
                else if (this.OwnerBase instanceof DocumentAdv) {
                    return this._GetDefaultValue(property);
                }
            }
            return this._GetValue(property, true);
        };
        CharacterFormat.prototype._GetDefaultValue = function (property) {
            var value = null;
            var document = this.OwnerBase;
            value = this._GetControlDefaultValue(document.OwnerControl, property);
            if (value == null) {
                value = this._GetValue(property, true);
            }
            return value;
        };
        CharacterFormat.prototype._GetControlDefaultValue = function (ownerControl, property) {
            var element;
            if (ownerControl == null || ownerControl.DocumentEditorElement == null)
                return null;
            element = ownerControl.DocumentEditorElement;
            if (property == CharacterFormat.FontColorProperty) {
                return this._GetDefaultFontColor(ownerControl.Document);
            }
            else if (property == CharacterFormat.FontFamilyProperty) {
                if (element.style.fontFamily != "")
                    return element.style.fontFamily;
                return null;
            }
            else if (property == CharacterFormat.FontSizeProperty) {
                if (element.style.fontSize != "")
                    return parseFloat(element.style.fontSize);
                return null;
            }
            else if (property == CharacterFormat.BoldProperty) {
                return null;
            }
            else if (property == CharacterFormat.ItalicProperty) {
                if (element.style.fontStyle.toLowerCase() == "italic")
                    return true;
                return null;
            }
            return null;
        };
        CharacterFormat.prototype._GetDefaultFontColor = function (document) {
            if (document == null)
                return;
            var backColor = document.BackgroundColor;
            if (HelperMethods._IsVeryDark(backColor))
                return "#FFFFFF";
            else
                return "#000000";
        };
        CharacterFormat.prototype._GetCharacterPropertyValue = function (property, modifiedProperty) {
            var value;
            if (property == CharacterFormat.BoldProperty)
                value = modifiedProperty.Bold;
            else if (property == CharacterFormat.ItalicProperty)
                value = modifiedProperty.Italic;
            else if (property == CharacterFormat.FontColorProperty)
                value = modifiedProperty.FontColor;
            else if (property == CharacterFormat.FontFamilyProperty)
                value = modifiedProperty.FontFamily;
            else if (property == CharacterFormat.FontSizeProperty)
                value = modifiedProperty.FontSize;
            else if (property == CharacterFormat.HighlightColorProperty)
                value = modifiedProperty.HighlightColor;
            else if (property == CharacterFormat.BaselineAlignmentProperty)
                value = modifiedProperty.BaselineAlignment;
            else if (property == CharacterFormat.StrikeThroughProperty)
                value = modifiedProperty.StrikeThrough;
            else if (property == CharacterFormat.UnderlineProperty)
                value = modifiedProperty.Underline;
            return value;
        };
        CharacterFormat.prototype._CloneFormat = function () {
            var sourceFormat = new CharacterFormat(null);
            if (sourceFormat.BaselineAlignment != undefined && sourceFormat.BaselineAlignment != null)
                sourceFormat.BaselineAlignment = this.BaselineAlignment;
            if (sourceFormat.Underline != undefined && sourceFormat.Underline != null)
                sourceFormat.Underline = this.Underline;
            if (sourceFormat.StrikeThrough != undefined && sourceFormat.StrikeThrough != null)
                sourceFormat.StrikeThrough = this.StrikeThrough;
            if (sourceFormat.FontSize != undefined && sourceFormat.FontSize != null)
                sourceFormat.FontSize = this.FontSize;
            if (sourceFormat.FontFamily != undefined && sourceFormat.FontFamily != null)
                sourceFormat.FontFamily = this.FontFamily;
            if (sourceFormat.Bold != undefined && sourceFormat.Bold != null)
                sourceFormat.Bold = this.Bold;
            if (sourceFormat.Italic != undefined && sourceFormat.Italic != null)
                sourceFormat.Italic = this.Italic;
            if (sourceFormat.HighlightColor != undefined && sourceFormat.HighlightColor != null)
                sourceFormat.HighlightColor = this.HighlightColor;
            if (sourceFormat.FontColor != undefined && sourceFormat.FontColor != null)
                sourceFormat.FontColor = this.FontColor;
            return sourceFormat;
        };
        CharacterFormat.prototype._CopyFormat = function (sourceFormat) {
            if (sourceFormat.baselineAlignment != undefined && sourceFormat.baselineAlignment != null)
                this.BaselineAlignment = sourceFormat.baselineAlignment;
            if (sourceFormat.underline != undefined && sourceFormat.underline != null)
                this.Underline = sourceFormat.underline;
            if (sourceFormat.strikeThrough != undefined && sourceFormat.strikeThrough != null)
                this.StrikeThrough = sourceFormat.strikeThrough;
            if (sourceFormat.fontSize != undefined && sourceFormat.fontSize != null)
                this.FontSize = sourceFormat.fontSize;
            if (sourceFormat.fontFamily != undefined && sourceFormat.fontFamily != null)
                this.FontFamily = sourceFormat.fontFamily;
            if (sourceFormat.bold != undefined && sourceFormat.bold != null)
                this.Bold = sourceFormat.bold;
            if (sourceFormat.italic != undefined && sourceFormat.italic != null)
                this.Italic = sourceFormat.italic;
            if (sourceFormat.highlightColor != undefined && sourceFormat.highlightColor != null)
                this.HighlightColor = sourceFormat.highlightColor;
            if (sourceFormat.fontColor != undefined && sourceFormat.fontColor != null)
                this.FontColor = sourceFormat.fontColor;
        };
        CharacterFormat.prototype._GetAsHtmlStyle = function () {
            var style = "style=\"";
            if (this.Bold)
                style += "font-weight:bold; ";
            else
                style += "font-weight:normal; ";
            if (this.Italic)
                style += "font-style:italic; ";
            else
                style += "font-style:normal; ";
            if (this.Underline != Underline.None)
                style += "text-decoration:underline; ";
            if (this.StrikeThrough != StrikeThrough.None)
                style += "text-decoration:line-through; ";
            if (this.BaselineAlignment == BaselineAlignment.Subscript)
                style += "vertical-align:sub;";
            else if (this.BaselineAlignment == BaselineAlignment.Superscript)
                style += "vertical-align:super; ";
            this.FontColor = this.FontColor.replace(/"/g, '');
            this.FontFamily = this.FontFamily.replace(/"/g, '');
            style += "color:" + this.FontColor + "; "
                + "font-family:" + this.FontFamily + "; "
                + "font-size:" + this.FontSize + "px; ";
            if (this.HighlightColor != HighlightColor.NoColor)
                style += "background:" + HelperMethods._GetHighlightColorCode(this.HighlightColor);
            style += "\" ";
            return style;
        };
        CharacterFormat.prototype._IsEqualFormat = function (format) {
            return (this.FontSize == format.FontSize
                && this.FontFamily == format.FontFamily
                && this.Bold == format.Bold
                && this.Italic == format.Italic
                && this.BaselineAlignment == format.BaselineAlignment
                && this.Underline == format.Underline
                && this.FontColor == format.FontColor
                && this.StrikeThrough == format.StrikeThrough
                && this.HighlightColor == format.HighlightColor);
        };
        CharacterFormat.prototype._Relayout = function () {
            if (this.OwnerBase instanceof DocumentAdv) {
                var verticalScrolValue = 0;
                var horizontalScrolValue = 0;
                if (this.OwnerBase.OwnerControl != null
                    && this.OwnerBase.OwnerControl.IsDocumentLoaded
                    && this.OwnerBase.OwnerControl.IsLayoutEnabled) {
                    if (this.OwnerBase.OwnerControl.Viewer.VerticalScrollBar != null)
                        verticalScrolValue = this.OwnerBase.OwnerControl.Viewer.VerticalScrollBar.model.value;
                    if (this.OwnerBase.OwnerControl.Viewer.HorizontalScrollBar != null)
                        horizontalScrolValue = this.OwnerBase.OwnerControl.Viewer.HorizontalScrollBar.model.value;
                }
                this.OwnerBase._LayoutItems(this.OwnerBase.OwnerControl.Viewer);
                if (this.OwnerBase.OwnerControl != null
                    && this.OwnerBase.OwnerControl.IsDocumentLoaded
                    && this.OwnerBase.OwnerControl.IsLayoutEnabled) {
                    if (this.OwnerBase.OwnerControl.Viewer.VerticalScrollBar != null)
                        this.OwnerBase.OwnerControl.Viewer.VerticalScrollBar.setModel["value", verticalScrolValue];
                    if (this.OwnerBase.OwnerControl.Viewer.HorizontalScrollBar != null)
                        this.OwnerBase.OwnerControl.Viewer.HorizontalScrollBar.setModel["value", horizontalScrolValue];
                }
            }
            else if (this.OwnerBase instanceof ParagraphAdv)
                this.OwnerBase._RelayoutWithIndex(0);
            else if (this.OwnerBase instanceof Inline
                && this.OwnerBase.OwnerParagraph != null) {
                var index = this.OwnerBase.OwnerParagraph.Inlines._IndexOf(this.OwnerBase);
                this.OwnerBase.OwnerParagraph._RelayoutWithIndex(index);
            }
        };
        CharacterFormat.prototype._HandleCharacterFormat = function (format) {
            var document = this.OwnerDocument;
            if (document != null && document.OwnerControl != null)
                document.OwnerControl.IsLayoutEnabled = false;
            this._CopyFormat(format);
            if (document != null && document.OwnerControl != null)
                document.OwnerControl.IsLayoutEnabled = true;
            this._Relayout();
        };
        CharacterFormat.prototype._ApplyPropertyValueInternal = function (baseHistoryInfo, property, value) {
            this._ApplyPropertyValue(baseHistoryInfo, property, value, false);
        };
        CharacterFormat.prototype._ApplyPropertyValue = function (baseHistoryInfo, property, value, update) {
            if (update && property == CharacterFormat.FontFamilyProperty)
                value = this._UpdateFontSize(value);
            if (baseHistoryInfo != null)
                value = baseHistoryInfo._AddModifiedProperties(this, property, value);
            if (value == DocumentEditorHelper.PropertyUnsetValue) {
                this._ClearValue(property);
                return;
            }
            if (value instanceof CharacterFormat) {
                this._HandleCharacterFormat(value);
                return;
            }
            if (property == CharacterFormat.BoldProperty)
                this.Bold = value;
            else if (property == CharacterFormat.ItalicProperty)
                this.Italic = value;
            else if (property == CharacterFormat.FontColorProperty)
                this.FontColor = value;
            else if (property == CharacterFormat.FontFamilyProperty)
                this.FontFamily = value;
            else if (property == CharacterFormat.FontSizeProperty)
                this.FontSize = value;
            else if (property == CharacterFormat.HighlightColorProperty)
                this.HighlightColor = value;
            else if (property == CharacterFormat.BaselineAlignmentProperty)
                this.BaselineAlignment = value;
            else if (property == CharacterFormat.StrikeThroughProperty)
                this.StrikeThrough = value;
            else if (property == CharacterFormat.UnderlineProperty)
                this.Underline = value;
        };
        CharacterFormat.prototype._UpdateFontSize = function (value) {
            if (typeof (value) === "number" && !(value < 0 && this.FontSize == 1))
                return this.FontSize + value;
            var fontsizecollection = [8, 9, 10, 11, 12, 14, 16, 18, 20, 24, 26, 28, 36, 48, 72];
            if (typeof (value) === "string" && value == "increment") {
                if (this.FontSize < 8)
                    return this.FontSize + 1;
                else if (this.FontSize >= 72 && this.FontSize < 80)
                    return 80;
                else if (this.FontSize >= 80)
                    return this.FontSize + 10;
                else {
                    for (var i = 0; i < fontsizecollection.length; i++) {
                        if (this.FontSize < fontsizecollection[i])
                            return fontsizecollection[i];
                    }
                }
            }
            else if (typeof (value) === "string" && value == "decrement" && this.FontSize > 1) {
                if (this.FontSize <= 8)
                    return this.FontSize - 1;
                else if (this.FontSize > 72 && this.FontSize <= 80)
                    return 72;
                else if (this.FontSize > 80)
                    return this.FontSize - 10;
                else {
                    for (var i = 0; i < fontsizecollection.length; i++) {
                        if (this.FontSize <= fontsizecollection[i])
                            return fontsizecollection[i - 1];
                    }
                }
            }
            return this.FontSize;
        };
        CharacterFormat.prototype._Dispose = function () {
            this._SetOwner(null);
        };
        CharacterFormat.prototype._SerializeCharacterFormat = function () {
            var cFormat = {
                "BaselineAlignment": [], "Bold": [], "FontColor": [], "FontFamily": [], "FontSize": [], "HighlightColor": [], "Italic": [], "StrikeThrough": [], "Underline": []
            };
            if (this._HasValue(CharacterFormat.BaselineAlignmentProperty))
                cFormat.BaselineAlignment = this.BaselineAlignment;
            else
                cFormat.BaselineAlignment = null;
            if (this._HasValue(CharacterFormat.BoldProperty))
                cFormat.Bold = this.Bold;
            else
                cFormat.Bold = null;
            if (this._HasValue(CharacterFormat.FontColorProperty))
                cFormat.FontColor = this.FontColor;
            else
                cFormat.FontColor = null;
            if (this._HasValue(CharacterFormat.FontFamilyProperty))
                cFormat.FontFamily = this.FontFamily;
            else
                cFormat.FontFamily = null;
            if (this._HasValue(CharacterFormat.FontSizeProperty))
                cFormat.FontSize = this.FontSize;
            else
                cFormat.FontSize = null;
            if (this._HasValue(CharacterFormat.HighlightColorProperty))
                cFormat.HighlightColor = this.HighlightColor;
            else
                cFormat.HighlightColor = null;
            if (this._HasValue(CharacterFormat.ItalicProperty))
                cFormat.Italic = this.Italic;
            else
                cFormat.Italic = null;
            if (this._HasValue(CharacterFormat.StrikeThroughProperty))
                cFormat.StrikeThrough = this.StrikeThrough;
            else
                cFormat.StrikeThrough = null;
            if (this._HasValue(CharacterFormat.UnderlineProperty))
                cFormat.Underline = this.Underline;
            else
                cFormat.Underline = null;
            return cFormat;
        };
        CharacterFormat.BoldProperty = "Bold";
        CharacterFormat.ItalicProperty = "Italic";
        CharacterFormat.FontSizeProperty = "FontSize";
        CharacterFormat.FontFamilyProperty = "FontFamily";
        CharacterFormat.UnderlineProperty = "Underline";
        CharacterFormat.StrikeThroughProperty = "StrikeThrough";
        CharacterFormat.BaselineAlignmentProperty = "BaselineAlignment";
        CharacterFormat.HighlightColorProperty = "HighlightColor";
        CharacterFormat.FontColorProperty = "FontColor";
        return CharacterFormat;
    }(BaseNode));
    DocumentEditorFeatures.CharacterFormat = CharacterFormat;
    var ParagraphFormat = (function (_super) {
        __extends(ParagraphFormat, _super);
        function ParagraphFormat(node) {
            _super.call(this, node);
            this.propertyFlag = 0;
            this.ListFormat = new ListFormat(this);
        }
        Object.defineProperty(ParagraphFormat.prototype, "Document", {
            get: function () {
                if (this.OwnerBase instanceof ParagraphAdv
                    && this.OwnerBase.Document != null)
                    return this.OwnerBase.Document;
                else if (this.OwnerBase instanceof ListLevelAdv)
                    return this.OwnerBase.OwnerDocument;
                else if (this.OwnerBase instanceof DocumentAdv)
                    return this.OwnerBase;
                return null;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(ParagraphFormat.prototype, "LeftIndent", {
            get: function () {
                return this._GetPropertyValue(ParagraphFormat.LeftIndentProperty);
            },
            set: function (value) {
                this._SetValue(ParagraphFormat.LeftIndentProperty, value);
                this._RelayoutParagraph();
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(ParagraphFormat.prototype, "RightIndent", {
            get: function () {
                return this._GetPropertyValue(ParagraphFormat.RightIndentProperty);
            },
            set: function (value) {
                this._SetValue(ParagraphFormat.RightIndentProperty, value);
                this._RelayoutParagraph();
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(ParagraphFormat.prototype, "FirstLineIndent", {
            get: function () {
                return this._GetPropertyValue(ParagraphFormat.FirstLineIndentProperty);
            },
            set: function (value) {
                this._SetValue(ParagraphFormat.FirstLineIndentProperty, value);
                this._RelayoutParagraph();
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(ParagraphFormat.prototype, "BeforeSpacing", {
            get: function () {
                return this._GetPropertyValue(ParagraphFormat.BeforeSpacingProperty);
            },
            set: function (value) {
                this._ValidateSpacing(value);
                this._SetValue(ParagraphFormat.BeforeSpacingProperty, value);
                this._RelayoutParagraph();
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(ParagraphFormat.prototype, "AfterSpacing", {
            get: function () {
                return this._GetPropertyValue(ParagraphFormat.AfterSpacingProperty);
            },
            set: function (value) {
                this._ValidateSpacing(value);
                this._SetValue(ParagraphFormat.AfterSpacingProperty, value);
                this._RelayoutParagraph();
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(ParagraphFormat.prototype, "LineSpacing", {
            get: function () {
                return this._GetPropertyValue(ParagraphFormat.LineSpacingProperty);
            },
            set: function (value) {
                this._ValidateLineSpacing(value);
                this._SetValue(ParagraphFormat.LineSpacingProperty, value);
                this._RelayoutParagraph();
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(ParagraphFormat.prototype, "LineSpacingType", {
            get: function () {
                return this._GetPropertyValue(ParagraphFormat.LineSpacingTypeProperty);
            },
            set: function (value) {
                if (value == LineSpacingType.Multiple)
                    this.LineSpacing = 1;
                else
                    this.LineSpacing = 16;
                this._SetValue(ParagraphFormat.LineSpacingTypeProperty, value);
                this._RelayoutParagraph();
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(ParagraphFormat.prototype, "TextAlignment", {
            get: function () {
                return this._GetPropertyValue(ParagraphFormat.TextAlignmentProperty);
            },
            set: function (value) {
                this._SetValue(ParagraphFormat.TextAlignmentProperty, value);
                this._RelayoutParagraph();
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(ParagraphFormat.prototype, "ListFormat", {
            get: function () {
                return this._GetPropertyValue(ParagraphFormat.ListFormatProperty);
            },
            set: function (value) {
                this._SetValue(ParagraphFormat.ListFormatProperty, value);
                this._OnListFormatChanged(this.listFormat);
            },
            enumerable: true,
            configurable: true
        });
        ParagraphFormat.prototype._HasValue = function (property) {
            switch (property) {
                case ParagraphFormat.LeftIndentProperty:
                    return (this.propertyFlag & 1) == 1;
                case ParagraphFormat.RightIndentProperty:
                    return (this.propertyFlag & 2) == 2;
                case ParagraphFormat.FirstLineIndentProperty:
                    return (this.propertyFlag & 4) == 4;
                case ParagraphFormat.BeforeSpacingProperty:
                    return (this.propertyFlag & 8) == 8;
                case ParagraphFormat.AfterSpacingProperty:
                    return (this.propertyFlag & 16) == 16;
                case ParagraphFormat.LineSpacingProperty:
                    return (this.propertyFlag & 32) == 32;
                case ParagraphFormat.LineSpacingTypeProperty:
                    return (this.propertyFlag & 64) == 64;
                case ParagraphFormat.TextAlignmentProperty:
                    return (this.propertyFlag & 128) == 128;
                case ParagraphFormat.ListFormatProperty:
                    return (this.propertyFlag & 256) == 256;
                default:
                    return false;
            }
        };
        ParagraphFormat.prototype._SetValue = function (property, value) {
            if (value == undefined) {
                return;
            }
            var hasValue = this._HasValue(property);
            var flag = 0;
            switch (property) {
                case ParagraphFormat.LeftIndentProperty:
                    flag |= 1;
                    this.leftIndent = value;
                    break;
                case ParagraphFormat.RightIndentProperty:
                    flag |= 2;
                    this.rightIndent = value;
                    break;
                case ParagraphFormat.FirstLineIndentProperty:
                    flag |= 4;
                    this.firstLineIndent = value;
                    break;
                case ParagraphFormat.BeforeSpacingProperty:
                    flag |= 8;
                    this.beforeSpacing = value;
                    break;
                case ParagraphFormat.AfterSpacingProperty:
                    flag |= 16;
                    this.afterSpacing = value;
                    break;
                case ParagraphFormat.LineSpacingProperty:
                    flag |= 32;
                    this.lineSpacing = value;
                    break;
                case ParagraphFormat.LineSpacingTypeProperty:
                    flag |= 64;
                    this.lineSpacingType = value;
                    break;
                case ParagraphFormat.TextAlignmentProperty:
                    flag |= 128;
                    this.textalignment = value;
                    break;
                case ParagraphFormat.ListFormatProperty:
                    flag |= 256;
                    this.listFormat = value;
                    break;
            }
            if (!hasValue) {
                this.propertyFlag |= flag;
            }
        };
        ParagraphFormat.prototype._ClearValue = function (property) {
            switch (property) {
                case ParagraphFormat.LeftIndentProperty:
                    this.propertyFlag = this.propertyFlag ^ 1;
                case ParagraphFormat.RightIndentProperty:
                    this.propertyFlag = this.propertyFlag ^ 2;
                case ParagraphFormat.FirstLineIndentProperty:
                    this.propertyFlag = this.propertyFlag ^ 4;
                case ParagraphFormat.BeforeSpacingProperty:
                    this.propertyFlag = this.propertyFlag ^ 8;
                case ParagraphFormat.AfterSpacingProperty:
                    this.propertyFlag = this.propertyFlag ^ 16;
                case ParagraphFormat.LineSpacingProperty:
                    this.propertyFlag = this.propertyFlag ^ 32;
                case ParagraphFormat.LineSpacingTypeProperty:
                    this.propertyFlag = this.propertyFlag ^ 64;
                case ParagraphFormat.TextAlignmentProperty:
                    this.propertyFlag = this.propertyFlag ^ 128;
                case ParagraphFormat.ListFormatProperty:
                    this.propertyFlag = this.propertyFlag ^ 256;
            }
        };
        ParagraphFormat.prototype._GetValue = function (property, isDefault) {
            var value;
            switch (property) {
                case ParagraphFormat.LeftIndentProperty:
                    if (isDefault)
                        value = 0;
                    else
                        value = this.leftIndent;
                    break;
                case ParagraphFormat.RightIndentProperty:
                    if (isDefault)
                        value = 0;
                    else
                        value = this.rightIndent;
                    break;
                case ParagraphFormat.FirstLineIndentProperty:
                    if (isDefault)
                        value = 0;
                    else
                        value = this.firstLineIndent;
                    break;
                case ParagraphFormat.BeforeSpacingProperty:
                    if (isDefault)
                        value = 0;
                    else
                        value = this.beforeSpacing;
                    break;
                case ParagraphFormat.AfterSpacingProperty:
                    if (isDefault)
                        value = 0;
                    else
                        value = this.afterSpacing;
                    break;
                case ParagraphFormat.LineSpacingProperty:
                    if (isDefault)
                        value = 1;
                    else
                        value = this.lineSpacing;
                    break;
                case ParagraphFormat.LineSpacingTypeProperty:
                    if (isDefault)
                        value = LineSpacingType.Multiple;
                    else
                        value = this.lineSpacingType;
                    break;
                case ParagraphFormat.TextAlignmentProperty:
                    if (isDefault)
                        value = TextAlignment.Left;
                    else
                        value = this.textalignment;
                    break;
                case ParagraphFormat.ListFormatProperty:
                    if (isDefault)
                        value = null;
                    else
                        value = this.listFormat;
                    break;
            }
            return value;
        };
        ParagraphFormat.prototype._GetPropertyValue = function (property) {
            var hasValue = this._HasValue(property);
            if (hasValue) {
                return this._GetValue(property, false);
            }
            else if (this.OwnerBase instanceof ParagraphAdv) {
                var doc = this.Document;
                if (doc != null)
                    return doc.ParagraphFormat._GetPropertyValue(property);
            }
            return this._GetValue(property, true);
        };
        ParagraphFormat.prototype._ValidateSpacing = function (value) {
            if (value < 0 || value > 2112)
                throw new RangeError("The value must be 0px to 2112px.");
        };
        ParagraphFormat.prototype._ValidateLineSpacing = function (value) {
            switch (this.LineSpacingType) {
                case LineSpacingType.AtLeast:
                    if (value < 0.9 || value > 2112)
                        throw new RangeError("The value must be between 0.9px to 2112px");
                    break;
                case LineSpacingType.Exactly:
                    if (value < 0.9 || value > 2112)
                        throw new RangeError("The value must be between 0.9px to 2112px");
                    break;
                case LineSpacingType.Multiple:
                    if (value < 0.06 || value > 132)
                        throw new RangeError("The value must be between 0.06 to 132");
                    break;
            }
        };
        ParagraphFormat.prototype._OnListFormatChanged = function (list) {
            if (list instanceof ListFormat) {
                var currentFormat = list;
                currentFormat._SetOwner(this);
                list._UpdateOwnerParagraphFormat();
                currentFormat._Relayout();
            }
        };
        ParagraphFormat.prototype._CopyFromListLevelParagrahFormat = function (format) {
            if (format.LeftIndent != null && format.LeftIndent != undefined)
                this.LeftIndent = format.LeftIndent;
            if (format.FirstLineIndent != null && format.FirstLineIndent != undefined)
                this.FirstLineIndent = format.FirstLineIndent;
        };
        ParagraphFormat.prototype._RelayoutParagraph = function () {
            if (this.OwnerBase instanceof DocumentAdv) {
                var verticalScrolValue = 0;
                var horizontalScrolValue = 0;
                if (this.OwnerBase.OwnerControl != null
                    && this.OwnerBase.OwnerControl.IsLayoutEnabled) {
                    if (this.OwnerBase.OwnerControl.IsDocumentLoaded) {
                        if (this.OwnerBase.OwnerControl.Viewer.VerticalScrollBar != null)
                            verticalScrolValue = this.OwnerBase.OwnerControl.Viewer.VerticalScrollBar.model.value;
                        if (this.OwnerBase.OwnerControl.Viewer.HorizontalScrollBar != null)
                            horizontalScrolValue = this.OwnerBase.OwnerControl.Viewer.HorizontalScrollBar.model.value;
                    }
                    var viewer = void 0;
                    this.OwnerBase._LayoutItems(viewer);
                    if (this.OwnerBase.OwnerControl.IsDocumentLoaded) {
                        if (this.OwnerBase.OwnerControl.Viewer.VerticalScrollBar != null)
                            this.OwnerBase.OwnerControl.Viewer.VerticalScrollBar.Value = verticalScrolValue;
                        if (this.OwnerBase.OwnerControl.Viewer.HorizontalScrollBar != null)
                            this.OwnerBase.OwnerControl.Viewer.HorizontalScrollBar.model.value = horizontalScrolValue;
                    }
                }
            }
            else if (this.OwnerBase instanceof ParagraphAdv)
                this.OwnerBase._RelayoutParagraph(0);
        };
        ParagraphFormat.prototype._ApplyPropertyValueInternal = function (baseHistoryInfo, property, value) {
            this._ApplyPropertyValue(baseHistoryInfo, property, value, false);
        };
        ParagraphFormat.prototype._ApplyPropertyValue = function (baseHistoryInfo, property, value, update) {
            if (update && property == ParagraphFormat.LeftIndentProperty)
                value = this.LeftIndent + value;
            if (property == ParagraphFormat.ListFormatProperty && value instanceof ListFormat) {
                var listFormat = value;
                if (!this._HasValue(ListFormat.ListLevelNumberProperty))
                    listFormat.ListLevelNumber = listFormat.ListLevelNumber;
            }
            if (baseHistoryInfo != null)
                value = baseHistoryInfo._AddModifiedPropertiesForParagraphFormat(this, property, value);
            if (value == DocumentEditorHelper.PropertyUnsetValue) {
                this._ClearValue(property);
                return;
            }
            if (value instanceof ParagraphFormat) {
                if (property == null)
                    this._HandleParagraphFormat(value);
                else if (property == ParagraphFormat.ListFormatProperty)
                    this._HandleListFormat(value, baseHistoryInfo.OwnerControl.History);
                return;
            }
            if (property == ParagraphFormat.AfterSpacingProperty)
                this.AfterSpacing = value;
            else if (property == ParagraphFormat.BeforeSpacingProperty)
                this.BeforeSpacing = value;
            else if (property == ParagraphFormat.LeftIndentProperty)
                this.LeftIndent = value;
            else if (property == ParagraphFormat.LineSpacingTypeProperty)
                this.LineSpacingType = value;
            else if (property == ParagraphFormat.LineSpacingProperty)
                this.LineSpacing = value;
            else if (property == ParagraphFormat.RightIndentProperty)
                this.RightIndent = value;
            else if (property == ParagraphFormat.FirstLineIndentProperty)
                this.FirstLineIndent = value;
            else if (property == ParagraphFormat.TextAlignmentProperty)
                this.TextAlignment = value;
            else if (property == ParagraphFormat.ListFormatProperty)
                this.ListFormat = value;
        };
        ParagraphFormat.prototype._GetParagraphPropertyValue = function (property, modifiedProperty) {
            var value;
            if (property == ParagraphFormat.AfterSpacingProperty)
                value = modifiedProperty.AfterSpacing;
            else if (property == ParagraphFormat.BeforeSpacingProperty)
                value = modifiedProperty.BeforeSpacing;
            else if (property == ParagraphFormat.FirstLineIndentProperty)
                value = modifiedProperty.FirstLineIndent;
            else if (property == ParagraphFormat.LeftIndentProperty)
                value = modifiedProperty.LeftIndent;
            else if (property == ParagraphFormat.LineSpacingTypeProperty)
                value = modifiedProperty.LineSpacingType;
            else if (property == ParagraphFormat.LineSpacingProperty)
                value = modifiedProperty.LineSpacing;
            else if (property == ParagraphFormat.RightIndentProperty)
                value = modifiedProperty.RightIndent;
            else if (property == ParagraphFormat.TextAlignmentProperty)
                value = modifiedProperty.TextAlignment;
            return value;
        };
        ParagraphFormat.prototype._HandleParagraphFormat = function (format) {
            var document = this.Document;
            if (document != null && document.OwnerControl != null)
                document.OwnerControl.IsLayoutEnabled = false;
            if (format._HasValue(ParagraphFormat.ListFormatProperty))
                this.ListFormat._CopyFormat(format.ListFormat);
            if (format._HasValue(ParagraphFormat.LeftIndentProperty))
                this.LeftIndent = format.LeftIndent;
            if (format._HasValue(ParagraphFormat.RightIndentProperty))
                this.RightIndent = format.RightIndent;
            if (format._HasValue(ParagraphFormat.FirstLineIndentProperty))
                this.FirstLineIndent = format.FirstLineIndent;
            if (format._HasValue(ParagraphFormat.AfterSpacingProperty))
                this.AfterSpacing = format.AfterSpacing;
            if (format._HasValue(ParagraphFormat.BeforeSpacingProperty))
                this.BeforeSpacing = format.BeforeSpacing;
            if (format._HasValue(ParagraphFormat.LineSpacingTypeProperty))
                this.LineSpacingType = format.LineSpacingType;
            if (format._HasValue(ParagraphFormat.LineSpacingProperty))
                this.LineSpacing = format.LineSpacing;
            if (format._HasValue(ParagraphFormat.TextAlignmentProperty))
                this.TextAlignment = format.TextAlignment;
            if (document != null && document.OwnerControl != null)
                document.OwnerControl.IsLayoutEnabled = true;
            this._RelayoutParagraph();
        };
        ParagraphFormat.prototype._HandleListFormat = function (paragraphFormat, history) {
            var document = this.Document;
            if (document != null && document.OwnerControl != null)
                document.OwnerControl.IsLayoutEnabled = false;
            this.ListFormat = paragraphFormat.ListFormat;
            if (history.IsUndoing) {
                this.LeftIndent = paragraphFormat.LeftIndent;
                this.FirstLineIndent = paragraphFormat.FirstLineIndent;
            }
            if (document != null && document.OwnerControl != null)
                document.OwnerControl.IsLayoutEnabled = true;
            this._RelayoutParagraph();
        };
        ParagraphFormat.prototype._CopyFormat = function (sourceFormat) {
            if (sourceFormat.afterSpacing != undefined && sourceFormat.afterSpacing != null)
                this.AfterSpacing = sourceFormat.afterSpacing;
            if (sourceFormat.beforeSpacing != undefined && sourceFormat.beforeSpacing != null)
                this.BeforeSpacing = sourceFormat.beforeSpacing;
            if (sourceFormat.leftIndent != undefined && sourceFormat.leftIndent != null)
                this.LeftIndent = sourceFormat.leftIndent;
            if (sourceFormat.rightIndent != undefined && sourceFormat.rightIndent != null)
                this.RightIndent = sourceFormat.rightIndent;
            if (sourceFormat.firstLineIndent != undefined && sourceFormat.firstLineIndent != null)
                this.FirstLineIndent = sourceFormat.firstLineIndent;
            if (sourceFormat.lineSpacingType != undefined && sourceFormat.lineSpacingType != null)
                this.LineSpacingType = sourceFormat.lineSpacingType;
            if (sourceFormat.lineSpacing != undefined && sourceFormat.lineSpacing != null)
                this.LineSpacing = sourceFormat.lineSpacing;
            if (sourceFormat.textalignment != undefined && sourceFormat.textalignment != null)
                this.TextAlignment = sourceFormat.textalignment;
            if (sourceFormat.listFormat != undefined && sourceFormat.listFormat != null)
                this.ListFormat._CopyFormat(sourceFormat.listFormat);
        };
        ParagraphFormat.prototype._CloneFormat = function () {
            var format = new ParagraphFormat(null);
            format.LeftIndent = this.LeftIndent;
            format.RightIndent = this.RightIndent;
            format.FirstLineIndent = this.FirstLineIndent;
            format.BeforeSpacing = this.BeforeSpacing;
            format.AfterSpacing = this.AfterSpacing;
            format.LineSpacingType = this.LineSpacingType;
            format.LineSpacing = this.LineSpacing;
            format.TextAlignment = this.TextAlignment;
            if (ListFormat == null)
                format.ListFormat = null;
            else {
                format.ListFormat = new ListFormat(null);
                format.ListFormat.ListId = this.ListFormat.ListId;
                format.ListFormat.ListLevelNumber = this.ListFormat.ListLevelNumber;
            }
            return format;
        };
        ParagraphFormat.prototype._GetAsHtmlStyle = function () {
            var style = "style=\"";
            style += CssConstants.TextAlign + HTMLOperators.Colon + HelperMethods._GetHtmlTextAlign(this.TextAlignment) + HTMLOperators.SemiColon;
            var leftIndent = this.LeftIndent;
            var firstLine = this.FirstLineIndent;
            if (this.ListFormat.ListLevel != null) {
                leftIndent -= 48;
                firstLine += 24;
            }
            style += CssConstants.Margin + HTMLOperators.Colon
                + this.BeforeSpacing.toString() + "px "
                + this.RightIndent.toString() + "px "
                + this.AfterSpacing.toString() + "px "
                + leftIndent.toString() + "px;";
            if (firstLine != 0) {
                style += CssConstants.TextIndent + HTMLOperators.Colon + firstLine.toString() + CssConstants.Px + HTMLOperators.SemiColon;
            }
            if (this.LineSpacingType == LineSpacingType.Multiple) {
                style += CssConstants.LineHeight + HTMLOperators.Colon + (this.LineSpacing * 100).toString() + CssConstants.Percentage + HTMLOperators.SemiColon;
            }
            else {
                style += CssConstants.LineHeight + HTMLOperators.Colon + this.LineSpacing.toString() + CssConstants.Px + HTMLOperators.SemiColon;
            }
            style += "\" ";
            return style;
        };
        ParagraphFormat.prototype._Dispose = function () {
            this._SetOwner(null);
        };
        ParagraphFormat.prototype._SerializeParagraphFormat = function () {
            var pFormat = {
                "AfterSpacing": [], "BeforeSpacing": [], "FirstLineIndent": [],
                "LeftIndent": [], "LineSpacing": [], "LineSpacingType": [], "ListFormat": [],
                "RightIndent": [], "TextAlignment": []
            };
            if (this._HasValue(ParagraphFormat.AfterSpacingProperty))
                pFormat.AfterSpacing = this.AfterSpacing;
            else
                pFormat.AfterSpacing = null;
            if (this._HasValue(ParagraphFormat.BeforeSpacingProperty))
                pFormat.BeforeSpacing = this.BeforeSpacing;
            else
                pFormat.BeforeSpacing = null;
            if (this._HasValue(ParagraphFormat.FirstLineIndentProperty))
                pFormat.FirstLineIndent = this.FirstLineIndent;
            else
                pFormat.FirstLineIndent = null;
            if (this._HasValue(ParagraphFormat.LeftIndentProperty))
                pFormat.LeftIndent = this.LeftIndent;
            else
                pFormat.LeftIndent = null;
            if (this._HasValue(ParagraphFormat.RightIndentProperty))
                pFormat.RightIndent = this.RightIndent;
            else
                pFormat.RightIndent = null;
            if (this._HasValue(ParagraphFormat.LineSpacingTypeProperty))
                pFormat.LineSpacingType = this.LineSpacingType;
            else
                pFormat.LineSpacingType = null;
            if (this._HasValue(ParagraphFormat.LineSpacingProperty))
                pFormat.LineSpacing = this.LineSpacing;
            else
                pFormat.LineSpacing = null;
            if (this._HasValue(ParagraphFormat.TextAlignmentProperty))
                pFormat.TextAlignment = this.TextAlignment;
            else
                pFormat.TextAlignment = null;
            if (this.ListFormat != null && this.ListFormat != undefined) {
                pFormat.ListFormat = { "ListId": [], "ListLevelNumber": [] };
                if (this.ListFormat._HasValue(ListFormat.ListIdProperty))
                    pFormat.ListFormat.ListId = this.ListFormat.ListId;
                else
                    pFormat.ListFormat.ListId = null;
                if (this.ListFormat._HasValue(ListFormat.ListLevelNumberProperty))
                    pFormat.ListFormat.ListLevelNumber = this.ListFormat.ListLevelNumber;
                else
                    pFormat.ListFormat.ListLevelNumber = null;
            }
            return pFormat;
        };
        ParagraphFormat.LeftIndentProperty = "LeftIndent";
        ParagraphFormat.RightIndentProperty = "RightIndent";
        ParagraphFormat.FirstLineIndentProperty = "FirstLineIndent";
        ParagraphFormat.BeforeSpacingProperty = "BeforeSpacing";
        ParagraphFormat.AfterSpacingProperty = "AfterSpacing";
        ParagraphFormat.LineSpacingProperty = "LineSpacing";
        ParagraphFormat.LineSpacingTypeProperty = "LineSpacingType";
        ParagraphFormat.TextAlignmentProperty = "TextAlignment";
        ParagraphFormat.ListFormatProperty = "ListFormat";
        return ParagraphFormat;
    }(BaseNode));
    DocumentEditorFeatures.ParagraphFormat = ParagraphFormat;
    var ListFormat = (function (_super) {
        __extends(ListFormat, _super);
        function ListFormat(node) {
            _super.call(this, node);
            this.listId = -1;
            this.listLevelNumber = 0;
            this.propertyFlag = 0;
        }
        ;
        Object.defineProperty(ListFormat.prototype, "Document", {
            get: function () {
                if (this.OwnerBase instanceof ParagraphFormat)
                    return this.OwnerBase.Document;
                return null;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(ListFormat.prototype, "ListId", {
            get: function () {
                return this._GetPropertyValue(ListFormat.ListIdProperty);
            },
            set: function (listId) {
                this._SetValue(ListFormat.ListIdProperty, listId);
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(ListFormat.prototype, "ListLevelNumber", {
            get: function () {
                return this._GetPropertyValue(ListFormat.ListLevelNumberProperty);
            },
            set: function (value) {
                this._SetValue(ListFormat.ListLevelNumberProperty, value);
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(ListFormat.prototype, "ListLevel", {
            get: function () {
                if (this.List != null)
                    return this.List._GetListLevel(this.ListLevelNumber);
                return null;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(ListFormat.prototype, "List", {
            get: function () {
                if (this.Document != null)
                    return this.Document._GetListByID(this.ListId);
            },
            set: function (value) {
                this.list = value;
            },
            enumerable: true,
            configurable: true
        });
        ListFormat.prototype._GetPropertyValue = function (property) {
            var hasValue = this._HasValue(property);
            if (hasValue) {
                return this._GetValue(property, false);
            }
            else {
                if (property == DocumentEditorHelper.PropertyUnsetValue) {
                    if (this.OwnerBase instanceof ParagraphFormat && this.OwnerBase.OwnerBase instanceof ParagraphAdv) {
                        var doc = this.Document;
                        if (doc != null)
                            return doc.ParagraphFormat._GetValue(property, true);
                    }
                }
            }
            return this._GetValue(property, true);
        };
        ListFormat.prototype._GetValue = function (property, isDefault) {
            var value;
            switch (property) {
                case ListFormat.ListIdProperty:
                    if (isDefault)
                        value = -1;
                    else
                        value = this.listId;
                    break;
                case ListFormat.ListLevelNumberProperty:
                    if (isDefault)
                        value = 0;
                    else
                        value = this.listLevelNumber;
            }
            return value;
        };
        ListFormat.prototype._SetValue = function (property, value) {
            if (value == undefined) {
                return;
            }
            var hasValue = this._HasValue(property);
            var flag = 0;
            switch (property) {
                case ListFormat.ListIdProperty:
                    flag |= 1;
                    this.listId = value;
                    break;
                case ListFormat.ListLevelNumberProperty:
                    flag |= 2;
                    this.listLevelNumber = value;
                    break;
            }
            if (!hasValue) {
                this.propertyFlag |= flag;
            }
        };
        ListFormat.prototype._HasValue = function (property) {
            switch (property) {
                case ListFormat.ListIdProperty:
                    return (this.propertyFlag & 1) == 1;
                case ListFormat.ListLevelNumberProperty:
                    return (this.propertyFlag & 2) == 2;
                default:
                    return false;
            }
        };
        ListFormat.prototype._ClearValue = function (property) {
            switch (property) {
                case ListFormat.ListIdProperty:
                    this.propertyFlag = this.propertyFlag ^ 1;
                case ListFormat.ListLevelNumberProperty:
                    this.propertyFlag = this.propertyFlag ^ 2;
            }
        };
        ListFormat.prototype._CopyFormat = function (format) {
            if (format.List != null && format.List != undefined)
                this.List = format.List;
            if (format._HasValue(ListFormat.ListIdProperty))
                this.ListId = format.listId;
            if (format._HasValue(ListFormat.ListLevelNumberProperty))
                this.ListLevelNumber = format.listLevelNumber;
        };
        ListFormat.prototype._UpdateOwnerParagraphFormat = function () {
            if (this.OwnerBase instanceof ParagraphFormat && this.ListLevel != null && this.ListLevel.ParagraphFormat != null && this.OwnerBase.OwnerBase != null)
                this.OwnerBase._CopyFromListLevelParagrahFormat(this.ListLevel.ParagraphFormat);
            else if (this.OwnerBase instanceof ParagraphFormat && this.OwnerBase.OwnerBase != null && this.List == null) {
                this.OwnerBase.LeftIndent = 0;
                this.OwnerBase.FirstLineIndent = 0;
            }
        };
        ListFormat.prototype._Relayout = function () {
            if (this.OwnerBase instanceof ParagraphFormat && this.OwnerBase.OwnerBase instanceof ParagraphAdv)
                this.OwnerBase.OwnerBase._Layout();
            else if (this.Document instanceof DocumentAdv) {
                var verticalScrolValue = 0;
                var horizontalScrolValue = 0;
                if (this.Document.OwnerControl != null
                    && this.Document.OwnerControl.IsLayoutEnabled) {
                    if (this.Document.OwnerControl.IsDocumentLoaded) {
                        if (this.Document.OwnerControl.Viewer.VerticalScrollBar != null)
                            verticalScrolValue = this.Document.OwnerControl.Viewer.VerticalScrollBar.model.value;
                        if (this.Document.OwnerControl.Viewer.HorizontalScrollBar != null)
                            horizontalScrolValue = this.Document.OwnerControl.Viewer.HorizontalScrollBar.model.value;
                    }
                    var viewer = void 0;
                    this.Document._LayoutItems(viewer);
                    if (this.Document.OwnerControl.IsDocumentLoaded) {
                        if (this.Document.OwnerControl.Viewer.VerticalScrollBar != null)
                            this.Document.OwnerControl.Viewer.VerticalScrollBar.model.value = verticalScrolValue;
                        if (this.Document.OwnerControl.Viewer.HorizontalScrollBar != null)
                            this.Document.OwnerControl.Viewer.HorizontalScrollBar.model.value = horizontalScrolValue;
                    }
                }
            }
        };
        ListFormat.ListIdProperty = "ListId";
        ListFormat.ListLevelNumberProperty = "ListLevelNumber";
        return ListFormat;
    }(BaseNode));
    DocumentEditorFeatures.ListFormat = ListFormat;
    var TableHolder = (function () {
        function TableHolder() {
            this.tableColumns = new TableColumnAdvCollection();
        }
        Object.defineProperty(TableHolder.prototype, "Columns", {
            get: function () {
                return this.tableColumns;
            },
            enumerable: true,
            configurable: true
        });
        TableHolder.prototype._GetPreviousSpannedCellWidth = function (prevColumnIndex, curColumnIndex) {
            var width = 0;
            for (var i = prevColumnIndex; i < curColumnIndex; i++) {
                width += this.tableColumns[i].PreferredWidth;
            }
            return width;
        };
        TableHolder.prototype._Dispose = function () {
            if (this.tableColumns != null) {
                this.tableColumns._Clear();
                this.tableColumns = null;
            }
        };
        return TableHolder;
    }());
    DocumentEditorFeatures.TableHolder = TableHolder;
    var Shading = (function (_super) {
        __extends(Shading, _super);
        function Shading(node) {
            _super.call(this, node);
            this.propertyFlag = 0;
        }
        Object.defineProperty(Shading.prototype, "BackgroundColor", {
            get: function () {
                return this._GetValue(Shading.BackgroundColorProperty);
            },
            set: function (value) {
                this._SetValue(Shading.BackgroundColorProperty, value);
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(Shading.prototype, "ForegroundColor", {
            get: function () {
                return this._GetValue(Shading.ForegroundColorProperty);
            },
            set: function (value) {
                this._SetValue(Shading.ForegroundColorProperty, value);
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(Shading.prototype, "TextureStyle", {
            get: function () {
                return this._GetValue(Shading.TextureStyleProperty);
            },
            set: function (value) { this._SetValue(Shading.TextureStyleProperty, value); },
            enumerable: true,
            configurable: true
        });
        Shading.prototype._HasValue = function (property) {
            switch (property) {
                case Shading.BackgroundColorProperty:
                    return (this.propertyFlag & 1) == 1;
                case Shading.ForegroundColorProperty:
                    return (this.propertyFlag & 2) == 2;
                case Shading.TextureStyleProperty:
                    return (this.propertyFlag & 4) == 4;
                default:
                    return false;
            }
        };
        Shading.prototype._SetValue = function (property, value) {
            if (value == undefined) {
                return;
            }
            var hasValue = this._HasValue(property);
            var flag = 0;
            switch (property) {
                case Shading.BackgroundColorProperty:
                    flag |= 1;
                    this.backgroundColor = value;
                    break;
                case Shading.ForegroundColorProperty:
                    flag |= 2;
                    this.foregroundColor = value;
                    break;
                case Shading.TextureStyleProperty:
                    flag |= 4;
                    this.textureStyle = value;
                    break;
            }
            if (!hasValue) {
                this.propertyFlag |= flag;
            }
        };
        Shading.prototype._GetValue = function (property) {
            var hasValue = this._HasValue(property);
            var isDefault = !hasValue;
            var value;
            switch (property) {
                case Shading.BackgroundColorProperty:
                    if (isDefault)
                        value = "#ffffff";
                    else
                        value = this.backgroundColor;
                    break;
                case Shading.ForegroundColorProperty:
                    if (isDefault)
                        value = "empty";
                    else
                        value = this.foregroundColor;
                    break;
                case Shading.TextureStyleProperty:
                    if (isDefault)
                        value = 0;
                    else
                        value = this.textureStyle;
                    break;
            }
            return value;
        };
        Shading.prototype._ClearValue = function (property) {
            switch (property) {
                case Shading.BackgroundColorProperty:
                    this.propertyFlag = this.propertyFlag ^ 1;
                case Shading.ForegroundColorProperty:
                    this.propertyFlag = this.propertyFlag ^ 2;
                case Shading.TextureStyleProperty:
                    this.propertyFlag = this.propertyFlag ^ 4;
            }
        };
        Shading.prototype._CopyFormat = function (sourceShading) {
            if (sourceShading.backgroundColor != null && sourceShading.backgroundColor != undefined)
                this.BackgroundColor = sourceShading.backgroundColor;
            if (sourceShading.foregroundColor != null && sourceShading.foregroundColor != undefined)
                this.ForegroundColor = sourceShading.foregroundColor;
            if (sourceShading.textureStyle != null && sourceShading.textureStyle != undefined)
                this.TextureStyle = sourceShading.textureStyle;
        };
        Shading.prototype._Clone = function () {
            var shading = new Shading(null);
            shading.BackgroundColor = this.BackgroundColor;
            shading.ForegroundColor = this.ForegroundColor;
            return shading;
        };
        Shading.prototype._Dispose = function () {
            this._SetOwner(null);
        };
        Shading.prototype._SerializeShading = function () {
            var shading = { "BackgroundColor": [], "Texture": [] };
            if (this._HasValue(Shading.BackgroundColorProperty))
                shading.BackgroundColor = this.BackgroundColor;
            else
                shading.BackgroundColor = null;
            if (this._HasValue(Shading.TextureStyleProperty))
                shading.Texture = this.TextureStyle;
            else
                shading.Texture = null;
            return shading;
        };
        Shading.BackgroundColorProperty = "BackgroundColor";
        Shading.ForegroundColorProperty = "ForegroundColor";
        Shading.TextureStyleProperty = "TextureStyle";
        return Shading;
    }(BaseNode));
    DocumentEditorFeatures.Shading = Shading;
    var Borders = (function (_super) {
        __extends(Borders, _super);
        function Borders(node) {
            _super.call(this, node);
            this.propertyFlag = 0;
            this.Left = new Border(this);
            this.Right = new Border(this);
            this.Top = new Border(this);
            this.Bottom = new Border(this);
            this.DiagonalUp = new Border(this);
            this.DiagonalDown = new Border(this);
            this.Horizontal = new Border(this);
            this.Vertical = new Border(this);
        }
        Object.defineProperty(Borders.prototype, "Left", {
            get: function () {
                return this._GetValue(Borders.LeftProperty);
            },
            set: function (value) {
                this._SetValue(Borders.LeftProperty, value);
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(Borders.prototype, "Right", {
            get: function () {
                return this._GetValue(Borders.RightProperty);
            },
            set: function (value) {
                this._SetValue(Borders.RightProperty, value);
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(Borders.prototype, "Top", {
            get: function () {
                return this._GetValue(Borders.TopProperty);
            },
            set: function (value) {
                this._SetValue(Borders.TopProperty, value);
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(Borders.prototype, "Bottom", {
            get: function () {
                return this._GetValue(Borders.BottomProperty);
            },
            set: function (value) {
                this._SetValue(Borders.BottomProperty, value);
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(Borders.prototype, "Horizontal", {
            get: function () {
                return this._GetValue(Borders.HorizontalProperty);
            },
            set: function (value) {
                this._SetValue(Borders.HorizontalProperty, value);
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(Borders.prototype, "Vertical", {
            get: function () {
                return this._GetValue(Borders.VerticalProperty);
            },
            set: function (value) {
                this._SetValue(Borders.VerticalProperty, value);
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(Borders.prototype, "DiagonalUp", {
            get: function () {
                return this._GetValue(Borders.DiagonalUpProperty);
            },
            set: function (value) {
                this._SetValue(Borders.DiagonalUpProperty, value);
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(Borders.prototype, "DiagonalDown", {
            get: function () {
                return this._GetValue(Borders.DiagonalDownProperty);
            },
            set: function (value) {
                this._SetValue(Borders.DiagonalDownProperty, value);
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(Borders.prototype, "LineStyle", {
            set: function (value) {
                if (this.Left != null)
                    this.Left.LineStyle = value;
                if (this.Right != null)
                    this.Right.LineStyle = value;
                if (this.Top != null)
                    this.Top.LineStyle = value;
                if (this.Bottom != null)
                    this.Bottom.LineStyle = value;
                if (this.Horizontal != null)
                    this.Horizontal.LineStyle = value;
                if (this.Vertical != null)
                    this.Vertical.LineStyle = value;
                if (this.DiagonalUp != null)
                    this.DiagonalUp.LineStyle = value;
                if (this.DiagonalDown != null)
                    this.DiagonalDown.LineStyle = value;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(Borders.prototype, "LineWidth", {
            set: function (value) {
                if (this.Left != null)
                    this.Left.LineWidth = value;
                if (this.Right != null)
                    this.Right.LineWidth = value;
                if (this.Top != null)
                    this.Top.LineWidth = value;
                if (this.Bottom != null)
                    this.Bottom.LineWidth = value;
                if (this.Horizontal != null)
                    this.Horizontal.LineWidth = value;
                if (this.Vertical != null)
                    this.Vertical.LineWidth = value;
                if (this.DiagonalUp != null)
                    this.DiagonalUp.LineWidth = value;
                if (this.DiagonalDown != null)
                    this.DiagonalDown.LineWidth = value;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(Borders.prototype, "Color", {
            set: function (value) {
                if (this.Left != null)
                    this.Left.Color = value;
                if (this.Right != null)
                    this.Right.Color = value;
                if (this.Top != null)
                    this.Top.Color = value;
                if (this.Bottom != null)
                    this.Bottom.Color = value;
                if (this.Horizontal != null)
                    this.Horizontal.Color = value;
                if (this.Vertical != null)
                    this.Vertical.Color = value;
                if (this.DiagonalUp != null)
                    this.DiagonalUp.Color = value;
                if (this.DiagonalDown != null)
                    this.DiagonalDown.Color = value;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(Borders.prototype, "OwnerCell", {
            get: function () {
                if (this.OwnerBase instanceof CellFormat && this.OwnerBase.OwnerBase instanceof TableCellAdv)
                    return this.OwnerBase.OwnerBase;
                else
                    return null;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(Borders.prototype, "OwnerRow", {
            get: function () {
                if (this.OwnerCell != null)
                    return this.OwnerCell.OwnerRow;
                else if (this.OwnerBase instanceof RowFormat && this.OwnerBase.OwnerBase instanceof TableRowAdv)
                    return this.OwnerBase.OwnerBase;
                else
                    return null;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(Borders.prototype, "OwnerTable", {
            get: function () {
                if (this.OwnerRow != null)
                    return this.OwnerRow.OwnerTable;
                else if (this.OwnerBase instanceof TableFormat && this.OwnerBase.OwnerBase instanceof TableAdv)
                    return this.OwnerBase.OwnerBase;
                else
                    return null;
            },
            enumerable: true,
            configurable: true
        });
        Borders.prototype._SetValue = function (property, value) {
            if (value == undefined) {
                return;
            }
            var hasValue = this._HasValue(property);
            var flag = 0;
            switch (property) {
                case Borders.LeftProperty:
                    flag |= 1;
                    this.left = value;
                    break;
                case Borders.RightProperty:
                    flag |= 2;
                    this.right = value;
                    break;
                case Borders.TopProperty:
                    flag |= 4;
                    this.top = value;
                    break;
                case Borders.BottomProperty:
                    flag |= 8;
                    this.bottom = value;
                    break;
                case Borders.HorizontalProperty:
                    flag |= 16;
                    this.horizontal = value;
                    break;
                case Borders.VerticalProperty:
                    flag |= 32;
                    this.vertical = value;
                    break;
                case Borders.DiagonalUpProperty:
                    flag |= 64;
                    this.diagonalUp = value;
                    break;
                case Borders.DiagonalDownProperty:
                    flag |= 128;
                    this.diagonalDown = value;
                    break;
            }
            if (!hasValue) {
                this.propertyFlag |= flag;
            }
        };
        Borders.prototype._GetValue = function (property) {
            var hasValue = this._HasValue(property);
            var isDefault = !hasValue;
            var value;
            switch (property) {
                case Borders.LeftProperty:
                    if (isDefault)
                        value = null;
                    else
                        value = this.left;
                    break;
                case Borders.RightProperty:
                    if (isDefault)
                        value = null;
                    else
                        value = this.right;
                    break;
                case Borders.TopProperty:
                    if (isDefault)
                        value = null;
                    else
                        value = this.top;
                    break;
                case Borders.BottomProperty:
                    if (isDefault)
                        value = null;
                    else
                        value = this.bottom;
                    break;
                case Borders.HorizontalProperty:
                    if (isDefault)
                        value = null;
                    else
                        value = this.horizontal;
                    break;
                case Borders.VerticalProperty:
                    if (isDefault)
                        value = null;
                    else
                        value = this.vertical;
                    break;
                case Borders.DiagonalUpProperty:
                    if (isDefault)
                        value = null;
                    else
                        value = this.diagonalUp;
                    break;
                case Borders.DiagonalDownProperty:
                    if (isDefault)
                        value = null;
                    else
                        value = this.diagonalDown;
                    break;
            }
            return value;
        };
        Borders.prototype._HasValue = function (property) {
            switch (property) {
                case Borders.LeftProperty:
                    return (this.propertyFlag & 1) == 1;
                case Borders.RightProperty:
                    return (this.propertyFlag & 2) == 2;
                case Borders.TopProperty:
                    return (this.propertyFlag & 4) == 4;
                case Borders.BottomProperty:
                    return (this.propertyFlag & 8) == 8;
                case Borders.HorizontalProperty:
                    return (this.propertyFlag & 16) == 16;
                case Borders.VerticalProperty:
                    return (this.propertyFlag & 32) == 32;
                case Borders.DiagonalUpProperty:
                    return (this.propertyFlag & 64) == 64;
                case Borders.DiagonalDownProperty:
                    return (this.propertyFlag & 128) == 128;
                default:
                    return false;
            }
        };
        Borders.prototype._ClearValue = function (property) {
            switch (property) {
                case Borders.LeftProperty:
                    this.propertyFlag = this.propertyFlag ^ 1;
                case Borders.RightProperty:
                    this.propertyFlag = this.propertyFlag ^ 2;
                case Borders.TopProperty:
                    this.propertyFlag = this.propertyFlag ^ 4;
                case Borders.BottomProperty:
                    this.propertyFlag = this.propertyFlag ^ 8;
                case Borders.HorizontalProperty:
                    this.propertyFlag = this.propertyFlag ^ 16;
                case Borders.VerticalProperty:
                    this.propertyFlag = this.propertyFlag ^ 32;
                case Borders.DiagonalUpProperty:
                    this.propertyFlag = this.propertyFlag ^ 64;
                case Borders.DiagonalDownProperty:
                    this.propertyFlag = this.propertyFlag ^ 128;
            }
        };
        Borders.prototype._CopyFormat = function (sourceFormat) {
            if (sourceFormat.left != undefined && sourceFormat.left instanceof Border) {
                this.Left = new Border(this);
                this.Left._CopyFormat(sourceFormat.left);
            }
            if (sourceFormat.right != undefined && sourceFormat.right instanceof Border) {
                this.Right = new Border(this);
                this.Right._CopyFormat(sourceFormat.right);
            }
            if (sourceFormat.top != undefined && sourceFormat.top instanceof Border) {
                this.Top = new Border(this);
                this.Top._CopyFormat(sourceFormat.top);
            }
            if (sourceFormat.bottom != undefined && sourceFormat.bottom instanceof Border) {
                this.Bottom = new Border(this);
                this.Bottom._CopyFormat(sourceFormat.bottom);
            }
            if (sourceFormat.horizontal != undefined && sourceFormat.horizontal instanceof Border) {
                this.Horizontal = new Border(this);
                this.Horizontal._CopyFormat(sourceFormat.horizontal);
            }
            if (sourceFormat.vertical != undefined && sourceFormat.vertical instanceof Border) {
                this.Vertical = new Border(this);
                this.Vertical._CopyFormat(sourceFormat.vertical);
            }
            if (sourceFormat.diagonalDown != undefined && sourceFormat.diagonalDown instanceof Border) {
                this.DiagonalDown = new Border(this);
                this.DiagonalDown._CopyFormat(sourceFormat.diagonalDown);
            }
            if (sourceFormat.diagonalUp != undefined && sourceFormat.diagonalUp instanceof Border) {
                this.DiagonalUp = new Border(this);
                this.DiagonalUp._CopyFormat(sourceFormat.diagonalUp);
            }
        };
        Borders.prototype._GetTableLeftBorder = function () {
            if (this.Left != null)
                return this.Left;
            else {
                var border = new Border(this);
                border.LineStyle = LineStyle.Single;
                border.LineWidth = 0.66;
                return border;
            }
        };
        Borders.prototype._GetTableRightBorder = function () {
            if (this.Right != null)
                return this.Right;
            else {
                var border = new Border(this);
                border.LineStyle = LineStyle.Single;
                border.LineWidth = 0.66;
                return border;
            }
        };
        Borders.prototype._GetTableTopBorder = function () {
            if (this.Top != null)
                return this.Top;
            else {
                var border = new Border(this);
                border.LineStyle = LineStyle.Single;
                border.LineWidth = 0.66;
                return border;
            }
        };
        Borders.prototype._GetTableBottomBorder = function () {
            if (this.Bottom != null)
                return this.Bottom;
            else {
                var border = new Border(this);
                border.LineStyle = LineStyle.Single;
                border.LineWidth = 0.66;
                return border;
            }
        };
        Borders.prototype._GetCellLeftBorder = function (TableCell) {
            var leftBorder = null;
            var cellBorder = TableCell.CellFormat.Borders;
            var rowBorders = TableCell.OwnerRow != null ? TableCell.OwnerRow.RowFormat.Borders : null;
            var tableBorders = TableCell.OwnerTable != null ? TableCell.OwnerTable.TableFormat.Borders : null;
            if (cellBorder.Left != null)
                leftBorder = cellBorder.Left;
            if (leftBorder == null)
                leftBorder = this._GetLeftBorderToRenderByHierarchy(leftBorder, rowBorders, tableBorders);
            if (TableCell.OwnerTable.TableFormat.CellSpacing > 0) {
                leftBorder = this._GetLeftBorderToRenderByHierarchy(leftBorder, rowBorders, tableBorders);
            }
            else {
                var prevCell = null;
                if (TableCell.PreviousNode != null)
                    prevCell = TableCell.PreviousNode;
                leftBorder = this._GetPrevCellLeftBorder(leftBorder, prevCell);
            }
            if (leftBorder == null)
                leftBorder = new Border(this);
            return leftBorder;
        };
        Borders.prototype._GetPrevCellLeftBorder = function (leftBorder, prevCell) {
            if ((prevCell == null || (leftBorder != null && (leftBorder.LineStyle == LineStyle.None && !leftBorder.HasNoneStyle)))) {
                if (leftBorder != null && !(leftBorder.OwnerBase.OwnerBase instanceof TableFormat))
                    return this._GetLeftBorderToRenderByHierarchy(leftBorder, leftBorder.OwnerBase.OwnerRow.RowFormat.Borders, leftBorder.OwnerBase.OwnerTable.TableFormat.Borders);
            }
            else {
                var borderToRender = void 0;
                var prevCellRightBorder = null;
                if (prevCell.CellFormat.Borders != null && prevCell.CellFormat.Borders.Right != null && prevCell.CellFormat.Borders.Right.LineStyle != LineStyle.None)
                    prevCellRightBorder = prevCell.CellFormat.Borders.Right;
                if (prevCellRightBorder != null && prevCellRightBorder.LineStyle != LineStyle.None)
                    borderToRender = this._GetBorderBasedOnPriority(prevCellRightBorder, leftBorder);
                else if (leftBorder != null && !(leftBorder.OwnerBase.OwnerBase instanceof TableFormat))
                    return this._GetLeftBorderToRenderByHierarchy(leftBorder, leftBorder.OwnerBase.OwnerRow.RowFormat.Borders, leftBorder.OwnerBase.OwnerTable.TableFormat.Borders);
            }
            return leftBorder;
        };
        Borders.prototype._GetLeftBorderToRenderByHierarchy = function (leftBorder, rowBorders, tableBorders) {
            if (leftBorder != null && (leftBorder.LineStyle != LineStyle.None || leftBorder.HasNoneStyle))
                return leftBorder;
            else if (leftBorder != null && (leftBorder.OwnerBase instanceof Borders) && leftBorder.OwnerBase.OwnerCell.ColumnIndex == 0) {
                if (tableBorders != null && tableBorders.Left != null)
                    leftBorder = tableBorders.Left;
                return leftBorder;
            }
            else if (rowBorders != null && rowBorders.Vertical != null && rowBorders.Vertical.LineStyle != LineStyle.None)
                return leftBorder = rowBorders.Vertical;
            else if (tableBorders != null && tableBorders.Vertical != null && tableBorders.Vertical.LineStyle != LineStyle.None)
                return leftBorder = tableBorders.Vertical;
            else {
                return leftBorder;
            }
        };
        Borders.prototype._GetCellDiagonalUpBorder = function (TableCell) {
            var diagonalUpBorder = null;
            var cellBorder = null;
            cellBorder = TableCell.CellFormat.Borders;
            if (cellBorder.DiagonalUp != null)
                diagonalUpBorder = cellBorder.DiagonalUp;
            return diagonalUpBorder;
        };
        Borders.prototype._GetCellDiagonalDownBorder = function (TableCell) {
            var diagonalDownBorder = null;
            var cellBorder = null;
            cellBorder = TableCell.CellFormat.Borders;
            if (cellBorder.DiagonalDown != null)
                diagonalDownBorder = cellBorder.DiagonalDown;
            return diagonalDownBorder;
        };
        Borders.prototype._GetCellRightBorder = function (TableCell) {
            var rightBorder = null;
            var cellBorder = TableCell.CellFormat.Borders;
            var rowBorders = TableCell.OwnerRow != null ? TableCell.OwnerRow.RowFormat.Borders : null;
            var tableBorders = TableCell.OwnerTable != null ? TableCell.OwnerTable.TableFormat.Borders : null;
            if (cellBorder.Right != null)
                rightBorder = cellBorder.Right;
            if (rightBorder == null)
                rightBorder = this._GetRightBorderToRenderByHierarchy(rightBorder, rowBorders, tableBorders);
            if (TableCell.OwnerTable.TableFormat.CellSpacing > 0) {
                rightBorder = this._GetRightBorderToRenderByHierarchy(rightBorder, rowBorders, tableBorders);
            }
            else {
                var nextCell = null;
                if (TableCell.NextNode != null)
                    nextCell = TableCell.NextNode;
                rightBorder = this._GetAdjacentCellRightBorder(rightBorder, nextCell);
            }
            if (rightBorder == null)
                rightBorder = new Border(this);
            return rightBorder;
        };
        Borders.prototype._GetAdjacentCellRightBorder = function (rightBorder, nextCell) {
            if (nextCell == null || (rightBorder != null && (rightBorder.LineStyle == LineStyle.None && !rightBorder.HasNoneStyle))) {
                if (rightBorder != null && !(rightBorder.OwnerBase.OwnerBase instanceof TableFormat))
                    return this._GetRightBorderToRenderByHierarchy(rightBorder, rightBorder.OwnerBase.OwnerRow.RowFormat.Borders, rightBorder.OwnerBase.OwnerTable.TableFormat.Borders);
            }
            else {
                var nextCellLeftBorder = null;
                if (nextCell.CellFormat.Borders != null && nextCell.CellFormat.Borders.Left != null && nextCell.CellFormat.Borders.Left.LineStyle != LineStyle.None)
                    nextCellLeftBorder = nextCell.CellFormat.Borders.Left;
                if (nextCellLeftBorder != null && nextCellLeftBorder.LineStyle != LineStyle.None)
                    return this._GetBorderBasedOnPriority(rightBorder, nextCellLeftBorder);
                else if (rightBorder != null && !(rightBorder.OwnerBase.OwnerBase instanceof TableFormat))
                    return this._GetRightBorderToRenderByHierarchy(rightBorder, rightBorder.OwnerBase.OwnerRow.RowFormat.Borders, rightBorder.OwnerBase.OwnerTable.TableFormat.Borders);
            }
            return rightBorder;
        };
        Borders.prototype._GetRightBorderToRenderByHierarchy = function (rightBorder, rowBorders, tableBorders) {
            if (rightBorder != null && (rightBorder.LineStyle != LineStyle.None || rightBorder.HasNoneStyle))
                return rightBorder;
            else if (rightBorder != null && (rightBorder.OwnerBase instanceof Borders) && rightBorder.OwnerBase.OwnerCell.ColumnIndex == rightBorder.OwnerBase.OwnerCell.OwnerRow.Cells.Count - 1) {
                if (tableBorders != null && tableBorders.Right != null)
                    rightBorder = tableBorders.Right;
                return rightBorder;
            }
            else if (rowBorders != null && rowBorders.Vertical != null && rowBorders.Vertical.LineStyle != LineStyle.None)
                return rightBorder = rowBorders.Vertical;
            else if (tableBorders != null && tableBorders.Vertical != null && tableBorders.Vertical.LineStyle != LineStyle.None)
                return rightBorder = tableBorders.Vertical;
            else {
                return rightBorder;
            }
        };
        Borders.prototype._GetCellTopBorder = function (TableCell) {
            var topBorder = null;
            var cellBorder = TableCell.CellFormat.Borders;
            var rowBorders = TableCell.OwnerRow != null ? TableCell.OwnerRow.RowFormat.Borders : null;
            var tableBorders = TableCell.OwnerTable != null ? TableCell.OwnerTable.TableFormat.Borders : null;
            if (cellBorder.Top != null)
                topBorder = cellBorder.Top;
            if (topBorder == null)
                topBorder = this._GetTopBorderToRenderByHierarchy(topBorder, rowBorders, tableBorders);
            if (TableCell.OwnerTable.TableFormat.CellSpacing > 0) {
                topBorder = this._GetTopBorderToRenderByHierarchy(topBorder, rowBorders, tableBorders);
            }
            else {
                var prevTopCell = null;
                var prevRow = TableCell.OwnerRow.PreviousNode;
                if (prevRow != null && TableCell.ColumnIndex < prevRow.Cells.Count)
                    prevTopCell = prevRow.Cells[TableCell.ColumnIndex];
                topBorder = this._GetPrevCellTopBorder(topBorder, prevTopCell);
            }
            if (topBorder == null)
                topBorder = new Border(this);
            return topBorder;
        };
        Borders.prototype._GetPrevCellTopBorder = function (topBorder, prevTopCell) {
            if (prevTopCell == null || (topBorder != null && (topBorder.LineStyle == LineStyle.None && !topBorder.HasNoneStyle))) {
                if (topBorder != null && !(topBorder.OwnerBase.OwnerBase instanceof TableFormat))
                    return this._GetTopBorderToRenderByHierarchy(topBorder, topBorder.OwnerBase.OwnerRow.RowFormat.Borders, topBorder.OwnerBase.OwnerTable.TableFormat.Borders);
            }
            else {
                var prevTopCellBottomBorder = null;
                if (prevTopCell.CellFormat.Borders != null && prevTopCell.CellFormat.Borders.Bottom != null && prevTopCell.CellFormat.Borders.Bottom.LineStyle != LineStyle.None)
                    prevTopCellBottomBorder = prevTopCell.CellFormat.Borders.Left;
                if (prevTopCellBottomBorder != null && prevTopCellBottomBorder.LineStyle != LineStyle.None)
                    return this._GetBorderBasedOnPriority(topBorder, prevTopCellBottomBorder);
                else if (topBorder != null && !(topBorder.OwnerBase.OwnerBase instanceof TableFormat))
                    return this._GetTopBorderToRenderByHierarchy(topBorder, topBorder.OwnerBase.OwnerRow.RowFormat.Borders, topBorder.OwnerBase.OwnerTable.TableFormat.Borders);
            }
            return topBorder;
        };
        Borders.prototype._GetTopBorderToRenderByHierarchy = function (topBorder, rowBorders, tableBorders) {
            if (topBorder != null && (topBorder.LineStyle != LineStyle.None || topBorder.HasNoneStyle))
                return topBorder;
            else if (topBorder != null && (topBorder.OwnerBase instanceof Borders) && topBorder.OwnerBase.OwnerCell.OwnerRow.RowIndex == 0) {
                if (tableBorders != null && tableBorders.Top != null)
                    topBorder = tableBorders.Top;
                return topBorder;
            }
            else if (rowBorders != null && rowBorders.Horizontal != null && rowBorders.Horizontal.LineStyle != LineStyle.None)
                return topBorder = rowBorders.Horizontal;
            else if (tableBorders != null && tableBorders.Horizontal != null && tableBorders.Horizontal.LineStyle != LineStyle.None)
                return topBorder = tableBorders.Horizontal;
            else {
                return topBorder;
            }
        };
        Borders.prototype._GetCellBottomBorder = function (TableCell) {
            var bottomBorder = null;
            var cellBorder = TableCell.CellFormat.Borders;
            var rowBorders = TableCell.OwnerRow != null ? TableCell.OwnerRow.RowFormat.Borders : null;
            var tableBorders = TableCell.OwnerTable != null ? TableCell.OwnerTable.TableFormat.Borders : null;
            if (cellBorder.Bottom != null)
                bottomBorder = cellBorder.Bottom;
            if (bottomBorder == null)
                bottomBorder = this._GetBottomBorderToRenderByHierarchy(bottomBorder, rowBorders, tableBorders);
            if (TableCell.OwnerTable.TableFormat.CellSpacing > 0) {
                bottomBorder = this._GetBottomBorderToRenderByHierarchy(bottomBorder, rowBorders, tableBorders);
            }
            else {
                var nextBottomCell = null;
                var nextRow = TableCell.OwnerRow.NextNode;
                if (nextRow != null && TableCell.ColumnIndex < nextRow.Cells.Count)
                    nextBottomCell = nextRow.Cells[TableCell.ColumnIndex];
                bottomBorder = this._GetAdjacentCellBottomBorder(bottomBorder, nextBottomCell);
            }
            if (bottomBorder == null)
                bottomBorder = new Border(this);
            return bottomBorder;
        };
        Borders.prototype._GetAdjacentCellBottomBorder = function (bottomBorder, nextBottomCell) {
            if (nextBottomCell == null || (bottomBorder != null && (bottomBorder.LineStyle == LineStyle.None && !bottomBorder.HasNoneStyle))) {
                if (bottomBorder != null && !(bottomBorder.OwnerBase.OwnerBase instanceof TableFormat))
                    return this._GetBottomBorderToRenderByHierarchy(bottomBorder, bottomBorder.OwnerBase.OwnerRow.RowFormat.Borders, bottomBorder.OwnerBase.OwnerTable.TableFormat.Borders);
            }
            else {
                var prevBottomCellTopBorder = null;
                if (nextBottomCell.CellFormat.Borders != null && nextBottomCell.CellFormat.Borders.Top != null && nextBottomCell.CellFormat.Borders.Top.LineStyle != LineStyle.None)
                    prevBottomCellTopBorder = nextBottomCell.CellFormat.Borders.Top;
                if (prevBottomCellTopBorder != null && prevBottomCellTopBorder.LineStyle != LineStyle.None)
                    return this._GetBorderBasedOnPriority(bottomBorder, prevBottomCellTopBorder);
                else if (bottomBorder != null && !(bottomBorder.OwnerBase.OwnerBase instanceof TableFormat))
                    return this._GetBottomBorderToRenderByHierarchy(bottomBorder, bottomBorder.OwnerBase.OwnerRow.RowFormat.Borders, bottomBorder.OwnerBase.OwnerTable.TableFormat.Borders);
            }
            return bottomBorder;
        };
        Borders.prototype._GetBottomBorderToRenderByHierarchy = function (bottomBorder, rowBorders, tableBorders) {
            if (bottomBorder != null && (bottomBorder.LineStyle != LineStyle.None || bottomBorder.HasNoneStyle))
                return bottomBorder;
            else if (bottomBorder != null && (bottomBorder.OwnerBase instanceof Borders) && bottomBorder.OwnerBase.OwnerCell.OwnerRow.RowIndex + bottomBorder.OwnerBase.OwnerCell.CellFormat.RowSpan == bottomBorder.OwnerBase.OwnerCell.OwnerTable.Rows.Count) {
                if (tableBorders != null && tableBorders.Bottom != null)
                    bottomBorder = tableBorders.Bottom;
                return bottomBorder;
            }
            else if (rowBorders != null && rowBorders.Horizontal != null && rowBorders.Horizontal.LineStyle != LineStyle.None)
                return bottomBorder = rowBorders.Horizontal;
            else if (tableBorders != null && tableBorders.Horizontal != null && tableBorders.Horizontal.LineStyle != LineStyle.None)
                return bottomBorder = tableBorders.Horizontal;
            else {
                return bottomBorder;
            }
        };
        Borders.prototype._GetBorderBasedOnPriority = function (border, adjacentBorder) {
            if (border == null)
                return adjacentBorder;
            else if (adjacentBorder == null)
                return border;
            var borderWeight = border._GetBorderWeight();
            var adjacentBorderWeight = adjacentBorder._GetBorderWeight();
            if (borderWeight == adjacentBorderWeight) {
                var borderPriority = border._GetPrecedence();
                var adjacentBorderPriority = adjacentBorder._GetPrecedence();
                if (borderPriority == adjacentBorderPriority) {
                    var borderColInRGB = this._ConvertHexToRGB(border.Color);
                    var R1 = borderColInRGB.R;
                    var G1 = borderColInRGB.G;
                    var B1 = borderColInRGB.B;
                    var adjacentBorderColInRGB = this._ConvertHexToRGB(adjacentBorder.Color);
                    var R2 = adjacentBorderColInRGB.R;
                    var G2 = adjacentBorderColInRGB.G;
                    var B2 = adjacentBorderColInRGB.B;
                    var borderBrightness = (R1 + B1 + (2 * G1));
                    var adjacentBorderBrightness = (R2 + B2 + (2 * G2));
                    if (borderBrightness == adjacentBorderBrightness) {
                        borderBrightness = (B1 + (2 * G1));
                        adjacentBorderBrightness = (B2 + (2 * G2));
                        if (borderBrightness == adjacentBorderBrightness) {
                            if (G1 == G2)
                                return border;
                            else if (G1 > G2)
                                return adjacentBorder;
                            else
                                return border;
                        }
                        else if (borderBrightness > adjacentBorderBrightness)
                            return adjacentBorder;
                        else
                            return border;
                    }
                    else if (borderBrightness > adjacentBorderBrightness)
                        return adjacentBorder;
                    else
                        return border;
                }
                else if (borderPriority > adjacentBorderPriority)
                    return border;
                else
                    return adjacentBorder;
            }
            else if (borderWeight > adjacentBorderWeight)
                return border;
            else
                return adjacentBorder;
        };
        Borders.prototype._ConvertHexToRGB = function (colorCode) {
            if (colorCode) {
                colorCode = colorCode.replace(/[^0-9A-â€Œâ€‹F]/gi, '');
                var colCodeNo = parseInt(colorCode, 16);
                var r = (colCodeNo >> 16) & 255;
                var g = (colCodeNo >> 8) & 255;
                var b = colCodeNo & 255;
                return { "R": r, "G": g, "B": b };
            }
        };
        Borders.prototype._GetAsHtmlStyle = function () {
            var style = "";
            var border = null;
            border = this.OwnerCell != null ? this._GetCellLeftBorder(this.OwnerCell) : this._GetTableLeftBorder();
            if (border != null && border.LineStyle != LineStyle.None)
                style += border._GetAsHtmlStyle("left");
            else if (border != null && border.HasNoneStyle)
                style += "border-left-style:none;";
            border = this.OwnerCell != null ? this._GetCellRightBorder(this.OwnerCell) : this._GetTableRightBorder();
            if (border != null && border.LineStyle != LineStyle.None)
                style += border._GetAsHtmlStyle("right");
            else if (border != null && border.HasNoneStyle)
                style += "border-right-style:none;";
            border = this.OwnerCell != null ? this._GetCellTopBorder(this.OwnerCell) : this._GetTableTopBorder();
            if (border != null && border.LineStyle != LineStyle.None)
                style += border._GetAsHtmlStyle("top");
            else if (border != null && border.HasNoneStyle)
                style += "border-top-style:none;";
            border = this.OwnerCell != null ? this._GetCellBottomBorder(this.OwnerCell) : this._GetTableBottomBorder();
            if (border != null && border.LineStyle != LineStyle.None)
                style += border._GetAsHtmlStyle("bottom");
            else if (border != null && border.HasNoneStyle)
                style += "border-bottom-style:none;";
            return style;
        };
        Borders.prototype._Clone = function () {
            var borders = new Borders(null);
            borders.Top = this.Top == null ? null : this.Top._Clone();
            borders.Bottom = this.Bottom == null ? null : this.Bottom._Clone();
            borders.Left = this.Left == null ? null : this.Left._Clone();
            borders.Right = this.Right == null ? null : this.Right._Clone();
            borders.Horizontal = this.Horizontal == null ? null : this.Horizontal._Clone();
            borders.Vertical = this.Vertical == null ? null : this.Vertical._Clone();
            borders.DiagonalUp = this.DiagonalUp == null ? null : this.DiagonalUp._Clone();
            borders.DiagonalDown = this.DiagonalDown == null ? null : this.DiagonalDown._Clone();
            return borders;
        };
        Borders.prototype._Dispose = function () {
            this._SetOwner(null);
        };
        Borders.prototype._SerializeBorders = function () {
            var borders = {
                "Bottom": [], "DiagonalDown": [], "DiagonalUp": [],
                "Horizontal": [], "Left": [], "Right": [], "Top": [], "Vertical": []
            };
            if (this._HasValue(Borders.BottomProperty))
                borders.Bottom = this.Bottom._SerializeBorder();
            else
                borders.Bottom = null;
            if (this._HasValue(Borders.DiagonalDownProperty))
                borders.DiagonalDown = this.DiagonalDown._SerializeBorder();
            else
                borders.DiagonalDown = null;
            if (this._HasValue(Borders.DiagonalUpProperty))
                borders.DiagonalUp = this.DiagonalUp._SerializeBorder();
            else
                borders.DiagonalUp = null;
            if (this._HasValue(Borders.HorizontalProperty))
                borders.Horizontal = this.Horizontal._SerializeBorder();
            else
                borders.Horizontal = null;
            if (this._HasValue(Borders.LeftProperty))
                borders.Left = this.Left._SerializeBorder();
            else
                borders.Left = null;
            if (this._HasValue(Borders.RightProperty))
                borders.Right = this.Right._SerializeBorder();
            else
                borders.Right = null;
            if (this._HasValue(Borders.TopProperty))
                borders.Top = this.Top._SerializeBorder();
            else
                borders.Top = null;
            if (this._HasValue(Borders.VerticalProperty))
                borders.Vertical = this.Vertical._SerializeBorder();
            else
                borders.Vertical = null;
            return borders;
        };
        Borders.LeftProperty = "Left";
        Borders.RightProperty = "Right";
        Borders.TopProperty = "Top";
        Borders.BottomProperty = "Bottom";
        Borders.HorizontalProperty = "Horizontal";
        Borders.VerticalProperty = "Vertical";
        Borders.DiagonalUpProperty = "DiagonalUp";
        Borders.DiagonalDownProperty = "DiagonalDown";
        return Borders;
    }(BaseNode));
    DocumentEditorFeatures.Borders = Borders;
    var Border = (function (_super) {
        __extends(Border, _super);
        function Border(node) {
            _super.call(this, node);
            this.propertyFlag = 0;
        }
        Object.defineProperty(Border.prototype, "Color", {
            get: function () {
                return this._GetValue(Border.ColorProperty);
            },
            set: function (value) {
                this._SetValue(Border.ColorProperty, value);
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(Border.prototype, "LineStyle", {
            get: function () {
                return this._GetValue(Border.LineStyleProperty);
            },
            set: function (value) {
                if (value == LineStyle.None)
                    this.HasNoneStyle = true;
                this._SetValue(Border.LineStyleProperty, value);
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(Border.prototype, "LineWidth", {
            get: function () {
                return this._GetValue(Border.LineWidthProperty);
            },
            set: function (value) {
                this._SetValue(Border.LineWidthProperty, value);
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(Border.prototype, "Shadow", {
            get: function () {
                return this._GetValue(Border.ShadowProperty);
            },
            set: function (value) {
                this._SetValue(Border.ShadowProperty, value);
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(Border.prototype, "Space", {
            get: function () {
                return this._GetValue(Border.SpaceProperty);
            },
            set: function (value) {
                this._SetValue(Border.SpaceProperty, value);
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(Border.prototype, "HasNoneStyle", {
            get: function () {
                return this.hasNoneStyle;
            },
            set: function (value) {
                this.hasNoneStyle = value;
            },
            enumerable: true,
            configurable: true
        });
        Border.prototype._HasValue = function (property) {
            switch (property) {
                case Border.ColorProperty:
                    return (this.propertyFlag & 1) == 1;
                case Border.LineStyleProperty:
                    return (this.propertyFlag & 2) == 2;
                case Border.LineWidthProperty:
                    return (this.propertyFlag & 4) == 4;
                case Border.ShadowProperty:
                    return (this.propertyFlag & 8) == 8;
                case Border.SpaceProperty:
                    return (this.propertyFlag & 16) == 16;
                default:
                    return false;
            }
        };
        Border.prototype._SetValue = function (property, value) {
            if (value == undefined) {
                return;
            }
            var hasValue = this._HasValue(property);
            var flag = 0;
            switch (property) {
                case Border.ColorProperty:
                    flag |= 1;
                    this.color = value;
                    break;
                case Border.LineStyleProperty:
                    flag |= 2;
                    this.lineStyle = value;
                    break;
                case Border.LineWidthProperty:
                    flag |= 4;
                    this.lineWidth = value;
                    break;
                case Border.ShadowProperty:
                    flag |= 8;
                    this.shadow = value;
                    break;
                case Border.SpaceProperty:
                    flag |= 16;
                    this.space = value;
                    break;
            }
            if (!hasValue) {
                this.propertyFlag |= flag;
            }
        };
        Border.prototype._GetValue = function (property) {
            var hasValue = this._HasValue(property);
            var isDefault = !hasValue;
            var value;
            switch (property) {
                case Border.ColorProperty:
                    if (isDefault)
                        value = "#000000";
                    else
                        value = this.color;
                    break;
                case Border.LineStyleProperty:
                    if (isDefault)
                        value = LineStyle.None;
                    else
                        value = this.lineStyle;
                    break;
                case Border.LineWidthProperty:
                    if (isDefault)
                        value = 0;
                    else
                        value = this.lineWidth;
                    break;
                case Border.ShadowProperty:
                    if (isDefault)
                        value = false;
                    else
                        value = this.shadow;
                    break;
                case Border.SpaceProperty:
                    if (isDefault)
                        value = 0;
                    else
                        value = this.space;
                    break;
            }
            return value;
        };
        Border.prototype._ClearValue = function (property) {
            switch (property) {
                case Border.ColorProperty:
                    this.propertyFlag = this.propertyFlag ^ 1;
                case Border.LineStyleProperty:
                    this.propertyFlag = this.propertyFlag ^ 2;
                case Border.LineWidthProperty:
                    this.propertyFlag = this.propertyFlag ^ 4;
                case Border.ShadowProperty:
                    this.propertyFlag = this.propertyFlag ^ 8;
                case Border.SpaceProperty:
                    this.propertyFlag = this.propertyFlag ^ 16;
            }
        };
        Border.prototype._CopyFormat = function (sourceFormat) {
            if (sourceFormat.color != null && sourceFormat.color != undefined)
                this.Color = sourceFormat.color;
            if (sourceFormat.lineStyle != null && sourceFormat.lineStyle != undefined)
                this.LineStyle = sourceFormat.lineStyle;
            if (sourceFormat.lineWidth != null && sourceFormat.lineWidth != undefined)
                this.LineWidth = sourceFormat.lineWidth;
            if (sourceFormat.shadow != null && sourceFormat.shadow != undefined)
                this.Shadow = sourceFormat.shadow;
            if (sourceFormat.space != null && sourceFormat.space != undefined)
                this.Space = sourceFormat.space;
        };
        Border.prototype._GetPrecedence = function () {
            var value = 0;
            switch (this.LineStyle) {
                case LineStyle.Single:
                    value = 1;
                    break;
                case LineStyle.Thick:
                    value = 2;
                    break;
                case LineStyle.Double:
                    value = 3;
                    break;
                case LineStyle.Dot:
                    value = 4;
                    break;
                case LineStyle.DashLargeGap:
                    value = 5;
                    break;
                case LineStyle.DashDot:
                    value = 6;
                    break;
                case LineStyle.DashDotDot:
                    value = 7;
                    break;
                case LineStyle.Triple:
                    value = 8;
                    break;
                case LineStyle.ThinThickSmallGap:
                    value = 9;
                    break;
                case LineStyle.ThickThinSmallGap:
                    value = 10;
                    break;
                case LineStyle.ThinThickThinSmallGap:
                    value = 11;
                    break;
                case LineStyle.ThinThickMediumGap:
                    value = 12;
                    break;
                case LineStyle.ThickThinMediumGap:
                    value = 13;
                    break;
                case LineStyle.ThinThickThinMediumGap:
                    value = 14;
                    break;
                case LineStyle.ThinThickLargeGap:
                    value = 15;
                    break;
                case LineStyle.ThickThinLargeGap:
                    value = 16;
                    break;
                case LineStyle.ThinThickThinLargeGap:
                    value = 17;
                    break;
                case LineStyle.SingleWavy:
                    value = 18;
                    break;
                case LineStyle.DoubleWavy:
                    value = 19;
                    break;
                case LineStyle.DashSmallGap:
                    value = 20;
                    break;
                case LineStyle.DashDotStroked:
                    value = 21;
                    break;
                case LineStyle.Emboss3D:
                    value = 22;
                    break;
                case LineStyle.Engrave3D:
                    value = 23;
                    break;
                case LineStyle.Outset:
                    value = 24;
                    break;
                case LineStyle.Inset:
                    value = 25;
                    break;
            }
            return value;
        };
        Border.prototype._GetBorderWeight = function () {
            var weight = 0;
            var numberOfLines = this._GetNumberOfLines();
            var borderNumber = this._GetBorderNumber();
            switch (this.LineStyle) {
                case LineStyle.Single:
                case LineStyle.DashSmallGap:
                case LineStyle.DashDot:
                case LineStyle.DashDotDot:
                case LineStyle.Double:
                case LineStyle.Triple:
                case LineStyle.ThinThickSmallGap:
                case LineStyle.ThickThinSmallGap:
                case LineStyle.ThinThickThinSmallGap:
                case LineStyle.ThinThickMediumGap:
                case LineStyle.ThickThinMediumGap:
                case LineStyle.ThinThickThinMediumGap:
                case LineStyle.ThinThickLargeGap:
                case LineStyle.ThickThinLargeGap:
                case LineStyle.ThinThickThinLargeGap:
                case LineStyle.SingleWavy:
                case LineStyle.DoubleWavy:
                case LineStyle.DashDotStroked:
                case LineStyle.Emboss3D:
                case LineStyle.Engrave3D:
                case LineStyle.Outset:
                case LineStyle.Inset:
                case LineStyle.Thick:
                    weight = numberOfLines * borderNumber;
                    break;
                case LineStyle.Dot:
                case LineStyle.DashLargeGap:
                    weight = 1;
                    break;
            }
            return weight;
        };
        Border.prototype._GetBorderNumber = function () {
            var borderNumber = 0;
            switch (this.LineStyle) {
                case LineStyle.Single:
                    borderNumber = 1;
                    break;
                case LineStyle.Thick:
                    borderNumber = 2;
                    break;
                case LineStyle.Double:
                    borderNumber = 3;
                    break;
                case LineStyle.Dot:
                    borderNumber = 4;
                    break;
                case LineStyle.DashLargeGap:
                    borderNumber = 5;
                    break;
                case LineStyle.DashDot:
                    borderNumber = 6;
                    break;
                case LineStyle.DashDotDot:
                    borderNumber = 7;
                    break;
                case LineStyle.Triple:
                    borderNumber = 8;
                    break;
                case LineStyle.ThinThickSmallGap:
                    borderNumber = 9;
                    break;
                case LineStyle.ThickThinSmallGap:
                    borderNumber = 10;
                    break;
                case LineStyle.ThinThickThinSmallGap:
                    borderNumber = 11;
                    break;
                case LineStyle.ThinThickMediumGap:
                    borderNumber = 12;
                    break;
                case LineStyle.ThickThinMediumGap:
                    borderNumber = 13;
                    break;
                case LineStyle.ThinThickThinMediumGap:
                    borderNumber = 14;
                    break;
                case LineStyle.ThinThickLargeGap:
                    borderNumber = 15;
                    break;
                case LineStyle.ThickThinLargeGap:
                    borderNumber = 16;
                    break;
                case LineStyle.ThinThickThinLargeGap:
                    borderNumber = 17;
                    break;
                case LineStyle.SingleWavy:
                    borderNumber = 18;
                    break;
                case LineStyle.DoubleWavy:
                    borderNumber = 19;
                    break;
                case LineStyle.DashSmallGap:
                    borderNumber = 20;
                    break;
                case LineStyle.DashDotStroked:
                    borderNumber = 21;
                    break;
                case LineStyle.Emboss3D:
                    borderNumber = 22;
                    break;
                case LineStyle.Engrave3D:
                    borderNumber = 23;
                    break;
                case LineStyle.Outset:
                    borderNumber = 24;
                    break;
                case LineStyle.Inset:
                    borderNumber = 25;
                    break;
            }
            return borderNumber;
        };
        Border.prototype._GetNumberOfLines = function () {
            var value = 0;
            switch (this.LineStyle) {
                case LineStyle.Single:
                case LineStyle.Dot:
                case LineStyle.DashSmallGap:
                case LineStyle.DashLargeGap:
                case LineStyle.DashDot:
                case LineStyle.DashDotDot:
                    value = 1;
                    break;
                case LineStyle.Double:
                    value = 3;
                    break;
                case LineStyle.Triple:
                    value = 5;
                    break;
                case LineStyle.ThinThickSmallGap:
                    value = 3;
                    break;
                case LineStyle.ThickThinSmallGap:
                    value = 3;
                    break;
                case LineStyle.ThinThickThinSmallGap:
                    value = 5;
                    break;
                case LineStyle.ThinThickMediumGap:
                    value = 3;
                    break;
                case LineStyle.ThickThinMediumGap:
                    value = 3;
                    break;
                case LineStyle.ThinThickThinMediumGap:
                    value = 5;
                    break;
                case LineStyle.ThinThickLargeGap:
                    value = 3;
                    break;
                case LineStyle.ThickThinLargeGap:
                    value = 3;
                    break;
                case LineStyle.ThinThickThinLargeGap:
                    value = 5;
                    break;
                case LineStyle.SingleWavy:
                    value = 1;
                    break;
                case LineStyle.DoubleWavy:
                    value = 2;
                    break;
                case LineStyle.DashDotStroked:
                    value = 1;
                    break;
                case LineStyle.Emboss3D:
                case LineStyle.Engrave3D:
                    value = 3;
                    break;
                case LineStyle.Outset:
                case LineStyle.Inset:
                case LineStyle.Thick:
                    value = 1;
                    break;
            }
            return value;
        };
        Border.prototype._GetLineWidth = function () {
            switch (this.LineStyle) {
                case LineStyle.None:
                    return 0;
                case LineStyle.Triple:
                case LineStyle.Double:
                case LineStyle.ThinThickSmallGap:
                case LineStyle.ThickThinSmallGap:
                case LineStyle.ThinThickThinSmallGap:
                case LineStyle.ThinThickMediumGap:
                case LineStyle.ThickThinMediumGap:
                case LineStyle.ThinThickThinMediumGap:
                case LineStyle.ThinThickLargeGap:
                case LineStyle.ThickThinLargeGap:
                case LineStyle.ThinThickThinLargeGap:
                case LineStyle.Emboss3D:
                case LineStyle.Engrave3D:
                    {
                        var lineArray = this._GetBorderLineWidthArray(LineStyle, this.LineWidth);
                        var width = 0;
                        for (var i = 0; i < lineArray.length; i++) {
                            width += lineArray[i];
                        }
                        return width;
                    }
                case LineStyle.Single:
                case LineStyle.DashLargeGap:
                case LineStyle.DashSmallGap:
                case LineStyle.Dot:
                case LineStyle.DashDot:
                case LineStyle.DashDotDot:
                case LineStyle.Thick:
                    return this.LineWidth;
                case LineStyle.SingleWavy:
                    return (this.LineWidth == 1.5 ? 3 : 2.5);
                case LineStyle.DoubleWavy:
                    return (6.75);
                case LineStyle.DashDotStroked:
                case LineStyle.Outset:
                    return this.LineWidth;
            }
            return this.LineWidth;
        };
        Border.prototype._GetBorderLineWidthArray = function (LineStyle, lineWidth) {
            var borderLineArray = [lineWidth];
            switch (this.LineStyle) {
                case LineStyle.Double:
                    borderLineArray = [1, 1, 1];
                    break;
                case LineStyle.ThinThickSmallGap:
                    borderLineArray = [1, -0.75, -0.75];
                    break;
                case LineStyle.ThickThinSmallGap:
                    borderLineArray = [-0.75, -0.75, 1];
                    break;
                case LineStyle.ThinThickMediumGap:
                    borderLineArray = [1, 0.5, 0.5];
                    break;
                case LineStyle.ThickThinMediumGap:
                    borderLineArray = [0.5, 0.5, 1];
                    break;
                case LineStyle.ThinThickLargeGap:
                    borderLineArray = [-1.5, 1, -0.75];
                    break;
                case LineStyle.ThickThinLargeGap:
                    borderLineArray = [-0.75, 1, -1.5];
                    break;
                case LineStyle.Triple:
                    borderLineArray = [1, 1, 1, 1, 1];
                    break;
                case LineStyle.ThinThickThinSmallGap:
                    borderLineArray = [-0.75, -0.75, 1, -0.75, -0.75];
                    break;
                case LineStyle.ThinThickThinMediumGap:
                    borderLineArray = [0.5, 0.5, 1, 0.5, 0.5];
                    break;
                case LineStyle.ThinThickThinLargeGap:
                    borderLineArray = [-0.75, 1, -1.5, 1, -0.75];
                    break;
                case LineStyle.Emboss3D:
                case LineStyle.Engrave3D:
                    borderLineArray = [0.25, 0, 1, 0, 0.25];
                    break;
            }
            if (borderLineArray.length == 1) {
                return [lineWidth];
            }
            for (var i = 0; i < borderLineArray.length; i++) {
                if (borderLineArray[i] >= 0) {
                    borderLineArray[i] = borderLineArray[i] * lineWidth;
                }
                else {
                    borderLineArray[i] = Math.abs(borderLineArray[i]);
                }
            }
            return borderLineArray;
        };
        Border.prototype._GetAsHtmlStyle = function (borderPosition) {
            var html = "";
            html += "border-" + borderPosition + "-style:" + this._GetHtmlLineStyle();
            html += HTMLOperators.SemiColon;
            if (this.LineWidth > 0)
                html += "border-" + borderPosition + "-width:" + this.LineWidth.toString() + "px;";
            if (this.Color != "#000000")
                html += "border-" + borderPosition + "-color:" + this.Color + HTMLOperators.SemiColon;
            return html;
        };
        Border.prototype._GetHtmlLineStyle = function () {
            switch (this.LineStyle) {
                case LineStyle.None:
                    return "none";
                case LineStyle.Single:
                    return "solid";
                case LineStyle.Dot:
                    return "dotted";
                case LineStyle.DashSmallGap:
                case LineStyle.DashLargeGap:
                case LineStyle.DashDot:
                case LineStyle.DashDotDot:
                    return "dashed";
                case LineStyle.Double:
                case LineStyle.Triple:
                case LineStyle.ThinThickSmallGap:
                case LineStyle.ThickThinSmallGap:
                case LineStyle.ThinThickThinSmallGap:
                case LineStyle.ThinThickMediumGap:
                case LineStyle.ThickThinMediumGap:
                case LineStyle.ThinThickThinMediumGap:
                case LineStyle.ThinThickLargeGap:
                case LineStyle.ThickThinLargeGap:
                case LineStyle.ThinThickThinLargeGap:
                    return "double";
                case LineStyle.SingleWavy:
                    return "solid";
                case LineStyle.DoubleWavy:
                    return "double";
                case LineStyle.DashDotStroked:
                    return "solid";
                case LineStyle.Emboss3D:
                    return "ridge";
                case LineStyle.Engrave3D:
                    return "groove";
                case LineStyle.Outset:
                    return "outset";
                case LineStyle.Inset:
                    return "inset";
                default:
                    return "solid";
            }
        };
        Border.prototype._Clone = function () {
            var border = new Border(null);
            border.Color = this.Color;
            border.LineStyle = this.LineStyle;
            border.LineWidth = this.LineWidth;
            border.Shadow = this.Shadow;
            border.Space = this.Space;
            return border;
        };
        Border.prototype._SerializeBorder = function () {
            var borders = {
                "Color": [], "LineStyle": [], "LineWidth": []
            };
            if (this._HasValue(Border.ColorProperty))
                borders.Color = this.Color;
            else
                borders.Color = null;
            if (this._HasValue(Border.LineStyleProperty))
                borders.LineStyle = this.LineStyle;
            else
                borders.LineStyle = null;
            if (this._HasValue(Border.LineWidthProperty))
                borders.LineWidth = this.LineWidth;
            else
                borders.LineWidth = null;
            return borders;
        };
        Border.ColorProperty = "Color";
        Border.LineStyleProperty = "LineStyle";
        Border.LineWidthProperty = "LineWidth";
        Border.ShadowProperty = "Shadow";
        Border.SpaceProperty = "Space";
        return Border;
    }(BaseNode));
    DocumentEditorFeatures.Border = Border;
    var TableFormat = (function (_super) {
        __extends(TableFormat, _super);
        function TableFormat(node) {
            _super.call(this, node);
            this.propertyFlag = 0;
            this.Borders = new Borders(this);
            this._AssignTableMarginValue(7.2, 7.2, 7.2, 7.2);
            this.Shading = new Shading(this);
        }
        Object.defineProperty(TableFormat.prototype, "Borders", {
            get: function () {
                return this._GetValue(TableFormat.BordersProperty);
            },
            set: function (value) {
                this._SetValue(TableFormat.BordersProperty, value);
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(TableFormat.prototype, "CellSpacing", {
            get: function () {
                return this._GetValue(TableFormat.CellSpacingProperty);
            },
            set: function (value) {
                if (value < 0 || value > 264.6)
                    throw new RangeError("The measuremnet must be between 0 px and 264.6 px.");
                this._SetValue(TableFormat.CellSpacingProperty, value);
                this._OnCellSpacingChanged(this);
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(TableFormat.prototype, "LeftMargin", {
            get: function () {
                return this._GetValue(TableFormat.LeftMarginProperty);
            },
            set: function (value) {
                this._ValidateMarginValue(value);
                this._SetValue(TableFormat.LeftMarginProperty, value);
                this._OnLeftMarginChanged(this);
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(TableFormat.prototype, "TopMargin", {
            get: function () {
                return this._GetValue(TableFormat.TopMarginProperty);
            },
            set: function (value) {
                this._ValidateMarginValue(value);
                this._SetValue(TableFormat.TopMarginProperty, value);
                this._OnTopMarginChanged(this);
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(TableFormat.prototype, "RightMargin", {
            get: function () {
                return this._GetValue(TableFormat.RightMarginProperty);
            },
            set: function (value) {
                this._ValidateMarginValue(value);
                this._SetValue(TableFormat.RightMarginProperty, value);
                this._OnRightMarginChanged(this);
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(TableFormat.prototype, "BottomMargin", {
            get: function () {
                return this._GetValue(TableFormat.BottomMarginProperty);
            },
            set: function (value) {
                this._ValidateMarginValue(value);
                this._SetValue(TableFormat.BottomMarginProperty, value);
                this._OnBottomMarginChanged(this);
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(TableFormat.prototype, "LeftIndent", {
            get: function () {
                return this._GetValue(TableFormat.LeftIndentProperty);
            },
            set: function (value) {
                if (value < -1440 || value > 1440)
                    throw new RangeError("The measuremnet must be between -1440 px and 1440 px.");
                this._SetValue(TableFormat.LeftIndentProperty, value);
                this._OnLeftIndentChanged(this);
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(TableFormat.prototype, "Shading", {
            get: function () {
                return this._GetValue(TableFormat.ShadingProperty);
            },
            set: function (value) {
                this._SetValue(TableFormat.ShadingProperty, value);
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(TableFormat.prototype, "TableAlignment", {
            get: function () {
                return this._GetValue(TableFormat.TableAlignmentProperty);
            },
            set: function (value) {
                this._SetValue(TableFormat.TableAlignmentProperty, value);
                this._OnTableAlignmentChanged(this);
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(TableFormat.prototype, "PreferredWidth", {
            get: function () {
                return this._GetValue(TableFormat.PreferredWidthProperty);
            },
            set: function (value) {
                this._SetValue(TableFormat.PreferredWidthProperty, value);
                this._OnTableWidthChanged(this);
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(TableFormat.prototype, "PreferredWidthType", {
            get: function () {
                return this._GetValue(TableFormat.PreferredWidthTypeProperty);
            },
            set: function (value) {
                this._SetValue(TableFormat.PreferredWidthTypeProperty, value);
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(TableFormat.prototype, "Document", {
            get: function () {
                if (this.OwnerBase instanceof TableAdv
                    && this.OwnerBase != null
                    && this.OwnerBase.Document != null)
                    return this.OwnerBase.Document;
                return null;
            },
            enumerable: true,
            configurable: true
        });
        TableFormat.prototype._OnCellSpacingChanged = function (tableFormat) {
            tableFormat._Relayout();
        };
        TableFormat.prototype._OnLeftIndentChanged = function (tableFormat) {
            if (tableFormat.OwnerBase instanceof TableAdv)
                tableFormat._Relayout();
        };
        TableFormat.prototype._OnTableAlignmentChanged = function (tableFormat) {
            if (tableFormat.TableAlignment != TableAlignment.Left && tableFormat.LeftIndent != 0)
                tableFormat.LeftIndent = 0;
            else
                tableFormat._Relayout();
        };
        TableFormat.prototype._OnTableWidthChanged = function (tableFormat) {
            if (tableFormat.OwnerBase instanceof TableAdv)
                tableFormat._Relayout();
        };
        TableFormat.prototype._OnLeftMarginChanged = function (tableFormat) {
            tableFormat._Relayout();
        };
        TableFormat.prototype._OnRightMarginChanged = function (tableFormat) {
            tableFormat._Relayout();
        };
        TableFormat.prototype._OnTopMarginChanged = function (tableFormat) {
            tableFormat._Relayout();
        };
        TableFormat.prototype._OnBottomMarginChanged = function (tableFormat) {
            tableFormat._Relayout();
        };
        TableFormat.prototype._GetAsHtmlStyle = function () {
            var attributes = "";
            if (this.Shading != undefined && this.Shading != null && this.Shading.BackgroundColor != undefined && this.Shading.BackgroundColor != null)
                attributes += " " + CssConstants.BgColor + HTMLOperators.Equal + "\"" + this.Shading.BackgroundColor + "\"";
            attributes += " border=\"1\"";
            attributes += " cellpadding=\"0\"";
            var style = " style=\"";
            if (this.LeftIndent != undefined && this.LeftIndent != 0)
                style += CssConstants.LeftIndent + HTMLOperators.Colon + this.LeftIndent.toString() + "px;";
            if (this._HasValue(TableFormat.CellSpacingProperty))
                style += "cellspacing:" + (((this.CellSpacing * 72) / 96) * 2).toString() + HTMLOperators.SemiColon;
            else
                style += "border-collapse:collapse;";
            if (this.Borders != undefined && this.Borders != null) {
                style += this.Borders._GetAsHtmlStyle();
            }
            style += "\" ";
            return attributes + style;
        };
        TableFormat.prototype._CopyFormat = function (sourceFormat) {
            if (sourceFormat.borders != undefined && sourceFormat.borders != null) {
                this.Borders = new Borders(this);
                this.Borders._CopyFormat(sourceFormat.borders);
            }
            if (sourceFormat.cellSpacing != undefined && sourceFormat.cellSpacing != null)
                this.CellSpacing = sourceFormat.cellSpacing;
            if (sourceFormat.leftMargin != undefined && sourceFormat.leftMargin != null)
                this.LeftMargin = sourceFormat.leftMargin;
            if (sourceFormat.topMargin != undefined && sourceFormat.topMargin != null)
                this.TopMargin = sourceFormat.topMargin;
            if (sourceFormat.rightMargin != undefined && sourceFormat.rightMargin != null)
                this.RightMargin = sourceFormat.rightMargin;
            if (sourceFormat.bottomMargin != undefined && sourceFormat.bottomMargin != null)
                this.BottomMargin = sourceFormat.bottomMargin;
            if (sourceFormat.leftIndent != undefined && sourceFormat.leftIndent != null)
                this.LeftIndent = sourceFormat.leftIndent;
            if (sourceFormat.shading != undefined && sourceFormat.shading != null) {
                this.Shading = new Shading(this);
                this.Shading._CopyFormat(sourceFormat.shading);
            }
            if (sourceFormat.tableAlignment != undefined && sourceFormat.tableAlignment != null)
                this.TableAlignment = sourceFormat.tableAlignment;
            if (sourceFormat.prefferedWidth != undefined && sourceFormat.prefferedWidth != null)
                this.PreferredWidth = sourceFormat.prefferedWidth;
            if (sourceFormat.prefferedWidthType != undefined && sourceFormat.prefferedWidthType != null)
                this.PreferredWidthType = sourceFormat.prefferedWidthType;
        };
        TableFormat.prototype._InitializeTableBorders = function () {
            this.Borders.Left.LineStyle = LineStyle.Single;
            this.Borders.Left.LineWidth = 0.66;
            this.Borders.Right.LineStyle = LineStyle.Single;
            this.Borders.Right.LineWidth = 0.66;
            this.Borders.Top.LineStyle = LineStyle.Single;
            this.Borders.Top.LineWidth = 0.66;
            this.Borders.Bottom.LineStyle = LineStyle.Single;
            this.Borders.Bottom.LineWidth = 0.66;
            this.Borders.Horizontal.LineStyle = LineStyle.Single;
            this.Borders.Horizontal.LineWidth = 0.66;
            this.Borders.Vertical.LineStyle = LineStyle.Single;
            this.Borders.Vertical.LineWidth = 0.66;
        };
        TableFormat.prototype._AssignTableMarginValue = function (left, top, right, bottom) {
            this.LeftMargin = left;
            this.TopMargin = top;
            this.RightMargin = right;
            this.BottomMargin = bottom;
        };
        TableFormat.prototype._ApplyPropertyValue = function (baseHistoryInfo, property, value) {
            if (baseHistoryInfo != null)
                value = baseHistoryInfo._AddModifiedPropertiesForTableFormat(this, property, value);
            if (value == null) {
                this._ClearValue(property);
                return;
            }
            if (value instanceof TableFormat) {
                if (property == null)
                    this._HandleTableFormat(value);
                return;
            }
            if (property == TableFormat.LeftIndentProperty)
                this.LeftIndent = value;
            else if (property == TableFormat.TableAlignmentProperty)
                this.TableAlignment = value;
            else if (property == TableFormat.CellSpacingProperty)
                this.CellSpacing = value;
            else if (property == TableFormat.LeftMarginProperty)
                this.LeftMargin = value;
            else if (property == TableFormat.RightMarginProperty)
                this.RightMargin = value;
            else if (property == TableFormat.TopMarginProperty)
                this.TopMargin = value;
            else if (property == TableFormat.BottomMarginProperty)
                this.BottomMargin = value;
            else if (property == TableFormat.ShadingProperty)
                this.Shading = value;
            else if (property == TableFormat.BordersProperty)
                this.Borders = value;
        };
        TableFormat.prototype._HandleTableFormat = function (format) {
            if (format._HasValue(TableFormat.PreferredWidthProperty))
                this.PreferredWidth = format.PreferredWidth;
            var document = this.Document;
            if (document != null && document.OwnerControl != null)
                document.OwnerControl.IsLayoutEnabled = false;
            if (format._HasValue(TableFormat.LeftIndentProperty))
                this.LeftIndent = format.LeftIndent;
            if (format._HasValue(TableFormat.TableAlignmentProperty))
                this.TableAlignment = format.TableAlignment;
            if (format._HasValue(TableFormat.CellSpacingProperty))
                this.CellSpacing = format.CellSpacing;
            if (format._HasValue(TableFormat.LeftMarginProperty))
                this.LeftMargin = format.LeftMargin;
            if (format._HasValue(TableFormat.RightMarginProperty))
                this.RightMargin = format.RightMargin;
            if (format._HasValue(TableFormat.TopMarginProperty))
                this.TopMargin = format.TopMargin;
            if (format._HasValue(TableFormat.BottomMarginProperty))
                this.BottomMargin = format.BottomMargin;
            if (format._HasValue(TableFormat.BordersProperty))
                this.Borders = format.Borders;
            if (format._HasValue(TableFormat.ShadingProperty))
                this.Shading = format.Shading;
            if (document != null && document.OwnerControl != null)
                document.OwnerControl.IsLayoutEnabled = true;
            this._Relayout();
        };
        TableFormat.prototype._Relayout = function () {
            if (this.OwnerBase instanceof TableAdv)
                this.OwnerBase._LayoutItem(true);
        };
        TableFormat.prototype._CloneFormat = function () {
            var format = new TableFormat(null);
            format.LeftIndent = this.LeftIndent;
            format.TableAlignment = this.TableAlignment;
            format.CellSpacing = this.CellSpacing;
            format.LeftMargin = this.LeftMargin;
            format.RightMargin = this.RightMargin;
            format.TopMargin = this.TopMargin;
            format.BottomMargin = this.BottomMargin;
            format.Borders = Borders == null ? null : this.Borders._Clone();
            format.Shading = Shading == null ? null : this.Shading._Clone();
            return format;
        };
        TableFormat.prototype._Dispose = function () {
            this._SetOwner(null);
            this.Borders._Dispose();
            this.Shading._Dispose();
        };
        TableFormat.prototype._SerializeTableFormat = function () {
            var tableFormat = {
                "Borders": [], "BottomMargin": [], "CellSpacing": [], "LeftIndent": [],
                "LeftMargin": [], "PreferredWidth": [], "PreferredWidthType": [], "RightMargin": [],
                "Shading": [], "TableAlignment": [], "TopMargin": []
            };
            if (this._HasValue(TableFormat.BordersProperty))
                tableFormat.Borders = this.Borders._SerializeBorders();
            else
                tableFormat.Borders = null;
            if (this._HasValue(TableFormat.ShadingProperty))
                tableFormat.Shading = this.Shading._SerializeShading();
            else
                tableFormat.Shading = null;
            if (this._HasValue(TableFormat.BottomMarginProperty))
                tableFormat.BottomMargin = this.BottomMargin;
            else
                tableFormat.BottomMargin = null;
            if (this._HasValue(TableFormat.CellSpacingProperty))
                tableFormat.CellSpacing = this.CellSpacing;
            else
                tableFormat.CellSpacing = null;
            if (this._HasValue(TableFormat.LeftIndentProperty))
                tableFormat.LeftIndent = this.LeftIndent;
            else
                tableFormat.LeftIndent = null;
            if (this._HasValue(TableFormat.LeftMarginProperty))
                tableFormat.LeftMargin = this.LeftMargin;
            else
                tableFormat.LeftMargin = null;
            if (this._HasValue(TableFormat.PreferredWidthProperty))
                tableFormat.PreferredWidth = this.PreferredWidth;
            else
                tableFormat.PreferredWidth = null;
            if (this._HasValue(TableFormat.PreferredWidthTypeProperty))
                tableFormat.PreferredWidthType = this.PreferredWidthType;
            else
                tableFormat.PreferredWidthType = null;
            if (this._HasValue(TableFormat.RightMarginProperty))
                tableFormat.RightMargin = this.RightMargin;
            else
                tableFormat.RightMargin = null;
            if (this._HasValue(TableFormat.TableAlignmentProperty))
                tableFormat.TableAlignment = this.TableAlignment;
            else
                tableFormat.TableAlignment = null;
            if (this._HasValue(TableFormat.TopMarginProperty))
                tableFormat.TopMargin = this.TopMargin;
            else
                tableFormat.TopMargin = null;
            return tableFormat;
        };
        TableFormat.prototype._HasValue = function (property) {
            switch (property) {
                case TableFormat.BordersProperty:
                    return (this.propertyFlag & 1) == 1;
                case TableFormat.CellSpacingProperty:
                    return (this.propertyFlag & 2) == 2;
                case TableFormat.LeftMarginProperty:
                    return (this.propertyFlag & 4) == 4;
                case TableFormat.RightMarginProperty:
                    return (this.propertyFlag & 8) == 8;
                case TableFormat.TopMarginProperty:
                    return (this.propertyFlag & 16) == 16;
                case TableFormat.BottomMarginProperty:
                    return (this.propertyFlag & 32) == 32;
                case TableFormat.LeftIndentProperty:
                    return (this.propertyFlag & 64) == 64;
                case TableFormat.ShadingProperty:
                    return (this.propertyFlag & 128) == 128;
                case TableFormat.TableAlignmentProperty:
                    return (this.propertyFlag & 256) == 256;
                case TableFormat.PreferredWidthProperty:
                    return (this.propertyFlag & 512) == 512;
                case TableFormat.PreferredWidthTypeProperty:
                    return (this.propertyFlag & 1024) == 1024;
                default:
                    return false;
            }
        };
        TableFormat.prototype._SetValue = function (property, value) {
            if (value == undefined) {
                return;
            }
            var hasValue = this._HasValue(property);
            var flag = 0;
            switch (property) {
                case TableFormat.BordersProperty:
                    flag |= 1;
                    this.borders = value;
                    break;
                case TableFormat.CellSpacingProperty:
                    flag |= 2;
                    this.cellSpacing = value;
                    break;
                case TableFormat.LeftMarginProperty:
                    flag |= 4;
                    this.leftMargin = value;
                    break;
                case TableFormat.RightMarginProperty:
                    flag |= 8;
                    this.rightMargin = value;
                    break;
                case TableFormat.TopMarginProperty:
                    flag |= 16;
                    this.topMargin = value;
                    break;
                case TableFormat.BottomMarginProperty:
                    flag |= 32;
                    this.bottomMargin = value;
                    break;
                case TableFormat.LeftIndentProperty:
                    flag |= 64;
                    this.leftIndent = value;
                    break;
                case TableFormat.ShadingProperty:
                    flag |= 128;
                    this.shading = value;
                    break;
                case TableFormat.TableAlignmentProperty:
                    flag |= 256;
                    this.tableAlignment = value;
                    break;
                case TableFormat.PreferredWidthProperty:
                    flag |= 512;
                    this.prefferedWidth = value;
                    break;
                case TableFormat.PreferredWidthTypeProperty:
                    flag |= 1024;
                    this.prefferedWidthType = value;
                    break;
            }
            if (!hasValue) {
                this.propertyFlag |= flag;
            }
        };
        TableFormat.prototype._GetValue = function (property) {
            var hasValue = this._HasValue(property);
            var isDefault = !hasValue;
            var value;
            switch (property) {
                case TableFormat.BordersProperty:
                    if (isDefault)
                        value = null;
                    else
                        value = this.borders;
                    break;
                case TableFormat.CellSpacingProperty:
                    if (isDefault)
                        value = 0;
                    else
                        value = this.cellSpacing;
                    break;
                case TableFormat.LeftMarginProperty:
                    if (isDefault)
                        value = 7.2;
                    else
                        value = this.leftMargin;
                    break;
                case TableFormat.RightMarginProperty:
                    if (isDefault)
                        value = 7.2;
                    else
                        value = this.rightMargin;
                    break;
                case TableFormat.TopMarginProperty:
                    if (isDefault)
                        value = 0;
                    else
                        value = this.topMargin;
                    break;
                case TableFormat.BottomMarginProperty:
                    if (isDefault)
                        value = 0;
                    else
                        value = this.bottomMargin;
                    break;
                case TableFormat.LeftIndentProperty:
                    if (isDefault)
                        value = 0;
                    else
                        value = this.leftIndent;
                    break;
                case TableFormat.ShadingProperty:
                    if (isDefault)
                        value = null;
                    else
                        value = this.shading;
                    break;
                case TableFormat.TableAlignmentProperty:
                    if (isDefault)
                        value = TableAlignment.Left;
                    else
                        value = this.tableAlignment;
                    break;
                case TableFormat.PreferredWidthProperty:
                    if (isDefault)
                        value = 0;
                    else
                        value = this.prefferedWidth;
                    break;
                case TableFormat.PreferredWidthTypeProperty:
                    if (isDefault)
                        value = WidthType.Pixel;
                    else
                        value = this.prefferedWidthType;
                    break;
            }
            return value;
        };
        TableFormat.prototype._ValidateMarginValue = function (value) {
            if (value < 0 || value > 2112)
                throw new RangeError("The measurement must be between 0px and 2112px");
        };
        TableFormat.prototype._ClearValue = function (property) {
            switch (property) {
                case TableFormat.BordersProperty:
                    this.propertyFlag = this.propertyFlag ^ 1;
                case TableFormat.CellSpacingProperty:
                    this.propertyFlag = this.propertyFlag ^ 2;
                case TableFormat.LeftMarginProperty:
                    this.propertyFlag = this.propertyFlag ^ 4;
                case TableFormat.RightMarginProperty:
                    this.propertyFlag = this.propertyFlag ^ 8;
                case TableFormat.TopMarginProperty:
                    this.propertyFlag = this.propertyFlag ^ 16;
                case TableFormat.BottomMarginProperty:
                    this.propertyFlag = this.propertyFlag ^ 32;
                case TableFormat.LeftIndentProperty:
                    this.propertyFlag = this.propertyFlag ^ 64;
                case TableFormat.ShadingProperty:
                    this.propertyFlag = this.propertyFlag ^ 128;
                case TableFormat.TableAlignmentProperty:
                    this.propertyFlag = this.propertyFlag ^ 256;
                case TableFormat.PreferredWidthProperty:
                    this.propertyFlag = this.propertyFlag ^ 512;
                case TableFormat.PreferredWidthTypeProperty:
                    this.propertyFlag = this.propertyFlag ^ 1024;
            }
        };
        TableFormat.BordersProperty = "Borders";
        TableFormat.CellSpacingProperty = "CellSpacing";
        TableFormat.LeftMarginProperty = "LeftMargin";
        TableFormat.TopMarginProperty = "TopMargin";
        TableFormat.RightMarginProperty = "RightMargin";
        TableFormat.BottomMarginProperty = "BottomMargin";
        TableFormat.LeftIndentProperty = "LeftIndent";
        TableFormat.ShadingProperty = "Shading";
        TableFormat.TableAlignmentProperty = "TableAlignment";
        TableFormat.PreferredWidthProperty = "PreferredWidth";
        TableFormat.PreferredWidthTypeProperty = "PreferredWidthType";
        return TableFormat;
    }(BaseNode));
    DocumentEditorFeatures.TableFormat = TableFormat;
    var RowFormat = (function (_super) {
        __extends(RowFormat, _super);
        function RowFormat(node) {
            _super.call(this, node);
            this.propertyFlag = 0;
            this.Borders = new Borders(this);
        }
        Object.defineProperty(RowFormat.prototype, "AllowBreakAcrossPages", {
            get: function () {
                return this._GetValue(RowFormat.AllowBreakAcrossPagesProperty);
            },
            set: function (value) {
                this._SetValue(RowFormat.AllowBreakAcrossPagesProperty, value);
                this._OnAllowRowBreakAcrossPagesChanged(this);
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(RowFormat.prototype, "IsHeader", {
            get: function () {
                return this._GetValue(RowFormat.IsHeaderProperty);
            },
            set: function (value) {
                this._SetValue(RowFormat.IsHeaderProperty, value);
                this._OnIsHeaderChanged(this);
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(RowFormat.prototype, "Height", {
            get: function () {
                return this._GetValue(RowFormat.HeightProperty);
            },
            set: function (value) {
                if (value == 0 && (this.HeightType == HeightType.Atleast || this.HeightType == HeightType.Exactly))
                    value = 1.33;
                else if (this.HeightType == HeightType.Auto)
                    value = 0;
                this._ValidateRowHeight(value);
                this._SetValue(RowFormat.HeightProperty, value);
                this._OnHeightChanged(this);
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(RowFormat.prototype, "HeightType", {
            get: function () {
                return this._GetValue(RowFormat.HeightTypeProperty);
            },
            set: function (value) {
                if (value == HeightType.Atleast || value == HeightType.Exactly)
                    this.Height = 16;
                else
                    this.Height = 0;
                this._SetValue(RowFormat.HeightTypeProperty, value);
                this._OnHeightTypeChanged(this);
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(RowFormat.prototype, "Borders", {
            get: function () {
                return this._GetValue(RowFormat.BordersProperty);
            },
            set: function (value) {
                this._SetValue(RowFormat.BordersProperty, value);
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(RowFormat.prototype, "Document", {
            get: function () {
                if (this.OwnerBase instanceof TableRowAdv
                    && this.OwnerBase.OwnerTable != null
                    && this.OwnerBase.OwnerTable.Document != null)
                    return this.OwnerBase.OwnerTable.Document;
                return null;
            },
            enumerable: true,
            configurable: true
        });
        RowFormat.prototype._OnAllowRowBreakAcrossPagesChanged = function (rowFormat) {
            rowFormat._Relayout();
        };
        RowFormat.prototype._OnHeightTypeChanged = function (rowFormat) {
            rowFormat._Relayout();
        };
        RowFormat.prototype._OnIsHeaderChanged = function (rowFormat) {
            rowFormat._Relayout();
        };
        RowFormat.prototype._HasValue = function (property) {
            switch (property) {
                case RowFormat.AllowBreakAcrossPagesProperty:
                    return (this.propertyFlag & 1) == 1;
                case RowFormat.IsHeaderProperty:
                    return (this.propertyFlag & 2) == 2;
                case RowFormat.HeightProperty:
                    return (this.propertyFlag & 4) == 4;
                case RowFormat.HeightTypeProperty:
                    return (this.propertyFlag & 8) == 8;
                case RowFormat.BordersProperty:
                    return (this.propertyFlag & 16) == 16;
                default:
                    return false;
            }
        };
        RowFormat.prototype._SetValue = function (property, value) {
            if (value == undefined) {
                return;
            }
            var hasValue = this._HasValue(property);
            var flag = 0;
            switch (property) {
                case RowFormat.AllowBreakAcrossPagesProperty:
                    flag |= 1;
                    this.allowBreakAcrossPages = value;
                    break;
                case RowFormat.IsHeaderProperty:
                    flag |= 2;
                    this.isHeader = value;
                    break;
                case RowFormat.HeightProperty:
                    flag |= 4;
                    this.height = value;
                    break;
                case RowFormat.HeightTypeProperty:
                    flag |= 8;
                    this.heightType = value;
                    break;
                case RowFormat.BordersProperty:
                    flag |= 16;
                    this.borders = value;
                    break;
            }
            if (!hasValue) {
                this.propertyFlag |= flag;
            }
        };
        RowFormat.prototype._GetValue = function (property) {
            var hasValue = this._HasValue(property);
            var isDefault = !hasValue;
            var value;
            switch (property) {
                case RowFormat.AllowBreakAcrossPagesProperty:
                    if (isDefault)
                        value = true;
                    else
                        value = this.allowBreakAcrossPages;
                    break;
                case RowFormat.IsHeaderProperty:
                    if (isDefault)
                        value = false;
                    else
                        value = this.isHeader;
                    break;
                case RowFormat.HeightProperty:
                    if (isDefault)
                        value = 0;
                    else
                        value = this.height;
                    break;
                case RowFormat.HeightTypeProperty:
                    if (isDefault)
                        value = HeightType.Auto;
                    else
                        value = this.heightType;
                    break;
                case RowFormat.BordersProperty:
                    if (isDefault)
                        value = null;
                    else
                        value = this.borders;
                    break;
            }
            return value;
        };
        RowFormat.prototype._ValidateRowHeight = function (value) {
            switch (this.HeightType) {
                case HeightType.Auto:
                    break;
                default:
                    if (value < 1.33 || value > 2112)
                        throw new RangeError("The value must be between 1.33px to 2112px");
                    break;
            }
        };
        RowFormat.prototype._ClearValue = function (property) {
            switch (property) {
                case RowFormat.AllowBreakAcrossPagesProperty:
                    this.propertyFlag = this.propertyFlag ^ 1;
                case RowFormat.IsHeaderProperty:
                    this.propertyFlag = this.propertyFlag ^ 2;
                case RowFormat.HeightProperty:
                    this.propertyFlag = this.propertyFlag ^ 4;
                case RowFormat.HeightTypeProperty:
                    this.propertyFlag = this.propertyFlag ^ 8;
                case RowFormat.BordersProperty:
                    this.propertyFlag = this.propertyFlag ^ 16;
            }
        };
        RowFormat.prototype._CopyFormat = function (sourceFormat) {
            if (sourceFormat.allowBreakAcrossPages != undefined && sourceFormat.allowBreakAcrossPages != null)
                this.AllowBreakAcrossPages = sourceFormat.allowBreakAcrossPages;
            if (sourceFormat.isHeader != undefined && sourceFormat.isHeader != null)
                this.IsHeader = sourceFormat.isHeader;
            if (sourceFormat.height != undefined && sourceFormat.height != null)
                this.Height = sourceFormat.height;
            if (sourceFormat.heightType != undefined && sourceFormat.heightType != null)
                this.HeightType = sourceFormat.heightType;
            if (sourceFormat.borders != undefined && sourceFormat.borders != null) {
                this.Borders = new Borders(this);
                this.Borders._CopyFormat(sourceFormat.borders);
            }
        };
        RowFormat.prototype._GetAsHtmlStyle = function () {
            var style = "";
            if (this.Height != undefined && this.Height > 0)
                style = "style =\"" + "height:" + this.Height.toString() + "px;\"";
            return style;
        };
        RowFormat.prototype._ApplyPropertyValue = function (baseHistoryInfo, property, value) {
            if (baseHistoryInfo != null)
                value = baseHistoryInfo._AddModifiedPropertiesForRowFormat(this, property, value);
            if (value == null) {
                this._ClearValue(property);
                return;
            }
            if (value instanceof RowFormat) {
                if (property == null)
                    this._HandleRowFormat(value);
                return;
            }
            if (property == RowFormat.HeightTypeProperty)
                this.HeightType = value;
            else if (property == RowFormat.HeightProperty)
                this.Height = value;
            else if (property == RowFormat.IsHeaderProperty)
                this.IsHeader = value;
            else if (property == RowFormat.AllowBreakAcrossPagesProperty)
                this.AllowBreakAcrossPages = value;
        };
        RowFormat.prototype._HandleRowFormat = function (format) {
            var document = this.Document;
            if (document != null && document.OwnerControl != null)
                document.OwnerControl.IsLayoutEnabled = false;
            if (format._HasValue(RowFormat.HeightTypeProperty))
                this.HeightType = format.HeightType;
            if (format._HasValue(RowFormat.HeightProperty))
                this.Height = format.Height;
            if (format._HasValue(RowFormat.IsHeaderProperty))
                this.IsHeader = format.IsHeader;
            if (format._HasValue(RowFormat.AllowBreakAcrossPagesProperty))
                this.AllowBreakAcrossPages = format.AllowBreakAcrossPages;
            if (document != null && document.OwnerControl != null)
                document.OwnerControl.IsLayoutEnabled = true;
            this._Relayout();
        };
        RowFormat.prototype._Relayout = function () {
            if (this.OwnerBase instanceof TableRowAdv && this.Document != null)
                this.OwnerBase.OwnerTable._LayoutItem(true);
        };
        RowFormat.prototype._CloneFormat = function () {
            var format = new RowFormat(null);
            format.AllowBreakAcrossPages = this.AllowBreakAcrossPages;
            format.Height = this.Height;
            format.HeightType = this.HeightType;
            format.IsHeader = this.IsHeader;
            return format;
        };
        RowFormat.prototype._OnHeightChanged = function (rowFormat) {
            rowFormat._Relayout();
        };
        RowFormat.prototype._SerializeRowFormat = function () {
            var rowFormat = {
                "AllowBreakAcrossPages": [], "Borders": [], "Height": [],
                "HeightType": [], "IsHeader": []
            };
            if (this._HasValue(RowFormat.AllowBreakAcrossPagesProperty))
                rowFormat.AllowBreakAcrossPages = this.AllowBreakAcrossPages;
            else
                rowFormat.AllowBreakAcrossPages = null;
            if (this._HasValue(RowFormat.HeightProperty))
                rowFormat.Height = this.Height;
            else
                rowFormat.Height = null;
            if (this._HasValue(RowFormat.HeightTypeProperty))
                rowFormat.HeightType = this.HeightType;
            else
                rowFormat.HeightType = null;
            if (this._HasValue(RowFormat.IsHeaderProperty))
                rowFormat.IsHeader = this.IsHeader;
            else
                rowFormat.IsHeader = null;
            if (this._HasValue(RowFormat.BordersProperty))
                rowFormat.Borders = this.Borders._SerializeBorders();
            else
                rowFormat.Borders = null;
            return rowFormat;
        };
        RowFormat.AllowBreakAcrossPagesProperty = "AllowBreakAcrossPages";
        RowFormat.IsHeaderProperty = "IsHeader";
        RowFormat.HeightProperty = "Height";
        RowFormat.HeightTypeProperty = "HeightType";
        RowFormat.BordersProperty = "Borders";
        return RowFormat;
    }(BaseNode));
    DocumentEditorFeatures.RowFormat = RowFormat;
    var CellFormat = (function (_super) {
        __extends(CellFormat, _super);
        function CellFormat(node) {
            _super.call(this, node);
            this.propertyFlag = 0;
            this.Borders = new Borders(this);
            this.Shading = new Shading(this);
        }
        Object.defineProperty(CellFormat.prototype, "Borders", {
            get: function () {
                return this._GetValue(CellFormat.BordersProperty);
            },
            set: function (value) {
                this._SetValue(CellFormat.BordersProperty, value);
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(CellFormat.prototype, "LeftMargin", {
            get: function () {
                return this._GetValue(CellFormat.LeftMarginProperty);
            },
            set: function (value) {
                this._ValidateMarginValue(value);
                this._SetValue(CellFormat.LeftMarginProperty, value);
                this._OnLeftMarginChanged(this);
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(CellFormat.prototype, "TopMargin", {
            get: function () {
                return this._GetValue(CellFormat.TopMarginProperty);
            },
            set: function (value) {
                this._ValidateMarginValue(value);
                this._SetValue(CellFormat.TopMarginProperty, value);
                this._OnTopMarginChanged(this);
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(CellFormat.prototype, "BottomMargin", {
            get: function () {
                return this._GetValue(CellFormat.BottomMarginProperty);
            },
            set: function (value) {
                this._ValidateMarginValue(value);
                this._SetValue(CellFormat.BottomMarginProperty, value);
                this._OnBottomMarginChanged(this);
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(CellFormat.prototype, "RightMargin", {
            get: function () {
                return this._GetValue(CellFormat.RightMarginProperty);
            },
            set: function (value) {
                this._ValidateMarginValue(value);
                this._SetValue(CellFormat.RightMarginProperty, value);
                this._OnRightMarginChanged(this);
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(CellFormat.prototype, "CellWidth", {
            get: function () {
                return this._GetValue(CellFormat.CellWidthProperty);
            },
            set: function (value) {
                this._SetValue(CellFormat.CellWidthProperty, value);
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(CellFormat.prototype, "ColumnSpan", {
            get: function () {
                return this._GetValue(CellFormat.ColSpanProperty);
            },
            set: function (value) {
                if (value < 1)
                    throw new RangeError("ColumnSpan value must be greater than or equal to one.");
                this._SetValue(CellFormat.ColSpanProperty, value);
                this._OnColumnSpanChanged(this);
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(CellFormat.prototype, "RowSpan", {
            get: function () {
                return this._GetValue(CellFormat.RowSpanProperty);
            },
            set: function (value) {
                if (value < 1)
                    throw new RangeError("ColumnSpan value must be greater than or equal to one.");
                this._SetValue(CellFormat.RowSpanProperty, value);
                this._OnRowSpanChanged(this);
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(CellFormat.prototype, "PrefferedWidth", {
            get: function () {
                return this._GetValue(CellFormat.PreferredWidthProperty);
            },
            set: function (value) {
                this._SetValue(CellFormat.PreferredWidthProperty, value);
                this._OnPreferredWidthChanged(this);
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(CellFormat.prototype, "PrefferedWidthType", {
            get: function () {
                return this._GetValue(CellFormat.PreferredWidthTypeProperty);
            },
            set: function (value) {
                this._SetValue(CellFormat.PreferredWidthTypeProperty, value);
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(CellFormat.prototype, "Shading", {
            get: function () {
                return this._GetValue(CellFormat.ShadingProperty);
            },
            set: function (value) {
                this._SetValue(CellFormat.ShadingProperty, value);
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(CellFormat.prototype, "VerticalAlignment", {
            get: function () {
                return this._GetValue(CellFormat.VerticalAlignmentProperty);
            },
            set: function (value) {
                this._SetValue(CellFormat.VerticalAlignmentProperty, value);
                this._OnVerticalAlignmentChanged(this);
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(CellFormat.prototype, "Document", {
            get: function () {
                if (this.OwnerBase instanceof TableCellAdv
                    && this.OwnerBase.OwnerTable != null
                    && this.OwnerBase.OwnerTable.Document != null)
                    return this.OwnerBase.OwnerTable.Document;
                return null;
            },
            enumerable: true,
            configurable: true
        });
        CellFormat.prototype._OnColumnSpanChanged = function (cellFormat) {
            if (cellFormat.OwnerBase instanceof TableCellAdv) {
                cellFormat._Relayout();
            }
        };
        CellFormat.prototype._OnRowSpanChanged = function (cellFormat) {
            if (cellFormat.OwnerBase instanceof TableCellAdv) {
                cellFormat._Relayout();
            }
        };
        CellFormat.prototype._OnVerticalAlignmentChanged = function (cellFormat) {
            if (cellFormat.OwnerBase instanceof TableCellAdv && cellFormat.Document != null)
                cellFormat.OwnerBase._UpdateCellVerticalPosition(cellFormat.Document.OwnerControl.Viewer);
        };
        CellFormat.prototype._OnLeftMarginChanged = function (cellFormat) {
            cellFormat._Relayout();
        };
        CellFormat.prototype._OnRightMarginChanged = function (cellFormat) {
            cellFormat._Relayout();
        };
        CellFormat.prototype._OnTopMarginChanged = function (cellFormat) {
            cellFormat._Relayout();
        };
        CellFormat.prototype._OnBottomMarginChanged = function (cellFormat) {
            cellFormat._Relayout();
        };
        CellFormat.prototype._OnPreferredWidthChanged = function (cellFormat) {
            if (cellFormat.OwnerBase instanceof TableCellAdv)
                cellFormat._Relayout();
        };
        CellFormat.prototype._HasValue = function (property) {
            switch (property) {
                case CellFormat.BordersProperty:
                    return (this.propertyFlag & 1) == 1;
                case CellFormat.LeftMarginProperty:
                    return (this.propertyFlag & 2) == 2;
                case CellFormat.RightMarginProperty:
                    return (this.propertyFlag & 4) == 4;
                case CellFormat.TopMarginProperty:
                    return (this.propertyFlag & 8) == 8;
                case CellFormat.BottomMarginProperty:
                    return (this.propertyFlag & 16) == 16;
                case CellFormat.CellWidthProperty:
                    return (this.propertyFlag & 32) == 32;
                case CellFormat.ColSpanProperty:
                    return (this.propertyFlag & 64) == 64;
                case CellFormat.RowSpanProperty:
                    return (this.propertyFlag & 128) == 128;
                case CellFormat.ShadingProperty:
                    return (this.propertyFlag & 256) == 256;
                case CellFormat.VerticalAlignmentProperty:
                    return (this.propertyFlag & 512) == 512;
                case CellFormat.PreferredWidthProperty:
                    return (this.propertyFlag & 1024) == 1024;
                case CellFormat.PreferredWidthTypeProperty:
                    return (this.propertyFlag & 2048) == 2048;
                default:
                    return false;
            }
        };
        CellFormat.prototype._SetValue = function (property, value) {
            if (value == undefined) {
                return;
            }
            var hasValue = this._HasValue(property);
            var flag = 0;
            switch (property) {
                case CellFormat.BordersProperty:
                    flag |= 1;
                    this.borders = value;
                    break;
                case CellFormat.LeftMarginProperty:
                    flag |= 2;
                    this.leftMargin = value;
                    break;
                case CellFormat.RightMarginProperty:
                    flag |= 4;
                    this.rightMargin = value;
                    break;
                case CellFormat.TopMarginProperty:
                    flag |= 8;
                    this.topMargin = value;
                    break;
                case CellFormat.BottomMarginProperty:
                    flag |= 16;
                    this.bottomMargin = value;
                    break;
                case CellFormat.CellWidthProperty:
                    flag |= 32;
                    this.cellWidth = value;
                    break;
                case CellFormat.ColSpanProperty:
                    flag |= 64;
                    this.colSpan = value;
                    break;
                case CellFormat.RowSpanProperty:
                    flag |= 128;
                    this.rowSpan = value;
                    break;
                case CellFormat.ShadingProperty:
                    flag |= 256;
                    this.shading = value;
                    break;
                case CellFormat.VerticalAlignmentProperty:
                    flag |= 512;
                    this.verticalAlignment = value;
                    break;
                case CellFormat.PreferredWidthProperty:
                    flag |= 1024;
                    this.prefferedWidth = value;
                    break;
                case CellFormat.PreferredWidthTypeProperty:
                    flag |= 2048;
                    this.prefferedWidthtype = value;
                    break;
            }
            if (!hasValue) {
                this.propertyFlag |= flag;
            }
        };
        CellFormat.prototype._GetValue = function (property) {
            var hasValue = this._HasValue(property);
            var isDefault = !hasValue;
            var value;
            switch (property) {
                case CellFormat.BordersProperty:
                    if (isDefault)
                        value = null;
                    else
                        value = this.borders;
                    break;
                case CellFormat.CellWidthProperty:
                    if (isDefault)
                        value = 0;
                    else
                        value = this.cellWidth;
                    break;
                case CellFormat.LeftMarginProperty:
                    if (isDefault)
                        value = 0;
                    else
                        value = this.leftMargin;
                    break;
                case CellFormat.RightMarginProperty:
                    if (isDefault)
                        value = 0;
                    else
                        value = this.rightMargin;
                    break;
                case CellFormat.TopMarginProperty:
                    if (isDefault)
                        value = 0;
                    else
                        value = this.topMargin;
                    break;
                case CellFormat.BottomMarginProperty:
                    if (isDefault)
                        value = 0;
                    else
                        value = this.bottomMargin;
                    break;
                case CellFormat.ColSpanProperty:
                    if (isDefault)
                        value = 1;
                    else
                        value = this.colSpan;
                    break;
                case CellFormat.RowSpanProperty:
                    if (isDefault)
                        value = 1;
                    else
                        value = this.rowSpan;
                    break;
                case CellFormat.ShadingProperty:
                    if (isDefault)
                        value = null;
                    else
                        value = this.shading;
                    break;
                case CellFormat.VerticalAlignmentProperty:
                    if (isDefault)
                        value = CellVerticalAlignment.Top;
                    else
                        value = this.verticalAlignment;
                    break;
                case CellFormat.PreferredWidthProperty:
                    if (isDefault)
                        value = 0;
                    else
                        value = this.prefferedWidth;
                    break;
                case CellFormat.PreferredWidthTypeProperty:
                    if (isDefault)
                        value = WidthType.Pixel;
                    else
                        value = this.prefferedWidthtype;
                    break;
            }
            return value;
        };
        CellFormat.prototype._ClearValue = function (property) {
            switch (property) {
                case CellFormat.BordersProperty:
                    this.propertyFlag = this.propertyFlag ^ 1;
                case CellFormat.LeftMarginProperty:
                    this.propertyFlag = this.propertyFlag ^ 2;
                case CellFormat.RightMarginProperty:
                    this.propertyFlag = this.propertyFlag ^ 4;
                case CellFormat.TopMarginProperty:
                    this.propertyFlag = this.propertyFlag ^ 8;
                case CellFormat.BottomMarginProperty:
                    this.propertyFlag = this.propertyFlag ^ 16;
                case CellFormat.CellWidthProperty:
                    this.propertyFlag = this.propertyFlag ^ 32;
                case CellFormat.ColSpanProperty:
                    this.propertyFlag = this.propertyFlag ^ 64;
                case CellFormat.RowSpanProperty:
                    this.propertyFlag = this.propertyFlag ^ 128;
                case CellFormat.ShadingProperty:
                    this.propertyFlag = this.propertyFlag ^ 256;
                case CellFormat.VerticalAlignmentProperty:
                    this.propertyFlag = this.propertyFlag ^ 512;
                case CellFormat.PreferredWidthProperty:
                    this.propertyFlag = this.propertyFlag ^ 1024;
                case CellFormat.PreferredWidthTypeProperty:
                    this.propertyFlag = this.propertyFlag ^ 2048;
            }
        };
        CellFormat.prototype._CopyFormat = function (sourceFormat) {
            if (sourceFormat.borders != undefined && sourceFormat.borders != null) {
                this.Borders = new Borders(this);
                this.Borders._CopyFormat(sourceFormat.borders);
            }
            if (sourceFormat.leftMargin != undefined && sourceFormat.leftMargin != null)
                this.LeftMargin = sourceFormat.leftMargin;
            if (sourceFormat.rightMargin != undefined && sourceFormat.rightMargin != null)
                this.RightMargin = sourceFormat.rightMargin;
            if (sourceFormat.topMargin != undefined && sourceFormat.topMargin != null)
                this.TopMargin = sourceFormat.topMargin;
            if (sourceFormat.bottomMargin != undefined && sourceFormat.bottomMargin != null)
                this.BottomMargin = sourceFormat.bottomMargin;
            if (sourceFormat.cellWidth != undefined && sourceFormat.cellWidth != null)
                this.CellWidth = sourceFormat.cellWidth;
            if (sourceFormat.colSpan != undefined && sourceFormat.colSpan != null)
                this.ColumnSpan = sourceFormat.colSpan;
            if (sourceFormat.rowSpan != undefined && sourceFormat.rowSpan != null)
                this.RowSpan = sourceFormat.rowSpan;
            if (sourceFormat.shading != undefined && sourceFormat.shading != null) {
                this.Shading = new Shading(this);
                this.Shading._CopyFormat(sourceFormat.shading);
            }
            if (sourceFormat.verticalAlignment != undefined && sourceFormat.verticalAlignment != null)
                this.VerticalAlignment = sourceFormat.verticalAlignment;
            if (sourceFormat.prefferedWidthtype != undefined && sourceFormat.prefferedWidthtype != null)
                this.PrefferedWidthType = sourceFormat.prefferedWidthtype;
            if (sourceFormat.prefferedWidth != undefined && sourceFormat.prefferedWidth != null)
                this.PrefferedWidth = sourceFormat.prefferedWidth;
        };
        CellFormat.prototype._ContainsMargins = function () {
            return ((this._HasValue(CellFormat.LeftMarginProperty))
                || (this._HasValue(CellFormat.RightMarginProperty))
                || (this._HasValue(CellFormat.BottomMarginProperty))
                || (this._HasValue(CellFormat.TopMarginProperty)));
        };
        CellFormat.prototype._ClearMargins = function () {
            this.LeftMargin = this.RightMargin = this.TopMargin = this.BottomMargin = undefined;
        };
        CellFormat.prototype._GetAsHtmlStyle = function () {
            var attributes = "";
            attributes += " rowspan=" + this.RowSpan.toString();
            attributes += " colspan=" + this.ColumnSpan.toString();
            if (this.Shading != undefined && this.Shading != null && this.Shading.BackgroundColor != undefined && this.Shading.BackgroundColor != null)
                attributes += " " + CssConstants.BgColor + HTMLOperators.Equal + "\"" + this.Shading.BackgroundColor + "\"";
            if (this.CellWidth != undefined && this.CellWidth > 0)
                attributes += " width=" + this.CellWidth.toString();
            var style = " style=\"";
            if (this.VerticalAlignment != CellVerticalAlignment.Top)
                style += "valign:" + this.VerticalAlignment.toString().toLowerCase();
            if (this._ContainsMargins()) {
                if (this.LeftMargin != undefined && this.LeftMargin != 0)
                    style += "padding-left:" + this.LeftMargin.toString() + "px;";
                if (this.RightMargin != undefined && this.RightMargin != 0)
                    style += "padding-right:" + this.RightMargin.toString() + "px;";
                if (this.TopMargin != undefined && this.TopMargin != 0)
                    style += "padding-top:" + this.TopMargin.toString() + "px;";
                if (this.BottomMargin != undefined && this.BottomMargin != 0)
                    style += "padding-bottom:" + this.BottomMargin.toString() + "px;";
            }
            if (this.Borders != undefined && this.Borders != null)
                style += this.Borders._GetAsHtmlStyle();
            style += "\" ";
            return attributes + style;
        };
        CellFormat.prototype._ApplyPropertyValue = function (baseHistoryInfo, property, value) {
            if (baseHistoryInfo != null)
                value = baseHistoryInfo._AddModifiedPropertiesForCellFormat(this, property, value);
            if (value == null) {
                this._ClearValue(property);
                return;
            }
            if (value instanceof CellFormat) {
                if (property == null)
                    this._HandleCellFormat(value);
                return;
            }
            if (property == CellFormat.LeftMarginProperty)
                this.LeftMargin = value;
            else if (property == CellFormat.TopMarginProperty)
                this.TopMargin = value;
            else if (property == CellFormat.RightMarginProperty)
                this.RightMargin = value;
            else if (property == CellFormat.BottomMarginProperty)
                this.BottomMargin = value;
            else if (property == CellFormat.PreferredWidthProperty)
                this.PrefferedWidth = value;
            else if (property == CellFormat.ColSpanProperty)
                this.ColumnSpan = value;
            else if (property == CellFormat.RowSpanProperty)
                this.RowSpan = value;
            else if (property == CellFormat.PreferredWidthTypeProperty)
                this.PrefferedWidthType = value;
            else if (property == CellFormat.VerticalAlignmentProperty)
                this.VerticalAlignment = value;
            else if (property == CellFormat.ShadingProperty)
                this.Shading = value;
            else if (property == CellFormat.BordersProperty)
                this.Borders = value;
        };
        CellFormat.prototype._CloneFormat = function () {
            var format = new CellFormat(null);
            format.VerticalAlignment = this.VerticalAlignment;
            format.LeftMargin = this.LeftMargin;
            format.RightMargin = this.RightMargin;
            format.TopMargin = this.TopMargin;
            format.BottomMargin = this.BottomMargin;
            format.Borders = Borders == null ? null : this.Borders._Clone();
            format.Shading = Shading == null ? null : this.Shading._Clone();
            return format;
        };
        CellFormat.prototype._HandleCellFormat = function (format) {
            var document = this.Document;
            if (document != null && document.OwnerControl != null)
                document.OwnerControl.IsLayoutEnabled = false;
            if (format._HasValue(CellFormat.LeftMarginProperty))
                this.LeftMargin = format.LeftMargin;
            if (format._HasValue(CellFormat.TopMarginProperty))
                this.TopMargin = format.TopMargin;
            if (format._HasValue(CellFormat.RightMarginProperty))
                this.RightMargin = format.RightMargin;
            if (format._HasValue(CellFormat.BottomMarginProperty))
                this.BottomMargin = format.BottomMargin;
            if (format._HasValue(CellFormat.PreferredWidthProperty))
                this.PrefferedWidth = format.PrefferedWidth;
            if (format._HasValue(CellFormat.ColSpanProperty))
                this.ColumnSpan = format.ColumnSpan;
            if (format._HasValue(CellFormat.RowSpanProperty))
                this.RowSpan = format.RowSpan;
            if (format._HasValue(CellFormat.PreferredWidthTypeProperty))
                this.PrefferedWidthType = format.PrefferedWidthType;
            if (format._HasValue(CellFormat.VerticalAlignmentProperty))
                this.VerticalAlignment = format.VerticalAlignment;
            if (document != null && document.OwnerControl != null)
                document.OwnerControl.IsLayoutEnabled = true;
            this._Relayout();
        };
        CellFormat.prototype._Relayout = function () {
            if (this.OwnerBase instanceof TableCellAdv && this.Document != null)
                this.OwnerBase.OwnerRow._LayoutInternal(this.Document.OwnerControl.Viewer);
        };
        CellFormat.prototype._Dispose = function () {
            this._SetOwner(null);
        };
        CellFormat.prototype._SerializeCellFormat = function () {
            var cellFormat = {
                "Borders": [], "BottomMargin": [], "CellWidth": [],
                "ColumnSpan": [], "IsSamePaddingAsTable": [],
                "LeftMargin": [], "PreferredWidth": [], "PreferredWidthType": [], "RightMargin": [],
                "RowSpan": [], "Shading": [], "TopMargin": [], "VerticalAlignment": []
            };
            if (this._HasValue(CellFormat.BottomMarginProperty))
                cellFormat.BottomMargin = this.BottomMargin;
            else
                cellFormat.BottomMargin = null;
            if (this._HasValue(CellFormat.CellWidthProperty))
                cellFormat.CellWidth = this.CellWidth;
            else
                cellFormat.CellWidth = null;
            if (this._HasValue(CellFormat.ColSpanProperty))
                cellFormat.ColumnSpan = this.ColumnSpan;
            else
                cellFormat.ColumnSpan = null;
            if (this._HasValue(CellFormat.LeftMarginProperty))
                cellFormat.LeftMargin = this.LeftMargin;
            else
                cellFormat.LeftMargin = null;
            if (this._HasValue(CellFormat.PreferredWidthProperty))
                cellFormat.PreferredWidth = this.PrefferedWidth;
            else
                cellFormat.PreferredWidth = null;
            if (this._HasValue(CellFormat.PreferredWidthTypeProperty))
                cellFormat.PreferredWidthType = this.PrefferedWidthType;
            else
                cellFormat.PreferredWidthType = null;
            if (this._HasValue(CellFormat.RightMarginProperty))
                cellFormat.RightMargin = this.RightMargin;
            else
                cellFormat.RightMargin = null;
            if (this._HasValue(CellFormat.RowSpanProperty))
                cellFormat.RowSpan = this.RowSpan;
            else
                cellFormat.RowSpan = null;
            if (this._HasValue(CellFormat.TopMarginProperty))
                cellFormat.TopMargin = this.TopMargin;
            else
                cellFormat.TopMargin = null;
            if (this._HasValue(CellFormat.VerticalAlignmentProperty))
                cellFormat.VerticalAlignment = this.VerticalAlignment;
            else
                cellFormat.VerticalAlignment = null;
            cellFormat.IsSamePaddingAsTable = true;
            if (this._HasValue(CellFormat.BordersProperty))
                cellFormat.Borders = this.Borders._SerializeBorders();
            else
                cellFormat.Borders = null;
            if (this._HasValue(CellFormat.ShadingProperty))
                cellFormat.Shading = this.Shading._SerializeShading();
            else
                cellFormat.Shading = null;
            return cellFormat;
        };
        CellFormat.prototype._ValidateMarginValue = function (value) {
            if (value < 0 || value > 2112)
                throw new RangeError("The measurement must be between 0px and 2112px");
        };
        CellFormat.BordersProperty = "Borders";
        CellFormat.LeftMarginProperty = "LeftMargin";
        CellFormat.TopMarginProperty = "TopMargin";
        CellFormat.RightMarginProperty = "RightMargin";
        CellFormat.BottomMarginProperty = "BottomMargin";
        CellFormat.CellWidthProperty = "CellWidth";
        CellFormat.ColSpanProperty = "ColSpan";
        CellFormat.RowSpanProperty = "RowSpan";
        CellFormat.ShadingProperty = "Shading";
        CellFormat.VerticalAlignmentProperty = "VerticalAlignment";
        CellFormat.PreferredWidthProperty = "PreferredWidth";
        CellFormat.PreferredWidthTypeProperty = "PreferredWidthType";
        return CellFormat;
    }(BaseNode));
    DocumentEditorFeatures.CellFormat = CellFormat;
    var CommentCharacterAdv = (function (_super) {
        __extends(CommentCharacterAdv, _super);
        function CommentCharacterAdv(owner) {
            _super.call(this, owner);
        }
        Object.defineProperty(CommentCharacterAdv.prototype, "Length", {
            get: function () {
                return 1;
            },
            enumerable: true,
            configurable: true
        });
        CommentCharacterAdv.prototype._AddElementBox = function (viewer) {
            var commentElement = new CommentElementBox(this);
            commentElement.Width = 0;
            this.Elements._Add(commentElement);
        };
        CommentCharacterAdv.prototype._Dispose = function () {
            this.CharacterFormat._Dispose();
            this._SetOwner(null);
            this._ClearElements(true);
        };
        CommentCharacterAdv.prototype._InsertText = function (selection, text, index) {
            var span = new SpanAdv(this);
            span.Text = text;
            var spanIndex = this.OwnerParagraph.Inlines._IndexOf(this);
            span.CharacterFormat._CopyFormat(this.CharacterFormat);
            this.OwnerParagraph.Inlines._Insert(spanIndex, span);
        };
        CommentCharacterAdv.prototype._GetPreviousWordOffset = function (indexInInline, type, isInField, isStarted, endSelection, endPosition) { };
        CommentCharacterAdv.prototype._GetNextWordOffset = function (indexInInline, type, isInField, endSelection, endPosition, excludeSpace) { };
        return CommentCharacterAdv;
    }(Inline));
    DocumentEditorFeatures.CommentCharacterAdv = CommentCharacterAdv;
    var CommentAdv = (function (_super) {
        __extends(CommentAdv, _super);
        function CommentAdv(owner, date) {
            _super.call(this, owner);
            this.author = "";
            this.initial = "";
            this.createdDate = date;
            this.blocks = new BlockAdvCollection(this);
        }
        Object.defineProperty(CommentAdv.prototype, "CommentId", {
            get: function () {
                if (this.OwnerParagraph != null && this.OwnerParagraph.Document != null)
                    return this.OwnerParagraph.Document.Comments._IndexOf(this);
                return -1;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(CommentAdv.prototype, "CommentStart", {
            get: function () {
                return this.commentStart;
            },
            set: function (value) {
                this.commentStart = value;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(CommentAdv.prototype, "CommentEnd", {
            get: function () {
                return this.commentEnd;
            },
            set: function (value) {
                this.commentEnd = value;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(CommentAdv.prototype, "Author", {
            get: function () {
                return this.author;
            },
            set: function (value) {
                this.author = value;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(CommentAdv.prototype, "Initial", {
            get: function () {
                return this.initial;
            },
            set: function (value) {
                this.initial = value;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(CommentAdv.prototype, "Date", {
            get: function () {
                return this.createdDate;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(CommentAdv.prototype, "Blocks", {
            get: function () {
                return this.blocks;
            },
            set: function (value) {
                this.blocks = value;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(CommentAdv.prototype, "LayoutedWidget", {
            get: function () {
                return this.layoutedWidget;
            },
            set: function (value) {
                this.layoutedWidget = value;
            },
            enumerable: true,
            configurable: true
        });
        CommentAdv.prototype._SerializeInline = function () {
            var Inline = {
                "Author": [], "CharacterFormat": [], "CommentId": [], "Date": [],
                "createdDate": [], "Initial": [], "Blocks": [],
                "CommentAdv": []
            };
            Inline.Author = this.Author;
            Inline.CharacterFormat = this.CharacterFormat._SerializeCharacterFormat();
            Inline.CommentId = this.CommentId;
            Inline.Date = this.Date;
            Inline.createdDate = this.createdDate;
            Inline.Initial = this.Initial;
            Inline.CommentAdv = true;
            for (var i = 0; i < this.Blocks.Count; i++) {
                var block = this.Blocks[i];
                if (block instanceof ParagraphAdv)
                    Inline.Blocks[i] = block._SerializeBlock();
                else if (block instanceof TableAdv)
                    Inline.Blocks[i] = block._SerializeBlock();
            }
            return Inline;
        };
        CommentAdv.prototype._Clone = function () {
            var comment = new CommentAdv(this, this.createdDate);
            comment.CharacterFormat._CopyFormat(this.CharacterFormat);
            for (var i = 0; i < this.Blocks.Count; i++) {
                comment.Blocks._Add(this.Blocks[i]._Clone());
            }
            return comment;
        };
        ;
        CommentAdv.prototype._LayoutCommentItems = function (viewer) {
            if (this.LayoutedWidget != null)
                this.LayoutedWidget._Dispose();
            var clientArea = viewer.ClientArea;
            var clientActiveArea = viewer.ClientActiveArea;
            var elements = null;
            if (viewer.LineElements.Count > 0) {
                elements = viewer.LineElements._ToList();
                viewer.LineElements._Clear();
            }
            viewer.CurrentComment = this;
            this._AddCommentWidget(viewer);
            viewer._UpdateCommentClientArea();
            this.LayoutedWidget.Width = viewer.ClientArea.Width;
            if (this.Blocks.Count == null)
                return;
            if (this.Blocks.Count == 0) {
                var paragraph = null;
                paragraph = new ParagraphAdv(this);
                this.Blocks._Add(paragraph);
            }
            for (var i = 0; i < this.Blocks.Count; i++) {
                var Blocks = this.Blocks[i];
                viewer._UpdateClientAreaForBlock(Blocks, true);
                Blocks._LayoutItems(viewer);
                viewer._UpdateClientAreaForBlock(Blocks, false);
            }
            viewer.CommentWidgets._Add(this.LayoutedWidget);
            viewer._ResetClientArea(clientArea, clientActiveArea);
            viewer.CurrentComment = null;
            if (elements != null && viewer.LineElements.Count == 0) {
                for (var i = 0; i < elements.Count; i++)
                    viewer.LineElements._Add(elements[i]);
            }
        };
        CommentAdv.prototype._AddCommentWidget = function (viewer) {
            var commentWidget = new CommentWidget(this);
            if (!viewer.isReviewPanelShow)
                commentWidget.X = viewer.CurrentRenderingPage.BoundingRectangle.Width;
            else
                commentWidget.X = viewer.CurrentRenderingPage.BoundingRectangle.Width - viewer.CurrentRenderingPage.ReviewPanelWidth;
            commentWidget.Y = viewer.ClientActiveArea.Y;
            this.LayoutedWidget = commentWidget;
        };
        CommentAdv.prototype._GetFirstParagraph = function () {
            if (this.Blocks == null || this.Blocks.Count == 0)
                this.Blocks._Add(new ParagraphAdv(this));
            if (this.Blocks[0] instanceof ParagraphAdv)
                return this.Blocks[0];
            else
                return this.Blocks[0]._GetNextParagraph();
        };
        CommentAdv.prototype._GetNextParagraph = function (block) {
            if (block.NextNode instanceof ParagraphAdv)
                return block.NextNode;
            else if (block.NextNode instanceof TableAdv)
                return block.NextNode._GetFirstParagraphInFirstCell();
            return null;
        };
        CommentAdv.prototype._GetPreviousParagraph = function (block) {
            if (block.PreviousNode instanceof ParagraphAdv)
                return block.PreviousNode;
            else if (block.PreviousNode instanceof TableAdv)
                return block.PreviousNode._GetFirstParagraphInFirstCell();
            return null;
        };
        CommentAdv.prototype._GetHierarchialIndex = function (block) {
            if (block != null && this.OwnerParagraph != null && this.OwnerParagraph.Owner instanceof CompositeNode) {
                var owner = this.OwnerParagraph.Owner;
                var startIndex = owner._GetHierarchicalIndex(owner.ChildNodes._IndexOf(this.OwnerParagraph).toString());
                return startIndex + ";" + this.OwnerParagraph._GetOffset(this, 0).toString() + ";C;" + this.Blocks._IndexOf(block).toString() + ";";
            }
            return "";
        };
        CommentAdv.prototype._Relayout = function () {
            var document = this._GetOwnerDocument();
            if (this.Elements != null && this.Elements.Count > 0 && document != null && document.OwnerControl != null && document.OwnerControl.IsDocumentLoaded && document.OwnerControl.IsLayoutEnabled
                && document.OwnerControl.Viewer != null && document.OwnerControl.Viewer instanceof PageLayoutViewer) {
                document.OwnerControl.IsLayoutEnabled = false;
                this._LayoutCommentItems(document.OwnerControl.Viewer);
                this._UpdateCommentWidgetToPage();
                document.OwnerControl.IsLayoutEnabled = true;
            }
        };
        CommentAdv.prototype._UpdateCommentWidgetToPage = function () {
            var currentPage = this.Elements[0].CurrentLineWidget.CurrentParagraphWidget._GetPage();
            this.LayoutedWidget.TopPosition = this.Elements[0].CurrentLineWidget._GetTop();
            this.LayoutedWidget.Page = currentPage;
            if (!currentPage.CommentWidgets._Contains(this.LayoutedWidget)) {
                currentPage.CommentWidgets._Add(this.LayoutedWidget);
                currentPage._AdjustCommentWidgets();
            }
            currentPage.Viewer.CommentWidgets._Remove(this.LayoutedWidget);
        };
        CommentAdv.prototype._SerializeComments = function () {
            var Comments = { "Author": [] };
            Comments.Author = this.Author;
            Comments.CharacterFormat = this.CharacterFormat._SerializeCharacterFormat();
            Comments.CmtID = this.CommentId;
            Comments.Date = this.Date;
            Comments.WordSplitCharacters = this.WordSplitCharacters;
            Comments.Initial = this.Initial;
            Comments.Blocks = {};
            for (var i = 0; i < this.Blocks.Count; i++) {
                var block = this.Blocks[i];
                if (block instanceof ParagraphAdv)
                    Comments.Blocks[i] = block._SerializeBlock();
                else if (block instanceof TableAdv)
                    Comments.Blocks[i] = block._SerializeBlock();
            }
            return Comments;
        };
        return CommentAdv;
    }(CommentCharacterAdv));
    DocumentEditorFeatures.CommentAdv = CommentAdv;
    var CommentStartAdv = (function (_super) {
        __extends(CommentStartAdv, _super);
        function CommentStartAdv(owner) {
            _super.call(this, owner);
        }
        Object.defineProperty(CommentStartAdv.prototype, "Comment", {
            get: function () {
                return this.comment;
            },
            set: function (value) {
                this.comment = value;
            },
            enumerable: true,
            configurable: true
        });
        CommentStartAdv.prototype._SerializeInline = function () {
            var inline = { "CharacterFormat": [], "CommentStartAdv": [], "CommentID": [] };
            inline.CharacterFormat = this.CharacterFormat._SerializeCharacterFormat();
            inline.CommentID = this.Comment.CommentId;
            inline.CommentStartAdv = true;
            return inline;
        };
        CommentStartAdv.prototype._Clone = function () {
            var commentRangeStart = new CommentStartAdv(this);
            commentRangeStart.CharacterFormat._CopyFormat(this.CharacterFormat);
            return commentRangeStart;
        };
        return CommentStartAdv;
    }(CommentCharacterAdv));
    DocumentEditorFeatures.CommentStartAdv = CommentStartAdv;
    var CommentEndAdv = (function (_super) {
        __extends(CommentEndAdv, _super);
        function CommentEndAdv(owner) {
            _super.call(this, owner);
        }
        Object.defineProperty(CommentEndAdv.prototype, "Comment", {
            get: function () {
                return this.comment;
            },
            set: function (value) {
                this.comment = value;
            },
            enumerable: true,
            configurable: true
        });
        CommentEndAdv.prototype._SerializeInline = function () {
            var inline = {
                "CharacterFormat": [], "CommentID": [], "CommentEndAdv": []
            };
            inline.CharacterFormat = this.CharacterFormat._SerializeCharacterFormat();
            inline.CommentID = this.Comment.CommentId;
            inline.CommentEndAdv = true;
            return inline;
        };
        CommentEndAdv.prototype._Clone = function () {
            var commentRangeEnd = new CommentEndAdv(this);
            commentRangeEnd.CharacterFormat._CopyFormat(this.CharacterFormat);
            return commentRangeEnd;
        };
        return CommentEndAdv;
    }(CommentCharacterAdv));
    DocumentEditorFeatures.CommentEndAdv = CommentEndAdv;
    var BaseHistoryInfo = (function () {
        function BaseHistoryInfo(node) {
            this.ownerControl = node;
            this.removedNodes = new List();
            this.modifiedProperties = new List();
            this.modifiedNodeLength = new List();
        }
        Object.defineProperty(BaseHistoryInfo.prototype, "OwnerControl", {
            get: function () { return this.ownerControl; },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(BaseHistoryInfo.prototype, "Action", {
            get: function () { return this.action; },
            set: function (value) { this.action = value; },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(BaseHistoryInfo.prototype, "RemovedNodes", {
            get: function () { return this.removedNodes; },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(BaseHistoryInfo.prototype, "ModifiedProperties", {
            get: function () { return this.modifiedProperties; },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(BaseHistoryInfo.prototype, "SelectionStart", {
            get: function () { return this.selectionStart; },
            set: function (value) { this.selectionStart = value; },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(BaseHistoryInfo.prototype, "SelectionEnd", {
            get: function () { return this.selectionEnd; },
            set: function (value) { this.selectionEnd = value; },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(BaseHistoryInfo.prototype, "InsertPosition", {
            get: function () { return this.insertPosition; },
            set: function (value) { this.insertPosition = value; },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(BaseHistoryInfo.prototype, "EndPosition", {
            get: function () { return this.endPosition; },
            set: function (value) { this.endPosition = value; },
            enumerable: true,
            configurable: true
        });
        BaseHistoryInfo.prototype._UpdateSelectionRange = function (selectionRange) {
            this.selectionStart = selectionRange.Start._GetHierarchicalIndexInternal();
            this.selectionEnd = selectionRange.End._GetHierarchicalIndexInternal();
        };
        BaseHistoryInfo.prototype._UpdateSelection = function (selection) {
            this.selectionStart = selection.Start._GetHierarchicalIndexInternal();
            this.selectionEnd = selection.End._GetHierarchicalIndexInternal();
        };
        BaseHistoryInfo.prototype._GetProperty = function () {
            switch (this.Action) {
                case Actions.Bold:
                    return CharacterFormat.BoldProperty;
                case Actions.Italic:
                    return CharacterFormat.ItalicProperty;
                case Actions.FontColor:
                    return CharacterFormat.FontColorProperty;
                case Actions.FontFamily:
                    return CharacterFormat.FontFamilyProperty;
                case Actions.FontSize:
                    return CharacterFormat.FontSizeProperty;
                case Actions.HighlightColor:
                    return CharacterFormat.HighlightColorProperty;
                case Actions.BaselineAlignment:
                    return CharacterFormat.BaselineAlignmentProperty;
                case Actions.StrikeThrough:
                    return CharacterFormat.StrikeThroughProperty;
                case Actions.Underline:
                    return CharacterFormat.UnderlineProperty;
                case Actions.AfterSpacing:
                    return ParagraphFormat.AfterSpacingProperty;
                case Actions.BeforeSpacing:
                    return ParagraphFormat.BeforeSpacingProperty;
                case Actions.LeftIndent:
                    return ParagraphFormat.LeftIndentProperty;
                case Actions.RightIndent:
                    return ParagraphFormat.RightIndentProperty;
                case Actions.FirstLineIndent:
                    return ParagraphFormat.FirstLineIndentProperty;
                case Actions.LineSpacingType:
                    return ParagraphFormat.LineSpacingTypeProperty;
                case Actions.LineSpacing:
                    return ParagraphFormat.LineSpacingProperty;
                case Actions.TextAlignment:
                    return ParagraphFormat.TextAlignmentProperty;
                case Actions.ListFormat:
                    return ParagraphFormat.ListFormatProperty;
                case Actions.PageSize:
                    return "PageSizeProperty";
                case Actions.PageMargin:
                    return "PageMarginProperty";
            }
            return null;
        };
        BaseHistoryInfo.prototype._InsertClonedFieldResult = function (fieldSeparator) {
            var isStarted = false;
            for (var i = 0; i < this.RemovedNodes.Count; i++) {
                var node = this.RemovedNodes[i];
                if (!isStarted) {
                    if (fieldSeparator == node)
                        isStarted = true;
                    else {
                        if (node instanceof ParagraphAdv && node == fieldSeparator.OwnerParagraph) {
                            isStarted = true;
                            var paragraph = null;
                            if (i == 0) {
                                paragraph = this.OwnerControl.Selection.Start.Paragraph;
                                fieldSeparator.OwnerParagraph._GetClonedFieldResultWithSel(this.OwnerControl.Selection, fieldSeparator);
                            }
                            else {
                                paragraph = fieldSeparator.OwnerParagraph._GetClonedFieldResult(fieldSeparator);
                                this.OwnerControl.Selection.Start.Paragraph._InsertParagraph(paragraph, this.OwnerControl.Selection.Start.Offset, true);
                            }
                            this.OwnerControl.Selection._SelectParagraph(paragraph._GetNextParagraph(), true, true);
                        }
                        continue;
                    }
                }
                if (node instanceof Inline)
                    this.OwnerControl.Selection._InsertInlineInternal(node._Clone());
                else if (node instanceof BlockAdv)
                    this.OwnerControl.Selection._InsertBlockInternal(node._Clone());
                else if (node instanceof SectionAdv)
                    this.OwnerControl.Selection._InsertSection(node._Clone());
            }
        };
        BaseHistoryInfo.prototype._RevertProperties = function (selectionRange) {
            this.OwnerControl.Selection.CurrentBaseHistoryInfo = this;
            this.currentPropertyIndex = 0;
            var property = this._GetProperty();
            if (this.modifiedProperties[0] instanceof CharacterFormat)
                this.OwnerControl.Selection._UpdateCharacterFormatForSelRange(selectionRange, property, null);
            else if (this.modifiedProperties[0] instanceof ParagraphFormat)
                this.OwnerControl.Selection._UpdateParagraphFormats(selectionRange, property, null);
            else if (this.modifiedProperties[0] instanceof ImageFormat)
                this.OwnerControl.Selection._UpdateImageSize(this.modifiedProperties[0]);
            else if (this.modifiedProperties[0] instanceof SectionFormat)
                this.OwnerControl.Selection._UpdateSectionFormat(property, null);
            else if (this.modifiedProperties[0] instanceof ModifiedLevel) {
                var modified = new ModifiedLevelCollection();
                for (var i = 0; i < this.modifiedProperties.Count; i++) {
                    var modifiedLevel = this.modifiedProperties[i];
                    modified.ModifiedLevels._Add(modifiedLevel.OwnerListLevel.LevelNumber, modifiedLevel);
                }
                this.OwnerControl.Selection._UpdateListChanges(modified);
                modified._Dispose();
                modified = null;
            }
            else if (this.modifiedProperties[0] instanceof TableFormat)
                this.OwnerControl.Selection._UpdateTableFormat(selectionRange, property, null);
            else if (this.modifiedProperties[0] instanceof CellFormat)
                this.OwnerControl.Selection._UpdateCellFormat(selectionRange, property, null);
            else if (this.modifiedProperties[0] instanceof RowFormat)
                this.OwnerControl.Selection._UpdateRowFormat(selectionRange, property, null);
            this.currentPropertyIndex = 0;
        };
        BaseHistoryInfo.prototype._Revert = function () {
            this.OwnerControl.IsShiftingEnabled = true;
            var selectionStartTextPosition = null, selectionEndTextPosition = null;
            var start = this.selectionStart, end = this.selectionEnd;
            var isForwardSelection = TextPosition._IsForwardSelection(start, end);
            if (this.ModifiedProperties.Count > 0 || this.Action == Actions.Selection) {
                selectionStartTextPosition = this._GetTextPosition(start);
                selectionEndTextPosition = this._GetTextPosition(end);
                this.ownerControl.Selection._SelectRange(selectionStartTextPosition, selectionEndTextPosition, true);
                if (this.Action == Actions.RowResizing || this.Action == Actions.CellResizing)
                    this._RevertResizing();
                else if (this.Action != Actions.Selection)
                    this._RevertProperties(this.OwnerControl.Selection.CurrentSelectionRange);
            }
            else {
                var deletedNodes = this.RemovedNodes;
                this.removedNodes = new List();
                var isForward = TextPosition._IsForwardSelection(this.InsertPosition, this.EndPosition);
                var insertTextPosition = this._GetTextPosition(isForward ? this.InsertPosition : this.EndPosition);
                var endTextPosition = this._GetTextPosition(isForward ? this.EndPosition : this.InsertPosition);
                if (insertTextPosition._IsAtSamePosition(endTextPosition))
                    this.OwnerControl.Selection._SelectContent(insertTextPosition, true);
                else
                    this.OwnerControl.Selection._SelectPosition(insertTextPosition, endTextPosition);
                if (this.Action == Actions.InsertHyperlink && this.OwnerControl.History.IsRedoing) {
                    var fieldBegin = this.OwnerControl.Selection._GetHyperlinkField();
                    if (fieldBegin != null) {
                        var offset = fieldBegin.OwnerParagraph._GetOffset(fieldBegin, 0);
                        insertTextPosition._SetPositionParagraph(fieldBegin.OwnerParagraph, offset);
                        this.OwnerControl.Selection.Start._SetPositionInternal(insertTextPosition);
                        offset = fieldBegin.fieldEnd.OwnerParagraph._GetOffset(fieldBegin.fieldEnd, 1);
                        endTextPosition._SetPositionParagraph(fieldBegin.fieldEnd.OwnerParagraph, offset);
                    }
                }
                this.OwnerControl.Selection.CurrentBaseHistoryInfo = this;
                this.selectionStart = this.InsertPosition;
                this.InsertPosition = null;
                this.selectionEnd = this.EndPosition;
                this.EndPosition = null;
                var isRemoveContent = false;
                if (!insertTextPosition._IsAtSamePosition(endTextPosition)) {
                    if (!(isRemoveContent = (this.Action == Actions.BackSpace || this.Action == Actions.Delete || this.Action == Actions.ClearCells
                        || this.Action == Actions.DeleteCells)) && this.Action != Actions.InsertRowAbove && this.Action != Actions.InsertRowBelow
                        && this.Action != Actions.InsertColumnLeft && this.Action != Actions.InsertColumnRight) {
                        this.OwnerControl.Selection.End._SetPositionInternal(endTextPosition);
                        if (!this.OwnerControl.Selection.IsEmpty) {
                            if (this.OwnerControl.History.IsRedoing)
                                this.OwnerControl.Selection._RemoveSelectedContent();
                            else
                                this.OwnerControl.Selection._DeleteSelectedContents(true);
                        }
                    }
                }
                var isRedoAction = this.OwnerControl.History.IsRedoing && !isRemoveContent;
                this._RevertModifiedNodes(deletedNodes, isRedoAction, isForwardSelection ? start : end, start == end);
                if (isRemoveContent) {
                    this.OwnerControl.Selection._SelectRange(insertTextPosition, endTextPosition, true);
                    var isDelete = (this.Action == Actions.DeleteCells || this.Action == Actions.BackSpace) ? true : false;
                    this.OwnerControl.Selection._DeleteSelectedContents(isDelete);
                }
            }
            var isSelectionChanged = false;
            if (this.OwnerControl.History.IsUndoing && this.ownerControl.Selection.CurrentHistoryInfo == null) {
                selectionStartTextPosition = this._GetTextPosition(start);
                selectionEndTextPosition = this._GetTextPosition(end);
                this.OwnerControl.Selection._SelectRange(selectionStartTextPosition, selectionEndTextPosition, true);
                isSelectionChanged = true;
            }
            this.InsertPosition = start;
            this.EndPosition = end;
            this.OwnerControl.Selection._Relayout(this.OwnerControl.Selection.IsEmpty);
            if (isSelectionChanged)
                this.OwnerControl.Viewer._ScrollToPosition(this.OwnerControl.Selection.Start, this.OwnerControl.Selection.End);
        };
        BaseHistoryInfo.prototype._RevertResizing = function () {
            this.OwnerControl.Selection.CurrentBaseHistoryInfo = this;
            if (this.Action == Actions.RowResizing) {
                if (this.ModifiedProperties[0] instanceof RowHistoryFormat)
                    this.ModifiedProperties[0]._RevertChanges(this.OwnerControl.History.IsRedoing);
            }
            else {
                if (this.ModifiedProperties[0] instanceof CellHistoryFormat) {
                    if (this.OwnerControl.Selection.SelectionRanges.Last.SelectedWidgets.Count == 0)
                        this.OwnerControl.Selection._HighlightSelection(true);
                    var cellHistroy = this.ModifiedProperties[0];
                    var position = cellHistroy.TableHierarchicalIndex;
                    var blockObj = this.OwnerControl.Document._GetBlock(position);
                    var block = blockObj.node;
                    if (block instanceof TableAdv) {
                        this.OwnerControl.CurrentResizingTable = block;
                        if (this.OwnerControl.History.IsUndoing) {
                            this.OwnerControl.StartingPoint = this._GetStartingPoint(cellHistroy.startX + cellHistroy.displacment, cellHistroy.startY);
                            this.OwnerControl.ResizerPosition = cellHistroy.EndIndex;
                            this.OwnerControl.Viewer._ResizeTableCell(-cellHistroy.displacment);
                        }
                        else {
                            this.OwnerControl.StartingPoint = this._GetStartingPoint(cellHistroy.startX, cellHistroy.startY);
                            this.OwnerControl.ResizerPosition = cellHistroy.StartIndex;
                            this.OwnerControl.Viewer._ResizeTableCell(cellHistroy.displacment);
                        }
                    }
                }
            }
        };
        BaseHistoryInfo.prototype._GetStartingPoint = function (pointX, pointY) {
            var mousePoint = new Point(0, 0);
            mousePoint.X = this.OwnerControl.CurrentResizingTable.TableWidgets[this.OwnerControl.CurrentResizingTable.TableWidgets.Count - 1].X + pointX;
            mousePoint.Y = this.OwnerControl.CurrentResizingTable.TableWidgets[this.OwnerControl.CurrentResizingTable.TableWidgets.Count - 1].Y + pointY;
            return mousePoint;
        };
        BaseHistoryInfo.prototype._RevertModifiedNodes = function (deletedNodes, isRedoAction, start, isEmptySelection) {
            if (isRedoAction && (this.Action == Actions.BackSpace || this.Action == Actions.Delete || this.Action == Actions.DeleteColumn || this.Action == Actions.DeleteRow || this.Action == Actions.InsertRowAbove
                || this.Action == Actions.InsertRowBelow || this.Action == Actions.InsertColumnLeft || this.Action == Actions.InsertColumnRight
                || this.Action == Actions.DeleteTable))
                this._RedoAction();
            if (deletedNodes.Count > 0) {
                if (this.OwnerControl.History.IsUndoing && (this.Action == Actions.DeleteColumn || this.Action == Actions.DeleteRow
                    || this.Action == Actions.InsertRowAbove || this.Action == Actions.InsertRowBelow || this.Action == Actions.InsertColumnLeft
                    || this.Action == Actions.InsertColumnRight || this.Action == Actions.DeleteCells || this.Action == Actions.ClearCells)) {
                    var insertIndex = this.selectionStart;
                    var blockObj = this.OwnerControl.Document._GetBlock(insertIndex);
                    var block = blockObj.node;
                    insertIndex = blockObj.position;
                    var firstNode = deletedNodes[0];
                    if (block instanceof TableAdv && firstNode instanceof TableAdv) {
                        block._InsertTable(firstNode, false);
                        deletedNodes._Remove(firstNode);
                    }
                }
                else {
                    var initialStart = start;
                    var blockObj = this.OwnerControl.Document._GetBlock(initialStart);
                    var block = blockObj.node;
                    initialStart = blockObj.position;
                    if (deletedNodes.Count > 0 && (this.Action == Actions.BackSpace && isEmptySelection || !(block instanceof TableAdv))) {
                        var lastNode = deletedNodes[deletedNodes.Count - 1];
                        if (lastNode instanceof ParagraphAdv && this.OwnerControl.Selection.Start.Offset > 0) {
                            this.OwnerControl.Selection._InsertParagraph(lastNode, true);
                            deletedNodes._Remove(lastNode);
                            if (block == null) {
                                var nextBlock = lastNode._GetNextRenderedBlock();
                                if (nextBlock == null)
                                    this.OwnerControl.Selection._SelectParagraph(lastNode, true, true);
                            }
                        }
                    }
                    if (deletedNodes.Count > 0) {
                        var firstNode = deletedNodes[0];
                        if (block instanceof TableAdv) {
                            if (firstNode instanceof TableAdv) {
                                block._InsertTable(firstNode, true);
                                deletedNodes._Remove(firstNode);
                                this.InsertPosition = start;
                                if (firstNode.NextNode instanceof TableAdv)
                                    block = firstNode.NextNode;
                                else {
                                    initialStart = start;
                                    var blockObj = this.OwnerControl.Document._GetBlock(initialStart);
                                    var block_2 = blockObj.node;
                                    initialStart = blockObj.position;
                                }
                            }
                        }
                        else if (firstNode instanceof ParagraphAdv && this.OwnerControl.Selection.Start.Offset > 0
                            && this.OwnerControl.Selection.Start.Offset == this.OwnerControl.Selection.Start.Paragraph._GetLength()) {
                            this.OwnerControl.Selection._InsertParagraph(firstNode, false);
                            deletedNodes._Remove(firstNode);
                            if (this.Action != Actions.Paste)
                                this.OwnerControl.Selection.Start.Paragraph._RemoveBlock();
                            var paragraph = firstNode._GetNextParagraph();
                            this.OwnerControl.Selection._SelectParagraph(paragraph, true, true);
                        }
                    }
                    if (deletedNodes.Count > 0)
                        this._InsertRemovedNodes(deletedNodes, block);
                }
            }
        };
        BaseHistoryInfo.prototype._InsertRemovedNodes = function (deletedNodes, block) {
            for (var i = 0, j = 0; i < deletedNodes.Count; i++) {
                var node = deletedNodes[i];
                deletedNodes._Remove(node);
                i--;
                if (node instanceof Inline)
                    this.OwnerControl.Selection._InsertInline(node);
                else if (node instanceof BlockAdv) {
                    if (block instanceof TableAdv)
                        this.OwnerControl.Selection._InsertBlockTable(node, block);
                    else {
                        this.OwnerControl.Selection._InsertBlock(node);
                        if (this.Action == Actions.InsertTable && node instanceof TableAdv && deletedNodes.Count == 0) {
                            var paragraph = node._GetFirstParagraphInFirstCell();
                            this.OwnerControl.Selection._SelectParagraph(paragraph, true, true);
                        }
                    }
                }
                else if (node instanceof TableRowAdv) {
                    if (block instanceof TableAdv) {
                        block.Rows._Insert(j, node);
                        j++;
                    }
                    else {
                    }
                }
                else if (node instanceof SectionAdv) {
                    if (block instanceof TableAdv)
                        this.OwnerControl.Selection._InsertSectionInternal(node, block);
                    else
                        this.OwnerControl.Selection._InsertSection(node);
                }
            }
        };
        BaseHistoryInfo.prototype._RedoAction = function () {
            switch (this.Action) {
                case Actions.BackSpace:
                    this.OwnerControl.Selection._SingleBackspace(true);
                    break;
                case Actions.Delete:
                    this.OwnerControl.Selection._SingleDelete(true);
                    break;
                case Actions.InsertRowAbove:
                    this.OwnerControl.Selection._InsertRow(RowPlacement.Above);
                    break;
                case Actions.InsertRowBelow:
                    this.OwnerControl.Selection._InsertRow(RowPlacement.Below);
                    break;
                case Actions.InsertColumnLeft:
                    this.OwnerControl.Selection._InsertColumn(ColumnPlacement.Left);
                    break;
                case Actions.InsertColumnRight:
                    this.OwnerControl.Selection._InsertColumn(ColumnPlacement.Right);
                    break;
                case Actions.DeleteColumn:
                    this.OwnerControl.Selection._DeleteColumn();
                    break;
                case Actions.DeleteRow:
                    this.OwnerControl.Selection._DeleteRow();
                    break;
                case Actions.DeleteTable:
                    this.OwnerControl.Selection._DeleteTable();
                    break;
            }
        };
        BaseHistoryInfo.prototype._GetTextPosition = function (hierarchicalIndex) {
            var textPosition = new TextPosition(this.OwnerControl);
            textPosition._SetPositionForCurrentIndex(hierarchicalIndex);
            return textPosition;
        };
        BaseHistoryInfo.prototype._AddModifiedProperties = function (format, property, value) {
            if (this.OwnerControl.History.IsUndoing || this.OwnerControl.History.IsRedoing) {
                var previousFormat = (this.currentPropertyIndex < this.modifiedProperties.Count ? this.modifiedProperties[this.currentPropertyIndex] : this.modifiedProperties[this.modifiedProperties.Count - 1]);
                if (format.OwnerBase instanceof Inline) {
                    var prevLength = this.modifiedNodeLength[this.currentPropertyIndex];
                    if (format.OwnerBase.Length < prevLength) {
                        this.modifiedNodeLength[this.currentPropertyIndex] = format.OwnerBase.Length;
                        this.modifiedNodeLength._Insert(this.currentPropertyIndex + 1, prevLength - format.OwnerBase.Length);
                        var nextFormat = new CharacterFormat(null);
                        nextFormat._CopyFormat(previousFormat);
                        this.modifiedProperties._Insert(this.currentPropertyIndex + 1, nextFormat);
                    }
                }
                if (property == null) {
                    value = previousFormat;
                    if (this.currentPropertyIndex < this.modifiedProperties.Count)
                        this.modifiedProperties[this.currentPropertyIndex] = format._CloneFormat();
                    else
                        this.modifiedProperties[this.modifiedProperties.Count - 1] = format._CloneFormat();
                }
                else {
                    value = previousFormat._GetCharacterPropertyValue(property, previousFormat);
                    previousFormat._CopyFormat(format);
                }
                this.currentPropertyIndex++;
            }
            else {
                if (property == null)
                    this.ModifiedProperties._Add(format._CloneFormat());
                else {
                    var currentFormat = new CharacterFormat(null);
                    currentFormat._CopyFormat(format);
                    this.ModifiedProperties._Add(currentFormat);
                }
                if (format.OwnerBase instanceof Inline)
                    this.modifiedNodeLength._Add(format.OwnerBase.Length);
                else
                    this.modifiedNodeLength._Add(0);
            }
            return value;
        };
        BaseHistoryInfo.prototype._AddModifiedPropertiesForParagraphFormat = function (format, property, value) {
            if (this.OwnerControl.History.IsUndoing || this.OwnerControl.History.IsRedoing) {
                var previousFormat = (this.currentPropertyIndex < this.modifiedProperties.Count ? this.modifiedProperties[this.currentPropertyIndex] : this.modifiedProperties[this.modifiedProperties.Count - 1]);
                if (property == null) {
                    value = previousFormat;
                    if (this.currentPropertyIndex < this.modifiedProperties.Count)
                        this.modifiedProperties[this.currentPropertyIndex] = format._CloneFormat();
                    else
                        this.modifiedProperties[this.modifiedProperties.Count - 1] = format._CloneFormat();
                    this.currentPropertyIndex++;
                    return value;
                }
                if (property == ParagraphFormat.ListFormatProperty) {
                    value = new ParagraphFormat(null);
                    value._CopyFormat(previousFormat);
                    previousFormat.ListFormat = new ListFormat(null);
                    previousFormat.ListFormat._CopyFormat(format.ListFormat);
                    this.currentPropertyIndex++;
                    return value;
                }
                value = previousFormat._GetParagraphPropertyValue(property, previousFormat);
                previousFormat._CopyFormat(format);
                this.currentPropertyIndex++;
            }
            else {
                if (property == null)
                    this.ModifiedProperties._Add(format._CloneFormat());
                else {
                    var currentFormat = new ParagraphFormat(null);
                    currentFormat._CopyFormat(format);
                    this.ModifiedProperties._Add(currentFormat);
                }
            }
            return value;
        };
        BaseHistoryInfo.prototype._AddModifiedPropertiesForSectionFormat = function (format, property, value) {
            if (this.OwnerControl.History.IsUndoing || this.OwnerControl.History.IsRedoing) {
                var previousFormat = (this.currentPropertyIndex < this.modifiedProperties.Count ? this.modifiedProperties[this.currentPropertyIndex] : this.modifiedProperties[this.modifiedProperties.Count - 1]);
                value = previousFormat._GetSectionPropertyValue(property, previousFormat);
                previousFormat._CopyFormat(format);
                this.currentPropertyIndex++;
            }
            else {
                var currentFormat = new SectionFormat(null);
                currentFormat._CopyFormat(format);
                this.ModifiedProperties._Add(currentFormat);
            }
            return value;
        };
        BaseHistoryInfo.prototype._AddModifiedPropertiesForTableFormat = function (format, property, value) {
            if (this.OwnerControl.History.IsUndoing || this.OwnerControl.History.IsRedoing) {
                var previousFormat = (this.currentPropertyIndex < this.modifiedProperties.Count ? this.modifiedProperties[this.currentPropertyIndex] : this.modifiedProperties[this.modifiedProperties.Count - 1]);
                if (property == null) {
                    value = previousFormat;
                    if (this.currentPropertyIndex < this.modifiedProperties.Count)
                        this.modifiedProperties[this.currentPropertyIndex] = format._CloneFormat();
                    else
                        this.modifiedProperties[this.modifiedProperties.Count - 1] = format._CloneFormat();
                    this.currentPropertyIndex++;
                    return value;
                }
                value = previousFormat._HasValue(property);
                previousFormat._ClearValue(property);
                previousFormat._CopyFormat(format);
                this.currentPropertyIndex++;
            }
            else {
                var currentFormat = new TableFormat(null);
                currentFormat._CopyFormat(format);
                this.ModifiedProperties._Add(currentFormat);
            }
            return value;
        };
        BaseHistoryInfo.prototype._AddModifiedPropertiesForCellFormat = function (format, property, value) {
            if (this.OwnerControl.History.IsUndoing || this.OwnerControl.History.IsRedoing) {
                var previousFormat = (this.currentPropertyIndex < this.modifiedProperties.Count ? this.modifiedProperties[this.currentPropertyIndex] : this.modifiedProperties[this.modifiedProperties.Count - 1]);
                if (property == null) {
                    value = previousFormat;
                    if (this.currentPropertyIndex < this.modifiedProperties.Count)
                        this.modifiedProperties[this.currentPropertyIndex] = format._CloneFormat();
                    else
                        this.modifiedProperties[this.modifiedProperties.Count - 1] = format._CloneFormat();
                    this.currentPropertyIndex++;
                    return value;
                }
                value = previousFormat._HasValue(property);
                previousFormat._ClearValue(property);
                previousFormat._CopyFormat(format);
                this.currentPropertyIndex++;
            }
            else {
                var currentFormat = new CellFormat(null);
                currentFormat._CopyFormat(format);
                this.ModifiedProperties._Add(currentFormat);
            }
            return value;
        };
        BaseHistoryInfo.prototype._AddModifiedPropertiesForRowFormat = function (format, property, value) {
            if (this.OwnerControl.History.IsUndoing || this.OwnerControl.History.IsRedoing) {
                var previousFormat = (this.currentPropertyIndex < this.modifiedProperties.Count ? this.modifiedProperties[this.currentPropertyIndex] : this.modifiedProperties[this.modifiedProperties.Count - 1]);
                if (property == null) {
                    value = previousFormat;
                    if (this.currentPropertyIndex < this.modifiedProperties.Count)
                        this.modifiedProperties[this.currentPropertyIndex] = format._CloneFormat();
                    else
                        this.modifiedProperties[this.modifiedProperties.Count - 1] = format._CloneFormat();
                    this.currentPropertyIndex++;
                    return value;
                }
                value = previousFormat._HasValue(property);
                previousFormat._ClearValue(property);
                previousFormat._CopyFormat(format);
                this.currentPropertyIndex++;
            }
            else {
                var currentFormat = new RowFormat(null);
                currentFormat._CopyFormat(format);
                this.ModifiedProperties._Add(currentFormat);
            }
            return value;
        };
        BaseHistoryInfo.prototype._AddModifiedPropertiesForList = function (listLevel) {
            var value;
            if (this.OwnerControl.History.IsUndoing || this.OwnerControl.History.IsRedoing) {
                var previousLevel = (this.currentPropertyIndex < this.modifiedProperties.Count ? this.modifiedProperties[this.currentPropertyIndex] : this.modifiedProperties[this.modifiedProperties.Count - 1]);
                value = previousLevel;
                previousLevel = new ModifiedLevel(listLevel, listLevel._Clone());
                if (this.currentPropertyIndex < this.modifiedProperties.Count)
                    this.modifiedProperties[this.currentPropertyIndex] = previousLevel;
                else
                    this.modifiedProperties[this.modifiedProperties.Count - 1] = previousLevel;
                this.currentPropertyIndex++;
            }
            else {
                this.ModifiedProperties._Add(new ModifiedLevel(listLevel, listLevel._Clone()));
                value = listLevel;
            }
            return value;
        };
        BaseHistoryInfo.prototype._Dispose = function () {
            this.selectionStart = null;
            this.selectionEnd = null;
            this.insertPosition = null;
            this.endPosition = null;
            if (this.modifiedNodeLength != null) {
                this.modifiedNodeLength._Clear();
                this.modifiedNodeLength = null;
            }
            if (this.modifiedProperties != null) {
                for (var i = 0; i < this.modifiedProperties.Count; i++) {
                    var obj = this.modifiedProperties[i];
                    if (obj instanceof CharacterFormat)
                        obj._Dispose();
                    else if (obj instanceof ParagraphFormat)
                        obj._Dispose();
                    else if (obj instanceof SectionFormat)
                        obj._Dispose();
                    this.modifiedProperties._Remove(obj);
                    i--;
                }
                this.modifiedProperties = null;
            }
            if (this.removedNodes != null) {
                for (var i = 0; i < this.removedNodes.Count; i++) {
                    var node = this.removedNodes[i];
                    if (node instanceof SectionAdv)
                        node._Dispose();
                    else if (node instanceof BlockAdv)
                        node._Dispose();
                    else if (node instanceof TableRowAdv)
                        node._Dispose();
                    else if (node instanceof TableCellAdv)
                        node._Dispose();
                    else if (node instanceof Inline)
                        node._Dispose();
                    this.removedNodes._Remove(node);
                    i--;
                }
                this.removedNodes = null;
            }
            this.ownerControl = null;
        };
        return BaseHistoryInfo;
    }());
    DocumentEditorFeatures.BaseHistoryInfo = BaseHistoryInfo;
    var HistoryInfo = (function (_super) {
        __extends(HistoryInfo, _super);
        function HistoryInfo(node, isChild) {
            _super.call(this, node);
            this.isChildHistoryInfo = false;
            this.isChildHistoryInfo = isChild;
        }
        Object.defineProperty(HistoryInfo.prototype, "HasAction", {
            get: function () {
                return this.ModifiedActions != null;
            },
            enumerable: true,
            configurable: true
        });
        HistoryInfo.prototype._AddModifiedAction = function (baseHistoryInfo) {
            if (!(this.OwnerControl.History.IsUndoing || this.OwnerControl.History.IsRedoing)) {
                if (this.ModifiedActions == null)
                    this.ModifiedActions = new List();
                this.ModifiedActions._Add(baseHistoryInfo);
            }
        };
        HistoryInfo.prototype._Revert = function () {
            this.OwnerControl.Selection.CurrentHistoryInfo = this;
            if (this.ModifiedActions != null) {
                if (this.Action == Actions.ReplaceAll || this.Action == Actions.ChangeAll)
                    this.OwnerControl.IsLayoutEnabled = false;
                if (this.OwnerControl.History.IsUndoing) {
                    var i = this.ModifiedActions.Count;
                    while (i > 0) {
                        var baseHistoryInfo = this.ModifiedActions[i - 1];
                        baseHistoryInfo._Revert();
                        i = i - 1;
                        if (this.OwnerControl.Selection.CurrentHistoryInfo != this)
                            this.OwnerControl.Selection.CurrentHistoryInfo = this;
                    }
                }
                else {
                    var i = 0;
                    while (i < this.ModifiedActions.Count) {
                        var baseHistoryInfo = this.ModifiedActions[i];
                        baseHistoryInfo._Revert();
                        i = i + 1;
                        if (this.OwnerControl.Selection.CurrentHistoryInfo != this)
                            this.OwnerControl.Selection.CurrentHistoryInfo = this;
                    }
                }
            }
            if (!this.isChildHistoryInfo)
                this.OwnerControl.Selection._UpdateComplexHistory();
        };
        return HistoryInfo;
    }(BaseHistoryInfo));
    DocumentEditorFeatures.HistoryInfo = HistoryInfo;
    var ModifiedParagraphFormatCollection = (function () {
        function ModifiedParagraphFormatCollection() {
            this.modifiedFormats = new List();
        }
        Object.defineProperty(ModifiedParagraphFormatCollection.prototype, "ModifiedFormats", {
            get: function () {
                return this.modifiedFormats;
            },
            enumerable: true,
            configurable: true
        });
        ModifiedParagraphFormatCollection.prototype._Dispose = function () {
            for (var i = 0; i < this.modifiedFormats.Count; i++)
                this.ModifiedFormats[i]._Dispose();
            this.ModifiedFormats._Clear();
        };
        return ModifiedParagraphFormatCollection;
    }());
    DocumentEditorFeatures.ModifiedParagraphFormatCollection = ModifiedParagraphFormatCollection;
    var ModifiedParagraphFormat = (function () {
        function ModifiedParagraphFormat(ownerFormat, modifiedFormat) {
            this.OwnerFormat = ownerFormat;
            this.ModifiedFormat = modifiedFormat;
        }
        Object.defineProperty(ModifiedParagraphFormat.prototype, "OwnerFormat", {
            get: function () {
                return this.ownerFormat;
            },
            set: function (value) {
                this.ownerFormat = value;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(ModifiedParagraphFormat.prototype, "ModifiedFormat", {
            get: function () {
                return this.modifiedFormat;
            },
            set: function (value) {
                this.modifiedFormat = value;
            },
            enumerable: true,
            configurable: true
        });
        ModifiedParagraphFormat.prototype._Dispose = function () {
            this.OwnerFormat = null;
            this.ModifiedFormat._Dispose();
            this.ModifiedFormat = null;
        };
        return ModifiedParagraphFormat;
    }());
    DocumentEditorFeatures.ModifiedParagraphFormat = ModifiedParagraphFormat;
    var ModifiedLevelCollection = (function () {
        function ModifiedLevelCollection() {
            this.modifiedLevels = new Dictionary();
        }
        Object.defineProperty(ModifiedLevelCollection.prototype, "ModifiedLevels", {
            get: function () {
                return this.modifiedLevels;
            },
            enumerable: true,
            configurable: true
        });
        ModifiedLevelCollection.prototype._Dispose = function () {
            for (var i = 0; i < this.ModifiedLevels.Keys.Count; i++) {
                var levelNumber = this.ModifiedLevels.Keys[i];
                this.ModifiedLevels._Get(levelNumber)._Dispose();
            }
            this.ModifiedLevels._Clear();
        };
        return ModifiedLevelCollection;
    }());
    DocumentEditorFeatures.ModifiedLevelCollection = ModifiedLevelCollection;
    var ModifiedLevel = (function () {
        function ModifiedLevel(owner, modified) {
            this.OwnerListLevel = owner;
            this.ModifiedListLevel = modified;
        }
        Object.defineProperty(ModifiedLevel.prototype, "OwnerListLevel", {
            get: function () {
                return this.ownerListLevel;
            },
            set: function (value) {
                this.ownerListLevel = value;
            },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(ModifiedLevel.prototype, "ModifiedListLevel", {
            get: function () {
                return this.modifiedListLevel;
            },
            set: function (value) {
                this.modifiedListLevel = value;
            },
            enumerable: true,
            configurable: true
        });
        ModifiedLevel.prototype._Dispose = function () {
            this.OwnerListLevel = null;
            this.ModifiedListLevel._Dispose();
            this.ModifiedListLevel = null;
        };
        return ModifiedLevel;
    }());
    DocumentEditorFeatures.ModifiedLevel = ModifiedLevel;
    var CellHistoryFormat = (function () {
        function CellHistoryFormat(point) {
            this.StartingPoint = point;
        }
        return CellHistoryFormat;
    }());
    DocumentEditorFeatures.CellHistoryFormat = CellHistoryFormat;
    var RowHistoryFormat = (function () {
        function RowHistoryFormat(startingPoint, rowFormat) {
            this.StartingPoint = startingPoint;
            this.RowFormat = rowFormat;
            this.RowHeightType = rowFormat.HeightType;
        }
        RowHistoryFormat.prototype._RevertChanges = function (isRedo) {
            var currentRowHeightType = this.RowFormat.HeightType;
            if (isRedo) {
                if (this.RowFormat.OwnerBase instanceof TableRowAdv)
                    this.RowFormat.OwnerBase._UpdateHeight(this.Displacement);
            }
            else {
                if (this.RowFormat.OwnerBase instanceof TableRowAdv)
                    this.RowFormat.OwnerBase._UpdateHeight(-this.Displacement);
            }
            if (this.RowFormat.HeightType != this.RowHeightType)
                this.RowFormat.HeightType = this.RowHeightType;
            this.RowHeightType = currentRowHeightType;
        };
        return RowHistoryFormat;
    }());
    DocumentEditorFeatures.RowHistoryFormat = RowHistoryFormat;
    var History = (function () {
        function History(node) {
            this.IsUndoing = false;
            this.IsRedoing = false;
            this.ownerControl = node;
        }
        Object.defineProperty(History.prototype, "OwnerControl", {
            get: function () { return this.ownerControl; },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(History.prototype, "UndoStack", {
            get: function () { return this.undoStack; },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(History.prototype, "RedoStack", {
            get: function () { return this.redoStack; },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(History.prototype, "CanUndo", {
            get: function () { return this.undoStack != null && this.undoStack.Count > 0; },
            enumerable: true,
            configurable: true
        });
        Object.defineProperty(History.prototype, "CanRedo", {
            get: function () { return this.redoStack != null && this.redoStack.Count > 0; },
            enumerable: true,
            configurable: true
        });
        History.prototype._RecordChanges = function (baseHistoryInfo) {
            if (this.OwnerControl.DisableHistory)
                return;
            if (this.IsUndoing) {
                if (this.redoStack == null)
                    this.redoStack = new Stack(this.OwnerControl.StackSize);
                this.redoStack._Push(baseHistoryInfo);
            }
            else {
                if (!this.IsRedoing && this.CanRedo)
                    this.redoStack._Clear();
                if (this.undoStack == null)
                    this.undoStack = new Stack(this.OwnerControl.StackSize);
                this.undoStack._Push(baseHistoryInfo);
            }
        };
        History.prototype._Undo = function () {
            if (this.OwnerControl.IsReadOnlyMode || !this.CanUndo || this.OwnerControl.DisableHistory)
                return;
            var historyInfo = this.undoStack._Pop();
            this.IsUndoing = true;
            historyInfo._Revert();
            this.IsUndoing = false;
            this.OwnerControl.Viewer._CheckForCursorVisibility(false);
        };
        History.prototype._Redo = function () {
            if (this.OwnerControl.IsReadOnlyMode || !this.CanRedo || this.OwnerControl.DisableHistory)
                return;
            var historyInfo = this.RedoStack._Pop();
            this.IsRedoing = true;
            historyInfo._Revert();
            this.IsRedoing = false;
            this.OwnerControl.Viewer._CheckForCursorVisibility(false);
        };
        History.prototype._Dispose = function () {
            this._ClearHistory();
            this.undoStack = null;
            this.redoStack = null;
        };
        History.prototype._ClearHistory = function () {
            this._ClearUndoStack();
            this._ClearRedoStack();
        };
        History.prototype._ClearUndoStack = function () {
            if (this.CanUndo) {
                while (this.undoStack.Count > 0) {
                    var historyInfo = this.undoStack._Pop();
                    historyInfo._Dispose();
                    historyInfo = null;
                }
            }
        };
        History.prototype._ClearRedoStack = function () {
            if (this.CanRedo) {
                while (this.redoStack.Count > 0) {
                    var historyInfo = this.redoStack._Pop();
                    historyInfo._Dispose();
                    historyInfo = null;
                }
            }
        };
        return History;
    }());
    DocumentEditorFeatures.History = History;
    (function (Actions) {
        Actions[Actions["Bold"] = 0] = "Bold";
        Actions[Actions["Italic"] = 1] = "Italic";
        Actions[Actions["FontSize"] = 2] = "FontSize";
        Actions[Actions["FontFamily"] = 3] = "FontFamily";
        Actions[Actions["FontColor"] = 4] = "FontColor";
        Actions[Actions["HighlightColor"] = 5] = "HighlightColor";
        Actions[Actions["BaselineAlignment"] = 6] = "BaselineAlignment";
        Actions[Actions["StrikeThrough"] = 7] = "StrikeThrough";
        Actions[Actions["Underline"] = 8] = "Underline";
        Actions[Actions["TextAlignment"] = 9] = "TextAlignment";
        Actions[Actions["LineSpacingType"] = 10] = "LineSpacingType";
        Actions[Actions["LineSpacing"] = 11] = "LineSpacing";
        Actions[Actions["AfterSpacing"] = 12] = "AfterSpacing";
        Actions[Actions["BeforeSpacing"] = 13] = "BeforeSpacing";
        Actions[Actions["LeftIndent"] = 14] = "LeftIndent";
        Actions[Actions["RightIndent"] = 15] = "RightIndent";
        Actions[Actions["FirstLineIndent"] = 16] = "FirstLineIndent";
        Actions[Actions["ImageReszing"] = 17] = "ImageReszing";
        Actions[Actions["Insert"] = 18] = "Insert";
        Actions[Actions["ReplaceAll"] = 19] = "ReplaceAll";
        Actions[Actions["ChangeAll"] = 20] = "ChangeAll";
        Actions[Actions["IgnoreAll"] = 21] = "IgnoreAll";
        Actions[Actions["AddToDictionary"] = 22] = "AddToDictionary";
        Actions[Actions["InsertHyperlink"] = 23] = "InsertHyperlink";
        Actions[Actions["EditHyperlink"] = 24] = "EditHyperlink";
        Actions[Actions["RemoveHyperlink"] = 25] = "RemoveHyperlink";
        Actions[Actions["AutoFormatHyperlink"] = 26] = "AutoFormatHyperlink";
        Actions[Actions["InsertInline"] = 27] = "InsertInline";
        Actions[Actions["RemoveInline"] = 28] = "RemoveInline";
        Actions[Actions["InsertRowAbove"] = 29] = "InsertRowAbove";
        Actions[Actions["InsertRowBelow"] = 30] = "InsertRowBelow";
        Actions[Actions["InsertColumnLeft"] = 31] = "InsertColumnLeft";
        Actions[Actions["InsertColumnRight"] = 32] = "InsertColumnRight";
        Actions[Actions["InsertTable"] = 33] = "InsertTable";
        Actions[Actions["Enter"] = 34] = "Enter";
        Actions[Actions["BackSpace"] = 35] = "BackSpace";
        Actions[Actions["Delete"] = 36] = "Delete";
        Actions[Actions["Cut"] = 37] = "Cut";
        Actions[Actions["Paste"] = 38] = "Paste";
        Actions[Actions["ClearCells"] = 39] = "ClearCells";
        Actions[Actions["DeleteCells"] = 40] = "DeleteCells";
        Actions[Actions["DeleteRow"] = 41] = "DeleteRow";
        Actions[Actions["DeleteColumn"] = 42] = "DeleteColumn";
        Actions[Actions["DeleteTable"] = 43] = "DeleteTable";
        Actions[Actions["MergeCells"] = 44] = "MergeCells";
        Actions[Actions["TableCellBackground"] = 45] = "TableCellBackground";
        Actions[Actions["ListFormat"] = 46] = "ListFormat";
        Actions[Actions["DragDrop"] = 47] = "DragDrop";
        Actions[Actions["PageMargin"] = 48] = "PageMargin";
        Actions[Actions["PageSize"] = 49] = "PageSize";
        Actions[Actions["List"] = 50] = "List";
        Actions[Actions["InsertComment"] = 51] = "InsertComment";
        Actions[Actions["DeleteComment"] = 52] = "DeleteComment";
        Actions[Actions["DeleteAllComments"] = 53] = "DeleteAllComments";
        Actions[Actions["ParagraphFormat"] = 54] = "ParagraphFormat";
        Actions[Actions["CharacterFormat"] = 55] = "CharacterFormat";
        Actions[Actions["TableFormat"] = 56] = "TableFormat";
        Actions[Actions["CellFormat"] = 57] = "CellFormat";
        Actions[Actions["RowFormat"] = 58] = "RowFormat";
        Actions[Actions["MultiSelection"] = 59] = "MultiSelection";
        Actions[Actions["Selection"] = 60] = "Selection";
        Actions[Actions["TableAlignment"] = 61] = "TableAlignment";
        Actions[Actions["TableLeftIndent"] = 62] = "TableLeftIndent";
        Actions[Actions["CellSpacing"] = 63] = "CellSpacing";
        Actions[Actions["DefaultCellLeftMargin"] = 64] = "DefaultCellLeftMargin";
        Actions[Actions["DefaultCellRightMargin"] = 65] = "DefaultCellRightMargin";
        Actions[Actions["DefaultCellTopMargin"] = 66] = "DefaultCellTopMargin";
        Actions[Actions["DefaultCellBottomMargin"] = 67] = "DefaultCellBottomMargin";
        Actions[Actions["CellContentVerticalAlignment"] = 68] = "CellContentVerticalAlignment";
        Actions[Actions["CellLeftMargin"] = 69] = "CellLeftMargin";
        Actions[Actions["CellRightMargin"] = 70] = "CellRightMargin";
        Actions[Actions["CellTopMargin"] = 71] = "CellTopMargin";
        Actions[Actions["CellBottomtMargin"] = 72] = "CellBottomtMargin";
        Actions[Actions["RowHeight"] = 73] = "RowHeight";
        Actions[Actions["RowHeightType"] = 74] = "RowHeightType";
        Actions[Actions["RowHeader"] = 75] = "RowHeader";
        Actions[Actions["AllowBreakAcrossPages"] = 76] = "AllowBreakAcrossPages";
        Actions[Actions["CellResizing"] = 77] = "CellResizing";
        Actions[Actions["RowResizing"] = 78] = "RowResizing";
    })(DocumentEditorFeatures.Actions || (DocumentEditorFeatures.Actions = {}));
    var Actions = DocumentEditorFeatures.Actions;
    (function (LineStyle) {
        LineStyle[LineStyle["None"] = 0] = "None";
        LineStyle[LineStyle["Single"] = 1] = "Single";
        LineStyle[LineStyle["Dot"] = 2] = "Dot";
        LineStyle[LineStyle["DashSmallGap"] = 3] = "DashSmallGap";
        LineStyle[LineStyle["DashLargeGap"] = 4] = "DashLargeGap";
        LineStyle[LineStyle["DashDot"] = 5] = "DashDot";
        LineStyle[LineStyle["DashDotDot"] = 6] = "DashDotDot";
        LineStyle[LineStyle["Double"] = 7] = "Double";
        LineStyle[LineStyle["Triple"] = 8] = "Triple";
        LineStyle[LineStyle["ThinThickSmallGap"] = 9] = "ThinThickSmallGap";
        LineStyle[LineStyle["ThickThinSmallGap"] = 10] = "ThickThinSmallGap";
        LineStyle[LineStyle["ThinThickThinSmallGap"] = 11] = "ThinThickThinSmallGap";
        LineStyle[LineStyle["ThinThickMediumGap"] = 12] = "ThinThickMediumGap";
        LineStyle[LineStyle["ThickThinMediumGap"] = 13] = "ThickThinMediumGap";
        LineStyle[LineStyle["ThinThickThinMediumGap"] = 14] = "ThinThickThinMediumGap";
        LineStyle[LineStyle["ThinThickLargeGap"] = 15] = "ThinThickLargeGap";
        LineStyle[LineStyle["ThickThinLargeGap"] = 16] = "ThickThinLargeGap";
        LineStyle[LineStyle["ThinThickThinLargeGap"] = 17] = "ThinThickThinLargeGap";
        LineStyle[LineStyle["SingleWavy"] = 18] = "SingleWavy";
        LineStyle[LineStyle["DoubleWavy"] = 19] = "DoubleWavy";
        LineStyle[LineStyle["DashDotStroked"] = 20] = "DashDotStroked";
        LineStyle[LineStyle["Emboss3D"] = 21] = "Emboss3D";
        LineStyle[LineStyle["Engrave3D"] = 22] = "Engrave3D";
        LineStyle[LineStyle["Outset"] = 23] = "Outset";
        LineStyle[LineStyle["Inset"] = 24] = "Inset";
        LineStyle[LineStyle["Thick"] = 25] = "Thick";
    })(DocumentEditorFeatures.LineStyle || (DocumentEditorFeatures.LineStyle = {}));
    var LineStyle = DocumentEditorFeatures.LineStyle;
    (function (TextureStyle) {
        TextureStyle[TextureStyle["TextureNone"] = 0] = "TextureNone";
        TextureStyle[TextureStyle["Texture2Pt5Percent"] = 35] = "Texture2Pt5Percent";
        TextureStyle[TextureStyle["Texture5Percent"] = 2] = "Texture5Percent";
        TextureStyle[TextureStyle["Texture7Pt5Percent"] = 36] = "Texture7Pt5Percent";
        TextureStyle[TextureStyle["Texture10Percent"] = 3] = "Texture10Percent";
        TextureStyle[TextureStyle["Texture12Pt5Percent"] = 37] = "Texture12Pt5Percent";
        TextureStyle[TextureStyle["Texture15Percent"] = 26] = "Texture15Percent";
        TextureStyle[TextureStyle["Texture17Pt5Percent"] = 39] = "Texture17Pt5Percent";
        TextureStyle[TextureStyle["Texture20Percent"] = 4] = "Texture20Percent";
        TextureStyle[TextureStyle["Texture22Pt5Percent"] = 40] = "Texture22Pt5Percent";
        TextureStyle[TextureStyle["Texture25Percent"] = 5] = "Texture25Percent";
        TextureStyle[TextureStyle["Texture27Pt5Percent"] = 41] = "Texture27Pt5Percent";
        TextureStyle[TextureStyle["Texture30Percent"] = 6] = "Texture30Percent";
        TextureStyle[TextureStyle["Texture32Pt5Percent"] = 42] = "Texture32Pt5Percent";
        TextureStyle[TextureStyle["Texture35Percent"] = 43] = "Texture35Percent";
        TextureStyle[TextureStyle["Texture37Pt5Percent"] = 44] = "Texture37Pt5Percent";
        TextureStyle[TextureStyle["Texture40Percent"] = 7] = "Texture40Percent";
        TextureStyle[TextureStyle["Texture42Pt5Percent"] = 45] = "Texture42Pt5Percent";
        TextureStyle[TextureStyle["Texture45Percent"] = 46] = "Texture45Percent";
        TextureStyle[TextureStyle["Texture47Pt5Percent"] = 47] = "Texture47Pt5Percent";
        TextureStyle[TextureStyle["Texture50Percent"] = 8] = "Texture50Percent";
        TextureStyle[TextureStyle["Texture52Pt5Percent"] = 48] = "Texture52Pt5Percent";
        TextureStyle[TextureStyle["Texture55Percent"] = 49] = "Texture55Percent";
        TextureStyle[TextureStyle["Texture57Pt5Percent"] = 50] = "Texture57Pt5Percent";
        TextureStyle[TextureStyle["Texture60Percent"] = 9] = "Texture60Percent";
        TextureStyle[TextureStyle["Texture62Pt5Percent"] = 51] = "Texture62Pt5Percent";
        TextureStyle[TextureStyle["Texture65Percent"] = 52] = "Texture65Percent";
        TextureStyle[TextureStyle["Texture67Pt5Percent"] = 53] = "Texture67Pt5Percent";
        TextureStyle[TextureStyle["Texture70Percent"] = 10] = "Texture70Percent";
        TextureStyle[TextureStyle["Texture72Pt5Percent"] = 54] = "Texture72Pt5Percent";
        TextureStyle[TextureStyle["Texture75Percent"] = 11] = "Texture75Percent";
        TextureStyle[TextureStyle["Texture77Pt5Percent"] = 55] = "Texture77Pt5Percent";
        TextureStyle[TextureStyle["Texture80Percent"] = 12] = "Texture80Percent";
        TextureStyle[TextureStyle["Texture82Pt5Percent"] = 56] = "Texture82Pt5Percent";
        TextureStyle[TextureStyle["Texture85Percent"] = 57] = "Texture85Percent";
        TextureStyle[TextureStyle["Texture87Pt5Percent"] = 58] = "Texture87Pt5Percent";
        TextureStyle[TextureStyle["Texture90Percent"] = 13] = "Texture90Percent";
        TextureStyle[TextureStyle["Texture92Pt5Percent"] = 59] = "Texture92Pt5Percent";
        TextureStyle[TextureStyle["Texture95Percent"] = 60] = "Texture95Percent";
        TextureStyle[TextureStyle["Texture97Pt5Percent"] = 61] = "Texture97Pt5Percent";
        TextureStyle[TextureStyle["TextureSolid"] = 1] = "TextureSolid";
        TextureStyle[TextureStyle["TextureDarkHorizontal"] = 14] = "TextureDarkHorizontal";
        TextureStyle[TextureStyle["TextureDarkVertical"] = 15] = "TextureDarkVertical";
        TextureStyle[TextureStyle["TextureDarkDiagonalDown"] = 16] = "TextureDarkDiagonalDown";
        TextureStyle[TextureStyle["TextureDarkDiagonalUp"] = 17] = "TextureDarkDiagonalUp";
        TextureStyle[TextureStyle["TextureDarkCross"] = 18] = "TextureDarkCross";
        TextureStyle[TextureStyle["TextureDarkDiagonalCross"] = 19] = "TextureDarkDiagonalCross";
        TextureStyle[TextureStyle["TextureHorizontal"] = 20] = "TextureHorizontal";
        TextureStyle[TextureStyle["TextureVertical"] = 21] = "TextureVertical";
        TextureStyle[TextureStyle["TextureDiagonalDown"] = 22] = "TextureDiagonalDown";
        TextureStyle[TextureStyle["TextureDiagonalUp"] = 23] = "TextureDiagonalUp";
        TextureStyle[TextureStyle["TextureCross"] = 24] = "TextureCross";
        TextureStyle[TextureStyle["TextureDiagonalCross"] = 25] = "TextureDiagonalCross";
    })(DocumentEditorFeatures.TextureStyle || (DocumentEditorFeatures.TextureStyle = {}));
    var TextureStyle = DocumentEditorFeatures.TextureStyle;
    (function (TextWrapping) {
        TextWrapping[TextWrapping["Wrap"] = 0] = "Wrap";
        TextWrapping[TextWrapping["NoWrap"] = 1] = "NoWrap";
    })(DocumentEditorFeatures.TextWrapping || (DocumentEditorFeatures.TextWrapping = {}));
    var TextWrapping = DocumentEditorFeatures.TextWrapping;
    (function (HeaderFooterType) {
        HeaderFooterType[HeaderFooterType["EvenHeader"] = 0] = "EvenHeader";
        HeaderFooterType[HeaderFooterType["OddHeader"] = 1] = "OddHeader";
        HeaderFooterType[HeaderFooterType["EvenFooter"] = 2] = "EvenFooter";
        HeaderFooterType[HeaderFooterType["OddFooter"] = 3] = "OddFooter";
        HeaderFooterType[HeaderFooterType["FirstPageHeader"] = 4] = "FirstPageHeader";
        HeaderFooterType[HeaderFooterType["FirstPageFooter"] = 5] = "FirstPageFooter";
    })(DocumentEditorFeatures.HeaderFooterType || (DocumentEditorFeatures.HeaderFooterType = {}));
    var HeaderFooterType = DocumentEditorFeatures.HeaderFooterType;
    (function (FollowCharacterType) {
        FollowCharacterType[FollowCharacterType["Tab"] = 0] = "Tab";
        FollowCharacterType[FollowCharacterType["Space"] = 1] = "Space";
        FollowCharacterType[FollowCharacterType["None"] = 2] = "None";
    })(DocumentEditorFeatures.FollowCharacterType || (DocumentEditorFeatures.FollowCharacterType = {}));
    var FollowCharacterType = DocumentEditorFeatures.FollowCharacterType;
    (function (HyperlinkType) {
        HyperlinkType[HyperlinkType["File"] = 0] = "File";
        HyperlinkType[HyperlinkType["Webpage"] = 1] = "Webpage";
        HyperlinkType[HyperlinkType["Email"] = 2] = "Email";
        HyperlinkType[HyperlinkType["Bookmark"] = 3] = "Bookmark";
    })(DocumentEditorFeatures.HyperlinkType || (DocumentEditorFeatures.HyperlinkType = {}));
    var HyperlinkType = DocumentEditorFeatures.HyperlinkType;
    (function (RowPlacement) {
        RowPlacement[RowPlacement["Above"] = 0] = "Above";
        RowPlacement[RowPlacement["Below"] = 1] = "Below";
    })(DocumentEditorFeatures.RowPlacement || (DocumentEditorFeatures.RowPlacement = {}));
    var RowPlacement = DocumentEditorFeatures.RowPlacement;
    (function (ColumnPlacement) {
        ColumnPlacement[ColumnPlacement["Left"] = 0] = "Left";
        ColumnPlacement[ColumnPlacement["Right"] = 1] = "Right";
    })(DocumentEditorFeatures.ColumnPlacement || (DocumentEditorFeatures.ColumnPlacement = {}));
    var ColumnPlacement = DocumentEditorFeatures.ColumnPlacement;
    (function (ListType) {
        ListType[ListType["None"] = 0] = "None";
        ListType[ListType["Bullet"] = 1] = "Bullet";
        ListType[ListType["Numbering"] = 2] = "Numbering";
        ListType[ListType["OutlineNumbering"] = 3] = "OutlineNumbering";
    })(DocumentEditorFeatures.ListType || (DocumentEditorFeatures.ListType = {}));
    var ListType = DocumentEditorFeatures.ListType;
    (function (LayoutType) {
        LayoutType[LayoutType["Pages"] = 0] = "Pages";
        LayoutType[LayoutType["Continuous"] = 1] = "Continuous";
    })(DocumentEditorFeatures.LayoutType || (DocumentEditorFeatures.LayoutType = {}));
    var LayoutType = DocumentEditorFeatures.LayoutType;
    (function (FormatType) {
        FormatType[FormatType["Doc"] = 0] = "Doc";
        FormatType[FormatType["Docx"] = 1] = "Docx";
        FormatType[FormatType["Html"] = 2] = "Html";
        FormatType[FormatType["Rtf"] = 3] = "Rtf";
        FormatType[FormatType["Txt"] = 4] = "Txt";
        FormatType[FormatType["WordML"] = 5] = "WordML";
    })(DocumentEditorFeatures.FormatType || (DocumentEditorFeatures.FormatType = {}));
    var FormatType = DocumentEditorFeatures.FormatType;
    (function (EditingContextType) {
        EditingContextType[EditingContextType["Text"] = 0] = "Text";
        EditingContextType[EditingContextType["Table"] = 1] = "Table";
    })(DocumentEditorFeatures.EditingContextType || (DocumentEditorFeatures.EditingContextType = {}));
    var EditingContextType = DocumentEditorFeatures.EditingContextType;
    (function (PageFitType) {
        PageFitType[PageFitType["None"] = 0] = "None";
        PageFitType[PageFitType["FitFullPage"] = 1] = "FitFullPage";
        PageFitType[PageFitType["FitMultiplePages"] = 2] = "FitMultiplePages";
        PageFitType[PageFitType["FitPageWidth"] = 3] = "FitPageWidth";
    })(DocumentEditorFeatures.PageFitType || (DocumentEditorFeatures.PageFitType = {}));
    var PageFitType = DocumentEditorFeatures.PageFitType;
    (function (StrikeThrough) {
        StrikeThrough[StrikeThrough["None"] = 0] = "None";
        StrikeThrough[StrikeThrough["SingleStrike"] = 1] = "SingleStrike";
        StrikeThrough[StrikeThrough["DoubleStrike"] = 2] = "DoubleStrike";
    })(DocumentEditorFeatures.StrikeThrough || (DocumentEditorFeatures.StrikeThrough = {}));
    var StrikeThrough = DocumentEditorFeatures.StrikeThrough;
    (function (BaselineAlignment) {
        BaselineAlignment[BaselineAlignment["Normal"] = 0] = "Normal";
        BaselineAlignment[BaselineAlignment["Superscript"] = 1] = "Superscript";
        BaselineAlignment[BaselineAlignment["Subscript"] = 2] = "Subscript";
    })(DocumentEditorFeatures.BaselineAlignment || (DocumentEditorFeatures.BaselineAlignment = {}));
    var BaselineAlignment = DocumentEditorFeatures.BaselineAlignment;
    (function (Underline) {
        Underline[Underline["None"] = 0] = "None";
        Underline[Underline["Single"] = 1] = "Single";
        Underline[Underline["Words"] = 2] = "Words";
        Underline[Underline["Double"] = 3] = "Double";
        Underline[Underline["Dotted"] = 4] = "Dotted";
        Underline[Underline["Thick"] = 6] = "Thick";
        Underline[Underline["Dash"] = 7] = "Dash";
        Underline[Underline["DashLong"] = 39] = "DashLong";
        Underline[Underline["DotDash"] = 9] = "DotDash";
        Underline[Underline["DotDotDash"] = 10] = "DotDotDash";
        Underline[Underline["Wavy"] = 11] = "Wavy";
        Underline[Underline["DottedHeavy"] = 20] = "DottedHeavy";
        Underline[Underline["DashHeavy"] = 23] = "DashHeavy";
        Underline[Underline["DashLongHeavy"] = 55] = "DashLongHeavy";
        Underline[Underline["DotDashHeavy"] = 25] = "DotDashHeavy";
        Underline[Underline["DotDotDashHeavy"] = 26] = "DotDotDashHeavy";
        Underline[Underline["WavyHeavy"] = 27] = "WavyHeavy";
        Underline[Underline["WavyDouble"] = 43] = "WavyDouble";
    })(DocumentEditorFeatures.Underline || (DocumentEditorFeatures.Underline = {}));
    var Underline = DocumentEditorFeatures.Underline;
    (function (HighlightColor) {
        HighlightColor[HighlightColor["NoColor"] = 0] = "NoColor";
        HighlightColor[HighlightColor["Yellow"] = 1] = "Yellow";
        HighlightColor[HighlightColor["BrightGreen"] = 2] = "BrightGreen";
        HighlightColor[HighlightColor["Turquoise"] = 3] = "Turquoise";
        HighlightColor[HighlightColor["Pink"] = 4] = "Pink";
        HighlightColor[HighlightColor["Blue"] = 5] = "Blue";
        HighlightColor[HighlightColor["Red"] = 6] = "Red";
        HighlightColor[HighlightColor["DarkBlue"] = 7] = "DarkBlue";
        HighlightColor[HighlightColor["Teal"] = 8] = "Teal";
        HighlightColor[HighlightColor["Green"] = 9] = "Green";
        HighlightColor[HighlightColor["Violet"] = 10] = "Violet";
        HighlightColor[HighlightColor["DarkRed"] = 11] = "DarkRed";
        HighlightColor[HighlightColor["DarkYellow"] = 12] = "DarkYellow";
        HighlightColor[HighlightColor["Gray50"] = 13] = "Gray50";
        HighlightColor[HighlightColor["Gray25"] = 14] = "Gray25";
        HighlightColor[HighlightColor["Black"] = 15] = "Black";
    })(DocumentEditorFeatures.HighlightColor || (DocumentEditorFeatures.HighlightColor = {}));
    var HighlightColor = DocumentEditorFeatures.HighlightColor;
    (function (LineSpacingType) {
        LineSpacingType[LineSpacingType["AtLeast"] = 0] = "AtLeast";
        LineSpacingType[LineSpacingType["Exactly"] = 1] = "Exactly";
        LineSpacingType[LineSpacingType["Multiple"] = 2] = "Multiple";
    })(DocumentEditorFeatures.LineSpacingType || (DocumentEditorFeatures.LineSpacingType = {}));
    var LineSpacingType = DocumentEditorFeatures.LineSpacingType;
    (function (TextAlignment) {
        TextAlignment[TextAlignment["Center"] = 0] = "Center";
        TextAlignment[TextAlignment["Left"] = 1] = "Left";
        TextAlignment[TextAlignment["Right"] = 2] = "Right";
        TextAlignment[TextAlignment["Justify"] = 3] = "Justify";
    })(DocumentEditorFeatures.TextAlignment || (DocumentEditorFeatures.TextAlignment = {}));
    var TextAlignment = DocumentEditorFeatures.TextAlignment;
    (function (FindOptions) {
        FindOptions[FindOptions["None"] = 0] = "None";
        FindOptions[FindOptions["WholeWord"] = 1] = "WholeWord";
        FindOptions[FindOptions["CaseSensitive"] = 2] = "CaseSensitive";
        FindOptions[FindOptions["CaseSensitiveWholeWord"] = 3] = "CaseSensitiveWholeWord";
    })(DocumentEditorFeatures.FindOptions || (DocumentEditorFeatures.FindOptions = {}));
    var FindOptions = DocumentEditorFeatures.FindOptions;
    (function (TableAlignment) {
        TableAlignment[TableAlignment["Left"] = 0] = "Left";
        TableAlignment[TableAlignment["Center"] = 1] = "Center";
        TableAlignment[TableAlignment["Right"] = 2] = "Right";
    })(DocumentEditorFeatures.TableAlignment || (DocumentEditorFeatures.TableAlignment = {}));
    var TableAlignment = DocumentEditorFeatures.TableAlignment;
    (function (WidthType) {
        WidthType[WidthType["Auto"] = 0] = "Auto";
        WidthType[WidthType["Percent"] = 1] = "Percent";
        WidthType[WidthType["Pixel"] = 2] = "Pixel";
    })(DocumentEditorFeatures.WidthType || (DocumentEditorFeatures.WidthType = {}));
    var WidthType = DocumentEditorFeatures.WidthType;
    (function (CellVerticalAlignment) {
        CellVerticalAlignment[CellVerticalAlignment["Top"] = 0] = "Top";
        CellVerticalAlignment[CellVerticalAlignment["Center"] = 1] = "Center";
        CellVerticalAlignment[CellVerticalAlignment["Bottom"] = 2] = "Bottom";
    })(DocumentEditorFeatures.CellVerticalAlignment || (DocumentEditorFeatures.CellVerticalAlignment = {}));
    var CellVerticalAlignment = DocumentEditorFeatures.CellVerticalAlignment;
    (function (HeightType) {
        HeightType[HeightType["Auto"] = 0] = "Auto";
        HeightType[HeightType["Atleast"] = 1] = "Atleast";
        HeightType[HeightType["Exactly"] = 2] = "Exactly";
    })(DocumentEditorFeatures.HeightType || (DocumentEditorFeatures.HeightType = {}));
    var HeightType = DocumentEditorFeatures.HeightType;
    (function (ListLevelPattern) {
        ListLevelPattern[ListLevelPattern["Arabic"] = 0] = "Arabic";
        ListLevelPattern[ListLevelPattern["UpRoman"] = 1] = "UpRoman";
        ListLevelPattern[ListLevelPattern["LowRoman"] = 2] = "LowRoman";
        ListLevelPattern[ListLevelPattern["UpLetter"] = 3] = "UpLetter";
        ListLevelPattern[ListLevelPattern["LowLetter"] = 4] = "LowLetter";
        ListLevelPattern[ListLevelPattern["Ordinal"] = 5] = "Ordinal";
        ListLevelPattern[ListLevelPattern["Number"] = 6] = "Number";
        ListLevelPattern[ListLevelPattern["OrdinalText"] = 7] = "OrdinalText";
        ListLevelPattern[ListLevelPattern["LeadingZero"] = 22] = "LeadingZero";
        ListLevelPattern[ListLevelPattern["Bullet"] = 23] = "Bullet";
        ListLevelPattern[ListLevelPattern["FarEast"] = 20] = "FarEast";
        ListLevelPattern[ListLevelPattern["Special"] = 58] = "Special";
        ListLevelPattern[ListLevelPattern["None"] = 255] = "None";
    })(DocumentEditorFeatures.ListLevelPattern || (DocumentEditorFeatures.ListLevelPattern = {}));
    var ListLevelPattern = DocumentEditorFeatures.ListLevelPattern;
})(DocumentEditorFeatures || (DocumentEditorFeatures = {}));
